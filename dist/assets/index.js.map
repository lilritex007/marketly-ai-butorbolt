{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","getApiBase","base","_a","DEFAULT_LIMIT","fetchUnasProducts","filters","limit","offset","API_BASE","params","mainValue","url","res","data","products","error","fetchCategoryHierarchy","fetchUnasProductById","id","fetchProductStats","getCartAddPrefix","path","_c","_b","extractVxSku","product","m1","imgs","firstImg","imgUrl","m2","toUnasProductId","raw","s","str","getCartAddContext","wins","w","findUnasForm","doc","selectors","sel","form","ensureQtyInput","unasId","qty","targetDoc","numericId","ids","input","inputId","el","input2","addToUnasCart","quantity","ctx","err","STORAGE_KEYS","MAX_ITEMS","MAX_BACK_IN_STOCK","DEFAULT_RECO_TWEAKS","DEFAULT_RECO_WEIGHTS","getJSONSafe","key","fallback","trackProductView","filtered","getViewedProducts","updated","updateCategoryPreference","parsed","getRecentlyViewedIds","likeProduct","productId","liked","getLikedProducts","disliked","getDislikedProducts","dislikeProduct","SIGNAL_LIMITS","stopWords","clampSignal","value","extractSignalTokens","categories","keywords","getPreferenceSignals","savePreferenceSignals","signals","updatePreferenceSignals","delta","cat","next","kw","toggleLikeProduct","isLiked","isDisliked","nextLiked","toggleDislikeProduct","nextDisliked","isProductLiked","isProductDisliked","requestBackInStock","getBackInStockRequests","list","trackSectionEvent","sectionId","type","entry","trackSearch","query","getSearchHistory","normalizeSearchQuery","getSearchQueryWords","trackSearchClick","position","queryNorm","clicks","getSearchClickBoosts","boosts","queryWords","storedWords","isExact","hasOverlap","saveStyleDNA","quizAnswers","styleDNAText","getStyleDNA","trackAIFeedback","messageId","isPositive","context","feedback","getAIFeedback","saveChatContext","summary","getChatContext","category","prefs","getUserPreferences","getRecommendationTweaks","setRecommendationTweaks","merged","resetRecommendationTweaks","getRecommendationWeights","getABVariant","testId","tests","variant","trackABEvent","getTopCategories","name","getPersonalizedContext","viewedProducts","likedProducts","topCategories","styleDNA","searchHistory","getPersonalizedRecommendations","allProducts","viewedIds","likedIds","dislikedIds","tweaks","weights","avgPriceBase","avgPrice","sum","score","price","productCategory","index","signal","space","colors","budget","priority","room","productText","styleKeywords","roomKeywords","diff","stockQty","getSimilarProducts","productName","productPrice","pName","pCategory","pPrice","priceDiff","Skeleton","className","baseClasses","variants","jsx","ProductCardSkeleton","jsxs","ProductGridSkeleton","count","_","i","ToastContext","createContext","TOAST_TYPES","CheckCircle2","XCircle","AlertCircle","Info","ShoppingCart","Heart","Sparkles","Bell","Truck","Toast","title","message","duration","onClose","action","isVisible","setIsVisible","useState","isLeaving","setIsLeaving","config","Icon","useEffect","timer","handleClose","X","ToastContainer","toasts","removeToast","toast","ToastProvider","children","setToasts","addToast","useCallback","options","prev","t","useToast","useContext","EmptyState","Package","description","secondaryAction","size","NoSearchResults","onClear","onSuggest","didYouMean","onDidYouMean","Search","RefreshCw","NoFilterResults","onClearFilters","Filter","Badge","pulse","sizes","iconSizes","NewBadge","DiscountBadge","percent","Percent","HotBadge","Flame","BestsellerBadge","Award","LimitedBadge","Clock","FreeShippingBadge","StockBadge","inStock","SmartBadges","maxBadges","badges","topBadges","badge","idx","CATEGORY_ICONS","LayoutGrid","Sofa","Armchair","Tv","BedDouble","Briefcase","Table","UtensilsCrossed","Warehouse","Shirt","Box","BookOpen","Lamp","LampDesk","Baby","Bath","TreeDeciduous","Flower2","Home","Gift","getCategoryIcon","categoryName","lowerName","CategoryIcon","props","AIOnboarding","isOpen","targetFeature","messages","MessageCircle","Camera","content","Lightbulb","CategorySwipe","activeCategory","onCategoryChange","displayedCount","activeTotalOverride","isExpanded","setIsExpanded","canScrollLeft","setCanScrollLeft","canScrollRight","setCanScrollRight","scrollRef","useRef","activeData","activeTotalCount","VISIBLE_MOBILE","VISIBLE_DESKTOP","isMobile","setIsMobile","checkMobile","visibleCount","visibleCategories","hasMore","updateScrollIndicators","scrollLeft","scrollWidth","clientWidth","rafId","onScroll","scroll","direction","activeEl","Grid3X3","Fragment","ChevronLeft","ChevronRight","ChevronUp","ChevronDown","PLACEHOLDER_IMAGE","normalizeProduct","formatPrice","formatPriceNumber","isValidEmail","email","getStockLevel","direct","match","val","toWebP","imageUrl","quality","isWebPSupported","canvas","support","getResponsiveSrcSet","appendSizeParam","width","getOptimizedImageProps","alt","height","lazy","responsive","optimizedUrl","getAdaptiveQuality","EnhancedProductCard","onToggleWishlist","isWishlisted","onQuickView","onAddToCart","highlightBadge","recommendationReasons","showFeedback","tone","accentClass","skipScrollAnimation","isHovered","setIsHovered","imageLoaded","setImageLoaded","imageError","setImageError","notifySaved","setNotifySaved","toneClasses","sizeClasses","sizeConfig","feedbackState","setFeedbackState","cardRef","impressionRef","mainImage","discount","displayPrice","reasonsText","optimizedProps","timeoutRef","element","observer","delay","handleQuickView","handleNotify","hasWorldAccent","worldGlow","worldCorner","Eye","ThumbsUp","ThumbsDown","PRESET_STORAGE_KEY","CATEGORY_IMAGES","getCategoryImage","getCategoryTheme","themes","theme","Breadcrumb","onBack","CategoryHero","productCount","bgImage","SidebarFilters","onFilterChange","priceRange","onPriceRangeChange","filterOptions","useMemo","brands","prices","minPrice","maxPrice","previewCounts","brandCounts","colorCounts","isInStock","brandOk","colorOk","toggleFilter","current","v","FilterSection","items","item","preview","Tag","SlidersHorizontal","RelatedCategories","currentCategory","allCategories","related","CategoryStory","blocks","ShieldCheck","MapPin","block","PriceStats","stats","computedStats","stat","FeaturedProducts","onProductClick","onWishlistToggle","wishlist","featured","Star","CompactProductCard","onCompare","isComparing","hasDiscount","discountPct","GitCompare","AIBanner","onAskAI","ViewControls","sortOption","onSortChange","viewMode","onViewModeChange","loadedCount","totalCount","onOpenFilters","compareCount","Rows3","mode","CategoryPage","onLoadMore","onScrollToSection","setSortOption","setViewMode","setFilters","setPriceRange","showFilters","setShowFilters","compareList","setCompareList","presetName","setPresetName","savedPresets","setSavedPresets","loadMoreRef","savePreset","applyPreset","preset","quickApply","quickCounts","under100","premium","displayedProducts","dA","stock","viewed","visibleProducts","hasMoreToShow","toggleCompare","CollectionHero","collection","CollectionCompactCard","CollectionPage","onNavigateToCategory","isLoading","activeCategoryFilter","setActiveCategoryFilter","styleFilteredProducts","searchStr","inCollectionCategories","set","CARD_COLORS","MainCategoriesSection","mainCategories","onCategorySelect","totalProductCount","main","isActive","color","child","scrollY","scrollPercent","scrollHeight","snapshot","listeners","getScrollData","y","sh","pct","notify","fn","subscribe","listener","getSnapshot","getServerSnapshot","useScrollPosition","useSyncExternalStore","useScrollPastY","threshold","useScrollPastPercent","lockCount","savedStyles","lastScrollParent","getScrollParent","appRoot","parent","oy","lock","bodyOverflow","scrollParent","unlock","bodySaved","parentSaved","useScrollLock","RECENT_CATEGORIES_KEY","RECENT_CATEGORIES_MAX","ANNOUNCEMENT_MESSAGES","Zap","TrendingUp","POPULAR_CATEGORIES","MEGA_MENU_COLORS","Navbar","activeTab","setActiveTab","wishlistCount","categoryHierarchy","onOpenWishlist","onScrollToShop","recentlyViewedProp","fixUrl","onRecentProductClick","mobileMenuOpen","setMobileMenuOpen","isScrolled","announcementIndex","setAnnouncementIndex","announcementProgress","setAnnouncementProgress","announcementStartRef","isDarkMode","setIsDarkMode","showMegaMenu","setShowMegaMenu","isReturningUser","setIsReturningUser","userName","setUserName","mobileMenuClosing","setMobileMenuClosing","touchStartX","setTouchStartX","recentlyViewedLocal","setRecentlyViewedLocal","recentCategories","setRecentCategories","mobileCategoriesExpanded","setMobileCategoriesExpanded","mobileExpandedMain","setMobileExpandedMain","megaMenuHoverMain","setMegaMenuHoverMain","mobileMenuRef","megaMenuRef","megaMenuPanelRef","megaMenuCloseTimeoutRef","hamburgerButtonRef","lastVisit","savedName","load","pushRecentCategory","ANNOUNCEMENT_DURATION_MS","interval","announcementRafRef","start","tick","elapsed","handleEsc","handleClickOutside","panel","focusables","first","handleKeyDown","closeMobileMenu","handleTouchStart","handleTouchEnd","focusSearchAndClose","openMobileMenu","setTabAndClose","tab","navItems","Move","currentAnnouncement","isHover","isActiveMain","MainIcon","isActiveChild","ArrowRight","menuCategories","isRealCategories","Sun","Moon","Menu","part","arr","React","realCats","initialCount","shown","isReal","Phone","Mail","Instagram","Facebook","ScrollProgress","BackToTop","scrollToTop","ArrowUp","createMotionComponent","tag","forwardRef","initial","animate","exit","transition","whileHover","whileTap","style","ref","motion","AnimatePresence","LiveSocialProof","currentProduct","recentPurchases","viewerCount","setViewerCount","showNotification","setShowNotification","currentNotification","setCurrentNotification","baseViewers","change","notifications","ShoppingBag","Users","random","MIN_VIEWERS","MAX_VIEWERS","getRandomViewers","LiveActivityStrip","viewers","setViewers","Circle","CountUp","end","suffix","decimals","setCount","countRef","hasStarted","startTime","easeOutQuad","progress","easedProgress","formatNumber","num","normalize","SYNONYMS","_wordToRoot","root","syns","rootNorm","syn","_rootToExpanded","expanded","expandWithSynonyms","words","word","norm","getWords","WORD_TO_ROOT","levenshtein","matrix","j","getDidYouMeanSuggestion","vocabulary","replacements","bestWord","bestDist","suggested","findFuzzyMatches","maxDist","results","dist","lenMin","lenMax","INDEX","devLog","args","buildPrefixMap","len","prefix","buildSearchIndex","includeDesc","CHUNK_SIZE","processed","processChunk","resolve","nameNorm","catNorm","descNorm","allWords","getIndexStats","smartSearch","applyIntent","intent","parseSearchIntent","cacheKey","cached","clickBoosts","boosted","rest","reordered","buildSearchIndexSync","directSearch","expandedQuery","candidateScores","vocabArray","matched","exact","prefixWords","indexedWord","idxSet","fuzzy","fw","scored","baseScore","nameWordMatches","searchTime","broadenSuggestions","rewritten","ww","result","firstKey","getAutocompleteSuggestions","suggestions","seen","prefixMatches","exactWord","wordsToCheck","prods","maxScan","typeRoots","colorRoots","styleRoots","materialRoots","toNum","mult","getBroadenSuggestions","totalMatches","broaden","getProactiveSuggestions","QUICK_INTENTS","SUCCESSFUL_SEARCHES_KEY","SEARCH_DEBOUNCE_MS","LONG_PRESS_MS","QUICK_FILTER_PRESETS","PROACTIVE_QUICK","escapeRegExp","HeroSmartSearch","onSearch","onTryAI","onOpenProductQuickView","serverSearchMode","onFetchSearchPreview","setQuery","setIsOpen","isSearching","setIsSearching","didSearch","setDidSearch","dismissedFilterIds","setDismissedFilterIds","compareProducts","setCompareProducts","searchJourney","setSearchJourney","showRewriteOptions","setShowRewriteOptions","showQuickFilterPanel","setShowQuickFilterPanel","likedProductIds","setLikedProductIds","viewedProductIds","setViewedProductIds","preferredCategories","setPreferredCategories","preferredKeywords","setPreferredKeywords","searchPulse","setSearchPulse","resultCountPulse","setResultCountPulse","hoverCard","setHoverCard","smartResults","setSmartResults","smartTotalMatches","setSmartTotalMatches","setBroadenSuggestions","isIndexBuilding","setIsIndexBuilding","previewProduct","setPreviewProduct","previewAnchor","setPreviewAnchor","serverPreview","setServerPreview","serverRequestIdRef","instantSearchRef","longPressTimerRef","trimmedQuery","cancelled","debouncedQuery","setDebouncedQuery","requestId","total","nextResults","nextTotal","queryTokens","parsedFilters","activeFilters","queryMatchedProducts","haystack","token","rankedQueryProducts","likedSet","viewedSet","categoryFull","categoryLeaf","previewProducts","unique","starterProducts","contextualSuggestions","categoryMap","actualResultCount","confidenceScore","confidenceMeta","effectiveBroadenSuggestions","dynamicQuickSuggestions","firstToken","quickHitSuggestions","text","rewriteSuggestions","mainCategory","topStyle","topColor","rewriteSuggestionsWithQuality","intentTimeline","timeline","priceText","hasNoResults","rescueSuggestions","triggerFullSearch","inputQuery","source","safeQuery","handleSubmit","now","prevNorm","x","applySuggestion","opts","submit","handlePreviewProductClick","removeFilter","filter","clearAllFilters","removeFromHistory","queryToRemove","toggleCompareProduct","runCompareSearch","composed","applyRewrite","applyQuickFilterToken","normalized","formatPriceHu","getProductImage","isPersonalMatch","getTopBadge","handleCardMouseMove","event","rect","px","rx","ry","displayedTopProducts","historyGrouped","startOfToday","startTs","today","earlier","categoryCounter","keywordCounter","topKeywords","stored","history","Wand2","group","values","sug","BrainCircuit","step","RotateCcw","cp","Plus","QUICK_CARD_COLORS","QUICK_CATEGORY_LIMIT","MIN_QUICK_CATEGORY_PRODUCTS","CAROUSEL_SCROLL_DURATION","CAROUSEL_AUTO_INTERVAL","CAROUSEL_AUTO_STEP_FRACTION","smoothScrollTo","targetLeft","easeInOutCubic","eased","HERO_REVEAL_DELAY","ModernHero","onExplore","quickCategories","onQuickCategory","onHeroSearch","onHeroQuickView","heroVariant","setHeroVariant","storageKey","existing","assigned","heroCopy","statCardStyles","HERO_BG_IMAGE","mains","subcats","allItems","byName","quickCategoryItems","categoryCarouselRef","categoryCarouselPaused","setCategoryCarouselPaused","getCategoryScrollStep","container","gap","maxScroll","scrollCategoryCarousel","target","img","gradient","InteractiveCTA","onGetStarted","SimilarProducts","maxResults","similarProducts","setSimilarProducts","setIsLoading","aiReason","setAiReason","findBasicSimilar","findSimilarProducts","localSimilar","productContext","prompt","generateText","__vitePreload","combined","handleLike","handleDislike","RecentlyViewed","maxItems","recentProducts","setRecentProducts","recent","handleStorageChange","ProductComparison","comparisonList","onRemove","onAddMore","ArrowLeftRight","useComparison","setComparisonList","addToComparison","removeFromComparison","AdvancedFiltersPanel","onApply","showHeader","onCloseHeader","min","max","cap","effective","previousFiltersRef","hasRestorableFilters","setHasRestorableFilters","handlePriceChange","toggleCategory","clearFilters","restorePrevious","DollarSign","AdvancedFilters","initialFilters","materials","activeFilterCount","panelContent","applyFilters","QuickAddToCart","onAdd","isAdding","setIsAdding","showSuccess","setShowSuccess","handleQuickAdd","Loader2","Check","ProductQuickPeek","activeImage","setActiveImage","images","imageProps","Share2","ExternalLink","SmartNewsletterPopup","onSubscribe","isSubmitted","setIsSubmitted","setEmail","setError","timeOnSiteRef","scrollTriggeredRef","exitIntentRef","dismissed","subscribed","handleMouseLeave","CheckCircle","ExitIntentPopup","discountPercent","hasShown","setHasShown","countdown","setCountdown","hasShownRef","inactivityTimer","resetTimer","formatTime","seconds","mins","secs","Timer","ARProductPreview","isARAvailable","setIsARAvailable","checkARSupport","isSupported","isIOSSafari","ua","isIOS","isSafari","handleARLaunch","usdzUrl","generateMockUSDZ","anchor","launchWebXR","sessionEndHandlerRef","session","handler","openInARViewer","Smartphone","CompleteTheLook","onViewProduct","bundleItems","setBundleItems","selectedItems","setSelectedItems","bundleTitle","setBundleTitle","findComplementaryProducts","complementaryMap","searchTerms","complements","currentPrice","matches","pCat","term","fallbackProducts","toggleItem","selectedProducts","bundleOriginalPrice","bundleDiscount","bundleFinalPrice","savedAmount","handleAddBundle","isSelected","ImageGallery","currentIndex","setCurrentIndex","isZoomed","setIsZoomed","isFullscreen","setIsFullscreen","zoomPosition","setZoomPosition","touchStart","setTouchStart","mainImageRef","imageList","currentImage","goToNext","goToPrev","handleMouseMove","toggleZoom","touchEnd","ZoomIn","Maximize2","StickyAddToCart","observedElementId","isShownObserved","setIsShownObserved","addedToCart","setAddedToCart","setQuantity","scrollPast400","isShown","originalPrice","stockLevel","isLowStock","handleAddToCart","AlertTriangle","Shield","PriceAlert","targetPrice","setTargetPrice","isAlertSet","setIsAlertSet","suggestedPrice","alertData","removeAlert","BellRing","PriceAlertModal","onSubmit","TrendingDown","FadeInOnScroll","prefersReducedMotion","setPrefersReducedMotion","mq","getTransform","visible","Confetti","onComplete","particles","setParticles","newParticles","timeout","animationFrame","setHasStarted","timestamp","easeOut","BottomSheet","snapPoints","initialSnap","showHandle","showClose","currentSnap","setCurrentSnap","isDragging","setIsDragging","dragOffset","setDragOffset","touchStartY","setTouchStartY","sheetRef","contentRef","getSheetHeight","handleTouchMove","WishlistDrawer","wishlistItems","onClearAll","isClosing","setIsClosing","totalValue","handleShare","Trash2","FLASH_DISMISS_KEY","getTodayKey","FLASH_OFFERS","FlashSaleBanner","endTime","subtitle","onViewSale","onDismiss","timeLeft","setTimeLeft","calculateTimeLeft","offerIndex","setOfferIndex","isPaused","setIsPaused","currentOffer","displayTitle","displaySubtitle","displayCta","displayCtaShort","bgGradient","ctaColor","isDismissed","setIsDismissed","isExpired","setIsExpired","newTime","offerTimer","goToOffer","endX","handlePrev","handleNext","handleDismiss","pad","TOTAL_SALE_MS","remainingMs","timeLeftProgress","unit","DeliveryEstimator","postalCode","setPostalCode","isChecking","setIsChecking","deliveryInfo","setDeliveryInfo","calculateDelivery","code","isBudapest","isLargeCity","standardDays","expressDays","standardDate","expressDate","formatDate","date","days","months","defaultEstimate","minDate","maxDate","StockUrgency","viewingCount","setViewingCount","setRecentPurchases","lastPurchaseTime","setLastPurchaseTime","minutes","viewInterval","purchaseInterval","isVeryLowStock","isOutOfStock","ProductShare","showModal","setShowModal","copied","setCopied","shareUrl","shareTitle","shareText","handleNativeShare","handleCopyLink","shareLinks","ShareModal","link","Link2","onCopy","Copy","ProductTabs","expandedFaq","setExpandedFaq","tabs","FileText","Ruler","HelpCircle","specs","reviews","avgRating","r","faqItems","feature","spec","star","rating","review","PriceHistory","priceHistory","onSetAlert","alertSet","setAlertSet","validPrice","basePrice","month","variance","avg","previousPrice","priceChange","changePercent","isLowest","isHighest","chartHeight","chartWidth","chartPath","range","areaPath","handleSetAlert","getTrendIcon","Minus","getTrendColor","OneClickCheckout","savedAddress","savedPayment","userEmail","onCheckout","isProcessing","setIsProcessing","selectedPayment","setSelectedPayment","setStep","paymentMethods","CreditCard","Apple","handleCheckout","method","Lock","highlightMatch","re","parts","SmartSearchBar","indexVersion","shouldBuildIndex","maxLocalIndex","placeholder","selectedIndex","setSelectedIndex","indexStatus","setIndexStatus","inputRef","containerRef","debounceTimerRef","resultsRef","indexedCountRef","indexedVersionRef","canUseLocalIndex","localIndexDisabled","doBuild","intentKw","autocompleteSuggestions","searchResults","searchIntent","proactiveSuggestions","recentSearches","recentlyViewed","trendingSearches","viewedCategories","defaults","handleGlobalKeyDown","handleFocusSearch","handleInputChange","handleProductClickFn","fromSearchResults","full","handleSuggestionClick","suggestion","handleAutocompleteClickFn","clearQuery","handleProductClick","handleAutocompleteClick","allNavigableItems","totalItems","selected","renderIntentTags","tags","priceLabel","ArrowUpRight","actualIndex","History","search","ARMeasure","onConfirmFit","roomDimensions","setRoomDimensions","fitResult","setFitResult","productDimensions","handleDimensionChange","field","numValue","handleCheckFit","roomW","roomL","roomH","fitsWidth","fitsDepth","fitsHeight","spaceFit","tightFit","resetMeasurement","isFormValid","StickyAddToCartMobile","isInWishlist","isInCart","freeShippingThreshold","showQuantity","setShowQuantity","justAdded","setJustAdded","totalPrice","freeShippingRemaining","incrementQuantity","decrementQuantity","TrustBadges","Headphones","checkoutBadges","useLocalStorage","initialValue","storedValue","setStoredValue","valueToStore","useDebounce","debouncedValue","setDebouncedValue","DEFAULT_ROOT_MARGIN","DEFAULT_THRESHOLD","useDeferredSection","rootMargin","shouldMount","setShouldMount","io","DeferredSection","minHeight","WEBSHOP_DOMAIN","SHOP_ID","DISPLAY_BATCH","INITIAL_PAGE","TAB_HASH","HASH_TO_TAB","AIChatAssistant","AIRoomDesigner","AIStyleQuiz","AIModuleUnified","InspirationSection","ProductWorldsSection","NewsletterStrip","PersonalizedSection","LoyaltyProgram","MODAL_LOADING_FALLBACK","SCROLL_DELAY_INITIAL","SCROLL_DELAY_RETRY","SCROLL_DELAY_FINAL","SCROLL_THROTTLE_MS","SCROLL_RETRY_MAX","cleanUrl","Features","ProductModal","aiTip","setAiTip","loadingTip","setLoadingTip","generateStyleTip","param","VisualSearch","selectedImage","setSelectedImage","isAnalyzing","setIsAnalyzing","setSearchResults","analysisText","setAnalysisText","handleImageUpload","file","reader","analyzeImage","base64Image","base64Data","analyzeImageAI","analysis","relevant","RoomPlanner","background","setBackground","placedItems","setPlacedItems","selectedItemId","setSelectedItemId","handleBackgroundUpload","addItem","App","setActiveTabState","hash","newHash","setProducts","totalProductsCount","setTotalProductsCount","hasMoreProducts","setHasMoreProducts","isLoadingMore","setIsLoadingMore","filteredLengthRef","hasMoreProductsRef","isLoadingMoreRef","setWishlist","setWishlistItems","sectionRotateTick","setSectionRotateTick","searchQuery","setSearchQuery","searchQueryRef","SERVER_SEARCH_ONLY","MAX_LOCAL_INDEX","searchIndexRef","searchIndexReady","setSearchIndexReady","searchIndexVersion","setSearchIndexVersion","searchTotalMatches","setSearchTotalMatches","categoryFilter","setCategoryFilter","isDemoMode","setIsDemoMode","selectedProduct","setSelectedProduct","isChatOpen","setIsChatOpen","showAIOnboarding","setShowAIOnboarding","onboardingFeature","setOnboardingFeature","advancedFilters","setAdvancedFilters","setCategoryHierarchy","categoryStats","setCategoryStats","selectedCollection","setSelectedCollection","activeHierarchyCount","getCategoryMainList","showStyleQuiz","setShowStyleQuiz","showRoomDesigner","setShowRoomDesigner","aiRecommendedProducts","setAiRecommendedProducts","aiRecommendationLabel","setAiRecommendationLabel","showDeferredAI","setShowDeferredAI","quickPeekProduct","setQuickPeekProduct","showARPreview","setShowARPreview","arProduct","setArProduct","showARMeasure","setShowARMeasure","arMeasureProduct","setArMeasureProduct","showOneClickCheckout","setShowOneClickCheckout","oneClickProduct","setOneClickProduct","showConfetti","setShowConfetti","showFilterSheet","setShowFilterSheet","showExitIntent","setShowExitIntent","showWishlistDrawer","setShowWishlistDrawer","featuredPool","setFeaturedPool","featuredPoolKeyRef","flashSaleEndTime","isLoadingUnas","setIsLoadingUnas","unasError","setUnasError","lastUpdated","setLastUpdated","dataSource","setDataSource","comparison","handleProductView","trackProductViewPref","handleShowAIProducts","firstArg","secondArg","recommendedProducts","label","clickedProduct","allRecommended","clickedCat","sameCategory","clickedPrice","similarPrice","scheduleScrollToProductsRef","clearAIRecommendations","toggleWishlist","productUrl","fullUrl","serverSearchQuery","setServerSearchQuery","serverCategory","setServerCategory","loadUnasData","silent","categoryMain","append","categoryMainList","categoriesList","newProducts","requestScrollToProductsRef","handleServerSearch","hasUserSearchedRef","useLayoutEffect","scrollToHeader","t1","t2","isScrollable","insideApp","lastScrollToProductsRef","scrollToProductsSection","retryCount","run","elRect","parentRect","targetScrollTop","scrollToProductsSectionRef","scheduleScrollToProducts","handleCategoryChange","handleCollectionSelect","handleCollectionBack","loadUnasDataRef","canUseLocalSearch","debouncedSearch","cats","mainNames","leafNames","mainSegments","styleKw","deferProductsLoadRef","useApiSearch","isInitialState","shouldDefer","intentKeywords","onHashChange","extraTimeoutId","mergeInto","map","extraOffsets","o","batches","normalizedAdvancedFilters","mobileActiveFilterCount","filteredAndSortedProducts","collectionFilteredProducts","lower","isSearchMode","isSearchActive","sectionProducts","sectionContextLabel","featuredBase","headerCount","handleLoadMore","handleCollectionLoadMore","categoryCount","sorted","recentPurchasesForSocialProof","Suspense","meta","col","reward","catMain","recs","ErrorBoundary","errorInfo","Fallback","NAV_TO_PRODUCTS_WINDOW_MS","shouldSkipScrollToHeader","handleLoad","handlePageshow","rootEl","ReactDOM"],"ignoreList":[0,1,2],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/services/unasApi.js","../../src/services/unasCartService.js","../../src/services/userPreferencesService.js","../../src/components/ui/Skeleton.jsx","../../src/components/ui/Toast.jsx","../../src/components/ui/EmptyState.jsx","../../src/components/ui/Badge.jsx","../../src/components/ui/Icons.jsx","../../src/components/ai/AIShowcase.jsx","../../src/components/category/CategorySwipe.jsx","../../src/utils/helpers.js","../../src/utils/imageOptimizer.js","../../src/components/product/EnhancedProductCard.jsx","../../src/components/category/CategoryPage.jsx","../../src/components/collection/CollectionPage.jsx","../../src/components/category/MainCategoriesSection.jsx","../../src/hooks/useScrollPosition.js","../../src/hooks/useScrollLock.js","../../src/components/layout/Navbar.jsx","../../src/components/ux/ScrollProgress.jsx","../../src/components/ux/BackToTop.jsx","../../src/utils/motion-shim.jsx","../../src/components/ux/LiveSocialProof.jsx","../../src/components/ux/LiveActivityStrip.jsx","../../src/components/ui/CountUp.jsx","../../shared/searchSynonyms.js","../../src/services/aiSearchService.js","../../src/components/landing/HeroSmartSearch.jsx","../../src/utils/categoryImages.js","../../src/components/landing/ModernHero.jsx","../../src/components/landing/ShowcaseSections.jsx","../../src/components/product/SimilarProducts.jsx","../../src/components/product/RecentlyViewed.jsx","../../src/components/product/ProductComparison.jsx","../../src/components/product/AdvancedFilters.jsx","../../src/components/product/QuickAddToCart.jsx","../../src/components/product/ProductQuickPeek.jsx","../../src/components/marketing/SmartNewsletterPopup.jsx","../../src/components/marketing/ExitIntentPopup.jsx","../../src/components/ar/ARProductPreview.jsx","../../src/components/product/CompleteTheLook.jsx","../../src/components/product/ImageGallery.jsx","../../src/components/product/StickyAddToCart.jsx","../../src/components/product/PriceAlert.jsx","../../src/components/ui/Animations.jsx","../../src/components/mobile/BottomSheet.jsx","../../src/components/wishlist/WishlistDrawer.jsx","../../src/components/marketing/FlashSaleBanner.jsx","../../src/components/product/DeliveryEstimator.jsx","../../src/components/product/StockUrgency.jsx","../../src/components/product/ProductShare.jsx","../../src/components/product/ProductTabs.jsx","../../src/components/product/PriceHistory.jsx","../../src/components/checkout/OneClickCheckout.jsx","../../src/components/search/SmartSearchBar.jsx","../../src/components/ar/ARMeasure.jsx","../../src/components/mobile/StickyAddToCartMobile.jsx","../../src/components/trust/TrustBadges.jsx","../../src/hooks/index.js","../../src/hooks/useDeferredSection.jsx","../../src/config.js","../../src/App.jsx","../../src/components/ui/ErrorBoundary.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * UNAS API Service\n * API-first, kis lapmret: soha ne tltsnk 200k termket memriba.\n * Cl: 3 mp alatt interaktv, alacsony memria.\n */\n\nconst getApiBase = () => {\n  let base = '';\n  if (typeof window !== 'undefined' && window.MARKETLY_CONFIG?.apiBase) {\n    base = window.MARKETLY_CONFIG.apiBase;\n  } else {\n    base = import.meta.env.VITE_API_URL || 'http://localhost:3002';\n  }\n  base = (base || '').replace(/\\/+$/, '');\n  if (base && !base.endsWith('/api')) base = base + '/api';\n  return base;\n};\n\nconst getBackendOrigin = () => {\n  const api = getApiBase();\n  return api ? api.replace(/\\/api\\/?$/, '') : '';\n};\n\n/** Els lap mrete (gyors first paint) */\nconst DEFAULT_LIMIT = 200;\n\n/**\n * Termkek betltse  MINDIG API, limit/offset.\n * Nincs teljes katalgus a kliensen; lapozs s keress szerveren.\n */\nexport const fetchUnasProducts = async (filters = {}) => {\n  if (typeof window === 'undefined') return { products: [], total: 0, count: 0, lastSync: null, source: 'api' };\n\n  const limit = filters.limit != null ? Number(filters.limit) : DEFAULT_LIMIT;\n  const offset = filters.offset != null ? Number(filters.offset) : 0;\n\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    params.set('limit', String(limit));\n    params.set('offset', String(offset));\n    if (filters.slim !== undefined) {\n      params.set('slim', filters.slim ? 'true' : 'false');\n    }\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categories && Array.isArray(filters.categories) && filters.categories.length > 0) {\n      params.set('categories', filters.categories.filter(Boolean).join(','));\n    } else if (filters.categories && typeof filters.categories === 'string' && filters.categories.trim()) {\n      params.set('categories', filters.categories.trim());\n    }\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.styleKeywords && Array.isArray(filters.styleKeywords) && filters.styleKeywords.length > 0) {\n      params.set('styleKeywords', filters.styleKeywords.filter(Boolean).join(','));\n    }\n    if (filters.minPrice != null && Number.isFinite(filters.minPrice)) params.set('minPrice', String(Math.floor(filters.minPrice)));\n    if (filters.maxPrice != null && Number.isFinite(filters.maxPrice)) params.set('maxPrice', String(Math.floor(filters.maxPrice)));\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n\n    const url = `${API_BASE}/products?${params.toString()}`;\n    const res = await fetch(url, { method: 'GET' });\n\n    if (!res.ok) {\n      return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: res.status };\n    }\n\n    const data = await res.json();\n    const products = (data.products || []).map(p => ({\n      ...p,\n      images: p.images || (p.image ? [p.image] : []),\n      image: p.images?.[0] || p.image,\n      inStock: p.inStock !== undefined ? p.inStock : Boolean(p.in_stock)\n    }));\n\n    return {\n      products,\n      total: data.total ?? products.length,\n      count: products.length,\n      lastSync: data.lastSync ?? null,\n      source: 'api'\n    };\n  } catch (error) {\n    return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: error.message };\n  }\n};\n\n/**\n * Fetch categories from backend\n */\nexport const fetchCategories = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories`);\n    if (!res.ok) return ['sszes'];\n    const data = await res.json();\n    // Backend returns category objects, extract just the names\n    const categoryNames = (data.categories || [])\n      .map(cat => typeof cat === 'string' ? cat : cat.name)\n      .filter(Boolean)\n      .sort();\n    return ['sszes', ...categoryNames];\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    return ['sszes'];\n  }\n};\n\n/**\n * Keresindex: minden termk minimlis adattal (gyors, gzip-pel kisebb).\n * A keres ezen fut; frissts = jra letlti (kszlet napraksz).\n * @param {Object} opts - { minimal: true }  search-index-minimal (~515 MB, csak id/name/category/price/image/inStock)\n */\nexport const fetchSearchIndex = async (opts = {}) => {\n  try {\n    const API_BASE = getApiBase();\n    const url = opts.minimal\n      ? `${API_BASE}/products/search-index-minimal`\n      : `${API_BASE}/products/search-index`;\n    const res = await fetch(url);\n    if (!res.ok) return { products: [], lastSync: null };\n    const data = await res.json();\n    if (Array.isArray(data)) return { products: data, lastSync: null };\n    return {\n      products: Array.isArray(data.products) ? data.products : [],\n      lastSync: data.lastSync || null\n    };\n  } catch (error) {\n    return { products: [], lastSync: null };\n  }\n};\n\n/**\n * Fetch category hierarchy (main + children) for navbar/mobile menu\n * Returns { mainCategories: [ { name, productCount, children: [ { name, productCount } ] } ] }\n */\nexport const fetchCategoryHierarchy = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories/hierarchy`);\n    if (!res.ok) return { mainCategories: [] };\n    const data = await res.json();\n    return { mainCategories: Array.isArray(data.mainCategories) ? data.mainCategories : [] };\n  } catch (error) {\n    console.error('Error fetching category hierarchy:', error);\n    return { mainCategories: [] };\n  }\n};\n\n/**\n * Fetch single product by ID (full detail)\n */\nexport const fetchUnasProductById = async (id) => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/products/${id}`);\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      ...data,\n      images: data.images || (data.image ? [data.image] : []),\n      image: data.images?.[0] || data.image,\n      inStock: data.inStock !== undefined ? data.inStock : Boolean(data.in_stock)\n    };\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Product stats (counts + price range + in stock)\n */\nexport const fetchProductStats = async (filters = {}) => {\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n    const res = await fetch(`${API_BASE}/products/stats?${params.toString()}`);\n    if (!res.ok) return null;\n    return await res.json();\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Force refresh products from UNAS (trigger sync)\n */\nexport const refreshUnasProducts = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.message || `HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return {\n      success: data.success,\n      fetched: data.fetched,\n      added: data.added,\n      updated: data.updated\n    };\n  } catch (error) {\n    console.error('Error refreshing UNAS products:', error);\n    throw new Error(`Failed to refresh products: ${error.message}`);\n  }\n};\n\n/**\n * Get cache information from backend\n */\nexport const getCacheInfo = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /stats, not /api/stats\n    const response = await fetch(`${API_BASE}/stats`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching stats:', error);\n    throw new Error(`Failed to fetch stats: ${error.message}`);\n  }\n};\n\n/**\n * Clear backend cache (trigger manual sync)\n */\nexport const clearCache = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error triggering sync:', error);\n    throw new Error(`Failed to trigger sync: ${error.message}`);\n  }\n};\n\n/**\n * Backend health (GET /health a gykrn, nem /api alatt)\n */\nexport const checkBackendHealth = async () => {\n  try {\n    const origin = getBackendOrigin();\n    const response = await fetch(`${origin}/health`, { method: 'GET' });\n    if (!response.ok) return { status: 'error', message: `HTTP ${response.status}` };\n    return await response.json();\n  } catch (error) {\n    return { status: 'error', message: error.message };\n  }\n};\n","/**\n * UNAS Cart Service  kosrhoz ads (cart_add)\n * A widget UNAS oldalon fut, a termkek a f UNAS kosrba kerlnek.\n *\n * cart_add(productId, prefix, null, quantity)  termk oldalon 4 paramter\n * A cart_add a mennyisg inputot keresi: id=\"db_{prefix}{productId}\" vagy id=\"db_{productId}\"\n */\n\n/** Kategria/kollekci oldalon az UNAS artlist_ prefixet vrja (db_artlist_{productId}) */\nfunction getCartAddPrefix() {\n  if (typeof window === 'undefined') return '';\n  try {\n    const path = (window.location?.pathname || '') + (window.top?.location?.pathname || '');\n    if (/\\/sct\\//.test(path)) return 'artlist_';\n  } catch (_) { /* cross-origin */ }\n  return '';\n}\n\n/** Kinyeri a VX-XXXXX formtum SKU-t linkbl vagy kpek URL-jbl (UNAS variant ref) */\nfunction extractVxSku(product) {\n  const link = (product?.link || product?.url || '').trim();\n  const m1 = link.match(/(VX-\\d+)/i);\n  if (m1) return m1[1];\n  const imgs = product?.images || (product?.image ? [product.image] : []);\n  const firstImg = Array.isArray(imgs) ? imgs[0] : imgs;\n  const imgUrl = typeof firstImg === 'string' ? firstImg : firstImg?.url || firstImg?.src || '';\n  const m2 = String(imgUrl).match(/(VX-\\d+)/i);\n  if (m2) return m2[1];\n  return null;\n}\n\n/**\n * UNAS termk ID formtum: VX__unas__{id}\n * Az UNAS add_to_favourites: cikk.replace(/-/g,'__unas__')  pl. VX-274769  VX__unas__274769\n * Preferlja: unas_ref (VX-xxx), sku, link/kpbl kinyert VX-xxx, unas_id, id.\n */\nfunction toUnasProductId(product) {\n  if (!product) return null;\n  // 1) unas_ref / sku  gyakran VX-274769 formtum\n  let raw = product?.unas_ref ?? product?.sku ?? extractVxSku(product);\n  if (raw) {\n    const s = String(raw).trim();\n    if (s && !s.startsWith('unas-prod-')) {\n      if (s.includes('-')) return s.replace(/-/g, '__unas__');\n      if (s.startsWith('VX__unas__')) return s;\n      return `VX__unas__${s}`;\n    }\n  }\n  // 2) unas_id / id  numerikus\n  const id = product?.unas_id ?? product?.id;\n  if (!id) return null;\n  const str = String(id).trim();\n  if (str.startsWith('unas-prod-') || str === '') return null;\n  if (str.startsWith('VX__unas__')) return str;\n  return `VX__unas__${str}`;\n}\n\n/**\n * cart_add s a hozz tartoz window  lehet iframe-ben, parent vagy top window-ban.\n * Fontos: az inputot UGYANABBA a documentba kell tenni, ahol a cart_add fut (pl. parent),\n * mert a cart_add document.getElementById()-ot hasznl a sajt documentjn.\n */\nfunction getCartAddContext() {\n  if (typeof window === 'undefined') return null;\n  const wins = [window, window.parent, window.top].filter(Boolean);\n  for (const w of wins) {\n    try {\n      if (typeof w.cart_add === 'function') return { cartAdd: w.cart_add, win: w };\n    } catch (_) { /* cross-origin */ }\n  }\n  return null;\n}\n\nfunction getCartAdd() {\n  const ctx = getCartAddContext();\n  return ctx ? ctx.cartAdd : null;\n}\n\n/**\n * UNAS form keresse  kosr/termk form, ahova az input kerlhet\n */\nfunction findUnasForm(doc) {\n  if (!doc) return null;\n  const selectors = [\n    'form[action*=\"cart\"]',\n    'form[id*=\"cart\"]',\n    'form[name*=\"cart\"]',\n    'form[action*=\"kosar\"]',\n    'form#product_form',\n    'form.product-form'\n  ];\n  for (const sel of selectors) {\n    try {\n      const form = doc.querySelector(sel);\n      if (form) return form;\n    } catch (_) { /* invalid selector */ }\n  }\n  return null;\n}\n\n/**\n * Mennyisg input ltrehozsa  a cart_add UGYANABBAN a documentban keresi!\n * Ha iframe-ben futunk, a cart_add a parent/top-ban van  az inputot is oda kell tenni.\n * Ltrehozunk db_{unasId} s db_{numericId} inputot is  UNAS klnbz sablonokban eltr formtumot vr.\n */\nfunction ensureQtyInput(unasId, qty, targetDoc) {\n  if (!targetDoc) return null;\n  const numericId = unasId.replace(/^VX__unas__/, '');\n  const ids = [`db_${unasId}`];\n  if (numericId && numericId !== unasId) ids.push(`db_${numericId}`);\n  let input = null;\n  for (const inputId of ids) {\n    input = targetDoc.getElementById(inputId);\n    if (input) break;\n  }\n  if (!input) {\n    input = targetDoc.createElement('input');\n    input.type = 'number';\n    input.name = 'db';\n    input.id = ids[0];\n    input.value = String(qty);\n    input.setAttribute('data-min', '1');\n    input.setAttribute('data-max', '999999');\n    input.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n    const form = findUnasForm(targetDoc);\n    (form || targetDoc.body).appendChild(input);\n    // Fallback: numeric id input (ha UNAS ezt keresi)\n    if (ids.length > 1) {\n      const input2 = targetDoc.createElement('input');\n      input2.type = 'number';\n      input2.name = 'db';\n      input2.id = ids[1];\n      input2.value = String(qty);\n      input2.setAttribute('data-min', '1');\n      input2.setAttribute('data-max', '999999');\n      input2.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n      (form || targetDoc.body).appendChild(input2);\n    }\n  } else {\n    for (const id of ids) {\n      const el = targetDoc.getElementById(id);\n      if (el) el.value = String(qty);\n    }\n  }\n  return input;\n}\n\n/**\n * Kosrhoz ads az UNAS kosrba (ha window.cart_add elrhet).\n * @param {object} product - termk objektum (id, unas_id)\n * @param {number} quantity - mennyisg\n * @returns {boolean} - true ha sikeres, false ha nem elrhet vagy hiba\n */\nexport function addToUnasCart(product, quantity = 1) {\n  if (typeof window === 'undefined') return false;\n  const ctx = getCartAddContext();\n  if (!ctx || typeof ctx.cartAdd !== 'function') return false;\n\n  const unasId = toUnasProductId(product);\n  if (!unasId) return false;\n\n  const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n  try {\n    // Mennyisg input  a cart_add UGYANABBAN a documentban keresi (pl. parent/top)\n    let targetDoc;\n    try {\n      targetDoc = ctx.win.document;\n    } catch (_) {\n      targetDoc = typeof document !== 'undefined' ? document : null;\n    }\n    if (!targetDoc) return false;\n    ensureQtyInput(unasId, qty, targetDoc);\n    // 4 paramter: productId, prefix ('' = termk oldal), null, quantity\n    ctx.cartAdd(unasId, getCartAddPrefix(), null, qty);\n    if (window.__MARKETLY_DEBUG) {\n      console.log('[unasCartService] cart_add called:', { unasId, qty }, ` cart_add('${unasId}','',null,${qty})`);\n    }\n    return true;\n  } catch (err) {\n    if (window.__MARKETLY_DEBUG || process.env.NODE_ENV === 'development') {\n      console.warn('[unasCartService] cart_add error:', err);\n    }\n    return false;\n  }\n}\n","/**\n * User Preferences Service\n * Kzponti szolgltats a felhasznli viselkeds s preferencik kvetsre\n * localStorage-ban trolja az adatokat\n */\n\nconst STORAGE_KEYS = {\n  VIEWED_PRODUCTS: 'mkt_viewed_products',\n  LIKED_PRODUCTS: 'mkt_liked_products',\n  DISLIKED_PRODUCTS: 'mkt_disliked_products',\n  SEARCH_HISTORY: 'mkt_search_history',\n  SEARCH_CLICKS: 'mkt_search_clicks',\n  STYLE_DNA: 'mkt_style_dna',\n  AI_FEEDBACK: 'mkt_ai_feedback',\n  CHAT_CONTEXT: 'mkt_chat_context',\n  USER_PREFERENCES: 'mkt_user_preferences',\n  RECO_TWEAKS: 'mkt_reco_tweaks',\n  RECO_WEIGHTS: 'mkt_reco_weights',\n  RECO_SIGNALS: 'mkt_reco_signals',\n  AB_TESTS: 'mkt_ab_tests',\n  BACK_IN_STOCK: 'mkt_back_in_stock',\n  SECTION_EVENTS: 'mkt_section_events',\n};\n\nconst MAX_ITEMS = {\n  VIEWED: 50,\n  LIKED: 100,\n  SEARCHES: 20,\n  SEARCH_CLICKS: 500,\n  FEEDBACK: 100,\n};\n\nconst MAX_BACK_IN_STOCK = 100;\n\nconst DEFAULT_RECO_TWEAKS = {\n  avoidStyles: [],\n  avoidRooms: [],\n};\n\nconst DEFAULT_RECO_WEIGHTS = {\n  likeBoost: 20,\n  viewPenalty: 8,\n  dislikePenalty: 50,\n  categoryBoost: 20,\n  styleBoost: 12,\n  roomBoost: 10,\n  stockBoost: 6,\n  priceFit: 8,\n  signalCategoryBoost: 4,\n  signalKeywordBoost: 2,\n};\n\nconst getJSONSafe = (key, fallback) => {\n  try {\n    const raw = localStorage.getItem(key);\n    return raw ? JSON.parse(raw) : fallback;\n  } catch {\n    return fallback;\n  }\n};\n\n// ==================== VIEWED PRODUCTS ====================\n\n/**\n * Termk megtekintsnek rgztse\n */\nexport function trackProductView(product) {\n  if (!product?.id) return;\n  \n  const viewed = getViewedProducts();\n  \n  // Eltvoltjuk ha mr volt, s az elejre tesszk\n  const filtered = viewed.filter(p => p.id !== product.id);\n  \n  const productData = {\n    id: product.id,\n    name: product.name,\n    price: product.salePrice || product.price,\n    category: product.category,\n    image: product.images?.[0] || product.image,\n    viewedAt: Date.now(),\n  };\n  \n  const updated = [productData, ...filtered].slice(0, MAX_ITEMS.VIEWED);\n  \n  try {\n    localStorage.setItem(STORAGE_KEYS.VIEWED_PRODUCTS, JSON.stringify(updated));\n  } catch (e) {\n    console.warn('Failed to save viewed products:', e);\n  }\n  \n  // Preferencik frisstse a kategria alapjn\n  updateCategoryPreference(product.category);\n}\n\n/**\n * Megtekintett termkek lekrdezse\n */\nexport function getViewedProducts(limit = 20) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.VIEWED_PRODUCTS);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * Legutbbi megtekintett termk ID-k\n */\nexport function getRecentlyViewedIds(limit = 10) {\n  return getViewedProducts(limit).map(p => p.id);\n}\n\n// ==================== LIKED/DISLIKED PRODUCTS ====================\n\n/**\n * Termk kedvelse\n */\nexport function likeProduct(productId) {\n  if (!productId) return;\n  \n  const liked = getLikedProducts();\n  if (!liked.includes(productId)) {\n    const updated = [productId, ...liked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a disliked-bl\n  const disliked = getDislikedProducts();\n  if (disliked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.DISLIKED_PRODUCTS, \n      JSON.stringify(disliked.filter(id => id !== productId))\n    );\n  }\n}\n\n/**\n * Termk elutastsa\n */\nexport function dislikeProduct(productId) {\n  if (!productId) return;\n  \n  const disliked = getDislikedProducts();\n  if (!disliked.includes(productId)) {\n    const updated = [productId, ...disliked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a liked-bl\n  const liked = getLikedProducts();\n  if (liked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.LIKED_PRODUCTS, \n      JSON.stringify(liked.filter(id => id !== productId))\n    );\n  }\n}\n\nconst SIGNAL_LIMITS = { min: -6, max: 12 };\n\nconst stopWords = new Set([\n  's', 'vagy', 'hogy', 'egy', 'egyik', 'mely', 'ami', 'az', 'a', 'de', 'is',\n  'val', 'valamint', 's', 's', 'the', 'for', 'with'\n]);\n\nconst clampSignal = (value) => Math.max(SIGNAL_LIMITS.min, Math.min(SIGNAL_LIMITS.max, value));\n\nconst extractSignalTokens = (product) => {\n  const categories = String(product?.category || '')\n    .split('>')\n    .map((c) => c.trim().toLowerCase())\n    .filter(Boolean);\n  const text = `${product?.name || ''} ${product?.category || ''}`.toLowerCase();\n  const keywords = text\n    .split(/[\\s,\\-\\/]+/)\n    .map((w) => w.trim())\n    .filter((w) => w.length > 3 && !stopWords.has(w))\n    .slice(0, 12);\n  return { categories, keywords };\n};\n\nexport function getPreferenceSignals() {\n  return getJSONSafe(STORAGE_KEYS.RECO_SIGNALS, { categories: {}, keywords: {} });\n}\n\nconst savePreferenceSignals = (signals) => {\n  try {\n    localStorage.setItem(STORAGE_KEYS.RECO_SIGNALS, JSON.stringify(signals));\n  } catch {}\n};\n\nconst updatePreferenceSignals = (product, delta) => {\n  if (!product?.id) return;\n  const signals = getPreferenceSignals();\n  const { categories, keywords } = extractSignalTokens(product);\n  categories.forEach((cat) => {\n    const next = clampSignal((signals.categories?.[cat] || 0) + delta);\n    signals.categories = signals.categories || {};\n    signals.categories[cat] = next;\n  });\n  keywords.forEach((kw) => {\n    const next = clampSignal((signals.keywords?.[kw] || 0) + delta);\n    signals.keywords = signals.keywords || {};\n    signals.keywords[kw] = next;\n  });\n  savePreferenceSignals(signals);\n};\n\nexport function likeProductWithSignals(product) {\n  if (!product?.id) return;\n  likeProduct(product.id);\n  updatePreferenceSignals(product, 2);\n}\n\nexport function dislikeProductWithSignals(product) {\n  if (!product?.id) return;\n  dislikeProduct(product.id);\n  updatePreferenceSignals(product, -3);\n}\n\nexport function toggleLikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n    return { liked: false, disliked: false };\n  }\n\n  const nextLiked = [product.id, ...liked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(nextLiked));\n  updatePreferenceSignals(product, 2);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n  }\n  return { liked: true, disliked: false };\n}\n\nexport function toggleDislikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n    return { liked: false, disliked: false };\n  }\n\n  const nextDisliked = [product.id, ...disliked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(nextDisliked));\n  updatePreferenceSignals(product, -3);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n  }\n  return { liked: false, disliked: true };\n}\n\nexport function getLikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function getDislikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.DISLIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function isProductLiked(productId) {\n  return getLikedProducts().includes(productId);\n}\n\nexport function isProductDisliked(productId) {\n  return getDislikedProducts().includes(productId);\n}\n\n// ==================== BACK IN STOCK REQUESTS ====================\n\nexport function requestBackInStock(product) {\n  if (!product?.id) return;\n  const list = getBackInStockRequests();\n  const filtered = list.filter((p) => p.id !== product.id);\n  const next = [\n    {\n      id: product.id,\n      name: product.name,\n      image: product.images?.[0] || product.image,\n      requestedAt: Date.now()\n    },\n    ...filtered\n  ].slice(0, MAX_BACK_IN_STOCK);\n  try {\n    localStorage.setItem(STORAGE_KEYS.BACK_IN_STOCK, JSON.stringify(next));\n  } catch (e) {\n    console.warn('Failed to save back-in-stock request:', e);\n  }\n}\n\nexport function getBackInStockRequests(limit = 50) {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEYS.BACK_IN_STOCK);\n    const list = raw ? JSON.parse(raw) : [];\n    return limit ? list.slice(0, limit) : list;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== SECTION EVENTS (CTR) ====================\n\nexport function trackSectionEvent(sectionId, type = 'impression', productId = null) {\n  if (!sectionId) return;\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  const entry = data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n  if (type === 'click') entry.clicks += 1;\n  else entry.impressions += 1;\n  entry.lastEventAt = Date.now();\n  if (productId) {\n    entry.products[productId] = (entry.products[productId] || 0) + 1;\n  }\n  data[sectionId] = entry;\n  try {\n    localStorage.setItem(STORAGE_KEYS.SECTION_EVENTS, JSON.stringify(data));\n  } catch {}\n}\n\nexport function getSectionStats(sectionId) {\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  return data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n}\n\n// ==================== SEARCH HISTORY ====================\n\n/**\n * Keress rgztse\n */\nexport function trackSearch(query) {\n  if (!query || query.length < 2) return;\n  \n  const searches = getSearchHistory();\n  const filtered = searches.filter(s => s.query.toLowerCase() !== query.toLowerCase());\n  \n  const updated = [\n    { query, timestamp: Date.now() },\n    ...filtered\n  ].slice(0, MAX_ITEMS.SEARCHES);\n  \n  localStorage.setItem(STORAGE_KEYS.SEARCH_HISTORY, JSON.stringify(updated));\n}\n\nexport function getSearchHistory(limit = 10) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.SEARCH_HISTORY);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n// ==================== SEARCH CLICKS (tanuls) ====================\n\nfunction normalizeSearchQuery(str) {\n  if (!str) return '';\n  return String(str).toLowerCase()\n    .replace(//g, 'o').replace(//g, 'u').replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u').replace(//g, 'a').replace(//g, 'e').replace(//g, 'i')\n    .replace(/[^a-z0-9]/g, ' ').replace(/\\s+/g, ' ').trim();\n}\n\nfunction getSearchQueryWords(str) {\n  return normalizeSearchQuery(str).split(' ').filter(w => w.length >= 2);\n}\n\nexport function trackSearchClick(query, productId, position = 0) {\n  if (!query || !productId) return;\n  const queryNorm = normalizeSearchQuery(query);\n  if (!queryNorm) return;\n  const clicks = getJSONSafe(STORAGE_KEYS.SEARCH_CLICKS, []);\n  const updated = [{ queryNorm, productId, position, timestamp: Date.now() }, ...clicks].slice(0, MAX_ITEMS.SEARCH_CLICKS);\n  try { localStorage.setItem(STORAGE_KEYS.SEARCH_CLICKS, JSON.stringify(updated)); } catch (e) { console.warn('Failed to save search click:', e); }\n}\n\nexport function getSearchClickBoosts(query) {\n  const boosts = {};\n  if (!query || query.length < 2) return boosts;\n  const queryNorm = normalizeSearchQuery(query);\n  const queryWords = getSearchQueryWords(query);\n  if (!queryNorm || queryWords.length === 0) return boosts;\n  const clicks = getJSONSafe(STORAGE_KEYS.SEARCH_CLICKS, []);\n  for (const c of clicks) {\n    if (!c?.productId || !c?.queryNorm) continue;\n    const storedWords = getSearchQueryWords(c.queryNorm);\n    const isExact = c.queryNorm === queryNorm;\n    const hasOverlap = storedWords.some(w => queryWords.includes(w)) || queryWords.some(w => storedWords.includes(w));\n    if (isExact) boosts[c.productId] = Math.max(boosts[c.productId] || 0, 15);\n    else if (hasOverlap) boosts[c.productId] = Math.max(boosts[c.productId] || 0, 5);\n  }\n  return boosts;\n}\n\n// ==================== STYLE DNA (Quiz Results) ====================\n\n/**\n * Style DNA mentse a quiz eredmnybl\n */\nexport function saveStyleDNA(quizAnswers, styleDNAText) {\n  const data = {\n    answers: quizAnswers,\n    styleDNA: styleDNAText,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.STYLE_DNA, JSON.stringify(data));\n}\n\nexport function getStyleDNA() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.STYLE_DNA);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== AI FEEDBACK ====================\n\n/**\n * AI vlasz visszajelzsnek rgztse\n */\nexport function trackAIFeedback(messageId, isPositive, context = {}) {\n  const feedback = getAIFeedback();\n  \n  const updated = [\n    {\n      messageId,\n      isPositive,\n      context,\n      timestamp: Date.now(),\n    },\n    ...feedback\n  ].slice(0, MAX_ITEMS.FEEDBACK);\n  \n  localStorage.setItem(STORAGE_KEYS.AI_FEEDBACK, JSON.stringify(updated));\n}\n\nexport function getAIFeedback() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.AI_FEEDBACK);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * AI feedback statisztikk\n */\nexport function getAIFeedbackStats() {\n  const feedback = getAIFeedback();\n  const positive = feedback.filter(f => f.isPositive).length;\n  const negative = feedback.filter(f => !f.isPositive).length;\n  \n  return {\n    total: feedback.length,\n    positive,\n    negative,\n    satisfactionRate: feedback.length > 0 ? (positive / feedback.length * 100).toFixed(1) : 0,\n  };\n}\n\n// ==================== CHAT CONTEXT ====================\n\n/**\n * Chat kontextus mentse (elz beszlgetsek sszefoglalja)\n */\nexport function saveChatContext(summary) {\n  const context = {\n    summary,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.CHAT_CONTEXT, JSON.stringify(context));\n}\n\nexport function getChatContext() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.CHAT_CONTEXT);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== USER PREFERENCES ====================\n\n/**\n * Kategria preferencia frisstse\n */\nfunction updateCategoryPreference(category) {\n  if (!category) return;\n  \n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  categories[category] = (categories[category] || 0) + 1;\n  \n  prefs.categoryInterests = categories;\n  prefs.lastUpdated = Date.now();\n  \n  localStorage.setItem(STORAGE_KEYS.USER_PREFERENCES, JSON.stringify(prefs));\n}\n\nexport function getUserPreferences() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.USER_PREFERENCES);\n    return data ? JSON.parse(data) : { categoryInterests: {} };\n  } catch (e) {\n    return { categoryInterests: {} };\n  }\n}\n\nexport function getRecommendationTweaks() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_TWEAKS, DEFAULT_RECO_TWEAKS);\n  return { ...DEFAULT_RECO_TWEAKS, ...data };\n}\n\nexport function setRecommendationTweaks(next) {\n  const current = getRecommendationTweaks();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function resetRecommendationTweaks() {\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(DEFAULT_RECO_TWEAKS));\n  return DEFAULT_RECO_TWEAKS;\n}\n\nexport function getRecommendationWeights() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_WEIGHTS, DEFAULT_RECO_WEIGHTS);\n  return { ...DEFAULT_RECO_WEIGHTS, ...data };\n}\n\nexport function setRecommendationWeights(next) {\n  const current = getRecommendationWeights();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_WEIGHTS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function getABVariant(testId) {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (tests[testId]?.variant) return tests[testId].variant;\n  const variant = Math.random() < 0.5 ? 'A' : 'B';\n  tests[testId] = { variant, impressions: 0, clicks: 0 };\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return variant;\n}\n\nexport function trackABEvent(testId, type = 'impression') {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (!tests[testId]) {\n    tests[testId] = { variant: getABVariant(testId), impressions: 0, clicks: 0 };\n  }\n  if (type === 'click') tests[testId].clicks += 1;\n  else tests[testId].impressions += 1;\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return tests[testId];\n}\n\n/**\n * Top kategrik a felhasznli rdeklds alapjn\n */\nexport function getTopCategories(limit = 5) {\n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  return Object.entries(categories)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, limit)\n    .map(([name]) => name);\n}\n\n// ==================== PERSONALIZED CONTEXT FOR AI ====================\n\n/**\n * Szemlyre szabott kontextus generlsa az AI szmra\n */\nexport function getPersonalizedContext() {\n  const viewedProducts = getViewedProducts(5);\n  const likedProducts = getLikedProducts();\n  const topCategories = getTopCategories(3);\n  const styleDNA = getStyleDNA();\n  const searchHistory = getSearchHistory(5);\n  \n  let context = '';\n  \n  if (styleDNA?.styleDNA) {\n    context += `A felhasznl stlus profilja: ${styleDNA.styleDNA}\\n`;\n  }\n  \n  if (topCategories.length > 0) {\n    context += `Kedvelt kategrik: ${topCategories.join(', ')}\\n`;\n  }\n  \n  if (viewedProducts.length > 0) {\n    context += `Nemrg nzett termkek: ${viewedProducts.map(p => p.name).join(', ')}\\n`;\n  }\n  \n  if (searchHistory.length > 0) {\n    context += `Korbbi keressek: ${searchHistory.map(s => s.query).join(', ')}\\n`;\n  }\n  \n  if (likedProducts.length > 0) {\n    context += `Kedvelt termkek szma: ${likedProducts.length}\\n`;\n  }\n  \n  return context || 'j felhasznl, nincs elzmny.';\n}\n\n/**\n * Szemlyre szabott termk ajnlsok\n * Figyelembe veszi: megtekintett, kedvelt, kategria preferencik\n */\nexport function getPersonalizedRecommendations(allProducts, limit = 12) {\n  if (!allProducts || allProducts.length === 0) return [];\n  \n  const viewedIds = getRecentlyViewedIds();\n  const likedIds = getLikedProducts();\n  const dislikedIds = getDislikedProducts();\n  const signals = getPreferenceSignals();\n  const topCategories = getTopCategories(5);\n  const styleDNA = getStyleDNA();\n  const tweaks = getRecommendationTweaks();\n  const weights = getRecommendationWeights();\n  const viewedProducts = getViewedProducts(20);\n  const avgPriceBase = viewedProducts.length > 0 ? viewedProducts : [];\n  const avgPrice = avgPriceBase.length > 0\n    ? avgPriceBase.reduce((sum, p) => sum + (p.price || 0), 0) / avgPriceBase.length\n    : null;\n  \n  // Pontozzuk a termkeket\n  const scored = allProducts.map(product => {\n    let score = 0;\n    const price = product.salePrice || product.price || 0;\n    \n    // Ne ajnljunk olyat, amit mr nzett vagy nem kedvelt\n    if (viewedIds.includes(product.id)) score -= weights.viewPenalty;\n    if (dislikedIds.includes(product.id)) score -= weights.dislikePenalty;\n    if (likedIds.includes(product.id)) score += weights.likeBoost;\n    \n    // Kategria preferencia\n    const productCategory = product.category || '';\n    topCategories.forEach((cat, index) => {\n      if (productCategory.toLowerCase().includes(cat.toLowerCase())) {\n        score += (5 - index) * weights.categoryBoost * 0.2;\n      }\n    });\n\n    const categoryParts = productCategory\n      .split('>')\n      .map((c) => c.trim().toLowerCase())\n      .filter(Boolean);\n    categoryParts.forEach((cat) => {\n      const signal = signals.categories?.[cat];\n      if (signal) score += signal * weights.signalCategoryBoost;\n    });\n\n    const text = `${product.name || ''} ${product.category || ''}`.toLowerCase();\n    const words = text\n      .split(/[\\s,\\-\\/]+/)\n      .map((w) => w.trim())\n      .filter((w) => w.length > 3 && !stopWords.has(w))\n      .slice(0, 12);\n    words.forEach((kw) => {\n      const signal = signals.keywords?.[kw];\n      if (signal) score += signal * weights.signalKeywordBoost;\n    });\n    \n    // Style DNA alap pontozs\n    if (styleDNA?.answers) {\n      const { space, colors, budget, priority, room } = styleDNA.answers;\n      const productText = `${product.name} ${product.category} ${product.description || ''}`.toLowerCase();\n      \n      // Stlus\n      const styleKeywords = {\n        modern: ['modern', 'minimalista', 'letisztult'],\n        scandinavian: ['skandinv', 'natr', 'vilgos', 'fehr'],\n        industrial: ['indusztrilis', 'loft', 'fm', 'ipari'],\n        vintage: ['vintage', 'retro', 'antik'],\n        bohemian: ['bohm', 'sznes', 'mints'],\n      };\n      \n      if (space && styleKeywords[space]) {\n        styleKeywords[space].forEach(kw => {\n          if (productText.includes(kw)) score += weights.styleBoost;\n        });\n        if (tweaks.avoidStyles?.includes(space)) score -= weights.styleBoost * 2;\n      }\n      \n    // Budget\n      if (budget === 'budget' && price < 100000) score += weights.priceFit;\n      if (budget === 'mid' && price >= 100000 && price <= 300000) score += weights.priceFit;\n      if (budget === 'premium' && price > 300000) score += weights.priceFit;\n      \n      // Szoba tpus\n      const roomKeywords = {\n        living: ['kanap', 'fotel', 'dohnyz', 'tv', 'nappali'],\n        bedroom: ['gy', 'matrac', 'jjeli', 'hlszoba'],\n        dining: ['tkez', 'asztal', 'szk'],\n        office: ['rasztal', 'iroda', 'forgszk'],\n      };\n      \n      if (room && roomKeywords[room]) {\n        roomKeywords[room].forEach(kw => {\n          if (productText.includes(kw)) score += weights.roomBoost;\n        });\n        if (tweaks.avoidRooms?.includes(room)) score -= weights.roomBoost * 2;\n      }\n    }\n\n    if (avgPrice && price > 0) {\n      const diff = Math.abs(price - avgPrice) / avgPrice;\n      score += Math.max(0, (1 - Math.min(diff, 1))) * weights.priceFit;\n    }\n\n    const stockQty = product.stock_qty ?? product.stockQty;\n    if (typeof stockQty === 'number') {\n      score += Math.min(20, stockQty) * (weights.stockBoost / 20);\n      if (stockQty === 0) score -= weights.stockBoost;\n    }\n    \n    // Kis random faktor a vltozatossgrt\n    score += Math.random() * 5;\n    \n    return { product, score };\n  });\n  \n  // Top termkek visszaadsa\n  return scored\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n/**\n * Hasonl termkek keresse\n */\nexport function getSimilarProducts(product, allProducts, limit = 8) {\n  if (!product || !allProducts) return [];\n  \n  const dislikedIds = getDislikedProducts();\n  \n  const productName = (product.name || '').toLowerCase();\n  const productCategory = (product.category || '').toLowerCase();\n  const productPrice = product.salePrice || product.price || 0;\n  \n  // Kulcsszavak kinyerse a nvbl\n  const keywords = productName\n    .split(/[\\s,\\-\\/]+/)\n    .filter(w => w.length > 3)\n    .slice(0, 5);\n  \n  const scored = allProducts\n    .filter(p => p.id !== product.id && !dislikedIds.includes(p.id))\n    .map(p => {\n      let score = 0;\n      const pName = (p.name || '').toLowerCase();\n      const pCategory = (p.category || '').toLowerCase();\n      const pPrice = p.salePrice || p.price || 0;\n      \n      // Ugyanaz a kategria\n      if (pCategory && productCategory && pCategory.includes(productCategory.split(' > ')[0])) {\n        score += 30;\n      }\n      \n      // Hasonl r (30%)\n      if (pPrice > 0 && productPrice > 0) {\n        const priceDiff = Math.abs(pPrice - productPrice) / productPrice;\n        if (priceDiff < 0.3) score += 20;\n        else if (priceDiff < 0.5) score += 10;\n      }\n      \n      // Kulcssz egyezs\n      keywords.forEach(kw => {\n        if (pName.includes(kw)) score += 5;\n      });\n      \n      return { product: p, score };\n    });\n  \n  return scored\n    .filter(s => s.score > 0)\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n// ==================== CLEAR DATA ====================\n\nexport function clearAllData() {\n  Object.values(STORAGE_KEYS).forEach(key => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport default {\n  trackProductView,\n  getViewedProducts,\n  getRecentlyViewedIds,\n  likeProduct,\n  dislikeProduct,\n  getLikedProducts,\n  getDislikedProducts,\n  isProductLiked,\n  trackSearch,\n  getSearchHistory,\n  saveStyleDNA,\n  getStyleDNA,\n  trackAIFeedback,\n  getAIFeedback,\n  getAIFeedbackStats,\n  saveChatContext,\n  getChatContext,\n  getUserPreferences,\n  getTopCategories,\n  getPersonalizedContext,\n  getPersonalizedRecommendations,\n  getSimilarProducts,\n  requestBackInStock,\n  getBackInStockRequests,\n  trackSectionEvent,\n  getSectionStats,\n  clearAllData,\n  trackSearchClick,\n  getSearchClickBoosts,\n};\n","import React from 'react';\n\n/**\n * Modern Skeleton Loading Components\n * Shimmer effect with smooth animations\n */\n\n// Base skeleton with shimmer\nexport const Skeleton = ({ className = '', variant = 'rectangular' }) => {\n  const baseClasses = 'animate-pulse bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%] animate-shimmer';\n  \n  const variants = {\n    rectangular: 'rounded-lg',\n    circular: 'rounded-full',\n    text: 'rounded h-4',\n    rounded: 'rounded-xl'\n  };\n\n  return (\n    <div className={`${baseClasses} ${variants[variant]} ${className}`} />\n  );\n};\n\n// Product Card Skeleton\nexport const ProductCardSkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl overflow-hidden shadow-sm border border-gray-100 h-full\">\n    {/* Image placeholder */}\n    <div className=\"aspect-square relative overflow-hidden bg-gray-100\">\n      <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 animate-shimmer bg-[length:200%_100%]\" />\n      {/* Fake badge */}\n      <div className=\"absolute top-3 left-3\">\n        <Skeleton className=\"w-12 h-5 rounded-full\" />\n      </div>\n      {/* Fake wishlist button */}\n      <div className=\"absolute top-3 right-3\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n    \n    {/* Content */}\n    <div className=\"p-3 sm:p-4 lg:p-5 space-y-3\">\n      {/* Category */}\n      <Skeleton className=\"w-16 h-3\" />\n      \n      {/* Title - 2 lines */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"w-full h-4\" />\n        <Skeleton className=\"w-3/4 h-4\" />\n      </div>\n      \n      {/* Price section */}\n      <div className=\"pt-3 border-t border-gray-100 flex justify-between items-center\">\n        <div className=\"space-y-1\">\n          <Skeleton className=\"w-12 h-3\" />\n          <Skeleton className=\"w-20 h-6\" />\n        </div>\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Grid of Product Skeletons\nexport const ProductGridSkeleton = ({ count = 8 }) => (\n  <div className=\"product-grid\">\n    {Array.from({ length: count }).map((_, i) => (\n      <ProductCardSkeleton key={i} />\n    ))}\n  </div>\n);\n\n// Category Pills Skeleton\nexport const CategorySkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-100 mb-4 sm:mb-6 p-4\">\n    {/* Header */}\n    <div className=\"flex items-center justify-between mb-4\">\n      <div className=\"flex items-center gap-3\">\n        <Skeleton variant=\"rounded\" className=\"w-10 h-10\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"w-24 h-5\" />\n          <Skeleton className=\"w-16 h-3 hidden sm:block\" />\n        </div>\n      </div>\n      <div className=\"space-y-1 text-right\">\n        <Skeleton className=\"w-20 h-5\" />\n        <Skeleton className=\"w-16 h-3\" />\n      </div>\n    </div>\n    \n    {/* Pills */}\n    <div className=\"flex flex-wrap gap-2\">\n      {Array.from({ length: 8 }).map((_, i) => (\n        <Skeleton \n          key={i} \n          variant=\"rounded\" \n          className=\"h-10\"\n          style={{ width: `${60 + Math.random() * 40}px` }}\n        />\n      ))}\n    </div>\n  </div>\n);\n\n// Search Bar Skeleton\nexport const SearchSkeleton = () => (\n  <div className=\"relative\">\n    <Skeleton variant=\"rounded\" className=\"w-full h-12\" />\n  </div>\n);\n\n// Hero Section Skeleton\nexport const HeroSkeleton = () => (\n  <div className=\"min-h-[60vh] flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 p-8\">\n    <div className=\"text-center space-y-6 max-w-2xl\">\n      <Skeleton className=\"w-40 h-8 mx-auto rounded-full\" />\n      <div className=\"space-y-3\">\n        <Skeleton className=\"w-full h-12 mx-auto\" />\n        <Skeleton className=\"w-3/4 h-12 mx-auto\" />\n      </div>\n      <Skeleton className=\"w-2/3 h-6 mx-auto\" />\n      <div className=\"flex gap-4 justify-center pt-4\">\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Inline Content Skeleton (for text areas)\nexport const TextSkeleton = ({ lines = 3, className = '' }) => (\n  <div className={`space-y-2 ${className}`}>\n    {Array.from({ length: lines }).map((_, i) => (\n      <Skeleton \n        key={i} \n        variant=\"text\" \n        className={i === lines - 1 ? 'w-2/3' : 'w-full'}\n      />\n    ))}\n  </div>\n);\n\n// Stats Card Skeleton\nexport const StatsSkeleton = () => (\n  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n    {Array.from({ length: 4 }).map((_, i) => (\n      <div key={i} className=\"bg-white rounded-2xl p-6 text-center\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10 mx-auto mb-3\" />\n        <Skeleton className=\"w-16 h-8 mx-auto mb-2\" />\n        <Skeleton className=\"w-20 h-4 mx-auto\" />\n      </div>\n    ))}\n  </div>\n);\n\nexport default {\n  Skeleton,\n  ProductCardSkeleton,\n  ProductGridSkeleton,\n  CategorySkeleton,\n  SearchSkeleton,\n  HeroSkeleton,\n  TextSkeleton,\n  StatsSkeleton\n};\n","import React, { useState, useEffect, createContext, useContext, useCallback } from 'react';\nimport { \n  CheckCircle2, XCircle, AlertCircle, Info, X, \n  ShoppingCart, Heart, Sparkles, Bell, Truck\n} from 'lucide-react';\n\n/**\n * Modern Toast Notification System\n * Beautiful, accessible notifications with icons and animations\n */\n\n// Toast Context\nconst ToastContext = createContext(null);\n\n// Toast Types with icons and colors\nconst TOAST_TYPES = {\n  success: {\n    icon: CheckCircle2,\n    bg: 'bg-emerald-50 border-emerald-200',\n    iconBg: 'bg-emerald-100',\n    iconColor: 'text-emerald-600',\n    title: 'text-emerald-900',\n    message: 'text-emerald-700',\n    progress: 'bg-emerald-500'\n  },\n  error: {\n    icon: XCircle,\n    bg: 'bg-red-50 border-red-200',\n    iconBg: 'bg-red-100',\n    iconColor: 'text-red-600',\n    title: 'text-red-900',\n    message: 'text-red-700',\n    progress: 'bg-red-500'\n  },\n  warning: {\n    icon: AlertCircle,\n    bg: 'bg-amber-50 border-amber-200',\n    iconBg: 'bg-amber-100',\n    iconColor: 'text-amber-600',\n    title: 'text-amber-900',\n    message: 'text-amber-700',\n    progress: 'bg-amber-500'\n  },\n  info: {\n    icon: Info,\n    bg: 'bg-blue-50 border-blue-200',\n    iconBg: 'bg-blue-100',\n    iconColor: 'text-blue-600',\n    title: 'text-blue-900',\n    message: 'text-blue-700',\n    progress: 'bg-blue-500'\n  },\n  cart: {\n    icon: ShoppingCart,\n    bg: 'bg-primary-50 border-primary-200',\n    iconBg: 'bg-primary-100',\n    iconColor: 'text-primary-500',\n    title: 'text-primary-700',\n    message: 'text-primary-600',\n    progress: 'bg-primary-500'\n  },\n  wishlist: {\n    icon: Heart,\n    bg: 'bg-pink-50 border-pink-200',\n    iconBg: 'bg-pink-100',\n    iconColor: 'text-pink-600',\n    title: 'text-pink-900',\n    message: 'text-pink-700',\n    progress: 'bg-pink-500'\n  },\n  ai: {\n    icon: Sparkles,\n    bg: 'bg-secondary-50 border-secondary-200',\n    iconBg: 'bg-secondary-100',\n    iconColor: 'text-secondary-700',\n    title: 'text-secondary-800',\n    message: 'text-secondary-700',\n    progress: 'bg-secondary-600'\n  },\n  notification: {\n    icon: Bell,\n    bg: 'bg-gray-50 border-gray-200',\n    iconBg: 'bg-gray-100',\n    iconColor: 'text-gray-600',\n    title: 'text-gray-900',\n    message: 'text-gray-700',\n    progress: 'bg-gray-500'\n  },\n  shipping: {\n    icon: Truck,\n    bg: 'bg-teal-50 border-teal-200',\n    iconBg: 'bg-teal-100',\n    iconColor: 'text-teal-600',\n    title: 'text-teal-900',\n    message: 'text-teal-700',\n    progress: 'bg-teal-500'\n  }\n};\n\n// Single Toast Component\nconst Toast = ({ id, type = 'info', title, message, duration = 4000, onClose, action }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isLeaving, setIsLeaving] = useState(false);\n  const config = TOAST_TYPES[type] || TOAST_TYPES.info;\n  const Icon = config.icon;\n\n  useEffect(() => {\n    // Animate in\n    requestAnimationFrame(() => setIsVisible(true));\n    \n    // Auto dismiss\n    if (duration > 0) {\n      const timer = setTimeout(() => handleClose(), duration);\n      return () => clearTimeout(timer);\n    }\n  }, [duration]);\n\n  const handleClose = () => {\n    setIsLeaving(true);\n    setTimeout(() => onClose?.(id), 300);\n  };\n\n  return (\n    <div\n      className={`\n        relative w-full max-w-sm overflow-hidden\n        ${config.bg} border rounded-xl shadow-lg\n        transform transition-all duration-300 ease-out\n        ${isVisible && !isLeaving ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\n      `}\n      role=\"alert\"\n    >\n      <div className=\"p-4 flex items-start gap-3\">\n        {/* Icon */}\n        <div className={`${config.iconBg} rounded-lg p-2 shrink-0`}>\n          <Icon className={`w-5 h-5 ${config.iconColor}`} />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          {title && (\n            <h4 className={`font-semibold text-sm ${config.title}`}>{title}</h4>\n          )}\n          {message && (\n            <p className={`text-sm mt-0.5 ${config.message}`}>{message}</p>\n          )}\n          {action && (\n            <button\n              onClick={() => { action.onClick?.(); handleClose(); }}\n              className={`mt-2 text-sm font-semibold ${config.iconColor} hover:underline`}\n            >\n              {action.label}\n            </button>\n          )}\n        </div>\n\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-4 h-4 text-gray-400\" />\n        </button>\n      </div>\n\n      {/* Progress bar */}\n      {duration > 0 && (\n        <div className=\"h-1 w-full bg-black/5\">\n          <div\n            className={`h-full ${config.progress} transition-all ease-linear`}\n            style={{\n              width: '100%',\n              animation: `shrink ${duration}ms linear forwards`\n            }}\n          />\n        </div>\n      )}\n\n      <style>{`\n        @keyframes shrink {\n          from { width: 100%; }\n          to { width: 0%; }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// Toast Container - mobile aware of 40px UNAS bottom nav\nconst ToastContainer = ({ toasts, removeToast }) => {\n  if (!toasts || toasts.length === 0) return null;\n\n  return (\n    <div className=\"fixed bottom-[calc(1rem+44px)] md:bottom-4 right-2 md:right-4 z-[100] flex flex-col gap-2 md:gap-3 pointer-events-none max-w-[calc(100vw-1rem)] md:max-w-none\">\n      {toasts.map(toast => (\n        <div key={toast.id} className=\"pointer-events-auto\">\n          <Toast {...toast} onClose={removeToast} />\n        </div>\n      ))}\n    </div>\n  );\n};\n\n// Toast Provider\nexport const ToastProvider = ({ children }) => {\n  const [toasts, setToasts] = useState([]);\n\n  const addToast = useCallback((options) => {\n    const id = Date.now() + Math.random();\n    setToasts(prev => [...prev, { id, ...options }]);\n    return id;\n  }, []);\n\n  const removeToast = useCallback((id) => {\n    setToasts(prev => prev.filter(t => t.id !== id));\n  }, []);\n\n  // Convenience methods\n  const toast = {\n    success: (message, options = {}) => addToast({ type: 'success', title: 'Siker!', message, ...options }),\n    error: (message, options = {}) => addToast({ type: 'error', title: 'Hiba!', message, ...options }),\n    warning: (message, options = {}) => addToast({ type: 'warning', title: 'Figyelem!', message, ...options }),\n    info: (message, options = {}) => addToast({ type: 'info', message, ...options }),\n    cart: (message, options = {}) => addToast({ type: 'cart', title: 'Kosr', message, ...options }),\n    wishlist: (message, options = {}) => addToast({ type: 'wishlist', title: 'Kedvencek', message, ...options }),\n    ai: (message, options = {}) => addToast({ type: 'ai', title: 'AI Asszisztens', message, ...options }),\n    notification: (message, options = {}) => addToast({ type: 'notification', message, ...options }),\n    shipping: (message, options = {}) => addToast({ type: 'shipping', title: 'Szllts', message, ...options }),\n    custom: (options) => addToast(options),\n    dismiss: removeToast\n  };\n\n  return (\n    <ToastContext.Provider value={toast}>\n      {children}\n      <ToastContainer toasts={toasts} removeToast={removeToast} />\n    </ToastContext.Provider>\n  );\n};\n\n// Hook to use toast\nexport const useToast = () => {\n  const context = useContext(ToastContext);\n  if (!context) {\n    // Return a mock toast for when provider is not available\n    return {\n      success: console.log,\n      error: console.error,\n      warning: console.warn,\n      info: console.log,\n      cart: console.log,\n      wishlist: console.log,\n      ai: console.log,\n      notification: console.log,\n      shipping: console.log,\n      custom: console.log,\n      dismiss: () => {}\n    };\n  }\n  return context;\n};\n\nexport default { Toast, ToastProvider, useToast };\n","import React from 'react';\nimport { \n  Search, Package, Heart, ShoppingCart, Filter, \n  FolderOpen, AlertCircle, RefreshCw, ArrowRight,\n  Sparkles, Frown\n} from 'lucide-react';\n\n/**\n * Modern Empty State Components\n * Beautiful, helpful empty states with actions\n */\n\n// Base Empty State\nexport const EmptyState = ({ \n  icon: Icon = Package,\n  title,\n  description,\n  action,\n  secondaryAction,\n  size = 'md',\n  className = ''\n}) => {\n  const sizes = {\n    sm: {\n      container: 'py-8 px-4',\n      icon: 'w-12 h-12',\n      iconWrapper: 'w-16 h-16',\n      title: 'text-base',\n      description: 'text-sm',\n      button: 'px-4 py-2 text-sm'\n    },\n    md: {\n      container: 'py-12 px-6',\n      icon: 'w-16 h-16',\n      iconWrapper: 'w-24 h-24',\n      title: 'text-lg',\n      description: 'text-base',\n      button: 'px-5 py-2.5 text-sm'\n    },\n    lg: {\n      container: 'py-16 px-8',\n      icon: 'w-20 h-20',\n      iconWrapper: 'w-32 h-32',\n      title: 'text-xl',\n      description: 'text-lg',\n      button: 'px-6 py-3 text-base'\n    }\n  };\n\n  const s = sizes[size];\n\n  return (\n    <div className={`flex flex-col items-center justify-center text-center ${s.container} ${className}`}>\n      {/* Animated Icon Container */}\n      <div className={`\n        ${s.iconWrapper} rounded-full \n        bg-gradient-to-br from-gray-100 to-gray-50 \n        flex items-center justify-center mb-6\n        relative overflow-hidden\n      `}>\n        {/* Subtle animation ring */}\n        <div className=\"absolute inset-0 rounded-full border-2 border-dashed border-gray-200 animate-spin-slow\" />\n        <Icon className={`${s.icon} text-gray-400`} />\n      </div>\n\n      {/* Title */}\n      {title && (\n        <h3 className={`${s.title} font-bold text-gray-900 mb-2`}>\n          {title}\n        </h3>\n      )}\n\n      {/* Description */}\n      {description && (\n        <p className={`${s.description} text-gray-500 max-w-md mb-6`}>\n          {description}\n        </p>\n      )}\n\n      {/* Actions */}\n      {(action || secondaryAction) && (\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          {action && (\n            <button\n              onClick={action.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-primary-500 text-white font-semibold rounded-xl\n                hover:bg-primary-600 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {action.icon && <action.icon className=\"w-4 h-4\" />}\n              {action.label}\n            </button>\n          )}\n          {secondaryAction && (\n            <button\n              onClick={secondaryAction.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-gray-100 text-gray-700 font-semibold rounded-xl\n                hover:bg-gray-200 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {secondaryAction.icon && <secondaryAction.icon className=\"w-4 h-4\" />}\n              {secondaryAction.label}\n            </button>\n          )}\n        </div>\n      )}\n\n      <style>{`\n        @keyframes spin-slow {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n        .animate-spin-slow {\n          animation: spin-slow 20s linear infinite;\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// No Search Results\nexport const NoSearchResults = ({ query, onClear, onSuggest, didYouMean, onDidYouMean }) => (\n  <div className=\"text-center py-12\">\n    <EmptyState\n      icon={Search}\n      title={`Nincs tallat: \"${query}\"`}\n      description={didYouMean && onDidYouMean ? (\n        <span>\n          Prblj ms kulcsszavakat, vagy{' '}\n          <button\n            type=\"button\"\n            onClick={() => onDidYouMean(didYouMean)}\n            className=\"font-semibold text-primary-600 hover:text-primary-700 underline underline-offset-2\"\n          >\n            Taln ezt kerested: {didYouMean}\n          </button>\n        </span>\n      ) : 'Prblj ms kulcsszavakat hasznlni, vagy bngssz a kategrik kztt.'}\n      action={onClear && {\n        label: 'Keress trlse',\n        icon: RefreshCw,\n        onClick: onClear\n      }}\n      secondaryAction={onSuggest && {\n        label: 'AI javaslatok',\n        icon: Sparkles,\n        onClick: onSuggest\n      }}\n    />\n  </div>\n);\n\n// No Products in Category\nexport const NoCategoryProducts = ({ category, onShowAll }) => (\n  <EmptyState\n    icon={FolderOpen}\n    title={`Nincs termk: ${category}`}\n    description=\"Ez a kategria jelenleg res. Nzd meg a tbbi kategrit!\"\n    action={onShowAll && {\n      label: 'sszes termk',\n      icon: ArrowRight,\n      onClick: onShowAll\n    }}\n  />\n);\n\n// Empty Wishlist\nexport const EmptyWishlist = ({ onBrowse }) => (\n  <EmptyState\n    icon={Heart}\n    title=\"res a kvnsglistd\"\n    description=\"Mg nem adtl hozz termkeket. Bngssz s jelld meg kedvenceidet!\"\n    action={onBrowse && {\n      label: 'Bngszs',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// Empty Cart\nexport const EmptyCart = ({ onBrowse }) => (\n  <EmptyState\n    icon={ShoppingCart}\n    title=\"res a kosarad\"\n    description=\"Mg nem tettl semmit a kosrba. Fedezd fel knlatunkat!\"\n    action={onBrowse && {\n      label: 'Vsrls',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// No Filter Results\nexport const NoFilterResults = ({ onClearFilters }) => (\n  <EmptyState\n    icon={Filter}\n    title=\"Nincs tallat a szrsre\"\n    description=\"A megadott szrknek egyetlen termk sem felel meg. Prbld laztani a feltteleket.\"\n    action={onClearFilters && {\n      label: 'Szrk trlse',\n      icon: RefreshCw,\n      onClick: onClearFilters\n    }}\n  />\n);\n\n// Error State\nexport const ErrorState = ({ message, onRetry }) => (\n  <EmptyState\n    icon={AlertCircle}\n    title=\"Hiba trtnt\"\n    description={message || \"Valami nem sikerlt. Krlek prbld jra!\"}\n    action={onRetry && {\n      label: 'jraprbls',\n      icon: RefreshCw,\n      onClick: onRetry\n    }}\n  />\n);\n\n// Coming Soon\nexport const ComingSoon = ({ feature }) => (\n  <EmptyState\n    icon={Sparkles}\n    title=\"Hamarosan\"\n    description={feature ? `${feature} - dolgozunk rajta!` : \"Ez a funkci hamarosan elrhet!\"}\n  />\n);\n\n// Not Found (404)\nexport const NotFound = ({ onGoHome }) => (\n  <EmptyState\n    icon={Frown}\n    title=\"Az oldal nem tallhat\"\n    description=\"A keresett oldal nem ltezik vagy thelyezsre kerlt.\"\n    action={onGoHome && {\n      label: 'Vissza a foldalra',\n      icon: ArrowRight,\n      onClick: onGoHome\n    }}\n    size=\"lg\"\n  />\n);\n\nexport default {\n  EmptyState,\n  NoSearchResults,\n  NoCategoryProducts,\n  EmptyWishlist,\n  EmptyCart,\n  NoFilterResults,\n  ErrorState,\n  ComingSoon,\n  NotFound\n};\n","import React from 'react';\nimport { \n  Sparkles, Flame, Star, TrendingUp, Clock, Tag, \n  Percent, Package, Truck, Shield, Award, Zap\n} from 'lucide-react';\n\n/**\n * Modern Badge Components\n * Consistent, accessible product badges with animations\n */\n\n// Base Badge Component\nexport const Badge = ({ \n  children, \n  variant = 'default',\n  size = 'sm',\n  icon: Icon,\n  pulse = false,\n  className = ''\n}) => {\n  const variants = {\n    default: 'bg-gray-100 text-gray-700',\n    primary: 'bg-primary-100 text-primary-700',\n    success: 'bg-emerald-100 text-emerald-700',\n    warning: 'bg-amber-100 text-amber-700',\n    danger: 'bg-red-100 text-red-700',\n    purple: 'bg-secondary-100 text-secondary-700',\n    pink: 'bg-pink-100 text-pink-700',\n    gradient: 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white',\n    outline: 'bg-transparent border-2 border-current'\n  };\n\n  // UNIFIED TYPOGRAPHY SCALE - Comfortable readable sizes\n  const sizes = {\n    xs: 'text-sm px-2.5 py-1',              // 14px - small but readable\n    sm: 'text-sm sm:text-base px-3 py-1.5', // 14-16px - standard badge\n    md: 'text-base sm:text-lg px-4 py-2',   // 16-18px - prominent\n    lg: 'text-lg sm:text-xl px-5 py-2.5'    // 18-20px - hero badges\n  };\n\n  const iconSizes = {\n    xs: 'w-4 h-4',\n    sm: 'w-4 h-4 sm:w-5 sm:h-5',\n    md: 'w-5 h-5 sm:w-6 sm:h-6',\n    lg: 'w-6 h-6'\n  };\n\n  return (\n    <span className={`\n      inline-flex items-center gap-1.5 font-semibold rounded-full\n      ${variants[variant]} ${sizes[size]}\n      ${pulse ? 'animate-pulse' : ''}\n      ${className}\n    `}>\n      {Icon && <Icon className={iconSizes[size]} />}\n      {children}\n    </span>\n  );\n};\n\n// New Product Badge\nexport const NewBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"primary\" size={size} icon={Sparkles}>\n    J\n  </Badge>\n);\n\n// Sale/Discount Badge\nexport const DiscountBadge = ({ percent, size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Percent}>\n    -{percent}%\n  </Badge>\n);\n\n// Hot/Popular Badge\nexport const HotBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Flame} pulse>\n    Npszer\n  </Badge>\n);\n\n// Bestseller Badge\nexport const BestsellerBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Award}>\n    Bestseller\n  </Badge>\n);\n\n// Trending Badge\nexport const TrendingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"purple\" size={size} icon={TrendingUp}>\n    Trend\n  </Badge>\n);\n\n// Limited Badge\nexport const LimitedBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"pink\" size={size} icon={Clock}>\n    Limitlt\n  </Badge>\n);\n\n// Free Shipping Badge\nexport const FreeShippingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Truck}>\n    Ingyenes szllts\n  </Badge>\n);\n\n// Stock Badge\nexport const StockBadge = ({ inStock, quantity, size = 'sm' }) => {\n  if (!inStock || quantity === 0) {\n    return (\n      <Badge variant=\"default\" size={size}>\n        Elfogyott\n      </Badge>\n    );\n  }\n  \n  if (quantity && quantity <= 5) {\n    return (\n      <Badge variant=\"warning\" size={size} icon={Package}>\n        Csak {quantity} db\n      </Badge>\n    );\n  }\n  \n  return (\n    <Badge variant=\"success\" size={size} icon={Package}>\n      Kszleten\n    </Badge>\n  );\n};\n\n// Rating Badge\nexport const RatingBadge = ({ rating, count, size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Star}>\n    {rating?.toFixed(1) || '5.0'} {count && `(${count})`}\n  </Badge>\n);\n\n// Premium/Quality Badge\nexport const PremiumBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Shield}>\n    Prmium\n  </Badge>\n);\n\n// Fast Delivery Badge  \nexport const FastDeliveryBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Zap}>\n    24h szllts\n  </Badge>\n);\n\n// Price Drop Badge\nexport const PriceDropBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Tag}>\n    ress\n  </Badge>\n);\n\n// Smart Badge - automatically determines which badge to show\n// Uses sm size for READABLE badges\nexport const SmartBadges = ({ product, maxBadges = 2 }) => {\n  const badges = [];\n  \n  // Check for new (last 7 days)\n  if (product.createdAt) {\n    const daysSinceCreation = (Date.now() - new Date(product.createdAt).getTime()) / (1000 * 60 * 60 * 24);\n    if (daysSinceCreation <= 7) {\n      badges.push({ component: NewBadge, priority: 3 });\n    }\n  }\n  \n  // Check for discount\n  if (product.salePrice && product.price > product.salePrice) {\n    const percent = Math.round(((product.price - product.salePrice) / product.price) * 100);\n    if (percent >= 10) {\n      badges.push({ \n        component: ({ size }) => <DiscountBadge percent={percent} size={size} />, \n        priority: 5 \n      });\n    }\n  }\n  \n  // Check for popularity (if we have sales data)\n  if (product.salesCount && product.salesCount > 50) {\n    badges.push({ component: HotBadge, priority: 2 });\n  }\n  \n  // Check for low stock\n  if (product.inStock && product.quantity && product.quantity <= 5 && product.quantity > 0) {\n    badges.push({ component: LimitedBadge, priority: 4 });\n  }\n  \n  // Check for bestseller\n  if (product.isBestseller) {\n    badges.push({ component: BestsellerBadge, priority: 6 });\n  }\n  \n  // Check for free shipping\n  if (product.freeShipping) {\n    badges.push({ component: FreeShippingBadge, priority: 1 });\n  }\n  \n  // Sort by priority and take top badges\n  const topBadges = badges\n    .sort((a, b) => b.priority - a.priority)\n    .slice(0, maxBadges);\n  \n  if (topBadges.length === 0) return null;\n  \n  return (\n    <div className=\"flex flex-col gap-1.5 sm:gap-2\">\n      {topBadges.map((badge, idx) => (\n        <badge.component key={idx} size=\"sm\" />\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  Badge,\n  NewBadge,\n  DiscountBadge,\n  HotBadge,\n  BestsellerBadge,\n  TrendingBadge,\n  LimitedBadge,\n  FreeShippingBadge,\n  StockBadge,\n  RatingBadge,\n  PremiumBadge,\n  FastDeliveryBadge,\n  PriceDropBadge,\n  SmartBadges\n};\n","import React from 'react';\nimport { \n  LayoutGrid, Sofa, Armchair, BedDouble, Lamp, LampDesk, Package, \n  Table, BookOpen, Tv, Bath, UtensilsCrossed, Briefcase, Baby,\n  Flower2, TreeDeciduous, Warehouse, Shirt, Home, Box,\n  MessageCircle, Camera, Move3d, Sparkles, Lightbulb, Zap,\n  Palette, DollarSign, Crown, Target, Handshake, Recycle,\n  ThumbsUp, Heart, Shield, Award, Clock, Truck, CheckCircle2,\n  Star, TrendingUp, Gift, Search, ArrowRight, Bot\n} from 'lucide-react';\n\n/**\n * Category Icon Mapping - consistent furniture-related icons\n */\nconst CATEGORY_ICONS = {\n  // Default & General\n  'sszes': LayoutGrid,\n  'default': Package,\n  \n  // Living Room\n  'Kanap': Sofa,\n  'Kanapk': Sofa,\n  'Fotel': Armchair,\n  'Fotelek': Armchair,\n  'lgarnitra': Sofa,\n  'lgarnitrk': Sofa,\n  'Nappali': Tv,\n  'Nappali btor': Tv,\n  \n  // Bedroom\n  'gy': BedDouble,\n  'gyak': BedDouble,\n  'Hlszoba': BedDouble,\n  'Hlszoba btor': BedDouble,\n  'Matrac': BedDouble,\n  'Matracok': BedDouble,\n  \n  // Seating\n  'Szk': Armchair,\n  'Szkek': Armchair,\n  'Irodai szk': Briefcase,\n  'Irodaszk': Briefcase,\n  \n  // Tables\n  'Asztal': Table,\n  'Asztalok': Table,\n  'tkezasztal': UtensilsCrossed,\n  'Dohnyzasztal': Table,\n  'rasztal': Briefcase,\n  \n  // Storage\n  'Szekrny': Warehouse,\n  'Szekrnyek': Warehouse,\n  'Gardrb': Shirt,\n  'Gardrbszekrny': Shirt,\n  'Komd': Box,\n  'Polc': BookOpen,\n  'Polcok': BookOpen,\n  'Knyvespolc': BookOpen,\n  'Trols': Package,\n  \n  // Lighting\n  'Lmpa': Lamp,\n  'Lmpk': Lamp,\n  'Vilgts': LampDesk,\n  'Asztali lmpa': LampDesk,\n  'lllmpa': Lamp,\n  \n  // Office\n  'Iroda': Briefcase,\n  'Iroda btor': Briefcase,\n  'Dolgozszoba': Briefcase,\n  \n  // Kids & Baby\n  'Gyerek': Baby,\n  'Gyerekszoba': Baby,\n  'Baba': Baby,\n  \n  // Bathroom\n  'Frdszoba': Bath,\n  'Frd': Bath,\n  \n  // Outdoor & Garden\n  'Kert': TreeDeciduous,\n  'Kerti': TreeDeciduous,\n  'Kerti btor': TreeDeciduous,\n  'Terasz': Flower2,\n  \n  // Home & Decor\n  'Dekorci': Flower2,\n  'Lakstextil': Home,\n  'Kiegszt': Gift,\n  'Otthon': Home,\n  'Lakberendezs': Home,\n  'Otthon s lakberendezs': Home,\n  'Btor': Sofa,\n  'Btorok': Sofa,\n  'Barkcs': Warehouse,\n  'Kert s Barkcs': TreeDeciduous,\n};\n\n/**\n * Get icon component for a category name\n */\nexport const getCategoryIcon = (categoryName) => {\n  if (!categoryName) return Package;\n  \n  // Direct match\n  if (CATEGORY_ICONS[categoryName]) {\n    return CATEGORY_ICONS[categoryName];\n  }\n  \n  // Partial match (case insensitive)\n  const lowerName = categoryName.toLowerCase();\n  for (const [key, Icon] of Object.entries(CATEGORY_ICONS)) {\n    if (lowerName.includes(key.toLowerCase()) || key.toLowerCase().includes(lowerName)) {\n      return Icon;\n    }\n  }\n  \n  return Package;\n};\n\n/**\n * Renders a category icon with consistent styling\n */\nexport const CategoryIcon = ({ name, className = \"w-4 h-4\", ...props }) => {\n  const Icon = getCategoryIcon(name);\n  return <Icon className={className} {...props} />;\n};\n\n/**\n * AI Feature Icons\n */\nexport const AIIcons = {\n  Chat: MessageCircle,\n  Camera: Camera,\n  RoomPlanner: Move3d,\n  Sparkles: Sparkles,\n  Tip: Lightbulb,\n  Quick: Zap,\n  Bot: Bot,\n};\n\n/**\n * Style Quiz Icons - modern alternatives to emojis\n */\nexport const StyleIcons = {\n  // Styles\n  modern: Sparkles,\n  scandinavian: TreeDeciduous,\n  industrial: Warehouse,\n  vintage: Clock,\n  bohemian: Palette,\n  \n  // Colors\n  neutral: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-gray-200 to-gray-400\" />,\n  earth: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-amber-600 to-green-700\" />,\n  bold: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-blue-500 to-red-500\" />,\n  pastel: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-pink-300 to-secondary-400\" />,\n  \n  // Budget\n  budget: DollarSign,\n  mid: Award,\n  premium: Crown,\n  flexible: Target,\n  \n  // Priorities\n  comfort: Sofa,\n  design: Palette,\n  durability: Shield,\n  versatility: Recycle,\n  eco: TreeDeciduous,\n  \n  // Rooms\n  living: Tv,\n  bedroom: BedDouble,\n  dining: UtensilsCrossed,\n  office: Briefcase,\n  all: Home,\n};\n\n/**\n * Trust/Feature Icons\n */\nexport const TrustIcons = {\n  quality: Shield,\n  delivery: Truck,\n  support: MessageCircle,\n  warranty: Award,\n  returns: Recycle,\n  secure: CheckCircle2,\n};\n\n/**\n * Animated Icon Wrapper\n */\nexport const AnimatedIcon = ({ icon: Icon, className = \"\", pulse = false, bounce = false, spin = false }) => {\n  const animationClass = pulse ? 'animate-pulse' : bounce ? 'animate-bounce' : spin ? 'animate-spin' : '';\n  return <Icon className={`${className} ${animationClass}`} />;\n};\n\n/**\n * Icon with gradient background\n */\nexport const GradientIcon = ({ \n  icon: Icon, \n  gradient = \"from-primary-500 to-secondary-700\",\n  size = \"md\",\n  className = \"\"\n}) => {\n  const sizes = {\n    sm: \"w-8 h-8 p-1.5\",\n    md: \"w-10 h-10 p-2\",\n    lg: \"w-12 h-12 p-2.5\",\n    xl: \"w-14 h-14 p-3\"\n  };\n  \n  const iconSizes = {\n    sm: \"w-4 h-4\",\n    md: \"w-5 h-5\",\n    lg: \"w-6 h-6\",\n    xl: \"w-7 h-7\"\n  };\n  \n  return (\n    <div className={`bg-gradient-to-br ${gradient} rounded-xl flex items-center justify-center ${sizes[size]} ${className}`}>\n      <Icon className={`${iconSizes[size]} text-white`} />\n    </div>\n  );\n};\n\n/**\n * Demo Flow - replaces emoji flows with icons\n */\nexport const DemoFlow = ({ steps, size = \"md\" }) => {\n  const iconSize = size === \"sm\" ? \"w-5 h-5\" : size === \"lg\" ? \"w-8 h-8\" : \"w-6 h-6\";\n  const arrowSize = size === \"sm\" ? \"w-3 h-3\" : size === \"lg\" ? \"w-5 h-5\" : \"w-4 h-4\";\n  \n  return (\n    <div className=\"flex items-center justify-center gap-2\">\n      {steps.map((step, idx) => (\n        <React.Fragment key={idx}>\n          <div className={`${step.bg || 'bg-gray-100'} rounded-lg p-2`}>\n            <step.icon className={`${iconSize} ${step.color || 'text-gray-600'}`} />\n          </div>\n          {idx < steps.length - 1 && (\n            <ArrowRight className={`${arrowSize} text-gray-300`} />\n          )}\n        </React.Fragment>\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  getCategoryIcon,\n  CategoryIcon,\n  AIIcons,\n  StyleIcons,\n  TrustIcons,\n  AnimatedIcon,\n  GradientIcon,\n  DemoFlow\n};\n","import React, { useState } from 'react';\nimport { Sparkles, X, ArrowRight, MessageCircle, Camera, Home, Lightbulb } from 'lucide-react';\nimport { GradientIcon } from '../ui/Icons';\n\n/**\n * AI Feature Showcase - highlights AI capabilities with modern icons\n */\nexport const AIShowcase = () => {\n  const [isDismissed, setIsDismissed] = useState(() => \n    localStorage.getItem('ai-showcase-dismissed') === 'true'\n  );\n\n  if (isDismissed) return null;\n\n  const handleDismiss = () => {\n    localStorage.setItem('ai-showcase-dismissed', 'true');\n    setIsDismissed(true);\n  };\n\n  const features = [\n    {\n      title: 'AI Asszisztens',\n      description: 'Beszlgess szakrtnkkel, krdezz, tancsot krj.',\n      icon: MessageCircle,\n      gradient: 'from-blue-500 to-primary-500',\n      feature: 'Chat'\n    },\n    {\n      title: 'Kpkeres',\n      description: 'Fotzd le a btort, mi megtalljuk a hasonlt.',\n      icon: Camera,\n      gradient: 'from-secondary-600 to-pink-600',\n      feature: 'Visual Search'\n    },\n    {\n      title: 'Szobatervez',\n      description: 'Tervezd meg a szobt virtulisan, lsd lben.',\n      icon: Home,\n      gradient: 'from-emerald-500 to-teal-600',\n      feature: 'Room Planner'\n    }\n  ];\n\n  return (\n    <div className=\"relative bg-gradient-to-br from-secondary-700 via-primary-500 to-blue-600 text-white py-6 sm:py-8 lg:py-12 xl:py-14 mb-4 sm:mb-6 lg:mb-8 overflow-hidden\">\n      {/* Animated background */}\n      <div className=\"absolute inset-0 opacity-20\">\n        <div className=\"absolute top-0 left-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-white rounded-full mix-blend-multiply filter blur-3xl animate-blob\"></div>\n        <div className=\"absolute top-0 right-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-secondary-400 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000\"></div>\n        <div className=\"absolute bottom-0 left-1/2 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-primary-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-4000\"></div>\n      </div>\n\n      <button \n        onClick={handleDismiss}\n        className=\"absolute top-2 right-2 sm:top-3 sm:right-3 lg:top-5 lg:right-5 w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-full transition-colors z-10\"\n        aria-label=\"Bezrs\"\n      >\n        <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n      </button>\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-6 lg:px-10 xl:px-16 relative z-10\">\n        <div className=\"text-center mb-6 sm:mb-10 lg:mb-14\">\n          <div className=\"inline-flex items-center px-3 py-1.5 sm:px-4 sm:py-2 lg:px-5 lg:py-2.5 bg-white/20 backdrop-blur-sm rounded-full text-xs sm:text-sm lg:text-base font-bold mb-3 sm:mb-4 lg:mb-6\">\n            <Sparkles className=\"w-4 h-4 lg:w-5 lg:h-5 mr-2 animate-pulse\" />\n            AI-Powered Shopping\n          </div>\n          <h2 className=\"text-xl sm:text-3xl lg:text-4xl xl:text-5xl font-extrabold mb-2 sm:mb-3 lg:mb-4\">\n            Talld meg az idelis btort <br className=\"hidden md:block\" />\n            <span className=\"text-yellow-300\">mestersges intelligencival</span>\n          </h2>\n          <p className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed\">\n            Hasznld az AI asszisztensnket, kpkeresnket s szobaterveznket.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 xl:gap-8\">\n          {features.map((item, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl sm:rounded-2xl lg:rounded-3xl p-4 sm:p-5 lg:p-6 xl:p-8 hover:bg-white/20 transition-all transform hover:-translate-y-1 cursor-pointer group\"\n            >\n              <GradientIcon \n                icon={item.icon} \n                gradient={item.gradient}\n                size=\"lg\"\n                className=\"mb-3 sm:mb-4 lg:mb-5 group-hover:scale-110 transition-transform\"\n              />\n              <h3 className=\"text-base sm:text-lg lg:text-xl xl:text-2xl font-bold mb-1.5 sm:mb-2 lg:mb-3\">{item.title}</h3>\n              <p className=\"text-white/80 text-xs sm:text-sm lg:text-base xl:text-lg mb-3 sm:mb-4 lg:mb-5 leading-relaxed\">{item.description}</p>\n              <div className=\"flex items-center text-xs sm:text-sm lg:text-base font-bold text-yellow-300 group-hover:text-yellow-200 transition-colors\">\n                Prbld ki <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5 ml-1 group-hover:translate-x-1 transition-transform\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <style>\n        {`\n          @keyframes blob {\n            0%, 100% { transform: translate(0, 0) scale(1); }\n            33% { transform: translate(30px, -50px) scale(1.1); }\n            66% { transform: translate(-20px, 20px) scale(0.9); }\n          }\n          .animate-blob {\n            animation: blob 7s infinite;\n          }\n          .animation-delay-2000 {\n            animation-delay: 2s;\n          }\n          .animation-delay-4000 {\n            animation-delay: 4s;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\n/**\n * AI Onboarding Tooltip\n */\nexport const AIOnboarding = ({ isOpen, onClose, targetFeature }) => {\n  if (!isOpen) return null;\n\n  const messages = {\n    chat: {\n      title: 'Prbld ki az AI Asszisztenst!',\n      description: 'Krdezz brmit a termkekrl, s azonnal vlaszt kapsz.',\n      tip: 'Pldul: \"Keresek egy skandinv kanapt 200.000 Ft alatt\"',\n      icon: MessageCircle\n    },\n    visualSearch: {\n      title: 'AI Kpkeres',\n      description: 'Tlts fel egy kpet, s megmutatjuk a hasonl termkeket.',\n      tip: 'Fotzd le a btort ami tetszik, mi megtalljuk!',\n      icon: Camera\n    },\n    roomPlanner: {\n      title: 'Virtulis Szobatervez',\n      description: 'Helyezd el a btorokat a sajt szobdban, s lsd lben.',\n      tip: 'Tlts fel egy fott a szobdrl, s kezdj el tervezni!',\n      icon: Home\n    }\n  };\n\n  const content = messages[targetFeature] || messages.chat;\n  const TipIcon = content.icon || Lightbulb;\n\n  return (\n    <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4\" onClick={onClose}>\n      <div className=\"bg-white rounded-2xl lg:rounded-3xl p-6 sm:p-8 lg:p-10 max-w-md lg:max-w-lg xl:max-w-xl w-full shadow-2xl animate-scale-in\" onClick={e => e.stopPropagation()}>\n        <div className=\"flex items-center justify-between mb-4 lg:mb-6\">\n          <div className=\"flex items-center gap-3 lg:gap-4\">\n            <div className=\"w-10 h-10 lg:w-12 lg:h-12 xl:w-14 xl:h-14 bg-primary-100 rounded-xl lg:rounded-2xl flex items-center justify-center\">\n              <Sparkles className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 text-primary-500 animate-pulse\" />\n            </div>\n            <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">{content.title}</h3>\n          </div>\n          <button onClick={onClose} className=\"w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\">\n            <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n          </button>\n        </div>\n        <p className=\"text-gray-600 mb-4 lg:mb-6 text-sm sm:text-base lg:text-lg xl:text-xl\">{content.description}</p>\n        <div className=\"bg-primary-50 border border-primary-100 rounded-xl lg:rounded-2xl p-3 sm:p-4 lg:p-5 mb-6 lg:mb-8 flex items-start gap-3 lg:gap-4\">\n          <div className=\"w-8 h-8 lg:w-10 lg:h-10 bg-primary-100 rounded-lg lg:rounded-xl flex items-center justify-center shrink-0\">\n            <Lightbulb className=\"w-4 h-4 lg:w-5 lg:h-5 text-primary-500\" />\n          </div>\n          <div>\n            <p className=\"text-xs lg:text-sm font-semibold text-primary-500 mb-1\">Tipp</p>\n            <p className=\"text-sm lg:text-base xl:text-lg text-primary-600\">{content.tip}</p>\n          </div>\n        </div>\n        <button \n          onClick={onClose}\n          className=\"w-full bg-primary-500 text-white py-3 lg:py-4 xl:py-5 rounded-xl lg:rounded-2xl font-bold text-base lg:text-lg xl:text-xl hover:bg-primary-600 transition-colors min-h-[44px] lg:min-h-[52px] xl:min-h-[60px]\"\n        >\n          rtem, kezdjk!\n        </button>\n      </div>\n      <style>\n        {`\n          @keyframes scale-in {\n            from {\n              transform: scale(0.9);\n              opacity: 0;\n            }\n            to {\n              transform: scale(1);\n              opacity: 1;\n            }\n          }\n          .animate-scale-in {\n            animation: scale-in 0.2s ease-out;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { ChevronDown, ChevronUp, ChevronLeft, ChevronRight, Grid3X3 } from 'lucide-react';\nimport { CategoryIcon } from '../ui/Icons';\n\n/**\n * CategorySwipe - Golden Standard Responsive Category Navigation\n * Typography: Mobile 13-14px, Tablet 14px, Desktop 14-15px\n * Touch targets: 44px minimum\n */\nconst CategorySwipe = ({ categories, activeCategory, onCategoryChange, displayedCount, activeTotalOverride }) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [canScrollLeft, setCanScrollLeft] = useState(false);\n  const [canScrollRight, setCanScrollRight] = useState(true);\n  const scrollRef = useRef(null);\n  \n  const activeData = categories.find(c => c.id === activeCategory);\n  const activeTotalCount = typeof activeTotalOverride === 'number' ? activeTotalOverride : (activeData?.totalCount || 0);\n  \n  const VISIBLE_MOBILE = 15;\n  const VISIBLE_DESKTOP = 18;\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() => {\n    const checkMobile = () => setIsMobile(window.innerWidth < 768);\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n  \n  const visibleCount = isMobile ? VISIBLE_MOBILE : VISIBLE_DESKTOP;\n  const visibleCategories = isExpanded ? categories : categories.slice(0, visibleCount);\n  const hasMore = categories.length > visibleCount;\n  \n  const updateScrollIndicators = () => {\n    if (scrollRef.current) {\n      const { scrollLeft, scrollWidth, clientWidth } = scrollRef.current;\n      setCanScrollLeft(scrollLeft > 5);\n      setCanScrollRight(scrollLeft < scrollWidth - clientWidth - 5);\n    }\n  };\n\n  useEffect(() => {\n    updateScrollIndicators();\n    const el = scrollRef.current;\n    if (!el) return;\n    let rafId = null;\n    const onScroll = () => {\n      if (rafId != null) return;\n      rafId = requestAnimationFrame(() => {\n        updateScrollIndicators();\n        rafId = null;\n      });\n    };\n    el.addEventListener('scroll', onScroll, { passive: true });\n    return () => {\n      if (rafId != null) cancelAnimationFrame(rafId);\n      el.removeEventListener('scroll', onScroll);\n    };\n  }, [categories]);\n  \n  const scroll = (direction) => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollBy({ \n        left: direction === 'left' ? -200 : 200, \n        behavior: 'smooth' \n      });\n    }\n  };\n\n  useEffect(() => {\n    if (scrollRef.current && isMobile) {\n      const activeEl = scrollRef.current.querySelector(`[data-category=\"${activeCategory}\"]`);\n      activeEl?.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });\n    }\n  }, [activeCategory, isMobile]);\n\n  return (\n    <div className=\"bg-white rounded-xl sm:rounded-2xl lg:rounded-3xl shadow-sm border border-gray-100 mb-4 sm:mb-6 lg:mb-8 xl:mb-10 overflow-hidden\">\n      {/* Header - UNIFIED spacing */}\n      <div className=\"px-3 sm:px-5 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-6 xl:py-7 bg-gradient-to-r from-primary-50/80 via-secondary-50/50 to-pink-50/30 border-b border-gray-100\">\n        <div className=\"flex items-center justify-between gap-3 lg:gap-6\">\n          <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-5 min-w-0\">\n            <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 xl:w-20 xl:h-20 rounded-xl lg:rounded-2xl xl:rounded-3xl bg-primary-100 flex items-center justify-center shrink-0\">\n              <Grid3X3 className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 xl:w-10 xl:h-10 text-primary-500\" />\n            </div>\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg lg:text-2xl xl:text-3xl font-bold text-gray-900\">Kategrik</h3>\n              <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-500 hidden sm:block\">{categories.length} kategria</p>\n            </div>\n          </div>\n          \n          {/* Counter - UNIFIED */}\n          <div className=\"text-right shrink-0\">\n            <div className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-gray-700\">\n              <span className=\"font-bold text-primary-500\">{displayedCount?.toLocaleString('hu-HU') || 0}</span>\n              <span className=\"text-gray-400 mx-1\">/</span>\n              <span className=\"font-semibold\">{activeTotalCount.toLocaleString('hu-HU')}</span>\n            </div>\n            <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-400\">termk lthat</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile: Horizontal Scroll */}\n      <div className=\"md:hidden relative\">\n        {canScrollLeft && (\n          <>\n            <div className=\"absolute left-0 top-0 bottom-0 w-6 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('left')}\n              className=\"absolute left-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronLeft className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        {canScrollRight && (\n          <>\n            <div className=\"absolute right-0 top-0 bottom-0 w-6 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('right')}\n              className=\"absolute right-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronRight className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        \n        <div \n          ref={scrollRef}\n          className=\"flex gap-2 overflow-x-auto py-3 px-3 scrollbar-hide\"\n        >\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              data-category={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold transition-all whitespace-nowrap\n                flex items-center gap-1.5\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-md'\n                  : 'bg-gray-100 text-gray-700 active:bg-gray-200'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-[11px] font-medium ${category.id === activeCategory ? 'text-white/80' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n          \n          {hasMore && !isExpanded && (\n            <button\n              onClick={() => setIsExpanded(true)}\n              className=\"shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold bg-primary-50 text-primary-500 whitespace-nowrap\"\n            >\n              +{categories.length - visibleCount}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Desktop: Grid Layout - UNIFIED spacing */}\n      <div className=\"hidden md:block p-4 lg:p-6 xl:p-8 2xl:p-10\">\n        <div className=\"flex flex-wrap gap-2 lg:gap-3 xl:gap-4\">\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                px-4 lg:px-5 xl:px-7 2xl:px-8 py-2.5 lg:py-3 xl:py-4 rounded-xl lg:rounded-2xl text-sm lg:text-base xl:text-lg 2xl:text-xl font-semibold transition-all\n                flex items-center gap-2 lg:gap-2.5 xl:gap-3\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-lg scale-[1.02]'\n                  : 'bg-gray-50 text-gray-700 hover:bg-gray-100 hover:shadow-md'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 lg:w-5 lg:h-5 xl:w-6 xl:h-6 2xl:w-7 2xl:h-7 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-xs lg:text-sm font-medium ${category.id === activeCategory ? 'text-white/85' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n        </div>\n\n        {hasMore && (\n          <button\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"mt-5 lg:mt-6 xl:mt-8 w-full py-3.5 lg:py-4 xl:py-5 text-base lg:text-lg xl:text-xl 2xl:text-2xl text-primary-500 hover:text-primary-600 font-bold flex items-center justify-center gap-2 lg:gap-3 transition-colors rounded-xl lg:rounded-2xl hover:bg-primary-50\"\n          >\n            {isExpanded ? (\n              <>\n                <ChevronUp className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Kevesebb\n              </>\n            ) : (\n              <>\n                <ChevronDown className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Mind a {categories.length} kategria\n              </>\n            )}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CategorySwipe;\n","/** Placeholder image (data URL)  nem fgg kls szolgltatstl (via.placeholder stb.) */\nexport const PLACEHOLDER_IMAGE = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23e5e7eb' width='400' height='400'/%3E%3Ctext fill='%239ca3af' x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16'%3ENincs kp%3C/text%3E%3C/svg%3E\";\n\n/**\n * Normalize product from UNAS API (images, inStock)\n */\nexport const normalizeProduct = (p) => ({\n  ...p,\n  images: p.images || (p.image ? [p.image] : []),\n  image: p.images?.[0] || p.image,\n  inStock: p.inStock ?? p.in_stock ?? true\n});\n\n/**\n * Format price to Hungarian currency (safe for null/undefined)\n */\nexport const formatPrice = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', {\n    style: 'currency',\n    currency: 'HUF',\n    maximumFractionDigits: 0\n  }).format(value);\n};\n\n/** Format price as number only (no \"Ft\") - for custom display */\nexport const formatPriceNumber = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(value);\n};\n\n/**\n * Format relative time (e.g., \"2 rja\")\n */\nexport const formatRelativeTime = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  const now = new Date();\n  const diffMs = now - date;\n  const diffMins = Math.floor(diffMs / 60000);\n  \n  if (diffMins < 1) return 'most';\n  if (diffMins < 60) return `${diffMins} perce`;\n  \n  const diffHours = Math.floor(diffMins / 60);\n  if (diffHours < 24) return `${diffHours} rja`;\n  \n  const diffDays = Math.floor(diffHours / 24);\n  if (diffDays < 7) return `${diffDays} napja`;\n  \n  return date.toLocaleDateString('hu-HU');\n};\n\n/**\n * Truncate text with ellipsis\n */\nexport const truncateText = (text, maxLength = 100) => {\n  if (!text) return '';\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength).trim() + '...';\n};\n\n/**\n * Generate random ID\n */\nexport const generateId = () => {\n  return Date.now().toString(36) + Math.random().toString(36).substr(2);\n};\n\n/**\n * Smooth scroll to element\n */\nexport const scrollToElement = (elementId, offset = 0) => {\n  const element = document.getElementById(elementId);\n  if (element) {\n    const top = element.getBoundingClientRect().top + window.pageYOffset - offset;\n    window.scrollTo({ top, behavior: 'smooth' });\n  }\n};\n\n/**\n * Copy to clipboard with fallback\n */\nexport const copyToClipboard = async (text) => {\n  try {\n    if (navigator.clipboard) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback for older browsers\n      const textarea = document.createElement('textarea');\n      textarea.value = text;\n      textarea.style.position = 'fixed';\n      textarea.style.opacity = '0';\n      document.body.appendChild(textarea);\n      textarea.select();\n      const success = document.execCommand('copy');\n      document.body.removeChild(textarea);\n      return success;\n    }\n  } catch (error) {\n    console.error('Failed to copy:', error);\n    return false;\n  }\n};\n\n/**\n * Validate email\n */\nexport const isValidEmail = (email) => {\n  const regex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return regex.test(email);\n};\n\n/**\n * Get contrast color (black or white) based on background\n */\nexport const getContrastColor = (hexColor) => {\n  const r = parseInt(hexColor.substr(1, 2), 16);\n  const g = parseInt(hexColor.substr(3, 2), 16);\n  const b = parseInt(hexColor.substr(5, 2), 16);\n  const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;\n  return (yiq >= 128) ? '#000000' : '#FFFFFF';\n};\n\n/**\n * Shuffle array (Fisher-Yates algorithm)\n */\nexport const shuffleArray = (array) => {\n  const newArray = [...array];\n  for (let i = newArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n  }\n  return newArray;\n};\n\n/**\n * Try to extract stock level from product data\n */\nexport const getStockLevel = (product) => {\n  if (!product) return null;\n  const direct = product.stockLevel ?? product.stock_level ?? product.stock ?? product.stock_qty ?? product.stockQty ?? null;\n  if (typeof direct === 'number' && Number.isFinite(direct)) return direct;\n  const params = product.params || '';\n  if (typeof params !== 'string' || params.length === 0) return null;\n  const match = params.match(/(rakt[a]r|k[e]szlet)[^0-9]{0,8}(\\d{1,3})/i);\n  if (match && match[2]) {\n    const val = parseInt(match[2], 10);\n    return Number.isFinite(val) ? val : null;\n  }\n  return null;\n};\n\n/**\n * Group items by key\n */\nexport const groupBy = (array, key) => {\n  return array.reduce((result, item) => {\n    const group = item[key];\n    if (!result[group]) {\n      result[group] = [];\n    }\n    result[group].push(item);\n    return result;\n  }, {});\n};\n\n/**\n * Calculate reading time\n */\nexport const calculateReadingTime = (text, wordsPerMinute = 200) => {\n  const words = text.trim().split(/\\s+/).length;\n  const minutes = Math.ceil(words / wordsPerMinute);\n  return `${minutes} perc olvass`;\n};\n","import { useRef } from 'react';\n\n/**\n * Image Optimization Utilities\n * WebP conversion, lazy loading, responsive images\n */\n\n/**\n * Convert image URL to WebP format (if CDN supports it)\n * Falls back to original if WebP not supported\n */\nexport const toWebP = (imageUrl, quality = 80) => {\n  if (!imageUrl) return '';\n  \n  // Check if browser supports WebP\n  if (!isWebPSupported()) {\n    return imageUrl;\n  }\n\n  // If it's already a WebP, return as is\n  if (imageUrl.toLowerCase().endsWith('.webp')) {\n    return imageUrl;\n  }\n\n  // For external CDNs that support WebP conversion via query params\n  // Example: Cloudinary, Imgix, etc.\n  // Adjust based on your CDN provider\n  \n  // Generic approach: if URL has query params, append format\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&format=webp&quality=${quality}`;\n  }\n  \n  // Otherwise, try to replace extension (works if your server supports it)\n  return imageUrl.replace(/\\.(jpg|jpeg|png)$/i, '.webp');\n};\n\n/**\n * Check if browser supports WebP\n */\nexport const isWebPSupported = () => {\n  if (typeof window === 'undefined') return false;\n  \n  // Check for cached result\n  if (window._webpSupport !== undefined) {\n    return window._webpSupport;\n  }\n\n  const canvas = document.createElement('canvas');\n  if (canvas.getContext && canvas.getContext('2d')) {\n    // Check for WebP support\n    const support = canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\n    window._webpSupport = support;\n    return support;\n  }\n  \n  window._webpSupport = false;\n  return false;\n};\n\n/**\n * Generate responsive image srcset\n * Creates multiple sizes for different screen resolutions\n */\nexport const getResponsiveSrcSet = (imageUrl, sizes = [400, 800, 1200]) => {\n  if (!imageUrl) return '';\n  \n  return sizes\n    .map(size => {\n      const url = appendSizeParam(imageUrl, size);\n      return `${url} ${size}w`;\n    })\n    .join(', ');\n};\n\n/**\n * Append size parameter to image URL\n */\nconst appendSizeParam = (imageUrl, width) => {\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&w=${width}`;\n  }\n  return `${imageUrl}?w=${width}`;\n};\n\n/**\n * Lazy load image with Intersection Observer.\n * Returns a ref callback. Callback receives element on mount and null on unmount.\n * Observer is disconnected when element is removed or component unmounts.\n */\nexport const useLazyLoad = () => {\n  const observerRef = useRef(null);\n  if (typeof window === 'undefined' || !('IntersectionObserver' in window)) {\n    return () => {}; // no-op when IO unavailable\n  }\n\n  return (imageElement) => {\n    const prev = observerRef.current;\n    if (prev) {\n      prev.disconnect();\n      observerRef.current = null;\n    }\n    if (!imageElement || !(imageElement instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const img = entry.target;\n            const src = img.getAttribute('data-src');\n            const srcset = img.getAttribute('data-srcset');\n            if (src) img.src = src;\n            if (srcset) img.srcset = srcset;\n            img.classList.add('loaded');\n            observer.unobserve(img);\n          }\n        });\n      },\n      { rootMargin: '50px 0px', threshold: 0.01 }\n    );\n    try {\n      observer.observe(imageElement);\n      observerRef.current = observer;\n    } catch {\n      observerRef.current = null;\n    }\n  };\n};\n\n/**\n * OptimizedImage Component Helper\n * Returns optimized image props\n */\nexport const getOptimizedImageProps = (imageUrl, alt = '', options = {}) => {\n  const {\n    width,\n    height,\n    quality = 80,\n    lazy = true,\n    responsive = true,\n    className = ''\n  } = options;\n\n  const optimizedUrl = toWebP(imageUrl, quality);\n  const props = {\n    alt,\n    className: `${className} ${lazy ? 'lazy' : ''}`,\n    loading: lazy ? 'lazy' : 'eager',\n    decoding: 'async'\n  };\n\n  if (responsive) {\n    props.srcSet = getResponsiveSrcSet(optimizedUrl);\n    props.sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw';\n  }\n\n  if (lazy) {\n    props['data-src'] = optimizedUrl;\n    props.src = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 300\"%3E%3C/svg%3E'; // Placeholder\n  } else {\n    props.src = optimizedUrl;\n  }\n\n  if (width) props.width = width;\n  if (height) props.height = height;\n\n  return props;\n};\n\n/**\n * Preload critical images\n */\nexport const preloadImage = (imageUrl) => {\n  if (typeof window === 'undefined') return;\n  \n  const link = document.createElement('link');\n  link.rel = 'preload';\n  link.as = 'image';\n  link.href = toWebP(imageUrl);\n  document.head.appendChild(link);\n};\n\n/**\n * Calculate image dimensions to maintain aspect ratio\n */\nexport const calculateAspectRatio = (originalWidth, originalHeight, maxWidth) => {\n  const ratio = originalHeight / originalWidth;\n  return {\n    width: maxWidth,\n    height: Math.round(maxWidth * ratio)\n  };\n};\n\n/**\n * Image compression quality based on screen size\n */\nexport const getAdaptiveQuality = () => {\n  if (typeof window === 'undefined') return 80;\n  \n  const width = window.innerWidth;\n  \n  if (width < 768) {\n    return 70; // Mobile: lower quality\n  } else if (width < 1920) {\n    return 80; // Desktop: medium quality\n  } else {\n    return 90; // Large screens: high quality\n  }\n};\n\nexport default {\n  toWebP,\n  isWebPSupported,\n  getResponsiveSrcSet,\n  useLazyLoad,\n  getOptimizedImageProps,\n  preloadImage,\n  calculateAspectRatio,\n  getAdaptiveQuality\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { Heart, Eye, ShoppingBag, Info, ThumbsUp, ThumbsDown, Bell, ShoppingCart } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\nimport { SmartBadges, StockBadge } from '../ui/Badge';\nimport { getOptimizedImageProps, getAdaptiveQuality } from '../../utils/imageOptimizer';\nimport {\n  trackSectionEvent,\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n// Tiny placeholder for blur-up effect (1x1 transparent pixel)\nconst BLUR_PLACEHOLDER = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1 1\"%3E%3Crect fill=\"%23f3f4f6\" width=\"1\" height=\"1\"/%3E%3C/svg%3E';\n\nconst PLACEHOLDER_IMAGE = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\" viewBox=\"0 0 400 400\"%3E%3Crect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/%3E%3Ctext fill=\"%239ca3af\" font-family=\"sans-serif\" font-size=\"14\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\"%3ENo Image%3C/text%3E%3C/svg%3E';\n\n/**\n * Enhanced Product Card with:\n * - Blur-up lazy loading images\n * - Smart badges (New, Sale, Popular)\n * - Micro-interactions\n * - Scroll animations\n */\nexport const EnhancedProductCard = ({ \n  product, \n  onToggleWishlist, \n  isWishlisted, \n  onQuickView,\n  onAddToCart,\n  index = 0,\n  highlightBadge,\n  recommendationReasons = [],\n  sectionId,\n  showFeedback = true,\n  size = 'default',\n  tone = 'default',\n  accentClass, // vilg gradiens pl. 'from-pink-500 to-rose-600'  teljes krtys megklnbztets\n  skipScrollAnimation = false, // Worlds: lland megjelens, ne villanjon fel\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const [isVisible, setIsVisible] = useState(skipScrollAnimation);\n  const [notifySaved, setNotifySaved] = useState(false);\n  const toneClasses = {\n    default: 'lux-card',\n    popular: 'lux-card lux-card--popular',\n    new: 'lux-card lux-card--new',\n    favorites: 'lux-card lux-card--favorites',\n    personal: 'lux-card lux-card--personal'\n  };\n  const sizeClasses = {\n    default: {\n      image: 'p-2 sm:p-3 md:p-4 lg:p-5',\n      content: 'p-3 sm:p-4 md:p-5 lg:p-6',\n      contentMinH: 'min-h-[160px] sm:min-h-[180px]'\n    },\n    compact: {\n      image: 'p-2 sm:p-2.5 md:p-3 lg:p-3.5',\n      content: 'p-2.5 sm:p-3 md:p-4 lg:p-4',\n      contentMinH: 'min-h-[140px] sm:min-h-[155px]'\n    }\n  };\n  const sizeConfig = sizeClasses[size] || sizeClasses.default;\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const cardRef = useRef(null);\n  const impressionRef = useRef(false);\n\n  const images = product.images || [];\n  const mainImage = images[0] || PLACEHOLDER_IMAGE;\n\n  const discount = product.salePrice && product.price > product.salePrice\n    ? Math.round(((product.price - product.salePrice) / product.price) * 100)\n    : 0;\n\n  const displayPrice = product.salePrice || product.price;\n  const inStock = product.inStock ?? product.in_stock ?? true;\n  const reasonsText = recommendationReasons && recommendationReasons.length > 0\n    ? recommendationReasons.slice(0, 2).join('  ')\n    : '';\n  const optimizedProps = getOptimizedImageProps(mainImage, product.name, { responsive: true, lazy: false, quality: getAdaptiveQuality() });\n\n  // Intersection Observer for scroll animation  kihagyva ha skipScrollAnimation (Worlds)\n  const timeoutRef = useRef(null);\n  useEffect(() => {\n    if (skipScrollAnimation) return;\n    const element = cardRef.current;\n    if (!element || !(element instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          const delay = Math.min((index % 4) * 25, 100);\n          if (delay > 0) {\n            timeoutRef.current = setTimeout(() => setIsVisible(true), delay);\n          } else {\n            setIsVisible(true);\n          }\n          observer.disconnect();\n        }\n      },\n      { threshold: 0.05, rootMargin: '100px 0px' }\n    );\n\n    try {\n      observer.observe(element);\n    } catch {\n      return;\n    }\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      observer.disconnect();\n    };\n  }, [index, skipScrollAnimation]);\n\n  useEffect(() => {\n    if (sectionId && isVisible && !impressionRef.current) {\n      impressionRef.current = true;\n      trackSectionEvent(sectionId, 'impression', product?.id);\n    }\n  }, [sectionId, isVisible, product?.id]);\n\n  useEffect(() => {\n    if (!product?.id) return;\n    setFeedbackState({\n      liked: isProductLiked(product.id),\n      disliked: isProductDisliked(product.id)\n    });\n  }, [product?.id]);\n\n  const handleQuickView = () => {\n    if (sectionId) trackSectionEvent(sectionId, 'click', product?.id);\n    onQuickView?.(product);\n  };\n\n  const handleNotify = (e) => {\n    e.stopPropagation();\n    requestBackInStock(product);\n    setNotifySaved(true);\n    setTimeout(() => setNotifySaved(false), 2000);\n  };\n\n  const hasWorldAccent = accentClass && (tone === 'favorites' || tone === 'new' || tone === 'popular');\n  const worldGlow = hasWorldAccent && {\n    favorites: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(244,63,94,0.18) 0%, transparent 50%)',\n    new: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(139,92,246,0.18) 0%, transparent 50%)',\n    popular: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(251,191,36,0.18) 0%, transparent 50%)',\n  }[tone];\n  const worldCorner = hasWorldAccent && {\n    favorites: 'linear-gradient(135deg, rgba(244,63,94,0.45) 0%, transparent 40%)',\n    new: 'linear-gradient(135deg, rgba(139,92,246,0.45) 0%, transparent 40%)',\n    popular: 'linear-gradient(135deg, rgba(251,191,36,0.45) 0%, transparent 40%)',\n  }[tone];\n\n  return (\n    <article \n      ref={cardRef}\n      className={`\n        group relative rounded-lg overflow-hidden bg-white border border-gray-200 shadow-sm\n        hover:shadow-md hover:border-gray-300 hover:-translate-y-0.5 active:scale-[0.99]\n        h-full flex flex-col touch-manipulation\n        ${toneClasses[tone] || ''}\n        ${isVisible ? 'opacity-100' : 'opacity-0 translate-y-3'}\n        transition-all duration-200\n      `}\n      style={{ willChange: isVisible ? 'auto' : 'opacity, transform' }}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Vilg dizjn  krtya elejn, nem mlyen (magas z-index, de badge/wishlist alatt) */}\n      {hasWorldAccent && (\n        <>\n          <div className=\"absolute inset-0 z-[1] pointer-events-none\" style={{ background: worldGlow }} aria-hidden />\n          <div className=\"absolute top-0 left-0 w-16 h-16 z-[2] pointer-events-none\" style={{ background: worldCorner, clipPath: 'polygon(0 0, 100% 0, 0 100%)' }} aria-hidden />\n          <div className={`absolute top-0 left-0 right-0 h-2 sm:h-2.5 bg-gradient-to-r ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n          <div className={`absolute top-0 left-0 h-10 sm:h-12 w-0.5 sm:w-1 bg-gradient-to-b ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n        </>\n      )}\n      {/* Smart Badges - kisebb mobilon */}\n      <div className=\"absolute top-2 sm:top-3 left-2 sm:left-3 z-20\">\n        <SmartBadges product={product} maxBadges={2} />\n        {highlightBadge && (\n          <span className=\"mt-1.5 inline-flex items-center px-2 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-700\">\n            {highlightBadge}\n          </span>\n        )}\n      </div>\n\n      {/* Wishlist Button - min 44px touch target mobilon */}\n      <button \n        onClick={(e) => { \n          e.stopPropagation(); \n          onToggleWishlist?.(product.id); \n        }} \n        className={`\n          absolute top-2 sm:top-3 right-2 sm:right-4 z-20\n          min-w-[44px] min-h-[44px] w-10 h-10 sm:w-11 sm:h-11 lg:w-12 lg:h-12 flex items-center justify-center \n          rounded-full shadow-md tap-scale touch-manipulation\n          ${isWishlisted \n            ? 'bg-red-500 text-white' \n            : 'bg-white/95 text-gray-500 hover:text-red-500'\n          }\n          focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n        `}\n        style={{ transition: 'background-color 0.15s, color 0.15s' }}\n        aria-label={isWishlisted ? 'Eltvolts' : 'Kedvencekhez'}\n      >\n        <Heart className={`w-5 h-5 sm:w-5 sm:h-5 lg:w-6 lg:h-6 ${isWishlisted ? 'fill-current' : ''}`} />\n      </button>\n\n      {reasonsText && (\n        <div className=\"absolute top-14 sm:top-16 right-3 sm:right-4 z-20 group\">\n          <button\n            type=\"button\"\n            className=\"w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center rounded-full bg-white/95 text-gray-500 shadow-md hover:text-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Mirt ezt ajnljuk?\"\n            title={reasonsText}\n          >\n            <Info className=\"w-4 h-4\" />\n          </button>\n          <div className=\"absolute right-0 mt-2 w-56 p-2 rounded-lg bg-gray-900 text-white text-xs opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity shadow-xl\">\n            {reasonsText}\n          </div>\n        </div>\n      )}\n\n      {/* Image Section - FILL the space */}\n      <div \n        onClick={handleQuickView} \n        className=\"relative aspect-square overflow-hidden ecom-card__image cursor-pointer\"\n      >\n        {/* Simple placeholder */}\n        {!imageLoaded && (\n          <div className=\"absolute inset-0 bg-gray-100\" />\n        )}\n        \n        {/* Actual image - width/height prevents CLS */}\n        <img \n          src={imageError ? PLACEHOLDER_IMAGE : (optimizedProps.src || mainImage)}\n          alt={product.name}\n          width={400}\n          height={400}\n          className={`\n            w-full h-full object-contain ${sizeConfig.image}\n            transition-opacity duration-300 ease-out\n            ${imageLoaded ? 'opacity-100' : 'opacity-0'}\n          `}\n          style={{ transform: 'translateZ(0)' }}\n          srcSet={optimizedProps.srcSet}\n          sizes={optimizedProps.sizes}\n          loading=\"lazy\"\n          decoding=\"async\"\n          onLoad={() => setImageLoaded(true)}\n          onError={() => { setImageError(true); setImageLoaded(true); }}\n        />\n\n        {!inStock && (\n          <div className=\"absolute inset-0 bg-white/70 backdrop-blur-[1px] flex items-center justify-center\">\n            <div className=\"flex flex-col items-center gap-2\">\n              <span className=\"px-3 py-1.5 rounded-full bg-gray-900 text-white text-xs font-bold tracking-wide\">\n                Elfogyott\n              </span>\n              <button\n                type=\"button\"\n                onClick={handleNotify}\n                className=\"px-3 py-1.5 rounded-full bg-white text-gray-800 text-xs font-semibold border border-gray-200 hover:bg-gray-50 flex items-center gap-1\"\n              >\n                <Bell className=\"w-3.5 h-3.5\" />\n                {notifySaved ? 'Elmentve' : 'rtestst krek'}\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {/* Stock badge - kompakt mobilon */}\n        <div className=\"absolute bottom-1.5 sm:bottom-2.5 left-1.5 sm:left-2.5\">\n          <StockBadge inStock={inStock} size=\"sm\" />\n        </div>\n        \n        {/* Desktop hover overlay */}\n        <div \n          className=\"hidden md:flex absolute inset-0 bg-black/40 items-end justify-center pb-6 lg:pb-8 transition-opacity duration-200\"\n          style={{ opacity: isHovered ? 1 : 0, pointerEvents: isHovered ? 'auto' : 'none' }}\n        >\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onQuickView?.(product);\n            }}\n            className=\"bg-white text-gray-900 px-6 py-3 lg:px-8 lg:py-3.5 rounded-full text-base lg:text-lg font-bold shadow-lg flex items-center gap-2 hover:bg-gray-50 tap-scale focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n          >\n            <Eye className=\"w-5 h-5 lg:w-6 lg:h-6\" /> \n            Megnzem\n          </button>\n        </div>\n      </div>\n\n      {/* Content Section - gombok alul, kzpre, magasabb krtya */}\n      <div className={`${sizeConfig.content} ${sizeConfig.contentMinH || 'min-h-[160px]'} flex flex-col flex-1`}>\n        {/* Category - kompakt */}\n        <span className=\"text-xs sm:text-sm font-semibold text-primary-600 uppercase tracking-wide mb-1 truncate\">\n          {product.category}\n        </span>\n        \n        {/* Product Name - 2 sor, biztosan frjen ki, kompakt betmret */}\n        <h3 \n          onClick={handleQuickView} \n          className=\"text-xs sm:text-sm lg:text-base font-bold text-gray-900 line-clamp-2 leading-tight cursor-pointer hover:text-primary-600 active:text-primary-700 transition-colors mb-2 min-h-[2.4em] overflow-hidden touch-manipulation\" \n          title={product.name}\n        >\n          {product.name}\n        </h3>\n        \n        {/* r - nagy, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"pt-2 sm:pt-3 border-t border-gray-100 text-center space-y-1 min-w-0\">\n          {discount > 0 ? (\n            <>\n              <span className=\"text-sm sm:text-base text-red-600 line-through block font-semibold\">\n                {formatPrice(product.price)}\n              </span>\n              <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-red-600 block\">\n                {formatPrice(displayPrice)}\n              </span>\n              <span className=\"inline-block px-2 py-1 rounded-md bg-red-100 text-red-700 text-xs sm:text-sm font-black\">\n                -{discount}%\n              </span>\n            </>\n          ) : (\n            <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-gray-900 block\">\n              {formatPrice(displayPrice)}\n            </span>\n          )}\n        </div>\n        \n        {/* Tetszik / Nem tetszik - ikonok csak, kzpre, a CTA gombok fl */}\n        {showFeedback && (\n          <div className=\"mt-3 flex justify-center items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleLikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.liked\n                  ? 'bg-green-500 text-white'\n                  : 'bg-green-50 text-green-600 hover:bg-green-100'\n              }`}\n              aria-label={feedbackState.liked ? 'Tetszik (eltvolts)' : 'Tetszik'}\n            >\n              <ThumbsUp className=\"w-5 h-5\" />\n            </button>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleDislikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.disliked\n                  ? 'bg-red-500 text-white'\n                  : 'bg-red-50 text-red-500 hover:bg-red-100'\n              }`}\n              aria-label={feedbackState.disliked ? 'Nem tetszik (eltvolts)' : 'Nem tetszik'}\n            >\n              <ThumbsDown className=\"w-5 h-5\" />\n            </button>\n          </div>\n        )}\n        \n        {/* CTA gombok - Kosrba hangslyosabb */}\n        <div className=\"mt-3 sm:mt-4 flex justify-center items-center gap-2 sm:gap-3\">\n          {inStock && onAddToCart && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                onAddToCart(product, 1);\n              }}\n              className=\"min-h-[44px] flex-1 sm:flex-initial flex items-center justify-center gap-1.5 px-4 py-2.5 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 active:bg-emerald-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 shadow-lg shadow-emerald-500/30 font-bold text-sm sm:text-base\"\n              aria-label=\"Kosrba\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-5 h-5 shrink-0\" />\n              <span>Kosrba</span>\n            </button>\n          )}\n          <button \n            onClick={(e) => { \n              e.stopPropagation(); \n              handleQuickView(); \n            }} \n            className=\"min-h-[44px] min-w-[44px] flex items-center justify-center p-2.5 sm:px-4 sm:py-2.5 bg-primary-500 text-white rounded-xl hover:bg-primary-600 active:bg-primary-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Megnzem\"\n            title=\"Megnzem\"\n          >\n            <Eye className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            <span className=\"hidden sm:inline text-sm font-bold ml-1.5\">Megnzem</span>\n          </button>\n        </div>\n      </div>\n    </article>\n  );\n};\n\nexport default EnhancedProductCard;\n","import React, { useMemo, useState, useEffect, useRef, useCallback } from 'react';\nimport { \n  ArrowLeft, TrendingUp, Package, Tag, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown,\n  ChevronRight, Filter, Grid3X3, List, Star, Home,\n  ArrowUpDown, SlidersHorizontal, X, Check, LayoutGrid,\n  Rows3, Plus, GitCompare, ChevronDown, ChevronUp, BookOpen,\n  ShieldCheck, MapPin\n} from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { formatPrice } from '../../utils/helpers';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getLikedProducts, getViewedProducts, toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\n\nconst PRESET_STORAGE_KEY = 'mkt_category_presets';\n\n/**\n * Category Images - unsplash stock photos by category\n */\nconst CATEGORY_IMAGES = {\n  'Kanap': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Kanapk': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Fotel': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=1200&q=80',\n  'Nappali': 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=1200&q=80',\n  'gy': 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=1200&q=80',\n  'Hlszoba': 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=1200&q=80',\n  'Matrac': 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=1200&q=80',\n  'Asztal': 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=1200&q=80',\n  'Szk': 'https://images.unsplash.com/photo-1503602642458-232111445657?w=1200&q=80',\n  'Iroda': 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=1200&q=80',\n  'Szekrny': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=1200&q=80',\n  'Lmpa': 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=1200&q=80',\n  'Kert': 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=1200&q=80',\n  'default': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80'\n};\n\nconst getCategoryImage = (name) => {\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (name?.toLowerCase().includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n\n/**\n * Category color themes\n */\nconst getCategoryTheme = (categoryName) => {\n  const themes = {\n    'Kanap': { gradient: 'from-blue-600/90 to-primary-700/90', accent: 'indigo' },\n    'Fotel': { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'purple' },\n    'Nappali': { gradient: 'from-secondary-700/90 to-secondary-800/90', accent: 'violet' },\n    'gy': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'purple' },\n    'Hlszoba': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'pink' },\n    'Asztal': { gradient: 'from-amber-600/90 to-orange-800/90', accent: 'amber' },\n    'Szk': { gradient: 'from-yellow-600/90 to-amber-800/90', accent: 'yellow' },\n    'Iroda': { gradient: 'from-slate-600/90 to-gray-800/90', accent: 'slate' },\n    'Szekrny': { gradient: 'from-teal-600/90 to-cyan-800/90', accent: 'teal' },\n    'Lmpa': { gradient: 'from-yellow-500/90 to-orange-700/90', accent: 'yellow' },\n    'Kert': { gradient: 'from-green-600/90 to-emerald-800/90', accent: 'green' },\n    default: { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'indigo' }\n  };\n  \n  for (const [key, theme] of Object.entries(themes)) {\n    if (categoryName?.toLowerCase().includes(key.toLowerCase())) return theme;\n  }\n  return themes.default;\n};\n\n/**\n * Breadcrumb Navigation\n */\nconst Breadcrumb = ({ category, onBack }) => (\n  <nav className=\"flex items-center gap-2 text-sm mb-4 animate-fade-in\">\n    <button onClick={onBack} className=\"flex items-center gap-1 text-white/70 hover:text-white transition-colors\">\n      <Home className=\"w-4 h-4\" />\n      <span>Foldal</span>\n    </button>\n    <ChevronRight className=\"w-4 h-4 text-white/50\" />\n    <span className=\"text-white font-medium\">{category}</span>\n  </nav>\n);\n\n/**\n * Category Hero with Image Background\n */\nconst CategoryHero = ({ category, productCount, theme, onBack }) => {\n  const CategoryIcon = getCategoryIcon(category);\n  const bgImage = getCategoryImage(category);\n  \n  return (\n    <div className=\"relative overflow-hidden\">\n      {/* Background Image */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${bgImage})` }}\n      />\n      \n      {/* Gradient Overlay */}\n      <div className={`absolute inset-0 bg-gradient-to-br ${theme.gradient}`} />\n      \n      {/* Content - FULL WIDTH and LARGER on desktop */}\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 xl:py-36 text-white\">\n        <Breadcrumb category={category} onBack={onBack} />\n        \n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6 sm:gap-10 lg:gap-14\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 lg:w-36 lg:h-36 xl:w-40 xl:h-40 bg-white/20 backdrop-blur rounded-2xl lg:rounded-3xl flex items-center justify-center animate-scale-in\">\n            <CategoryIcon className=\"w-10 h-10 sm:w-14 sm:h-14 lg:w-18 lg:h-18 xl:w-20 xl:h-20 text-white\" />\n          </div>\n          \n          <div className=\"animate-fade-in-up\">\n            <h1 className=\"text-4xl sm:text-6xl lg:text-7xl xl:text-8xl font-bold mb-3 lg:mb-5\">\n              {category}\n            </h1>\n            <p className=\"text-white/80 text-lg sm:text-xl lg:text-2xl xl:text-3xl\">\n              <span className=\"font-semibold text-white\">{productCount.toLocaleString('hu-HU')}</span> termk ebben a kategriban\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Sidebar Filters\n */\nconst SidebarFilters = ({ \n  products, \n  filters, \n  onFilterChange, \n  priceRange, \n  onPriceRangeChange,\n  isOpen,\n  onClose\n}) => {\n  // Extract unique values from products\n  const filterOptions = useMemo(() => {\n    const brands = new Map();\n    const colors = new Map();\n    \n    products.forEach(p => {\n      if (p.brand) brands.set(p.brand, (brands.get(p.brand) || 0) + 1);\n      if (p.color) colors.set(p.color, (colors.get(p.color) || 0) + 1);\n    });\n    \n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    const minPrice = Math.min(...prices) || 0;\n    const maxPrice = Math.max(...prices) || 1000000;\n    \n    return {\n      brands: Array.from(brands.entries()).sort((a, b) => b[1] - a[1]),\n      colors: Array.from(colors.entries()).sort((a, b) => b[1] - a[1]),\n      priceMin: minPrice,\n      priceMax: maxPrice\n    };\n  }, [products]);\n\n  const previewCounts = useMemo(() => {\n    const brandCounts = new Map();\n    const colorCounts = new Map();\n    let inStock = 0;\n\n    products.forEach((p) => {\n      const price = p.salePrice || p.price || 0;\n      if (price < priceRange[0] || price > priceRange[1]) return;\n\n      const isInStock = p.inStock ?? p.in_stock ?? true;\n      const brandOk = !filters.brands?.length || filters.brands.includes(p.brand);\n      const colorOk = !filters.colors?.length || filters.colors.includes(p.color);\n\n      if (brandOk && colorOk && isInStock) inStock += 1;\n\n      const baseForBrand = (filters.inStockOnly ? isInStock : true) && colorOk;\n      if (baseForBrand && p.brand) {\n        brandCounts.set(p.brand, (brandCounts.get(p.brand) || 0) + 1);\n      }\n\n      const baseForColor = (filters.inStockOnly ? isInStock : true) && brandOk;\n      if (baseForColor && p.color) {\n        colorCounts.set(p.color, (colorCounts.get(p.color) || 0) + 1);\n      }\n    });\n\n    return { brands: brandCounts, colors: colorCounts, inStock };\n  }, [products, filters, priceRange]);\n\n  const toggleFilter = (type, value) => {\n    const current = filters[type] || [];\n    const updated = current.includes(value)\n      ? current.filter(v => v !== value)\n      : [...current, value];\n    onFilterChange({ ...filters, [type]: updated });\n  };\n\n  const FilterSection = ({ title, items, type, icon: Icon }) => (\n    <div className=\"border-b border-gray-100 pb-4 mb-4\">\n      <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n        {Icon && <Icon className=\"w-4 h-4 text-gray-400\" />}\n        {title}\n      </h4>\n      <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n        {items.map(([item, count]) => {\n          const preview = type === 'brands'\n            ? previewCounts.brands.get(item)\n            : type === 'colors'\n              ? previewCounts.colors.get(item)\n              : count;\n          return (\n          <label key={item} className=\"flex items-center justify-between gap-2 cursor-pointer group\">\n            <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              checked={(filters[type] || []).includes(item)}\n              onChange={() => toggleFilter(type, item)}\n              className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n            />\n            <span className=\"text-sm text-gray-600 group-hover:text-gray-900\">{item}</span>\n            </div>\n            <span className=\"text-xs text-gray-400\">{preview ?? count}</span>\n          </label>\n        )})}\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div className=\"p-4 sm:p-0\">\n      <div className=\"flex items-center justify-between mb-6 sm:hidden\">\n        <h3 className=\"text-lg font-bold text-gray-900\">Szrk</h3>\n        <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg\">\n          <X className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Price Range */}\n      <div className=\"border-b border-gray-100 pb-4 mb-4\">\n        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n          <Tag className=\"w-4 h-4 text-gray-400\" />\n          rtartomny\n        </h4>\n        <div className=\"space-y-3\">\n          <input\n            type=\"range\"\n            min={filterOptions.priceMin}\n            max={filterOptions.priceMax}\n            value={priceRange[1]}\n            onChange={(e) => onPriceRangeChange([priceRange[0], parseInt(e.target.value)])}\n            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n          />\n          <div className=\"flex justify-between text-sm text-gray-500\">\n            <span>{priceRange[0].toLocaleString('hu-HU')} Ft</span>\n            <span>{priceRange[1].toLocaleString('hu-HU')} Ft</span>\n          </div>\n        </div>\n      </div>\n\n      {filterOptions.brands.length > 0 && (\n        <FilterSection title=\"Mrka\" items={filterOptions.brands} type=\"brands\" icon={Package} />\n      )}\n      \n      {filterOptions.colors.length > 0 && (\n        <FilterSection title=\"Szn\" items={filterOptions.colors} type=\"colors\" icon={Tag} />\n      )}\n\n      {/* Stock Filter */}\n      <div className=\"pb-4\">\n        <label className=\"flex items-center gap-2 cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={filters.inStockOnly}\n            onChange={() => onFilterChange({ ...filters, inStockOnly: !filters.inStockOnly })}\n            className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n          />\n          <span className=\"text-sm text-gray-700\">Csak kszleten ({previewCounts.inStock})</span>\n        </label>\n      </div>\n\n      {/* Clear Filters */}\n      <button\n        onClick={() => onFilterChange({})}\n        className=\"w-full py-2 text-sm text-primary-500 hover:text-primary-600 font-medium\"\n      >\n        Szrk trlse\n      </button>\n    </div>\n  );\n\n  return (\n    <>\n      {/* Desktop Sidebar */}\n      <div className=\"hidden lg:block w-64 shrink-0\">\n        <div className=\"sticky top-24 bg-white rounded-2xl border border-gray-100 p-5\">\n          <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n            <SlidersHorizontal className=\"w-5 h-5\" />\n            Szrk\n          </h3>\n          {content}\n        </div>\n      </div>\n\n      {/* Mobile Drawer */}\n      {isOpen && (\n        <div className=\"lg:hidden fixed inset-0 z-50\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={onClose} />\n          <div className=\"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-white animate-fade-in-right\">\n            {content}\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Related Categories\n */\nconst RelatedCategories = ({ currentCategory, allCategories, onCategoryChange }) => {\n  // Find related categories (same \"type\" or popular ones)\n  const related = useMemo(() => {\n    return allCategories\n      .filter(cat => cat.name !== currentCategory && cat.name !== 'sszes' && cat.count > 0)\n      .slice(0, 6);\n  }, [allCategories, currentCategory]);\n\n  if (related.length === 0) return null;\n\n  return (\n    <div className=\"bg-gray-50 rounded-2xl p-4 sm:p-6 mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Grid3X3 className=\"w-5 h-5 text-gray-400\" />\n        Kapcsold kategrik\n      </h3>\n      <div className=\"flex flex-wrap gap-2\">\n        {related.map(cat => {\n          const Icon = getCategoryIcon(cat.name);\n          return (\n            <button\n              key={cat.name}\n              onClick={() => onCategoryChange(cat.name)}\n              className=\"flex items-center gap-2 px-3 py-2 bg-white rounded-xl border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-colors tap-scale\"\n            >\n              <Icon className=\"w-4 h-4 text-gray-500\" />\n              <span className=\"text-sm font-medium text-gray-700\">{cat.name}</span>\n              <span className=\"text-xs text-gray-400\">({cat.count})</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Category Story Blocks\n */\nconst CategoryStory = ({ category }) => {\n  const base = category || 'Kategria';\n  const blocks = [\n    {\n      title: `${base} trtnet`,\n      text: 'Vlogatott anyagok, tarts szerkezet, idtll forma.',\n      icon: BookOpen\n    },\n    {\n      title: 'Anyag s komfort',\n      text: 'Llegz szvetek, masszv fa/fm vz, knyelmes hasznlat.',\n      icon: ShieldCheck\n    },\n    {\n      title: 'Elhelyezs',\n      text: 'Nappali, hl vagy iroda? Segtnk az idelis mret kivlasztsban.',\n      icon: MapPin\n    }\n  ];\n\n  return (\n    <div className=\"grid gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-3 mb-6\">\n      {blocks.map((block) => {\n        const Icon = block.icon;\n        return (\n          <div key={block.title} className=\"bg-white rounded-2xl border border-gray-100 p-4 sm:p-5 shadow-sm\">\n            <div className=\"w-10 h-10 rounded-xl bg-primary-50 text-primary-600 flex items-center justify-center mb-3\">\n              <Icon className=\"w-5 h-5\" />\n            </div>\n            <h3 className=\"font-bold text-gray-900 mb-1.5\">{block.title}</h3>\n            <p className=\"text-sm text-gray-600\">{block.text}</p>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n\n/**\n * Price Statistics Card\n */\nconst PriceStats = ({ products, stats }) => {\n  const computedStats = useMemo(() => {\n    if (stats && typeof stats.total === 'number') {\n      return {\n        min: stats.minPrice || 0,\n        max: stats.maxPrice || 0,\n        avg: stats.avgPrice || 0,\n        inStock: stats.inStockCount || 0\n      };\n    }\n    if (!products || products.length === 0) return null;\n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    if (prices.length === 0) return null;\n    return {\n      min: Math.min(...prices),\n      max: Math.max(...prices),\n      avg: prices.reduce((a, b) => a + b, 0) / prices.length,\n      inStock: products.filter(p => p.inStock !== false).length\n    };\n  }, [products, stats]);\n  \n  if (!computedStats) return null;\n  \n  return (\n    <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n      {[\n        { label: 'Legolcsbb', value: formatPrice(computedStats.min), color: 'text-green-600' },\n        { label: 'tlagr', value: formatPrice(computedStats.avg), color: 'text-gray-900' },\n        { label: 'Legdrgbb', value: formatPrice(computedStats.max), color: 'text-gray-900' },\n        { label: 'Kszleten', value: `${computedStats.inStock} db`, color: 'text-primary-500' }\n      ].map((stat, i) => (\n        <div key={i} className=\"bg-white rounded-xl p-3 sm:p-4 border border-gray-100\">\n          <p className=\"text-xs text-gray-500 mb-1\">{stat.label}</p>\n          <p className={`text-base sm:text-lg font-bold ${stat.color}`}>{stat.value}</p>\n        </div>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Featured Products\n */\nconst FeaturedProducts = ({ products, onProductClick, onWishlistToggle, wishlist, onAddToCart }) => {\n  const featured = useMemo(() => {\n    return products\n      .filter(p => p.salePrice && p.price > p.salePrice)\n      .sort((a, b) => ((b.price - b.salePrice) / b.price) - ((a.price - a.salePrice) / a.price))\n      .slice(0, 6);\n  }, [products]);\n  \n  if (featured.length === 0) return null;\n  \n  return (\n    <div className=\"mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Star className=\"w-5 h-5 text-amber-500\" />\n        Kiemelt ajnlatok\n      </h3>\n      <div className=\"flex gap-4 overflow-x-auto pb-4 scrollbar-hide -mx-4 px-4\">\n        {featured.map((product, index) => (\n          <div key={product.id} className=\"w-44 sm:w-52 shrink-0\">\n            <EnhancedProductCard\n              product={product}\n              onQuickView={onProductClick}\n              onToggleWishlist={onWishlistToggle}\n              onAddToCart={onAddToCart}\n              isWishlisted={wishlist?.includes(product.id)}\n              index={index}\n            />\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Compact Product Card - mint EnhancedProductCard: like/dislike, r formzs\n */\nconst CompactProductCard = ({ product, onQuickView, onToggleWishlist, isWishlisted, onAddToCart, onCompare, isComparing }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow tap-scale touch-manipulation\">\n      <img \n        src={product.images?.[0] || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onQuickView(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 \n          className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\"\n          onClick={() => onQuickView(product)}\n        >\n          {product.name}\n        </h4>\n        {/* r - nagyobb, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-xs sm:text-sm text-red-600 line-through block font-semibold\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-base sm:text-lg font-black text-red-600 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1.5 py-0.5 rounded bg-red-100 text-red-700 text-[10px] sm:text-xs font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-base sm:text-lg font-black text-gray-900 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        {/* Like/Dislike + CTA - Kosrba hangslyosabb */}\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onCompare?.(product)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isComparing ? 'bg-primary-100 text-primary-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <GitCompare className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => onToggleWishlist(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isWishlisted ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <Star className={`w-4 h-4 ${isWishlisted ? 'fill-current' : ''}`} />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * AI Recommendations Banner\n */\nconst AIBanner = ({ category, onAskAI }) => (\n  <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6 animate-fade-in\">\n    <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n      <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n        <Sparkles className=\"w-6 h-6\" />\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n        <p className=\"text-white/80 text-sm\">Melyik {category.toLowerCase()} illik hozzd?</p>\n      </div>\n      <button\n        onClick={onAskAI}\n        className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors tap-scale\"\n      >\n        AI Tancsad\n      </button>\n    </div>\n  </div>\n);\n\n/**\n * View & Sort Controls\n */\nconst ViewControls = ({ \n  sortOption, onSortChange, \n  viewMode, onViewModeChange, \n  loadedCount,\n  totalCount,\n  onOpenFilters,\n  compareCount\n}) => (\n  <div className=\"flex flex-wrap items-center justify-between gap-3 mb-4 pb-4 border-b border-gray-100\">\n    <div className=\"flex items-center gap-3\">\n      <button\n        onClick={onOpenFilters}\n        className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700 tap-scale\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        Szrk\n      </button>\n      <div className=\"text-sm text-gray-500\">\n        <p>\n          <span className=\"font-semibold text-gray-900\">{loadedCount.toLocaleString('hu-HU')}</span>\n          {totalCount > 0 && (\n            <span className=\"text-gray-400 ml-1\">/ {totalCount.toLocaleString('hu-HU')}</span>\n          )}\n          <span className=\"ml-1\">termk</span>\n        </p>\n        {totalCount > 0 && (\n          <div className=\"mt-1 h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-primary-500 rounded-full transition-all\"\n              style={{ width: `${Math.min(100, Math.round((loadedCount / totalCount) * 100))}%` }}\n            />\n          </div>\n        )}\n      </div>\n      {compareCount > 0 && (\n        <span className=\"px-2 py-1 bg-primary-100 text-primary-600 text-xs font-medium rounded-full\">\n          {compareCount} sszehasonltsra\n        </span>\n      )}\n    </div>\n    \n    <div className=\"flex items-center gap-2\">\n      <select\n        value={sortOption}\n        onChange={(e) => onSortChange(e.target.value)}\n        className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n      >\n        <option value=\"default\">Relevancia</option>\n        <option value=\"smart\">Okos (ajnlott)</option>\n        <option value=\"price-asc\">r </option>\n        <option value=\"price-desc\">r </option>\n        <option value=\"name-asc\">Nv A-Z</option>\n        <option value=\"discount\">Kedvezmny</option>\n      </select>\n      \n      <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n        {[\n          { mode: 'grid', icon: LayoutGrid },\n          { mode: 'compact', icon: Rows3 },\n        ].map(({ mode, icon: Icon }) => (\n          <button\n            key={mode}\n            onClick={() => onViewModeChange(mode)}\n            className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n          >\n            <Icon className=\"w-5 h-5\" />\n          </button>\n        ))}\n      </div>\n    </div>\n  </div>\n);\n\n/**\n * Main Category Page Component\n */\nconst CategoryPage = ({\n  category,\n  products,\n  allCategories = [],\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  onCategoryChange,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  totalCount = 0,\n  loadedCount = 0,\n  stats,\n  onLoadMore,\n  onScrollToSection\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [filters, setFilters] = useState({});\n  const [priceRange, setPriceRange] = useState([0, 10000000]);\n  const [showFilters, setShowFilters] = useState(false);\n  const [compareList, setCompareList] = useState([]);\n  const [presetName, setPresetName] = useState('');\n  const [savedPresets, setSavedPresets] = useState([]);\n  const loadMoreRef = useRef(null);\n  \n  const theme = getCategoryTheme(category);\n  const likedIds = useMemo(() => getLikedProducts(), []);\n  const viewedIds = useMemo(() => getViewedProducts(30).map((p) => p.id), []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(PRESET_STORAGE_KEY);\n      setSavedPresets(raw ? JSON.parse(raw) : []);\n    } catch {\n      setSavedPresets([]);\n    }\n  }, [category]);\n\n  useEffect(() => {\n    const t = setTimeout(() => onScrollToSection?.(), 50);\n    return () => clearTimeout(t);\n  }, [category]);\n\n  const savePreset = () => {\n    const name = presetName.trim();\n    if (!name) return;\n    const next = [\n      {\n        id: `${Date.now()}`,\n        name,\n        filters,\n        priceRange,\n        sortOption,\n        viewMode\n      },\n      ...savedPresets.filter((p) => p.name !== name)\n    ].slice(0, 6);\n    setSavedPresets(next);\n    setPresetName('');\n    try {\n      localStorage.setItem(PRESET_STORAGE_KEY, JSON.stringify(next));\n    } catch {}\n  };\n\n  const applyPreset = (preset) => {\n    setFilters(preset.filters || {});\n    setPriceRange(preset.priceRange || [0, 10000000]);\n    setSortOption(preset.sortOption || 'default');\n    setViewMode(preset.viewMode || 'grid');\n  };\n\n  const quickApply = (type) => {\n    if (type === 'in-stock') {\n      setFilters((prev) => ({ ...prev, inStockOnly: true }));\n      return;\n    }\n    if (type === 'under-100') {\n      setPriceRange([0, 100000]);\n      return;\n    }\n    if (type === 'premium') {\n      setPriceRange([250000, priceRange[1]]);\n      return;\n    }\n    if (type === 'discount') {\n      setSortOption('discount');\n      return;\n    }\n  };\n\n  const quickCounts = useMemo(() => {\n    const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true)).length;\n    const under100 = products.filter((p) => (p.salePrice || p.price) <= 100000).length;\n    const premium = products.filter((p) => (p.salePrice || p.price) >= 250000).length;\n    const discount = products.filter((p) => p.salePrice && p.price > p.salePrice).length;\n    return { inStock, under100, premium, discount };\n  }, [products]);\n  \n  // Initialize price range from products\n  useEffect(() => {\n    if (products.length > 0) {\n      const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n      if (prices.length > 0) {\n        setPriceRange([Math.min(...prices), Math.max(...prices)]);\n      }\n    }\n  }, [products]);\n  \n  // Filter and sort products\n  const displayedProducts = useMemo(() => {\n    let filtered = [...products];\n    \n    // Price filter\n    filtered = filtered.filter(p => {\n      const price = p.salePrice || p.price;\n      return price >= priceRange[0] && price <= priceRange[1];\n    });\n    \n    // Brand filter\n    if (filters.brands?.length > 0) {\n      filtered = filtered.filter(p => filters.brands.includes(p.brand));\n    }\n    \n    // Color filter\n    if (filters.colors?.length > 0) {\n      filtered = filtered.filter(p => filters.colors.includes(p.color));\n    }\n    \n    // In stock only\n    if (filters.inStockOnly) {\n      filtered = filtered.filter(p => p.inStock !== false);\n    }\n    \n    // Sort\n    switch (sortOption) {\n      case 'price-asc':\n        filtered.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        filtered.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        filtered.sort((a, b) => a.name.localeCompare(b.name, 'hu'));\n        break;\n      case 'discount':\n        filtered.sort((a, b) => {\n          const dA = a.salePrice ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n      case 'smart':\n        filtered.sort((a, b) => {\n          const score = (p) => {\n            const stock = typeof p.stock_qty === 'number' ? p.stock_qty : 0;\n            const inStock = p.inStock ?? p.in_stock ?? true;\n            const liked = likedIds.includes(p.id) ? 6 : 0;\n            const viewed = viewedIds.includes(p.id) ? 3 : 0;\n            const discount = p.salePrice && p.price ? (p.price - p.salePrice) / p.price : 0;\n            return (inStock ? 5 : 0) + liked + viewed + Math.min(stock, 20) * 0.2 + discount * 10;\n          };\n          return score(b) - score(a);\n        });\n        break;\n    }\n    \n    return filtered;\n  }, [products, sortOption, filters, priceRange]);\n  \n  const visibleProducts = displayedProducts;\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n  \n  // Infinite scroll observer\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) {\n          onLoadMore?.();\n        }\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    \n    if (loadMoreRef.current instanceof Element) {\n      try {\n        observer.observe(loadMoreRef.current);\n      } catch (err) {\n        return;\n      }\n    }\n    \n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n  \n  const toggleCompare = (product) => {\n    setCompareList(prev => \n      prev.find(p => p.id === product.id)\n        ? prev.filter(p => p.id !== product.id)\n        : prev.length < 4 ? [...prev, product] : prev\n    );\n  };\n  \n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CategoryHero category={category} productCount={totalCount || products.length} theme={theme} onBack={onBack} />\n      \n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-8 sm:py-12 lg:py-16\">\n        <AIBanner category={category} onAskAI={onAskAI} />\n        <PriceStats products={products} stats={stats} />\n        <FeaturedProducts products={products} onProductClick={onProductClick} onWishlistToggle={onWishlistToggle} wishlist={wishlist} onAddToCart={onAddToCart} />\n        <RelatedCategories currentCategory={category} allCategories={allCategories} onCategoryChange={onCategoryChange} />\n        <CategoryStory category={category} />\n        \n        <div className=\"flex gap-8\">\n          <SidebarFilters\n            products={products}\n            filters={filters}\n            onFilterChange={setFilters}\n            priceRange={priceRange}\n            onPriceRangeChange={setPriceRange}\n            isOpen={showFilters}\n            onClose={() => setShowFilters(false)}\n          />\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"mb-4 rounded-2xl border border-gray-100 bg-white p-4 shadow-sm\">\n              <div className=\"flex flex-wrap items-center gap-2 mb-3\">\n                <span className=\"text-xs font-semibold text-gray-500\">Gyors szrk:</span>\n                <button onClick={() => quickApply('in-stock')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Kszleten ({quickCounts.inStock})</button>\n                <button onClick={() => quickApply('under-100')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">100k alatt ({quickCounts.under100})</button>\n                <button onClick={() => quickApply('premium')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Prmium ({quickCounts.premium})</button>\n                <button onClick={() => quickApply('discount')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Akcik ({quickCounts.discount})</button>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={presetName}\n                  onChange={(e) => setPresetName(e.target.value)}\n                  placeholder=\"Preset neve\"\n                  className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\"\n                />\n                <button onClick={savePreset} className=\"px-3 py-2 rounded-lg bg-primary-500 text-white text-sm font-semibold\">Ments</button>\n                {savedPresets.map((preset) => (\n                  <button\n                    key={preset.id}\n                    onClick={() => applyPreset(preset)}\n                    className=\"px-3 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200\"\n                  >\n                    {preset.name}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <ViewControls\n              sortOption={sortOption}\n              onSortChange={setSortOption}\n              viewMode={viewMode}\n              onViewModeChange={setViewMode}\n              loadedCount={loadedCount}\n              totalCount={totalCount}\n              onOpenFilters={() => setShowFilters(true)}\n              compareCount={compareList.length}\n            />\n            \n            {viewMode === 'grid' ? (\n              <div className=\"product-grid\">\n                {visibleProducts.map((product, index) => (\n                  <EnhancedProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    index={index}\n                    sectionId={`category-${category}`}\n                  />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {visibleProducts.map(product => (\n                  <CompactProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    onCompare={toggleCompare}\n                    isComparing={compareList.some(p => p.id === product.id)}\n                  />\n                ))}\n              </div>\n            )}\n            \n            {/* Infinite scroll trigger */}\n            {hasMoreToShow && (\n              <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n                <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n              </div>\n            )}\n            \n            {!hasMoreToShow && visibleProducts.length > 0 && (\n              <p className=\"text-center text-gray-400 text-base lg:text-lg py-10 lg:py-12\">\n                Minden termk betltve ({displayedProducts.length} db)\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CategoryPage;\n","import React, { useMemo, useState, useEffect, useRef } from 'react';\nimport { Home, ChevronRight, Filter, LayoutGrid, Rows3, SlidersHorizontal, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown } from 'lucide-react';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\nimport { ProductGridSkeleton } from '../ui/Skeleton';\n\n/**\n * CollectionHero  kollekci fejlc, gradient httr\n */\nconst CollectionHero = ({ collection, productCount, onBack }) => {\n  const Icon = collection.icon;\n  return (\n    <div className=\"relative overflow-hidden\">\n      {collection.image && (\n        <div className=\"absolute inset-0 bg-cover bg-center\" style={{ backgroundImage: `url(${collection.image})` }} aria-hidden />\n      )}\n      <div className={`absolute inset-0 bg-gradient-to-br ${collection.gradient}`} />\n      <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent\" />\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 text-white\">\n        <nav className=\"flex items-center gap-2 text-sm mb-6\">\n          <button onClick={onBack} className=\"flex items-center gap-1 text-white/80 hover:text-white transition-colors\">\n            <Home className=\"w-4 h-4\" />\n            <span>Foldal</span>\n          </button>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"text-white font-medium\">Kollekci</span>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"font-semibold\">{collection.title}</span>\n        </nav>\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center shrink-0\">\n            <Icon className=\"w-10 h-10 sm:w-14 sm:h-14 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold mb-2\">{collection.title}</h1>\n            <p className=\"text-white/90 text-lg sm:text-xl mb-2\">{collection.subtitle}</p>\n            <p className=\"text-white/80 text-base\">\n              <span className=\"font-semibold\">{productCount.toLocaleString('hu-HU')}</span> termk\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Collection compact card - mint foldal: like/dislike, r formzs\n */\nconst CollectionCompactCard = ({ product, onProductClick, onWishlistToggle, onAddToCart, wishlist }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow touch-manipulation\">\n      <img\n        src={product.images?.[0] || product.image || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onProductClick?.(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\" onClick={() => onProductClick?.(product)}>\n          {product.name}\n        </h4>\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-[10px] text-red-500 line-through block truncate\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-xs font-bold text-red-600 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1 py-0.5 rounded bg-red-100 text-red-600 text-[9px] font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-xs font-bold text-gray-900 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onWishlistToggle?.(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${wishlist?.includes(product.id) ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * CollectionPage  kollekci landing, vals termkekkel\n */\nconst CollectionPage = ({\n  collection,\n  products,\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  onNavigateToCategory,\n  allCategories = [],\n  totalCount = 0,\n  loadedCount = 0,\n  onLoadMore,\n  isLoading = false,\n  onScrollToSection\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [showFilters, setShowFilters] = useState(false);\n  const [activeCategoryFilter, setActiveCategoryFilter] = useState('');\n  const loadMoreRef = useRef(null);\n\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n\n  const styleFilteredProducts = useMemo(() => {\n    let list = [...products];\n    if (collection.styleKeywords?.length > 0) {\n      const keywords = collection.styleKeywords.map((k) => k.toLowerCase());\n      list = list.filter((p) => {\n        const searchStr = [p.name || '', p.category || '', p.description || '', p.params || ''].join(' ').toLowerCase();\n        return keywords.some((kw) => searchStr.includes(kw));\n      });\n    }\n    return list;\n  }, [products, collection.styleKeywords]);\n\n  const inCollectionCategories = useMemo(() => {\n    const set = new Set();\n    styleFilteredProducts.forEach((p) => {\n      if (p.category && String(p.category).trim()) set.add(String(p.category).trim());\n    });\n    return Array.from(set).sort((a, b) => a.localeCompare(b, 'hu'));\n  }, [styleFilteredProducts]);\n\n  const displayedProducts = useMemo(() => {\n    let list = activeCategoryFilter\n      ? styleFilteredProducts.filter((p) => p.category === activeCategoryFilter)\n      : [...styleFilteredProducts];\n    switch (sortOption) {\n      case 'price-asc':\n        list.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        list.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        list.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'hu'));\n        break;\n      case 'discount':\n        list.sort((a, b) => {\n          const dA = a.salePrice && a.price ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice && b.price ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n    }\n    return list;\n  }, [styleFilteredProducts, activeCategoryFilter, sortOption]);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) onLoadMore?.();\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    if (loadMoreRef.current instanceof Element) observer.observe(loadMoreRef.current);\n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n\n  useEffect(() => {\n    const t = setTimeout(() => onScrollToSection?.(), 50);\n    return () => clearTimeout(t);\n  }, [collection?.id]);\n\n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CollectionHero collection={collection} productCount={displayedProducts.length} onBack={onBack} />\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-6 xl:px-8 py-8 sm:py-12\">\n        {/* AI banner */}\n        <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n              <Sparkles className=\"w-6 h-6\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n              <p className=\"text-white/80 text-sm\">Melyik {collection.title.toLowerCase()} illik hozzd?</p>\n            </div>\n            <button\n              onClick={onAskAI}\n              className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors\"\n            >\n              AI Tancsad\n            </button>\n          </div>\n        </div>\n\n        {/* Kollekcin belli szrs  termktpus chipek */}\n        {inCollectionCategories.length > 0 && (\n          <div className=\"mb-6\">\n            <p className=\"text-sm font-medium text-gray-600 mb-2\">Szrs a kollekcin bell</p>\n            <div className=\"flex gap-2 overflow-x-auto scrollbar-hide pb-1 lg:flex-wrap lg:overflow-visible\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveCategoryFilter('')}\n                className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                  activeCategoryFilter === '' ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                }`}\n              >\n                sszes\n              </button>\n              {inCollectionCategories.map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => setActiveCategoryFilter(cat)}\n                  className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                    activeCategoryFilter === cat ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Bngssz kategrik szerint  kilps a kollekcibl */}\n        {onNavigateToCategory && (collection.relatedCategories?.length > 0 || allCategories.length > 0) && (\n          <div className=\"mb-6 p-4 rounded-xl bg-gray-100/80 border border-gray-200\">\n            <p className=\"text-sm font-medium text-gray-600 mb-3\">Bngssz kategrik szerint</p>\n            <div className=\"flex flex-wrap gap-2\">\n              {(collection.relatedCategories?.length > 0\n                ? collection.relatedCategories\n                : allCategories\n                    .filter((c) => (typeof c === 'string' ? c : c?.name) !== 'sszes')\n                    .slice(0, 8)\n                    .map((c) => (typeof c === 'string' ? c : c.name))\n              ).map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => onNavigateToCategory(cat)}\n                  className=\"px-4 py-2 rounded-lg bg-white border border-gray-200 text-sm font-medium text-gray-700 hover:border-primary-400 hover:text-primary-600 hover:bg-primary-50 transition-colors\"\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Toolbar */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3 mb-6 pb-4 border-b border-gray-200\">\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700\"\n            >\n              <Filter className=\"w-4 h-4\" />\n              Szrk\n            </button>\n            <span className=\"text-sm text-gray-500\">\n              <span className=\"font-semibold text-gray-900\">{displayedProducts.length.toLocaleString('hu-HU')}</span>\n              {totalCount > 0 && <span className=\"text-gray-400\"> / {totalCount.toLocaleString('hu-HU')}</span>} termk\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={sortOption}\n              onChange={(e) => setSortOption(e.target.value)}\n              className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n            >\n              <option value=\"default\">Relevancia</option>\n              <option value=\"price-asc\">r </option>\n              <option value=\"price-desc\">r </option>\n              <option value=\"name-asc\">Nv A-Z</option>\n              <option value=\"discount\">Kedvezmny</option>\n            </select>\n            <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n              {[\n                { mode: 'grid', icon: LayoutGrid },\n                { mode: 'compact', icon: Rows3 }\n              ].map(({ mode, icon: Icon }) => (\n                <button\n                  key={mode}\n                  onClick={() => setViewMode(mode)}\n                  className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n                >\n                  <Icon className=\"w-5 h-5\" />\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Product grid */}\n        {isLoading && products.length === 0 ? (\n          <ProductGridSkeleton count={8} />\n        ) : displayedProducts.length === 0 ? (\n          <div className=\"text-center py-16 text-gray-500\">\n            <p className=\"text-lg font-medium\">Nincs tallat ebben a kollekciban.</p>\n            <button onClick={onBack} className=\"mt-4 px-6 py-2 bg-primary-500 text-white rounded-xl font-semibold hover:bg-primary-600\">\n              Vissza a kollekcikhoz\n            </button>\n          </div>\n        ) : viewMode === 'grid' ? (\n          <div className=\"product-grid product-grid-collection\">\n            {displayedProducts.map((product, index) => (\n              <EnhancedProductCard\n                key={product.id}\n                product={product}\n                onQuickView={onProductClick}\n                onToggleWishlist={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                isWishlisted={wishlist?.includes(product.id)}\n                index={index}\n                sectionId={`collection-${collection.id}`}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"space-y-2 sm:space-y-3\">\n            {displayedProducts.map((product) => (\n              <CollectionCompactCard\n                key={product.id}\n                product={product}\n                onProductClick={onProductClick}\n                onWishlistToggle={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                wishlist={wishlist}\n              />\n            ))}\n          </div>\n        )}\n\n        {hasMoreToShow && (\n          <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n            <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n\n        {!hasMoreToShow && displayedProducts.length > 0 && (\n          <p className=\"text-center text-gray-400 py-10\">Minden termk betltve</p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CollectionPage;\n","import React from 'react';\nimport { ChevronRight } from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst CARD_COLORS = [\n  'from-primary-500 to-secondary-700',\n  'from-orange-500 to-amber-600',\n  'from-emerald-500 to-teal-600',\n  'from-violet-500 to-purple-600',\n];\n\n/**\n * F kategrik krtyk a foldalon  hierarchia alapjn.\n * Desktop: 3 oszlop, tablet: 2, mobil: horizontlis scroll vagy 1 oszlop.\n */\nexport default function MainCategoriesSection({\n  mainCategories = [],\n  activeCategory,\n  onCategorySelect,\n  totalProductCount = 0,\n}) {\n  if (!mainCategories.length) return null;\n\n  return (\n    <div className=\"mb-6 sm:mb-8 lg:mb-10\">\n      <div className=\"flex items-center justify-between gap-4 mb-4 sm:mb-5 lg:mb-6\">\n        <div>\n          <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">\n            Bngssz f kategrik szerint\n          </h3>\n          <p className=\"text-sm sm:text-base text-gray-500 mt-0.5\">\n            {totalProductCount > 0 && (\n              <span className=\"font-medium text-primary-600\">{totalProductCount.toLocaleString('hu-HU')}</span>\n            )}{' '}\n            termk egy helyen\n          </p>\n        </div>\n      </div>\n\n      {/* Desktop / tablet: grid */}\n      <div className=\"hidden sm:grid sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n        {mainCategories.map((main, idx) => {\n          const isActive = activeCategory === main.name;\n          const children = (main.children || []).slice(0, 6);\n          const Icon = getCategoryIcon(main.name);\n          const color = CARD_COLORS[idx % CARD_COLORS.length];\n          return (\n            <article\n              key={main.name}\n              className={`rounded-2xl lg:rounded-3xl border-2 overflow-hidden transition-all duration-200 hover:shadow-xl ${\n                isActive\n                  ? 'border-primary-400 bg-primary-50/50 shadow-lg'\n                  : 'border-gray-100 bg-white hover:border-gray-200'\n              }`}\n            >\n              <button\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className=\"w-full flex items-center gap-4 p-4 sm:p-5 lg:p-6 text-left min-h-[44px]\"\n              >\n                <div\n                  className={`w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}\n                >\n                  <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-9 lg:h-9\" />\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                  <h4 className=\"font-bold text-gray-900 text-base sm:text-lg lg:text-xl truncate\">\n                    {main.name}\n                  </h4>\n                  <p className=\"text-sm text-gray-500\">\n                    {Number(main.productCount || 0).toLocaleString('hu-HU')} termk\n                  </p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-gray-400 shrink-0\" />\n              </button>\n              {children.length > 0 && (\n                <div className=\"px-4 sm:px-5 lg:px-6 pb-4 sm:pb-5 lg:pb-6 pt-0 flex flex-wrap gap-2\">\n                  {children.map((child) => (\n                    <button\n                      key={child.name}\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onCategorySelect(child.name);\n                      }}\n                      className=\"px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors border border-gray-100 hover:border-primary-200\"\n                    >\n                      {child.name}\n                    </button>\n                  ))}\n                </div>\n              )}\n            </article>\n          );\n        })}\n      </div>\n\n      {/* Mobile: horizontal scroll */}\n      <div className=\"sm:hidden overflow-x-auto scrollbar-hide -mx-3 px-3\">\n        <div className=\"flex gap-3 pb-2\">\n          {mainCategories.map((main, idx) => {\n            const isActive = activeCategory === main.name;\n            const Icon = getCategoryIcon(main.name);\n            const color = CARD_COLORS[idx % CARD_COLORS.length];\n            return (\n              <button\n                key={main.name}\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className={`shrink-0 w-[160px] rounded-2xl border-2 p-4 text-left transition-all min-h-[100px] ${\n                  isActive ? 'border-primary-400 bg-primary-50/50' : 'border-gray-100 bg-white'\n                }`}\n              >\n                <div\n                  className={`w-12 h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white mb-3`}\n                >\n                  <Icon className=\"w-6 h-6\" />\n                </div>\n                <p className=\"font-bold text-gray-900 text-sm truncate\">{main.name}</p>\n                <p className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} db</p>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useSyncExternalStore } from 'react';\n\n/** Kzs scroll store  egy listener, rAF throttling, passive */\nlet scrollY = 0;\nlet scrollPercent = 0;\nlet scrollHeight = 0;\nlet snapshot = { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\nconst listeners = new Set();\nlet rafId = null;\n\nfunction getScrollData() {\n  if (typeof window === 'undefined') return { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\n  const y = window.pageYOffset ?? document.documentElement.scrollTop ?? 0;\n  const sh = Math.max(0, document.documentElement.scrollHeight - (window.innerHeight ?? document.documentElement.clientHeight));\n  const pct = sh > 0 ? Math.min(100, (y / sh) * 100) : 0;\n  return { scrollY: y, scrollPercent: pct, scrollHeight: sh };\n}\n\nfunction notify() {\n  const data = getScrollData();\n  if (data.scrollY === scrollY && data.scrollPercent === scrollPercent) return;\n  scrollY = data.scrollY;\n  scrollPercent = data.scrollPercent;\n  scrollHeight = data.scrollHeight;\n  snapshot = { scrollY, scrollPercent, scrollHeight };\n  listeners.forEach((fn) => fn());\n}\n\nfunction onScroll() {\n  if (rafId != null) return;\n  rafId = requestAnimationFrame(() => {\n    notify();\n    rafId = null;\n  });\n}\n\nfunction subscribe(listener) {\n  if (listeners.size === 0) {\n    window.addEventListener('scroll', onScroll, { passive: true });\n    notify();\n  }\n  listeners.add(listener);\n  return () => {\n    listeners.delete(listener);\n    if (listeners.size === 0) {\n      window.removeEventListener('scroll', onScroll);\n    }\n  };\n}\n\nfunction getSnapshot() {\n  return snapshot;\n}\n\nfunction getServerSnapshot() {\n  return { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\n}\n\n/**\n * useScrollPosition - Egyetlen kzs scroll listener, rAF throttling.\n * Hasznlat: ScrollProgress, BackToTop, Navbar, SmartNewsletterPopup, StickyAddToCart\n */\nexport function useScrollPosition() {\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n}\n\n/** scrollY > threshold (pl. 20, 400) */\nexport function useScrollPastY(threshold) {\n  const { scrollY: y } = useScrollPosition();\n  return y > threshold;\n}\n\n/** scrollPercent > threshold (pl. 30, 70) */\nexport function useScrollPastPercent(threshold) {\n  const { scrollPercent: pct } = useScrollPosition();\n  return pct > threshold;\n}\n","import { useEffect } from 'react';\n\nlet lockCount = 0;\nconst savedStyles = new Map();\nlet lastScrollParent = null;\n\nfunction getScrollParent() {\n  if (typeof document === 'undefined') return null;\n  const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root');\n  if (!appRoot) return null;\n  let parent = appRoot.parentElement;\n  while (parent && parent !== document.body) {\n    const style = getComputedStyle(parent);\n    const oy = style.overflowY;\n    const isScrollable =\n      (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && parent.scrollHeight > parent.clientHeight;\n    if (isScrollable) return parent;\n    parent = parent.parentElement;\n  }\n  return null;\n}\n\nfunction lock() {\n  lockCount++;\n  if (lockCount !== 1) return;\n\n  const bodyOverflow = document.body.style.overflow || '';\n  savedStyles.set(document.body, bodyOverflow);\n  document.body.style.overflow = 'hidden';\n\n  const scrollParent = getScrollParent();\n  if (scrollParent) {\n    lastScrollParent = scrollParent;\n    savedStyles.set(scrollParent, scrollParent.style.overflow || '');\n    scrollParent.style.overflow = 'hidden';\n  }\n}\n\nfunction unlock() {\n  lockCount = Math.max(0, lockCount - 1);\n  if (lockCount > 0) return;\n\n  const bodySaved = savedStyles.get(document.body);\n  document.body.style.overflow = bodySaved !== undefined ? String(bodySaved) : '';\n  savedStyles.delete(document.body);\n\n  if (lastScrollParent) {\n    const parentSaved = savedStyles.get(lastScrollParent);\n    lastScrollParent.style.overflow = parentSaved !== undefined ? String(parentSaved) : '';\n    savedStyles.delete(lastScrollParent);\n    lastScrollParent = null;\n  }\n}\n\n/**\n * useScrollLock - Locks background scroll when modal/popup is open.\n * Works for both standalone (body) and embed (scroll parent).\n * Uses ref counter for nested modals.\n */\nexport function useScrollLock(isActive) {\n  useEffect(() => {\n    if (!isActive) return;\n    lock();\n    return unlock;\n  }, [isActive]);\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useScrollPastY } from '../../hooks/useScrollPosition';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport {\n  Home, Sparkles, Grid3X3, ChevronDown, ChevronUp, ArrowRight, Search, Sun, Moon, Heart, Menu, X, ChevronRight,\n  ShoppingCart, Camera, Move, Truck, Gift, Zap, TrendingUp, Star, Sofa, BedDouble, Armchair,\n  Lamp, Instagram, Facebook, MapPin, Mail, Phone, Clock\n} from 'lucide-react';\n\nconst RECENT_CATEGORIES_KEY = 'mkt_recent_categories';\nconst RECENT_CATEGORIES_MAX = 3;\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst ANNOUNCEMENT_MESSAGES = [\n  { icon: Truck, text: 'Ingyenes szllts 50.000 Ft felett', highlight: 'Ingyenes' },\n  { icon: Gift, text: 'Els rendels: 10% kupon ELSO10', highlight: '10%' },\n  { icon: Zap, text: 'AI szemlyre szabott ajnlatok', highlight: 'AI' },\n  { icon: Star, text: '4,9  10.000+ elgedett vsrl', highlight: '4,9' },\n  { icon: TrendingUp, text: '90.000+ btor egy helyen', highlight: '90.000+' },\n];\n\nconst POPULAR_CATEGORIES = [\n  { id: 'kanapek', name: 'Kanapk', icon: Sofa, color: 'from-blue-500 to-primary-500' },\n  { id: 'agyak', name: 'gyak', icon: BedDouble, color: 'from-secondary-600 to-secondary-600' },\n  { id: 'fotelek', name: 'Fotelek', icon: Armchair, color: 'from-orange-500 to-red-600' },\n  { id: 'lampak', name: 'Lmpk', icon: Lamp, color: 'from-yellow-500 to-orange-600' },\n  { id: 'szekrenyek', name: 'Szekrnyek', icon: Grid3X3, color: 'from-green-500 to-teal-600' },\n  { id: 'asztalok', name: 'Asztalok', icon: Grid3X3, color: 'from-cyan-500 to-blue-600' },\n];\n\nconst MEGA_MENU_COLORS = ['from-primary-500 to-secondary-700', 'from-orange-500 to-red-600', 'from-cyan-500 to-blue-600', 'from-green-500 to-teal-600', 'from-yellow-500 to-orange-600', 'from-pink-500 to-rose-600', 'from-indigo-500 to-purple-600', 'from-amber-500 to-orange-600', 'from-emerald-500 to-teal-600'];\n\n/**\n * Navbar  fejlc, kategria mega menu (f + alkategrik), mobil men, announcement sv.\n * Props: activeTab, setActiveTab, wishlistCount, productCount, categories, categoryHierarchy?, onOpenWishlist, onCategorySelect, onScrollToShop, recentlyViewed?, fixUrl?, onRecentProductClick?\n * categoryHierarchy: [ { name, productCount, children: [ { name, productCount } ] } ]  ha megadva, csak f kategrik + alkategrik jelennek meg.\n * activeCategory: aktulisan kivlasztott kategria (f vagy alkategria)  a menben kiemelve.\n */\nexport default function Navbar({\n  activeTab,\n  setActiveTab,\n  wishlistCount,\n  productCount = 0,\n  categories = [],\n  categoryHierarchy = [],\n  activeCategory = '',\n  onOpenWishlist,\n  onCategorySelect,\n  onScrollToShop,\n  recentlyViewed: recentlyViewedProp = [],\n  fixUrl = (url) => url || '',\n  onRecentProductClick\n}) {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const isScrolled = useScrollPastY(20);\n  const [announcementIndex, setAnnouncementIndex] = useState(0);\n  const [announcementProgress, setAnnouncementProgress] = useState(0);\n  const announcementStartRef = useRef(Date.now());\n  const [isDarkMode, setIsDarkMode] = useState(false);\n  const [showMegaMenu, setShowMegaMenu] = useState(false);\n  const [isReturningUser, setIsReturningUser] = useState(false);\n  const [userName, setUserName] = useState('');\n  const [mobileMenuClosing, setMobileMenuClosing] = useState(false);\n  const [touchStartX, setTouchStartX] = useState(0);\n  const [recentlyViewedLocal, setRecentlyViewedLocal] = useState([]);\n  const [recentCategories, setRecentCategories] = useState([]);\n  const [mobileCategoriesExpanded, setMobileCategoriesExpanded] = useState(false);\n  const [mobileExpandedMain, setMobileExpandedMain] = useState(null);\n  const [megaMenuHoverMain, setMegaMenuHoverMain] = useState(null);\n  const mobileMenuRef = useRef(null);\n  const megaMenuRef = useRef(null);\n  const megaMenuPanelRef = useRef(null);\n  const megaMenuCloseTimeoutRef = useRef(null);\n  const hamburgerButtonRef = useRef(null);\n\n  useEffect(() => {\n    const lastVisit = localStorage.getItem('mkt_last_visit');\n    const savedName = localStorage.getItem('mkt_user_name');\n    if (lastVisit) {\n      setIsReturningUser(true);\n      if (savedName) setUserName(savedName);\n    }\n    localStorage.setItem('mkt_last_visit', Date.now().toString());\n  }, []);\n\n  useEffect(() => {\n    const load = () => {\n      try {\n        const raw = localStorage.getItem('recently_viewed');\n        const list = raw ? JSON.parse(raw) : [];\n        setRecentlyViewedLocal(Array.isArray(list) ? list.slice(0, 4) : []);\n      } catch {\n        setRecentlyViewedLocal([]);\n      }\n    };\n    load();\n    window.addEventListener('recently-viewed-updated', load);\n    window.addEventListener('storage', load);\n    return () => {\n      window.removeEventListener('recently-viewed-updated', load);\n      window.removeEventListener('storage', load);\n    };\n  }, []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(RECENT_CATEGORIES_KEY);\n      const list = raw ? JSON.parse(raw) : [];\n      setRecentCategories(Array.isArray(list) ? list.slice(0, RECENT_CATEGORIES_MAX) : []);\n    } catch {\n      setRecentCategories([]);\n    }\n  }, []);\n\n  const pushRecentCategory = (name) => {\n    if (!name || name === 'sszes') return;\n    setRecentCategories((prev) => {\n      const next = [name, ...prev.filter((c) => c !== name)].slice(0, RECENT_CATEGORIES_MAX);\n      try {\n        localStorage.setItem(RECENT_CATEGORIES_KEY, JSON.stringify(next));\n      } catch (_) {}\n      return next;\n    });\n  };\n\n  const ANNOUNCEMENT_DURATION_MS = 5500;\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setAnnouncementIndex(prev => (prev + 1) % ANNOUNCEMENT_MESSAGES.length);\n      announcementStartRef.current = Date.now();\n      setAnnouncementProgress(0);\n    }, ANNOUNCEMENT_DURATION_MS);\n    return () => clearInterval(interval);\n  }, []);\n\n  const announcementRafRef = useRef(null);\n  useEffect(() => {\n    const start = announcementStartRef.current;\n    const tick = () => {\n      const elapsed = Date.now() - start;\n      const p = Math.min(100, (elapsed / ANNOUNCEMENT_DURATION_MS) * 100);\n      setAnnouncementProgress(p);\n      if (p < 100) announcementRafRef.current = requestAnimationFrame(tick);\n    };\n    announcementRafRef.current = requestAnimationFrame(tick);\n    return () => {\n      if (announcementRafRef.current) cancelAnimationFrame(announcementRafRef.current);\n    };\n  }, [announcementIndex]);\n\n\n  useEffect(() => {\n    const handleEsc = (e) => { if (e.key === 'Escape') setShowMegaMenu(false); };\n    window.addEventListener('keydown', handleEsc);\n    return () => window.removeEventListener('keydown', handleEsc);\n  }, []);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const handleClickOutside = (e) => {\n      if (megaMenuRef.current && !megaMenuRef.current.contains(e.target)) setShowMegaMenu(false);\n    };\n    document.addEventListener('click', handleClickOutside);\n    return () => document.removeEventListener('click', handleClickOutside);\n  }, [showMegaMenu]);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const panel = megaMenuPanelRef.current;\n    if (!panel || typeof panel.addEventListener !== 'function') {\n      return;\n    }\n    const focusables = panel.querySelectorAll('button:not([disabled])');\n    const first = focusables[0];\n    if (first) {\n      const t = setTimeout(() => first.focus(), 50);\n      const handleKeyDown = (e) => {\n        if (e.key !== 'Tab') return;\n        const idx = Array.from(focusables).indexOf(document.activeElement);\n        if (e.shiftKey) {\n          if (idx <= 0) {\n            e.preventDefault();\n            focusables[focusables.length - 1]?.focus();\n          }\n        } else {\n          if (idx >= focusables.length - 1 || idx === -1) {\n            e.preventDefault();\n            focusables[0]?.focus();\n          }\n        }\n      };\n      panel.addEventListener('keydown', handleKeyDown);\n      return () => {\n        clearTimeout(t);\n        panel.removeEventListener('keydown', handleKeyDown);\n      };\n    }\n  }, [showMegaMenu]);\n\n  useScrollLock(mobileMenuOpen);\n\n  useEffect(() => {\n    if (mobileMenuOpen) {\n      const handleEsc = (e) => { if (e.key === 'Escape') closeMobileMenu(); };\n      window.addEventListener('keydown', handleEsc);\n      const t = setTimeout(() => mobileMenuRef.current?.querySelector('button[aria-label=\"Men bezrsa\"]')?.focus(), 100);\n      return () => { window.removeEventListener('keydown', handleEsc); clearTimeout(t); };\n    }\n  }, [mobileMenuOpen]);\n\n  useEffect(() => {\n    if (isDarkMode) document.getElementById('mkt-butorbolt-app')?.classList.add('dark-mode');\n    else document.getElementById('mkt-butorbolt-app')?.classList.remove('dark-mode');\n  }, [isDarkMode]);\n\n  const handleTouchStart = (e) => setTouchStartX(e.touches[0].clientX);\n  const handleTouchEnd = (e) => {\n    const touchEndX = e.changedTouches[0].clientX;\n    if (touchEndX - touchStartX > 80) closeMobileMenu();\n  };\n\n  const closeMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuClosing(true);\n    setMobileCategoriesExpanded(false);\n    setMobileExpandedMain(null);\n    setTimeout(() => {\n      setMobileMenuOpen(false);\n      setMobileMenuClosing(false);\n      hamburgerButtonRef.current?.focus();\n    }, 300);\n  };\n\n  const focusSearchAndClose = () => {\n    setActiveTab('shop');\n    closeMobileMenu();\n    setTimeout(() => {\n      onScrollToShop?.();\n      window.dispatchEvent(new CustomEvent('mkt-focus-search'));\n    }, 400);\n  };\n\n  const openMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuOpen(true);\n  };\n\n  const setTabAndClose = (tab) => {\n    setActiveTab(tab);\n    closeMobileMenu();\n    if (tab === 'shop') onScrollToShop?.();\n  };\n\n  const navItems = [\n    { id: 'shop', label: 'Termkek', icon: ShoppingCart, badge: productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : null, desc: 'Bngssz a knlatban' },\n    { id: 'visual-search', label: 'AI Kpkeres', icon: Camera, isAI: true, desc: 'Fotzz s keress' },\n    { id: 'room-planner', label: 'Szobatervez', icon: Move, isAI: true, desc: 'Tervezd meg a szobd' },\n  ];\n\n  const currentAnnouncement = ANNOUNCEMENT_MESSAGES[announcementIndex];\n\n  return (\n    <>\n      <nav\n        id=\"mkt-butorbolt-navbar\"\n        className={`sticky top-0 z-50 transition-all duration-200 ${isScrolled ? 'bg-white/95 backdrop-blur-xl shadow-md border-b border-gray-200' : 'bg-white/90 backdrop-blur-md border-b border-gray-100'}`}\n      >\n        <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-10 xl:px-16 2xl:px-20\">\n          <div className={`flex justify-between items-center transition-all duration-300 py-3 sm:py-2 lg:py-0 ${isScrolled ? 'min-h-[64px] sm:min-h-[72px] lg:min-h-[80px] xl:min-h-[96px]' : 'min-h-[76px] sm:min-h-[80px] lg:min-h-[96px] xl:min-h-[112px]'}`}>\n            <div\n              className=\"flex items-center cursor-pointer group\"\n              onClick={() => { setActiveTab('shop'); onScrollToShop?.(); }}\n              role=\"button\"\n              tabIndex={0}\n              onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab('shop'); onScrollToShop?.(); } }}\n              aria-label=\"Marketly.AI  Foldal\"\n            >\n              <div className={`relative bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-500 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mr-3 sm:mr-4 lg:mr-5 transform group-hover:scale-105 group-hover:rotate-3 transition-all duration-300 shadow-lg shadow-primary-300/50 group-hover:shadow-xl ${isScrolled ? 'w-11 h-11 sm:w-12 sm:h-12 lg:w-14 lg:h-14 xl:w-16 xl:h-16' : 'w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 xl:w-20 xl:h-20'}`}>\n                <Home className={isScrolled ? 'w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 xl:w-8 xl:h-8' : 'w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 xl:w-10 xl:h-10'} />\n                <div className=\"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 bg-green-400 rounded-full border-2 border-white flex items-center justify-center\">\n                  <Sparkles className=\"w-2 h-2 sm:w-2.5 sm:h-2.5 lg:w-3 lg:h-3 xl:w-4 xl:h-4 text-white\" />\n                </div>\n              </div>\n              <div className=\"flex flex-col\">\n                <div className=\"flex items-baseline\">\n                  <span className={`font-black text-gray-900 tracking-tight transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>Marketly</span>\n                  <span className={`font-black bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>.AI</span>\n                </div>\n                <span className=\"text-[10px] sm:text-xs lg:text-sm xl:text-base text-gray-500 font-semibold tracking-widest -mt-0.5\">BTORBOLT</span>\n              </div>\n            </div>\n\n            <div className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-4 2xl:gap-4\">\n              <div\n                ref={megaMenuRef}\n                className=\"relative\"\n                onMouseEnter={() => {\n                  if (megaMenuCloseTimeoutRef.current) {\n                    clearTimeout(megaMenuCloseTimeoutRef.current);\n                    megaMenuCloseTimeoutRef.current = null;\n                  }\n                  setShowMegaMenu(true);\n                }}\n                onMouseLeave={() => {\n                  megaMenuCloseTimeoutRef.current = setTimeout(() => setShowMegaMenu(false), 180);\n                }}\n              >\n                <button \n                  type=\"button\"\n                  className={`flex items-center gap-2 px-4 py-3 rounded-xl font-semibold text-base transition-all duration-200 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${showMegaMenu ? 'bg-primary-50 text-primary-700 border border-primary-200 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 border border-transparent'}`} \n                  aria-label=\"Kategrik men\" \n                  aria-expanded={showMegaMenu} \n                  aria-haspopup=\"true\"\n                >\n                  <Grid3X3 className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>Kategrik</span>\n                  <ChevronDown className={`w-4 h-4 lg:w-5 xl:w-5 transition-transform duration-200 ${showMegaMenu ? 'rotate-180' : ''}`} />\n                </button>\n                {showMegaMenu && (() => {\n                  const hasHierarchy = Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0;\n                  if (hasHierarchy) {\n                    return (\n                      <div\n                        ref={megaMenuPanelRef}\n                        className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] rounded-2xl lg:rounded-3xl z-50\"\n                        onMouseEnter={() => {\n                          if (megaMenuCloseTimeoutRef.current) {\n                            clearTimeout(megaMenuCloseTimeoutRef.current);\n                            megaMenuCloseTimeoutRef.current = null;\n                          }\n                        }}\n                        role=\"dialog\"\n                        aria-label=\"Kategrik men\"\n                      >\n                        <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                        <div className=\"p-4 lg:p-5 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                          <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                          <h3 className=\"text-sm lg:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                        </div>\n                        <div className=\"p-4 lg:p-5 xl:p-6 2xl:p-7 max-h-[65vh] md:max-h-[70vh] overflow-y-auto bg-white\">\n                          <div className=\"grid grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n                            {categoryHierarchy.slice(0, 12).map((main, idx) => {\n                              const isHover = megaMenuHoverMain === main.name;\n                              const isActiveMain = activeCategory === main.name;\n                              const children = (main.children || []).slice(0, 8);\n                              const MainIcon = getCategoryIcon(main.name);\n                              const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                              return (\n                                <div\n                                  key={main.name}\n                                  className={`rounded-xl xl:rounded-2xl border-2 transition-colors duration-200 ${isActiveMain ? 'border-primary-300 bg-primary-50' : 'border-gray-200 bg-gray-50 hover:border-primary-200 hover:bg-primary-50/70'}`}\n                                  onMouseEnter={() => setMegaMenuHoverMain(main.name)}\n                                  onMouseLeave={() => setMegaMenuHoverMain(null)}\n                                >\n                                  <button\n                                    onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                    className={`w-full flex items-center gap-3 p-3 xl:p-4 rounded-t-xl xl:rounded-t-2xl text-left min-h-[44px] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${isHover || isActiveMain ? 'bg-primary-50' : 'hover:bg-white'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={main.name}\n                                    aria-label={`F kategria: ${main.name}${isActiveMain ? ' (kivlasztva)' : ''}`}\n                                    aria-current={isActiveMain ? 'true' : undefined}\n                                  >\n                                    <div className={`w-10 h-10 xl:w-12 xl:h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                                      <MainIcon className=\"w-5 h-5 xl:w-6 xl:h-6\" />\n                                    </div>\n                                    <div className=\"min-w-0 flex-1\">\n                                      <span className=\"font-bold text-gray-800 text-sm xl:text-base block truncate\">{main.name}</span>\n                                      <span className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} termk</span>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400 shrink-0\" />\n                                  </button>\n                                  {children.length > 0 && (\n                                    <div className=\"px-3 xl:px-4 pb-3 xl:pb-4 pt-0 flex flex-wrap gap-1.5\">\n                                      {children.map((child) => {\n                                        const isActiveChild = activeCategory === child.name;\n                                        return (\n                                          <button\n                                            key={child.name}\n                                            onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                            className={`px-2.5 py-1.5 text-xs xl:text-sm font-medium rounded-lg transition-colors min-h-[32px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-1 ${isActiveChild ? 'bg-primary-500 text-white' : 'text-gray-600 hover:text-primary-600 hover:bg-primary-100'}`}\n                                            data-nav-action=\"category\"\n                                            data-nav-target={child.name}\n                                            aria-label={`Alkategria: ${child.name}${isActiveChild ? ' (kivlasztva)' : ''}`}\n                                            aria-current={isActiveChild ? 'true' : undefined}\n                                          >\n                                            {child.name}\n                                            {child.productCount != null && <span className={isActiveChild ? 'text-white/80 ml-1' : 'text-gray-400 ml-1'}>({Number(child.productCount).toLocaleString('hu-HU')})</span>}\n                                          </button>\n                                        );\n                                      })}\n                                    </div>\n                                  )}\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                        <div className=\"px-4 lg:px-5 xl:px-6 2xl:px-7 pb-4 lg:pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                          <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 lg:gap-3 py-3 lg:py-3.5 text-sm lg:text-base xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl lg:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                            sszes kategria megtekintse\n                            <ArrowRight className=\"w-4 h-4 lg:w-5 xl:w-5\" />\n                          </button>\n                        </div>\n                        </div>\n                      </div>\n                    );\n                  }\n                  const menuCategories = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes').slice(0, 12) : POPULAR_CATEGORIES;\n                  const isRealCategories = menuCategories.length > 0 && typeof menuCategories[0]?.count === 'number';\n                  return (\n                    <div ref={megaMenuPanelRef} className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] z-50\" onMouseEnter={() => { if (megaMenuCloseTimeoutRef.current) { clearTimeout(megaMenuCloseTimeoutRef.current); megaMenuCloseTimeoutRef.current = null; } }} role=\"dialog\" aria-label=\"Kategrik men\">\n                      <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                      <div className=\"p-4 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                        <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                        <h3 className=\"text-sm xl:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                      </div>\n                      <div className=\"p-5 xl:p-6 2xl:p-7\">\n                        <div className=\"grid grid-cols-4 gap-3 xl:gap-4 2xl:gap-5\">\n                          {menuCategories.map((cat, idx) => {\n                            const name = cat?.name ?? String(cat?.id ?? idx);\n                            const Icon = isRealCategories ? getCategoryIcon(name) : cat?.icon ?? Grid3X3;\n                            const color = isRealCategories ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                            return (\n                              <button key={isRealCategories ? name : (cat?.id ?? `cat-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"flex flex-col items-center gap-2 xl:gap-2.5 p-3 xl:p-4 rounded-xl xl:rounded-2xl hover:bg-gray-50 hover:scale-[1.02] active:scale-[0.98] active:bg-gray-100 transition-all duration-200 group min-h-[44px]\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                                <div className={`w-11 h-11 xl:w-14 xl:h-14 2xl:w-16 2xl:h-16 rounded-xl xl:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white group-hover:scale-110 shadow-md group-hover:shadow-lg transition-all duration-200`}>\n                                  <Icon className=\"w-5 h-5 xl:w-7 xl:h-7 2xl:w-8 2xl:h-8\" />\n                                </div>\n                                <span className=\"text-xs xl:text-sm 2xl:text-base font-semibold text-gray-700 text-center leading-tight line-clamp-2\">{name}</span>\n                                {isRealCategories && cat.count != null && <span className=\"text-[10px] xl:text-xs text-gray-400\">{Number(cat.count).toLocaleString('hu-HU')} db</span>}\n                              </button>\n                            );\n                          })}\n                        </div>\n                      </div>\n                      <div className=\"px-5 xl:px-6 2xl:px-7 pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                        <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 xl:gap-3 py-3 xl:py-3.5 text-sm xl:text-base 2xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl xl:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                          sszes kategria megtekintse\n                          <ArrowRight className=\"w-4 h-4 xl:w-5 xl:h-5\" />\n                        </button>\n                      </div>\n                      </div>\n                    </div>\n                  );\n                })()}\n              </div>\n              {navItems.map((item) => (\n                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`relative flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-6 2xl:px-7 py-2.5 lg:py-3 xl:py-3.5 2xl:py-4 rounded-xl lg:rounded-2xl font-bold text-sm lg:text-base xl:text-lg 2xl:text-xl transition-all duration-200 min-h-[44px] hover:scale-[1.02] active:scale-[0.98] ${activeTab === item.id ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg shadow-primary-300/50' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'}`} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <item.icon className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>{item.label}</span>\n                  {item.isAI && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-gradient-to-r from-primary-100 to-secondary-100 text-primary-500 rounded-full\">AI</span>}\n                  {item.badge && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-green-100 text-green-700 rounded-full\">{item.badge}</span>}\n                </button>\n              ))}\n            </div>\n\n            <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-4\">\n              <button onClick={() => { setActiveTab('shop'); onScrollToShop?.(); window.dispatchEvent(new CustomEvent('mkt-focus-search')); }} className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-5 py-2.5 lg:py-3 min-h-[44px] bg-gray-100 hover:bg-gray-200 rounded-xl lg:rounded-2xl text-gray-600 hover:text-gray-900 hover:scale-[1.02] active:scale-[0.98] transition-all\" aria-label=\"Keress\" data-nav-action=\"search\">\n                <Search className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                <span className=\"text-sm lg:text-base font-bold\">Keress</span>\n              </button>\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"hidden sm:flex p-2.5 sm:p-3 min-w-[44px] min-h-[44px] items-center justify-center text-gray-600 hover:text-gray-900 rounded-xl lg:rounded-2xl hover:bg-gray-100 transition-all\" aria-label={isDarkMode ? 'Vilgos md' : 'Stt md'}>\n                {isDarkMode ? <Sun className=\"w-5 h-5 sm:w-6 sm:h-6\" /> : <Moon className=\"w-5 h-5 sm:w-6 sm:h-6\" />}\n              </button>\n              <button onClick={onOpenWishlist} className=\"relative p-2.5 sm:p-3 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 hover:text-red-500 rounded-xl lg:rounded-2xl hover:bg-red-50 transition-all group\" aria-label=\"Kvnsglista\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 transition-all group-hover:scale-110 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : ''}`} />\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center px-1.5 text-xs font-bold text-white bg-red-500 rounded-full shadow-lg animate-scale-in\">{wishlistCount}</span>}\n              </button>\n              <button ref={hamburgerButtonRef} type=\"button\" className=\"md:hidden p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl transition-all\" onClick={openMobileMenu} aria-label=\"Men megnyitsa\">\n                <Menu className=\"w-6 h-6\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <div className=\"bg-gradient-to-r from-primary-500/95 via-secondary-600 to-secondary-500/95 text-white py-1.5 sm:py-2 px-3 sm:px-4 lg:px-6 text-center relative overflow-hidden shadow-sm\">\n        <div className=\"absolute inset-0 opacity-15\" style={{ backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.4) 1px, transparent 1px)', backgroundSize: '12px 12px' }} aria-hidden=\"true\" />\n        <div className=\"relative flex items-center justify-center gap-2 sm:gap-3 min-h-[36px] sm:min-h-[40px]\">\n          <div key={announcementIndex} className=\"flex items-center gap-2 sm:gap-3 animate-fade-in max-w-full\" role=\"marquee\" aria-live=\"polite\">\n            <currentAnnouncement.icon className=\"w-4 h-4 shrink-0 text-white/90\" aria-hidden />\n            <span className=\"text-xs sm:text-sm lg:text-base font-semibold truncate\">\n              {currentAnnouncement.text.split(currentAnnouncement.highlight).map((part, i, arr) => (\n                <React.Fragment key={i}>\n                  {part}\n                  {i < arr.length - 1 && <span className=\"font-bold bg-white/25 px-1.5 py-0.5 rounded-md mx-1 shadow-sm\">{currentAnnouncement.highlight}</span>}\n                </React.Fragment>\n              ))}\n            </span>\n          </div>\n          <div className=\"hidden sm:flex items-center gap-1 ml-3\">\n            {ANNOUNCEMENT_MESSAGES.map((_, i) => (\n              <div key={i} className={`w-1.5 h-1.5 rounded-full transition-all duration-300 ${i === announcementIndex ? 'bg-white w-4' : 'bg-white/40'}`} />\n            ))}\n          </div>\n        </div>\n        <div className=\"absolute bottom-0 left-0 right-0 h-px bg-white/25\" aria-hidden=\"true\">\n          <div className=\"h-full bg-white/80 transition-[width] duration-150 ease-linear\" style={{ width: `${announcementProgress}%` }} />\n        </div>\n      </div>\n\n      {isReturningUser && (\n        <div className=\"w-full flex justify-center px-4 sm:px-6 lg:px-10 pt-2 pb-2\">\n          <div className=\"inline-flex items-center justify-center gap-2 sm:gap-3 bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200/60 rounded-full py-1.5 px-4 sm:px-6 lg:px-8 shadow-sm w-auto lg:min-w-[400px]\">\n            <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-emerald-400 to-green-500 rounded-full flex items-center justify-center text-white text-sm shrink-0\"></div>\n            <p className=\"text-sm font-bold text-gray-900 whitespace-nowrap\">dv jra{userName ? `, ${userName}` : ''}!</p>\n            <span className=\"text-xs text-emerald-600 whitespace-nowrap hidden sm:inline\">rlnk, hogy visszatrtl</span>\n            <Sparkles className=\"w-4 h-4 text-emerald-500/60 shrink-0\" />\n          </div>\n        </div>\n      )}\n\n      {mobileMenuOpen && (\n        <>\n          <button type=\"button\" className=\"fixed inset-0 z-[199] md:hidden bg-gray-900/60\" onClick={closeMobileMenu} aria-label=\"Men bezrsa (httr)\" />\n          <div\n            ref={mobileMenuRef}\n            className={`fixed top-0 right-0 z-[200] md:hidden ${mobileMenuClosing ? 'animate-slide-out-right' : 'animate-slide-in-right'}`}\n            style={{\n              width: 'min(400px, 88vw)',\n              minWidth: '280px',\n              maxWidth: '400px',\n              bottom: 'var(--unas-bottom-nav, 40px)',\n            }}\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-label=\"Navigcis men\"\n            onTouchStart={handleTouchStart}\n            onTouchEnd={handleTouchEnd}\n            onClick={(e) => e.stopPropagation()}\n          >\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary-600 via-secondary-700 to-secondary-800 rounded-l-2xl overflow-hidden shadow-2xl shadow-black/20\" />\n          <div className=\"relative h-full flex flex-col text-white p-4 sm:p-6 overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-5\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-12 h-12 sm:w-14 sm:h-14 bg-white rounded-xl flex items-center justify-center shadow-lg text-primary-600\"><Home className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                <div>\n                  <div className=\"flex items-baseline\"><span className=\"font-black text-2xl sm:text-3xl text-white\">Marketly</span><span className=\"font-black text-2xl sm:text-3xl text-white/90\">.AI</span></div>\n                  <p className=\"text-xs sm:text-sm text-white/70 font-medium tracking-wider\">BTORBOLT</p>\n                </div>\n              </div>\n              <button type=\"button\" className=\"p-3 min-w-[48px] min-h-[48px] flex items-center justify-center rounded-xl bg-white/20 hover:bg-white/30 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" onClick={closeMobileMenu} aria-label=\"Men bezrsa\"><X className=\"w-7 h-7\" /></button>\n            </div>\n            <div className=\"flex gap-3 sm:gap-4 mb-6\" role=\"region\" aria-label=\"Gyors mveletek\">\n              <button onClick={focusSearchAndClose} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Keress\" data-nav-action=\"search\"><Search className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-600\" /><span>Keress</span></button>\n              <button onClick={() => { onOpenWishlist?.(); closeMobileMenu(); }} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg relative hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Kedvencek\" data-nav-action=\"wishlist\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : 'text-gray-600'}`} /><span>Kedvencek</span>\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full text-sm flex items-center justify-center font-bold text-white\">{wishlistCount}</span>}\n              </button>\n            </div>\n            <div className=\"mb-4\" role=\"region\" aria-label=\"Kategrik\">\n              {recentCategories.length > 0 && (\n                <div className=\"mb-3\">\n                  <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-1.5\">Gyakran nzett</p>\n                  <div className=\"flex flex-wrap gap-2 justify-start\">\n                    {recentCategories.map((name) => {\n                      const Icon = getCategoryIcon(name);\n                      const idx = recentCategories.indexOf(name);\n                      const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                      return (\n                        <button key={name} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex items-center gap-2 py-2.5 px-3.5 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] min-w-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                          <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 text-white\" /></div>\n                          <span className=\"text-xs font-semibold text-left text-white\">{name}</span>\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-3\">Kategrik</p>\n              {Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {categoryHierarchy.slice(0, 16).map((main, idx) => {\n                    const isExpanded = mobileExpandedMain === main.name;\n                    const isActiveMain = activeCategory === main.name;\n                    const children = (main.children || []).slice(0, 10);\n                    const MainIcon = getCategoryIcon(main.name);\n                    const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                    return (\n                      <div key={main.name} className=\"rounded-xl overflow-hidden bg-white/15 border border-white/25 shadow-lg\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setMobileExpandedMain((v) => (v === main.name ? null : main.name))}\n                          className={`w-full flex items-center gap-3 px-4 py-4 min-h-[48px] text-left transition-colors duration-150 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-inset ${isExpanded ? 'bg-white/20' : 'hover:bg-white/20'}`}\n                          aria-expanded={isExpanded}\n                          aria-label={isExpanded ? `${main.name} sszecsuksa` : `${main.name} kategria megnyitsa`}\n                          data-nav-action=\"category-expand\"\n                          data-nav-target={main.name}\n                        >\n                          <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                            <MainIcon className=\"w-5 h-5\" />\n                          </div>\n                          <span className=\"font-bold text-white flex-1 text-left\">{main.name}</span>\n                          <span className=\"text-white/90 text-sm tabular-nums\">{Number(main.productCount || 0).toLocaleString('hu-HU')}</span>\n                          <span className=\"text-white/70\">{isExpanded ? <ChevronUp className=\"w-5 h-5\" /> : <ChevronDown className=\"w-5 h-5\" />}</span>\n                        </button>\n                        {isExpanded && children.length > 0 && (\n                          <div className=\"px-4 pb-4 pt-2 border-t border-white/20 bg-white/10\">\n                            <div className=\"flex flex-wrap gap-2 justify-start text-left\">\n                              <button\n                                onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                className={`px-3 py-2.5 text-sm font-semibold rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white ${isActiveMain ? 'bg-primary-500 text-white' : 'bg-white/20 text-white hover:bg-white/30 border border-white/25'}`}\n                                data-nav-action=\"category\"\n                                data-nav-target={main.name}\n                              >\n                                sszes ({main.name})\n                              </button>\n                              {children.map((child) => {\n                                const isActiveChild = activeCategory === child.name;\n                                return (\n                                  <button\n                                    key={child.name}\n                                    onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                    className={`px-3 py-2.5 text-sm font-medium rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white text-left ${isActiveChild ? 'bg-primary-500 text-white' : 'bg-white/20 text-white/95 hover:bg-white/30 border border-white/25'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={child.name}\n                                  >\n                                    {child.name}\n                                  </button>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                  <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); closeMobileMenu(); }} className=\"w-full flex items-center justify-center gap-2 py-4 mt-3 bg-white/15 rounded-xl font-bold text-white hover:bg-white/25 active:scale-[0.99] min-h-[48px] transition-all border border-white/25 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" data-nav-action=\"category\" data-nav-target=\"sszes\">\n                    sszes termk\n                    <ArrowRight className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              ) : (\n                (() => {\n                  const realCats = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes') : [];\n                  const list = realCats.length > 0 ? realCats : POPULAR_CATEGORIES;\n                  const initialCount = 6;\n                  const shown = mobileCategoriesExpanded ? list : list.slice(0, initialCount);\n                  const hasMore = list.length > initialCount;\n                  return (\n                    <>\n                      <div className=\"grid grid-cols-4 gap-2\">\n                        {shown.map((cat, idx) => {\n                          const name = typeof cat?.name === 'string' ? cat.name : (cat?.name ?? '');\n                          const isReal = realCats.length > 0;\n                          const Icon = isReal ? getCategoryIcon(name) : (cat?.icon ?? Grid3X3);\n                          const color = isReal ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                          return (\n                            <button key={isReal ? name : (cat?.id ?? `m-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex flex-col items-center gap-1 py-2.5 px-1 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                              <div className={`w-9 h-9 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 sm:w-5 sm:h-5 text-white\" /></div>\n                              <span className=\"text-[10px] sm:text-xs font-semibold text-center line-clamp-2 leading-tight text-white\">{name}</span>\n                            </button>\n                          );\n                        })}\n                      </div>\n                      {hasMore && (\n                        <button type=\"button\" onClick={() => setMobileCategoriesExpanded((v) => !v)} className=\"mt-2 w-full flex items-center justify-center gap-2 py-3.5 bg-white/15 rounded-xl hover:bg-white/25 transition-all min-h-[44px] text-white font-semibold text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" aria-expanded={mobileCategoriesExpanded} aria-label={mobileCategoriesExpanded ? 'Kevesebb kategria' : 'Tbb kategria megjelentse'}>\n                          {mobileCategoriesExpanded ? 'Kevesebb' : 'Tbb megjelentse'}\n                          {mobileCategoriesExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                        </button>\n                      )}\n                    </>\n                  );\n                })()\n              )}\n            </div>\n            <div className=\"space-y-3 mb-6\" role=\"region\" aria-label=\"Navigci\">\n              <p className=\"text-sm sm:text-base text-white/90 font-bold uppercase tracking-wider mb-3 sm:mb-4\">Navigci</p>\n              {navItems.map((item, index) => (\n                <button key={item.id} onClick={() => setTabAndClose(item.id)} className={`w-full flex items-center gap-4 px-4 sm:px-5 py-4 sm:py-5 rounded-xl text-left transition-all min-h-[44px] hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-700 ${activeTab === item.id ? 'bg-white text-gray-900 shadow-xl' : 'bg-gray-800 hover:bg-gray-700 border border-gray-700'}`} style={{ animationDelay: `${index * 50}ms` }} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-xl flex items-center justify-center shrink-0 ${activeTab === item.id ? 'bg-gradient-to-br from-primary-500 to-secondary-700 text-white' : 'bg-gray-700 text-white'}`}><item.icon className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`text-lg sm:text-xl font-bold ${activeTab === item.id ? 'text-gray-900' : 'text-white'}`}>{item.label}</span>\n                      {item.isAI && <span className={`px-2 py-0.5 text-xs font-bold rounded-full ${activeTab === item.id ? 'bg-primary-100 text-primary-500' : 'bg-white/20 text-white'}`}>AI</span>}\n                    </div>\n                    <p className={`text-sm sm:text-base ${activeTab === item.id ? 'text-gray-500' : 'text-white/60'}`}>{item.desc}</p>\n                  </div>\n                  <ChevronRight className={`w-5 h-5 sm:w-6 sm:h-6 shrink-0 ${activeTab === item.id ? 'text-primary-500' : 'text-white/40'}`} />\n                </button>\n              ))}\n            </div>\n            {((recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal) || []).length > 0 && (\n              <div className=\"mb-4\" role=\"region\" aria-label=\"Utoljra nzett termkek\">\n                <p className=\"text-xs text-white/90 font-semibold uppercase tracking-wider mb-2 flex items-center gap-1.5\"><Clock className=\"w-3.5 h-3.5\" />Utoljra nzett</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n                  {(recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal).slice(0, 4).map((product) => (\n                    <button key={product?.id ?? 'rv'} type=\"button\" onClick={() => { onRecentProductClick?.(product); closeMobileMenu(); }} className=\"shrink-0 w-20 min-h-[44px] text-left rounded-xl bg-gray-800 hover:bg-gray-700 hover:scale-[1.02] active:scale-[0.98] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white overflow-hidden\" data-nav-action=\"recent-product\" data-nav-target={product?.id} aria-label={`Termk megnyitsa: ${product?.name ?? ''}`}>\n                      <div className=\"w-20 h-20 bg-gray-700 rounded-t-xl overflow-hidden mb-1\">\n                        <img src={fixUrl(product?.imageUrl ?? product?.images?.[0])} alt={product?.name ?? ''} className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                      </div>\n                      <p className=\"text-[10px] text-white/90 truncate px-1 pb-1\">{product?.name ?? ''}</p>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n            <div className=\"mt-auto space-y-3 pb-[env(safe-area-inset-bottom,0)]\" role=\"region\" aria-label=\"Belltsok s elrhetsg\">\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"w-full flex items-center justify-between px-4 py-3.5 min-h-[44px] bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label={isDarkMode ? 'Vilgos md bekapcsolsa' : 'Stt md bekapcsolsa'}>\n                <div className=\"flex items-center gap-3\">{isDarkMode ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}<span className=\"font-semibold text-white\">{isDarkMode ? 'Vilgos md' : 'Stt md'}</span></div>\n                <div className={`w-10 h-6 rounded-full transition-colors ${isDarkMode ? 'bg-primary-400' : 'bg-gray-600'}`}><div className={`w-5 h-5 bg-white rounded-full mt-0.5 transition-transform ${isDarkMode ? 'translate-x-4.5 ml-0.5' : 'translate-x-0.5'}`} /></div>\n              </button>\n              <div className=\"flex gap-2\">\n                <a href=\"tel:+36123456789\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Hvs\"><Phone className=\"w-4 h-4\" />Hvs</a>\n                <a href=\"mailto:info@marketly.hu\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"E-mail kldse\"><Mail className=\"w-4 h-4\" />Email</a>\n              </div>\n              <div className=\"flex justify-center gap-3\">\n                <a href=\"https://instagram.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Instagram\"><Instagram className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://facebook.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Facebook\"><Facebook className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://maps.google.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Trkp\"><MapPin className=\"w-5 h-5 text-white\" /></a>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2\">\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">{productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : '...'}</p><p className=\"text-[9px] text-white/70\">Termk</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">24/7</p><p className=\"text-[9px] text-white/70\">AI Support</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">4.9</p><p className=\"text-[9px] text-white/70\">rtkels</p></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </>\n      )}\n    </>\n  );\n}\n","import React from 'react';\nimport { useScrollPosition } from '../../hooks/useScrollPosition';\n\n/**\n * ScrollProgress - Shows reading/scrolling progress at top of page\n * Gradient bar that fills as user scrolls down. Uses shared scroll hook.\n */\nconst ScrollProgress = () => {\n  const { scrollPercent } = useScrollPosition();\n\n  return (\n    <div className=\"fixed top-0 left-0 right-0 z-50 h-1 bg-gray-200/50\">\n      <div\n        className=\"h-full bg-gradient-to-r from-primary-500 via-secondary-600 to-pink-500 transition-all duration-150 ease-out\"\n        style={{ width: `${scrollPercent}%` }}\n      />\n      {/* Glow effect at the end */}\n      {scrollPercent > 0 && (\n        <div\n          className=\"absolute top-0 h-full w-8 bg-gradient-to-r from-transparent via-white to-transparent opacity-60 blur-sm\"\n          style={{ \n            left: `${Math.max(0, scrollPercent - 2)}%`,\n            transition: 'left 150ms ease-out'\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ScrollProgress;\n","import React from 'react';\nimport { ArrowUp } from 'lucide-react';\nimport { useScrollPastPercent } from '../../hooks/useScrollPosition';\n\n/**\n * BackToTop - Floating button to scroll back to top\n * Only appears after scrolling down 30%. Uses shared scroll hook.\n */\nconst BackToTop = () => {\n  const isVisible = useScrollPastPercent(30);\n\n  const scrollToTop = () => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n    \n    // Haptic feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <button\n      type=\"button\"\n      onClick={scrollToTop}\n      className=\"\n        fixed bottom-[calc(5rem+44px)] md:bottom-24 right-4 md:right-6 z-40\n        w-11 h-11 md:w-12 md:h-12 rounded-full min-w-[44px] min-h-[44px]\n        bg-gradient-to-br from-primary-500 to-secondary-700\n        text-white shadow-lg\n        flex items-center justify-center\n        transition-all duration-300\n        hover:scale-110 hover:shadow-xl\n        active:scale-95\n        animate-fade-in-up\n        focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n      \"\n      aria-label=\"Vissza a tetejre\"\n      title=\"Vissza a tetejre\"\n    >\n      <ArrowUp className=\"w-5 h-5 md:w-6 md:h-6\" />\n      \n      {/* Pulse animation ring */}\n      <span className=\"absolute inset-0 rounded-full bg-primary-500 opacity-0 animate-ping\" />\n    </button>\n  );\n};\n\nexport default BackToTop;\n","/**\n * Framer-motion shim - CSS transition based replacements\n * Fixes Vite production build TDZ issues with framer-motion\n */\nimport React, { forwardRef } from 'react';\n\nconst createMotionComponent = (tag) => {\n  return forwardRef(({\n    children,\n    initial,\n    animate,\n    exit,\n    transition,\n    whileHover,\n    whileTap,\n    variants,\n    className = '',\n    style = {},\n    ...props\n  }, ref) => {\n    const Tag = tag;\n    return (\n      <Tag\n        ref={ref}\n        className={`transition-all duration-300 ${className}`}\n        style={style}\n        {...props}\n      >\n        {children}\n      </Tag>\n    );\n  });\n};\n\nexport const motion = {\n  div: createMotionComponent('div'),\n  span: createMotionComponent('span'),\n  button: createMotionComponent('button'),\n  a: createMotionComponent('a'),\n  ul: createMotionComponent('ul'),\n  li: createMotionComponent('li'),\n  p: createMotionComponent('p'),\n  h1: createMotionComponent('h1'),\n  h2: createMotionComponent('h2'),\n  h3: createMotionComponent('h3'),\n  section: createMotionComponent('section'),\n  article: createMotionComponent('article'),\n  nav: createMotionComponent('nav'),\n  aside: createMotionComponent('aside'),\n  img: createMotionComponent('img'),\n};\n\nexport const AnimatePresence = ({ children }) => <>{children}</>;\n\nexport default motion;\n","import React, { useState, useEffect } from 'react';\nimport { Eye, ShoppingBag, TrendingUp, Users } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * LiveSocialProof - Real-time social proof notifications\n * Shows viewer count, recent purchases, trending items\n */\nconst LiveSocialProof = ({ currentProduct, recentPurchases = [] }) => {\n  const [viewerCount, setViewerCount] = useState(0);\n  const [showNotification, setShowNotification] = useState(false);\n  const [currentNotification, setCurrentNotification] = useState(null);\n\n  // Generate realistic viewer count\n  useEffect(() => {\n    const baseViewers = Math.floor(Math.random() * 30) + 15; // 15-45\n    setViewerCount(baseViewers);\n\n    const interval = setInterval(() => {\n      setViewerCount(prev => {\n        const change = Math.floor(Math.random() * 5) - 2; // -2 to +2\n        return Math.max(10, Math.min(50, prev + change));\n      });\n    }, 10000); // Update every 10s\n\n    return () => clearInterval(interval);\n  }, [currentProduct]);\n\n  // Show at most ONE notification per product view (after 5s), no repeated spam\n  useEffect(() => {\n    if (!currentProduct) {\n      setShowNotification(false);\n      setCurrentNotification(null);\n      return;\n    }\n\n    const notifications = [\n      {\n        icon: ShoppingBag,\n        text: `\"${currentProduct.name}\" npszer vlaszts`,\n        time: '2 perce',\n        color: 'text-green-600',\n        bg: 'bg-green-50'\n      },\n      {\n        icon: TrendingUp,\n        text: `Ez a ${currentProduct.category} most npszer`,\n        time: 'pp most',\n        color: 'text-orange-600',\n        bg: 'bg-orange-50'\n      },\n      {\n        icon: Users,\n        text: `${Math.floor(Math.random() * 10) + 5} ember nzi most`,\n        time: 'l',\n        color: 'text-blue-600',\n        bg: 'bg-blue-50'\n      }\n    ];\n\n    const random = notifications[Math.floor(Math.random() * notifications.length)];\n    setCurrentNotification(random);\n\n    // Single notification 5s after viewing this product; no interval\n    const t = setTimeout(() => {\n      setShowNotification(true);\n      setTimeout(() => setShowNotification(false), 5000);\n    }, 5000);\n\n    return () => {\n      clearTimeout(t);\n      setShowNotification(false);\n    };\n  }, [currentProduct?.id]);\n\n  return (\n    <>\n      {/* Floating Viewer Counter */}\n      {currentProduct && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"fixed bottom-[calc(10rem+44px)] md:bottom-40 left-4 md:left-6 z-40 bg-white rounded-full shadow-lg px-3 md:px-4 py-1.5 md:py-2 flex items-center gap-2\"\n        >\n          <div className=\"relative\">\n            <Eye className=\"w-5 h-5 text-primary-500\" />\n            <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold text-gray-800\">{viewerCount} ember</p>\n            <p className=\"text-xs text-gray-500\">nzi most</p>\n          </div>\n        </motion.div>\n      )}\n\n      {/* Notification Toasts */}\n      <AnimatePresence>\n        {showNotification && currentNotification && (\n          <motion.div\n            initial={{ opacity: 0, y: 50, scale: 0.9 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 50, scale: 0.9 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n            className={`\n              fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-2 md:left-6 z-50\n              max-w-[calc(100vw-1rem)] md:max-w-sm rounded-xl shadow-2xl p-3 md:p-4\n              ${currentNotification.bg} border border-gray-200\n              backdrop-blur-sm\n            `}\n          >\n            <div className=\"flex items-start gap-3\">\n              <div className={`p-2 rounded-lg ${currentNotification.color} bg-white/50`}>\n                <currentNotification.icon className=\"w-5 h-5\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-gray-800\">\n                  {currentNotification.text}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {currentNotification.time}\n                </p>\n              </div>\n              <button\n                onClick={() => setShowNotification(false)}\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                aria-label=\"Bezrs\"\n              >\n                \n              </button>\n            </div>\n\n            {/* Progress bar */}\n            <motion.div\n              initial={{ width: '100%' }}\n              animate={{ width: '0%' }}\n              transition={{ duration: 5, ease: 'linear' }}\n              className=\"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-primary-500 to-secondary-600 rounded-bl-xl\"\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  );\n};\n\nexport default LiveSocialProof;\n","import React, { useState, useEffect } from 'react';\nimport { Circle, Users } from 'lucide-react';\n\n/**\n * LiveActivityStrip  \"X vsrl most bngsz\" social proof.\n * Random szm 525, enyhe animci.\n */\nconst MIN_VIEWERS = 5;\nconst MAX_VIEWERS = 25;\n\nfunction getRandomViewers() {\n  return Math.floor(Math.random() * (MAX_VIEWERS - MIN_VIEWERS + 1)) + MIN_VIEWERS;\n}\n\nexport default function LiveActivityStrip({ className = '' }) {\n  const [viewers, setViewers] = useState(() => getRandomViewers());\n\n  useEffect(() => {\n    const t = setInterval(() => {\n      setViewers((prev) => {\n        const delta = Math.random() > 0.5 ? 1 : -1;\n        const next = prev + delta;\n        return Math.max(MIN_VIEWERS, Math.min(MAX_VIEWERS, next));\n      });\n    }, 4000 + Math.random() * 4000);\n    return () => clearInterval(t);\n  }, []);\n\n  return (\n    <div\n      className={`flex items-center gap-2 text-sm text-gray-600 ${className}`}\n      role=\"status\"\n      aria-live=\"polite\"\n      aria-label={`${viewers} vsrl jelenleg bngsz`}\n    >\n      <Circle className=\"w-2 h-2 text-emerald-500 fill-emerald-500 shrink-0 animate-pulse\" aria-hidden />\n      <Users className=\"w-4 h-4 text-gray-400 shrink-0\" aria-hidden />\n      <span>\n        <strong className=\"text-gray-900 font-semibold\">{viewers}</strong> vsrl most bngsz\n      </span>\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\n\n/**\n * CountUp animation component\n * Counts from 0 to target value with easing\n */\nexport const CountUp = ({ end, duration = 2000, suffix = '', decimals = 0, start = 0, delay = 0 }) => {\n  const [count, setCount] = useState(start);\n  const [isVisible, setIsVisible] = useState(false);\n  const countRef = useRef(null);\n  const hasStarted = useRef(false);\n  const timeoutRef = useRef(null);\n\n  useEffect(() => {\n    const element = countRef.current;\n    if (!element) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted.current) {\n          hasStarted.current = true;\n          timeoutRef.current = setTimeout(() => setIsVisible(true), delay);\n        }\n      },\n      { threshold: 0.1 }\n    );\n\n    observer.observe(element);\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      observer.disconnect();\n    };\n  }, [delay]);\n\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const startTime = Date.now();\n    const diff = end - start;\n\n    const easeOutQuad = (t) => t * (2 - t);\n\n    const timer = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const easedProgress = easeOutQuad(progress);\n      const current = start + diff * easedProgress;\n\n      setCount(current);\n\n      if (progress === 1) {\n        clearInterval(timer);\n      }\n    }, 16); // ~60fps\n\n    return () => clearInterval(timer);\n  }, [isVisible, end, start, duration]);\n\n  const formatNumber = (num) => {\n    if (decimals > 0) {\n      return num.toFixed(decimals);\n    }\n    return Math.floor(num).toLocaleString('hu-HU');\n  };\n\n  return (\n    <span ref={countRef}>\n      {formatNumber(count)}\n      {suffix}\n    </span>\n  );\n};\n\nexport default CountUp;\n","/**\n * Kzs szinonim lista - kliens (aiSearchService) s backend (productService) szmra.\n * Szerkeszthet: config/searchSynonyms.json (backend) - bvti/fellrja a beptett listt.\n */\n\nexport function normalize(str) {\n  if (!str) return '';\n  return str\n    .toLowerCase()\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'a').replace(//g, 'e').replace(//g, 'i')\n    .replace(/[^a-z0-9]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n/** Teljes szinonim map - root  [szinonimk] */\nexport const SYNONYMS = {\n  // === LBTOROK ===\n  'kanap': ['szfa', 'sofa', 'couch', 'kanape', 'kanap', 'kanap', 'lgarnitra', 'garnitra', 'sarokkanap', 'sarok kanap', 'hever', 'rekami', 'pamlag', 'pamlg', 'kanapk', 'lbtor'],\n  'fotel': ['karosszk', 'armchair', 'pihenfotel', 'relax fotel', 'relaxfotel', 'fles fotel', 'flesfotel', 'zskfotel', 'babzsk', 'fotelek', 'fotell'],\n  'puff': ['lke', 'zsmoly', 'lbtart', 'ottoman', 'puffok', 'lbtart'],\n  \n  // === ASZTALOK ===\n  'asztal': ['table', 'asztalka', 'asztalok'],\n  'dohnyzasztal': ['kvasztal', 'coffee table', 'nappali asztal', 'kisasztal', 'lerakasztal', 'dohanyzoasztal', 'dohnyz asztal'],\n  'tkezasztal': ['ebdlasztal', 'dining table', 'konyhaasztal', 'tkezasztal', 'etkezoasztal', 'ebdl asztal'],\n  'rasztal': ['munkaasztal', 'desk', 'szmtgpasztal', 'pc asztal', 'gamer asztal', 'irodaasztal', 'iroasztal', 'iroasztal', 'munka asztal'],\n  'jjeliszekrny': ['jjeli szekrny', 'nightstand', 'jjeli', 'ejjeliszekreny', 'jjeli asztal'],\n  \n  // === SZKEK ===\n  'szk': ['chair', 'szkek', 'szekek', 'szek', 'szkk', 'szekk'],\n  'tkezszk': ['konyhai szk', 'dining chair', 'vendgszk', 'etkezoszek', 'ebdl szk'],\n  'irodai szk': ['forgszk', 'irodai', 'gamer szk', 'gaming szk', 'office chair', 'iroda szk'],\n  'brszk': ['pultszk', 'bar stool', 'magas szk', 'barszek', 'br szk'],\n  \n  // === TROLK ===\n  'szekrny': ['cabinet', 'gardrb', 'gardrbszekrny', 'ruhsszekrny', 'szekreny', 'szekrnyek', 'gardrob', 'gardrb'],\n  'komd': ['fikos szekrny', 'drawer', 'komod', 'komdok', 'fiokos szekreny'],\n  'polc': ['shelf', 'polcok', 'knyvespolc', 'falipolc', 'polc'],\n  'vitrin': ['vegszekrny', 'tlal', 'display cabinet', 'tlaloszkrny'],\n  'tv szekrny': ['tv llvny', 'mdia szekrny', 'lowboard', 'tv btor', 'tv allvny', 'tvlada', 'tv lda'],\n  'gardrb': ['szekrny', 'gardrbszekrny', 'ruhsszekrny', 'ruhsszekrny', 'gardrob'],\n  \n  // === HLSZOBA ===\n  'gy': ['bed', 'franciagy', 'boxspring', 'gykeret', 'agy', 'gynem', 'agyak'],\n  'matrac': ['mattress', 'habmatrac', 'rugs matrac', 'tskarugs', 'matracok'],\n  \n  // === STLUSOK ===\n  'modern': ['kortrs', 'contemporary', 'minimalista', 'dizjn', 'design', 'modrn', 'mdoern'],\n  'skandinv': ['nordic', 'scandi', 'szaki', 'skandinav', 'skandinv', 'skandinv'],\n  'rusztikus': ['vidki', 'country', 'provence', 'natr', 'rusztikus', 'rusztikus'],\n  'indusztrilis': ['industrial', 'loft', 'ipari', 'indusztrialis'],\n  'klasszikus': ['hagyomnyos', 'elegns', 'antik', 'tradicionlis'],\n  'retro': ['vintage', 'mid-century', 'retr'],\n  'minimalista': ['minimalizm', 'egyszer', 'tiszta vonalak'],\n  \n  // === SZNEK ===\n  'fehr': ['white', 'feher', 'hfehr', 'krmfehr', 'feher', 'fehrek'],\n  'fekete': ['black', 'stt', 'antracit', 'fektee'],\n  'szrke': ['gray', 'grey', 'szurke', 'grafit', 'szurke'],\n  'barna': ['brown', 'di', 'tlgy', 'bkk', 'csokold', 'mogyor', 'barnna'],\n  'bzs': ['beige', 'krm', 'homok', 'cappuccino', 'bezs', 'bez'],\n  'kk': ['blue', 'navy', 'tengerkk', 'trkiz', 'kek', 'kekk'],\n  'zld': ['green', 'olva', 'smaragd', 'zold', 'zold'],\n  'piros': ['red', 'bord', 'vrs', 'burgundy'],\n  'srga': ['yellow', 'mustr', 'arany', 'sarga'],\n  'rzsaszn': ['pink', 'rozsaszin', 'pder'],\n  \n  // === ANYAGOK ===\n  'fa': ['wood', 'wooden', 'tmrfa', 'MDF', 'faa', 'fbl'],\n  'fm': ['metal', 'acl', 'vas', 'krm', 'fem', 'fmbl'],\n  'br': ['leather', 'valdi br', 'mbr', 'bor', 'bor'],\n  'szvet': ['fabric', 'textil', 'krpit', 'szovet'],\n  'brsony': ['velvet', 'velr', 'barsony', 'barsony'],\n  'veg': ['glass', 'edzett veg', 'uveg'],\n  \n  // === SZOBK ===\n  'nappali': ['living room', 'szalon', 'nappali', 'nappaliba'],\n  'hlszoba': ['bedroom', 'hl', 'haloszoba', 'haloszoba', 'hlszobba'],\n  'konyha': ['kitchen', 'konyhaba'],\n  'iroda': ['office', 'dolgozszoba', 'home office', 'irodba'],\n  'gyerekszoba': ['kids room', 'gyerek', 'ifjsgi', 'gyerekszobba', 'baba szoba'],\n  'elszoba': ['hall', 'folyos', 'eloszoba', 'eloszobba'],\n  \n  // === FUNKCIK ===\n  'kinyithat': ['gyazhat', 'talakthat', 'vendggy', 'kinyithato'],\n  'trols': ['gynemtarts', 'fikos', 'tarolos'],\n  'llthat': ['dnthet', 'emelhet', 'allithato'],\n  \n  // === R ===\n  'olcs': ['akcis', 'akci', 'kedvezmnyes', 'lerazott', 'olcso', 'olcsobb'],\n  'prmium': ['luxus', 'drga', 'exkluzv', 'designer'],\n  \n  // === SZLLTS / EXTRA ===\n  'gyors': ['expressz', 'gyorsan', 'azonnal'],\n  'szllts': ['szallitas', 'szlltssal', 'delivery'],\n};\n\n/** Sz  root map a gyors lookup-hoz (normalizlt kulcsokkal) */\nconst _wordToRoot = new Map();\nfor (const [root, syns] of Object.entries(SYNONYMS)) {\n  const rootNorm = normalize(root);\n  _wordToRoot.set(rootNorm, rootNorm);\n  for (const syn of syns) {\n    _wordToRoot.set(normalize(syn), rootNorm);\n  }\n}\n\nexport function getWordRoot(word) {\n  return _wordToRoot.get(normalize(word)) || normalize(word);\n}\n\n/** Intent kategrik (normalizlt) - productService s parseSearchIntent szmra */\nexport const TYPE_ROOTS = ['kanape', 'fotel', 'asztal', 'szek', 'agy', 'szekreny', 'polc', 'komod', 'gardrob', 'sarokkanape', 'tvszekreny', 'ejjeliszekreny'];\nexport const COLOR_ROOTS = ['feher', 'fekete', 'szurke', 'barna', 'bezs', 'kek', 'zold', 'piros', 'sarga'];\nexport const STYLE_ROOTS = ['modern', 'skandinav', 'rusztikus', 'indusztrialis', 'klasszikus', 'retro', 'minimalista'];\nexport const MATERIAL_ROOTS = ['fa', 'fem', 'bor', 'szovet', 'barsony', 'uveg'];\n\n/** Root (normalizlt)  szinonimk (normalizlt) - expandWithSynonyms-hoz */\nconst _rootToExpanded = new Map();\nfor (const [root, syns] of Object.entries(SYNONYMS)) {\n  const rootNorm = normalize(root);\n  const expanded = new Set([rootNorm]);\n  (syns || []).forEach(s => expanded.add(normalize(s)));\n  _rootToExpanded.set(rootNorm, expanded);\n}\n\n/** Kliens: szavak bvtse szinonimkkal */\nexport function expandWithSynonyms(words) {\n  const expanded = new Set(words.map(w => normalize(w)));\n  for (const word of words) {\n    const norm = normalize(word);\n    const root = _wordToRoot.get(norm);\n    if (root && _rootToExpanded.has(root)) {\n      _rootToExpanded.get(root).forEach(w => expanded.add(w));\n    }\n  }\n  return Array.from(expanded);\n}\n\n/** Backend: keressi kifejezs bvtse szinonimkkal - OR felttelekhez */\nexport function expandSearchTerms(terms) {\n  const words = Array.isArray(terms) ? terms : String(terms || '').split(/\\s+/).map(t => t.trim()).filter(Boolean);\n  return expandWithSynonyms(words);\n}\n","/**\n * ============================================================================\n * MARKETLY AI SEARCH ENGINE v5.0 - PROFESSIONAL INSTANT SEARCH\n * ============================================================================\n *\n * - NON-BLOCKING: Chunked async indexing\n * - PRECISE: Intent-based scoring + filtering\n * - FUZZY: Typo tolerance (Levenshtein)\n * - FAST: Prefix map O(1) lookup, no O(n) loop\n * - CACHED: LRU cache\n */\n\nimport { SYNONYMS, expandWithSynonyms } from '../../shared/searchSynonyms.js';\nimport { getSearchClickBoosts } from './userPreferencesService.js';\n\nconst DEV = typeof import.meta !== 'undefined' && import.meta.env?.DEV;\n\n// ============================================================================\n// TEXT NORMALIZATION (local - shared uses its own)\n// ============================================================================\n\nfunction normalize(str) {\n  if (!str) return '';\n  return str\n    .toLowerCase()\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'a').replace(//g, 'e').replace(//g, 'i')\n    .replace(/[^a-z0-9]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction getWords(str) {\n  return normalize(str).split(' ').filter(w => w.length >= 2);\n}\n\n// WORD_TO_ROOT for parseSearchIntent (local copy for speed)\nconst WORD_TO_ROOT = new Map();\nfor (const [root, syns] of Object.entries(SYNONYMS)) {\n  const rootNorm = normalize(root);\n  WORD_TO_ROOT.set(rootNorm, rootNorm);\n  for (const syn of syns || []) {\n    WORD_TO_ROOT.set(normalize(syn), rootNorm);\n  }\n}\n\n// Levenshtein distance - typo tolerance\nfunction levenshtein(a, b) {\n  if (a.length === 0) return b.length;\n  if (b.length === 0) return a.length;\n  const matrix = [];\n  for (let i = 0; i <= b.length; i++) matrix[i] = [i];\n  for (let j = 0; j <= a.length; j++) matrix[0][j] = j;\n  for (let i = 1; i <= b.length; i++) {\n    for (let j = 1; j <= a.length; j++) {\n      matrix[i][j] = b[i - 1] === a[j - 1]\n        ? matrix[i - 1][j - 1]\n        : Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);\n    }\n  }\n  return matrix[b.length][a.length];\n}\n\n/** \"Did you mean?\" - legkzelebbi sz a sztrbl, ha 0 tallat. Exportlt a server preview 0 tallatnl. */\nexport function getDidYouMeanSuggestion(queryNorm, queryWords = null, vocabulary = null) {\n  const words = queryWords || getWords(queryNorm);\n  if (!vocabulary || vocabulary.length === 0) {\n    vocabulary = [...new Set(Object.keys(SYNONYMS).flatMap(k => [normalize(k), ...(SYNONYMS[k] || []).map(normalize)]))];\n  }\n  const replacements = [];\n  for (const w of words) {\n    if (w.length < 2) {\n      replacements.push(w);\n      continue;\n    }\n    let bestWord = w;\n    let bestDist = 999;\n    const first = w[0];\n    for (const v of vocabulary) {\n      if (v === w) continue;\n      if (v.length < 2) continue;\n      if (v[0] !== first && Math.abs(v.length - w.length) > 2) continue;\n      const d = levenshtein(w, v);\n      if (d < bestDist && d <= 2) {\n        bestDist = d;\n        bestWord = v;\n      }\n    }\n    replacements.push(bestWord);\n  }\n  const suggested = replacements.join(' ');\n  return suggested && suggested !== queryNorm ? suggested : null;\n}\n\n/** Find words in vocabulary within edit distance - only same first letter + similar length for speed */\nfunction findFuzzyMatches(word, vocabulary, maxDist = 2) {\n  const results = [];\n  const dist = word.length <= 4 ? 1 : Math.min(2, Math.floor(word.length / 4) + 1);\n  const first = word[0];\n  const lenMin = word.length - 2;\n  const lenMax = word.length + 2;\n  for (const v of vocabulary) {\n    if (v === word) continue;\n    if (v[0] !== first || v.length < lenMin || v.length > lenMax) continue;\n    const d = levenshtein(word, v);\n    if (d <= dist && d <= maxDist) results.push(v);\n  }\n  return results;\n}\n\n// ============================================================================\n// ENGINE STATE\n// ============================================================================\n\nlet INDEX = {\n  ready: false,\n  building: false,\n  products: [],\n  normalized: [],\n  wordToProducts: new Map(),\n  prefixToWords: new Map(), // prefix (3+ chars) -> Set<word> - O(1) prefix lookup\n  cache: new Map(),\n  stats: { products: 0, words: 0, buildTime: 0 }\n};\n\nfunction devLog(...args) {\n  if (DEV) console.log(...args);\n}\n\n// ============================================================================\n// INDEX BUILDING - with prefix map\n// ============================================================================\n\nfunction buildPrefixMap() {\n  INDEX.prefixToWords = new Map();\n  for (const word of INDEX.wordToProducts.keys()) {\n    if (word.length < 3) continue;\n    for (let len = 3; len <= word.length; len++) {\n      const prefix = word.substring(0, len);\n      if (!INDEX.prefixToWords.has(prefix)) {\n        INDEX.prefixToWords.set(prefix, new Set());\n      }\n      INDEX.prefixToWords.get(prefix).add(word);\n    }\n  }\n}\n\nexport async function buildSearchIndex(products) {\n  if (!products || products.length === 0) {\n    if (DEV) console.warn(' No products to index');\n    return false;\n  }\n\n  if (INDEX.building) {\n    devLog(' Index already building...');\n    return false;\n  }\n\n  if (INDEX.ready && INDEX.products === products && INDEX.stats.products === products.length) {\n    devLog(' Index already up to date');\n    return true;\n  }\n\n  INDEX.building = true;\n  INDEX.ready = false;\n  devLog(` Starting to learn ${products.length.toLocaleString()} products...`);\n\n  const startTime = performance.now();\n\n  INDEX.products = products;\n  INDEX.normalized = new Array(products.length);\n  INDEX.wordToProducts = new Map();\n  INDEX.cache = new Map();\n\n  const includeDesc = products.length <= 50000;\n  const CHUNK_SIZE = 5000;\n  let processed = 0;\n\n  const processChunk = () => {\n    return new Promise(resolve => {\n      const end = Math.min(processed + CHUNK_SIZE, products.length);\n\n      for (let i = processed; i < end; i++) {\n        const p = products[i];\n        const nameNorm = normalize(p.name || '');\n        const catNorm = normalize(p.category || '');\n        const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n\n        const allWords = new Set([\n          ...getWords(nameNorm),\n          ...getWords(catNorm),\n          ...(includeDesc ? getWords(descNorm) : [])\n        ]);\n        const expanded = expandWithSynonyms(Array.from(allWords));\n\n        INDEX.normalized[i] = { nameNorm, catNorm, price: p.salePrice || p.price || 0 };\n\n        for (const word of expanded) {\n          if (!INDEX.wordToProducts.has(word)) {\n            INDEX.wordToProducts.set(word, new Set());\n          }\n          INDEX.wordToProducts.get(word).add(i);\n        }\n      }\n\n      processed = end;\n      setTimeout(resolve, 0);\n    });\n  };\n\n  while (processed < products.length) {\n    await processChunk();\n    const pct = Math.round((processed / products.length) * 100);\n    if (pct % 20 === 0 && pct > 0) devLog(`    ${pct}% indexed...`);\n  }\n\n  buildPrefixMap();\n\n  const elapsed = performance.now() - startTime;\n  INDEX.ready = true;\n  INDEX.building = false;\n  INDEX.stats = {\n    products: products.length,\n    words: INDEX.wordToProducts.size,\n    buildTime: elapsed\n  };\n\n  devLog(` LEARNED ${products.length.toLocaleString()} products in ${elapsed.toFixed(0)}ms`);\n  devLog(`    ${INDEX.wordToProducts.size.toLocaleString()} words, ${INDEX.prefixToWords.size} prefixes`);\n\n  return true;\n}\n\nexport function isIndexReady() {\n  return INDEX.ready;\n}\n\nexport function getIndexStats() {\n  return {\n    isIndexed: INDEX.ready,\n    building: INDEX.building,\n    productCount: INDEX.stats.products,\n    wordCount: INDEX.stats.words,\n    buildTime: INDEX.stats.buildTime\n  };\n}\n\n// ============================================================================\n// MAIN SEARCH - with intent filtering, prefix map, typo tolerance\n// ============================================================================\n\nexport function smartSearch(products, query, options = {}) {\n  const { limit = 100, applyIntent = true } = options;\n\n  if (!query || !query.trim()) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n\n  if ((!products || products.length === 0) && !INDEX.ready) {\n    if (DEV) console.warn(' smartSearch: No products and no index');\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n\n  const queryNorm = normalize(query.trim());\n  const intent = applyIntent ? parseSearchIntent(query) : null;\n\n  const cacheKey = `${queryNorm}:${limit}:${intent?.priceRange ? JSON.stringify(intent.priceRange) : ''}`;\n  if (INDEX.cache.has(cacheKey)) {\n    const cached = INDEX.cache.get(cacheKey);\n    const clickBoosts = getSearchClickBoosts(query.trim());\n    if (Object.keys(clickBoosts).length > 0 && cached.results?.length > 0) {\n      const boosted = cached.results.filter(p => (clickBoosts[p.id] || 0) > 0);\n      const rest = cached.results.filter(p => !(clickBoosts[p.id] || 0));\n      const reordered = [...boosted.sort((a, b) => (clickBoosts[b.id] || 0) - (clickBoosts[a.id] || 0)), ...rest];\n      return { ...cached, results: reordered, fromCache: true };\n    }\n    return { ...cached, fromCache: true };\n  }\n\n  const startTime = performance.now();\n\n  if (!INDEX.ready && !INDEX.building && products?.length > 0) {\n    buildSearchIndexSync(products);\n  }\n\n  if (!INDEX.ready) {\n    return directSearch(products, queryNorm, limit, intent);\n  }\n\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  const clickBoosts = getSearchClickBoosts(query.trim());\n\n  const candidateScores = new Map();\n  const vocabArray = Array.from(INDEX.wordToProducts.keys());\n\n  for (const word of expandedQuery) {\n    let matched = false;\n\n    // Exact match\n    const exact = INDEX.wordToProducts.get(word);\n    if (exact) {\n      matched = true;\n      for (const idx of exact) {\n        candidateScores.set(idx, (candidateScores.get(idx) || 0) + 10);\n      }\n    }\n\n    // Prefix match via O(1) lookup (no O(n) loop)\n    if (word.length >= 3 && INDEX.prefixToWords?.has(word)) {\n      const prefixWords = INDEX.prefixToWords.get(word);\n      for (const indexedWord of prefixWords) {\n        if (indexedWord === word) continue;\n        const idxSet = INDEX.wordToProducts.get(indexedWord);\n        if (idxSet) {\n          matched = true;\n          for (const idx of idxSet) {\n            candidateScores.set(idx, (candidateScores.get(idx) || 0) + 5);\n          }\n        }\n      }\n    }\n\n    // Typo tolerance - ha nincs exact/prefix, prblj fuzzy-t\n    if (!matched && word.length >= 3) {\n      const fuzzy = findFuzzyMatches(word, vocabArray, 2);\n      for (const fw of fuzzy.slice(0, 5)) {\n        const idxSet = INDEX.wordToProducts.get(fw);\n        if (idxSet) {\n          for (const idx of idxSet) {\n            candidateScores.set(idx, (candidateScores.get(idx) || 0) + 3);\n          }\n        }\n      }\n    }\n  }\n\n  const scored = [];\n\n  for (const [idx, baseScore] of candidateScores) {\n    const norm = INDEX.normalized[idx];\n    const product = INDEX.products[idx];\n    if (!norm || !product) continue;\n\n    // Intent: r szrs\n    if (applyIntent && intent?.priceRange) {\n      const price = Number(norm.price) || 0;\n      if (intent.priceRange.max != null && price > intent.priceRange.max) continue;\n      if (intent.priceRange.min != null && price < intent.priceRange.min) continue;\n    }\n\n    let score = baseScore;\n\n    if (norm.nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (norm.nameNorm === queryNorm) score += 2000;\n      else if (norm.nameNorm.startsWith(queryNorm)) score += 500;\n    }\n\n    let nameWordMatches = 0;\n    for (const w of queryWords) {\n      if (norm.nameNorm.includes(w)) {\n        nameWordMatches++;\n        score += 50;\n      }\n    }\n    if (nameWordMatches === queryWords.length && queryWords.length > 1) score += 300;\n\n    if (norm.catNorm.includes(queryNorm)) score += 100;\n    for (const w of queryWords) {\n      if (norm.catNorm.includes(w)) score += 30;\n    }\n\n    score += clickBoosts[product.id] || 0;\n\n    scored.push({ idx, score, product });\n  }\n\n  scored.sort((a, b) => b.score - a.score);\n  const results = scored.slice(0, limit).map(s => s.product);\n  const searchTime = performance.now() - startTime;\n\n  devLog(` Found ${scored.length} matches in ${searchTime.toFixed(1)}ms`);\n\n  let didYouMean = null;\n  if (scored.length === 0 && queryWords.length > 0) {\n    didYouMean = getDidYouMeanSuggestion(queryNorm, queryWords, vocabArray);\n  }\n\n  let broadenSuggestions = [];\n  if (scored.length > 0 && scored.length < 5 && queryWords.length > 0) {\n    for (const w of queryWords.slice(0, 2)) {\n      const root = WORD_TO_ROOT.get(w);\n      if (root && SYNONYMS[Object.keys(SYNONYMS).find(k => normalize(k) === root)]) {\n        const syns = SYNONYMS[Object.keys(SYNONYMS).find(k => normalize(k) === root)];\n        const alt = syns?.[0];\n        if (alt && alt !== w) {\n          const rewritten = queryWords.map(ww => (ww === w ? alt : ww)).join(' ');\n          if (rewritten !== queryNorm) broadenSuggestions.push(rewritten);\n        }\n      }\n    }\n    broadenSuggestions = [...new Set(broadenSuggestions)].slice(0, 3);\n  }\n\n  const result = { results, totalMatches: scored.length, searchTime, didYouMean, broadenSuggestions };\n  if (scored.length > 0) {\n    INDEX.cache.set(cacheKey, result);\n    if (INDEX.cache.size > 500) {\n      const firstKey = INDEX.cache.keys().next().value;\n      INDEX.cache.delete(firstKey);\n    }\n  }\n\n  return result;\n}\n\nfunction buildSearchIndexSync(products) {\n  if (INDEX.building) return;\n\n  INDEX.products = products;\n  INDEX.normalized = [];\n  INDEX.wordToProducts = new Map();\n  INDEX.cache = new Map();\n\n  const includeDesc = products.length <= 50000;\n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n\n    const allWords = new Set([\n      ...getWords(nameNorm),\n      ...getWords(catNorm),\n      ...(includeDesc ? getWords(descNorm) : [])\n    ]);\n    const expanded = expandWithSynonyms(Array.from(allWords));\n\n    INDEX.normalized[i] = { nameNorm, catNorm, price: p.salePrice || p.price || 0 };\n\n    for (const word of expanded) {\n      if (!INDEX.wordToProducts.has(word)) {\n        INDEX.wordToProducts.set(word, new Set());\n      }\n      INDEX.wordToProducts.get(word).add(i);\n    }\n  }\n\n  buildPrefixMap();\n  INDEX.ready = true;\n  INDEX.stats = { products: products.length, words: INDEX.wordToProducts.size, buildTime: 0 };\n  if (DEV) devLog(` Sync index built: ${products.length} products`);\n}\n\nfunction directSearch(products, queryNorm, limit, intent) {\n  if (!products || products.length === 0) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n\n  const startTime = performance.now();\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  const scored = [];\n\n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    const price = Number(p.salePrice ?? p.price ?? 0) || 0;\n\n    if (intent?.priceRange) {\n      if (intent.priceRange.max != null && price > intent.priceRange.max) continue;\n      if (intent.priceRange.min != null && price < intent.priceRange.min) continue;\n    }\n\n    let score = 0;\n    if (nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (nameNorm.startsWith(queryNorm)) score += 500;\n    }\n\n    for (const word of expandedQuery) {\n      if (nameNorm.includes(word)) score += 50;\n      if (catNorm.includes(word)) score += 20;\n    }\n\n    if (score > 0) scored.push({ product: p, score });\n  }\n\n  scored.sort((a, b) => b.score - a.score);\n  const results = scored.slice(0, limit).map(s => s.product);\n  return { results, totalMatches: scored.length, searchTime: performance.now() - startTime };\n}\n\n// ============================================================================\n// AUTOCOMPLETE - index-based, early exit, prefix map\n// ============================================================================\n\nexport function getAutocompleteSuggestions(products, query, limit = 10) {\n  if (!query || query.length < 2) return [];\n\n  const queryNorm = normalize(query);\n  const suggestions = [];\n  const seen = new Set();\n\n  if (INDEX.ready && INDEX.products.length > 0) {\n    // Use prefix map for fast product name lookup\n    const prefixMatches = INDEX.prefixToWords?.get(queryNorm);\n    const exactWord = INDEX.wordToProducts.get(queryNorm);\n    const wordsToCheck = new Set(prefixMatches || []);\n    if (exactWord) wordsToCheck.add(queryNorm);\n\n    for (const word of wordsToCheck) {\n      const idxSet = INDEX.wordToProducts.get(word);\n      if (!idxSet) continue;\n      for (const idx of idxSet) {\n        if (suggestions.length >= limit * 3) break;\n        const product = INDEX.products[idx];\n        const name = product?.name;\n        if (!name || seen.has(name)) continue;\n        seen.add(name);\n        const nameNorm = INDEX.normalized[idx]?.nameNorm || '';\n        const score = nameNorm.startsWith(queryNorm) ? 200 : 100;\n        suggestions.push({ text: name, type: 'product', product, score });\n      }\n      if (suggestions.length >= limit * 3) break;\n    }\n\n    // Fallback: contains in name (via normalized)\n    if (suggestions.length < limit) {\n      for (let i = 0; i < INDEX.products.length; i++) {\n        if (suggestions.length >= limit * 3) break;\n        const nameNorm = INDEX.normalized[i]?.nameNorm || '';\n        if (!nameNorm.includes(queryNorm) || nameNorm.startsWith(queryNorm)) continue;\n        const product = INDEX.products[i];\n        const name = product?.name;\n        if (!name || seen.has(name)) continue;\n        seen.add(name);\n        suggestions.push({ text: name, type: 'product', product, score: 80 });\n      }\n    }\n  } else {\n    const prods = products || [];\n    const maxScan = Math.min(prods.length, 50000);\n    for (let i = 0; i < maxScan; i++) {\n      if (suggestions.length >= limit * 3) break;\n      const product = prods[i];\n      const nameNorm = normalize(product?.name || '');\n      if (!nameNorm) continue;\n      if (nameNorm.startsWith(queryNorm)) {\n        if (!seen.has(product.name)) {\n          seen.add(product.name);\n          suggestions.push({ text: product.name, type: 'product', product, score: 200 });\n        }\n      } else if (nameNorm.includes(queryNorm)) {\n        if (!seen.has(product.name)) {\n          seen.add(product.name);\n          suggestions.push({ text: product.name, type: 'product', product, score: 100 });\n        }\n      }\n    }\n  }\n\n  for (const [root, syns] of Object.entries(SYNONYMS)) {\n    if (suggestions.length >= limit) break;\n    if (normalize(root).includes(queryNorm) && !seen.has(root)) {\n      seen.add(root);\n      suggestions.push({ text: root, type: 'keyword', score: 50 });\n    }\n  }\n\n  suggestions.sort((a, b) => b.score - a.score);\n  return suggestions.slice(0, limit);\n}\n\n// ============================================================================\n// INTENT PARSING - expanded price, types, styles\n// ============================================================================\n\nexport function parseSearchIntent(query) {\n  const queryNorm = normalize(query);\n  const intent = {\n    originalQuery: query,\n    productTypes: [],\n    colors: [],\n    styles: [],\n    materials: [],\n    priceRange: null,\n    keywords: getWords(query)\n  };\n\n  const typeRoots = ['kanape', 'fotel', 'asztal', 'szek', 'agy', 'szekreny', 'polc', 'komod', 'gardrob', 'sarokkanape', 'tvszekreny', 'ejjeliszekreny'];\n  const colorRoots = ['feher', 'fekete', 'szurke', 'barna', 'bezs', 'kek', 'zold', 'piros', 'sarga'];\n  const styleRoots = ['modern', 'skandinav', 'rusztikus', 'indusztrialis', 'klasszikus', 'retro', 'minimalista'];\n  const materialRoots = ['fa', 'fem', 'bor', 'szovet', 'barsony', 'uveg'];\n\n  for (const word of getWords(queryNorm)) {\n    const root = WORD_TO_ROOT.get(word) || word;\n    if (typeRoots.includes(root)) intent.productTypes.push(root);\n    if (colorRoots.includes(root)) intent.colors.push(root);\n    if (styleRoots.includes(root)) intent.styles.push(root);\n    if (materialRoots.includes(root)) intent.materials.push(root);\n  }\n\n  const toNum = (v, mult) => {\n    const n = parseInt(v || '0', 10);\n    if (mult && /ezer|e|k|ez/i.test(String(mult))) return n * 1000;\n    return n;\n  };\n\n  if (/felett/i.test(query)) {\n    const m = query.match(/(\\d+)\\s*(ezer|e|k|ez)?\\s*(?:ft|forint)?\\s*felett/i);\n    if (m) intent.priceRange = { min: toNum(m[1], m[2]), max: Infinity };\n  } else if (/[-]/.test(query)) {\n    const m = query.match(/(\\d+)\\s*(ezer|e|k|ez)?\\s*[-]\\s*(\\d+)\\s*(ezer|e|k|ez)?/i);\n    if (m) intent.priceRange = { min: toNum(m[1], m[2]), max: toNum(m[3], m[4] || m[2]) };\n  } else if (/alatt|ig|kztt/i.test(query) || /\\d+\\s*(e|ezer|k|ez)/i.test(query)) {\n    const m = query.match(/(\\d+)\\s*(ezer|e|k|ez)?(?:\\s*(?:ft|forint))?\\s*(?:alatt|ig)?/i)\n      || query.match(/(\\d+)\\s*(ezer|e|k|ez)?\\s/);\n    if (m) intent.priceRange = { min: 0, max: toNum(m[1], m[2]) };\n  }\n\n  if (queryNorm.includes('olcso') || queryNorm.includes('akcio')) {\n    intent.priceRange = intent.priceRange || { min: 0, max: 100000 };\n  }\n\n  return intent;\n}\n\n// ============================================================================\n// PROACTIVE SUGGESTIONS\n// ============================================================================\n\n/** Kevs tallatnl: alternatv keressek szinonimkkal (server mode-hoz is) */\nexport function getBroadenSuggestions(queryNorm, totalMatches) {\n  if (totalMatches >= 5 || totalMatches === 0) return [];\n  const queryWords = getWords(queryNorm);\n  const broaden = [];\n  for (const w of queryWords.slice(0, 2)) {\n    const root = WORD_TO_ROOT.get(w);\n    const key = Object.keys(SYNONYMS).find(k => normalize(k) === root);\n    if (key && SYNONYMS[key]?.[0]) {\n      const alt = SYNONYMS[key][0];\n      if (normalize(alt) !== w) {\n        broaden.push(queryWords.map(ww => (ww === w ? alt : ww)).join(' '));\n      }\n    }\n  }\n  return [...new Set(broaden)].slice(0, 3);\n}\n\nexport function getProactiveSuggestions() {\n  return [\n    { icon: '', text: 'kanap', query: 'kanap' },\n    { icon: '', text: 'fotel', query: 'fotel' },\n    { icon: '', text: 'szk', query: 'szk' },\n    { icon: '', text: 'gy', query: 'gy' },\n    { icon: '', text: 'szekrny', query: 'szekrny' },\n    { icon: '', text: 'akcis', query: 'akcis' },\n  ];\n}\n\nexport default {\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats,\n  smartSearch,\n  getAutocompleteSuggestions,\n  parseSearchIntent,\n  getProactiveSuggestions\n};\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Search, Sparkles, Camera, ArrowRight, Wand2, X, Package, CheckCircle2, TrendingUp, ChevronRight, Plus, SlidersHorizontal, BrainCircuit, RotateCcw, Filter, Award, Lightbulb } from 'lucide-react';\nimport {\n  buildSearchIndex,\n  getAutocompleteSuggestions,\n  getProactiveSuggestions,\n  parseSearchIntent,\n  smartSearch,\n  getBroadenSuggestions\n} from '../../services/aiSearchService';\nimport { trackSearch, trackSearchClick, trackSectionEvent, getSearchHistory, getViewedProducts, getLikedProducts } from '../../services/userPreferencesService';\nimport { formatPrice as formatPriceHu } from '../../utils/helpers';\n\nconst QUICK_INTENTS = [\n  'bzs kanap 100e alatt',\n  'kis nappaliba fotel',\n  'skandinv stlus komd',\n  'gyors szlltssal'\n];\n\nconst SUCCESSFUL_SEARCHES_KEY = 'mkt_successful_hero_searches';\nconst SEARCH_DEBOUNCE_MS = 150;\nconst LONG_PRESS_MS = 450;\n\nconst QUICK_FILTER_PRESETS = {\n  r: ['80e alatt', '120e alatt', '180e alatt'],\n  Stlus: ['modern', 'skandinv', 'minimalista'],\n  Helyisg: ['nappaliba', 'hlszobba', 'elszobba']\n};\nconst PROACTIVE_QUICK = getProactiveSuggestions().map((item) => item.query);\n\nconst escapeRegExp = (value = '') => value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\nexport default function HeroSmartSearch({\n  products = [],\n  onSearch,\n  onTryAI,\n  variant = 'A',\n  onOpenProductQuickView,\n  serverSearchMode = false,\n  onFetchSearchPreview\n}) {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [didSearch, setDidSearch] = useState(false);\n  const [dismissedFilterIds, setDismissedFilterIds] = useState([]);\n  const [compareProducts, setCompareProducts] = useState([]);\n  const [searchJourney, setSearchJourney] = useState([]);\n  const [showRewriteOptions, setShowRewriteOptions] = useState(false);\n  const [showQuickFilterPanel, setShowQuickFilterPanel] = useState(false);\n  const [likedProductIds, setLikedProductIds] = useState([]);\n  const [viewedProductIds, setViewedProductIds] = useState([]);\n  const [preferredCategories, setPreferredCategories] = useState([]);\n  const [preferredKeywords, setPreferredKeywords] = useState([]);\n  const [searchPulse, setSearchPulse] = useState(false);\n  const [resultCountPulse, setResultCountPulse] = useState(false);\n  const [hoverCard, setHoverCard] = useState({ id: null, rx: 0, ry: 0 });\n  const [smartResults, setSmartResults] = useState([]);\n  const [smartTotalMatches, setSmartTotalMatches] = useState(0);\n  const [broadenSuggestions, setBroadenSuggestions] = useState([]);\n  const [isIndexBuilding, setIsIndexBuilding] = useState(false);\n  const [previewProduct, setPreviewProduct] = useState(null);\n  const [previewAnchor, setPreviewAnchor] = useState(null);\n  const [serverPreview, setServerPreview] = useState({ results: [], total: 0, loading: false });\n  const serverRequestIdRef = useRef(0);\n  const instantSearchRef = useRef('');\n  const longPressTimerRef = useRef(null);\n\n  const trimmedQuery = query.trim();\n\n  const suggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [];\n    if (serverSearchMode && serverPreview.results?.length > 0) {\n      return serverPreview.results.slice(0, 6).map((p) => ({\n        text: p.name,\n        type: 'product',\n        product: p,\n        score: 150\n      }));\n    }\n    if (!Array.isArray(products) || products.length === 0) return [];\n    const local = getAutocompleteSuggestions(products, trimmedQuery, 6) || [];\n    return local;\n  }, [products, trimmedQuery, serverSearchMode, serverPreview.results]);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!Array.isArray(products) || products.length === 0) return () => { cancelled = true; };\n    setIsIndexBuilding(true);\n    buildSearchIndex(products)\n      .catch(() => false)\n      .finally(() => {\n        if (!cancelled) setIsIndexBuilding(false);\n      });\n    return () => { cancelled = true; };\n  }, [products]);\n\n  // Debounced query for expensive smartSearch\n  const [debouncedQuery, setDebouncedQuery] = useState(trimmedQuery);\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      const t = setTimeout(() => setDebouncedQuery(''), SEARCH_DEBOUNCE_MS);\n      return () => clearTimeout(t);\n    }\n    const t = setTimeout(() => setDebouncedQuery(trimmedQuery), SEARCH_DEBOUNCE_MS);\n    return () => clearTimeout(t);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (debouncedQuery.length < 2) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      setBroadenSuggestions([]);\n      if (serverSearchMode) setServerPreview({ results: [], total: 0, loading: false });\n      return;\n    }\n\n    if (serverSearchMode && typeof onFetchSearchPreview === 'function') {\n      const requestId = ++serverRequestIdRef.current;\n      setServerPreview((p) => ({ ...p, loading: true }));\n      onFetchSearchPreview(debouncedQuery)\n        .then((data) => {\n          if (serverRequestIdRef.current !== requestId) return;\n          const results = Array.isArray(data?.results) ? data.results : [];\n          const total = typeof data?.total === 'number' ? data.total : results.length;\n          setServerPreview({ results, total, loading: false });\n          setSmartResults(results);\n          setSmartTotalMatches(total);\n          setResultCountPulse(true);\n        })\n        .catch(() => {\n          if (serverRequestIdRef.current !== requestId) return;\n          setServerPreview({ results: [], total: 0, loading: false });\n          setSmartResults([]);\n          setSmartTotalMatches(0);\n          setBroadenSuggestions([]);\n        });\n      return;\n    }\n\n    if (!Array.isArray(products) || products.length === 0) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      return;\n    }\n\n    const result = smartSearch(products, debouncedQuery, { limit: 24 });\n    const nextResults = result?.results || [];\n    const nextTotal = result?.totalMatches || 0;\n    setSmartResults(nextResults);\n    setSmartTotalMatches(nextTotal);\n    setBroadenSuggestions(result?.broadenSuggestions || []);\n    setResultCountPulse(true);\n  }, [products, debouncedQuery, serverSearchMode, onFetchSearchPreview]);\n\n  useEffect(() => {\n    if (!resultCountPulse) return;\n    const t = setTimeout(() => setResultCountPulse(false), 500);\n    return () => clearTimeout(t);\n  }, [resultCountPulse]);\n\n  const queryTokens = useMemo(() => (\n    trimmedQuery\n      .toLowerCase()\n      .split(/[\\s,/-]+/)\n      .map((t) => t.trim())\n      .filter((t) => t.length >= 2)\n      .slice(0, 4)\n  ), [trimmedQuery]);\n\n  const intent = useMemo(() => {\n    if (trimmedQuery.length < 3) return null;\n    return parseSearchIntent(trimmedQuery);\n  }, [trimmedQuery]);\n\n  const parsedFilters = useMemo(() => {\n    if (!intent) return [];\n    const filters = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      const value = String(intent.productTypes[0]);\n      filters.push({ id: `product-${value}`, label: 'termk', value, rawValue: value });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      const value = String(intent.styles[0]);\n      filters.push({ id: `style-${value}`, label: 'stlus', value, rawValue: value });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      const value = String(intent.colors[0]);\n      filters.push({ id: `color-${value}`, label: 'szn', value, rawValue: value });\n    }\n    if (intent.priceRange?.max && Number.isFinite(intent.priceRange.max)) {\n      const value = `max ${Math.round(intent.priceRange.max / 1000)}k`;\n      filters.push({ id: 'price-max', label: 'r', value, rawValue: 'alatt' });\n    } else if (intent.priceRange?.min) {\n      const value = `min ${Math.round(intent.priceRange.min / 1000)}k`;\n      filters.push({ id: 'price-min', label: 'r', value, rawValue: 'felett' });\n    }\n    if (intent.isOnSale) filters.push({ id: 'sale', label: 'md', value: 'akcis', rawValue: 'akci' });\n    return filters.slice(0, 5);\n  }, [intent]);\n\n  const activeFilters = useMemo(\n    () => parsedFilters.filter((f) => !dismissedFilterIds.includes(f.id)),\n    [parsedFilters, dismissedFilterIds]\n  );\n\n  const queryMatchedProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0 || trimmedQuery.length < 2) return [];\n    if (smartResults.length > 0) return smartResults.slice(0, 40);\n    return products\n      .filter((p) => {\n        const haystack = `${p?.name || ''} ${p?.category || ''}`.toLowerCase();\n        return queryTokens.some((token) => haystack.includes(token));\n      })\n      .slice(0, 30);\n  }, [products, trimmedQuery, queryTokens, smartResults]);\n\n  const rankedQueryProducts = useMemo(() => {\n    if (queryMatchedProducts.length === 0) return [];\n\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n\n    return queryMatchedProducts\n      .map((product) => {\n        const name = String(product?.name || '').toLowerCase();\n        const categoryFull = String(product?.category || '').toLowerCase();\n        const categoryLeaf = categoryFull.split('>').pop()?.trim() || '';\n        let score = 0;\n\n        queryTokens.forEach((token) => {\n          if (name.includes(token)) score += 20;\n          if (categoryFull.includes(token)) score += 12;\n          if (preferredKeywords.some((kw) => token.includes(kw) || kw.includes(token))) score += 6;\n        });\n\n        if (preferredCategories.some((cat) => categoryFull.includes(cat.toLowerCase()))) score += 15;\n        if (categoryLeaf && preferredCategories.some((cat) => categoryLeaf.includes(cat.toLowerCase()))) score += 10;\n        if (likedSet.has(String(product?.id))) score += 40;\n        if (viewedSet.has(String(product?.id))) score += 12;\n\n        return { product, score };\n      })\n      .sort((a, b) => b.score - a.score)\n      .map((entry) => entry.product);\n  }, [queryMatchedProducts, queryTokens, preferredKeywords, preferredCategories, likedProductIds, viewedProductIds]);\n\n  const previewProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n\n    const byAutocomplete = suggestions\n      .filter((s) => s?.type === 'product' && s?.product)\n      .map((s) => s.product);\n\n    const merged = [...byAutocomplete, ...rankedQueryProducts];\n    const unique = [];\n    const seen = new Set();\n    for (const item of merged) {\n      const id = String(item?.id ?? item?.sku ?? item?.name ?? '');\n      if (!id || seen.has(id)) continue;\n      seen.add(id);\n      unique.push(item);\n      if (unique.length >= 10) break;\n    }\n    return unique;\n  }, [products, suggestions, rankedQueryProducts]);\n\n  const starterProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n    const scored = products.map((p) => {\n      const id = String(p?.id || '');\n      const category = String(p?.category || '').toLowerCase();\n      let score = 0;\n      if (likedSet.has(id)) score += 40;\n      if (viewedSet.has(id)) score += 20;\n      if (preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()))) score += 14;\n      if (Number(p?.salePrice || p?.price || 0) > 0) score += 6;\n      return { p, score };\n    });\n    return scored.sort((a, b) => b.score - a.score).slice(0, 10).map((entry) => entry.p);\n  }, [products, likedProductIds, viewedProductIds, preferredCategories]);\n\n  const contextualSuggestions = useMemo(() => {\n    if (rankedQueryProducts.length === 0) return [];\n    const categoryMap = new Map();\n    rankedQueryProducts.forEach((p) => {\n      const category = String(p?.category || '').split('>').pop()?.trim();\n      if (!category) return;\n      categoryMap.set(category, (categoryMap.get(category) || 0) + 1);\n    });\n    return [...categoryMap.entries()]\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3)\n      .map(([category]) => `${category} akci`);\n  }, [rankedQueryProducts]);\n\n  const actualResultCount = useMemo(() => {\n    if (trimmedQuery.length < 2) return null;\n    if (smartTotalMatches > 0) return smartTotalMatches;\n    return rankedQueryProducts.length;\n  }, [trimmedQuery, smartTotalMatches, rankedQueryProducts.length]);\n\n  const confidenceScore = useMemo(() => {\n    if (actualResultCount === null) return 0;\n    return Math.max(0, Math.min(100, Math.round((Math.min(actualResultCount, 24) / 24) * 100)));\n  }, [actualResultCount]);\n\n  const confidenceMeta = useMemo(() => {\n    if (actualResultCount === null) return { label: 'Kezdj el gpelni', tone: 'bg-gray-300' };\n    if (actualResultCount >= 18) return { label: `${actualResultCount} ers tallat`, tone: 'bg-emerald-500' };\n    if (actualResultCount >= 8) return { label: `${actualResultCount} relevns tallat`, tone: 'bg-amber-500' };\n    if (actualResultCount >= 1) return { label: `${actualResultCount} tallat`, tone: 'bg-orange-500' };\n    return { label: 'Nincs tallat', tone: 'bg-rose-500' };\n  }, [actualResultCount]);\n\n  const effectiveBroadenSuggestions = useMemo(() => {\n    if (actualResultCount == null || actualResultCount >= 5 || actualResultCount === 0) return [];\n    return broadenSuggestions.length > 0 ? broadenSuggestions : getBroadenSuggestions(trimmedQuery, actualResultCount);\n  }, [actualResultCount, broadenSuggestions, trimmedQuery]);\n\n  const dynamicQuickSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [...PROACTIVE_QUICK, ...QUICK_INTENTS].slice(0, 6);\n    const base = [];\n    const firstToken = queryTokens[0];\n    if (firstToken) {\n      base.push(`${firstToken} akcis`);\n      base.push(`modern ${firstToken}`);\n      base.push(`${firstToken} gyors szlltssal`);\n      base.push(`${firstToken} 120e alatt`);\n    }\n    if (Array.isArray(intent?.styles) && intent.styles[0]) {\n      base.push(`${intent.styles[0]} stlus btor`);\n    }\n    if (Array.isArray(intent?.colors) && intent.colors[0]) {\n      base.push(`${intent.colors[0]} nappali`);\n    }\n    const unique = [];\n    const seen = new Set();\n    [...base, ...contextualSuggestions, ...PROACTIVE_QUICK, ...QUICK_INTENTS].forEach((q) => {\n      const key = q.toLowerCase();\n      if (!seen.has(key) && q.trim().length >= 3) {\n        seen.add(key);\n        unique.push(q.trim());\n      }\n    });\n    return unique.slice(0, 6);\n  }, [trimmedQuery, queryTokens, intent, activeFilters.length, contextualSuggestions]);\n\n  const quickHitSuggestions = useMemo(() => {\n    return dynamicQuickSuggestions.slice(0, 8).map((text) => {\n      const t = text.toLowerCase();\n      let badge = { label: 'Kapcsold', classes: 'bg-gray-100 text-gray-700 border-gray-200' };\n      if (trimmedQuery.length >= 2 && t.includes(trimmedQuery.toLowerCase())) {\n        badge = { label: 'Pontos egyezs', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      } else if (Array.isArray(intent?.styles) && intent.styles.some((s) => t.includes(String(s).toLowerCase()))) {\n        badge = { label: 'Stlus egyezs', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n      } else if (Array.isArray(intent?.colors) && intent.colors.some((c) => t.includes(String(c).toLowerCase()))) {\n        badge = { label: 'Szn egyezs', classes: 'bg-sky-50 text-sky-700 border-sky-200' };\n      } else if (t.includes('alatt') || t.includes('akci')) {\n        badge = { label: 'r / akci', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      }\n      return { text, badge };\n    });\n  }, [dynamicQuickSuggestions, trimmedQuery, intent]);\n\n  const rewriteSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [];\n    const first = queryTokens[0] || 'btor';\n    const topCategories = rankedQueryProducts\n      .map((p) => String(p?.category || '').split('>').pop()?.trim())\n      .filter(Boolean)\n      .slice(0, 3);\n    const mainCategory = topCategories[0] || first;\n    const topStyle = Array.isArray(intent?.styles) && intent.styles[0] ? intent.styles[0] : 'modern';\n    const topColor = Array.isArray(intent?.colors) && intent.colors[0] ? intent.colors[0] : 'bzs';\n\n    return [\n      `${mainCategory} ${topStyle} stlusban`,\n      `${topColor} ${mainCategory} 120e alatt`,\n      `${mainCategory} prmium kivitelben gyors szlltssal`,\n      `${mainCategory} kisebb trbe, keskeny kivitel`\n    ];\n  }, [trimmedQuery, queryTokens, rankedQueryProducts, intent]);\n\n  const rewriteSuggestionsWithQuality = useMemo(() => {\n    if (!showRewriteOptions || !Array.isArray(products) || products.length === 0) return [];\n    return rewriteSuggestions.map((text) => {\n      const result = smartSearch(products, text, { limit: 12 });\n      const count = Number(result?.totalMatches || 0);\n      let quality = { label: 'Kzepes', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      if (count >= 16) quality = { label: 'Ers', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      else if (count <= 3) quality = { label: 'Szk', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n      return { text, count, quality };\n    });\n  }, [showRewriteOptions, rewriteSuggestions, products]);\n\n  const intentTimeline = useMemo(() => {\n    if (!intent || trimmedQuery.length < 2) return [];\n    const timeline = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      timeline.push({ title: 'Termktpus felismerve', value: intent.productTypes[0], tone: 'bg-primary-50 border-primary-200 text-primary-700' });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      timeline.push({ title: 'Stlus felismerve', value: intent.styles[0], tone: 'bg-secondary-50 border-secondary-200 text-secondary-700' });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      timeline.push({ title: 'Szn preferencia', value: intent.colors[0], tone: 'bg-sky-50 border-sky-200 text-sky-700' });\n    }\n    if (intent.priceRange?.max || intent.priceRange?.min) {\n      const priceText = intent.priceRange?.max\n        ? `${Math.round((intent.priceRange.max || 0) / 1000)}k alatt`\n        : `${Math.round((intent.priceRange.min || 0) / 1000)}k felett`;\n      timeline.push({ title: 'rhatr', value: priceText, tone: 'bg-amber-50 border-amber-200 text-amber-700' });\n    }\n    timeline.push({ title: 'Tallati magabiztossg', value: `${actualResultCount ?? 0} tallat`, tone: 'bg-emerald-50 border-emerald-200 text-emerald-700' });\n    return timeline.slice(0, 5);\n  }, [intent, trimmedQuery, actualResultCount]);\n\n  const hasNoResults = trimmedQuery.length >= 2 && suggestions.length === 0;\n  const rescueSuggestions = useMemo(() => {\n    if (!hasNoResults) return [];\n    const q = trimmedQuery.toLowerCase();\n    const base = [];\n    if (q.includes('alatt')) base.push(q.replace(/(\\d+\\s*(e|ez|ezer|k).*)/i, '').trim());\n    if (q.includes('olcs')) base.push(q.replace('olcs', ''));\n    base.push(`${trimmedQuery} akci`);\n    base.push(`${trimmedQuery} modern`);\n    return base.map((v) => v.trim()).filter((v) => v.length >= 3).slice(0, 3);\n  }, [hasNoResults, trimmedQuery]);\n\n  const triggerFullSearch = (inputQuery, source = 'submit') => {\n    const safeQuery = String(inputQuery || '').trim();\n    if (!safeQuery) return;\n    onSearch?.(safeQuery, { source });\n    setIsOpen(false);\n  };\n\n  const handleSubmit = (e) => {\n    e?.preventDefault?.();\n    if (!trimmedQuery) return;\n    setIsSearching(true);\n    setDidSearch(true);\n    trackSearch(trimmedQuery);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'submit');\n    setSearchPulse(true);\n    instantSearchRef.current = trimmedQuery;\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: trimmedQuery, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== trimmedQuery.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    triggerFullSearch(trimmedQuery, 'submit');\n    setTimeout(() => {\n      setIsSearching(false);\n      setIsOpen(false);\n    }, 350);\n  };\n\n  const applySuggestion = (text, opts = {}) => {\n    if (!text) return;\n    const { submit = true, source = 'suggestion' } = opts;\n    setQuery(text);\n    setDidSearch(true);\n    trackSearch(text);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'suggestion');\n    setSearchPulse(true);\n    instantSearchRef.current = text.trim();\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: text, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== text.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    if (submit) {\n      triggerFullSearch(text, source);\n      return;\n    }\n    setIsOpen(true);\n  };\n\n  const handlePreviewProductClick = (product, position = 0) => {\n    const name = product?.name || '';\n    if (!name || !product) return;\n    if (trimmedQuery && product?.id) {\n      trackSearchClick(trimmedQuery, product.id, position);\n    }\n    trackSectionEvent(`hero-search-${variant}`, 'click', String(product?.id || 'preview-product'));\n    onOpenProductQuickView?.(product);\n  };\n\n  const removeFilter = (filter) => {\n    if (!filter?.id) return;\n    setDismissedFilterIds((prev) => (prev.includes(filter.id) ? prev : [...prev, filter.id]));\n    if (!filter.rawValue) return;\n    const raw = filter.rawValue.trim();\n    if (!raw) return;\n    setQuery((prev) => prev.replace(new RegExp(escapeRegExp(raw), 'ig'), '').replace(/\\s{2,}/g, ' ').trim());\n  };\n\n  const clearAllFilters = () => {\n    setDismissedFilterIds(parsedFilters.map((f) => f.id));\n  };\n\n  const removeFromHistory = (queryToRemove) => {\n    const key = String(queryToRemove || '').toLowerCase();\n    if (!key) return;\n    setSearchJourney((prev) => {\n      const next = prev\n        .map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x))\n        .filter((x) => (x.q || x).toLowerCase() !== key);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n  };\n\n  const toggleCompareProduct = (product) => {\n    if (!product?.id) return;\n    setCompareProducts((prev) => {\n      const exists = prev.some((p) => String(p.id) === String(product.id));\n      if (exists) return prev.filter((p) => String(p.id) !== String(product.id));\n      const next = [...prev, product].slice(-3);\n      return next;\n    });\n    trackSectionEvent(`hero-search-${variant}`, 'click', `compare-${product.id}`);\n  };\n\n  const runCompareSearch = () => {\n    if (compareProducts.length < 2) return;\n    const composed = compareProducts.map((p) => p?.name).filter(Boolean).join(' vs ');\n    applySuggestion(composed);\n  };\n\n  const applyRewrite = (text) => {\n    if (!text) return;\n    setQuery(text);\n    setShowRewriteOptions(false);\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'rewrite');\n  };\n\n  const applyQuickFilterToken = (token) => {\n    if (!token) return;\n    const normalized = String(token).trim();\n    if (!normalized) return;\n    setQuery((prev) => {\n      const base = prev.trim();\n      if (!base) return normalized;\n      if (base.toLowerCase().includes(normalized.toLowerCase())) return base;\n      return `${base} ${normalized}`.trim();\n    });\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', `quick-filter-${normalized}`);\n  };\n\n  const formatPrice = (value) => {\n    const amount = Number(value || 0);\n    return amount > 0 ? formatPriceHu(value) : 'r hamarosan';\n  };\n\n  const getProductImage = (product) => {\n    if (!product) return '';\n    return product.image || product.images?.[0] || product.thumbnail || '';\n  };\n\n  const isPersonalMatch = (product) => {\n    const category = String(product?.category || '').toLowerCase();\n    const id = String(product?.id || '');\n    if (likedProductIds.includes(id)) return true;\n    return preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()));\n  };\n\n  const getTopBadge = (product, index) => {\n    if (likedProductIds.includes(String(product?.id || ''))) {\n      return { text: 'Kedvenc tallat', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n    }\n    if (isPersonalMatch(product)) {\n      return { text: 'Neked ajnlott', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n    }\n    if (index === 0) return { text: 'Top #1', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n    if (index === 1) return { text: 'Top #2', classes: 'bg-blue-50 text-blue-700 border-blue-200' };\n    if (index === 2) return { text: 'Top #3', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n    return { text: 'Ajnlott', classes: 'bg-gray-50 text-gray-700 border-gray-200' };\n  };\n\n  const handleCardMouseMove = (event, productId) => {\n    const rect = event.currentTarget.getBoundingClientRect();\n    const px = (event.clientX - rect.left) / rect.width;\n    const py = (event.clientY - rect.top) / rect.height;\n    const rx = (0.5 - py) * 6;\n    const ry = (px - 0.5) * 8;\n    setHoverCard({ id: String(productId), rx, ry });\n  };\n\n  const displayedTopProducts = trimmedQuery.length < 2 ? starterProducts : previewProducts;\n\n  const historyGrouped = useMemo(() => {\n    const list = searchJourney.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n    if (list.length === 0) return { today: [], earlier: [] };\n    const startOfToday = new Date();\n    startOfToday.setHours(0, 0, 0, 0);\n    const startTs = startOfToday.getTime();\n    const today = list.filter((x) => (x.t || 0) >= startTs);\n    const earlier = list.filter((x) => (x.t || 0) < startTs);\n    return { today, earlier };\n  }, [searchJourney]);\n\n  useEffect(() => {\n    setDismissedFilterIds([]);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      setIsSearching(false);\n      return undefined;\n    }\n\n    const timer = setTimeout(() => {\n      if (instantSearchRef.current === trimmedQuery) {\n        setIsSearching(false);\n        return;\n      }\n      instantSearchRef.current = trimmedQuery;\n      setDidSearch(true);\n      setIsSearching(true);\n      trackSectionEvent(`hero-search-${variant}`, 'click', 'instant');\n      setTimeout(() => setIsSearching(false), 180);\n    }, 220);\n\n    return () => clearTimeout(timer);\n  }, [trimmedQuery, variant]);\n\n  useEffect(() => {\n    if (trimmedQuery.length >= 1) {\n      setIsOpen(true);\n    }\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      setPreviewProduct(null);\n      setPreviewAnchor(null);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!searchPulse) return undefined;\n    const timer = setTimeout(() => setSearchPulse(false), 650);\n    return () => clearTimeout(timer);\n  }, [searchPulse]);\n\n  useEffect(() => {\n    try {\n      const liked = getLikedProducts().map((id) => String(id));\n      const viewed = getViewedProducts(30);\n      const viewedIds = viewed.map((item) => String(item?.id)).filter(Boolean);\n      const categoryCounter = new Map();\n      const keywordCounter = new Map();\n\n      viewed.forEach((item) => {\n        const category = String(item?.category || '').split('>').pop()?.trim();\n        if (category) {\n          categoryCounter.set(category, (categoryCounter.get(category) || 0) + 1);\n        }\n        String(item?.name || '')\n          .toLowerCase()\n          .split(/[\\s,/-]+/)\n          .map((token) => token.trim())\n          .filter((token) => token.length >= 4)\n          .forEach((token) => keywordCounter.set(token, (keywordCounter.get(token) || 0) + 1));\n      });\n\n      const topCategories = [...categoryCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 4)\n        .map(([name]) => name);\n      const topKeywords = [...keywordCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 6)\n        .map(([name]) => name);\n\n      setLikedProductIds(liked);\n      setViewedProductIds(viewedIds);\n      setPreferredCategories(topCategories);\n      setPreferredKeywords(topKeywords);\n    } catch {\n      setLikedProductIds([]);\n      setViewedProductIds([]);\n      setPreferredCategories([]);\n      setPreferredKeywords([]);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      const stored = JSON.parse(localStorage.getItem(SUCCESSFUL_SEARCHES_KEY) || '[]');\n      const history = getSearchHistory(6).map((entry) => entry?.query).filter(Boolean);\n      const storedNorm = Array.isArray(stored)\n        ? stored.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : { q: x.q || x, t: x.t || 0 }))\n        : [];\n      const merged = [...storedNorm];\n      history.forEach((q) => {\n        const key = String(q).toLowerCase();\n        if (!merged.some((x) => (x.q || x).toLowerCase() === key)) merged.push({ q, t: 0 });\n      });\n      const unique = [];\n      const seen = new Set();\n      merged.forEach((item) => {\n        const q = item.q || item;\n        const key = String(q).toLowerCase();\n        if (!seen.has(key)) {\n          seen.add(key);\n          unique.push(typeof item === 'object' && item && 'q' in item ? item : { q, t: 0 });\n        }\n      });\n      setSearchJourney(unique.slice(0, 6));\n    } catch {\n      setSearchJourney([]);\n    }\n  }, []);\n\n  return (\n    <section\n      className=\"mb-8 sm:mb-12 min-w-0 w-full max-w-full\"\n      style={{ touchAction: 'pan-y' }}\n      aria-label=\"AI Keres\"\n    >\n      <div className=\"relative w-full max-w-none mx-auto animate-fade-in\">\n        <div className=\"pointer-events-none absolute inset-x-0 -top-16 h-44 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.18),transparent_65%)] blur-2xl\" aria-hidden />\n        <div className=\"pointer-events-none absolute inset-x-0 -bottom-24 h-60 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.14),transparent_70%)] blur-3xl\" aria-hidden />\n\n        <div className=\"relative rounded-xl sm:rounded-2xl overflow-hidden bg-white border border-gray-200 shadow-lg animate-scale-in\">\n          {/* ExitIntentPopup-style header bar with gradient + blobs */}\n          <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-5 sm:p-6 lg:p-7 text-center relative overflow-hidden\">\n            <div className=\"absolute inset-0 overflow-hidden pointer-events-none\" aria-hidden>\n              <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob motion-reduce:animate-none\" />\n              <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n            </div>\n            <div className=\"relative flex items-center justify-center sm:justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-14 h-14 sm:w-16 sm:h-16 bg-white/25 rounded-full flex items-center justify-center shrink-0 shadow-lg\">\n                  <Sparkles className=\"w-7 h-7 sm:w-8 sm:h-8 text-white\" aria-hidden />\n                </div>\n                <div className=\"text-left\">\n                  <h2 className=\"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-sm\">\n                    AI Keres\n                  </h2>\n                  <p className=\"text-white text-sm sm:text-base font-semibold mt-0.5\">\n                    rj termszetesen, tallj gyorsan\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"relative z-10 px-4 py-4 sm:p-6 lg:px-8 lg:py-7 bg-white\">\n            <div className=\"mb-4 flex flex-wrap items-center justify-between gap-2\">\n              <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.16em] text-primary-700 shadow-sm\">\n                <Sparkles className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                Next Search Stage\n              </span>\n              <span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-[11px] font-bold uppercase tracking-[0.13em] ${isIndexBuilding ? 'border-amber-200 bg-amber-50 text-amber-800' : 'border-emerald-200 bg-emerald-50 text-emerald-800'}`}>\n                <span className={`h-1.5 w-1.5 rounded-full ${isIndexBuilding ? 'bg-amber-300 animate-pulse' : 'bg-emerald-300'}`} aria-hidden />\n                {isIndexBuilding ? 'Rendszer tanul' : 'Rendszer ksz'}\n              </span>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className={`relative rounded-[22px] sm:rounded-[28px] border-2 border-primary-200 bg-gradient-to-r from-primary-50/50 to-secondary-50/50 p-3 sm:p-4 shadow-sm transition-all duration-200 focus-within:ring-4 focus-within:ring-primary-200 focus-within:border-primary-300 ${searchPulse ? 'ring-4 ring-emerald-300/50' : ''}`}>\n                <div className=\"pointer-events-none absolute inset-x-6 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300/50 to-transparent\" aria-hidden />\n                <div className=\"flex flex-col gap-3 lg:flex-row lg:items-center\">\n                  <div className=\"flex min-w-0 flex-1 items-center gap-3 sm:gap-4\">\n                    <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-700 text-white shadow-md sm:h-12 sm:w-12\">\n                      <Search className=\"h-5 w-5 sm:h-6 sm:w-6\" aria-hidden />\n                    </div>\n                    <div className=\"min-w-0 flex-1\">\n                      <input\n                        type=\"search\"\n                        value={query}\n                        onChange={(e) => setQuery(e.target.value)}\n                        onFocus={() => setIsOpen(true)}\n                        placeholder=\"Mit keresel? pl. bzs kanap 100e alatt, skandinv komd...\"\n                        className=\"w-full min-h-[50px] bg-transparent text-lg font-semibold tracking-[-0.01em] text-gray-900 outline-none placeholder:text-gray-500 sm:min-h-[58px] sm:text-[1.34rem] lg:min-h-[48px] lg:text-[1.15rem] xl:text-[1.28rem]\"\n                        aria-label=\"Keress a teljes katalgusban\"\n                        autoComplete=\"off\"\n                      />\n                      <p className=\"mt-1 text-xs text-gray-600 sm:text-sm\">\n                        rj termszetesen: termk + stlus + helyisg + rkeret\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2 sm:gap-3\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowQuickFilterPanel((prev) => !prev)}\n                      className={`min-h-[48px] rounded-xl border px-4 text-sm font-semibold transition-all touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5 ${showQuickFilterPanel ? 'border-primary-400 bg-primary-100 text-primary-800' : 'border-gray-300 bg-white text-gray-700 hover:border-primary-300 hover:bg-primary-50'}`}\n                      title=\"Gyors szrk\"\n                      aria-expanded={showQuickFilterPanel}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Filter className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Szrk</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"min-h-[48px] rounded-xl border border-secondary-200 bg-secondary-50 px-4 text-sm font-semibold text-secondary-800 transition-all hover:bg-secondary-100 touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5\"\n                      title=\"Kpbl keress\"\n                      aria-label=\"Kpbl keress\"\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Camera className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Kpbl</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"submit\"\n                      className=\"min-h-[48px] flex-1 rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 px-5 text-base font-bold text-white shadow-[0_10px_26px_rgba(255,138,0,0.38)] transition-all hover:-translate-y-0.5 hover:shadow-[0_14px_34px_rgba(255,138,0,0.48)] active:scale-[0.98] touch-manipulation sm:min-h-[54px] sm:flex-none sm:rounded-full sm:px-7\"\n                      aria-busy={isSearching}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        {isSearching ? (\n                          <span className=\"h-5 w-5 shrink-0 animate-spin rounded-full border-2 border-white/80 border-t-transparent\" aria-hidden />\n                        ) : (\n                          <ArrowRight className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        )}\n                        <span>{isSearching ? 'Keres...' : 'Keress'}</span>\n                      </span>\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                      <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-xs font-semibold text-primary-700 shadow-sm\">\n                    <Wand2 className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                    AI md\n                  </span>\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-xs font-semibold text-secondary-700\">\n                    <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                    Smart intent parsing\n                  </span>\n                </div>\n                {actualResultCount != null && trimmedQuery.length >= 2 && (\n                  <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1 text-sm font-bold text-primary-800 tabular-nums shadow-sm\">\n                    <span className=\"h-2 w-2 rounded-full bg-primary-500\" aria-hidden />\n                    {actualResultCount} tallat\n                  </span>\n                )}\n              </div>\n\n              <div className=\"pt-1\">\n                <p className=\"mb-2 text-[11px] font-extrabold uppercase tracking-[0.14em] text-gray-500\">Gyors parancsok</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-1 [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {dynamicQuickSuggestions.slice(0, 6).map((text) => (\n                    <button\n                      key={`hero-chip-${text}`}\n                      type=\"button\"\n                      onClick={() => applySuggestion(text, { submit: true, source: 'hero-chip' })}\n                      className=\"whitespace-nowrap inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-800 shadow-sm transition-all hover:-translate-y-0.5 hover:border-primary-300 hover:bg-primary-50 hover:text-primary-700 sm:text-sm\"\n                    >\n                      <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                      {text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2 border-t border-gray-200 pt-3\">\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-gray-600\">\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Enter</kbd>\n                  Keress\n                  <span className=\"text-gray-400\"></span>\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Esc</kbd>\n                  Bezrs\n                </div>\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-secondary-200 bg-secondary-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-secondary-700\">\n                  <Sparkles className=\"h-3.5 w-3.5 text-secondary-200\" aria-hidden />\n                  {actualResultCount != null && trimmedQuery.length >= 2 ? `${confidenceMeta.label}` : 'Adaptv AI ajnls'}\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n\n        {/* Tartalom  szrk, tallatok, stb. */}\n        <div className=\"relative z-10 mt-4 sm:mt-5 min-w-0 max-w-full\">\n          <div className=\"space-y-4 sm:space-y-5 lg:grid lg:grid-cols-12 lg:gap-4 lg:space-y-0\">\n          {showQuickFilterPanel && (\n            <div className=\"mt-3 lg:mt-0 rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-4 relative overflow-hidden w-full lg:col-span-6 shadow-sm animate-fade-in-up\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-primary-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-3\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Filter className=\"w-5 h-5\" aria-hidden /></span>\n                Gyors szrk\n              </p>\n              <div className=\"space-y-3\">\n                {Object.entries(QUICK_FILTER_PRESETS).map(([group, values]) => (\n                  <div key={group} className=\"flex flex-wrap items-center gap-2\">\n                    <span className=\"text-xs font-bold uppercase tracking-wide text-gray-600 min-w-14\">\n                      {group}\n                    </span>\n                    {values.map((value) => (\n                      <button\n                        key={`${group}-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-300 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                ))}\n                {preferredCategories.length > 0 && (\n                  <div className=\"flex flex-wrap items-center gap-2 pt-1\">\n                    <span className=\"text-xs font-semibold uppercase tracking-wide text-gray-600 min-w-14\">\n                      Neked\n                    </span>\n                    {preferredCategories.slice(0, 3).map((value) => (\n                      <button\n                        key={`fav-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-medium hover:bg-secondary-100 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {!isOpen && (\n          <>\n          {/* Pontossg  trust card */}\n          <div className=\"rounded-xl border border-emerald-200 bg-gradient-to-r from-emerald-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\" role=\"status\" aria-live=\"polite\">\n            <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-emerald-400 via-secondary-500 to-primary-500\" aria-hidden />\n            <div className=\"flex items-center justify-between gap-2 mb-2\">\n              <span className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-emerald-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Award className=\"w-5 h-5\" aria-hidden /></span>\n                Tallatok\n              </span>\n              <span className={`text-base font-bold text-emerald-800 tabular-nums transition-transform duration-300 ${resultCountPulse ? 'scale-110' : 'scale-100'}`}>{actualResultCount ?? 0}</span>\n            </div>\n            <div className=\"h-2 rounded-full bg-gray-200 overflow-hidden\">\n              <div className={`h-full rounded-full transition-all duration-300 ${confidenceMeta.tone}`} style={{ width: `${confidenceScore}%` }} />\n            </div>\n            {actualResultCount != null && (\n              <p className=\"mt-1.5 text-xs text-emerald-700\">{confidenceMeta.label}</p>\n            )}\n          </div>\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 lg:col-span-6\">\n              <button\n                type=\"button\"\n                onClick={() => triggerFullSearch(trimmedQuery, 'submit')}\n                className=\"w-full min-h-[48px] rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 text-white font-bold text-base shadow-[0_8px_22px_rgba(255,138,0,0.35)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.45)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 touch-manipulation\"\n              >\n                sszes tallat megnyitsa ({actualResultCount ?? 0})\n              </button>\n              {effectiveBroadenSuggestions.length > 0 && (\n                <div className=\"mt-3 flex flex-wrap gap-2\">\n                  <span className=\"text-xs text-gray-500 w-full\">Kevs tallat  prbld:</span>\n                  {effectiveBroadenSuggestions.map((sug) => (\n                    <button\n                      key={sug}\n                      type=\"button\"\n                      onClick={() => applySuggestion(sug)}\n                      className=\"px-3 py-1.5 rounded-lg bg-amber-50 border border-amber-200 text-amber-800 text-sm font-medium hover:bg-amber-100 transition-colors\"\n                    >\n                      {sug}\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {activeFilters.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap gap-2 rounded-xl border border-sky-200 bg-gradient-to-r from-sky-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-sky-400 via-blue-500 to-secondary-500\" aria-hidden />\n              <span className=\"w-full flex items-center gap-2.5 mb-2 text-sm font-bold text-gray-800\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-sky-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><SlidersHorizontal className=\"w-5 h-5\" aria-hidden /></span>\n                Aktv szrk\n              </span>\n              {activeFilters.map((f) => (\n                <button\n                  key={f.id}\n                  type=\"button\"\n                  onClick={() => removeFilter(f)}\n                  className=\"inline-flex items-center gap-1.5 px-3 py-2 rounded-lg bg-white border border-sky-200 text-sky-800 text-sm font-medium hover:bg-sky-50 transition-colors touch-manipulation min-h-[40px]\"\n                >\n                  {f.label}: {f.value}\n                  <X className=\"w-3 h-3\" aria-hidden />\n                </button>\n              ))}\n              <button\n                type=\"button\"\n                onClick={clearAllFilters}\n                className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-700 text-sm font-medium hover:bg-gray-50 touch-manipulation min-h-[40px]\"\n              >\n                Szrk trlse\n              </button>\n            </div>\n          )}\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap items-center gap-2 rounded-xl border border-secondary-200 bg-gradient-to-r from-secondary-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-secondary-400 via-teal-500 to-primary-500\" aria-hidden />\n              <button\n                type=\"button\"\n                onClick={() => setShowRewriteOptions((prev) => !prev)}\n                className=\"inline-flex items-center gap-2.5 px-3 py-2 rounded-lg bg-white text-secondary-800 text-sm font-bold border border-secondary-200 hover:bg-secondary-50 transition-colors touch-manipulation min-h-[40px] shadow-sm\"\n              >\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-secondary-500 to-secondary-600 text-white flex items-center justify-center shrink-0 shadow-sm\"><BrainCircuit className=\"w-5 h-5\" aria-hidden /></span>\n                AI tfogalmazs\n              </button>\n              {showRewriteOptions && rewriteSuggestionsWithQuality.slice(0, 3).map((item) => (\n                <button\n                  key={item.text}\n                  type=\"button\"\n                  onClick={() => applyRewrite(item.text)}\n                  className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-white text-secondary-800 text-sm hover:bg-secondary-50 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                >\n                  <span>{item.text}</span>\n                  <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.quality.classes}`}>\n                    {item.quality.label}  {item.count}\n                  </span>\n                </button>\n              ))}\n            </div>\n          )}\n\n          {intentTimeline.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-indigo-200 bg-gradient-to-r from-indigo-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Lightbulb className=\"w-5 h-5\" aria-hidden /></span>\n                AI rtelmezs\n              </p>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                {intentTimeline.map((step, idx) => (\n                  <div key={`${step.title}-${idx}`} className=\"rounded-lg border px-3 py-2 bg-white border-indigo-200\">\n                    <p className=\"text-xs font-semibold uppercase tracking-wide opacity-90 text-indigo-600\">{step.title}</p>\n                    <p className=\"text-sm font-semibold mt-0.5 text-gray-900\">{step.value}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-gray-200 bg-gradient-to-r from-gray-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-12\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-gray-300 via-gray-400 to-primary-400\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><RotateCcw className=\"w-5 h-5\" aria-hidden /></span>\n                Elzmnyek\n              </p>\n              {historyGrouped.today.length > 0 && (\n                <div className=\"mb-2\">\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Ma</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.today.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`today-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              {historyGrouped.earlier.length > 0 && (\n                <div>\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Korbbi</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.earlier.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`earlier-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n        {didSearch && !isOpen && (\n          <div className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-50 text-emerald-800 text-sm font-semibold border border-emerald-200/80 lg:col-span-12\">\n            <CheckCircle2 className=\"w-4 h-4 text-emerald-600\" aria-hidden />\n            Keress elindtva\n          </div>\n        )}\n          </>\n        )}\n\n        {isOpen && (\n          <div\n            className=\"mt-4 lg:mt-0 rounded-xl sm:rounded-2xl border border-primary-200 bg-white overflow-hidden max-h-[70vh] sm:max-h-[65vh] overflow-y-auto overflow-x-hidden shadow-lg max-w-full min-w-0 w-full lg:col-span-12 animate-fade-in-up\"\n            style={{ WebkitOverflowScrolling: 'touch', touchAction: 'pan-y' }}\n            onScroll={() => {\n              setPreviewProduct(null);\n              setPreviewAnchor(null);\n            }}\n          >\n            <div className=\"sticky top-0 z-10 bg-gradient-to-r from-primary-50 to-secondary-50 border-b border-gray-200 rounded-t-xl px-4 py-3 min-h-[52px]\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <p className=\"text-base font-bold text-gray-800 flex items-center gap-2.5\">\n                  <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><TrendingUp className=\"w-5 h-5\" aria-hidden /></span>\n                  Javaslatok s tallatok\n                </p>\n                <button\n                  type=\"button\"\n                  onClick={() => setIsOpen(false)}\n                  className=\"p-2.5 rounded-xl text-gray-500 hover:text-gray-800 hover:bg-gray-100 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center touch-manipulation\"\n                  aria-label=\"Kerespanel bezrsa\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"mt-2 flex flex-wrap items-center gap-2\">\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-[11px] font-semibold text-primary-700\">\n                  Live\n                </span>\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-[11px] font-semibold text-secondary-700\">\n                  {displayedTopProducts.length} top termk\n                </span>\n                {trimmedQuery.length >= 2 && actualResultCount != null && (\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700\">\n                    {actualResultCount} relevns\n                  </span>\n                )}\n              </div>\n            </div>\n\n            {displayedTopProducts.length > 0 && (\n              <div className=\"px-4 py-4 border-b border-gray-200 bg-gradient-to-b from-primary-50/50 to-secondary-50/50 w-full\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <p className=\"inline-flex items-center gap-2 text-base font-bold text-gray-800\">\n                    <TrendingUp className=\"w-5 h-5 text-primary-500\" aria-hidden />\n                    {trimmedQuery.length < 2 ? 'Ajnlott indulsnak' : 'Legjobb tallatok'}\n                  </p>\n                  <span className=\"text-sm text-gray-600 tabular-nums\">{displayedTopProducts.length} db</span>\n                </div>\n                <div className=\"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 snap-x snap-mandatory [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {displayedTopProducts.map((p, index) => {\n                    const badge = getTopBadge(p, index);\n                    return (\n                      <div\n                        key={p.id || p.name}\n                        data-product-id={p.id || p.name}\n                        role=\"button\"\n                        tabIndex={0}\n                        onClick={() => {\n                          if (previewProduct?.id === p.id || previewProduct?.name === p.name) {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                            return;\n                          }\n                          handlePreviewProductClick(p, index);\n                        }}\n                        onMouseMove={(e) => handleCardMouseMove(e, p.id || p.name)}\n                        onMouseLeave={() => setHoverCard({ id: null, rx: 0, ry: 0 })}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter' || e.key === ' ') {\n                            e.preventDefault();\n                            handlePreviewProductClick(p, index);\n                          }\n                        }}\n                        className=\"min-w-[140px] xs:min-w-[160px] sm:min-w-[200px] lg:min-w-[220px] snap-start text-left rounded-xl border border-gray-200 bg-white hover:border-primary-300 hover:shadow-lg transition-all p-3 touch-manipulation active:scale-[0.98]\"\n                        style={hoverCard.id === String(p.id || p.name)\n                          ? { transform: `perspective(900px) rotateX(${hoverCard.rx}deg) rotateY(${hoverCard.ry}deg) translateY(-2px)` }\n                          : undefined}\n                      >\n                        <div\n                          className=\"relative w-full h-24 sm:h-28 rounded-lg bg-gray-100 overflow-hidden mb-2 flex items-center justify-center\"\n                          onMouseEnter={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            setPreviewProduct(p);\n                            setPreviewAnchor(rect);\n                          }}\n                          onMouseLeave={() => {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                          }}\n                          onTouchStart={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            longPressTimerRef.current = setTimeout(() => {\n                              longPressTimerRef.current = null;\n                              setPreviewProduct(p);\n                              setPreviewAnchor(rect);\n                            }, LONG_PRESS_MS);\n                          }}\n                          onTouchEnd={() => {\n                            if (longPressTimerRef.current) {\n                              clearTimeout(longPressTimerRef.current);\n                              longPressTimerRef.current = null;\n                            }\n                          }}\n                        >\n                          {getProductImage(p) ? <img src={getProductImage(p)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" /> : <Package className=\"w-5 h-5 text-gray-400\" aria-hidden />}\n                        </div>\n                        <div className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-xs font-semibold ${badge.classes}`}>\n                          <Award className=\"w-3.5 h-3.5\" aria-hidden />\n                          {badge.text}\n                        </div>\n                        <p className=\"text-sm font-medium text-gray-800 line-clamp-2 mt-1.5 min-h-[2.2rem]\">{p.name}</p>\n                        <div className=\"mt-1.5 flex items-center justify-between\">\n                          <p className=\"text-base sm:text-lg text-primary-600 font-semibold\">{formatPrice(p.salePrice || p.price)}</p>\n                          <ChevronRight className=\"w-3.5 h-3.5 text-gray-400\" aria-hidden />\n                        </div>\n                        <div className=\"mt-2 flex items-center gap-1.5\">\n                          <button\n                            type=\"button\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              toggleCompareProduct(p);\n                            }}\n                            className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-[11px] border transition-colors ${compareProducts.some((cp) => String(cp.id) === String(p.id))\n                              ? 'border-primary-300 bg-primary-50 text-primary-700'\n                              : 'border-gray-200 bg-gray-50 text-gray-700 hover:bg-gray-100'\n                              }`}\n                          >\n                            <Plus className=\"w-3.5 h-3.5\" aria-hidden />\n                            sszevets\n                          </button>\n                          <span className=\"text-xs text-primary-600 font-medium\">QuickView</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {suggestions.length > 0 ? (\n              <div className=\"px-4 py-4 space-y-4 bg-gradient-to-b from-primary-50/30 to-secondary-50/30 w-full\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                  {suggestions.slice(0, 6).map((s, idx) => (\n                    <button\n                      key={idx}\n                      type=\"button\"\n                      onClick={() => applySuggestion(s.text || s.query || '', { submit: true, source: 'suggestion' })}\n                      className=\"text-left px-4 py-3 rounded-xl border border-secondary-200 bg-white hover:border-secondary-300 hover:bg-secondary-50 transition-colors min-h-[48px] touch-manipulation\"\n                    >\n                      <p className=\"text-base font-semibold text-gray-800 truncate\">{s.text || s.query}</p>\n                    </button>\n                  ))}\n                </div>\n                <div>\n                  <p className=\"text-sm font-bold text-gray-800 mb-2\">Gyorstallatok</p>\n                  <div className=\"flex flex-wrap gap-2 mb-2\">\n                    {quickHitSuggestions.slice(0, 6).map((item) => (\n                      <button\n                        key={`dyn-${item.text}`}\n                        type=\"button\"\n                        onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-semibold hover:bg-secondary-100 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                      >\n                        <span>{item.text}</span>\n                        <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                      </button>\n                    ))}\n                  </div>\n                  {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n                    <div className=\"flex flex-wrap gap-2\">\n                      {[...historyGrouped.today, ...historyGrouped.earlier].slice(0, 2).map((item) => {\n                        const q = item.q || item;\n                        return (\n                          <button\n                            key={`journey-inline-${q}`}\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'journey' })}\n                            className=\"px-2.5 py-1 rounded-full border border-gray-200 bg-white text-gray-700 text-[11px] hover:bg-gray-50 transition-colors\"\n                          >\n                            Gyors jrafuttats: {q}\n                          </button>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"px-3 sm:px-4 py-3 sm:py-4 space-y-3 w-full bg-gray-50\">\n                <div className=\"flex flex-wrap gap-2\">\n                  {quickHitSuggestions.map((item) => (\n                    <button\n                      key={item.text}\n                      type=\"button\"\n                      onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                      className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-200 transition-colors inline-flex items-center gap-1.5\"\n                    >\n                      <span>{item.text}</span>\n                      <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                    </button>\n                  ))}\n                </div>\n                {hasNoResults && rescueSuggestions.length > 0 && (\n                  <div className=\"rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-3\">\n                    <p className=\"text-base font-semibold text-gray-800 mb-2\">Nincs tallat. Prbld inkbb:</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {rescueSuggestions.map((q) => (\n                        <button\n                          key={q}\n                          type=\"button\"\n                          onClick={() => applySuggestion(q, { submit: true, source: 'rescue' })}\n                          className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-primary-800 text-sm font-semibold hover:bg-primary-50 transition-colors\"\n                        >\n                          {q}\n                        </button>\n                      ))}\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-secondary-600 text-white text-sm font-semibold hover:bg-secondary-700 transition-colors\"\n                    >\n                      <Camera className=\"w-4 h-4\" aria-hidden />\n                      Kpalap keress\n                    </button>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {compareProducts.length > 0 && (\n              <div className=\"sticky bottom-0 z-10 border-t border-secondary-300/35 bg-gradient-to-b from-slate-900/95 to-slate-950 px-4 py-3 rounded-b-xl backdrop-blur-sm\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                  <p className=\"text-base font-bold text-secondary-100\">sszevet tlca</p>\n                  {compareProducts.map((p) => (\n                    <span key={`cmp-${p.id}`} className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 text-slate-100 text-sm font-medium\">\n                      {p.name}\n                      <button\n                        type=\"button\"\n                        onClick={() => toggleCompareProduct(p)}\n                        className=\"p-1 rounded-lg hover:bg-slate-700 transition-colors\"\n                        aria-label=\"Termk eltvoltsa sszevetsbl\"\n                      >\n                        <X className=\"w-3.5 h-3.5\" aria-hidden />\n                      </button>\n                    </span>\n                  ))}\n                  <button\n                    type=\"button\"\n                    onClick={runCompareSearch}\n                    disabled={compareProducts.length < 2}\n                    className=\"ml-auto min-h-[44px] px-4 py-2 rounded-xl bg-gradient-to-r from-primary-500 to-secondary-600 text-white text-sm font-bold shadow-[0_8px_22px_rgba(255,138,0,0.4)] disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-[0_12px_28px_rgba(255,138,0,0.5)] active:scale-[0.98] transition-all\"\n                  >\n                    sszehasonlts\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Elnzet tooltip (hover / long-press) */}\n            {previewProduct && previewAnchor && (\n              <div\n                className=\"fixed z-[100] rounded-xl border border-primary-300/40 bg-slate-900/95 shadow-xl p-3 w-[200px] sm:w-[220px] pointer-events-none\"\n                style={{\n                  left: Math.max(8, Math.min(previewAnchor.left, typeof window !== 'undefined' ? window.innerWidth - 220 : previewAnchor.left)),\n                  top: previewAnchor.top - 8,\n                  transform: 'translateY(-100%)',\n                }}\n              >\n                <div className=\"h-24 rounded-lg bg-slate-800 overflow-hidden mb-2 flex items-center justify-center\">\n                  {getProductImage(previewProduct) ? (\n                    <img src={getProductImage(previewProduct)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                  ) : (\n                    <Package className=\"w-8 h-8 text-slate-500\" aria-hidden />\n                  )}\n                </div>\n                <p className=\"text-sm font-semibold text-slate-100 line-clamp-2\">{previewProduct.name}</p>\n                <p className=\"text-base sm:text-lg text-primary-600 font-semibold mt-1\">{formatPrice(previewProduct.salePrice || previewProduct.price)}</p>\n                <p className=\"text-xs text-slate-300 mt-0.5\">Kattints a rszletekhez</p>\n              </div>\n            )}\n          </div>\n        )}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n\n","/**\n * Kategria kpek  Unsplash stock photos, kategrihoz kapcsold\n * Shared between CategoryPage, ModernHero quick categories, stb.\n */\nexport const CATEGORY_IMAGES = {\n  Kanap: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Kanapk: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Fotel: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Fotelek: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Nappali: 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=600&q=80',\n  gy: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  gyak: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  Hlszoba: 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=600&q=80',\n  Matrac: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Matracok: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Asztal: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Asztalok: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Szk: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Szkek: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Iroda: 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=600&q=80',\n  Szekrny: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Szekrnyek: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Lmpa: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Lmpk: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Kert: 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=600&q=80',\n  Gyerek: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Gyerekszoba: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Komd: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Gardrb: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  tkez: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  default: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80'\n};\n\nexport const getCategoryImage = (name) => {\n  if (!name) return CATEGORY_IMAGES.default;\n  const n = String(name).toLowerCase();\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (key === 'default') continue;\n    if (n.includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Sparkles, Camera, ArrowRight,\n  Package, Users, Star, Zap, ChevronRight, ChevronLeft\n} from 'lucide-react';\nimport { CountUp } from '../ui/CountUp';\nimport HeroSmartSearch from './HeroSmartSearch';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { getCategoryImage } from '../../utils/categoryImages';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\n\nconst QUICK_CARD_COLORS = [\n  'from-amber-500 via-orange-500 to-primary-600',\n  'from-emerald-500 via-teal-500 to-secondary-600',\n  'from-violet-500 via-purple-500 to-fuchsia-600',\n  'from-rose-500 via-pink-500 to-red-500',\n  'from-sky-500 via-blue-500 to-indigo-600',\n  'from-lime-500 via-green-500 to-emerald-600',\n];\n\nconst QUICK_CATEGORY_LIMIT = 8;\nconst MIN_QUICK_CATEGORY_PRODUCTS = 20;\nconst CAROUSEL_SCROLL_DURATION = 700;\nconst CAROUSEL_AUTO_INTERVAL = 6000;\nconst CAROUSEL_AUTO_STEP_FRACTION = 0.65;\n\n/** Sima grgets ease-in-out easinggel */\nconst smoothScrollTo = (element, targetLeft, duration = CAROUSEL_SCROLL_DURATION) => {\n  if (!element) return;\n  const start = element.scrollLeft;\n  const dist = targetLeft - start;\n  const startTime = performance.now();\n  const easeInOutCubic = (t) => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);\n  const tick = (now) => {\n    const elapsed = Math.min((now - startTime) / duration, 1);\n    const eased = easeInOutCubic(elapsed);\n    element.scrollLeft = start + dist * eased;\n    if (elapsed < 1) requestAnimationFrame(tick);\n  };\n  requestAnimationFrame(tick);\n};\n\nconst HERO_REVEAL_DELAY = { badge: 0, line1: 100, line2: 220, line3: 340, sub: 460, cta: 600, stats: [720, 820, 920, 1020] };\n\n/**\n * Premium Hero  egyetlen zenet, ers vizul, lgzs\n */\nexport const ModernHero = ({\n  onExplore,\n  onTryAI,\n  quickCategories = [],\n  onQuickCategory,\n  products = [],\n  onHeroSearch,\n  onHeroQuickView,\n  serverSearchMode = false,\n  onFetchSearchPreview\n}) => {\n  const mounted = true;\n  const [heroVariant, setHeroVariant] = useState('A');\n\n  useEffect(() => {\n    try {\n      const storageKey = 'mkt_hero_ab_variant';\n      const existing = localStorage.getItem(storageKey);\n      if (existing === 'A' || existing === 'B') {\n        setHeroVariant(existing);\n        trackSectionEvent(`hero-variant-${existing}`, 'impression');\n        return;\n      }\n      const assigned = Math.random() < 0.5 ? 'A' : 'B';\n      localStorage.setItem(storageKey, assigned);\n      setHeroVariant(assigned);\n      trackSectionEvent(`hero-variant-${assigned}`, 'impression');\n    } catch {\n      setHeroVariant('A');\n      trackSectionEvent('hero-variant-A', 'impression');\n    }\n  }, []);\n\n  const heroCopy = heroVariant === 'B'\n    ? {\n      line1: 'Alaktsd t a teret,',\n      line2: 'mieltt egyetlen btort megvennl.',\n      sub: 'AI tvonalterv, azonnali vizualizci s valdi termkek egyetlen prmium lmnyben.',\n      ctaPrimary: 'Szemlyes AI terv indul',\n      ctaBadge: 'PRMIUM',\n      ctaSecondary: 'Inspirci bngszse'\n    }\n    : {\n      line1: 'Tervezz gy,',\n      line2: 'mintha ez lenne az lomotthonod.',\n      sub: 'Fot, AI-tervezs, vals ajnlatok. Egyetlen flow, ami 5 perc alatt eljuttat az ihlettl a rendelsig.',\n      ctaPrimary: 'Kezdjk AI-val',\n      ctaBadge: 'Most',\n      ctaSecondary: 'Kollekci megtekintse'\n    };\n\n  const stats = [\n    { icon: Package, value: 170, suffix: 'K+', label: 'Termk', decimals: 0 },\n    { icon: Users, value: 50, suffix: 'K+', label: 'Elgedett vsrl', decimals: 0 },\n    { icon: Star, value: 4.9, suffix: '/5', label: 'rtkels', decimals: 1 },\n    { icon: Zap, value: 24, suffix: '/7', label: 'AI tmogats', decimals: 0 }\n  ];\n  const statCardStyles = [\n    {\n      card: 'from-emerald-50 to-white border-emerald-200',\n      iconWrap: 'from-emerald-500 to-emerald-600',\n      edge: 'from-emerald-500 via-emerald-400 to-transparent'\n    },\n    {\n      card: 'from-blue-50 to-white border-blue-200',\n      iconWrap: 'from-blue-500 to-blue-600',\n      edge: 'from-blue-500 via-blue-400 to-transparent'\n    },\n    {\n      card: 'from-amber-50 to-white border-amber-200',\n      iconWrap: 'from-amber-500 to-orange-600',\n      edge: 'from-amber-500 via-amber-400 to-transparent'\n    },\n    {\n      card: 'from-secondary-50 to-white border-secondary-200',\n      iconWrap: 'from-secondary-600 to-secondary-700',\n      edge: 'from-secondary-600 via-secondary-500 to-transparent'\n    }\n  ];\n\n  const HERO_BG_IMAGE = 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=1920&q=85';\n\n  // Kiemelt kategrik  18 legfontosabb (termkszm szerint), ABC sorrendben megjelentve\n  const mains = Array.isArray(quickCategories) ? quickCategories : [];\n  const subcats = mains.flatMap((m) =>\n    (m?.children || []).map((c) => ({ ...c, parentName: m?.name }))\n  );\n  const allItems = [\n    ...mains.filter((m) => m?.name).map((m) => ({ name: m.name, productCount: m.productCount, parentName: null })),\n    ...subcats.filter((c) => c?.name)\n  ];\n  const byName = new Map();\n  for (const item of allItems) {\n    const count = Number(item?.productCount || 0);\n    if (count < MIN_QUICK_CATEGORY_PRODUCTS) continue;\n    const name = String(item.name).trim();\n    const existing = byName.get(name);\n    if (!existing || count > Number(existing.productCount || 0)) byName.set(name, { ...item, name });\n  }\n  const topByCount = [...byName.values()]\n    .sort((a, b) => Number(b?.productCount || 0) - Number(a?.productCount || 0))\n    .slice(0, QUICK_CATEGORY_LIMIT);\n  const quickCategoryItems = [...topByCount].sort((a, b) => String(a?.name || '').localeCompare(String(b?.name || ''), 'hu'));\n\n  const categoryCarouselRef = useRef(null);\n  const [categoryCarouselPaused, setCategoryCarouselPaused] = useState(false);\n\n  const getCategoryScrollStep = (container) => {\n    if (!container) return 191;\n    const first = container.firstElementChild;\n    if (!first) return 191;\n    const rect = first.getBoundingClientRect();\n    const gap = parseFloat(getComputedStyle(container).columnGap || '16');\n    return Math.max(130, rect.width + gap);\n  };\n\n  useEffect(() => {\n    if (!categoryCarouselPaused && quickCategoryItems.length > 0) {\n      const container = categoryCarouselRef.current;\n      if (!container) return undefined;\n      const id = setInterval(() => {\n        const step = getCategoryScrollStep(container) * CAROUSEL_AUTO_STEP_FRACTION;\n        const maxScroll = container.scrollWidth - container.clientWidth;\n        const next = container.scrollLeft + step;\n        if (maxScroll <= 0 || next >= maxScroll - 5) {\n          smoothScrollTo(container, 0);\n        } else {\n          smoothScrollTo(container, container.scrollLeft + step);\n        }\n      }, CAROUSEL_AUTO_INTERVAL);\n      return () => clearInterval(id);\n    }\n    return undefined;\n  }, [categoryCarouselPaused, quickCategoryItems.length]);\n\n  const scrollCategoryCarousel = (direction) => {\n    const container = categoryCarouselRef.current;\n    if (!container) return;\n    const step = getCategoryScrollStep(container) * 0.85;\n    const target = Math.max(0, Math.min(container.scrollWidth - container.clientWidth, container.scrollLeft + step * direction));\n    smoothScrollTo(container, target);\n  };\n\n  return (\n    <section\n      className=\"relative min-h-screen flex flex-col items-center justify-center overflow-x-clip overflow-y-auto bg-[#fcfcfb]\"\n      aria-label=\"Foldal  AI btorbolt\"\n    >\n      {/* Httrkp ~10% tltszsggal  ahogy volt */}\n      <div\n        className=\"absolute inset-0 bg-cover bg-center opacity-10 z-0\"\n        style={{ backgroundImage: `url(${HERO_BG_IMAGE})` }}\n        aria-hidden\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-b from-white/88 via-white/70 to-primary-50/88 z-[1]\" aria-hidden />\n      <div className=\"pointer-events-none absolute inset-0\" aria-hidden>\n        <div className=\"absolute left-1/2 top-[30%] h-[520px] w-[min(1100px,92vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.24),transparent_62%)] blur-2xl\" />\n        <div className=\"absolute left-1/2 top-[34%] h-[420px] w-[min(860px,84vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.16),transparent_70%)] blur-xl\" />\n      </div>\n      <div className=\"absolute inset-0 pointer-events-none\" aria-hidden=\"true\">\n        <div className=\"absolute inset-x-0 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300 to-transparent opacity-70\" />\n        <div className=\"absolute inset-x-0 bottom-0 h-[1px] bg-gradient-to-r from-transparent via-secondary-300 to-transparent opacity-60\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 pt-16 sm:pt-20 lg:pt-24 pb-2 sm:pb-3 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          <div\n            className={`inline-flex items-center gap-2.5 px-4 py-2 bg-white rounded-full border border-gray-200 shadow-sm mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.badge}ms` } : undefined}\n          >\n            <span className=\"flex h-2.5 w-2.5 rounded-full bg-primary-500\" aria-hidden />\n            <span className=\"text-xs sm:text-sm font-semibold text-gray-700 uppercase tracking-wide\">\n              Marketly AI rendszer\n            </span>\n          </div>\n\n          <h1 className=\"mb-6 sm:mb-7 lg:mb-8\">\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-[1.03] ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line1}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line1}\n            </span>\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold leading-[1.03] bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line2}\n            </span>\n          </h1>\n\n          <div\n            className={`mx-auto h-1.5 w-28 rounded-full bg-gradient-to-r from-primary-500 to-secondary-700 mb-2 sm:mb-3 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 40}ms` } : undefined}\n            aria-hidden\n          />\n        </div>\n      </div>\n\n      {/* Kiemelt kategrik  carousel: auto scroll, desktop nyilak */}\n      {quickCategoryItems.length > 0 && (\n        <div\n          className={`relative z-10 w-full mb-4 sm:mb-5 overflow-hidden ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n          style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 80}ms` } : undefined}\n        >\n          <h2 className=\"text-center text-lg sm:text-xl font-bold text-gray-800 mb-3 px-4\">\n            Kiemelt kategrik\n          </h2>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(-1)}\n            className=\"hidden lg:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Balra\"\n          >\n            <ChevronLeft className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(1)}\n            className=\"hidden lg:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Jobbra\"\n          >\n            <ChevronRight className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <div\n            ref={categoryCarouselRef}\n            onMouseEnter={() => setCategoryCarouselPaused(true)}\n            onMouseLeave={() => setCategoryCarouselPaused(false)}\n            onTouchStart={() => setCategoryCarouselPaused(true)}\n            onTouchEnd={() => setTimeout(() => setCategoryCarouselPaused(false), 3000)}\n            className=\"flex gap-3 sm:gap-4 overflow-x-auto scrollbar-hide pb-2 px-4 sm:px-6 lg:px-14 snap-x snap-mandatory scroll-smooth min-w-0\"\n          >\n            {quickCategoryItems.map((item, idx) => {\n              const name = item?.name;\n              const count = Number(item?.productCount || 0);\n              if (!name) return null;\n              const Icon = getCategoryIcon(name);\n              const productImg = (n) => Array.isArray(products) && products.length > 0\n                ? products.find((p) => (p?.category || '').toLowerCase().includes(String(n || '').toLowerCase()))?.images?.[0]\n                : null;\n              const img = productImg(name) || getCategoryImage(name);\n              const gradient = QUICK_CARD_COLORS[idx % QUICK_CARD_COLORS.length];\n              return (\n                <button\n                  key={`${item.parentName || ''}-${name}`}\n                  type=\"button\"\n                  onClick={() => onQuickCategory?.(name)}\n                  className=\"group relative shrink-0 w-[130px] sm:w-[150px] lg:w-[175px] aspect-[3/4] rounded-2xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-[1.02] snap-start focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 border-2 border-white/40\"\n                >\n                  <img\n                    src={img}\n                    alt=\"\"\n                    width={175}\n                    height={233}\n                    loading={idx < 4 ? 'eager' : 'lazy'}\n                    fetchPriority={idx < 2 ? 'high' : undefined}\n                    className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-105\"\n                    aria-hidden\n                  />\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent\" />\n                  <div className={`absolute inset-0 bg-gradient-to-br ${gradient} opacity-35`} aria-hidden />\n                  <div className=\"absolute inset-0 flex flex-col items-center justify-center p-3 sm:p-4 text-center\">\n                    <div className=\"w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-white/25 backdrop-blur-sm flex items-center justify-center mb-2 sm:mb-3 shadow-md group-hover:bg-white/40 group-hover:scale-105 transition-all duration-300 ease-out ring-2 ring-white/30\">\n                      <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-10 lg:h-10 text-white drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]\" strokeWidth={2.5} />\n                    </div>\n                    <span className=\"text-white font-bold text-xs sm:text-sm lg:text-base drop-shadow-lg line-clamp-2 leading-tight\">\n                      {name}\n                    </span>\n                    {count > 0 && (\n                      <span className=\"text-white/95 text-[10px] sm:text-xs mt-1 font-semibold\">\n                        {count.toLocaleString('hu-HU')} db\n                      </span>\n                    )}\n                    <ChevronRight className=\"absolute bottom-2 right-2 w-4 h-4 sm:w-5 sm:h-5 text-white/90 group-hover:translate-x-0.5 transition-transform duration-200 ease-out\" aria-hidden />\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          {/* Kzponti hero search  full width minus 2px */}\n          <div\n            className={`relative w-full min-w-0 max-w-full px-[1px] mb-6 sm:mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub - 60}ms` } : undefined}\n          >\n            <div className=\"pointer-events-none absolute inset-0 rounded-[32px] border border-white/70 bg-white/[0.04] backdrop-blur-[1px] shadow-[inset_0_1px_0_rgba(255,255,255,0.75)]\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-8 -top-10 h-24 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.22),transparent_65%)] blur-2xl\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-12 -bottom-12 h-28 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.18),transparent_70%)] blur-2xl\" aria-hidden />\n            <HeroSmartSearch\n              products={products}\n              onSearch={onHeroSearch}\n              onTryAI={onTryAI}\n              variant={heroVariant}\n              onOpenProductQuickView={onHeroQuickView}\n              serverSearchMode={serverSearchMode}\n              onFetchSearchPreview={onFetchSearchPreview}\n            />\n          </div>\n\n          <p\n            className={`text-sm sm:text-base text-gray-600/95 max-w-xl mx-auto mb-8 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub}ms`, lineHeight: '1.6' } : { lineHeight: '1.6' }}\n          >\n            {heroCopy.sub}\n          </p>\n\n          <div\n            className={`flex flex-col sm:flex-row gap-4 justify-center items-stretch sm:items-center mb-7 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 120}ms` } : undefined}\n          >\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-primary');\n                onTryAI?.();\n              }}\n              className=\"group relative w-full sm:w-auto min-h-[48px] px-8 py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white rounded-2xl font-semibold text-base shadow-[0_10px_26px_rgba(255,138,0,0.32)] hover:shadow-[0_14px_34px_rgba(255,138,0,0.42)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kezdj AI tervezssel\"\n            >\n              <span className=\"px-2.5 py-1 rounded-full bg-white/20 text-[11px] font-bold uppercase tracking-wide\">{heroCopy.ctaBadge}</span>\n              <Sparkles className=\"w-5 h-5\" aria-hidden />\n              {heroCopy.ctaPrimary}\n              <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-secondary');\n                onExplore?.();\n              }}\n              className=\"w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-gray-900 rounded-2xl font-semibold text-base border border-gray-200 shadow-sm hover:border-gray-300 hover:shadow-md hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kollekci bngszse\"\n            >\n              {heroCopy.ctaSecondary}\n              <ArrowRight className=\"w-5 h-5\" aria-hidden />\n            </button>\n          </div>\n\n          <div className={`flex flex-wrap items-center justify-center gap-x-5 gap-y-2 text-sm text-gray-600 mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 70}ms` } : undefined}>\n            <span className=\"inline-flex items-center gap-1.5\"><Star className=\"w-4 h-4 text-amber-500\" aria-hidden /> 4.9/5 vsrli rtkels</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Users className=\"w-4 h-4 text-primary-500\" aria-hidden /> 50K+ elgedett vsrl</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Zap className=\"w-4 h-4 text-secondary-700\" aria-hidden /> 24/7 AI tmogats</span>\n          </div>\n\n          <div className={`w-full max-w-6xl ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 180}ms` } : undefined}>\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n            {stats.map((stat, idx) => {\n              const style = statCardStyles[idx % statCardStyles.length];\n              return (\n              <div\n                key={idx}\n                    className={`group relative overflow-hidden bg-gradient-to-tr ${style.card} rounded-2xl p-4 border shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200`}\n              >\n                    <div className={`absolute left-0 bottom-0 w-[78%] h-[2px] bg-gradient-to-r ${style.edge}`} aria-hidden />\n                    <div className=\"absolute left-0 bottom-0 w-24 h-24 bg-gradient-to-tr from-black/5 to-transparent rotate-12 -translate-x-7 translate-y-7 blur-[1px]\" aria-hidden />\n                    <div className=\"relative z-10\">\n                    <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${style.iconWrap} text-white flex items-center justify-center mb-2.5 shadow-sm`}>\n                      <stat.icon className=\"w-5 h-5\" aria-hidden />\n                    </div>\n                    <div className=\"text-xl sm:text-2xl font-bold text-gray-900\">\n                  <CountUp\n                    end={stat.value}\n                    duration={1800}\n                    suffix={stat.suffix}\n                    decimals={stat.decimals}\n                    delay={HERO_REVEAL_DELAY.stats[idx] + 180}\n                  />\n                </div>\n                    <div className=\"text-xs text-gray-600\">{stat.label}</div>\n                    </div>\n              </div>\n              );\n            })}\n              </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { ModernHero };\n","import React, { useState, useEffect, useRef } from 'react';\nimport { \n  Shield, Truck, Award, Clock, Heart, Star, \n  ArrowRight, Check, TrendingUp, Zap, Users,\n  ShoppingBag, Package, Sparkles, RefreshCw\n} from 'lucide-react';\nimport SectionHeader from './SectionHeader';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getStockLevel } from '../../utils/helpers';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\nimport ProductCarousel from '../ui/ProductCarousel';\n\n/**\n * Social Proof & Trust Signals\n */\nexport const SocialProof = () => {\n  const [count, setCount] = useState(0);\n  const targetCount = 50247;\n\n  useEffect(() => {\n    const duration = 2000;\n    const steps = 60;\n    const increment = targetCount / steps;\n    let current = 0;\n\n    const timer = setInterval(() => {\n      current += increment;\n      if (current >= targetCount) {\n        setCount(targetCount);\n        clearInterval(timer);\n      } else {\n        setCount(Math.floor(current));\n      }\n    }, duration / steps);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const trustBadges = [\n    { icon: Shield, label: 'Biztonsgos fizets', color: 'blue' },\n    { icon: Truck, label: 'Ingyenes szllts', color: 'green' },\n    { icon: Award, label: '2 v garancia', color: 'purple' },\n    { icon: Clock, label: '24h gyflszolglat', color: 'orange' }\n  ];\n\n  const colorClasses = {\n    blue: 'from-blue-500 to-blue-600',\n    green: 'from-green-500 to-green-600',\n    purple: 'from-secondary-500 to-secondary-700',\n    orange: 'from-orange-500 to-orange-600'\n  };\n\n  return (\n    <section className=\"relative py-24 bg-[#0f1218] overflow-hidden\" aria-labelledby=\"social-proof-heading\">\n      <div className=\"absolute inset-0 opacity-25\" aria-hidden>\n        <div className=\"absolute -top-32 left-1/2 -translate-x-1/2 w-[920px] h-[920px] rounded-full blur-[160px] bg-primary-500/60\" />\n        <div className=\"absolute -bottom-40 right-0 w-[680px] h-[680px] rounded-full blur-[140px] bg-secondary-600/50\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n        <div className=\"text-center mb-14\">\n          <div className=\"inline-flex items-center gap-2 mb-6 px-4 py-2 bg-white/10 border border-white/15 rounded-full backdrop-blur-sm\">\n            <Users className=\"w-5 h-5 text-primary-400\" aria-hidden />\n            <span className=\"text-xs font-bold text-white/90 uppercase tracking-wider\">Trsadalmi bizonytk</span>\n          </div>\n          <h2 id=\"social-proof-heading\" className=\"text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tight text-white mb-4\">\n            {count.toLocaleString('hu-HU')}+\n          </h2>\n          <p className=\"text-lg sm:text-xl text-white/80\">\n            ember vlasztotta mr a Marketly-t\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-14\">\n          {trustBadges.map((badge, idx) => (\n            <div\n              key={idx}\n              className=\"group relative rounded-2xl border border-white/15 bg-white/10 backdrop-blur-md p-6 shadow-[0_8px_28px_rgba(0,0,0,0.22)] hover:shadow-[0_16px_44px_rgba(0,0,0,0.32)] hover:-translate-y-1 transition-all duration-300\"\n            >\n              <div className={`absolute inset-x-4 top-0 h-px bg-gradient-to-r ${colorClasses[badge.color]} opacity-80`} />\n              <div className={`w-14 h-14 rounded-2xl bg-gradient-to-br ${colorClasses[badge.color]} flex items-center justify-center mb-4 shadow-lg`}>\n                <badge.icon className=\"w-7 h-7 text-white\" aria-hidden />\n              </div>\n              <h3 className=\"font-semibold text-white text-base leading-tight\">\n                {badge.label}\n              </h3>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"text-center rounded-2xl border border-white/15 bg-white/10 backdrop-blur-sm py-8 px-6\">\n          <div className=\"flex justify-center gap-2 mb-4\">\n            {[...Array(5)].map((_, i) => (\n              <Star key={i} className=\"w-7 h-7 fill-amber-400 text-amber-400\" aria-hidden />\n            ))}\n          </div>\n          <p className=\"text-2xl sm:text-3xl font-bold text-white mb-1\">\n            4.9 / 5.0 tlagos rtkels\n          </p>\n          <p className=\"text-sm sm:text-base text-white/75\">\n            12,487 vals vlemny alapjn\n          </p>\n        </div>\n      </div>\n    </section>\n  );\n};\n\n/**\n * Live Product Showcase with Swipeable Carousel\n * - Random products on each load\n * - Touch swipe support for mobile\n * - Arrow navigation for desktop\n * - Compact mobile cards\n */\nconst SECTION_ID = 'customer-favorites';\n\nexport const LiveShowcase = ({ products = [], onProductClick, rotationTick = 0 }) => {\n  const [seed, setSeed] = useState(0);\n  const [isInteracting, setIsInteracting] = useState(false);\n  const [isInView, setIsInView] = useState(true);\n  const sectionRef = useRef(null);\n\n  // Randomize and select products on each render\n  const showcaseProducts = React.useMemo(() => {\n    if (products.length > 0) {\n      const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true));\n      const shuffled = [...inStock].sort(() => (seed % 2 === 0 ? 1 : -1) * (Math.random() - 0.5));\n      return shuffled.slice(0, 12);\n    }\n    return [];\n  }, [products, seed]);\n\n  useEffect(() => {\n    trackSectionEvent(SECTION_ID, 'section_impression');\n  }, []);\n\n  useEffect(() => {\n    if (!rotationTick || isInView || isInteracting) return;\n    setSeed((v) => v + 1);\n  }, [rotationTick, isInView, isInteracting]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!sectionRef.current || !(sectionRef.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        setIsInView(entry.isIntersecting);\n      },\n      { threshold: 0.15 }\n    );\n    try {\n      observer.observe(sectionRef.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, []);\n\n  return (\n    <div\n      ref={sectionRef}\n      className=\"section-shell section-world section-world--favorites py-8 sm:py-10 lg:py-14 xl:py-16 overflow-hidden\"\n      role=\"region\"\n      aria-label=\"Vsrlink kedvencei\"\n      data-section={SECTION_ID}\n    >\n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16\">\n        <div className=\"section-frame\">\n          <SectionHeader\n            id=\"customer-favorites-heading\"\n            title=\"Vsrlink kedvencei\"\n            subtitle=\"A legjobbra rtkelt s legtbbet vlasztott btorok\"\n            Icon={Heart}\n            accentClass=\"from-pink-500 to-rose-600\"\n            eyebrow=\"Kzssgi kedvencek\"\n            badge=\"Kznsgkedvenc\"\n            prominent\n            className=\"border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites\"\n            meta={`sszesen: ${showcaseProducts.length.toLocaleString('hu-HU')} termk`}\n            helpText=\"Csak kszleten lv termkek\"\n            actions={\n              <button\n                type=\"button\"\n                onClick={() => setSeed((v) => v + 1)}\n                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Frisstem\n              </button>\n            }\n          />\n          {showcaseProducts.length > 0 ? (\n            <ProductCarousel className=\"mt-2\" onInteractionChange={setIsInteracting}>\n              {showcaseProducts.map((product, index) => {\n                const stockLevel = getStockLevel(product);\n                const highlightBadge = stockLevel !== null && stockLevel <= 3 ? `Utols ${stockLevel} db` : '';\n                return (\n                  <EnhancedProductCard\n                    key={product.id || index}\n                    product={product}\n                    onQuickView={onProductClick}\n                    index={index}\n                    highlightBadge={highlightBadge}\n                    sectionId={SECTION_ID}\n                    showFeedback\n                    size=\"compact\"\n                    tone=\"favorites\"\n                  />\n                );\n              })}\n            </ProductCarousel>\n          ) : (\n            <div className=\"text-center py-12 bg-white rounded-2xl shadow-inner\">\n              <Heart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n              <p className=\"text-gray-500\">Nincs elg adat a kedvencekhez</p>\n              <p className=\"text-gray-400 text-sm\">Trj vissza ksbb!</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Interactive CTA Section\n */\nexport const InteractiveCTA = ({ onGetStarted }) => {\n  return (\n    <section className=\"py-24 bg-gradient-to-br from-primary-500 to-secondary-700 relative overflow-hidden\">\n      <div className=\"absolute inset-0 opacity-10\" aria-hidden>\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-white rounded-full filter blur-[120px] animate-blob motion-reduce:animate-none\" />\n        <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-yellow-200 rounded-full filter blur-[120px] animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-3xl mx-auto px-4 sm:px-6 lg:px-16 text-center\">\n        <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-8\">\n          <Sparkles className=\"w-5 h-5 text-white\" aria-hidden />\n          <span className=\"text-xs font-bold text-white uppercase tracking-wider\">Kezdd el</span>\n        </div>\n\n        <h2 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight\">\n          Kszen llsz a tkletes btor megtallsra?\n        </h2>\n\n        <p className=\"text-lg text-white/90 mb-10\">\n          Csatlakozz 50.000+ elgedett vsrlnkhoz\n        </p>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n          <button\n            type=\"button\"\n            onClick={onGetStarted}\n            className=\"group w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-primary-600 rounded-xl font-semibold text-base shadow-2xl hover:shadow-white/30 hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2\"\n            aria-label=\"Bngszs indtsa\"\n          >\n            Bngszem a termkeket\n            <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n          </button>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { SocialProof, LiveShowcase, InteractiveCTA };\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { Sparkles, ThumbsUp, ThumbsDown, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\nimport { \n  getSimilarProducts, \n  likeProduct, \n  dislikeProduct, \n  isProductLiked,\n  getDislikedProducts \n} from '../../services/userPreferencesService';\n\n/**\n * AI-Powered Similar Products Recommendation\n * Uses user preferences and AI for personalized recommendations\n */\nexport const SimilarProducts = ({ \n  currentProduct, \n  allProducts, \n  onToggleWishlist, \n  wishlist = [], \n  onQuickView,\n  onAddToCart,\n  maxResults = 4 \n}) => {\n  const [similarProducts, setSimilarProducts] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [aiReason, setAiReason] = useState('');\n\n  const findBasicSimilar = useCallback(() => {\n    if (!currentProduct || !allProducts?.length) return [];\n    const price = currentProduct.salePrice || currentProduct.price || 0;\n    const priceRange = price * 0.4;\n    const dislikedIds = getDislikedProducts();\n    return allProducts\n      .filter(p =>\n        p.id !== currentProduct.id &&\n        !dislikedIds.includes(p.id) &&\n        (p.category || '').includes((currentProduct.category || '').split(' > ')[0]) &&\n        Math.abs((p.salePrice || p.price || 0) - price) <= priceRange\n      )\n      .sort(() => Math.random() - 0.5)\n      .slice(0, maxResults);\n  }, [currentProduct, allProducts, maxResults]);\n\n  const findSimilarProducts = useCallback(async () => {\n    setIsLoading(true);\n    setAiReason('');\n\n    try {\n      // Elszr prbljuk a userPreferencesService-t (gyors, loklis)\n      const localSimilar = getSimilarProducts(currentProduct, allProducts, maxResults + 4);\n      \n      if (localSimilar.length >= maxResults) {\n        // Van elg loklis tallat\n        setSimilarProducts(localSimilar.slice(0, maxResults));\n        setAiReason('Szemlyre szabott ajnls a bngszsi elzmnyek alapjn');\n        setIsLoading(false);\n        return;\n      }\n\n      // Ha kevs loklis tallat van, krjnk AI-tl is segtsget\n      const productContext = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .slice(0, 30)\n        .map(p => `${p.name} (${p.category}) - ${(p.salePrice || p.price || 0).toLocaleString('hu-HU')} Ft`)\n        .join('\\n');\n\n      const prompt = `A vsrl pp ezt nzi: \"${currentProduct.name}\" (${currentProduct.category})\nr: ${(currentProduct.salePrice || currentProduct.price || 0).toLocaleString('hu-HU')} Ft\n\nElrhet termkek:\n${productContext}\n\nAjnlj 4 hasonl termket ami illik hozz! \nVlaszolj egyetlen mondatban, hogy MIRT passzolnak ezek.\nCsak az indoklst rd meg, ne a termkneveket!`;\n\n      const { generateText } = await import('../../services/geminiService');\n      const result = await generateText(prompt, { temperature: 0.7, maxTokens: 100 });\n      \n      if (result.success && result.text) {\n        setAiReason(result.text);\n      }\n\n      // Kombinljuk a loklis s egyszer hasonlsgot\n      const combined = localSimilar.length > 0 \n        ? localSimilar \n        : findBasicSimilar();\n      \n      setSimilarProducts(combined.slice(0, maxResults));\n\n    } catch (error) {\n      console.warn('Similar products error:', error);\n      setSimilarProducts(findBasicSimilar());\n    } finally {\n      setIsLoading(false);\n    }\n  }, [currentProduct, allProducts, maxResults, findBasicSimilar]);\n\n  useEffect(() => {\n    if (currentProduct && allProducts.length > 0) {\n      findSimilarProducts();\n    }\n  }, [currentProduct, allProducts, findSimilarProducts]);\n\n  // Feedback kezels\n  const handleLike = (productId) => {\n    likeProduct(productId);\n  };\n\n  const handleDislike = (productId) => {\n    dislikeProduct(productId);\n    // Eltvoltjuk a listbl\n    setSimilarProducts(prev => prev.filter(p => p.id !== productId));\n  };\n\n  if (similarProducts.length === 0 && !isLoading) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gradient-to-br from-secondary-50 to-primary-50 py-8 sm:py-12 px-4 sm:px-6 lg:px-8 my-8 sm:my-16 rounded-2xl sm:rounded-3xl\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 sm:mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-500\" />\n              <h2 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900\">\n                Neked ajnljuk\n              </h2>\n            </div>\n            {aiReason && (\n              <p className=\"text-sm sm:text-base text-gray-600 max-w-xl\">\n                {aiReason}\n              </p>\n            )}\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"flex items-center gap-3 text-primary-500\">\n              <Sparkles className=\"w-6 h-6 animate-pulse\" />\n              <span className=\"text-base sm:text-lg font-medium\">Szemlyre szabott ajnls kszl...</span>\n            </div>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6\">\n            {similarProducts.map((product, index) => (\n              <div key={product.id} className=\"relative group\">\n                <EnhancedProductCard\n                  product={product}\n                  onToggleWishlist={onToggleWishlist}\n                  isWishlisted={wishlist.includes(product.id)}\n                  onQuickView={onQuickView}\n                  onAddToCart={onAddToCart}\n                  showBadges={false}\n                  index={index}\n                />\n                \n                {/* Feedback buttons */}\n                <div className=\"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleLike(product.id); }}\n                    className={`p-1.5 rounded-full bg-white shadow-sm ${isProductLiked(product.id) ? 'text-green-600' : 'text-gray-400 hover:text-green-600'} transition-colors`}\n                    title=\"Tetszik\"\n                  >\n                    <ThumbsUp className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleDislike(product.id); }}\n                    className=\"p-1.5 rounded-full bg-white shadow-sm text-gray-400 hover:text-red-600 transition-colors\"\n                    title=\"Nem tetszik\"\n                  >\n                    <ThumbsDown className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import React, { useEffect, useState } from 'react';\nimport { Clock, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\n\n/**\n * Recently Viewed Products - Tracks and displays user's browsing history\n */\nexport const RecentlyViewed = ({ \n  onToggleWishlist, \n  wishlist, \n  onQuickView,\n  onAddToCart,\n  maxItems = 4 \n}) => {\n  const [recentProducts, setRecentProducts] = useState([]);\n\n  useEffect(() => {\n    // Load from localStorage\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    setRecentProducts(recent.slice(0, maxItems));\n\n    // Listen for storage changes (when new product is viewed)\n    const handleStorageChange = () => {\n      const updated = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n      setRecentProducts(updated.slice(0, maxItems));\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    window.addEventListener('recently-viewed-updated', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n      window.removeEventListener('recently-viewed-updated', handleStorageChange);\n    };\n  }, [maxItems]);\n\n  if (recentProducts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 my-16\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Clock className=\"w-6 h-6 text-gray-600\" />\n              <h2 className=\"text-2xl sm:text-3xl font-bold text-gray-900\">\n                Utoljra megtekintett\n              </h2>\n            </div>\n            <p className=\"text-gray-600\">\n              Bngssz vissza a nemrg nzett termkek kztt\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {recentProducts.map(product => (\n            <EnhancedProductCard\n              key={product.id}\n              product={product}\n              onToggleWishlist={onToggleWishlist}\n              isWishlisted={wishlist.includes(product.id)}\n              onQuickView={onQuickView}\n              onAddToCart={onAddToCart}\n              showBadges={false}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Utility function to track viewed products\n * Call this when a product is viewed (e.g., in ProductModal)\n */\nexport const trackProductView = (product) => {\n  try {\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    \n    // Remove if already exists\n    const filtered = recent.filter(p => p.id !== product.id);\n    \n    // Add to beginning\n    const updated = [product, ...filtered].slice(0, 10); // Keep max 10\n    \n    localStorage.setItem('recently_viewed', JSON.stringify(updated));\n    \n    // Dispatch custom event\n    window.dispatchEvent(new Event('recently-viewed-updated'));\n  } catch (error) {\n    console.error('Error tracking product view:', error);\n  }\n};\n","import React, { useState } from 'react';\nimport { X, Check, ArrowLeftRight, Plus } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice, PLACEHOLDER_IMAGE } from '../../utils/helpers';\n\n/**\n * Product Comparison Tool\n */\nexport const ProductComparison = ({ \n  comparisonList = [], \n  onRemove, \n  onClear,\n  onAddMore \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  useScrollLock(isExpanded);\n\n  if (comparisonList.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Floating Comparison Button - mobile aware of 40px UNAS bottom nav */}\n      <button\n        onClick={() => setIsExpanded(true)}\n        className=\"fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-4 md:left-auto md:right-6 z-40 bg-primary-500 text-white px-4 md:px-6 py-2.5 md:py-3 rounded-full shadow-2xl hover:bg-primary-600 transition-all flex items-center gap-2 hover:scale-105 transform text-sm md:text-base\"\n      >\n        <ArrowLeftRight className=\"w-4 h-4 md:w-5 md:h-5\" />\n        <span className=\"font-bold\">sszehasonlts ({comparisonList.length})</span>\n      </button>\n\n      {/* Comparison Modal */}\n      {isExpanded && (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in\" onClick={() => setIsExpanded(false)}>\n          <div className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col\" onClick={e => e.stopPropagation()}>\n            {/* Header */}\n            <div className=\"p-6 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-primary-50 to-secondary-50\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n                  <ArrowLeftRight className=\"w-6 h-6 text-primary-500\" />\n                  Termkek sszehasonltsa\n                </h2>\n                <p className=\"text-sm text-gray-600 mt-1\">\n                  {comparisonList.length} termk kivlasztva\n                </p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={onClear}\n                  className=\"px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-xl transition-colors font-medium\"\n                >\n                  sszes trlse\n                </button>\n                <button\n                  onClick={() => setIsExpanded(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Comparison Table */}\n            <div className=\"flex-1 overflow-auto p-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {comparisonList.map((product) => (\n                  <div key={product.id} className=\"border border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg transition-shadow relative\">\n                    {/* Remove button */}\n                    <button\n                      onClick={() => onRemove(product.id)}\n                      className=\"absolute top-3 right-3 z-10 bg-white/90 p-1.5 rounded-full shadow-md hover:bg-red-50 hover:text-red-600 transition-colors\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </button>\n\n                    {/* Image */}\n                    <div className=\"h-48 bg-gray-50 flex items-center justify-center p-4\">\n                      <img\n                        src={product.images?.[0] || PLACEHOLDER_IMAGE}\n                        alt={product.name}\n                        className=\"max-h-full max-w-full object-contain\"\n                        onError={(e) => {e.target.src = PLACEHOLDER_IMAGE}}\n                      />\n                    </div>\n\n                    {/* Details */}\n                    <div className=\"p-4 space-y-3\">\n                      <h3 className=\"font-bold text-lg text-gray-900 line-clamp-2\">{product.name}</h3>\n                      \n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">r:</span>\n                          <span className=\"font-bold text-primary-500 text-lg\">{formatPrice(product.price)}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kategria:</span>\n                          <span className=\"font-medium text-gray-900\">{product.category}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kszlet:</span>\n                          <span className={`font-medium ${product.inStock ? 'text-green-600' : 'text-red-600'}`}>\n                            {product.inStock ? 'Raktron' : 'Nincs raktron'}\n                          </span>\n                        </div>\n\n                        {product.params && (\n                          <div className=\"pt-2\">\n                            <span className=\"text-gray-600 text-xs block mb-1\">Paramterek:</span>\n                            <p className=\"text-gray-700 text-xs line-clamp-3\">{product.params}</p>\n                          </div>\n                        )}\n                      </div>\n\n                      <a\n                        href={product.link}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"block w-full bg-primary-500 text-white py-2 rounded-xl text-center font-bold hover:bg-primary-600 transition-colors text-sm mt-4\"\n                      >\n                        Megveszem\n                      </a>\n                    </div>\n                  </div>\n                ))}\n\n                {/* Add More */}\n                {comparisonList.length < 6 && (\n                  <div\n                    onClick={() => {\n                      setIsExpanded(false);\n                      onAddMore?.();\n                    }}\n                    className=\"border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center p-8 hover:border-primary-400 hover:bg-primary-50 transition-all cursor-pointer\"\n                  >\n                    <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                      <Plus className=\"w-8 h-8 text-gray-400\" />\n                    </div>\n                    <p className=\"text-gray-600 font-medium\">Mg tbb termk</p>\n                    <p className=\"text-gray-400 text-sm mt-1\">Max. 6 termk</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Comparison Toggle Button for Product Cards\n */\nexport const ComparisonToggle = ({ product, isInComparison, onToggle }) => {\n  return (\n    <button\n      onClick={(e) => {\n        e.stopPropagation();\n        onToggle(product);\n      }}\n      className={`p-2 rounded-full shadow-md transition-all transform hover:scale-110 ${\n        isInComparison\n          ? 'bg-primary-500 text-white'\n          : 'bg-white text-gray-600 hover:bg-primary-50 hover:text-primary-500'\n      }`}\n      title={isInComparison ? 'Eltvolts az sszehasonltsbl' : 'Hozzads az sszehasonltshoz'}\n    >\n      <ArrowLeftRight className=\"w-4 h-4\" />\n    </button>\n  );\n};\n\n/**\n * Hook for managing comparison list\n */\nexport const useComparison = () => {\n  const [comparisonList, setComparisonList] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem('comparison_list') || '[]');\n    } catch {\n      return [];\n    }\n  });\n\n  const addToComparison = (product) => {\n    if (comparisonList.length >= 6) {\n      return { success: false, message: 'Maximum 6 termk hasonlthat ssze' };\n    }\n    \n    if (comparisonList.find(p => p.id === product.id)) {\n      return { success: false, message: 'Ez a termk mr az sszehasonltsban van' };\n    }\n\n    const updated = [...comparisonList, product];\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n    return { success: true, message: 'Hozzadva az sszehasonltshoz' };\n  };\n\n  const removeFromComparison = (productId) => {\n    const updated = comparisonList.filter(p => p.id !== productId);\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n  };\n\n  const clearComparison = () => {\n    setComparisonList([]);\n    localStorage.removeItem('comparison_list');\n  };\n\n  const toggleComparison = (product) => {\n    const exists = comparisonList.find(p => p.id === product.id);\n    if (exists) {\n      removeFromComparison(product.id);\n      return { success: true, message: 'Eltvoltva az sszehasonltsbl', action: 'removed' };\n    } else {\n      return { ...addToComparison(product), action: 'added' };\n    }\n  };\n\n  const isInComparison = (productId) => {\n    return comparisonList.some(p => p.id === productId);\n  };\n\n  return {\n    comparisonList,\n    addToComparison,\n    removeFromComparison,\n    clearComparison,\n    toggleComparison,\n    isInComparison\n  };\n};\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Filter, X, DollarSign, Package, Tag } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * Shared filter panel content (controlled). Used in desktop dropdown and mobile BottomSheet.\n * products, filters (from parent), onFilterChange(filters), onApply() when \"Alkalmaz\" is clicked.\n */\nexport const AdvancedFiltersPanel = ({\n  products = [],\n  filters = {},\n  onFilterChange,\n  onApply,\n  showHeader = true,\n  onCloseHeader\n}) => {\n  const priceRange = useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity, max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  const categories = useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  const effective = useMemo(() => ({\n    priceMin: filters.priceMin ?? priceRange.min,\n    priceMax: filters.priceMax ?? priceRange.max,\n    inStockOnly: filters.inStockOnly ?? false,\n    categories: Array.isArray(filters.categories) ? filters.categories : []\n  }), [filters, priceRange]);\n\n  const previousFiltersRef = React.useRef(null);\n  const [hasRestorableFilters, setHasRestorableFilters] = useState(false);\n\n  const handlePriceChange = (type, value) => {\n    const v = parseInt(value, 10);\n    if (Number.isNaN(v)) return;\n    onFilterChange?.({ ...effective, [type]: v });\n  };\n\n  const toggleCategory = (cat) => {\n    const next = effective.categories.includes(cat)\n      ? effective.categories.filter(c => c !== cat)\n      : [...effective.categories, cat];\n    onFilterChange?.({ ...effective, categories: next });\n  };\n\n  const clearFilters = () => {\n    previousFiltersRef.current = { ...effective };\n    setHasRestorableFilters(true);\n    onFilterChange?.({\n      priceMin: priceRange.min,\n      priceMax: priceRange.max,\n      inStockOnly: false,\n      categories: []\n    });\n  };\n\n  const restorePrevious = () => {\n    if (previousFiltersRef.current) {\n      onFilterChange?.(previousFiltersRef.current);\n      previousFiltersRef.current = null;\n      setHasRestorableFilters(false);\n    }\n  };\n\n  const activeCount = [\n    effective.inStockOnly,\n    effective.categories.length > 0,\n    effective.priceMin > priceRange.min,\n    effective.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  return (\n    <>\n      {showHeader && (\n        <div className=\"p-4 border-b border-gray-200 flex justify-between items-center shrink-0\">\n          <h3 className=\"font-bold text-lg flex items-center gap-2\">\n            <Filter className=\"w-5 h-5 text-primary-500\" />\n            Szrk\n          </h3>\n          {onCloseHeader && (\n            <button type=\"button\" onClick={onCloseHeader} className=\"p-2 min-w-[44px] min-h-[44px] flex items-center justify-center hover:bg-gray-100 rounded-lg transition-colors\" aria-label=\"Szrk bezrsa\">\n              <X className=\"w-5 h-5 text-gray-600\" />\n            </button>\n          )}\n        </div>\n      )}\n      <div className=\"p-4 space-y-6 max-h-[60vh] md:max-h-96 overflow-y-auto custom-scrollbar flex-1 min-h-0\">\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-3\">\n            <DollarSign className=\"w-4 h-4\" />\n            r tartomny\n          </label>\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"text-xs text-gray-600\">Minimum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMin} onChange={(e) => handlePriceChange('priceMin', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMin)}</div>\n            </div>\n            <div>\n              <label className=\"text-xs text-gray-600\">Maximum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMax} onChange={(e) => handlePriceChange('priceMax', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMax)}</div>\n            </div>\n          </div>\n        </div>\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n            <Package className=\"w-4 h-4\" />\n            Kszlet\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input type=\"checkbox\" checked={effective.inStockOnly} onChange={(e) => onFilterChange?.({ ...effective, inStockOnly: e.target.checked })} className=\"w-4 h-4 text-primary-500 rounded\" />\n            <span className=\"text-sm text-gray-700\">Csak raktron lv termkek</span>\n          </label>\n        </div>\n        {categories.length > 0 && (\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n              <Tag className=\"w-4 h-4\" />\n              Kategrik\n            </label>\n            <div className=\"space-y-1 max-h-40 overflow-y-auto\">\n              {categories.map(cat => (\n                <label key={cat} className=\"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded\">\n                  <input type=\"checkbox\" checked={effective.categories.includes(cat)} onChange={() => toggleCategory(cat)} className=\"w-4 h-4 text-primary-500 rounded\" />\n                  <span className=\"text-sm text-gray-700\">{cat}</span>\n                </label>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n      <div className=\"p-4 border-t border-gray-200 flex flex-wrap gap-2 shrink-0\">\n        <button type=\"button\" onClick={clearFilters} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-gray-300 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors\">Trls</button>\n        {hasRestorableFilters && (\n          <button type=\"button\" onClick={restorePrevious} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-primary-300 rounded-xl text-sm font-medium text-primary-600 hover:bg-primary-50 transition-colors\">Visszallts</button>\n        )}\n        <button type=\"button\" onClick={onApply} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl text-sm font-bold hover:bg-primary-600 transition-colors\">Alkalmaz</button>\n      </div>\n    </>\n  );\n};\n\n/**\n * Advanced Filters (desktop: button + dropdown)\n */\nexport const AdvancedFilters = ({ \n  products = [],\n  onFilterChange,\n  initialFilters = {}\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  useScrollLock(isOpen);\n  const [filters, setFilters] = useState({\n    priceMin: initialFilters.priceMin || 0,\n    priceMax: initialFilters.priceMax || 1000000,\n    inStockOnly: initialFilters.inStockOnly || false,\n    categories: initialFilters.categories || [],\n    ...initialFilters\n  });\n\n  // Calculate price range from products (avoid Math.min/max spread  168k args = stack overflow)\n  const priceRange = React.useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity;\n    let max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  // Get unique categories (limit to 500 to avoid huge lists; sample if needed)\n  const categories = React.useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  // Extract colors and materials from params (sample to avoid long loop on 168k)\n  const extractedAttributes = React.useMemo(() => {\n    const colors = new Set();\n    const materials = new Set();\n    const step = Math.max(1, Math.floor(products.length / 5000));\n    for (let i = 0; i < products.length; i += step) {\n      const p = products[i];\n      if (p.params) {\n        const params = p.params.toLowerCase();\n        // Simple extraction - can be enhanced\n        if (params.includes('szn:') || params.includes('szne:')) {\n          const match = params.match(/szn[e]?:\\s*([^,]+)/i);\n          if (match) colors.add(match[1].trim());\n        }\n        if (params.includes('anyag:')) {\n          const match = params.match(/anyag:\\s*([^,]+)/i);\n          if (match) materials.add(match[1].trim());\n        }\n      }\n    }\n\n    return {\n      colors: Array.from(colors).slice(0, 10),\n      materials: Array.from(materials).slice(0, 10)\n    };\n  }, [products]);\n\n  useEffect(() => {\n    onFilterChange?.(filters);\n  }, [filters]);\n\n  const activeFilterCount = [\n    filters.inStockOnly,\n    filters.categories.length > 0,\n    filters.priceMin > priceRange.min,\n    filters.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  const panelContent = (\n    <AdvancedFiltersPanel\n      products={products}\n      filters={filters}\n      onFilterChange={(next) => {\n        setFilters(next);\n        onFilterChange?.(next);\n      }}\n      onApply={() => setIsOpen(false)}\n      showHeader={true}\n      onCloseHeader={() => setIsOpen(false)}\n    />\n  );\n\n  return (\n    <>\n      {/* Filter Toggle Button */}\n      <button\n        type=\"button\"\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"relative px-4 py-2 min-h-[44px] border-2 border-gray-200 rounded-xl hover:border-primary-500 transition-all flex items-center gap-2 font-medium\"\n        aria-label=\"Szrk megnyitsa\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        <span>Szrk</span>\n        {activeFilterCount > 0 && (\n          <span className=\"absolute -top-2 -right-2 bg-primary-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center\">\n            {activeFilterCount}\n          </span>\n        )}\n      </button>\n\n      {/* Mobile: full-screen overlay + bottom sheet */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-end md:hidden\" role=\"dialog\" aria-label=\"Szrk\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setIsOpen(false)} aria-hidden=\"true\" />\n          <div className=\"relative w-full max-h-[85vh] bg-white rounded-t-2xl shadow-2xl flex flex-col animate-fade-in-down\">\n            {panelContent}\n          </div>\n        </div>\n      )}\n\n      {/* Desktop: dropdown panel */}\n      {isOpen && (\n        <div className=\"hidden md:block absolute top-full right-0 mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 animate-fade-in-down\">\n          {panelContent}\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Apply filters to product list\n */\nexport const applyFilters = (products, filters) => {\n  return products.filter(product => {\n    // Price filter\n    if (product.price < filters.priceMin || product.price > filters.priceMax) {\n      return false;\n    }\n\n    // Stock filter (support both inStock and in_stock)\n    if (filters.inStockOnly && !(product.inStock ?? product.in_stock)) {\n      return false;\n    }\n\n    // Category filter\n    if (filters.categories.length > 0 && !filters.categories.includes(product.category)) {\n      return false;\n    }\n\n    return true;\n  });\n};\n","import React, { useState } from 'react';\nimport { ShoppingCart, Check, Loader2 } from 'lucide-react';\n\n/**\n * QuickAddToCart - One-click add to cart with visual feedback\n * Uses CSS transitions instead of framer-motion\n */\nconst QuickAddToCart = ({ product, onAdd, className = '' }) => {\n  const [isAdding, setIsAdding] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  const handleQuickAdd = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (window.navigator?.vibrate) {\n      window.navigator.vibrate(50);\n    }\n\n    setIsAdding(true);\n\n    try {\n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      if (onAdd) {\n        await onAdd(product);\n      }\n\n      setShowSuccess(true);\n      \n      setTimeout(() => {\n        setShowSuccess(false);\n        setIsAdding(false);\n      }, 2000);\n\n    } catch (error) {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleQuickAdd}\n      disabled={isAdding || showSuccess}\n      className={`\n        relative overflow-hidden\n        flex items-center justify-center gap-2\n        px-4 py-2 rounded-lg\n        font-medium text-sm\n        transition-all duration-200\n        transform hover:scale-105 active:scale-95\n        ${showSuccess \n          ? 'bg-green-500 text-white' \n          : 'bg-primary-500 text-white hover:bg-primary-600'\n        }\n        disabled:opacity-80\n        ${className}\n      `}\n    >\n      {isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n          <span>Hozzads...</span>\n        </span>\n      )}\n\n      {showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Check className=\"w-4 h-4\" />\n          <span>Hozzadva!</span>\n        </span>\n      )}\n\n      {!isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <ShoppingCart className=\"w-4 h-4\" />\n          <span>Kosrba</span>\n        </span>\n      )}\n    </button>\n  );\n};\n\nexport default QuickAddToCart;\n","import React, { useState, useEffect } from 'react';\nimport { X, ShoppingCart, Heart, Share2, ExternalLink, Sparkles, Bell } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport QuickAddToCart from './QuickAddToCart';\nimport { PLACEHOLDER_IMAGE, formatPrice } from '../../utils/helpers';\nimport { getOptimizedImageProps } from '../../utils/imageOptimizer';\nimport {\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n/**\n * ProductQuickPeek - Hover/click modal for quick product preview\n * Shows essential info without full page navigation\n */\nconst ProductQuickPeek = ({ product, isOpen, onClose, onAddToCart }) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [activeImage, setActiveImage] = useState(0);\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n\n  useScrollLock(isOpen);\n\n  useEffect(() => {\n    if (isOpen) {\n      setImageLoaded(false);\n      setActiveImage(0);\n      setFeedbackState({\n        liked: isProductLiked(product?.id),\n        disliked: isProductDisliked(product?.id)\n      });\n    }\n  }, [isOpen]);\n\n  if (!product) return null;\n\n  // Parse product images (array or single)\n  const images = Array.isArray(product.images) && product.images.length > 0\n    ? product.images\n    : product.image ? [product.image] : [];\n  const imageProps = getOptimizedImageProps(images[activeImage] || product.image || PLACEHOLDER_IMAGE, product.name, { responsive: true, lazy: false });\n  \n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Wrapper: always center modal on screen (safe area for mobile) */}\n          <div className=\"fixed inset-0 lg:top-[60px] flex items-center justify-center p-4 z-[9999] pointer-events-none overflow-y-auto\">\n            {/* Modal: centered, scrolls on small screens */}\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.9, y: 20 }}\n              transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n              className=\"w-full max-w-4xl max-h-[90vh] my-auto pointer-events-auto flex flex-col\"\n            >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] min-h-0\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-secondary-50\">\n                <div className=\"flex items-center gap-2\">\n                  <Sparkles className=\"w-5 h-5 text-primary-500\" />\n                  <h3 className=\"text-lg font-bold text-gray-900\">Gyors elnzet</h3>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  className=\"p-2 min-h-[44px] min-w-[44px] flex items-center justify-center hover:bg-white rounded-lg transition-colors\"\n                  aria-label=\"Bezrs\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n\n              {/* Content: scrollable, keeps modal centered */}\n              <div className=\"flex-1 min-h-0 overflow-y-auto\">\n                <div className=\"grid md:grid-cols-2 gap-6 p-6\">\n                  {/* Left: Image */}\n                  <div className=\"space-y-4\">\n                    <div className=\"relative aspect-square bg-gray-100 rounded-xl overflow-hidden group\">\n                      <img\n                        src={imageProps.src || (images[activeImage] || product.image || PLACEHOLDER_IMAGE)}\n                        alt={product.name}\n                        onLoad={() => setImageLoaded(true)}\n                        className={`\n                          w-full h-full object-cover\n                          transition-all duration-300\n                          ${imageLoaded ? 'opacity-100 scale-100' : 'opacity-0 scale-105'}\n                        `}\n                        srcSet={imageProps.srcSet}\n                        sizes={imageProps.sizes}\n                      />\n                      \n                      {!imageLoaded && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                          <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                        </div>\n                      )}\n\n                      {/* Quick View Badge */}\n                      <div className=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-primary-500\">\n                        Gyors elnzet\n                      </div>\n                    </div>\n\n                    {/* Additional images thumbnails (if any) */}\n                    {images.length > 1 && (\n                      <div className=\"flex gap-2 overflow-x-auto\">\n                        {images.map((img, idx) => (\n                          <button\n                            key={idx}\n                            onClick={() => setActiveImage(idx)}\n                            className={`\n                              flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                              ${activeImage === idx ? 'border-primary-500 scale-110' : 'border-gray-200 hover:border-primary-300'}\n                            `}\n                          >\n                            <img src={img} alt={`${product.name} ${idx + 1}`} className=\"w-full h-full object-cover\" />\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Right: Info */}\n                  <div className=\"flex flex-col gap-4\">\n                    {/* Category */}\n                    <div className=\"inline-flex items-center gap-2 text-sm text-primary-500 font-medium\">\n                      <span>{product.category}</span>\n                    </div>\n\n                    {/* Title */}\n                    <h2 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n                      {product.name}\n                    </h2>\n\n                    {/* Price */}\n                    <div className=\"flex items-baseline gap-2\">\n                      <span className=\"text-3xl font-bold text-primary-500\">\n                        {formatPrice(product.price)}\n                      </span>\n                      {product.originalPrice && product.originalPrice > product.price && (\n                        <span className=\"text-lg text-gray-400 line-through\">\n                          {formatPrice(product.originalPrice)}\n                        </span>\n                      )}\n                    </div>\n\n                    {/* Description/Params */}\n                    {product.params && (\n                      <div className=\"prose prose-sm max-w-none text-gray-600\">\n                        <p>{product.params.substring(0, 200)}{product.params.length > 200 ? '...' : ''}</p>\n                      </div>\n                    )}\n\n                    {/* Features/Specs (if available) */}\n                    <div className=\"border-t border-b border-gray-200 py-4 space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">llapot</span>\n                        <span className={`font-medium ${(product.inStock ?? product.in_stock) ? 'text-green-600' : 'text-red-500'}`}>\n                          {(product.inStock ?? product.in_stock) ? 'Raktron' : 'Kszlethiny'}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">Szllts</span>\n                        <span className=\"font-medium\">2-5 munkanap</span>\n                      </div>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex gap-3 mt-auto\">\n                      {(product.inStock ?? product.in_stock) ? (\n                        <QuickAddToCart\n                          product={product}\n                          onAdd={onAddToCart}\n                          className=\"flex-1\"\n                        />\n                      ) : (\n                        <button\n                          type=\"button\"\n                          onClick={() => requestBackInStock(product)}\n                          className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 border-gray-200 text-gray-700 font-semibold hover:bg-gray-50\"\n                        >\n                          <Bell className=\"w-4 h-4\" />\n                          rtestst krek\n                        </button>\n                      )}\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Add to wishlist logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-red-500 hover:text-red-500 transition-colors\"\n                      >\n                        <Heart className=\"w-5 h-5\" />\n                      </button>\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Share logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:text-primary-500 transition-colors\"\n                      >\n                        <Share2 className=\"w-5 h-5\" />\n                      </button>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleLikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.liked\n                            ? 'bg-green-600 text-white border-green-600'\n                            : 'bg-green-50 text-green-700 border-green-100 hover:bg-green-100'\n                        }`}\n                      >\n                        Tetszik\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleDislikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.disliked\n                            ? 'bg-gray-900 text-white border-gray-900'\n                            : 'bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100'\n                        }`}\n                      >\n                        Nem tetszik\n                      </button>\n                    </div>\n\n                    {/* Full Details Link */}\n                    <a\n                      href={product.link}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center justify-center gap-2 text-sm text-primary-500 hover:text-primary-600 font-medium py-2\"\n                    >\n                      <span>Teljes lers megtekintse</span>\n                      <ExternalLink className=\"w-4 h-4\" />\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </div>\n            </motion.div>\n          </div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default ProductQuickPeek;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { X, Mail, Gift, Sparkles, CheckCircle } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useScrollPosition } from '../../hooks/useScrollPosition';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * SmartNewsletterPopup - Intelligent newsletter popup\n * Shows based on exit intent, time on site, and scroll depth. Uses shared scroll hook.\n */\nconst SmartNewsletterPopup = ({ onSubscribe }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  useScrollLock(isVisible);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState('');\n  const timeOnSiteRef = useRef(null);\n  const scrollTriggeredRef = useRef(false);\n  const exitIntentRef = useRef(false);\n  const { scrollPercent } = useScrollPosition();\n\n  useEffect(() => {\n    const dismissed = localStorage.getItem('newsletter_dismissed');\n    const subscribed = localStorage.getItem('newsletter_subscribed');\n    if (dismissed || subscribed) return;\n\n    timeOnSiteRef.current = setTimeout(() => {\n      if (!scrollTriggeredRef.current && !exitIntentRef.current) setIsVisible(true);\n    }, 30000);\n\n    const handleMouseLeave = (e) => {\n      if (exitIntentRef.current) return;\n      if (e.clientY <= 0) {\n        exitIntentRef.current = true;\n        if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n        setIsVisible(true);\n      }\n    };\n    document.addEventListener('mouseleave', handleMouseLeave);\n    return () => {\n      if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n      document.removeEventListener('mouseleave', handleMouseLeave);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (scrollPercent > 70 && !scrollTriggeredRef.current) {\n      scrollTriggeredRef.current = true;\n      if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n      setIsVisible(true);\n    }\n  }, [scrollPercent]);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    localStorage.setItem('newsletter_dismissed', Date.now().toString());\n    // Show again after 7 days\n    setTimeout(() => {\n      localStorage.removeItem('newsletter_dismissed');\n    }, 7 * 24 * 60 * 60 * 1000);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      setError('Krlek adj meg egy rvnyes email cmet.');\n      return;\n    }\n\n    try {\n      // Here you would send to your newsletter service\n      if (onSubscribe) {\n        await onSubscribe(email);\n      }\n\n      setIsSubmitted(true);\n      localStorage.setItem('newsletter_subscribed', 'true');\n\n      // Close after 3 seconds\n      setTimeout(() => {\n        setIsVisible(false);\n      }, 3000);\n\n    } catch (err) {\n      setError('Hiba trtnt. Prbld jra ksbb!');\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={handleClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Popup */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[9999] w-[90%] max-w-md\"\n          >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden\">\n              {/* Header */}\n              <div className=\"relative bg-gradient-to-br from-primary-500 to-secondary-700 p-8 text-white\">\n                <button\n                  onClick={handleClose}\n                  className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                  aria-label=\"Bezrs\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n\n                <div className=\"flex items-center justify-center mb-4\">\n                  <div className=\"p-4 bg-white/20 backdrop-blur-sm rounded-full\">\n                    <Gift className=\"w-8 h-8\" />\n                  </div>\n                </div>\n\n                <h2 className=\"text-2xl font-bold text-center mb-2\">\n                  {isSubmitted ? 'Ksznjk!' : '10% KEDVEZMNY'}\n                </h2>\n                <p className=\"text-white/90 text-center text-sm\">\n                  {isSubmitted \n                    ? 'Feliratkoztl a hrlevelnkre!' \n                    : 'Iratkozz fel s kapd meg els vsrlsodhoz!'\n                  }\n                </p>\n              </div>\n\n              {/* Content */}\n              <div className=\"p-6\">\n                {!isSubmitted ? (\n                  <form onSubmit={handleSubmit} className=\"space-y-4\">\n                    {/* Benefits */}\n                    <div className=\"space-y-2 mb-4\">\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Exkluzv ajnlatok</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Korai hozzfrs j termkekhez</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Lakberendezsi tippek</span>\n                      </div>\n                    </div>\n\n                    {/* Email Input */}\n                    <div>\n                      <div className=\"relative\">\n                        <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                        <input\n                          type=\"email\"\n                          value={email}\n                          onChange={(e) => setEmail(e.target.value)}\n                          placeholder=\"Add meg az email cmed\"\n                          className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 outline-none transition-all\"\n                          required\n                        />\n                      </div>\n                      {error && (\n                        <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n                      )}\n                    </div>\n\n                    {/* Submit Button */}\n                    <button\n                      type=\"submit\"\n                      className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-3 rounded-lg transition-colors shadow-lg hover:shadow-xl\"\n                    >\n                      Feliratkozom!\n                    </button>\n\n                    {/* Privacy Notice */}\n                    <p className=\"text-xs text-gray-500 text-center\">\n                      Adataid biztonsgban vannak. Brmikor leiratkozhatsz.\n                    </p>\n                  </form>\n                ) : (\n                  <div className=\"text-center py-4\">\n                    <motion.div\n                      initial={{ scale: 0 }}\n                      animate={{ scale: 1 }}\n                      transition={{ type: 'spring', damping: 15 }}\n                      className=\"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4\"\n                    >\n                      <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                    </motion.div>\n                    <p className=\"text-gray-700 mb-2\">\n                      <strong>{email}</strong>\n                    </p>\n                    <p className=\"text-sm text-gray-600\">\n                      Nzd meg az email fikod a kedvezmny kdrt!\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default SmartNewsletterPopup;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { X, Gift, Timer, Sparkles, ArrowRight, Mail, Check } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ExitIntentPopup - Shows discount offer when user tries to leave\n * Also includes email capture for future marketing\n */\nconst ExitIntentPopup = ({ discountPercent = 10, onClose }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  useScrollLock(isVisible);\n  const [hasShown, setHasShown] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [countdown, setCountdown] = useState(600); // 10 minutes\n\n  const hasShownRef = useRef(false);\n  hasShownRef.current = hasShown;\n\n  // Exit intent detection\n  useEffect(() => {\n    if (sessionStorage.getItem('exitIntentShown')) return;\n\n    const handleMouseLeave = (e) => {\n      if (e.clientY <= 0 && !hasShownRef.current) {\n        hasShownRef.current = true;\n        setIsVisible(true);\n        setHasShown(true);\n        sessionStorage.setItem('exitIntentShown', 'true');\n      }\n    };\n\n    let inactivityTimer;\n    const resetTimer = () => {\n      clearTimeout(inactivityTimer);\n      inactivityTimer = setTimeout(() => {\n        if (!hasShownRef.current) {\n          hasShownRef.current = true;\n          setIsVisible(true);\n          setHasShown(true);\n          sessionStorage.setItem('exitIntentShown', 'true');\n        }\n      }, 45000);\n    };\n\n    document.addEventListener('mouseleave', handleMouseLeave);\n    document.addEventListener('mousemove', resetTimer);\n    document.addEventListener('click', resetTimer);\n    resetTimer();\n\n    return () => {\n      document.removeEventListener('mouseleave', handleMouseLeave);\n      document.removeEventListener('mousemove', resetTimer);\n      document.removeEventListener('click', resetTimer);\n      clearTimeout(inactivityTimer);\n    };\n  }, []);\n\n  // Countdown timer\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const timer = setInterval(() => {\n      setCountdown(prev => {\n        if (prev <= 1) {\n          clearInterval(timer);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [isVisible]);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    if (onClose) onClose();\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (email) {\n      // In real app: send to backend\n      localStorage.setItem('subscribedEmail', email);\n      setIsSubmitted(true);\n      \n      // Copy discount code\n      navigator.clipboard?.writeText(`MARADJ${discountPercent}`);\n      \n      setTimeout(() => {\n        handleClose();\n      }, 3000);\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fade-in\"\n      onClick={handleClose}\n    >\n      <div \n        className=\"relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden animate-scale-in\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors z-10\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n\n        {/* Decorative top section */}\n        <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-8 text-center relative overflow-hidden\">\n          {/* Animated background shapes */}\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob\" />\n            <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000\" />\n          </div>\n\n          <div className=\"relative\">\n            <div className=\"w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n              <Gift className=\"w-10 h-10 text-white\" />\n            </div>\n            <h2 className=\"text-3xl sm:text-4xl font-bold text-white mb-2\">\n              Vrj! Ne menj el!\n            </h2>\n            <p className=\"text-white/90 text-lg\">\n              Itt egy <span className=\"font-bold text-yellow-300\">{discountPercent}% kedvezmny</span> neked!\n            </p>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 sm:p-8\">\n          {!isSubmitted ? (\n            <>\n              {/* Timer */}\n              <div className=\"flex items-center justify-center gap-2 mb-6 text-red-600\">\n                <Timer className=\"w-5 h-5 animate-pulse\" />\n                <span className=\"font-bold text-lg\">\n                  Az ajnlat lejr: {formatTime(countdown)}\n                </span>\n              </div>\n\n              {/* Discount code */}\n              <div className=\"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-dashed border-amber-300 rounded-xl p-4 mb-6 text-center\">\n                <p className=\"text-sm text-gray-600 mb-1\">Kuponkd:</p>\n                <p className=\"text-2xl font-bold text-amber-600 tracking-wider\">\n                  MARADJ{discountPercent}\n                </p>\n              </div>\n\n              {/* Email form */}\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <p className=\"text-center text-gray-600 text-sm\">\n                  Add meg az email cmed s elkldjk a kuponkdot!\n                </p>\n                \n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-2 focus:ring-primary-200 outline-none transition-all text-lg\"\n                    required\n                  />\n                </div>\n\n                <button\n                  type=\"submit\"\n                  className=\"w-full py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-lg rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n                >\n                  <Sparkles className=\"w-5 h-5\" />\n                  Kedvezmny aktivlsa\n                  <ArrowRight className=\"w-5 h-5\" />\n                </button>\n              </form>\n\n              {/* No thanks */}\n              <button\n                onClick={handleClose}\n                className=\"w-full mt-4 py-2 text-gray-500 hover:text-gray-700 text-sm transition-colors\"\n              >\n                Nem, ksznm, inkbb teljes rat fizetek\n              </button>\n            </>\n          ) : (\n            /* Success state */\n            <div className=\"text-center py-8\">\n              <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-10 h-10 text-green-600\" />\n              </div>\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Ksznjk!</h3>\n              <p className=\"text-gray-600 mb-4\">\n                A kuponkd elmentve a vglapra!\n              </p>\n              <div className=\"bg-green-50 border border-green-200 rounded-xl p-4\">\n                <p className=\"text-green-800 font-bold text-xl\">MARADJ{discountPercent}</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes blob {\n          0%, 100% { transform: translate(0, 0) scale(1); }\n          33% { transform: translate(30px, -50px) scale(1.1); }\n          66% { transform: translate(-20px, 20px) scale(0.9); }\n        }\n        .animate-blob { animation: blob 7s infinite; }\n        .animation-delay-2000 { animation-delay: 2s; }\n        .animate-fade-in { animation: fadeIn 0.3s ease-out; }\n        .animate-scale-in { animation: scaleIn 0.3s ease-out; }\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ExitIntentPopup;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Box, Eye, Smartphone, X, AlertCircle } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * ARProductPreview - AR (Augmented Reality) product preview\n * Uses WebXR/AR Quick Look for supported devices\n */\nconst ARProductPreview = ({ product, onClose }) => {\n  useScrollLock(true);\n  const [isARAvailable, setIsARAvailable] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    checkARSupport();\n  }, []);\n\n  const checkARSupport = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Check for AR support\n      // WebXR (Android Chrome, Quest)\n      if ('xr' in navigator) {\n        const isSupported = await navigator.xr.isSessionSupported('immersive-ar');\n        setIsARAvailable(isSupported);\n      }\n      // AR Quick Look (iOS Safari)\n      else if (isIOSSafari()) {\n        setIsARAvailable(true);\n      }\n      // Fallback: no AR support\n      else {\n        setIsARAvailable(false);\n        setError('Az eszkzd nem tmogatja az AR megjelentst.');\n      }\n    } catch (err) {\n      setIsARAvailable(false);\n      setError('Nem sikerlt ellenrizni az AR tmogatst.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const isIOSSafari = () => {\n    const ua = navigator.userAgent;\n    const isIOS = /iPad|iPhone|iPod/.test(ua);\n    const isSafari = /Safari/.test(ua) && !/CriOS|FxiOS|OPiOS|mercury/.test(ua);\n    return isIOS && isSafari;\n  };\n\n  const handleARLaunch = () => {\n    if (!isARAvailable) return;\n\n    // For iOS: AR Quick Look\n    if (isIOSSafari()) {\n      // You would need USDZ file format for iOS AR\n      // Example: product.arModelUSDZ\n      const usdzUrl = product.arModelUSDZ || generateMockUSDZ(product);\n      \n      const anchor = document.createElement('a');\n      anchor.rel = 'ar';\n      anchor.href = usdzUrl;\n      anchor.appendChild(document.createElement('img'));\n      anchor.click();\n    }\n    // For Android: WebXR\n    else if ('xr' in navigator) {\n      launchWebXR();\n    }\n  };\n\n  const sessionEndHandlerRef = useRef(null);\n  const launchWebXR = async () => {\n    try {\n      const session = await navigator.xr.requestSession('immersive-ar', {\n        requiredFeatures: ['hit-test'],\n        optionalFeatures: ['dom-overlay']\n      });\n      const handler = () => { /* Cleanup */ };\n      sessionEndHandlerRef.current = { session, handler };\n      session.addEventListener('end', handler);\n    } catch (err) {\n      setError('Nem sikerlt elindtani az AR nzetet.');\n    }\n  };\n\n  useEffect(() => {\n    return () => {\n      const current = sessionEndHandlerRef.current;\n      if (current?.session && current?.handler) {\n        current.session.removeEventListener('end', current.handler);\n        sessionEndHandlerRef.current = null;\n      }\n    };\n  }, []);\n\n  const generateMockUSDZ = (product) => {\n    // In production, you would have actual 3D models\n    // This is a placeholder that links to a sample USDZ file\n    // You can use services like Sketchfab, poly.google.com (deprecated), or custom 3D models\n    return `https://developer.apple.com/augmented-reality/quick-look/models/biplane/toy_biplane.usdz`;\n  };\n\n  const openInARViewer = () => {\n    // Alternative: Open in a web-based 3D viewer\n    // Using model-viewer web component (Google)\n    window.open(`https://arvr.google.com/scene-viewer?file=${product.arModel || ''}`, '_blank');\n  };\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 lg:top-[60px] bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.9, y: 20 }}\n          animate={{ scale: 1, y: 0 }}\n          exit={{ scale: 0.9, y: 20 }}\n          onClick={(e) => e.stopPropagation()}\n          className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 p-6 text-white relative\">\n            <button\n              onClick={onClose}\n              className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n            \n            <div className=\"flex items-center gap-3 mb-2\">\n              <Box className=\"w-6 h-6\" />\n              <h2 className=\"text-xl font-bold\">AR Elnzet</h2>\n            </div>\n            <p className=\"text-white/90 text-sm\">{product.name}</p>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            {isLoading && (\n              <div className=\"text-center py-8\">\n                <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n                <p className=\"text-gray-600\">AR kpessgek ellenrzse...</p>\n              </div>\n            )}\n\n            {!isLoading && error && (\n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4\">\n                <div className=\"flex items-start gap-3\">\n                  <AlertCircle className=\"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"text-sm text-yellow-800 font-medium mb-2\">{error}</p>\n                    <p className=\"text-xs text-yellow-700\">\n                      Az AR funkci csak iOS Safari vagy Android Chrome bngszben rhet el.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && isARAvailable && (\n              <div className=\"space-y-4\">\n                <div className=\"bg-gradient-to-br from-primary-50 to-secondary-50 rounded-xl p-6 text-center\">\n                  <div className=\"w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg\">\n                    <Eye className=\"w-10 h-10 text-primary-500\" />\n                  </div>\n                  <h3 className=\"font-bold text-gray-900 mb-2\">Nzd meg otthonodban!</h3>\n                  <p className=\"text-sm text-gray-600\">\n                    Helyezd el virtulisan a termket a sajt teremben AR segtsgvel.\n                  </p>\n                </div>\n\n                <button\n                  onClick={handleARLaunch}\n                  className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-4 rounded-xl transition-colors shadow-lg flex items-center justify-center gap-2\"\n                >\n                  <Smartphone className=\"w-5 h-5\" />\n                  AR Indtsa\n                </button>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">1</span>\n                    <span>Engedlyezd a kamera hozzfrst</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">2</span>\n                    <span>Clozd meg a padlt a telefonoddal</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">3</span>\n                    <span>Helyezd el s forgasd a termket</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && !isARAvailable && (\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                  <Smartphone className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <div>\n                  <p className=\"text-gray-600 mb-2\">AR nem elrhet ezen az eszkzn</p>\n                  <p className=\"text-sm text-gray-500\">\n                    Prbld meg iOS Safari vagy Android Chrome bngszbl!\n                  </p>\n                </div>\n                <button\n                  onClick={openInARViewer}\n                  className=\"text-primary-500 hover:text-primary-600 font-medium text-sm\"\n                >\n                  Megnyits web AR nzetben \n                </button>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport default ARProductPreview;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Sparkles, Plus, ShoppingBag, Check, ChevronRight, Package, Percent } from 'lucide-react';\nimport { formatPriceNumber } from '../../utils/helpers';\n\n/**\n * CompleteTheLook - AI-powered bundle suggestions\n * \"Add hozz ezeket is s kapj kedvezmnyt!\"\n */\nconst CompleteTheLook = ({ currentProduct, allProducts, onAddToCart, onViewProduct }) => {\n  const [bundleItems, setBundleItems] = useState([]);\n  const [selectedItems, setSelectedItems] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [bundleTitle, setBundleTitle] = useState('Tedd teljess a szobt');\n\n  useEffect(() => {\n    if (currentProduct && allProducts?.length > 0) {\n      findComplementaryProducts();\n    }\n  }, [currentProduct, allProducts]);\n\n  const findComplementaryProducts = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Kategria s tpus alap prostsok\n      const complementaryMap = {\n        'kanap': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'polc', 'puff'],\n        'lgarnitra': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'tv llvny'],\n        'gy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'tkr', 'szekrny'],\n        'franciagy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'gardrb'],\n        'tkezasztal': ['szk', 'tkez', 'tlal', 'lmpa', 'vitrin'],\n        'asztal': ['szk', 'lmpa', 'polc'],\n        'rasztal': ['forgszk', 'polc', 'lmpa', 'irattart'],\n        'szk': ['asztal', 'tkez'],\n        'fotel': ['dohnyzasztal', 'lmpa', 'puff', 'takar'],\n        'szekrny': ['komd', 'tkr', 'polc'],\n        'tv llvny': ['polc', 'lmpa', 'dohnyzasztal'],\n      };\n\n      const productName = (currentProduct.name || '').toLowerCase();\n      const productCategory = (currentProduct.category || '').toLowerCase();\n      \n      // Keressk meg a megfelel kiegsztket\n      let searchTerms = [];\n      \n      Object.entries(complementaryMap).forEach(([key, complements]) => {\n        if (productName.includes(key) || productCategory.includes(key)) {\n          searchTerms.push(...complements);\n        }\n      });\n\n      // Ha nincs specifikus match, ltalnos kiegsztk\n      if (searchTerms.length === 0) {\n        searchTerms = ['lmpa', 'polc', 'sznyeg', 'dekorci'];\n      }\n\n      // Keress a termkek kztt\n      const currentPrice = currentProduct.salePrice || currentProduct.price || 0;\n      const priceRange = currentPrice * 0.8; // Hasonl rkategria\n      \n      const matches = allProducts\n        .filter(p => {\n          if (p.id === currentProduct.id) return false;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          const pPrice = p.salePrice || p.price || 0;\n          \n          // Ne legyen tl drga\n          if (pPrice > currentPrice * 1.5) return false;\n          \n          // Keressk a kiegsztket\n          return searchTerms.some(term => pName.includes(term) || pCat.includes(term));\n        })\n        .map(p => {\n          let score = 0;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          \n          searchTerms.forEach(term => {\n            if (pName.includes(term)) score += 10;\n            if (pCat.includes(term)) score += 5;\n          });\n          \n          return { product: p, score };\n        })\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 6)\n        .map(m => m.product);\n\n      // Ha van tallat, tegyk be\n      if (matches.length >= 2) {\n        setBundleItems(matches.slice(0, 4));\n        \n        // AI generlt cm\n        const prompt = `rj egy rvid, vonz marketing cmet (max 6 sz) ami arra sztnz, hogy a \"${currentProduct.name}\" mell vegyk meg a kiegsztket is. Magyarul, kreatvan!`;\n        const { generateText } = await import('../../services/geminiService');\n        const result = await generateText(prompt, { temperature: 0.9, maxTokens: 30 });\n        if (result.success && result.text) {\n          setBundleTitle(result.text.replace(/[\"']/g, '').trim());\n        }\n      } else {\n        // Fallback: random npszer termkek\n        const fallbackProducts = allProducts\n          .filter(p => p.id !== currentProduct.id)\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 4);\n        setBundleItems(fallbackProducts);\n      }\n\n    } catch (error) {\n      console.warn('Bundle search error:', error);\n      // Fallback\n      const fallback = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .sort(() => Math.random() - 0.5)\n        .slice(0, 4);\n      setBundleItems(fallback);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const toggleItem = (productId) => {\n    setSelectedItems(prev => \n      prev.includes(productId) \n        ? prev.filter(id => id !== productId)\n        : [...prev, productId]\n    );\n  };\n\n  const formatPrice = (price) => formatPriceNumber(price);\n\n  // Szmtsok\n  const selectedProducts = bundleItems.filter(p => selectedItems.includes(p.id));\n  const bundleOriginalPrice = selectedProducts.reduce((sum, p) => sum + (p.salePrice || p.price || 0), 0);\n  const bundleDiscount = selectedProducts.length >= 2 ? 0.1 : selectedProducts.length >= 3 ? 0.15 : 0; // 10-15% kedvezmny\n  const bundleFinalPrice = bundleOriginalPrice * (1 - bundleDiscount);\n  const savedAmount = bundleOriginalPrice - bundleFinalPrice;\n\n  const handleAddBundle = () => {\n    selectedProducts.forEach(product => {\n      if (onAddToCart) onAddToCart(product);\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 animate-pulse\">\n        <div className=\"h-6 bg-amber-200/50 rounded w-48 mb-4\" />\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n          {[1,2,3,4].map(i => (\n            <div key={i} className=\"bg-white rounded-xl p-3\">\n              <div className=\"aspect-square bg-amber-100 rounded-lg mb-2\" />\n              <div className=\"h-4 bg-amber-100 rounded w-3/4\" />\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (bundleItems.length < 2) return null;\n\n  return (\n    <div className=\"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 rounded-2xl p-5 sm:p-6 border border-amber-200/50 shadow-lg\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-5\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg\">\n            <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-gray-900 text-lg sm:text-xl\">{bundleTitle}</h3>\n            <p className=\"text-amber-700 text-sm\">Vlassz kiegsztket s sprolj!</p>\n          </div>\n        </div>\n        \n        {bundleDiscount > 0 && (\n          <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-1 shadow-lg animate-pulse\">\n            <Percent className=\"w-4 h-4\" />\n            -{Math.round(bundleDiscount * 100)}%\n          </div>\n        )}\n      </div>\n\n      {/* Products Grid */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-5\">\n        {bundleItems.map((product) => {\n          const isSelected = selectedItems.includes(product.id);\n          const price = product.salePrice || product.price || 0;\n          \n          return (\n            <button\n              key={product.id}\n              onClick={() => toggleItem(product.id)}\n              className={`\n                relative bg-white rounded-xl p-3 text-left transition-all duration-300\n                ${isSelected \n                  ? 'ring-2 ring-amber-500 shadow-lg scale-[1.02]' \n                  : 'hover:shadow-md hover:scale-[1.01] border border-gray-100'\n                }\n              `}\n            >\n              {/* Selection indicator */}\n              <div className={`\n                absolute -top-2 -right-2 w-6 h-6 rounded-full flex items-center justify-center transition-all\n                ${isSelected \n                  ? 'bg-amber-500 text-white scale-100' \n                  : 'bg-gray-200 text-gray-400 scale-90'\n                }\n              `}>\n                {isSelected ? <Check className=\"w-4 h-4\" /> : <Plus className=\"w-4 h-4\" />}\n              </div>\n\n              {/* Image */}\n              <div className=\"aspect-square bg-gray-50 rounded-lg mb-2 overflow-hidden\">\n                <img\n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-full h-full object-contain hover:scale-110 transition-transform duration-500\"\n                  onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                />\n              </div>\n\n              {/* Info */}\n              <p className=\"text-xs sm:text-sm font-medium text-gray-800 line-clamp-2 mb-1 leading-tight\">\n                {product.name}\n              </p>\n              <p className=\"text-sm sm:text-base font-bold text-amber-600\">\n                {formatPrice(price)} Ft\n              </p>\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Bundle Summary */}\n      {selectedItems.length > 0 && (\n        <div className=\"bg-white rounded-xl p-4 shadow-inner\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            <div>\n              <p className=\"text-sm text-gray-600 mb-1\">\n                {selectedItems.length} termk kivlasztva\n              </p>\n              <div className=\"flex items-center gap-3\">\n                {bundleDiscount > 0 && (\n                  <span className=\"text-gray-400 line-through text-sm\">\n                    {formatPrice(bundleOriginalPrice)} Ft\n                  </span>\n                )}\n                <span className=\"text-2xl font-bold text-gray-900\">\n                  {formatPrice(Math.round(bundleFinalPrice))} Ft\n                </span>\n              </div>\n              {savedAmount > 0 && (\n                <p className=\"text-green-600 text-sm font-medium mt-1\">\n                   Megtakarts: {formatPrice(Math.round(savedAmount))} Ft\n                </p>\n              )}\n            </div>\n\n            <button\n              onClick={handleAddBundle}\n              className=\"flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all\"\n            >\n              <ShoppingBag className=\"w-5 h-5\" />\n              Mind a kosrba\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Hint when nothing selected */}\n      {selectedItems.length === 0 && (\n        <p className=\"text-center text-amber-700 text-sm py-2\">\n           Kattints a termkekre a kivlasztshoz\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default CompleteTheLook;\n","import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { ZoomIn, ZoomOut, ChevronLeft, ChevronRight, X, Expand, Maximize2 } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ImageGallery - Professional product image gallery\n * Features: Zoom, Swipe, Thumbnails, Fullscreen\n */\nconst ImageGallery = ({ images = [], productName = 'Termk' }) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isZoomed, setIsZoomed] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  useScrollLock(isFullscreen);\n  const [zoomPosition, setZoomPosition] = useState({ x: 50, y: 50 });\n  const [touchStart, setTouchStart] = useState(null);\n  const mainImageRef = useRef(null);\n\n  // Ensure we have at least one image\n  const imageList = images.length > 0 ? images : ['data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" fill=\"%239ca3af\" font-size=\"16\">Nincs kp</text></svg>'];\n  \n  const currentImage = imageList[currentIndex];\n\n  // Navigation\n  const goToNext = useCallback(() => {\n    setCurrentIndex((prev) => (prev + 1) % imageList.length);\n    setIsZoomed(false);\n  }, [imageList.length]);\n\n  const goToPrev = useCallback(() => {\n    setCurrentIndex((prev) => (prev - 1 + imageList.length) % imageList.length);\n    setIsZoomed(false);\n  }, [imageList.length]);\n\n  // Zoom handling\n  const handleMouseMove = (e) => {\n    if (!mainImageRef.current || !isZoomed) return;\n    \n    const rect = mainImageRef.current.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width) * 100;\n    const y = ((e.clientY - rect.top) / rect.height) * 100;\n    \n    setZoomPosition({ x, y });\n  };\n\n  const toggleZoom = () => {\n    setIsZoomed(!isZoomed);\n  };\n\n  // Touch handling for swipe\n  const handleTouchStart = (e) => {\n    setTouchStart(e.touches[0].clientX);\n  };\n\n  const handleTouchEnd = (e) => {\n    if (!touchStart) return;\n    \n    const touchEnd = e.changedTouches[0].clientX;\n    const diff = touchStart - touchEnd;\n    \n    if (Math.abs(diff) > 50) {\n      if (diff > 0) goToNext();\n      else goToPrev();\n    }\n    \n    setTouchStart(null);\n  };\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.key === 'ArrowLeft') goToPrev();\n      if (e.key === 'ArrowRight') goToNext();\n      if (e.key === 'Escape') {\n        setIsFullscreen(false);\n        setIsZoomed(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [goToPrev, goToNext]);\n\n  // Fullscreen Gallery Modal\n  if (isFullscreen) {\n    return (\n      <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black flex items-center justify-center\">\n        {/* Close button */}\n        <button\n          onClick={() => setIsFullscreen(false)}\n          className=\"absolute top-4 right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n\n        {/* Navigation */}\n        {imageList.length > 1 && (\n          <>\n            <button\n              onClick={goToPrev}\n              className=\"absolute left-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n              aria-label=\"Elz kp\"\n            >\n              <ChevronLeft className=\"w-8 h-8\" />\n            </button>\n            <button\n              onClick={goToNext}\n              className=\"absolute right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n              aria-label=\"Kvetkez kp\"\n            >\n              <ChevronRight className=\"w-8 h-8\" />\n            </button>\n          </>\n        )}\n\n        {/* Main Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className=\"max-h-[90vh] max-w-[90vw] object-contain\"\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n        />\n\n        {/* Counter */}\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-white/10 rounded-full text-white text-sm\">\n          {currentIndex + 1} / {imageList.length}\n        </div>\n\n        {/* Thumbnails */}\n        {imageList.length > 1 && (\n          <div className=\"absolute bottom-16 left-1/2 -translate-x-1/2 flex gap-2\">\n            {imageList.map((img, idx) => (\n              <button\n                key={idx}\n                onClick={() => setCurrentIndex(idx)}\n                className={`\n                  w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                  ${idx === currentIndex ? 'border-white scale-110' : 'border-transparent opacity-60 hover:opacity-100'}\n                `}\n              >\n                <img src={img} alt=\"\" className=\"w-full h-full object-cover\" />\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full\">\n      {/* Main Image Container */}\n      <div \n        ref={mainImageRef}\n        className=\"relative aspect-square bg-gray-50 rounded-2xl overflow-hidden cursor-zoom-in group\"\n        onClick={toggleZoom}\n        onMouseMove={handleMouseMove}\n        onMouseLeave={() => setIsZoomed(false)}\n        onTouchStart={handleTouchStart}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className={`\n            w-full h-full object-contain transition-transform duration-300\n            ${isZoomed ? 'scale-[2.5]' : 'group-hover:scale-105'}\n          `}\n          style={isZoomed ? {\n            transformOrigin: `${zoomPosition.x}% ${zoomPosition.y}%`\n          } : {}}\n          onError={(e) => { \n            e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/></svg>'; \n          }}\n          draggable={false}\n        />\n\n        {/* Zoom indicator */}\n        {!isZoomed && (\n          <div className=\"absolute bottom-4 right-4 px-3 py-1.5 bg-black/50 text-white text-xs rounded-full flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n            <ZoomIn className=\"w-4 h-4\" />\n            Kattints a nagytshoz\n          </div>\n        )}\n\n        {/* Navigation arrows */}\n        {imageList.length > 1 && !isZoomed && (\n          <>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToPrev(); }}\n              className=\"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n              aria-label=\"Elz kp\"\n            >\n              <ChevronLeft className=\"w-5 h-5 text-gray-700\" />\n            </button>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToNext(); }}\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n              aria-label=\"Kvetkez kp\"\n            >\n              <ChevronRight className=\"w-5 h-5 text-gray-700\" />\n            </button>\n          </>\n        )}\n\n        {/* Fullscreen button */}\n        <button\n          onClick={(e) => { e.stopPropagation(); setIsFullscreen(true); }}\n          className=\"absolute top-4 right-4 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n          aria-label=\"Teljes kperny\"\n          title=\"Teljes kperny\"\n        >\n          <Maximize2 className=\"w-5 h-5 text-gray-700\" />\n        </button>\n\n        {/* Image counter badge */}\n        {imageList.length > 1 && (\n          <div className=\"absolute top-4 left-4 px-2.5 py-1 bg-black/50 text-white text-xs rounded-full\">\n            {currentIndex + 1} / {imageList.length}\n          </div>\n        )}\n      </div>\n\n      {/* Thumbnails */}\n      {imageList.length > 1 && (\n        <div className=\"flex gap-2 mt-3 overflow-x-auto pb-2 scrollbar-hide\">\n          {imageList.map((img, idx) => (\n            <button\n              key={idx}\n              onClick={() => { setCurrentIndex(idx); setIsZoomed(false); }}\n              className={`\n                flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-xl overflow-hidden border-2 transition-all\n                ${idx === currentIndex \n                  ? 'border-primary-500 ring-2 ring-primary-200' \n                  : 'border-gray-200 hover:border-gray-300 opacity-70 hover:opacity-100'\n                }\n              `}\n            >\n              <img \n                src={img} \n                alt={`Thumbnail ${idx + 1}`}\n                className=\"w-full h-full object-contain bg-gray-50\"\n                onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n              />\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Dots indicator (mobile) */}\n      {imageList.length > 1 && (\n        <div className=\"flex justify-center gap-1.5 mt-3 sm:hidden\">\n          {imageList.map((_, idx) => (\n            <button\n              key={idx}\n              onClick={() => setCurrentIndex(idx)}\n              className={`\n                w-2 h-2 rounded-full transition-all\n                ${idx === currentIndex ? 'bg-primary-500 w-6' : 'bg-gray-300'}\n              `}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageGallery;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Check, AlertTriangle, Truck, Clock, Shield, ChevronUp } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\nimport { useScrollPastY } from '../../hooks/useScrollPosition';\n\n/**\n * StickyAddToCart - Sticky bottom bar for product pages\n * Shows when the product view (modal) is not in viewport, or after scrolling past threshold.\n * Uses shared scroll hook when no observedElementId.\n */\nconst StickyAddToCart = ({ \n  product, \n  onAddToCart, \n  onToggleWishlist, \n  isWishlisted = false,\n  isVisible = true,\n  /** When set, bar is shown only when this element is NOT in viewport (e.g. product modal root) */\n  observedElementId = null\n}) => {\n  const [isShownObserved, setIsShownObserved] = useState(false);\n  const [addedToCart, setAddedToCart] = useState(false);\n  const [quantity, setQuantity] = useState(1);\n  const scrollPast400 = useScrollPastY(400);\n\n  useEffect(() => {\n    if (!observedElementId) return;\n    const el = document.getElementById(observedElementId);\n    if (!el || !(el instanceof Element)) return;\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsShownObserved(!entry.isIntersecting),\n      { threshold: 0.1, root: null }\n    );\n    try {\n      observer.observe(el);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [observedElementId]);\n\n  const isShown = observedElementId ? isShownObserved : scrollPast400;\n\n  if (!product || !isVisible) return null;\n\n  const price = product.salePrice || product.price || 0;\n  const originalPrice = product.originalPrice || (product.salePrice ? product.price : null);\n  const hasDiscount = originalPrice && originalPrice > price;\n  const discountPercent = hasDiscount ? Math.round((1 - price / originalPrice) * 100) : 0;\n  \n  const stockLevel = typeof product.stockLevel === 'number' ? product.stockLevel : null;\n  const isInStock = product.inStock ?? product.in_stock ?? true;\n  const isLowStock = isInStock && stockLevel != null && stockLevel <= 5;\n\n  const handleAddToCart = () => {\n    if (onAddToCart) {\n      onAddToCart(product, quantity);\n    }\n    setAddedToCart(true);\n    \n    // Haptic feedback (if available)\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n    \n    setTimeout(() => setAddedToCart(false), 2000);\n  };\n\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  return (\n    <div \n      className={`\n        fixed bottom-0 left-0 right-0 z-40 transition-all duration-300\n        ${isShown ? 'translate-y-0' : 'translate-y-full'}\n      `}\n      style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }}\n    >\n      {/* Main sticky bar */}\n      <div className=\"bg-white border-t border-gray-200 shadow-2xl\">\n        {/* Stock urgency banner */}\n        {isLowStock && isInStock && (\n          <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 text-white text-center py-1.5 text-sm font-medium flex items-center justify-center gap-2\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            Mr csak {stockLevel} db van raktron!\n          </div>\n        )}\n\n        <div className=\"max-w-7xl mx-auto px-4 py-3.5 flex items-center justify-between gap-4\">\n          {/* Product info - mobile - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex-1 min-w-0 sm:hidden\">\n            <p className=\"text-base font-medium text-gray-900 truncate\">{product.name}</p>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xl font-bold text-primary-500\">{formatPrice(price)}</span>\n              {hasDiscount && (\n                <span className=\"text-sm line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n              )}\n            </div>\n          </div>\n\n          {/* Product info - desktop - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden sm:flex items-center gap-4 flex-1\">\n            <img \n              src={product.images?.[0] || product.image} \n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-gray-50 rounded-lg\"\n            />\n            <div>\n              <p className=\"font-medium text-gray-900 text-base lg:text-lg line-clamp-1\">{product.name}</p>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xl lg:text-2xl font-bold text-primary-500\">{formatPrice(price)}</span>\n                {hasDiscount && (\n                  <>\n                    <span className=\"text-base line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n                    <span className=\"px-2 py-0.5 bg-red-100 text-red-600 text-sm font-bold rounded\">\n                      -{discountPercent}%\n                    </span>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Trust badges - desktop only - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden lg:flex items-center gap-5 text-gray-500 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n              <span>Ingyenes szllts</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5 text-blue-600\" />\n              <span>2 v garancia</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-amber-600\" />\n              <span>24h kiszllts</span>\n            </div>\n          </div>\n\n          {/* Actions - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex items-center gap-3\">\n            {/* Quantity selector - desktop only */}\n            <div className=\"hidden sm:flex items-center border border-gray-200 rounded-xl\">\n              <button \n                onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                -\n              </button>\n              <span className=\"px-4 py-2.5 font-medium min-w-[48px] text-center text-base\">{quantity}</span>\n              <button \n                onClick={() => setQuantity(quantity + 1)}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                +\n              </button>\n            </div>\n\n            {/* Wishlist */}\n            <button\n              onClick={() => onToggleWishlist?.(product.id)}\n              className={`\n                p-3.5 rounded-xl transition-all\n                ${isWishlisted \n                  ? 'bg-red-100 text-red-500' \n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }\n              `}\n            >\n              <Heart className=\"w-6 h-6\" fill={isWishlisted ? 'currentColor' : 'none'} />\n            </button>\n\n            {/* Add to cart */}\n            <button\n              onClick={handleAddToCart}\n              disabled={!isInStock || addedToCart}\n              className={`\n                flex items-center gap-2 px-6 sm:px-7 py-3.5 rounded-xl font-bold text-base transition-all\n                ${addedToCart \n                  ? 'bg-green-500 text-white' \n                  : isInStock \n                    ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white hover:shadow-lg hover:scale-[1.02]'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }\n              `}\n            >\n              {addedToCart ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Hozzadva!</span>\n                </>\n              ) : isInStock ? (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Kosrba</span>\n                </>\n              ) : (\n                <>\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Elfogyott</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Scroll to top button */}\n      <button\n        onClick={scrollToTop}\n        className=\"absolute -top-12 right-4 p-2 bg-white rounded-full shadow-lg border border-gray-200 text-gray-600 hover:text-primary-500 hover:border-primary-300 transition-all\"\n        aria-label=\"Oldal tetejre\"\n      >\n        <ChevronUp className=\"w-5 h-5\" />\n      </button>\n    </div>\n  );\n};\n\nexport default StickyAddToCart;\n","import React, { useState } from 'react';\nimport { Bell, BellRing, Mail, Check, X, TrendingDown, Sparkles } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPriceNumber } from '../../utils/helpers';\n\n/**\n * PriceAlert - \"rtests ha lecskken az r\" feature\n * Saves to localStorage, shows confirmation\n */\nconst PriceAlert = ({ product, variant = 'button' }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [email, setEmail] = useState('');\n  const [targetPrice, setTargetPrice] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [isAlertSet, setIsAlertSet] = useState(() => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    return alerts.some(a => a.productId === product?.id);\n  });\n  useScrollLock(isOpen);\n\n  if (!product) return null;\n\n  const currentPrice = product.salePrice || product.price || 0;\n  const suggestedPrice = Math.floor(currentPrice * 0.85); // 15% kedvezmnyes r\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    \n    const alertData = {\n      productId: product.id,\n      productName: product.name,\n      currentPrice,\n      targetPrice: parseInt(targetPrice) || suggestedPrice,\n      email,\n      createdAt: Date.now()\n    };\n\n    // Save to localStorage\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    filtered.push(alertData);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n\n    setIsSubmitted(true);\n    setIsAlertSet(true);\n\n    setTimeout(() => {\n      setIsOpen(false);\n      setIsSubmitted(false);\n    }, 2000);\n  };\n\n  const removeAlert = () => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n    setIsAlertSet(false);\n  };\n\n  const formatPrice = (p) => formatPriceNumber(p);\n\n  // Button variant\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n          className={`\n            flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all text-sm font-medium\n            ${isAlertSet \n              ? 'bg-amber-100 text-amber-700 hover:bg-amber-200' \n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n            }\n          `}\n        >\n          {isAlertSet ? (\n            <>\n              <BellRing className=\"w-4 h-4\" />\n              rtests belltva\n            </>\n          ) : (\n            <>\n              <Bell className=\"w-4 h-4\" />\n              rcskkens rtest\n            </>\n          )}\n        </button>\n\n        {/* Modal */}\n        {isOpen && (\n          <PriceAlertModal\n            product={product}\n            currentPrice={currentPrice}\n            suggestedPrice={suggestedPrice}\n            email={email}\n            setEmail={setEmail}\n            targetPrice={targetPrice}\n            setTargetPrice={setTargetPrice}\n            isSubmitted={isSubmitted}\n            onSubmit={handleSubmit}\n            onClose={() => setIsOpen(false)}\n            formatPrice={formatPrice}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Inline variant (for product cards)\n  return (\n    <button\n      onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n      className={`\n        p-2 rounded-full transition-all\n        ${isAlertSet \n          ? 'bg-amber-500 text-white' \n          : 'bg-gray-100 text-gray-500 hover:bg-amber-100 hover:text-amber-600'\n        }\n      `}\n      title={isAlertSet ? 'rtests belltva' : 'rcskkens rtest'}\n    >\n      {isAlertSet ? <BellRing className=\"w-4 h-4\" /> : <Bell className=\"w-4 h-4\" />}\n    </button>\n  );\n};\n\n// Modal component\nconst PriceAlertModal = ({\n  product,\n  currentPrice,\n  suggestedPrice,\n  email,\n  setEmail,\n  targetPrice,\n  setTargetPrice,\n  isSubmitted,\n  onSubmit,\n  onClose,\n  formatPrice\n}) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 p-5 text-white relative\">\n          <button\n            onClick={onClose}\n            className=\"absolute top-3 right-3 p-1.5 hover:bg-white/20 rounded-full transition-colors\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n          \n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n              <TrendingDown className=\"w-6 h-6\" />\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold\">rcskkens rtest</h3>\n              <p className=\"text-white/80 text-sm\">Szlunk, ha cskken az r!</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-5\">\n          {!isSubmitted ? (\n            <form onSubmit={onSubmit} className=\"space-y-4\">\n              {/* Product info */}\n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n                <img \n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n                  <p className=\"text-lg font-bold text-primary-500\">{formatPrice(currentPrice)} Ft</p>\n                </div>\n              </div>\n\n              {/* Target price */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  rtests, ha az r ez al cskken:\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={targetPrice}\n                    onChange={(e) => setTargetPrice(e.target.value)}\n                    placeholder={suggestedPrice.toString()}\n                    className=\"w-full pl-4 pr-12 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                  />\n                  <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500\">Ft</span>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Javasolt r: {formatPrice(suggestedPrice)} Ft ({Math.round((1 - suggestedPrice/currentPrice) * 100)}% kedvezmny)\n                </p>\n              </div>\n\n              {/* Email */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  Email cm:\n                </label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                    required\n                  />\n                </div>\n              </div>\n\n              {/* Submit */}\n              <button\n                type=\"submit\"\n                className=\"w-full py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n              >\n                <Bell className=\"w-5 h-5\" />\n                rtests belltsa\n              </button>\n            </form>\n          ) : (\n            /* Success */\n            <div className=\"text-center py-6\">\n              <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-8 h-8 text-green-600\" />\n              </div>\n              <h4 className=\"text-xl font-bold text-gray-900 mb-2\">rtests belltva!</h4>\n              <p className=\"text-gray-600 text-sm\">\n                Emailben rtestnk, ha {formatPrice(parseInt(targetPrice) || suggestedPrice)} Ft al cskken az r.\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PriceAlert;\n","import React, { useState, useEffect, useRef } from 'react';\n\n/**\n * FadeInOnScroll - Animates children when they enter viewport\n */\nexport const FadeInOnScroll = ({ \n  children, \n  direction = 'up', // 'up', 'down', 'left', 'right', 'none'\n  delay = 0,\n  duration = 500,\n  threshold = 0.1,\n  className = ''\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');\n    if (!mq) return undefined;\n    setPrefersReducedMotion(mq.matches);\n    const handler = () => setPrefersReducedMotion(mq.matches);\n    if (typeof mq.addEventListener === 'function') {\n      mq.addEventListener('change', handler);\n      return () => mq.removeEventListener('change', handler);\n    }\n    if (typeof mq.addListener === 'function') {\n      mq.addListener(handler);\n      return () => mq.removeListener(handler);\n    }\n    return undefined;\n  }, []);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el || !(el instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsVisible(true);\n          observer.unobserve(entry.target);\n        }\n      },\n      { threshold }\n    );\n\n    try {\n      observer.observe(el);\n    } catch (err) {\n      return undefined;\n    }\n    return () => observer.disconnect();\n  }, [threshold]);\n\n  const getTransform = () => {\n    if (isVisible || prefersReducedMotion) return 'translate3d(0, 0, 0)';\n    switch (direction) {\n      case 'up': return 'translate3d(0, 30px, 0)';\n      case 'down': return 'translate3d(0, -30px, 0)';\n      case 'left': return 'translate3d(30px, 0, 0)';\n      case 'right': return 'translate3d(-30px, 0, 0)';\n      default: return 'translate3d(0, 0, 0)';\n    }\n  };\n\n  const visible = isVisible || prefersReducedMotion;\n  const transition = prefersReducedMotion ? 'none' : `transform ${duration}ms ease-out ${delay}ms, opacity ${duration}ms ease-out ${delay}ms`;\n\n  return (\n    <div\n      ref={ref}\n      className={className}\n      style={{\n        transform: getTransform(),\n        opacity: visible ? 1 : 0,\n        transition,\n        willChange: prefersReducedMotion || visible ? 'auto' : 'transform, opacity'\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\n/**\n * StaggerChildren - Staggers animation of child elements\n */\nexport const StaggerChildren = ({ \n  children, \n  staggerDelay = 100,\n  direction = 'up',\n  duration = 400,\n  className = ''\n}) => {\n  return (\n    <div className={className}>\n      {React.Children.map(children, (child, index) => (\n        <FadeInOnScroll\n          direction={direction}\n          delay={index * staggerDelay}\n          duration={duration}\n        >\n          {child}\n        </FadeInOnScroll>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Confetti - Celebration animation for add to cart, etc.\n */\nexport const Confetti = ({ isActive, duration = 2000, onComplete }) => {\n  const [particles, setParticles] = useState([]);\n  const canvasRef = useRef(null);\n\n  useEffect(() => {\n    if (!isActive) return;\n\n    // Generate confetti particles\n    const newParticles = Array.from({ length: 50 }, (_, i) => ({\n      id: i,\n      x: Math.random() * 100,\n      y: -10,\n      size: Math.random() * 8 + 4,\n      color: ['#6366f1', '#a855f7', '#ec4899', '#f59e0b', '#10b981', '#3b82f6'][Math.floor(Math.random() * 6)],\n      speedX: (Math.random() - 0.5) * 3,\n      speedY: Math.random() * 3 + 2,\n      rotation: Math.random() * 360,\n      rotationSpeed: (Math.random() - 0.5) * 10\n    }));\n\n    setParticles(newParticles);\n\n    const timeout = setTimeout(() => {\n      setParticles([]);\n      if (onComplete) onComplete();\n    }, duration);\n\n    return () => clearTimeout(timeout);\n  }, [isActive, duration, onComplete]);\n\n  useEffect(() => {\n    if (particles.length === 0) return;\n\n    let animationFrame;\n    const animate = () => {\n      setParticles(prev => \n        prev.map(p => ({\n          ...p,\n          y: p.y + p.speedY,\n          x: p.x + p.speedX,\n          rotation: p.rotation + p.rotationSpeed\n        })).filter(p => p.y < 110)\n      );\n      animationFrame = requestAnimationFrame(animate);\n    };\n\n    animationFrame = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationFrame);\n  }, [particles.length > 0]);\n\n  if (particles.length === 0) return null;\n\n  return (\n    <div className=\"fixed inset-0 pointer-events-none z-[200] overflow-hidden\">\n      {particles.map(p => (\n        <div\n          key={p.id}\n          className=\"absolute\"\n          style={{\n            left: `${p.x}%`,\n            top: `${p.y}%`,\n            width: p.size,\n            height: p.size,\n            backgroundColor: p.color,\n            transform: `rotate(${p.rotation}deg)`,\n            borderRadius: Math.random() > 0.5 ? '50%' : '0',\n            opacity: 1 - (p.y / 110)\n          }}\n        />\n      ))}\n    </div>\n  );\n};\n\n/**\n * PulseButton - Button with pulse animation\n */\nexport const PulseButton = ({ children, className = '', ...props }) => {\n  return (\n    <button \n      className={`relative ${className}`}\n      {...props}\n    >\n      <span className=\"absolute inset-0 rounded-xl bg-current opacity-20 animate-ping\" />\n      {children}\n    </button>\n  );\n};\n\n/**\n * ShimmerText - Text with shimmer effect\n */\nexport const ShimmerText = ({ children, className = '' }) => {\n  return (\n    <span \n      className={`relative inline-block ${className}`}\n      style={{\n        background: 'linear-gradient(90deg, currentColor 0%, #a78bfa 50%, currentColor 100%)',\n        backgroundSize: '200% 100%',\n        WebkitBackgroundClip: 'text',\n        WebkitTextFillColor: 'transparent',\n        animation: 'shimmer 2s linear infinite'\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes shimmer {\n          0% { background-position: 200% 0; }\n          100% { background-position: -200% 0; }\n        }\n      `}</style>\n    </span>\n  );\n};\n\n/**\n * FloatingElement - Gentle floating animation\n */\nexport const FloatingElement = ({ children, className = '', amplitude = 10, duration = 3 }) => {\n  return (\n    <div \n      className={className}\n      style={{\n        animation: `float ${duration}s ease-in-out infinite`\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes float {\n          0%, 100% { transform: translateY(0px); }\n          50% { transform: translateY(-${amplitude}px); }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n/**\n * CountUp - Animated number counter\n */\nexport const CountUp = ({ end, duration = 2000, prefix = '', suffix = '', className = '' }) => {\n  const [count, setCount] = useState(0);\n  const [hasStarted, setHasStarted] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    if (!ref.current || !(ref.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted) {\n          setHasStarted(true);\n        }\n      },\n      { threshold: 0.5 }\n    );\n\n    try {\n      observer.observe(ref.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [hasStarted]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    let startTime;\n    const animate = (timestamp) => {\n      if (!startTime) startTime = timestamp;\n      const progress = Math.min((timestamp - startTime) / duration, 1);\n      \n      // Easing function\n      const easeOut = 1 - Math.pow(1 - progress, 3);\n      setCount(Math.floor(easeOut * end));\n\n      if (progress < 1) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }, [hasStarted, end, duration]);\n\n  return (\n    <span ref={ref} className={className}>\n      {prefix}{count.toLocaleString('hu-HU')}{suffix}\n    </span>\n  );\n};\n\n/**\n * ProgressBar - Animated progress bar\n */\nexport const ProgressBar = ({ progress, className = '', color = 'primary' }) => {\n  const [width, setWidth] = useState(0);\n\n  useEffect(() => {\n    const timeout = setTimeout(() => setWidth(progress), 100);\n    return () => clearTimeout(timeout);\n  }, [progress]);\n\n  return (\n    <div className={`h-2 bg-gray-200 rounded-full overflow-hidden ${className}`}>\n      <div \n        className={`h-full bg-gradient-to-r from-${color}-500 to-${color}-500 rounded-full transition-all duration-1000 ease-out`}\n        style={{ width: `${width}%` }}\n      />\n    </div>\n  );\n};\n\nexport default {\n  FadeInOnScroll,\n  StaggerChildren,\n  Confetti,\n  PulseButton,\n  ShimmerText,\n  FloatingElement,\n  CountUp,\n  ProgressBar\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { X, ChevronDown } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * BottomSheet - iOS-style bottom sheet modal\n * Supports drag to close, snap points, and swipe gestures\n */\nconst BottomSheet = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  snapPoints = [0.5, 0.9], // Percentage of screen height\n  initialSnap = 0,\n  showHandle = true,\n  showClose = true\n}) => {\n  const [currentSnap, setCurrentSnap] = useState(initialSnap);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState(0);\n  const [touchStartY, setTouchStartY] = useState(0);\n  const sheetRef = useRef(null);\n  const contentRef = useRef(null);\n  useScrollLock(isOpen);\n\n  useEffect(() => {\n    if (isOpen) {\n      setCurrentSnap(initialSnap);\n      setDragOffset(0);\n    }\n  }, [isOpen, initialSnap]);\n\n  const getSheetHeight = () => {\n    const snapHeight = snapPoints[currentSnap] * 100;\n    return `${snapHeight}vh`;\n  };\n\n  const handleTouchStart = (e) => {\n    // Only allow drag from handle area\n    if (e.target.closest('.sheet-content') && contentRef.current?.scrollTop > 0) {\n      return;\n    }\n    setTouchStartY(e.touches[0].clientY);\n    setIsDragging(true);\n  };\n\n  const handleTouchMove = (e) => {\n    if (!isDragging) return;\n    \n    const currentY = e.touches[0].clientY;\n    const diff = currentY - touchStartY;\n    \n    // Only allow dragging down\n    if (diff > 0) {\n      setDragOffset(diff);\n    } else {\n      // Allow dragging up to expand\n      setDragOffset(diff * 0.3); // Resistance when dragging up\n    }\n  };\n\n  const handleTouchEnd = () => {\n    if (!isDragging) return;\n    setIsDragging(false);\n\n    const threshold = 100;\n    \n    if (dragOffset > threshold) {\n      // Dragged down enough - close or snap to lower point\n      if (currentSnap === 0) {\n        onClose();\n      } else {\n        setCurrentSnap(currentSnap - 1);\n      }\n    } else if (dragOffset < -threshold && currentSnap < snapPoints.length - 1) {\n      // Dragged up - snap to higher point\n      setCurrentSnap(currentSnap + 1);\n    }\n    \n    setDragOffset(0);\n  };\n\n  const triggerHaptic = () => {\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[80] md:hidden\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 bg-black transition-opacity duration-300 ${isDragging ? 'opacity-40' : 'opacity-50'}`}\n        onClick={onClose}\n      />\n      \n      {/* Sheet */}\n      <div\n        ref={sheetRef}\n        className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl transition-all duration-300 ease-out\"\n        style={{\n          height: getSheetHeight(),\n          transform: `translateY(${Math.max(0, dragOffset)}px)`,\n          transitionProperty: isDragging ? 'none' : 'all'\n        }}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Handle */}\n        {showHandle && (\n          <div className=\"flex justify-center py-3 cursor-grab active:cursor-grabbing\">\n            <div className=\"w-12 h-1.5 bg-gray-300 rounded-full\" />\n          </div>\n        )}\n\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-5 pb-4 border-b border-gray-100\">\n          <h3 className=\"text-lg font-bold text-gray-900\">{title}</h3>\n          {showClose && (\n            <button\n              onClick={onClose}\n              className=\"p-2 -mr-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n\n        {/* Content */}\n        <div \n          ref={contentRef}\n          className=\"sheet-content flex-1 overflow-y-auto overscroll-contain\"\n          style={{ maxHeight: `calc(${getSheetHeight()} - 100px)` }}\n        >\n          {children}\n        </div>\n\n        {/* Safe area padding for iOS */}\n        <div style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }} />\n      </div>\n    </div>\n  );\n};\n\n/**\n * FilterBottomSheet - Pre-styled filter sheet\n */\nexport const FilterBottomSheet = ({\n  isOpen,\n  onClose,\n  filters,\n  activeFilters,\n  onFilterChange,\n  onClearAll,\n  onApply\n}) => {\n  return (\n    <BottomSheet isOpen={isOpen} onClose={onClose} title=\"Szrk\" snapPoints={[0.7, 0.9]}>\n      <div className=\"p-5 space-y-6\">\n        {/* Active filters count */}\n        {Object.keys(activeFilters).length > 0 && (\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-gray-600\">\n              {Object.keys(activeFilters).length} szr aktv\n            </span>\n            <button\n              onClick={onClearAll}\n              className=\"text-sm text-primary-500 font-medium\"\n            >\n              sszes trlse\n            </button>\n          </div>\n        )}\n\n        {/* Filter sections */}\n        {filters.map((filter) => (\n          <FilterSection\n            key={filter.id}\n            filter={filter}\n            value={activeFilters[filter.id]}\n            onChange={(value) => onFilterChange(filter.id, value)}\n          />\n        ))}\n\n        {/* Apply button */}\n        <button\n          onClick={onApply}\n          className=\"w-full py-4 bg-primary-500 text-white font-bold rounded-xl hover:bg-primary-600 transition-colors\"\n        >\n          Szrk alkalmazsa\n        </button>\n      </div>\n    </BottomSheet>\n  );\n};\n\nconst FilterSection = ({ filter, value, onChange }) => {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  return (\n    <div className=\"border-b border-gray-100 pb-4\">\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between py-2\"\n      >\n        <span className=\"font-medium text-gray-900\">{filter.label}</span>\n        <ChevronDown className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\n      </button>\n      \n      {isExpanded && (\n        <div className=\"mt-3 space-y-2\">\n          {filter.type === 'checkbox' && filter.options?.map((option) => (\n            <label key={option.value} className=\"flex items-center gap-3 py-2\">\n              <input\n                type=\"checkbox\"\n                checked={value?.includes(option.value)}\n                onChange={(e) => {\n                  const newValue = e.target.checked\n                    ? [...(value || []), option.value]\n                    : (value || []).filter(v => v !== option.value);\n                  onChange(newValue);\n                }}\n                className=\"w-5 h-5 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n              />\n              <span className=\"text-gray-700\">{option.label}</span>\n              {option.count && (\n                <span className=\"text-gray-400 text-sm ml-auto\">({option.count})</span>\n              )}\n            </label>\n          ))}\n          \n          {filter.type === 'range' && (\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Min</label>\n                  <input\n                    type=\"number\"\n                    value={value?.min || ''}\n                    onChange={(e) => onChange({ ...value, min: e.target.value })}\n                    placeholder={filter.min?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Max</label>\n                  <input\n                    type=\"number\"\n                    value={value?.max || ''}\n                    onChange={(e) => onChange({ ...value, max: e.target.value })}\n                    placeholder={filter.max?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BottomSheet;\n","import React, { useState } from 'react';\nimport { X, Heart, Trash2, ShoppingCart, Share2, ChevronRight, Sparkles, Package } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * WishlistDrawer - Slide-in sidebar showing all wishlist items\n * Features: Remove items, add all to cart, share wishlist, AI recommendations\n */\nconst WishlistDrawer = ({ \n  isOpen, \n  onClose, \n  wishlistItems = [], \n  onRemove, \n  onAddToCart, \n  onProductClick,\n  onClearAll \n}) => {\n  const [isClosing, setIsClosing] = useState(false);\n  useScrollLock(isOpen);\n\n  const handleClose = () => {\n    setIsClosing(true);\n    setTimeout(() => {\n      setIsClosing(false);\n      onClose();\n    }, 300);\n  };\n\n  const totalValue = wishlistItems.reduce((sum, item) => sum + (item.salePrice || item.price || 0), 0);\n\n  const handleShare = async () => {\n    const text = `Nzd meg a kvnsglistmat! ${wishlistItems.length} termk, sszesen ${formatPrice(totalValue)}`;\n    \n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: 'Kvnsglistm - Marketly.AI',\n          text,\n          url: window.location.href\n        });\n      } catch (err) {\n        console.log('Share cancelled');\n      }\n    } else {\n      // Fallback: copy to clipboard\n      try {\n        if (navigator.clipboard?.writeText) {\n          await navigator.clipboard.writeText(text + ' ' + window.location.href);\n          alert('Link msolva a vglapra!');\n        } else {\n          alert('Nem sikerlt msolni. Prbld meg manulisan.');\n        }\n      } catch {\n        alert('Nem sikerlt msolni. Prbld meg manulisan.');\n      }\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[9999]\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 lg:top-[60px] bg-black transition-opacity duration-300 ${isClosing ? 'opacity-0' : 'opacity-50'}`}\n        onClick={handleClose}\n      />\n\n      {/* Drawer */}\n      <div \n        className={`\n          absolute top-0 lg:top-[60px] right-0 h-full lg:h-[calc(100vh-60px)] w-full max-w-md bg-white shadow-2xl\n          transition-transform duration-300 ease-out\n          ${isClosing ? 'translate-x-full' : 'translate-x-0'}\n        `}\n      >\n        {/* Header - UNIFIED TYPOGRAPHY */}\n        <div className=\"bg-gradient-to-r from-pink-500 to-red-500 p-5 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n                <Heart className=\"w-6 h-6\" fill=\"white\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl sm:text-2xl font-bold\">Kvnsglista</h2>\n                <p className=\"text-white/80 text-sm sm:text-base\">{wishlistItems.length} termk</p>\n              </div>\n            </div>\n            <button\n              onClick={handleClose}\n              className=\"p-2 hover:bg-white/20 rounded-full transition-colors\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex flex-col h-[calc(100%-180px)] overflow-hidden\">\n          {wishlistItems.length === 0 ? (\n            /* Empty state - UNIFIED TYPOGRAPHY */\n            <div className=\"flex-1 flex flex-col items-center justify-center p-8 text-center\">\n              <div className=\"w-24 h-24 bg-pink-50 rounded-full flex items-center justify-center mb-4\">\n                <Heart className=\"w-12 h-12 text-pink-300\" />\n              </div>\n              <h3 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">res a kvnsglista</h3>\n              <p className=\"text-base text-gray-500 mb-6\">Adj hozz termkeket a szv ikonra kattintva!</p>\n              <button\n                onClick={handleClose}\n                className=\"px-6 py-3 bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                Bngszs\n              </button>\n            </div>\n          ) : (\n            /* Items list */\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n              {wishlistItems.map((item, index) => (\n                <div \n                  key={item.id}\n                  className=\"bg-white border border-gray-100 rounded-xl p-3 shadow-sm hover:shadow-md transition-all group\"\n                  style={{ animationDelay: `${index * 50}ms` }}\n                >\n                  <div className=\"flex gap-3\">\n                    {/* Image */}\n                    <div \n                      className=\"w-20 h-20 bg-gray-50 rounded-lg overflow-hidden cursor-pointer shrink-0\"\n                      onClick={() => {\n                        onProductClick?.(item);\n                        handleClose();\n                      }}\n                    >\n                      <img\n                        src={item.images?.[0] || item.image}\n                        alt={item.name}\n                        className=\"w-full h-full object-contain group-hover:scale-110 transition-transform\"\n                        onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                      />\n                    </div>\n\n                    {/* Info - UNIFIED TYPOGRAPHY */}\n                    <div className=\"flex-1 min-w-0\">\n                      <p \n                        className=\"font-medium text-gray-900 text-sm sm:text-base line-clamp-2 cursor-pointer hover:text-primary-500 transition-colors\"\n                        onClick={() => {\n                          onProductClick?.(item);\n                          handleClose();\n                        }}\n                      >\n                        {item.name}\n                      </p>\n                      <p className=\"text-lg sm:text-xl font-bold text-primary-500 mt-1\">\n                        {formatPrice(item.salePrice || item.price)}\n                      </p>\n                      \n                      {/* Actions */}\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <button\n                          onClick={() => onAddToCart?.(item)}\n                          className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-primary-500 text-white text-sm font-bold rounded-lg hover:bg-primary-600 transition-colors\"\n                        >\n                          <ShoppingCart className=\"w-4 h-4\" />\n                          Kosrba\n                        </button>\n                        <button\n                          onClick={() => onRemove?.(item.id)}\n                          className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                          title=\"Eltvolts\"\n                        >\n                          <Trash2 className=\"w-5 h-5\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer - UNIFIED TYPOGRAPHY */}\n        {wishlistItems.length > 0 && (\n          <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 space-y-3\">\n            {/* Total */}\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-base text-gray-600\">sszrtk:</span>\n              <span className=\"text-2xl font-bold text-gray-900\">{formatPrice(totalValue)}</span>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-2\">\n              <button\n                onClick={handleShare}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 border-2 border-gray-200 text-gray-700 font-bold text-sm sm:text-base rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <Share2 className=\"w-5 h-5\" />\n                Megoszts\n              </button>\n              <button\n                onClick={() => {\n                  wishlistItems.forEach(item => onAddToCart?.(item));\n                }}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-sm sm:text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                <ShoppingCart className=\"w-5 h-5\" />\n                Mind a kosrba\n              </button>\n            </div>\n\n            {/* Clear all */}\n            <button\n              onClick={onClearAll}\n              className=\"w-full text-center text-sm sm:text-base text-gray-400 hover:text-red-500 transition-colors py-2\"\n            >\n              Lista trlse\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default WishlistDrawer;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Zap, Clock, ArrowRight, X, Flame, ChevronLeft, ChevronRight } from 'lucide-react';\n\n/**\n * FlashSaleBanner - Impactful, urgent sale banner\n * Clear message: SALE + TIME + ACTION\n */\nconst FLASH_DISMISS_KEY = 'mkt_flash_dismissed_date';\n\nfunction getTodayKey() {\n  const d = new Date();\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\nconst FLASH_OFFERS = [\n  { title: ' Flash Sale!', badge: '-50%', text: 'Akr 50% kedvezmny kivlasztott btorokra', cta: 'Megnzem az akcikat', ctaShort: 'Megnzem', bg: 'from-red-600 via-orange-500 to-amber-500', ctaColor: 'text-red-600' },\n  { title: ' Megtakartsok', badge: 'OLCSBB', text: 'Kanapk, gyak, szekrnyek  ma legolcsbban', cta: 'Nzd meg a kedvezmnyeket', ctaShort: 'Nzd meg', bg: 'from-rose-600 via-pink-500 to-amber-500', ctaColor: 'text-rose-600' },\n  { title: ' Ingyenes szllts', badge: '50e+', text: 'Ingyenes szllts 50.000 Ft felett', cta: 'Vsrls most', ctaShort: 'Vsrolj', bg: 'from-emerald-600 via-teal-500 to-cyan-500', ctaColor: 'text-emerald-700' },\n  { title: ' Csak ma!', badge: 'SIESS', text: 'Korltozott id  ne maradj le', cta: 'Nem hagyom ki', ctaShort: 'Nem hagyom ki', bg: 'from-orange-600 via-red-500 to-rose-600', ctaColor: 'text-orange-600' },\n];\n\nconst FlashSaleBanner = ({ \n  endTime,\n  title = 'Flash Sale',\n  subtitle,\n  onViewSale,\n  onDismiss,\n  variant = 'banner'\n}) => {\n  const [timeLeft, setTimeLeft] = useState(calculateTimeLeft());\n  const [offerIndex, setOfferIndex] = useState(0);\n  const [isPaused, setIsPaused] = useState(false);\n  const touchStartX = useRef(0);\n  const currentOffer = FLASH_OFFERS[offerIndex];\n  const displayTitle = currentOffer.title;\n  const displaySubtitle = currentOffer.text;\n  const displayCta = currentOffer.cta;\n  const displayCtaShort = currentOffer.ctaShort;\n  const bgGradient = currentOffer.bg;\n  const ctaColor = currentOffer.ctaColor || 'text-red-600';\n  const [isDismissed, setIsDismissed] = useState(() => {\n    if (typeof sessionStorage === 'undefined') return false;\n    return sessionStorage.getItem(FLASH_DISMISS_KEY) === getTodayKey();\n  });\n  const [isExpired, setIsExpired] = useState(false);\n\n  function calculateTimeLeft() {\n    const end = endTime instanceof Date ? endTime : new Date(endTime);\n    const diff = end - new Date();\n    if (diff <= 0) return { hours: 0, minutes: 0, seconds: 0 };\n    return {\n      hours: Math.floor(diff / (1000 * 60 * 60)),\n      minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),\n      seconds: Math.floor((diff % (1000 * 60)) / 1000)\n    };\n  }\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const newTime = calculateTimeLeft();\n      setTimeLeft(newTime);\n      if (newTime.hours === 0 && newTime.minutes === 0 && newTime.seconds === 0) {\n        setIsExpired(true);\n        clearInterval(timer);\n      }\n    }, 1000);\n    return () => clearInterval(timer);\n  }, [endTime]);\n\n  useEffect(() => {\n    if (isPaused) return;\n    const offerTimer = setInterval(() => {\n      setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    }, 4500);\n    return () => clearInterval(offerTimer);\n  }, [isPaused]);\n\n  const goToOffer = (idx) => {\n    setOfferIndex(idx);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleTouchStart = (e) => {\n    touchStartX.current = e.touches?.[0]?.clientX ?? e.clientX;\n    setIsPaused(true);\n  };\n\n  const handleTouchEnd = (e) => {\n    const endX = e.changedTouches?.[0]?.clientX ?? e.clientX;\n    const diff = touchStartX.current - endX;\n    if (Math.abs(diff) > 50) {\n      if (diff > 0) {\n        setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n      } else {\n        setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n      }\n    }\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handlePrev = () => {\n    setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleNext = () => {\n    setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleDismiss = () => {\n    try {\n      sessionStorage.setItem(FLASH_DISMISS_KEY, getTodayKey());\n    } catch (_) {}\n    setIsDismissed(true);\n    onDismiss?.();\n  };\n\n  if (isDismissed || isExpired) return null;\n\n  const pad = (n) => String(n).padStart(2, '0');\n\n  /* Time-left progress: assume 24h sale duration so bar shrinks as time runs out */\n  const TOTAL_SALE_MS = 24 * 60 * 60 * 1000;\n  const remainingMs = timeLeft.hours * 3600000 + timeLeft.minutes * 60000 + timeLeft.seconds * 1000;\n  const timeLeftProgress = Math.min(100, (remainingMs / TOTAL_SALE_MS) * 100);\n\n  return (\n    <div\n      className={`relative bg-gradient-to-r ${bgGradient} overflow-hidden rounded-xl sm:rounded-2xl shadow-xl transition-all duration-500`}\n      onTouchStart={handleTouchStart}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Animated shine effect */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/15 to-transparent -skew-x-12 animate-[shimmer_3s_infinite]\" \n          style={{ animation: 'shimmer 3s infinite', transform: 'translateX(-100%)' }} />\n      </div>\n\n      {/* Decorative: subtle floating orbs */}\n      <div className=\"absolute top-1/4 right-1/4 w-24 h-24 rounded-full bg-white/5 blur-2xl pointer-events-none\" aria-hidden />\n      <div className=\"absolute bottom-1/3 left-1/4 w-16 h-16 rounded-full bg-white/10 blur-xl pointer-events-none\" aria-hidden />\n\n      {/* Dismiss  egyetlen gomb, absolute top-right */}\n      <button\n        type=\"button\"\n        onClick={handleDismiss}\n        className=\"absolute top-4 right-4 z-20 min-w-[44px] min-h-[44px] flex items-center justify-center p-2 text-white/60 hover:text-white rounded-full hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Banner elrejtse ma\"\n      >\n        <X className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n      </button>\n\n      {/* Egyetlen responsive layout  flex-col mobil, flex-row desktop */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 lg:gap-6 px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6 pr-14 min-h-[200px] sm:min-h-0 pb-16 sm:pb-5 max-w-[1200px] mx-auto\">\n        {/* Bal: Icon + Title + Badge + Subtitle (desktop) */}\n        <div className=\"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink\">\n          <div className=\"w-8 h-8 sm:w-10 sm:h-10 lg:w-11 lg:h-11 bg-white/20 backdrop-blur-sm rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0\">\n            <Flame className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white animate-pulse\" />\n          </div>\n          <div className=\"min-w-0 flex-1\">\n            <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n              <span key={`title-${offerIndex}`} className=\"font-black text-white text-sm sm:text-base lg:text-lg flash-offer-enter inline-block\">{displayTitle}</span>\n              <span className=\"px-1.5 sm:px-2 py-0.5 bg-yellow-400 text-yellow-900 text-[10px] sm:text-xs font-black rounded sm:rounded-md animate-pulse shrink-0\">\n                {currentOffer.badge}\n              </span>\n            </div>\n            <p key={`sub-${offerIndex}`} className=\"text-white/80 text-xs lg:text-sm flash-offer-enter line-clamp-2 mt-0.5 hidden sm:block\">{displaySubtitle}</p>\n          </div>\n        </div>\n\n        {/* Kzp: Countdown  rvid cmkk (, p, mp) mindkt nzetben */}\n        <div className=\"flex items-center justify-center sm:justify-start gap-1 sm:gap-2\">\n          <Clock className=\"w-4 h-4 sm:w-5 sm:h-5 text-white/80 flex-shrink-0\" />\n          <span className=\"text-white/80 sm:text-white/90 text-xs sm:text-sm font-medium mr-1 sm:mr-0\">Lejr:</span>\n          <div className=\"flex items-center gap-1\">\n            {[\n              { value: timeLeft.hours, label: '' },\n              { value: timeLeft.minutes, label: 'p' },\n              { value: timeLeft.seconds, label: 'mp' }\n            ].map((unit, idx) => (\n              <React.Fragment key={idx}>\n                <div className=\"bg-black/30 backdrop-blur-sm rounded sm:rounded-lg px-2 sm:px-2.5 lg:px-3 py-1 sm:py-1.5\">\n                  <span className=\"flash-countdown-digit text-white font-black text-lg sm:text-xl lg:text-2xl tabular-nums inline-block\">{pad(unit.value)}</span>\n                  <span className=\"text-white/70 text-[10px] lg:text-xs ml-0.5 sm:ml-1\">{unit.label}</span>\n                </div>\n                {idx < 2 && <span className=\"text-white/40 font-bold\">:</span>}\n              </React.Fragment>\n            ))}\n          </div>\n        </div>\n\n        {/* Jobb: CTA  full width mobil, auto desktop */}\n        <button\n          type=\"button\"\n          onClick={onViewSale}\n          className={`w-full sm:w-auto min-h-[44px] flex items-center justify-center gap-2 px-4 sm:px-5 lg:px-6 py-3 sm:py-2.5 bg-white ${ctaColor} font-bold text-sm sm:text-base rounded-lg sm:rounded-xl shadow-lg hover:shadow-xl active:scale-[0.98] sm:hover:scale-[1.02] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-current`}\n          aria-label={displayCta}\n        >\n          <Zap className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n          <span key={offerIndex} className=\"animate-fade-in sm:hidden\">{displayCta}</span>\n          <span key={`short-${offerIndex}`} className=\"animate-fade-in hidden sm:inline\">{displayCtaShort}</span>\n          <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n        </button>\n      </div>\n\n      {/* Dots  egyetlen sor, absolute mobil (progress fltt), normal flow desktop */}\n      <div className=\"absolute bottom-10 sm:static left-0 right-0 flex justify-center gap-2 py-0 sm:py-4 z-10\" role=\"tablist\" aria-label=\"Ajnlat vltsa\">\n        {FLASH_OFFERS.map((_, i) => (\n          <button\n            key={i}\n            type=\"button\"\n            role=\"tab\"\n            aria-selected={offerIndex === i}\n            onClick={() => goToOffer(i)}\n            className={`w-3 h-3 rounded-full transition-all duration-200 min-w-[12px] min-h-[12px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-600 ${\n              offerIndex === i ? 'bg-white scale-125 shadow-lg' : 'bg-white/50 hover:bg-white/80'\n            }`}\n            aria-label={`Ajnlat ${i + 1}`}\n          />\n        ))}\n      </div>\n\n      {/* Desktop: nyilak */}\n      <button\n        type=\"button\"\n        onClick={handlePrev}\n        className=\"hidden sm:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Elz ajnlat\"\n      >\n        <ChevronLeft className=\"w-5 h-5\" />\n      </button>\n      <button\n        type=\"button\"\n        onClick={handleNext}\n        className=\"hidden sm:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Kvetkez ajnlat\"\n      >\n        <ChevronRight className=\"w-5 h-5\" />\n      </button>\n\n      {/* Time-left progress bar  shrinks as countdown runs out */}\n      <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-black/20\" aria-hidden=\"true\">\n        <div className=\"h-full bg-white/60 transition-[width] duration-1000 ease-linear\" style={{ width: `${timeLeftProgress}%` }} />\n      </div>\n\n      <style>{`\n        @keyframes shimmer {\n          0% { transform: translateX(-100%) skewX(-12deg); }\n          100% { transform: translateX(200%) skewX(-12deg); }\n        }\n        @keyframes flash-slide-in {\n          from { opacity: 0; transform: translateX(12px); }\n          to { opacity: 1; transform: translateX(0); }\n        }\n        .flash-offer-enter {\n          animation: flash-slide-in 0.35s ease-out forwards;\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default FlashSaleBanner;\n","import React, { useState, useMemo } from 'react';\nimport { Truck, Clock, MapPin, CheckCircle, Package, Calendar, Zap, Info } from 'lucide-react';\n\n/**\n * DeliveryEstimator - Shows estimated delivery date based on location\n * Features: Postal code lookup, express delivery option, store pickup\n */\nconst DeliveryEstimator = ({ \n  product, \n  variant = 'compact' // 'compact' | 'full'\n}) => {\n  const [postalCode, setPostalCode] = useState('');\n  const [isChecking, setIsChecking] = useState(false);\n  const [deliveryInfo, setDeliveryInfo] = useState(null);\n\n  // Simulated delivery calculation\n  const calculateDelivery = (code) => {\n    setIsChecking(true);\n    \n    // Simulate API call\n    setTimeout(() => {\n      const isBudapest = code.startsWith('1');\n      const isLargeCity = ['2', '3', '4', '5', '6', '7', '8', '9'].some(n => code.startsWith(n) && parseInt(code) < 5000);\n      \n      const today = new Date();\n      const standardDays = isBudapest ? 2 : isLargeCity ? 3 : 5;\n      const expressDays = isBudapest ? 1 : 2;\n      \n      const standardDate = new Date(today);\n      standardDate.setDate(standardDate.getDate() + standardDays);\n      \n      const expressDate = new Date(today);\n      expressDate.setDate(expressDate.getDate() + expressDays);\n\n      setDeliveryInfo({\n        postalCode: code,\n        city: isBudapest ? 'Budapest' : isLargeCity ? 'Nagyvros' : 'Vidk',\n        standard: {\n          date: standardDate,\n          days: standardDays,\n          price: 0, // Free\n          available: true\n        },\n        express: {\n          date: expressDate,\n          days: expressDays,\n          price: 2990,\n          available: isBudapest || isLargeCity\n        },\n        pickup: {\n          available: isBudapest,\n          stores: isBudapest ? ['Budapest - Westend', 'Budapest - rkd'] : []\n        }\n      });\n      \n      setIsChecking(false);\n    }, 800);\n  };\n\n  const formatDate = (date) => {\n    const days = ['Vasrnap', 'Htf', 'Kedd', 'Szerda', 'Cstrtk', 'Pntek', 'Szombat'];\n    const months = ['jan.', 'feb.', 'mrc.', 'pr.', 'mj.', 'jn.', 'jl.', 'aug.', 'szept.', 'okt.', 'nov.', 'dec.'];\n    \n    return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}.`;\n  };\n\n  // Default delivery estimate without postal code\n  const defaultEstimate = useMemo(() => {\n    const today = new Date();\n    const minDate = new Date(today);\n    minDate.setDate(minDate.getDate() + 2);\n    const maxDate = new Date(today);\n    maxDate.setDate(maxDate.getDate() + 5);\n    \n    return {\n      minDays: 2,\n      maxDays: 5,\n      minDate,\n      maxDate\n    };\n  }, []);\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"flex items-center gap-3 p-3 bg-green-50 border border-green-100 rounded-xl\">\n        <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n          <Truck className=\"w-5 h-5 text-green-600\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          {deliveryInfo ? (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts: {formatDate(deliveryInfo.standard.date)}\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                {deliveryInfo.city}  Ingyenes szllts\n              </p>\n            </>\n          ) : (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts {defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanapon bell\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                50.000 Ft felett ingyenes\n              </p>\n            </>\n          )}\n        </div>\n        {!deliveryInfo && (\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"text\"\n              value={postalCode}\n              onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n              placeholder=\"Ir.szm\"\n              className=\"w-16 px-2 py-1.5 text-xs border border-gray-200 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-200 outline-none\"\n              maxLength={4}\n            />\n            <button\n              onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n              disabled={postalCode.length !== 4 || isChecking}\n              className=\"px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {isChecking ? '...' : 'OK'}\n            </button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"bg-white border border-gray-200 rounded-2xl p-5\">\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-white\">\n          <Truck className=\"w-6 h-6\" />\n        </div>\n        <div>\n          <h3 className=\"font-bold text-gray-900\">Szllts & tvtel</h3>\n          <p className=\"text-sm text-gray-500\">Add meg az irnytszmot a pontos idpontrt</p>\n        </div>\n      </div>\n\n      {/* Postal code input */}\n      <div className=\"flex gap-2 mb-5\">\n        <div className=\"relative flex-1\">\n          <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={postalCode}\n            onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n            placeholder=\"Irnytszm (pl. 1052)\"\n            className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-100 outline-none transition-all\"\n            maxLength={4}\n          />\n        </div>\n        <button\n          onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n          disabled={postalCode.length !== 4 || isChecking}\n          className=\"px-6 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n        >\n          {isChecking ? (\n            <>\n              <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n              Keress\n            </>\n          ) : (\n            <>\n              <Clock className=\"w-5 h-5\" />\n              Ellenrzs\n            </>\n          )}\n        </button>\n      </div>\n\n      {/* Results */}\n      {deliveryInfo ? (\n        <div className=\"space-y-3\">\n          {/* Standard delivery */}\n          <div className=\"flex items-center gap-4 p-4 bg-green-50 border border-green-200 rounded-xl\">\n            <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <p className=\"font-bold text-green-800\">Standard szllts</p>\n                <span className=\"px-2 py-0.5 bg-green-200 text-green-800 text-xs font-bold rounded-full\">INGYENES</span>\n              </div>\n              <p className=\"text-green-700 text-sm\">\n                Megrkezik: <strong>{formatDate(deliveryInfo.standard.date)}</strong>\n              </p>\n            </div>\n            <CheckCircle className=\"w-6 h-6 text-green-500\" />\n          </div>\n\n          {/* Express delivery */}\n          {deliveryInfo.express.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-amber-50 border border-amber-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center shrink-0\">\n                <Zap className=\"w-5 h-5 text-amber-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  <p className=\"font-bold text-amber-800\">Express szllts</p>\n                  <span className=\"px-2 py-0.5 bg-amber-200 text-amber-800 text-xs font-bold rounded-full\">\n                    +{deliveryInfo.express.price.toLocaleString('hu-HU')} Ft\n                  </span>\n                </div>\n                <p className=\"text-amber-700 text-sm\">\n                  Megrkezik: <strong>{formatDate(deliveryInfo.express.date)}</strong>\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Store pickup */}\n          {deliveryInfo.pickup.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-blue-50 border border-blue-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Package className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-bold text-blue-800\">Szemlyes tvtel</p>\n                <p className=\"text-blue-700 text-sm\">\n                  {deliveryInfo.pickup.stores.join('  ')}\n                </p>\n              </div>\n              <span className=\"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs font-bold rounded-full\">INGYENES</span>\n            </div>\n          )}\n        </div>\n      ) : (\n        /* Default estimate */\n        <div className=\"bg-gray-50 rounded-xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <Info className=\"w-5 h-5 text-gray-400 shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"text-gray-700\">\n                A vrhat szlltsi id <strong>{defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanap</strong>.\n                Add meg az irnytszmot a pontos dtumrt!\n              </p>\n              <p className=\"text-gray-500 text-sm mt-1\">\n                50.000 Ft feletti rendelsnl ingyenes hzhozszllts.\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DeliveryEstimator;\n","import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, Eye, ShoppingCart, Clock, TrendingUp, Users, Package } from 'lucide-react';\n\n/**\n * StockUrgency - Creates urgency with stock levels and real-time activity\n * Shows: Low stock warnings, recent purchases, viewing count\n */\nconst StockUrgency = ({ \n  product, \n  variant = 'full' // 'full' | 'compact' | 'badge'\n}) => {\n  const [viewingCount, setViewingCount] = useState(0);\n  const [recentPurchases, setRecentPurchases] = useState(0);\n  const [lastPurchaseTime, setLastPurchaseTime] = useState(null);\n\n  // Simulated real-time data (in production this would come from websocket/API)\n  useEffect(() => {\n    // Random initial values\n    setViewingCount(Math.floor(Math.random() * 15) + 3);\n    setRecentPurchases(Math.floor(Math.random() * 8) + 1);\n    \n    // Random last purchase time (within last hour)\n    const minutes = Math.floor(Math.random() * 45) + 5;\n    setLastPurchaseTime(minutes);\n\n    // Simulate activity updates\n    const viewInterval = setInterval(() => {\n      setViewingCount(prev => {\n        const change = Math.random() > 0.5 ? 1 : -1;\n        return Math.max(2, Math.min(25, prev + change));\n      });\n    }, 15000);\n\n    const purchaseInterval = setInterval(() => {\n      if (Math.random() > 0.7) {\n        setRecentPurchases(prev => prev + 1);\n        setLastPurchaseTime(Math.floor(Math.random() * 5) + 1);\n      }\n    }, 30000);\n\n    return () => {\n      clearInterval(viewInterval);\n      clearInterval(purchaseInterval);\n    };\n  }, [product?.id]);\n\n  if (!product) return null;\n\n  // Simulated stock level (in production from product data)\n  const stockLevel = product.stockLevel || Math.floor(Math.random() * 20) + 1;\n  const isLowStock = stockLevel <= 5;\n  const isVeryLowStock = stockLevel <= 2;\n  const isOutOfStock = stockLevel === 0;\n\n  // Badge variant - just shows stock status\n  if (variant === 'badge') {\n    if (isOutOfStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-full\">\n          <Package className=\"w-3 h-3\" />\n          Elfogyott\n        </span>\n      );\n    }\n    \n    if (isVeryLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full animate-pulse\">\n          <AlertTriangle className=\"w-3 h-3\" />\n          Utols {stockLevel} db!\n        </span>\n      );\n    }\n    \n    if (isLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n          <Clock className=\"w-3 h-3\" />\n          Mg {stockLevel} db\n        </span>\n      );\n    }\n    \n    return (\n      <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n        <Package className=\"w-3 h-3\" />\n        Raktron\n      </span>\n    );\n  }\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"space-y-2\">\n        {/* Stock level */}\n        {isLowStock && !isOutOfStock && (\n          <div className={`flex items-center gap-2 px-3 py-2 rounded-lg ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n            <AlertTriangle className={`w-4 h-4 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n            <span className={`text-sm font-bold ${isVeryLowStock ? 'text-red-700' : 'text-amber-700'}`}>\n              {isVeryLowStock ? `Csak ${stockLevel} db maradt!` : `Mr csak ${stockLevel} db raktron`}\n            </span>\n          </div>\n        )}\n\n        {/* Viewing count */}\n        <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n          <Eye className=\"w-4 h-4 text-primary-500\" />\n          <span>{viewingCount} ember nzi most</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"space-y-3\">\n      {/* Stock warning */}\n      {isOutOfStock ? (\n        <div className=\"flex items-center gap-3 p-4 bg-gray-100 border border-gray-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-gray-500\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-gray-700\">Jelenleg nincs raktron</p>\n            <p className=\"text-gray-500 text-sm\">rtestst krhetsz az jbli elrhetsgrl</p>\n          </div>\n        </div>\n      ) : isLowStock ? (\n        <div className={`flex items-center gap-3 p-4 rounded-xl ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n          <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${isVeryLowStock ? 'bg-red-100' : 'bg-amber-100'}`}>\n            <AlertTriangle className={`w-5 h-5 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n          </div>\n          <div className=\"flex-1\">\n            <p className={`font-bold ${isVeryLowStock ? 'text-red-800' : 'text-amber-800'}`}>\n              {isVeryLowStock ? ' Utols darabok!' : 'Alacsony kszlet'}\n            </p>\n            <p className={`text-sm ${isVeryLowStock ? 'text-red-600' : 'text-amber-600'}`}>\n              Mr csak <strong>{stockLevel} db</strong> van raktron\n            </p>\n          </div>\n          {/* Progress bar */}\n          <div className=\"w-16\">\n            <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className={`h-full transition-all ${isVeryLowStock ? 'bg-red-500' : 'bg-amber-500'}`}\n                style={{ width: `${Math.max(10, (stockLevel / 20) * 100)}%` }}\n              />\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-green-600\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-green-800\"> Raktron</p>\n            <p className=\"text-green-600 text-sm\">Azonnali szlltsra ksz</p>\n          </div>\n        </div>\n      )}\n\n      {/* Social proof - viewing & purchases */}\n      {!isOutOfStock && (\n        <div className=\"grid grid-cols-2 gap-3\">\n          {/* Currently viewing */}\n          <div className=\"flex items-center gap-2 p-3 bg-primary-50 rounded-xl\">\n            <div className=\"relative\">\n              <Eye className=\"w-5 h-5 text-primary-500\" />\n              <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n            </div>\n            <div>\n              <p className=\"text-lg font-bold text-primary-600\">{viewingCount}</p>\n              <p className=\"text-[10px] text-primary-500\">nzi most</p>\n            </div>\n          </div>\n\n          {/* Recent purchases */}\n          <div className=\"flex items-center gap-2 p-3 bg-secondary-50 rounded-xl\">\n            <ShoppingCart className=\"w-5 h-5 text-secondary-700\" />\n            <div>\n              <p className=\"text-lg font-bold text-secondary-700\">{recentPurchases}</p>\n              <p className=\"text-[10px] text-secondary-700\">vette meg ma</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Last purchase notification */}\n      {!isOutOfStock && lastPurchaseTime && lastPurchaseTime <= 30 && (\n        <div className=\"flex items-center gap-2 p-2.5 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100 rounded-lg animate-fade-in\">\n          <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <TrendingUp className=\"w-3.5 h-3.5 text-green-600\" />\n          </div>\n          <p className=\"text-xs text-green-700\">\n            <strong>Valaki most vette meg</strong> {lastPurchaseTime} perce {product.city || 'Budapest'}bl\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default StockUrgency;\n","import React, { useState } from 'react';\nimport { Share2, Copy, Check, Facebook, MessageCircle, Mail, Link2, X } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ProductShare - Share product via social media or copy link\n * Features: Native share API, social links, copy link, QR code\n */\nconst ProductShare = ({ \n  product, \n  variant = 'button' // 'button' | 'icons' | 'modal'\n}) => {\n  const [showModal, setShowModal] = useState(false);\n  const [copied, setCopied] = useState(false);\n  useScrollLock(showModal);\n\n  if (!product) return null;\n\n  const shareUrl = product.link || window.location.href;\n  const shareTitle = product.name;\n  const shareText = `Nzd meg ezt a termket: ${product.name} - ${(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft`;\n\n  const handleNativeShare = async () => {\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: shareTitle,\n          text: shareText,\n          url: shareUrl\n        });\n      } catch (err) {\n        if (err.name !== 'AbortError') {\n          setShowModal(true);\n        }\n      }\n    } else {\n      setShowModal(true);\n    }\n  };\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const shareLinks = [\n    {\n      name: 'Facebook',\n      icon: Facebook,\n      color: 'bg-blue-600 hover:bg-blue-700',\n      url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'Messenger',\n      icon: MessageCircle,\n      color: 'bg-gradient-to-r from-blue-500 to-secondary-600 hover:from-blue-600 hover:to-secondary-700',\n      url: `fb-messenger://share/?link=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'WhatsApp',\n      icon: () => (\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-5 h-5\">\n          <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\n        </svg>\n      ),\n      color: 'bg-green-500 hover:bg-green-600',\n      url: `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`\n    },\n    {\n      name: 'Email',\n      icon: Mail,\n      color: 'bg-gray-600 hover:bg-gray-700',\n      url: `mailto:?subject=${encodeURIComponent(shareTitle)}&body=${encodeURIComponent(shareText + '\\n\\n' + shareUrl)}`\n    }\n  ];\n\n  // Button variant - single button that opens native share or modal\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={handleNativeShare}\n          className=\"flex items-center gap-2 px-4 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n        >\n          <Share2 className=\"w-4 h-4\" />\n          <span>Megoszts</span>\n        </button>\n\n        {/* Modal */}\n        {showModal && (\n          <ShareModal\n            product={product}\n            shareLinks={shareLinks}\n            shareUrl={shareUrl}\n            copied={copied}\n            onCopy={handleCopyLink}\n            onClose={() => setShowModal(false)}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Icons variant - row of social icons\n  if (variant === 'icons') {\n    return (\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-sm text-gray-500 mr-1\">Megoszts:</span>\n        {shareLinks.map((link) => (\n          <a\n            key={link.name}\n            href={link.url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className={`p-2 rounded-full text-white transition-all hover:scale-110 ${link.color}`}\n            title={link.name}\n          >\n            <link.icon className=\"w-4 h-4\" />\n          </a>\n        ))}\n        <button\n          onClick={handleCopyLink}\n          className={`p-2 rounded-full transition-all hover:scale-110 ${\n            copied ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'\n          }`}\n          title=\"Link msolsa\"\n        >\n          {copied ? <Check className=\"w-4 h-4\" /> : <Link2 className=\"w-4 h-4\" />}\n        </button>\n      </div>\n    );\n  }\n\n  return null;\n};\n\n// Share Modal Component\nconst ShareModal = ({ product, shareLinks, shareUrl, copied, onCopy, onClose }) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-end sm:items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden animate-slide-up\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"p-5 border-b border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-bold text-gray-900\">Termk megosztsa</h3>\n            <button\n              onClick={onClose}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Product preview */}\n        <div className=\"p-5\">\n          <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl mb-5\">\n            <img\n              src={product.images?.[0] || product.image}\n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n            />\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n              <p className=\"text-primary-500 font-bold\">\n                {(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft\n              </p>\n            </div>\n          </div>\n\n          {/* Share options */}\n          <div className=\"grid grid-cols-4 gap-3 mb-5\">\n            {shareLinks.map((link) => (\n              <a\n                key={link.name}\n                href={link.url}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex flex-col items-center gap-2 p-3 rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white ${link.color}`}>\n                  <link.icon className=\"w-5 h-5\" />\n                </div>\n                <span className=\"text-xs text-gray-600\">{link.name}</span>\n              </a>\n            ))}\n          </div>\n\n          {/* Copy link */}\n          <div className=\"flex gap-2\">\n            <div className=\"flex-1 flex items-center gap-2 px-4 py-3 bg-gray-100 rounded-xl overflow-hidden\">\n              <Link2 className=\"w-4 h-4 text-gray-400 shrink-0\" />\n              <span className=\"text-sm text-gray-600 truncate\">{shareUrl}</span>\n            </div>\n            <button\n              onClick={onCopy}\n              className={`px-4 py-3 font-bold rounded-xl transition-all flex items-center gap-2 ${\n                copied \n                  ? 'bg-green-500 text-white' \n                  : 'bg-primary-500 text-white hover:bg-primary-600'\n              }`}\n            >\n              {copied ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Msolva!\n                </>\n              ) : (\n                <>\n                  <Copy className=\"w-4 h-4\" />\n                  Msols\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.3s ease-out; }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ProductShare;\n","import React, { useState } from 'react';\nimport { FileText, Ruler, Star, MessageCircle, Truck, Shield, HelpCircle, ChevronDown, ChevronUp, Check } from 'lucide-react';\n\n/**\n * ProductTabs - Tabbed content for product details\n * Features: Description, Specs, Reviews, Q&A, Shipping, Warranty\n */\nconst ProductTabs = ({ product }) => {\n  const [activeTab, setActiveTab] = useState('description');\n  const [expandedFaq, setExpandedFaq] = useState(null);\n\n  const tabs = [\n    { id: 'description', label: 'Lers', icon: FileText },\n    { id: 'specs', label: 'Adatok', icon: Ruler },\n    { id: 'reviews', label: 'Vlemnyek', icon: Star, badge: '24' },\n    { id: 'faq', label: 'Krdsek', icon: HelpCircle },\n    { id: 'shipping', label: 'Szllts', icon: Truck },\n  ];\n\n  // Parse specs from product params\n  const specs = product?.params \n    ? product.params.split(',').map(p => {\n        const [name, value] = p.split(':').map(s => s.trim());\n        return { name, value: value || name };\n      }).filter(s => s.name)\n    : [];\n\n  // Simulated reviews\n  const reviews = [\n    { id: 1, author: 'Kovcs Anna', rating: 5, date: '2025-01-15', text: 'Nagyon szp termk, pont ilyen kellett! A minsg kivl, gyors szllts.', verified: true },\n    { id: 2, author: 'Nagy Pter', rating: 4, date: '2025-01-10', text: 'J r-rtk arny. Egy csillagot levonok mert kicsit nehz volt sszerakni.', verified: true },\n    { id: 3, author: 'Szab va', rating: 5, date: '2025-01-05', text: 'Gynyr! Nagyon elgedett vagyok, ajnlom mindenkinek.', verified: false },\n  ];\n\n  const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;\n\n  // FAQ items\n  const faqItems = [\n    { q: 'Mennyi id alatt rkezik meg?', a: 'A standard szlltsi id 2-5 munkanap, expressz szlltssal 1-2 nap.' },\n    { q: 'Milyen garancit kapok?', a: 'Minden termknkre 2 v gyrti garancia vonatkozik. Ezen fell 14 napos elllsi jog.' },\n    { q: 'Szemlyesen is tvehet?', a: 'Igen, budapesti zleteinkben szemlyesen is tvehet ingyenesen.' },\n    { q: 'Hogyan kell sszeszerelni?', a: 'A termkhez rszletes magyar nyelv sszeszerelsi tmutat tartozik. Igny esetn szakembernk is segt.' },\n  ];\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden\">\n      {/* Tab buttons - UNIFIED TYPOGRAPHY */}\n      <div className=\"flex overflow-x-auto border-b border-gray-200 scrollbar-hide\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id)}\n            className={`\n              flex items-center gap-2.5 px-5 sm:px-6 py-4 font-medium text-base whitespace-nowrap border-b-2 transition-all\n              ${activeTab === tab.id \n                ? 'border-primary-500 text-primary-500 bg-primary-50/50' \n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n              }\n            `}\n          >\n            <tab.icon className=\"w-5 h-5\" />\n            <span>{tab.label}</span>\n            {tab.badge && (\n              <span className={`px-2 py-0.5 text-sm rounded-full ${\n                activeTab === tab.id ? 'bg-primary-100 text-primary-600' : 'bg-gray-100 text-gray-600'\n              }`}>\n                {tab.badge}\n              </span>\n            )}\n          </button>\n        ))}\n      </div>\n\n      {/* Tab content - UNIFIED TYPOGRAPHY */}\n      <div className=\"p-5 sm:p-6 lg:p-8\">\n        {/* Description */}\n        {activeTab === 'description' && (\n          <div className=\"prose max-w-none text-gray-700\">\n            <p className=\"text-base sm:text-lg leading-relaxed\">\n              {product?.description || 'Nincs rszletes lers ehhez a termkhez.'}\n            </p>\n            \n            {/* Features list */}\n            <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              {['Prmium minsg anyagok', 'Knny sszeszerels', 'Modern dizjn', 'Tarts kivitelezs'].map((feature, idx) => (\n                <div key={idx} className=\"flex items-center gap-2.5 text-green-700\">\n                  <Check className=\"w-5 h-5 text-green-500\" />\n                  <span className=\"text-base\">{feature}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Specifications */}\n        {activeTab === 'specs' && (\n          <div>\n            {specs.length > 0 ? (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                {specs.map((spec, idx) => (\n                  <div key={idx} className=\"flex justify-between p-4 bg-gray-50 rounded-lg\">\n                    <span className=\"text-gray-600 text-base\">{spec.name}</span>\n                    <span className=\"font-medium text-gray-900 text-base\">{spec.value}</span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-gray-500 text-center py-8 text-base\">Nincs elrhet mszaki adat.</p>\n            )}\n          </div>\n        )}\n\n        {/* Reviews - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'reviews' && (\n          <div>\n            {/* Summary */}\n            <div className=\"flex items-center gap-6 p-5 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl mb-6\">\n              <div className=\"text-center\">\n                <p className=\"text-4xl sm:text-5xl font-bold text-amber-600\">{avgRating.toFixed(1)}</p>\n                <div className=\"flex justify-center mt-2\">\n                  {[1,2,3,4,5].map(star => (\n                    <Star \n                      key={star} \n                      className={`w-5 h-5 ${star <= avgRating ? 'text-amber-400 fill-amber-400' : 'text-gray-300'}`} \n                    />\n                  ))}\n                </div>\n                <p className=\"text-sm text-gray-500 mt-1\">{reviews.length} vlemny</p>\n              </div>\n              <div className=\"flex-1\">\n                {[5,4,3,2,1].map(rating => {\n                  const count = reviews.filter(r => r.rating === rating).length;\n                  const percent = (count / reviews.length) * 100;\n                  return (\n                    <div key={rating} className=\"flex items-center gap-2 mb-1.5\">\n                      <span className=\"text-sm text-gray-500 w-4\">{rating}</span>\n                      <Star className=\"w-4 h-4 text-amber-400 fill-amber-400\" />\n                      <div className=\"flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden\">\n                        <div className=\"h-full bg-amber-400 rounded-full\" style={{ width: `${percent}%` }} />\n                      </div>\n                      <span className=\"text-sm text-gray-400 w-6\">{count}</span>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Review list */}\n            <div className=\"space-y-5\">\n              {reviews.map((review) => (\n                <div key={review.id} className=\"border-b border-gray-100 pb-5 last:border-0\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-base\">\n                        {review.author.charAt(0)}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900 text-base flex items-center gap-2\">\n                          {review.author}\n                          {review.verified && (\n                            <span className=\"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded\"> Ellenrztt</span>\n                          )}\n                        </p>\n                        <p className=\"text-sm text-gray-400\">{new Date(review.date).toLocaleDateString('hu-HU')}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex\">\n                      {[1,2,3,4,5].map(star => (\n                        <Star \n                          key={star} \n                          className={`w-5 h-5 ${star <= review.rating ? 'text-amber-400 fill-amber-400' : 'text-gray-200'}`}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                  <p className=\"text-gray-700 text-base\">{review.text}</p>\n                </div>\n              ))}\n            </div>\n\n            {/* Write review button */}\n            <button className=\"w-full mt-5 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors\">\n              + Vlemny rsa\n            </button>\n          </div>\n        )}\n\n        {/* FAQ - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'faq' && (\n          <div className=\"space-y-3\">\n            {faqItems.map((item, idx) => (\n              <div \n                key={idx}\n                className=\"border border-gray-200 rounded-xl overflow-hidden\"\n              >\n                <button\n                  onClick={() => setExpandedFaq(expandedFaq === idx ? null : idx)}\n                  className=\"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors\"\n                >\n                  <span className=\"font-medium text-gray-900 text-base\">{item.q}</span>\n                  {expandedFaq === idx ? (\n                    <ChevronUp className=\"w-5 h-5 text-gray-400\" />\n                  ) : (\n                    <ChevronDown className=\"w-5 h-5 text-gray-400\" />\n                  )}\n                </button>\n                {expandedFaq === idx && (\n                  <div className=\"px-4 pb-4 text-gray-600 text-base animate-fade-in\">\n                    {item.a}\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {/* Ask question */}\n            <button className=\"w-full mt-3 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors flex items-center justify-center gap-2\">\n              <MessageCircle className=\"w-5 h-5\" />\n              Krds feltevse\n            </button>\n          </div>\n        )}\n\n        {/* Shipping - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'shipping' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-start gap-4 p-5 bg-green-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n                <Truck className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-green-800 text-lg\">Ingyenes szllts 50.000 Ft felett</p>\n                <p className=\"text-green-700 text-base\">Standard szllts: 2-5 munkanap</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start gap-4 p-5 bg-blue-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Shield className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-blue-800 text-lg\">2 v garancia</p>\n                <p className=\"text-blue-700 text-base\">Teljes kr gyrti garancia minden termkre</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 mt-5\">\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">2-5</p>\n                <p className=\"text-sm text-gray-500\">munkanap</p>\n              </div>\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">14</p>\n                <p className=\"text-sm text-gray-500\">nap ellls</p>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ProductTabs;\n","import React, { useState, useMemo } from 'react';\nimport { TrendingDown, TrendingUp, Minus, Clock, Bell, ChevronDown, ChevronUp, AlertCircle, Check } from 'lucide-react';\n\n/**\n * PriceHistory - Dynamic pricing indicator with history chart\n * Shows price trends and alerts for best buying time\n */\nconst PriceHistory = ({ \n  currentPrice = 0, \n  priceHistory = [], \n  productId,\n  onSetAlert \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [alertSet, setAlertSet] = useState(false);\n\n  // Early return if no valid price\n  const validPrice = currentPrice && currentPrice > 0 ? currentPrice : 100000;\n\n  // Generate mock price history if not provided\n  const history = useMemo(() => {\n    if (priceHistory.length > 0) return priceHistory;\n    \n    // Generate 6 months of price data\n    const months = ['Aug', 'Szept', 'Okt', 'Nov', 'Dec', 'Jan'];\n    const basePrice = validPrice;\n    \n    return months.map((month, idx) => {\n      const variance = (Math.random() - 0.5) * 0.3; // 15% variance\n      const price = Math.round(basePrice * (1 + variance));\n      return {\n        month,\n        price: price || basePrice, // Ensure price is never 0\n        date: new Date(2025, 7 + idx, 1)\n      };\n    });\n  }, [validPrice, priceHistory]);\n\n  // Calculate stats\n  const stats = useMemo(() => {\n    if (!history || history.length === 0) {\n      return { min: validPrice, max: validPrice, avg: validPrice, priceChange: 0, changePercent: '0.0', isLowest: false, isHighest: false, previousPrice: validPrice };\n    }\n    \n    const prices = history.map(h => h.price || validPrice);\n    const min = Math.min(...prices) || validPrice;\n    const max = Math.max(...prices) || validPrice;\n    const avg = Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) || validPrice;\n    const previousPrice = history[history.length - 2]?.price || validPrice;\n    const priceChange = validPrice - previousPrice;\n    const changePercent = previousPrice > 0 ? ((priceChange / previousPrice) * 100).toFixed(1) : '0.0';\n    const isLowest = validPrice <= min * 1.05; // Within 5% of lowest\n    const isHighest = validPrice >= max * 0.95;\n    \n    return { min, max, avg, priceChange, changePercent, isLowest, isHighest, previousPrice };\n  }, [history, validPrice]);\n\n  // Chart dimensions\n  const chartHeight = 60;\n  const chartWidth = 200;\n\n  // Generate SVG path for price chart\n  const chartPath = useMemo(() => {\n    const prices = history.map(h => h.price);\n    const min = Math.min(...prices) * 0.95;\n    const max = Math.max(...prices) * 1.05;\n    const range = max - min;\n    \n    const points = prices.map((price, idx) => {\n      const x = (idx / (prices.length - 1)) * chartWidth;\n      const y = chartHeight - ((price - min) / range) * chartHeight;\n      return `${x},${y}`;\n    });\n    \n    return `M ${points.join(' L ')}`;\n  }, [history]);\n\n  // Area fill path\n  const areaPath = useMemo(() => {\n    return `${chartPath} L ${chartWidth},${chartHeight} L 0,${chartHeight} Z`;\n  }, [chartPath]);\n\n  const handleSetAlert = () => {\n    setAlertSet(true);\n    onSetAlert?.(productId, currentPrice);\n    setTimeout(() => setAlertSet(false), 3000);\n  };\n\n  const getTrendIcon = () => {\n    if (stats.priceChange < 0) return <TrendingDown className=\"w-4 h-4\" />;\n    if (stats.priceChange > 0) return <TrendingUp className=\"w-4 h-4\" />;\n    return <Minus className=\"w-4 h-4\" />;\n  };\n\n  const getTrendColor = () => {\n    if (stats.priceChange < 0) return 'text-green-600 bg-green-50';\n    if (stats.priceChange > 0) return 'text-red-600 bg-red-50';\n    return 'text-gray-600 bg-gray-50';\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n      {/* Compact Header - Always visible */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between p-3 sm:p-4 hover:bg-gray-50 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-sm font-medium ${getTrendColor()}`}>\n            {getTrendIcon()}\n            <span>{stats.priceChange > 0 ? '+' : ''}{stats.changePercent}%</span>\n          </div>\n          \n          {stats.isLowest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n              <TrendingDown className=\"w-3 h-3\" />\n              Most a legolcsbb!\n            </span>\n          )}\n          \n          {stats.isHighest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n              <AlertCircle className=\"w-3 h-3\" />\n              Magas r\n            </span>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2 text-gray-500\">\n          <Clock className=\"w-4 h-4\" />\n          <span className=\"text-xs\">rvltozs</span>\n          {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      {isExpanded && (\n        <div className=\"px-3 sm:px-4 pb-4 space-y-4\">\n          {/* Mini Chart */}\n          <div className=\"bg-gray-50 rounded-xl p-4\">\n            <div className=\"flex items-end justify-between mb-3\">\n              <span className=\"text-xs text-gray-500\">Elmlt 6 hnap</span>\n              <div className=\"text-right\">\n                <span className=\"text-lg font-bold text-gray-900\">{currentPrice.toLocaleString()} Ft</span>\n                <span className=\"text-xs text-gray-500 ml-1\">most</span>\n              </div>\n            </div>\n            \n            {/* SVG Chart */}\n            <div className=\"relative h-16\">\n              <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className=\"w-full h-full\" preserveAspectRatio=\"none\">\n                {/* Gradient fill */}\n                <defs>\n                  <linearGradient id=\"priceGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                    <stop offset=\"0%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0.3\" />\n                    <stop offset=\"100%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0\" />\n                  </linearGradient>\n                </defs>\n                \n                {/* Area fill */}\n                <path d={areaPath} fill=\"url(#priceGradient)\" />\n                \n                {/* Line */}\n                <path \n                  d={chartPath} \n                  fill=\"none\" \n                  stroke={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} \n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n                \n                {/* Current price dot */}\n                <circle \n                  cx={chartWidth} \n                  cy={chartHeight - ((currentPrice - stats.min * 0.95) / (stats.max * 1.05 - stats.min * 0.95)) * chartHeight}\n                  r=\"4\" \n                  fill={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'}\n                />\n              </svg>\n              \n              {/* Month labels */}\n              <div className=\"absolute bottom-0 left-0 right-0 flex justify-between text-[10px] text-gray-400 -mb-4\">\n                {history.filter((_, i) => i % 2 === 0).map((h, i) => (\n                  <span key={i}>{h.month}</span>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Stats Grid */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"bg-green-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-green-600 mb-0.5\">Legalacsonyabb</div>\n              <div className=\"font-bold text-green-700 text-sm\">{stats.min.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-gray-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-gray-500 mb-0.5\">tlagr</div>\n              <div className=\"font-bold text-gray-700 text-sm\">{stats.avg.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-red-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-red-600 mb-0.5\">Legmagasabb</div>\n              <div className=\"font-bold text-red-700 text-sm\">{stats.max.toLocaleString()} Ft</div>\n            </div>\n          </div>\n\n          {/* Price Alert Button */}\n          <button\n            onClick={handleSetAlert}\n            disabled={alertSet}\n            className={`\n              w-full flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-medium transition-all\n              ${alertSet \n                ? 'bg-green-100 text-green-700' \n                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }\n            `}\n          >\n            {alertSet ? (\n              <>\n                <Check className=\"w-4 h-4\" />\n                rtests belltva!\n              </>\n            ) : (\n              <>\n                <Bell className=\"w-4 h-4\" />\n                rtests, ha cskken az r\n              </>\n            )}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PriceHistory;\n","import React, { useState } from 'react';\nimport { Zap, CreditCard, Truck, Shield, Check, ChevronRight, Apple, Smartphone, Lock, MapPin, User, Mail } from 'lucide-react';\n\n/**\n * OneClickCheckout - Express checkout for returning customers\n * Sleek, trustworthy design with saved payment methods\n */\nconst OneClickCheckout = ({ \n  product,\n  savedAddress,\n  savedPayment,\n  userEmail,\n  userName,\n  onCheckout,\n  onClose \n}) => {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState('saved');\n  const [step, setStep] = useState('confirm'); // 'confirm' | 'processing' | 'success'\n\n  const paymentMethods = [\n    { id: 'saved', label: 'Mentett krtya', icon: CreditCard, detail: ' 4242', badge: 'Gyors' },\n    { id: 'apple', label: 'Apple Pay', icon: Apple, detail: 'Egy rintssel', badge: null },\n    { id: 'google', label: 'Google Pay', icon: Smartphone, detail: 'Egy rintssel', badge: null },\n  ];\n\n  const handleCheckout = async () => {\n    setStep('processing');\n    setIsProcessing(true);\n    \n    // Simulate processing\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    setStep('success');\n    setIsProcessing(false);\n    \n    // Call parent callback\n    setTimeout(() => {\n      onCheckout?.({ product, payment: selectedPayment });\n    }, 1500);\n  };\n\n  if (step === 'success') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n          <Check className=\"w-8 h-8 text-green-600\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Sikeres rendels!</h3>\n        <p className=\"text-gray-600 mb-4\">Visszaigazolst kldtnk emailben.</p>\n        <div className=\"bg-gray-50 rounded-xl p-4 text-sm text-gray-600\">\n          <p>Rendelsszm: <span className=\"font-mono font-bold\">#MKT-{Math.random().toString(36).substr(2, 8).toUpperCase()}</span></p>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'processing') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Feldolgozs...</h3>\n        <p className=\"text-gray-600\">Krjk vrj, a fizets folyamatban.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-2xl overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-primary-500 to-secondary-600 px-5 py-4 text-white\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n            <Zap className=\"w-5 h-5\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-lg\">Gyors vsrls</h3>\n            <p className=\"text-white/80 text-sm\">Egy kattintssal ksz</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-5 space-y-4\">\n        {/* Product Summary */}\n        <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl\">\n          <div className=\"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden shrink-0\">\n            {product?.image && (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n            <p className=\"font-bold text-primary-600 mt-1\">{product?.price?.toLocaleString()} Ft</p>\n          </div>\n        </div>\n\n        {/* Saved Info */}\n        <div className=\"space-y-2\">\n          {/* Delivery Address */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <MapPin className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Szlltsi cm</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {savedAddress || '1234 Budapest, Plda utca 12.'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n\n          {/* Contact */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <Mail className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Email</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {userEmail || 'pelda@email.com'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n        </div>\n\n        {/* Payment Methods */}\n        <div>\n          <p className=\"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2\">Fizetsi md</p>\n          <div className=\"space-y-2\">\n            {paymentMethods.map((method) => (\n              <button\n                key={method.id}\n                onClick={() => setSelectedPayment(method.id)}\n                className={`\n                  w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-left\n                  ${selectedPayment === method.id \n                    ? 'border-primary-400 bg-primary-50' \n                    : 'border-gray-200 hover:border-gray-300'\n                  }\n                `}\n              >\n                <div className={`\n                  w-9 h-9 rounded-lg flex items-center justify-center\n                  ${selectedPayment === method.id ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-600'}\n                `}>\n                  <method.icon className=\"w-5 h-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-gray-900 text-sm\">{method.label}</span>\n                    {method.badge && (\n                      <span className=\"px-1.5 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded\">\n                        {method.badge}\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-xs text-gray-500\">{method.detail}</p>\n                </div>\n                <div className={`\n                  w-5 h-5 rounded-full border-2 flex items-center justify-center\n                  ${selectedPayment === method.id \n                    ? 'border-primary-500 bg-primary-500' \n                    : 'border-gray-300'\n                  }\n                `}>\n                  {selectedPayment === method.id && <Check className=\"w-3 h-3 text-white\" />}\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Trust Badges */}\n        <div className=\"flex items-center justify-center gap-4 py-2 text-xs text-gray-500\">\n          <span className=\"flex items-center gap-1\">\n            <Shield className=\"w-3.5 h-3.5 text-green-600\" />\n            Biztonsgos\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Lock className=\"w-3.5 h-3.5 text-green-600\" />\n            SSL titkosts\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Truck className=\"w-3.5 h-3.5 text-primary-500\" />\n            Gyors szllts\n          </span>\n        </div>\n\n        {/* CTA Button */}\n        <button\n          onClick={handleCheckout}\n          disabled={isProcessing}\n          className=\"w-full flex items-center justify-center gap-2 py-4 bg-gradient-to-r from-primary-500 to-secondary-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all disabled:opacity-50\"\n        >\n          <Zap className=\"w-5 h-5\" />\n          Megrendelem - {product?.price?.toLocaleString()} Ft\n        </button>\n\n        {/* Cancel */}\n        <button\n          onClick={onClose}\n          className=\"w-full py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n        >\n          Mgse, vissza a termkhez\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default OneClickCheckout;\n","import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { \n  Search, X, Clock, TrendingUp, ArrowRight, Sparkles, Package, \n  Filter, ChevronRight, Lightbulb, Tag, Eye, Zap, Star, Wand2,\n  ShoppingBag, ArrowUpRight, Percent, History, Mic, Camera\n} from 'lucide-react';\nimport { \n  smartSearch, \n  getAutocompleteSuggestions, \n  getProactiveSuggestions,\n  parseSearchIntent,\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats,\n  getDidYouMeanSuggestion\n} from '../../services/aiSearchService';\nimport { fetchUnasProducts, fetchUnasProductById } from '../../services/unasApi';\nimport { trackSearch, trackSearchClick, getSearchHistory, getViewedProducts } from '../../services/userPreferencesService';\n\n// Keresett sz kiemelse a szvegben (case-insensitive, split tartalmazza a tallatokat)\nconst highlightMatch = (text, query) => {\n  if (!text || !query || query.length < 2) return text;\n  const q = query.trim().replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  const re = new RegExp(`(${q})`, 'gi');\n  const parts = String(text).split(re);\n  if (parts.length <= 1) return text;\n  return parts.map((part, i) =>\n    i % 2 === 1 ? (\n      <mark key={i} className=\"bg-amber-200/80 text-gray-900 rounded px-0.5 font-semibold\">{part}</mark>\n    ) : (\n      part\n    )\n  );\n};\n\n/**\n * SmartSearchBar - Vilgsznvonal AI-alap btorkeres\n * \n * Funkcik:\n * - Vals idej intelligens autocomplete\n * - Termszetes nyelv keress\n * - Szinonimk s magyar nyelvi sajtossgok\n * - Fuzzy matching (elgpels tolerns)\n * - Kontextus-tudatos javaslatok\n * - Proaktv ajnlsok\n * - Keressi szndk felismers\n * - Termk elnzet a tallatokban\n * - UX: tallat kiemels, / fkusz, animcik\n */\nconst SmartSearchBar = ({ \n  products = [], \n  categories = [],\n  indexVersion = 0,\n  shouldBuildIndex = true,\n  maxLocalIndex = 50000,\n  serverSearchMode = false,\n  onSearch, \n  onProductClick,\n  placeholder = \"Mit keresel? pl. 'modern kanap 200 ezer alatt'\" \n}) => {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [debouncedQuery, setDebouncedQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(-1); // Keyboard navigation\n  const [indexStatus, setIndexStatus] = useState({ ready: false, building: false, count: 0 });\n  const [serverPreview, setServerPreview] = useState({ results: [], total: 0, loading: false });\n  const inputRef = useRef(null);\n  const containerRef = useRef(null);\n  const debounceTimerRef = useRef(null);\n  const resultsRef = useRef(null);\n  const indexedCountRef = useRef(0);\n  const indexedVersionRef = useRef(0);\n  const serverRequestIdRef = useRef(0);\n\n  const canUseLocalIndex = !serverSearchMode && shouldBuildIndex && products.length > 0 && products.length <= maxLocalIndex;\n  const localIndexDisabled = serverSearchMode || (shouldBuildIndex && products.length > maxLocalIndex);\n\n  //  BUILD SEARCH INDEX when products are loaded (async, non-blocking)\n  useEffect(() => {\n    if (!canUseLocalIndex) {\n      if (localIndexDisabled) {\n        setIndexStatus({ ready: false, building: false, count: 0 });\n      }\n      return;\n    }\n    if (products.length > 0 && (products.length !== indexedCountRef.current || indexVersion !== indexedVersionRef.current)) {\n      console.log(` Products: ${products.length}, starting async index build...`);\n      setIndexStatus({ ready: false, building: true, count: 0 });\n      \n      // Build async\n      const doBuild = async () => {\n        try {\n          const success = await buildSearchIndex(products);\n          if (success) {\n            const stats = getIndexStats();\n            indexedCountRef.current = products.length;\n            indexedVersionRef.current = indexVersion;\n            setIndexStatus({ \n              ready: true, \n              building: false, \n              count: stats.productCount \n            });\n          }\n        } catch (err) {\n          console.error('Index build error:', err);\n          setIndexStatus({ ready: false, building: false, count: 0 });\n        }\n      };\n      \n      // Start when browser is idle to avoid jank\n      if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n        window.requestIdleCallback(() => doBuild(), { timeout: 2000 });\n      } else {\n        setTimeout(doBuild, 300);\n      }\n    }\n  }, [products.length, indexVersion, canUseLocalIndex, localIndexDisabled]);\n\n  // Debounce query - 150ms gyors vlasz\n  useEffect(() => {\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    debounceTimerRef.current = setTimeout(() => {\n      setDebouncedQuery(query);\n    }, 150);\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, [query]);\n\n  // Server-side search: trigger on debounced input\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    onSearch?.(q);\n  }, [debouncedQuery, onSearch, serverSearchMode]);\n\n  // Server-side preview results for typeahead\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    if (q.length < 2) {\n      setServerPreview({ results: [], total: 0, loading: false });\n      return;\n    }\n    const requestId = ++serverRequestIdRef.current;\n    setServerPreview((prev) => ({ ...prev, loading: true }));\n    const intent = q.length >= 3 ? parseSearchIntent(q) : null;\n    const intentKw = intent\n      ? [...(intent.productTypes || []), ...(intent.styles || []), ...(intent.colors || []), ...(intent.materials || [])].filter(Boolean)\n      : [];\n    fetchUnasProducts({\n      search: q,\n      limit: 6,\n      offset: 0,\n      slim: true,\n      minPrice: intent?.priceRange?.min,\n      maxPrice: intent?.priceRange?.max,\n      styleKeywords: intentKw.length > 0 ? intentKw : undefined\n    })\n      .then((data) => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({\n          results: Array.isArray(data.products) ? data.products : [],\n          total: typeof data.total === 'number' ? data.total : 0,\n          loading: false\n        });\n      })\n      .catch(() => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({ results: [], total: 0, loading: false });\n      });\n  }, [debouncedQuery, serverSearchMode]);\n\n  // Autocomplete javaslatok - TELJES katalgusbl keres\n  const autocompleteSuggestions = useMemo(() => {\n    if (!canUseLocalIndex) return [];\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2 || !products.length) return [];\n    // TELJES katalgus hasznlata - a getAutocompleteSuggestions mr optimalizlt\n    return getAutocompleteSuggestions(products, debouncedQuery, 8);\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Keressi eredmnyek - CSAK ha debounced query vltozik\n  const searchResults = useMemo(() => {\n    if (!canUseLocalIndex) return { results: [], intent: null, totalMatches: 0 };\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2) return { results: [], intent: null, totalMatches: 0 };\n    return smartSearch(products, debouncedQuery, { limit: 8, includeDebugInfo: false });\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Felismert keressi szndk\n  const searchIntent = useMemo(() => {\n    if (!debouncedQuery.trim() || debouncedQuery.length < 3) return null;\n    return parseSearchIntent(debouncedQuery);\n  }, [debouncedQuery]);\n\n  // Proaktv javaslatok - egyszer szmtva, nem minden renderben\n  const proactiveSuggestions = useMemo(() => {\n    // Nem hasznljuk a products-ot itt, mert lass lenne\n    return getProactiveSuggestions([]);\n  }, []);\n\n  // Keressi elzmnyek - egyszer beolvasva\n  const recentSearches = useMemo(() => {\n    const history = getSearchHistory(4);\n    return history.map(h => h.query).filter(q => q && q.length > 0);\n  }, []);\n\n  // Nemrg nzett termkek - egyszer beolvasva\n  const recentlyViewed = useMemo(() => {\n    return getViewedProducts(3);\n  }, []);\n\n  // Trendi keressek - statikus + szemlyre szabott\n  const trendingSearches = useMemo(() => {\n    const viewed = getViewedProducts(3);\n    const viewedCategories = viewed.map(p => p.category?.split(' > ')[0]).filter(Boolean);\n    \n    const defaults = [\n      { text: 'modern kanap', icon: '' },\n      { text: 'skandinv stlus', icon: '' },\n      { text: 'akcis btorok', icon: '' },\n      { text: 'kompakt btor', icon: '' },\n    ];\n    \n    const personalized = viewedCategories.map(c => ({\n      text: `${c} ajnlatok`,\n      icon: '',\n    }));\n    \n    const combined = [...personalized, ...defaults];\n    return combined.filter((v, i, a) => a.findIndex(t => t.text === v.text) === i).slice(0, 4);\n  }, []);\n\n  // Close on outside click\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Keyboard shortcut: \"/\" focuses search (unless already in input/textarea)\n  useEffect(() => {\n    const handleGlobalKeyDown = (e) => {\n      if (e.key !== '/' || e.ctrlKey || e.metaKey || e.altKey) return;\n      const target = e.target;\n      if (target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable)) return;\n      e.preventDefault();\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    document.addEventListener('keydown', handleGlobalKeyDown);\n    return () => document.removeEventListener('keydown', handleGlobalKeyDown);\n  }, []);\n\n  // Fejlc Keress gomb: scroll utn fkusz + dropdown nyits\n  useEffect(() => {\n    const handleFocusSearch = () => {\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    window.addEventListener('mkt-focus-search', handleFocusSearch);\n    return () => window.removeEventListener('mkt-focus-search', handleFocusSearch);\n  }, []);\n\n  // === CALLBACK DEFINCIK (useEffect ELTT kell lennik!) ===\n  \n  const handleSubmit = useCallback((e) => {\n    e?.preventDefault();\n    if (query.trim()) {\n      trackSearch(query);\n      onSearch?.(query);\n      setIsOpen(false);\n    }\n  }, [query, onSearch]);\n\n  const handleInputChange = useCallback((e) => {\n    const value = e.target.value;\n    setQuery(value);\n  }, []);\n\n  const handleProductClickFn = useCallback(async (product, position = 0, fromSearchResults = true) => {\n    if (fromSearchResults && debouncedQuery.trim() && product?.id) {\n      trackSearchClick(debouncedQuery.trim(), product.id, position);\n    }\n    try {\n      if (serverSearchMode && product?.id) {\n        const full = await fetchUnasProductById(product.id);\n        onProductClick?.(full || product);\n      } else {\n        onProductClick?.(product);\n      }\n    } catch (err) {\n      onProductClick?.(product);\n    } finally {\n      setQuery('');\n      setIsOpen(false);\n    }\n  }, [onProductClick, serverSearchMode, debouncedQuery]);\n\n  const handleSuggestionClick = useCallback((suggestion) => {\n    const text = typeof suggestion === 'string' ? suggestion : suggestion.text || suggestion.query;\n    setQuery(text);\n    trackSearch(text);\n    onSearch?.(text);\n    setIsOpen(false);\n  }, [onSearch]);\n\n  const handleAutocompleteClickFn = useCallback((item) => {\n    if (item.type === 'result' && item.item) {\n      handleProductClickFn(item.item, item.index ?? 0);\n    } else if (item.type === 'product' && item.product) {\n      handleProductClickFn(item.product);\n    } else {\n      const text = typeof item?.item === 'string' ? item.item : item?.text;\n      if (text) handleSuggestionClick(text);\n    }\n  }, [handleProductClickFn, handleSuggestionClick]);\n\n  const clearQuery = useCallback(() => {\n    setQuery('');\n    inputRef.current?.focus();\n  }, []);\n\n  // Alias for backwards compatibility\n  const handleProductClick = handleProductClickFn;\n  const handleAutocompleteClick = handleAutocompleteClickFn;\n\n  // === NAVIGLHAT ELEMEK ===\n  \n  // sszes naviglhat elem (autocomplete + search results)\n  const allNavigableItems = useMemo(() => {\n    const items = [];\n    \n    // Autocomplete javaslatok\n    if (debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0) {\n      autocompleteSuggestions.forEach((sug, idx) => {\n        items.push({ type: 'autocomplete', item: sug, index: idx });\n      });\n    }\n    \n    // Keressi eredmnyek\n    if (debouncedQuery.length >= 2 && searchResults.results?.length > 0) {\n      searchResults.results.slice(0, 6).forEach((product, idx) => {\n        items.push({ type: 'result', item: product, index: idx });\n      });\n    }\n    \n    return items;\n  }, [debouncedQuery, autocompleteSuggestions, searchResults.results]);\n\n  // Reset selection when results change\n  useEffect(() => {\n    setSelectedIndex(-1);\n  }, [debouncedQuery]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (!isOpen) return;\n      \n      const totalItems = allNavigableItems.length;\n      \n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev < totalItems - 1 ? prev + 1 : 0;\n            return next;\n          });\n          break;\n          \n        case 'ArrowUp':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev > 0 ? prev - 1 : totalItems - 1;\n            return next;\n          });\n          break;\n          \n        case 'Enter':\n          if (selectedIndex >= 0 && selectedIndex < totalItems) {\n            e.preventDefault();\n            const selected = allNavigableItems[selectedIndex];\n            if (selected.type === 'autocomplete') {\n              handleAutocompleteClickFn(selected.item);\n            } else if (selected.type === 'result') {\n              handleProductClickFn(selected.item);\n            }\n          }\n          break;\n          \n        case 'Escape':\n          setIsOpen(false);\n          setSelectedIndex(-1);\n          inputRef.current?.blur();\n          break;\n          \n        case 'Tab':\n          if (totalItems > 0) {\n            e.preventDefault();\n            setSelectedIndex(prev => (prev + 1) % totalItems);\n          }\n          break;\n      }\n    };\n    \n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, allNavigableItems, selectedIndex, handleAutocompleteClickFn, handleProductClickFn]);\n\n  // Render intent tags\n  const renderIntentTags = () => {\n    if (!searchIntent) return null;\n    \n    const tags = [];\n    \n    if (searchIntent.productTypes.length > 0) {\n      tags.push({ label: searchIntent.productTypes[0], color: 'primary', icon: ShoppingBag });\n    }\n    if (searchIntent.styles.length > 0) {\n      tags.push({ label: searchIntent.styles[0], color: 'purple', icon: Sparkles });\n    }\n    if (searchIntent.colors.length > 0) {\n      tags.push({ label: searchIntent.colors[0], color: 'blue', icon: Tag });\n    }\n    if (searchIntent.priceRange) {\n      const priceLabel = searchIntent.priceRange.max === Infinity \n        ? `${(searchIntent.priceRange.min / 1000).toFixed(0)}k+ Ft`\n        : `${(searchIntent.priceRange.min / 1000).toFixed(0)}-${(searchIntent.priceRange.max / 1000).toFixed(0)}k Ft`;\n      tags.push({ label: priceLabel, color: 'green', icon: Tag });\n    }\n    if (searchIntent.isOnSale) {\n      tags.push({ label: 'Akcis', color: 'red', icon: Percent });\n    }\n    \n    if (tags.length === 0) return null;\n    \n    return (\n      <div className=\"flex flex-wrap gap-1.5 px-4 py-2.5 border-b border-gray-100 bg-gradient-to-r from-primary-50/40 to-transparent\">\n        <span className=\"text-xs text-gray-500 mr-1 flex items-center gap-1.5 font-medium\">\n          <Wand2 className=\"w-3.5 h-3.5 text-primary-500\" />\n          Felismert:\n        </span>\n        {tags.map((tag, i) => (\n          <span \n            key={i}\n            className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium\n              ${tag.color === 'primary' ? 'bg-primary-100 text-primary-700' : ''}\n              ${tag.color === 'purple' ? 'bg-purple-100 text-purple-700' : ''}\n              ${tag.color === 'blue' ? 'bg-blue-100 text-blue-700' : ''}\n              ${tag.color === 'green' ? 'bg-green-100 text-green-700' : ''}\n              ${tag.color === 'red' ? 'bg-red-100 text-red-700' : ''}\n            `}\n          >\n            <tag.icon className=\"w-3 h-3\" />\n            {tag.label}\n          </span>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div ref={containerRef} className=\"relative w-full max-w-3xl mx-auto\">\n      {/* Backdrop - subtle overlay when dropdown open (mobile-friendly) */}\n      {isOpen && (\n        <div \n          className=\"search-dropdown-backdrop fixed inset-0 bg-black/5 z-[9998] sm:bg-transparent sm:pointer-events-none\"\n          aria-hidden=\"true\"\n        />\n      )}\n      {/* Search Input */}\n      <form onSubmit={handleSubmit} className=\"relative\">\n        <div className={`search-input-wrapper\n          flex items-center gap-2 bg-white rounded-2xl border-2 transition-all duration-200\n          ${isOpen \n            ? 'border-primary-400 shadow-xl shadow-primary-100/50 ring-4 ring-primary-50' \n            : 'border-gray-200 hover:border-gray-300 hover:shadow-md'}\n        `}>\n          <div className=\"flex items-center pl-4\">\n            {indexStatus.building ? (\n              <div className=\"w-5 h-5 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" title=\"Index ptse...\" />\n            ) : query.length >= 2 && query !== debouncedQuery ? (\n              <div className=\"w-5 h-5 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n            ) : (\n              <Search className={`w-5 h-5 transition-colors ${isOpen ? 'text-primary-500' : 'text-gray-400'}`} />\n            )}\n          </div>\n          \n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={query}\n            onChange={handleInputChange}\n            onFocus={() => setIsOpen(true)}\n            placeholder={placeholder}\n            className=\"flex-1 py-3.5 sm:py-4 bg-transparent text-gray-900 placeholder-gray-400 text-sm sm:text-base focus:outline-none\"\n            autoComplete=\"off\"\n            spellCheck=\"false\"\n          />\n\n          {query && (\n            <button\n              type=\"button\"\n              onClick={clearQuery}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          <button\n            type=\"submit\"\n            className=\"flex items-center gap-2 px-5 sm:px-6 py-2.5 sm:py-3 mr-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold text-sm rounded-xl hover:from-primary-600 hover:to-primary-700 hover:shadow-lg hover:shadow-primary-500/25 transition-all active:scale-95\"\n          >\n            <Search className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Keress</span>\n          </button>\n        </div>\n      </form>\n\n      {/* Dropdown Panel */}\n      {isOpen && (\n        <div className=\"search-dropdown-enter search-dropdown-scroll absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md rounded-2xl border border-gray-100 overflow-hidden z-[9999] max-h-[75vh] overflow-y-auto\">\n          \n          {/* Intent Tags - ha van felismert szndk */}\n          {debouncedQuery.length >= 3 && renderIntentTags()}\n\n          {/* Autocomplete javaslatok - gpels kzben */}\n          {debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0 && (\n            <div className=\"border-b border-gray-100\">\n              <div className=\"p-2\">\n                <p className=\"px-3 py-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <Zap className=\"w-3.5 h-3.5 text-amber-500\" />\n                  Javaslatok\n                </p>\n                {autocompleteSuggestions.map((item, idx) => {\n                  const isSelected = selectedIndex === idx;\n                  return (\n                  <button\n                    key={idx}\n                    onClick={() => handleAutocompleteClick(item)}\n                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all text-left group\n                      ${isSelected \n                        ? 'bg-primary-100 ring-2 ring-primary-400 ring-inset' \n                        : 'hover:bg-primary-50'\n                      }`}\n                  >\n                    <div className={`\n                      w-8 h-8 rounded-lg flex items-center justify-center shrink-0\n                      ${item.type === 'product' ? 'bg-primary-100' : ''}\n                      ${item.type === 'category' ? 'bg-secondary-100' : ''}\n                      ${item.type === 'keyword' ? 'bg-gray-100' : ''}\n                      ${item.type === 'synonym' ? 'bg-purple-100' : ''}\n                      ${item.type === 'popular' ? 'bg-amber-100' : ''}\n                    `}>\n                      {item.type === 'product' && item.product?.image ? (\n                        <img src={item.product.image} alt=\"\" className=\"w-full h-full object-cover rounded-lg\" />\n                      ) : (\n                        <>\n                          {item.type === 'product' && <Package className=\"w-4 h-4 text-primary-600\" />}\n                          {item.type === 'category' && <Filter className=\"w-4 h-4 text-secondary-600\" />}\n                          {item.type === 'keyword' && <Search className=\"w-4 h-4 text-gray-500\" />}\n                          {item.type === 'synonym' && <Sparkles className=\"w-4 h-4 text-purple-600\" />}\n                          {item.type === 'popular' && <TrendingUp className=\"w-4 h-4 text-amber-600\" />}\n                        </>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <span className=\"text-sm text-gray-800 font-medium\">\n                        {item.type === 'product' && debouncedQuery ? highlightMatch(item.text, debouncedQuery) : item.text}\n                      </span>\n                      {item.type === 'product' && item.product && (\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {item.product.price?.toLocaleString()} Ft\n                        </p>\n                      )}\n                    </div>\n                    <ArrowUpRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (server-side preview) */}\n          {serverSearchMode && debouncedQuery.length >= 2 && serverPreview.results && serverPreview.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{(serverPreview.total || serverPreview.results.length).toLocaleString()} tallat</span>\n                  </p>\n                </div>\n                {(serverPreview.total || 0) > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {serverPreview.results.slice(0, 6).map((product, idx) => {\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product, idx)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (local index) */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.results && searchResults.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{searchResults.totalMatches.toLocaleString()} tallat</span>\n                  </p>\n                  {searchResults.searchTime != null && (\n                    <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-xs font-medium\">\n                      <Zap className=\"w-3 h-3\" />\n                      {searchResults.searchTime < 1 ? '<1' : Math.round(searchResults.searchTime)} ms\n                    </span>\n                  )}\n                </div>\n                {searchResults.totalMatches > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {searchResults.results.slice(0, 6).map((product, idx) => {\n                  // Calculate actual index for keyboard navigation (after autocomplete items)\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product, idx)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {/* Pozci badge */}\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.originalPrice && product.originalPrice > (product.salePrice || product.price) && (\n                          <>\n                            <span className=\"text-xs text-gray-400 line-through\">\n                              {product.originalPrice.toLocaleString()} Ft\n                            </span>\n                            <span className=\"text-xs bg-gradient-to-r from-red-500 to-pink-500 text-white px-2 py-0.5 rounded-full font-bold shadow-sm\">\n                              -{Math.round((1 - (product.salePrice || product.price) / product.originalPrice) * 100)}%\n                            </span>\n                          </>\n                        )}\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* \"Erre gondoltl?\" javaslat */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.didYouMean && (\n            <div className=\"px-4 py-3 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-amber-100\">\n              <button\n                onClick={() => handleSuggestionClick(typeof searchResults.didYouMean === 'string' ? searchResults.didYouMean : searchResults.didYouMean?.query)}\n                className=\"flex items-center gap-2 text-sm group\"\n              >\n                <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                <span className=\"text-gray-600\">Erre gondoltl?</span>\n                <span className=\"font-semibold text-amber-700 group-hover:text-amber-800 underline underline-offset-2\">\n                  {typeof searchResults.didYouMean === 'string' ? searchResults.didYouMean : searchResults.didYouMean?.query}\n                </span>\n                <ArrowRight className=\"w-4 h-4 text-amber-500 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </div>\n          )}\n\n          {/* Nincs tallat - finomtott empty state */}\n          {serverSearchMode && debouncedQuery.length >= 2 && !serverPreview.loading && serverPreview.results.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              {(() => {\n                const didYouMean = getDidYouMeanSuggestion(debouncedQuery);\n                return didYouMean ? (\n                  <div className=\"mb-5\">\n                    <button\n                      onClick={() => handleSuggestionClick(didYouMean)}\n                      className=\"inline-flex items-center gap-2 px-4 py-2 bg-amber-50 hover:bg-amber-100 border border-amber-200 rounded-xl text-amber-800 font-medium transition-colors\"\n                    >\n                      <Lightbulb className=\"w-4 h-4\" />\n                      Taln ezt kerested: {didYouMean}\n                    </button>\n                  </div>\n                ) : null;\n              })()}\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n          {!serverSearchMode && debouncedQuery.length >= 2 && (!searchResults.results || searchResults.results.length === 0) && autocompleteSuggestions.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              \n              {/* Javaslatok */}\n              {searchResults.suggestions?.length > 0 && (\n                <div className=\"space-y-3\">\n                  <p className=\"text-xs text-gray-500 uppercase tracking-wide font-semibold\">Prbld ezeket:</p>\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    {searchResults.suggestions.map((sug, i) => (\n                      <button\n                        key={i}\n                        onClick={() => handleSuggestionClick({ text: sug.action })}\n                        className=\"inline-flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-200 hover:border-primary-300 hover:bg-primary-50 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all shadow-sm hover:shadow\"\n                      >\n                        <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Npszer keressek fallback */}\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Betlts jelz gpels kzben - shimmer UX */}\n          {query.length >= 2 && query !== debouncedQuery && (\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-center gap-3 mb-4\">\n                <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin shrink-0\" />\n                <span className=\"text-sm font-medium text-gray-600\">Keress...</span>\n              </div>\n              <div className=\"space-y-2\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"search-loading-shimmer h-16 rounded-xl\" />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Kezdllapot - amikor nincs query */}\n          {debouncedQuery.length < 2 && query.length < 2 && (\n            <>\n              {/* Proaktv AI javaslatok */}\n              {proactiveSuggestions.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100 bg-gradient-to-r from-primary-50/50 to-secondary-50/50\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-600 uppercase tracking-wider flex items-center gap-1.5 mb-2\">\n                    <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                    Szemlyre szabott ajnlatok\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {proactiveSuggestions.map((sug, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(sug)}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-white hover:bg-primary-50 border border-gray-200 hover:border-primary-300 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all hover:shadow-sm\"\n                      >\n                        <span>{sug.icon}</span>\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Korbbi keressek */}\n              {recentSearches.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <History className=\"w-3.5 h-3.5\" />\n                    Korbbi keressek\n                  </p>\n                  <div className=\"mt-2 space-y-1\">\n                    {recentSearches.map((search, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(search)}\n                        className=\"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-gray-50 transition-colors text-left group\"\n                      >\n                        <Clock className=\"w-4 h-4 text-gray-400\" />\n                        <span className=\"flex-1 text-sm text-gray-700\">{search}</span>\n                        <ArrowRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Nemrg nzett termkek */}\n              {recentlyViewed.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Eye className=\"w-3.5 h-3.5\" />\n                    Nemrg nzett\n                  </p>\n                  <div className=\"mt-2 flex gap-3 overflow-x-auto pb-2 scrollbar-hide\">\n                    {recentlyViewed.map((product, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleProductClick(product, 0, false)}\n                        className=\"flex-shrink-0 w-24 group\"\n                      >\n                        <div className=\"w-24 h-24 bg-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all\">\n                          {product.image ? (\n                            <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n                          ) : (\n                            <div className=\"w-full h-full flex items-center justify-center\">\n                              <Package className=\"w-8 h-8 text-gray-300\" />\n                            </div>\n                          )}\n                        </div>\n                        <p className=\"mt-1.5 text-xs text-gray-700 truncate group-hover:text-primary-600 transition-colors font-medium\">\n                          {product.name}\n                        </p>\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {product.price?.toLocaleString()} Ft\n                        </p>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Trendi keressek */}\n              <div className=\"p-3\">\n                <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <TrendingUp className=\"w-3.5 h-3.5 text-primary-500\" />\n                  Npszer keressek\n                </p>\n                <div className=\"mt-2 flex flex-wrap gap-2\">\n                  {trendingSearches.map((item, idx) => (\n                    <button\n                      key={idx}\n                      onClick={() => handleSuggestionClick(item.text)}\n                      className=\"flex items-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-xl text-sm font-medium transition-colors\"\n                    >\n                      <span>{item.icon}</span>\n                      {item.text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Gyors kategrik */}\n              {categories.length > 0 && (\n                <div className=\"p-3 pt-0\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Filter className=\"w-3.5 h-3.5\" />\n                    Kategrik\n                  </p>\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {categories.slice(0, 6).map((cat, idx) => {\n                      const name = typeof cat === 'string' ? cat : cat.name;\n                      const count = typeof cat === 'string' ? null : cat.totalCount;\n                      return (\n                        <button\n                          key={idx}\n                          onClick={() => handleSuggestionClick(name)}\n                          className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm transition-colors flex items-center gap-2\"\n                        >\n                          <span>{name}</span>\n                          {typeof count === 'number' && (\n                            <span className=\"text-xs text-gray-500\">({count.toLocaleString('hu-HU')})</span>\n                          )}\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {/* Footer - keressi tippek s keyboard hints */}\n          <div className=\"px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-t border-gray-100\">\n            <div className=\"flex items-center justify-between flex-wrap gap-2\">\n              <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                {indexStatus.building ? (\n                  <span className=\"flex items-center gap-1.5 text-amber-600\">\n                    <div className=\"w-3 h-3 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" />\n                     Tanuls folyamatban...\n                  </span>\n                ) : indexStatus.ready ? (\n                  <span className=\"flex items-center gap-1.5 text-green-600\">\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                     {indexStatus.count?.toLocaleString()} termk betanulva\n                  </span>\n                ) : (\n                  <span> Keress termszetesen, pl. &quot;fehr kanap 150e alatt&quot;</span>\n                )}\n              </div>\n              <div className=\"flex items-center gap-3 text-xs text-gray-400 flex-wrap\">\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">/</kbd>\n                  <span>keress</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\"></kbd>\n                  <span>navigls</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Enter</kbd>\n                  <span>kivlaszts</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Esc</kbd>\n                  <span>bezrs</span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SmartSearchBar;\n","import React, { useState } from 'react';\nimport { Ruler, Camera, Check, X, AlertTriangle, RefreshCw, Maximize2, ArrowRight, Home, HelpCircle, Sparkles } from 'lucide-react';\n\n/**\n * ARMeasure - AR Measurement tool for checking if furniture fits\n * Room dimension calculator and fit checker\n */\nconst ARMeasure = ({ \n  product,\n  onClose,\n  onConfirmFit \n}) => {\n  const [step, setStep] = useState('input'); // 'input' | 'measuring' | 'result'\n  const [roomDimensions, setRoomDimensions] = useState({\n    width: '',\n    length: '',\n    height: ''\n  });\n  const [fitResult, setFitResult] = useState(null);\n\n  // Product dimensions (mock if not provided)\n  const productDimensions = {\n    width: product?.dimensions?.width || 220,\n    depth: product?.dimensions?.depth || 95,\n    height: product?.dimensions?.height || 85,\n  };\n\n  const handleDimensionChange = (field, value) => {\n    const numValue = value.replace(/[^0-9]/g, '');\n    setRoomDimensions(prev => ({ ...prev, [field]: numValue }));\n  };\n\n  const handleCheckFit = () => {\n    setStep('measuring');\n    \n    // Simulate measurement processing\n    setTimeout(() => {\n      const roomW = parseInt(roomDimensions.width) || 0;\n      const roomL = parseInt(roomDimensions.length) || 0;\n      const roomH = parseInt(roomDimensions.height) || 300;\n      \n      const fitsWidth = productDimensions.width + 100 <= roomW; // 100cm clearance\n      const fitsDepth = productDimensions.depth + 80 <= roomL; // 80cm walkway\n      const fitsHeight = productDimensions.height + 50 <= roomH;\n      \n      const spaceFit = fitsWidth && fitsDepth && fitsHeight;\n      const tightFit = !spaceFit && (productDimensions.width <= roomW && productDimensions.depth <= roomL);\n      \n      setFitResult({\n        fits: spaceFit,\n        tightFit: tightFit,\n        details: {\n          width: { room: roomW, product: productDimensions.width, fits: fitsWidth },\n          depth: { room: roomL, product: productDimensions.depth, fits: fitsDepth },\n          height: { room: roomH, product: productDimensions.height, fits: fitsHeight },\n        },\n        suggestions: !spaceFit ? [\n          tightFit ? 'Szoros illeszkeds - kevs mozgstr marad' : 'Vlassz kisebb mretet',\n          'Mrj jra pontosan',\n          'Nzd meg a hasonl, kisebb termkeket'\n        ] : []\n      });\n      \n      setStep('result');\n    }, 1500);\n  };\n\n  const resetMeasurement = () => {\n    setStep('input');\n    setRoomDimensions({ width: '', length: '', height: '' });\n    setFitResult(null);\n  };\n\n  const isFormValid = roomDimensions.width && roomDimensions.length;\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-secondary-500 to-secondary-700 p-4 sm:p-5 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n              <Ruler className=\"w-5 h-5\" />\n            </div>\n            <div>\n              <h3 className=\"font-bold text-lg\">Befr-e?</h3>\n              <p className=\"text-white/80 text-sm\">Mret ellenrzs</p>\n            </div>\n          </div>\n          {onClose && (\n            <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-lg transition-colors\">\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Product Dimensions Card */}\n      <div className=\"p-4 bg-gray-50 border-b border-gray-200\">\n        <div className=\"flex items-center gap-3 mb-3\">\n          <div className=\"w-14 h-14 bg-white rounded-xl overflow-hidden shrink-0 shadow-sm\">\n            {product?.image ? (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\n                <Home className=\"w-6 h-6 text-gray-300\" />\n              </div>\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n          </div>\n        </div>\n        \n        <div className=\"grid grid-cols-3 gap-2\">\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Szlessg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.width} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Mlysg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.depth} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Magassg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.height} cm</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Step Content */}\n      <div className=\"p-4 sm:p-5\">\n        {/* Input Step */}\n        {step === 'input' && (\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <label className=\"text-sm font-medium text-gray-900\">Add meg a szoba mreteit</label>\n                <button className=\"text-gray-400 hover:text-gray-600\">\n                  <HelpCircle className=\"w-4 h-4\" />\n                </button>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Szlessg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.width}\n                    onChange={(e) => handleDimensionChange('width', e.target.value)}\n                    placeholder=\"pl. 400\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Hosszsg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.length}\n                    onChange={(e) => handleDimensionChange('length', e.target.value)}\n                    placeholder=\"pl. 500\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <label className=\"text-xs text-gray-500 mb-1 block\">Mennyezet magassg (opcionlis)</label>\n                <input\n                  type=\"text\"\n                  inputMode=\"numeric\"\n                  value={roomDimensions.height}\n                  onChange={(e) => handleDimensionChange('height', e.target.value)}\n                  placeholder=\"pl. 270\"\n                  className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                />\n              </div>\n            </div>\n\n            {/* AR Measure Option */}\n            <div className=\"bg-gradient-to-r from-secondary-50 to-primary-50 rounded-xl p-3 border border-secondary-100\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n                  <Camera className=\"w-5 h-5 text-secondary-600\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-gray-900\">AR Mrs</p>\n                  <p className=\"text-xs text-gray-500\">Mrd le kamerval</p>\n                </div>\n                <span className=\"px-2 py-1 bg-secondary-100 text-secondary-700 text-[10px] font-bold rounded-full\">\n                  Hamarosan\n                </span>\n              </div>\n            </div>\n\n            <button\n              onClick={handleCheckFit}\n              disabled={!isFormValid}\n              className={`w-full flex items-center justify-center gap-2 py-3.5 rounded-xl font-bold transition-all ${\n                isFormValid \n                  ? 'bg-gradient-to-r from-secondary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl hover:scale-[1.02]' \n                  : 'bg-gray-100 text-gray-400 cursor-not-allowed'\n              }`}\n            >\n              <Maximize2 className=\"w-5 h-5\" />\n              Ellenrzs\n            </button>\n          </div>\n        )}\n\n        {/* Measuring Step */}\n        {step === 'measuring' && (\n          <div className=\"text-center py-8\">\n            <div className=\"w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Ruler className=\"w-8 h-8 text-secondary-600 animate-pulse\" />\n            </div>\n            <h4 className=\"font-bold text-gray-900 mb-2\">Szmts folyamatban...</h4>\n            <p className=\"text-sm text-gray-500\">Ellenrizzk, hogy befr-e a btor</p>\n          </div>\n        )}\n\n        {/* Result Step */}\n        {step === 'result' && fitResult && (\n          <div className=\"space-y-4\">\n            {/* Result Header */}\n            <div className={`p-4 rounded-xl ${\n              fitResult.fits \n                ? 'bg-green-50 border border-green-200' \n                : fitResult.tightFit \n                  ? 'bg-amber-50 border border-amber-200'\n                  : 'bg-red-50 border border-red-200'\n            }`}>\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                  fitResult.fits \n                    ? 'bg-green-500' \n                    : fitResult.tightFit \n                      ? 'bg-amber-500' \n                      : 'bg-red-500'\n                }`}>\n                  {fitResult.fits ? (\n                    <Check className=\"w-6 h-6 text-white\" />\n                  ) : fitResult.tightFit ? (\n                    <AlertTriangle className=\"w-6 h-6 text-white\" />\n                  ) : (\n                    <X className=\"w-6 h-6 text-white\" />\n                  )}\n                </div>\n                <div>\n                  <h4 className={`font-bold ${\n                    fitResult.fits \n                      ? 'text-green-700' \n                      : fitResult.tightFit \n                        ? 'text-amber-700' \n                        : 'text-red-700'\n                  }`}>\n                    {fitResult.fits \n                      ? 'Tkletesen befr!' \n                      : fitResult.tightFit \n                        ? 'Szoros illeszkeds' \n                        : 'Nem fr be'}\n                  </h4>\n                  <p className=\"text-sm text-gray-600\">\n                    {fitResult.fits \n                      ? 'A btor knyelmesen elfr a szobban' \n                      : fitResult.tightFit \n                        ? 'Fizikailag befr, de kevs hely marad' \n                        : 'Sajnos tl nagy a termk'}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Dimension Details */}\n            <div className=\"space-y-2\">\n              {Object.entries(fitResult.details).map(([key, data]) => (\n                <div key={key} className=\"flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg\">\n                  <span className=\"text-sm text-gray-600 capitalize\">\n                    {key === 'width' ? 'Szlessg' : key === 'depth' ? 'Mlysg' : 'Magassg'}\n                  </span>\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm text-gray-900\">\n                      {data.product} / {data.room} cm\n                    </span>\n                    {data.fits ? (\n                      <Check className=\"w-4 h-4 text-green-500\" />\n                    ) : (\n                      <X className=\"w-4 h-4 text-red-500\" />\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Suggestions */}\n            {fitResult.suggestions.length > 0 && (\n              <div className=\"bg-gray-50 rounded-xl p-3\">\n                <p className=\"text-xs font-medium text-gray-500 mb-2\">Javaslatok:</p>\n                <ul className=\"space-y-1\">\n                  {fitResult.suggestions.map((suggestion, idx) => (\n                    <li key={idx} className=\"flex items-center gap-2 text-sm text-gray-700\">\n                      <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                      {suggestion}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={resetMeasurement}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                jra\n              </button>\n              {fitResult.fits && (\n                <button\n                  onClick={() => onConfirmFit?.()}\n                  className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:shadow-lg transition-all\"\n                >\n                  Kosrba\n                  <ArrowRight className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ARMeasure;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Minus, Plus, Check, Zap, ChevronUp, Star, Truck } from 'lucide-react';\n\n/**\n * StickyAddToCartMobile - Floating add to cart bar for mobile\n * Always visible, smooth UX with quantity selector\n */\nconst StickyAddToCartMobile = ({ \n  product,\n  isVisible = true,\n  onAddToCart,\n  onToggleWishlist,\n  isInWishlist = false,\n  isInCart = false,\n  freeShippingThreshold = 50000\n}) => {\n  const [quantity, setQuantity] = useState(1);\n  const [showQuantity, setShowQuantity] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [justAdded, setJustAdded] = useState(false);\n\n  const price = product?.price || 0;\n  const originalPrice = product?.originalPrice;\n  const discount = originalPrice ? Math.round((1 - price / originalPrice) * 100) : 0;\n  const totalPrice = price * quantity;\n  const freeShippingRemaining = Math.max(0, freeShippingThreshold - totalPrice);\n\n  const handleAddToCart = async () => {\n    setIsAdding(true);\n    try {\n      await onAddToCart?.(product, quantity);\n      setJustAdded(true);\n      setTimeout(() => {\n        setJustAdded(false);\n        setQuantity(1);\n        setShowQuantity(false);\n      }, 2000);\n    } catch {\n      /* handled by parent / toast */\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const incrementQuantity = () => setQuantity(q => Math.min(q + 1, 10));\n  const decrementQuantity = () => setQuantity(q => Math.max(q - 1, 1));\n\n  if (!isVisible || !product) return null;\n\n  return (\n    <>\n      {/* Backdrop when quantity selector is open */}\n      {showQuantity && (\n        <div \n          className=\"fixed inset-0 bg-black/20 z-40 sm:hidden\"\n          onClick={() => setShowQuantity(false)}\n        />\n      )}\n\n      {/* Sticky Bar - Mobile Only */}\n      <div className=\"fixed bottom-0 left-0 right-0 z-50 sm:hidden\">\n        {/* Free Shipping Progress - Compact */}\n        {freeShippingRemaining > 0 && freeShippingRemaining < freeShippingThreshold && (\n          <div className=\"bg-gradient-to-r from-emerald-500 to-green-500 px-4 py-1.5\">\n            <div className=\"flex items-center justify-center gap-2 text-white text-xs\">\n              <Truck className=\"w-3.5 h-3.5\" />\n              <span>Mg <strong>{freeShippingRemaining.toLocaleString()} Ft</strong> az ingyenes szlltsig!</span>\n            </div>\n          </div>\n        )}\n\n        {/* Quantity Selector Panel */}\n        {showQuantity && (\n          <div className=\"bg-white border-t border-gray-200 px-4 py-3 animate-slide-up\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium text-gray-700\">Mennyisg</span>\n              <div className=\"flex items-center gap-3 bg-gray-100 rounded-xl p-1\">\n                <button\n                  onClick={decrementQuantity}\n                  disabled={quantity <= 1}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Minus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n                <span className=\"w-8 text-center font-bold text-gray-900 text-lg\">{quantity}</span>\n                <button\n                  onClick={incrementQuantity}\n                  disabled={quantity >= 10}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Plus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-gray-100\">\n              <span className=\"text-sm text-gray-600\">sszesen:</span>\n              <span className=\"text-xl font-black text-gray-900\">{totalPrice.toLocaleString()} Ft</span>\n            </div>\n          </div>\n        )}\n\n        {/* Main Bar */}\n        <div className=\"bg-white border-t border-gray-200 px-3 py-2.5 shadow-[0_-4px_20px_rgba(0,0,0,0.1)]\">\n          <div className=\"flex items-center gap-2\">\n            {/* Wishlist Button */}\n            <button\n              onClick={() => onToggleWishlist?.(product)}\n              className={`w-12 h-12 flex items-center justify-center rounded-xl border-2 transition-all ${\n                isInWishlist \n                  ? 'bg-red-50 border-red-200 text-red-500' \n                  : 'bg-white border-gray-200 text-gray-500'\n              }`}\n            >\n              <Heart className={`w-5 h-5 ${isInWishlist ? 'fill-current' : ''}`} />\n            </button>\n\n            {/* Price & Quantity Toggle */}\n            <button\n              onClick={() => setShowQuantity(!showQuantity)}\n              className=\"flex-1 flex items-center justify-between px-3 py-2 bg-gray-50 rounded-xl\"\n            >\n              <div className=\"text-left\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-black text-gray-900 text-lg\">{price.toLocaleString()} Ft</span>\n                  {discount > 0 && (\n                    <span className=\"px-1.5 py-0.5 bg-red-100 text-red-600 text-[10px] font-bold rounded\">\n                      -{discount}%\n                    </span>\n                  )}\n                </div>\n                {quantity > 1 && (\n                  <span className=\"text-xs text-gray-500\">{quantity} db = {totalPrice.toLocaleString()} Ft</span>\n                )}\n              </div>\n              <ChevronUp className={`w-5 h-5 text-gray-400 transition-transform ${showQuantity ? 'rotate-180' : ''}`} />\n            </button>\n\n            {/* Add to Cart Button */}\n            <button\n              onClick={handleAddToCart}\n              disabled={isAdding || justAdded}\n              className={`h-12 px-5 flex items-center justify-center gap-2 rounded-xl font-bold text-sm transition-all ${\n                justAdded\n                  ? 'bg-green-500 text-white'\n                  : isAdding\n                    ? 'bg-gray-200 text-gray-500'\n                    : 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white shadow-lg active:scale-95'\n              }`}\n            >\n              {justAdded ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span>Hozzadva!</span>\n                </>\n              ) : isAdding ? (\n                <div className=\"w-5 h-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\" />\n              ) : (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span>Kosrba</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.2s ease-out; }\n      `}</style>\n    </>\n  );\n};\n\nexport default StickyAddToCartMobile;\n","import React from 'react';\nimport { Shield, Truck, RefreshCw, CreditCard, Award, Clock, Phone, Lock, CheckCircle, Star, Heart, Headphones } from 'lucide-react';\n\n/**\n * TrustBadges - Trust signals and guarantees\n * Multiple variants for different placements\n */\nconst TrustBadges = ({ \n  variant = 'footer', // 'footer' | 'product' | 'checkout' | 'mini' | 'horizontal'\n  className = ''\n}) => {\n  const badges = [\n    {\n      icon: Truck,\n      title: 'Ingyenes szllts',\n      description: '50.000 Ft felett',\n      color: 'text-emerald-600',\n      bgColor: 'bg-emerald-50',\n    },\n    {\n      icon: RefreshCw,\n      title: '30 napos visszaklds',\n      description: 'Krds nlkl',\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n    },\n    {\n      icon: Shield,\n      title: 'Biztonsgos fizets',\n      description: 'SSL titkosts',\n      color: 'text-purple-600',\n      bgColor: 'bg-purple-50',\n    },\n    {\n      icon: Award,\n      title: '2 v garancia',\n      description: 'Minden termkre',\n      color: 'text-amber-600',\n      bgColor: 'bg-amber-50',\n    },\n    {\n      icon: Headphones,\n      title: 'gyflszolglat',\n      description: 'H-P 8:00-18:00',\n      color: 'text-secondary-600',\n      bgColor: 'bg-secondary-50',\n    },\n    {\n      icon: Heart,\n      title: '50.000+ elgedett vsrl',\n      description: '4.9/5 rtkels',\n      color: 'text-red-500',\n      bgColor: 'bg-red-50',\n    },\n  ];\n\n  // Mini variant - icons only, horizontal\n  if (variant === 'mini') {\n    return (\n      <div className={`flex items-center justify-center gap-4 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-1.5 text-gray-600\"\n            title={badge.title}\n          >\n            <badge.icon className=\"w-4 h-4\" />\n            <span className=\"text-xs font-medium hidden sm:inline\">{badge.title.split(' ')[0]}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Horizontal variant - single row with all info\n  if (variant === 'horizontal') {\n    return (\n      <div className={`bg-gray-50 border-y border-gray-200 py-4 ${className}`}>\n        <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 overflow-x-auto scrollbar-hide\">\n            {badges.slice(0, 4).map((badge, idx) => (\n              <div key={idx} className=\"flex items-center gap-3 shrink-0\">\n                <div className={`w-10 h-10 ${badge.bgColor} rounded-xl flex items-center justify-center`}>\n                  <badge.icon className={`w-5 h-5 ${badge.color}`} />\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900 text-sm whitespace-nowrap\">{badge.title}</p>\n                  <p className=\"text-xs text-gray-500\">{badge.description}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Product variant - compact badges for product page\n  if (variant === 'product') {\n    return (\n      <div className={`grid grid-cols-2 gap-2 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-2 p-2.5 bg-gray-50 rounded-xl\"\n          >\n            <badge.icon className={`w-5 h-5 ${badge.color} shrink-0`} />\n            <div className=\"min-w-0\">\n              <p className=\"text-xs font-medium text-gray-900 truncate\">{badge.title}</p>\n              <p className=\"text-[10px] text-gray-500 truncate\">{badge.description}</p>\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Checkout variant - reassurance badges\n  if (variant === 'checkout') {\n    const checkoutBadges = [\n      { icon: Lock, text: 'Biztonsgos fizets', color: 'text-green-600' },\n      { icon: Shield, text: 'Adatvdelem', color: 'text-blue-600' },\n      { icon: RefreshCw, text: 'Pnzvisszafizets', color: 'text-purple-600' },\n    ];\n\n    return (\n      <div className={`flex items-center justify-center gap-6 py-3 ${className}`}>\n        {checkoutBadges.map((badge, idx) => (\n          <div key={idx} className=\"flex items-center gap-1.5\">\n            <badge.icon className={`w-4 h-4 ${badge.color}`} />\n            <span className=\"text-xs text-gray-600 font-medium\">{badge.text}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Footer variant - full display\n  return (\n    <div className={`bg-gradient-to-b from-gray-50 to-gray-100 py-10 sm:py-12 ${className}`}>\n      <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h3 className=\"text-lg sm:text-xl font-bold text-gray-900 mb-2\">\n            Mirt vlassz minket?\n          </h3>\n          <p className=\"text-sm text-gray-600\">\n            Tbb mint 50.000 elgedett vsrl bzik bennnk\n          </p>\n        </div>\n\n        {/* Badges Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n          {badges.map((badge, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white rounded-2xl p-4 sm:p-5 text-center border border-gray-100 shadow-sm hover:shadow-md transition-shadow\"\n            >\n              <div className={`w-12 h-12 ${badge.bgColor} rounded-xl flex items-center justify-center mx-auto mb-3`}>\n                <badge.icon className={`w-6 h-6 ${badge.color}`} />\n              </div>\n              <h4 className=\"font-bold text-gray-900 text-sm mb-1\">{badge.title}</h4>\n              <p className=\"text-xs text-gray-500\">{badge.description}</p>\n            </div>\n          ))}\n        </div>\n\n        {/* Payment Methods & Security */}\n        <div className=\"mt-8 pt-8 border-t border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            {/* Payment Methods */}\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-xs text-gray-500\">Fizetsi mdok:</span>\n              <div className=\"flex items-center gap-2\">\n                {['Visa', 'Mastercard', 'PayPal', 'Apple Pay'].map((method, idx) => (\n                  <div \n                    key={idx}\n                    className=\"h-8 px-3 bg-white rounded-lg border border-gray-200 flex items-center justify-center\"\n                  >\n                    <span className=\"text-xs font-medium text-gray-700\">{method}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Security Badge */}\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-green-50 rounded-full\">\n              <Lock className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-xs font-medium text-green-700\">256-bit SSL titkosts</span>\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Trust Rating */}\n        <div className=\"mt-6 flex items-center justify-center gap-4\">\n          <div className=\"flex items-center gap-1\">\n            {[1, 2, 3, 4, 5].map(star => (\n              <Star key={star} className=\"w-5 h-5 text-yellow-400 fill-yellow-400\" />\n            ))}\n          </div>\n          <span className=\"text-sm text-gray-600\">\n            <strong className=\"text-gray-900\">4.9/5</strong> rtkels 12.000+ vlemny alapjn\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TrustBadges;\n","import { useEffect, useState, useRef } from 'react';\n\n/**\n * Custom hook for detecting mobile viewport\n */\nexport const useIsMobile = (breakpoint = 768) => {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < breakpoint);\n    };\n\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    \n    return () => window.removeEventListener('resize', checkMobile);\n  }, [breakpoint]);\n\n  return isMobile;\n};\n\n/**\n * Custom hook for managing localStorage\n */\nexport const useLocalStorage = (key, initialValue) => {\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      console.error(error);\n      return initialValue;\n    }\n  });\n\n  const setValue = (value) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return [storedValue, setValue];\n};\n\n/**\n * Custom hook for debouncing values\n */\nexport const useDebounce = (value, delay = 500) => {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n};\n\n/**\n * Custom hook for intersection observer (lazy loading).\n * options is read from ref to avoid re-creating observer on every render.\n */\nexport const useIntersectionObserver = (options = {}) => {\n  const [ref, setRef] = useState(null);\n  const [isIntersecting, setIsIntersecting] = useState(false);\n  const optionsRef = useRef(options);\n  optionsRef.current = options;\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!ref || !(ref instanceof Element)) return;\n\n    const observer = new IntersectionObserver(([entry]) => {\n      setIsIntersecting(entry.isIntersecting);\n    }, optionsRef.current);\n\n    try {\n      observer.observe(ref);\n    } catch (err) {\n      return;\n    }\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref]);\n\n  return [setRef, isIntersecting];\n};\n\n// Re-export from other hook files\nexport { useToast } from './useToast';\nexport { useInfiniteScroll, InfiniteScrollSentinel } from './useInfiniteScroll.jsx';\nexport { \n  useScrollAnimation, \n  useStaggerAnimation, \n  useParallax, \n  useScrollProgress \n} from './useScrollAnimation';\nexport { useScrollLock } from './useScrollLock';\n","import React, { useState, useEffect, useRef } from 'react';\n\nconst DEFAULT_ROOT_MARGIN = '200px';\nconst DEFAULT_THRESHOLD = 0;\n\n/**\n * useDeferredSection - IntersectionObserver-based deferred mount.\n * Children mount only when the wrapper is near the viewport (rootMargin).\n * @param {Object} options - { rootMargin, threshold }\n * @returns {[React.RefObject, boolean]} - [ref to attach to wrapper, shouldMount]\n */\nexport function useDeferredSection(options = {}) {\n  const { rootMargin = DEFAULT_ROOT_MARGIN, threshold = DEFAULT_THRESHOLD } = options;\n  const [shouldMount, setShouldMount] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el || !(el instanceof Element) || shouldMount) return;\n\n    const io = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) setShouldMount(true);\n      },\n      { rootMargin, threshold }\n    );\n    io.observe(el);\n    return () => io.disconnect();\n  }, [rootMargin, threshold, shouldMount]);\n\n  return [ref, shouldMount];\n}\n\n/**\n * DeferredSection - Wrapper that defers rendering children until near viewport.\n * Uses a minimal sentinel (min-height) when not mounted so IntersectionObserver can fire.\n */\nexport function DeferredSection({ children, rootMargin = '200px', threshold = 0, fallback = null, className = '', minHeight = '100px', ...rest }) {\n  const [ref, shouldMount] = useDeferredSection({ rootMargin, threshold });\n  const content = shouldMount ? children : (fallback ?? <div style={{ minHeight }} aria-hidden=\"true\" />);\n  return (\n    <div ref={ref} className={className} {...rest}>\n      {content}\n    </div>\n  );\n}\n","/**\n * Marketly AI Btorbolt  kzponti konfigurci\n * Egy helyen: domain, shop id, batch mret, tab hash mapping.\n */\n\nexport const WEBSHOP_DOMAIN = 'https://www.marketly.hu';\nexport const SHOP_ID = '81697';\n\n/** Kezdeti s \"load more\" batch mret a termk listnl */\nexport const DISPLAY_BATCH = 36;\n/** Els lap mrete (API)  gyors first paint, alacsony memria */\nexport const INITIAL_PAGE = 36;\n\n/** Tab rtkek s hash (#shop, #visual-search, #room-planner) */\nexport const TAB_HASH = {\n  shop: 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n\nexport const HASH_TO_TAB = {\n  '': 'shop',\n  'shop': 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n","import React, { useState, useEffect, useLayoutEffect, useRef, useMemo, useCallback, Suspense, lazy } from 'react';\nimport { ShoppingCart, Camera, MessageCircle, X, Send, Plus, Trash2, Home, ZoomIn, Upload, RefreshCw, AlertCircle, Database, Lock, Search, ChevronLeft, ChevronRight, Filter, Heart, Info, Check, Star, Truck, ShieldCheck, Phone, ArrowRight, Mail, Eye, Sparkles, Lightbulb, Menu, Bot, Moon, Sun, Clock, Gift, Zap, TrendingUp, Instagram, Facebook, MapPin, Grid3X3, ExternalLink, Timer, ChevronDown } from 'lucide-react';\n// framer-motion removed due to Vite production build TDZ issues\nimport { fetchUnasProducts, refreshUnasProducts, fetchCategories, fetchCategoryHierarchy, fetchSearchIndex, fetchProductStats, fetchUnasProductById } from './services/unasApi';\nimport { addToUnasCart } from './services/unasCartService';\nimport { trackProductView as trackProductViewPref, getPersonalizedRecommendations, getSimilarProducts } from './services/userPreferencesService';\n\n// New UI Components\nimport { ProductCardSkeleton } from './components/ui/Skeleton';\nimport { ToastProvider, useToast } from './components/ui/Toast';\nimport { NoSearchResults, NoFilterResults, ErrorState } from './components/ui/EmptyState';\nimport { SmartBadges } from './components/ui/Badge';\n\n// AI Components\nimport { AIShowcase, AIOnboarding } from './components/ai/AIShowcase';\n// Lazy load heavier AI features for smaller initial bundle\nconst AIChatAssistant = lazy(() => import('./components/ai/AIChatAssistant'));\nconst AIRoomDesigner = lazy(() => import('./components/ai/AIRoomDesigner'));\nconst AIStyleQuiz = lazy(() => import('./components/ai/AIStyleQuiz'));\n\n// Category Components\nimport CategorySwipe from './components/category/CategorySwipe';\nimport CategoryPage from './components/category/CategoryPage';\nimport CollectionPage from './components/collection/CollectionPage';\nimport MainCategoriesSection from './components/category/MainCategoriesSection';\nimport { getCollectionById } from './config/collections';\nimport Navbar from './components/layout/Navbar';\n\n// UX Components\nimport ScrollProgress from './components/ux/ScrollProgress';\nimport BackToTop from './components/ux/BackToTop';\nimport LiveSocialProof from './components/ux/LiveSocialProof';\nimport LiveActivityStrip from './components/ux/LiveActivityStrip';\n\n// Landing Components  \nimport { ModernHero } from './components/landing/ModernHero';\nconst AIModuleUnified = lazy(() => import('./components/landing/AIModuleUnified'));\nimport { InteractiveCTA } from './components/landing/ShowcaseSections';\nconst InspirationSection = lazy(() => import('./components/landing/InspirationSection'));\nconst ProductWorldsSection = lazy(() => import('./components/landing/ProductWorldsSection'));\n// Footer eltvoltva - a f UNAS shopnak mr van sajt lblcce\n\n// Product Components\nimport { EnhancedProductCard } from './components/product/EnhancedProductCard';\nimport { SimilarProducts } from './components/product/SimilarProducts';\nimport { RecentlyViewed, trackProductView } from './components/product/RecentlyViewed';\nimport { ProductComparison, useComparison } from './components/product/ProductComparison';\nimport { AdvancedFilters, AdvancedFiltersPanel, applyFilters } from './components/product/AdvancedFilters';\nimport QuickAddToCart from './components/product/QuickAddToCart';\nimport ProductQuickPeek from './components/product/ProductQuickPeek';\nimport AIPricePredictor from './components/ai/AIPricePredictor';\n\n// Search Components - removed VoiceSearch (framer-motion bundling issue)\n\n// Marketing Components\nimport SmartNewsletterPopup from './components/marketing/SmartNewsletterPopup';\nimport ExitIntentPopup from './components/marketing/ExitIntentPopup';\nconst NewsletterStrip = lazy(() => import('./components/marketing/NewsletterStrip'));\n\n// AR Components\nimport ARProductPreview from './components/ar/ARProductPreview';\n\n// New UX Components\nimport CompleteTheLook from './components/product/CompleteTheLook';\nconst PersonalizedSection = lazy(() => import('./components/home/PersonalizedSection'));\nimport ImageGallery from './components/product/ImageGallery';\nimport StickyAddToCart from './components/product/StickyAddToCart';\nimport PriceAlert from './components/product/PriceAlert';\nimport { FadeInOnScroll, Confetti, CountUp } from './components/ui/Animations';\nimport BottomSheet from './components/mobile/BottomSheet';\n\n// New UX Components - Phase 2\nimport WishlistDrawer from './components/wishlist/WishlistDrawer';\nimport FlashSaleBanner from './components/marketing/FlashSaleBanner';\nimport DeliveryEstimator from './components/product/DeliveryEstimator';\nimport StockUrgency from './components/product/StockUrgency';\nimport ProductShare from './components/product/ProductShare';\nimport QuickActionsBar from './components/product/QuickActionsBar';\nimport ProductTabs from './components/product/ProductTabs';\nimport SmartBundle from './components/product/SmartBundle';\nimport PriceHistory from './components/product/PriceHistory';\nimport OneClickCheckout from './components/checkout/OneClickCheckout';\nimport SmartSearchBar from './components/search/SmartSearchBar';\nimport { parseSearchIntent, getDidYouMeanSuggestion } from './services/aiSearchService';\nconst LoyaltyProgram = lazy(() => import('./components/loyalty/LoyaltyProgram'));\nimport ARMeasure from './components/ar/ARMeasure';\nimport StickyAddToCartMobile from './components/mobile/StickyAddToCartMobile';\nimport TrustBadges from './components/trust/TrustBadges';\n\n// Hooks\nimport { useLocalStorage, useDebounce, useScrollLock } from './hooks/index';\nimport { DeferredSection } from './hooks/useDeferredSection';\n// useInfiniteScroll removed - using manual \"Load More\" button instead\n\n// Utils\nimport { getOptimizedImageProps } from './utils/imageOptimizer';\nimport { PLACEHOLDER_IMAGE, formatPrice, normalizeProduct } from './utils/helpers';\nimport { WEBSHOP_DOMAIN, SHOP_ID, DISPLAY_BATCH, INITIAL_PAGE, TAB_HASH, HASH_TO_TAB } from './config';\n\n/* --- 1. KONFIGURCI & ADATOK (config.js) --- */\n\nconst MODAL_LOADING_FALLBACK = (\n  <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30\">\n    <div className=\"w-10 h-10 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n  </div>\n);\n\n/* Scroll idztsek  egysges grgets a termk szekcihoz */\nconst SCROLL_DELAY_INITIAL = 80;   /* Els ksleltets (DOM render) */\nconst SCROLL_DELAY_RETRY = 200;    /* Msodik prblkozs (layout settle) */\nconst SCROLL_DELAY_FINAL = 400;    /* Harmadik (kpek/betltsek) */\nconst SCROLL_THROTTLE_MS = 180;    /* Minimum idklnbsg hvsok kztt */\nconst SCROLL_RETRY_MAX = 15;       /* Max retry, ha elem mg nincs DOM-ban */\n\n/* --- 2. SEGDFGGVNYEK --- */\n\nconst fixUrl = (url, type = 'main') => {\n    if (!url) return PLACEHOLDER_IMAGE;\n    let cleanUrl = url.trim().replace(/^\"|\"$/g, '');\n    \n    if (cleanUrl.length === 0) return PLACEHOLDER_IMAGE;\n    if (cleanUrl.startsWith('http')) return cleanUrl;\n\n    // UNAS specilis tvonalak kezelse\n    if (!cleanUrl.includes('/')) {\n        const folder = type === 'alt' ? 'shop_altpic' : 'shop_pic';\n        return `${WEBSHOP_DOMAIN}/shop_ordered/${SHOP_ID}/${folder}/${cleanUrl}`;\n    }\n\n    // Relatv tvonalak\n    if (cleanUrl.startsWith('/') || cleanUrl.startsWith('img/')) {\n        const path = cleanUrl.startsWith('/') ? cleanUrl : '/' + cleanUrl;\n        return WEBSHOP_DOMAIN.replace(/\\/$/, '') + path;\n    }\n\n    return cleanUrl;\n};\n\nconst generateAltImages = (mainImageUrl) => {\n    if (mainImageUrl.includes('/shop_pic/')) {\n        const baseUrl = mainImageUrl.replace('/shop_pic/', '/shop_altpic/');\n        const extIndex = baseUrl.lastIndexOf('.');\n        if (extIndex > -1) {\n            const basePath = baseUrl.substring(0, extIndex);\n            const ext = baseUrl.substring(extIndex);\n            return [\n                `${basePath}_altpic_1${ext}`,\n                `${basePath}_altpic_2${ext}`\n            ];\n        }\n    }\n    return [];\n};\n\nconst splitCSVLine = (line, delimiter) => {\n    const values = [];\n    let current = '';\n    let inQuotes = false;\n    for (let i = 0; i < line.length; i++) {\n        const char = line[i];\n        if (char === '\"') { inQuotes = !inQuotes; }\n        else if (char === delimiter && !inQuotes) { values.push(current); current = ''; }\n        else { current += char; }\n    }\n    values.push(current);\n    return values;\n};\n\nconst parseCSV = (csvText) => {\n  const lines = csvText.split(/\\r?\\n/);\n  const products = [];\n  if (lines.length < 2) return [];\n\n  const firstLine = lines[0];\n  const delimiter = (firstLine.match(/;/g) || []).length > (firstLine.match(/,/g) || []).length ? ';' : ',';\n  const headers = splitCSVLine(firstLine, delimiter).map(h => h.trim().replace(/^\"|\"$/g, ''));\n  \n  const findCol = (name) => headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));\n\n  const nameCol = findCol(\"Termk Nv\");\n  const priceCol = findCol(\"Brutt r\"); \n  const catCol = findCol(\"Kategria\");\n  const imgCol = findCol(\"Kp link\"); \n  const urlCol = findCol(\"Termk link\");\n  const descCol = findCol(\"Tulajdonsgok\");\n  const stockCol = findCol(\"Raktrkszlet\");\n  const altImgCol = findCol(\"Kp kapcsolat\"); \n  \n  const paramCols = headers.reduce((acc, header, index) => {\n      if (header.startsWith(\"Paramter:\")) {\n          const cleanName = header.replace(\"Paramter:\", \"\").split(\"|\")[0].trim();\n          acc.push({ index, name: cleanName });\n      }\n      return acc;\n  }, []);\n\n  for (let i = 1; i < lines.length; i++) {\n      if (!lines[i].trim()) continue;\n      const row = splitCSVLine(lines[i], delimiter);\n      const getVal = (colIndex) => colIndex > -1 && row[colIndex] ? row[colIndex].replace(/^\"|\"$/g, '').trim() : \"\";\n\n      const stock = getVal(stockCol);\n      const priceStr = getVal(priceCol);\n      if (!priceStr || !getVal(nameCol)) continue;\n\n      let categoryPath = getVal(catCol) || \"Egyb\";\n      const category = categoryPath.includes('>') ? categoryPath.split('>').pop().trim() : categoryPath;\n\n      const mainImgUrl = fixUrl(getVal(imgCol), 'main');\n      let images = [mainImgUrl];\n      \n      const altImgsRaw = getVal(altImgCol);\n      if (altImgsRaw) {\n          const alts = altImgsRaw.split(/[|]/).map(url => fixUrl(url.trim(), 'alt'));\n          images = [...images, ...alts].slice(0, 4);\n      } else {\n          const generatedAlts = generateAltImages(mainImgUrl);\n          images = [...images, ...generatedAlts];\n      }\n\n      let aiContextParams = [];\n      paramCols.forEach(p => {\n          const val = getVal(p.index);\n          if (val) aiContextParams.push(`${p.name}: ${val}`);\n      });\n      const paramsString = aiContextParams.join(\", \");\n\n      products.push({\n          id: `mkt-prod-${i}`,\n          name: getVal(nameCol),\n          price: parseInt(priceStr.replace(/[^0-9]/g, '')) || 0,\n          category: category,\n          images: images, \n          description: getVal(descCol).replace(/<[^>]*>/g, ' ').substring(0, 500),\n          params: paramsString,\n          link: fixUrl(getVal(urlCol)),\n          inStock: !(stock === '0' || stock.toLowerCase() === 'nincs')\n      });\n  }\n  return products;\n};\n\n// --- 3. KOMPONENSEK ---\n\nconst FileLoaderBar = ({ onFileLoad, onUnasRefresh, isLoadingUnas, lastUpdated, unasError }) => {\n    const fileInputRef = useRef(null);\n    \n    const formatTimestamp = (timestamp) => {\n        if (!timestamp) return '';\n        const date = new Date(timestamp);\n        const now = new Date();\n        const diffMs = now - date;\n        const diffMins = Math.floor(diffMs / 60000);\n        \n        if (diffMins < 1) return 'most';\n        if (diffMins < 60) return `${diffMins} perce`;\n        const diffHours = Math.floor(diffMins / 60);\n        if (diffHours < 24) return `${diffHours} rja`;\n        return date.toLocaleDateString('hu-HU');\n    };\n    \n    return (\n        <div id=\"mkt-butorbolt-loader\" className=\"bg-primary-500 text-white py-3 px-4 shadow-md\">\n            <div className=\"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-3\">\n                <div className=\"flex items-center\">\n                    <Database className=\"w-5 h-5 mr-2\" />\n                    <span className=\"text-sm font-medium\">\n                        {lastUpdated ? `Frisstve: ${formatTimestamp(lastUpdated)}` : 'Adatok betltse...'}\n                    </span>\n                    {unasError && (\n                        <span className=\"ml-2 text-xs bg-red-500 px-2 py-0.5 rounded-full flex items-center\">\n                            <AlertCircle className=\"w-3 h-3 mr-1\" /> Hiba\n                        </span>\n                    )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <input type=\"file\" ref={fileInputRef} accept=\".csv\" className=\"hidden\" onChange={(e) => {\n                        const file = e.target.files[0];\n                        if(file) {\n                            file.text().then(text => onFileLoad(parseCSV(text))).catch(err => console.warn('CSV betlts hiba:', err));\n                        }\n                    }} />\n                    <button \n                        onClick={() => fileInputRef.current?.click()} \n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm\"\n                    >\n                        <Upload className=\"w-4 h-4 mr-1.5\" /> CSV\n                    </button>\n                    <button \n                        onClick={onUnasRefresh}\n                        disabled={isLoadingUnas}\n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                        <RefreshCw className={`w-4 h-4 mr-1.5 ${isLoadingUnas ? 'animate-spin' : ''}`} /> \n                        {isLoadingUnas ? 'Frissts...' : 'UNAS Frissts'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst Features = () => (\n    <section className=\"py-12 sm:py-14 bg-white border-t border-gray-100\" aria-labelledby=\"features-heading\">\n        <div className=\"w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n            <h2 id=\"features-heading\" className=\"sr-only\">Szolgltatsok</h2>\n            <div className=\"flex flex-col lg:flex-row gap-4\">\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-emerald-50/50 border border-emerald-100 shadow-[0_6px_20px_rgba(16,185,129,0.08)] hover:shadow-[0_12px_28px_rgba(16,185,129,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-emerald-300 via-emerald-400 to-emerald-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Truck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">Ingyenes szllts</h3>\n                            <p className=\"text-sm text-gray-600\">50.000 Ft felett minden rendelsnl</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-blue-50/50 border border-blue-100 shadow-[0_6px_20px_rgba(59,130,246,0.08)] hover:shadow-[0_12px_28px_rgba(59,130,246,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-blue-300 via-blue-400 to-blue-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <ShieldCheck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">2 v garancia</h3>\n                            <p className=\"text-sm text-gray-600\">Minden termkre teljes kren</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-primary-50/45 border border-primary-100 shadow-[0_6px_20px_rgba(255,138,0,0.08)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-primary-300 via-primary-400 to-primary-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-700 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Phone className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">gyflszolglat</h3>\n                            <p className=\"text-sm text-gray-600\">Szakrt segtsg minden nap</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n);\n\nconst ProductModal = ({ product, isOpen, onClose, allProducts = [], onAddToCart }) => {\n    const [aiTip, setAiTip] = useState(null);\n    const [loadingTip, setLoadingTip] = useState(false);\n    useScrollLock(isOpen);\n    \n    useEffect(() => {\n        setAiTip(null);\n    }, [product]);\n\n    if (!isOpen || !product) return null;\n\n    const generateStyleTip = async () => {\n        setLoadingTip(true);\n        try {\n            const prompt = `Lakberendez vagy. Adj 2 rvid, konkrt tippet ehhez:\n            Termk: ${product.name} (${product.category})\n            Paramterek: ${product.params || \"Nincs adat\"}\n            Vlaszolj magyarul, emojikkal.`;\n\n            const { generateText } = await import('./services/geminiService');\n            const result = await generateText(prompt);\n            if (result.success) {\n                setAiTip(result.text);\n            } else {\n                setAiTip(\"Sajnos most nem tudok tippet adni.\");\n            }\n        } catch (error) {\n            setAiTip(\"Sajnos most nem tudok tippet adni.\");\n        } finally {\n            setLoadingTip(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in\" onClick={onClose}>\n            <div id=\"mkt-product-modal-root\" className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col relative\" onClick={e => e.stopPropagation()}>\n                <button onClick={onClose} className=\"absolute top-4 right-4 z-10 bg-white/80 p-2 rounded-full hover:bg-gray-100 transition-colors\"><X className=\"w-6 h-6 text-gray-600\" /></button>\n                \n                <div className=\"flex flex-col md:flex-row overflow-y-auto\">\n                  {/* Left: Image Gallery */}\n                  <div className=\"md:w-1/2 bg-gray-50 p-6\">\n                      <ImageGallery \n                        images={product.images || []} \n                        productName={product.name}\n                      />\n                  </div>\n\n                  {/* Right: Product Info */}\n                  <div className=\"md:w-1/2 p-6 md:p-8 overflow-y-auto\">\n                      <div className=\"flex items-center gap-2 mb-3\">\n                          <span className=\"bg-primary-50 text-primary-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide\">{product.category}</span>\n                          {product.inStock ?? product.in_stock ? \n                              <span className=\"text-green-600 text-xs font-bold flex items-center bg-green-50 px-2 py-1 rounded-full\"><Check className=\"w-3 h-3 mr-1\" /> Raktron</span> : \n                              <span className=\"text-red-500 text-xs font-bold bg-red-50 px-2 py-1 rounded-full\">Kszlethiny</span>\n                          }\n                      </div>\n                      <h2 className=\"text-2xl md:text-3xl font-extrabold text-gray-900 mb-2 leading-tight\">{product.name}</h2>\n                      <p className=\"text-2xl md:text-3xl font-bold text-primary-500 mb-4\">{formatPrice(product.price)}</p>\n                      \n                      {/* Price Alert & Share */}\n                      <div className=\"flex items-center gap-3 mb-4\">\n                        <PriceAlert product={product} />\n                        <ProductShare product={product} />\n                      </div>\n                      \n                      {/* Stock Urgency */}\n                      <div className=\"mb-4\">\n                        <StockUrgency product={product} variant=\"compact\" />\n                      </div>\n                      \n                      {/* Delivery Estimator */}\n                      <div className=\"mb-6\">\n                        <DeliveryEstimator product={product} variant=\"compact\" />\n                      </div>\n                      \n                      <div className=\"mb-6\">\n                          {!aiTip && !loadingTip && (\n                              <button onClick={generateStyleTip} className=\"w-full bg-gradient-to-r from-secondary-50 to-primary-50 hover:from-secondary-100 hover:to-primary-100 text-primary-600 p-4 rounded-xl border border-primary-100 flex items-center justify-center transition-all group\">\n                                  <Sparkles className=\"w-5 h-5 mr-2 group-hover:scale-110 transition-transform\" />\n                                  Krj AI Lakberendez tippet!\n                              </button>\n                          )}\n                          {loadingTip && (\n                              <div className=\"bg-gray-50 p-4 rounded-xl border border-gray-100 flex items-center justify-center text-gray-500 animate-pulse\">\n                                  <RefreshCw className=\"w-5 h-5 mr-2 animate-spin\" /> A tervez gondolkodik...\n                              </div>\n                          )}\n                          {aiTip && (\n                              <div className=\"bg-gradient-to-br from-primary-50 to-white p-5 rounded-xl border border-primary-100 shadow-sm animate-fade-in\">\n                                  <div className=\"flex items-center mb-2 text-primary-600 font-bold\"><Lightbulb className=\"w-5 h-5 mr-2\" /> AI Tipp:</div>\n                                  <div className=\"text-sm text-gray-700 leading-relaxed whitespace-pre-line\">{aiTip}</div>\n                              </div>\n                          )}\n                      </div>\n\n                      <div className=\"prose prose-sm text-gray-600 mb-6 border-t border-gray-100 pt-4\">\n                          <h4 className=\"font-bold text-gray-900 mb-2\">Lers</h4>\n                          <p className=\"text-sm\">{product.description || \"Nincs lers.\"}</p>\n                          {product.params && (\n                              <div className=\"mt-4 grid grid-cols-2 gap-2 text-xs\">\n                                  {product.params.split(',').slice(0, 6).map((param, i) => (\n                                      <div key={i} className=\"bg-gray-50 p-2 rounded text-gray-700\">{param.trim()}</div>\n                                  ))}\n                              </div>\n                          )}\n                      </div>\n\n                      {/* Complete The Look - AI Bundle */}\n                      {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <CompleteTheLook\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddToCart={onAddToCart}\n                          />\n                        </div>\n                      )}\n\n                      {/* Smart Bundle - temporarily disabled for debugging */}\n                      {/* {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <SmartBundle\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddBundle={(items, price) => {\n                              items.forEach(item => onAddToCart(item, 1));\n                            }}\n                          />\n                        </div>\n                      )} */}\n\n                      {/* Price History */}\n                      <div className=\"mb-6\">\n                        <PriceHistory\n                          currentPrice={product.price}\n                          productId={product.id}\n                          onSetAlert={(id, price) => console.log('Alert set for', id, price)}\n                        />\n                      </div>\n\n                      {/* Product Tabs - Details, Specs, Reviews */}\n                      <div className=\"mb-6\">\n                        <ProductTabs product={product} />\n                      </div>\n\n                      <div className=\"sticky bottom-0 bg-white pt-4 pb-4 border-t border-gray-200 mt-auto shadow-[0_-4px_12px_rgba(0,0,0,0.06)]\">\n                          <div className=\"flex flex-col xs:flex-row gap-3\">\n                              <button\n                                  type=\"button\"\n                                  onClick={() => onAddToCart(product, 1)}\n                                  disabled={!(product.inStock ?? product.in_stock)}\n                                  className=\"min-h-[44px] flex-1 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-xl font-bold text-base text-center transition-all shadow-lg flex items-center justify-center gap-2\"\n                              >\n                                  <ShoppingCart className=\"w-5 h-5\" />\n                                  Kosrba\n                              </button>\n                              <a href={product.link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"min-h-[44px] flex-1 bg-gray-900 text-white py-3 px-4 rounded-xl font-bold text-base text-center hover:bg-gray-800 transition-all shadow-lg flex items-center justify-center gap-2 border-2 border-gray-900 hover:border-gray-700\">\n                                  Megveszem a webshopban <ArrowRight className=\"w-5 h-5\" />\n                              </a>\n                          </div>\n                      </div>\n                  </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst VisualSearch = ({ products }) => {\n  const [selectedImage, setSelectedImage] = useState(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [searchResults, setSearchResults] = useState([]);\n  const [analysisText, setAnalysisText] = useState(\"\");\n\n  const handleImageUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => { setSelectedImage(reader.result); analyzeImage(reader.result); };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const analyzeImage = async (base64Image) => {\n    setIsAnalyzing(true); setSearchResults([]); setAnalysisText(\"Elemzs...\");\n    try {\n      const base64Data = base64Image.split(',')[1];\n      const prompt = \"Elemezd a btort. JSON: { \\\"style\\\": \\\"...\\\", \\\"category\\\": \\\"...\\\", \\\"color\\\": \\\"...\\\" } Magyarul.\";\n      const { analyzeImage: analyzeImageAI } = await import('./services/geminiService');\n      const result = await analyzeImageAI(base64Data, \"image/jpeg\", prompt);\n      \n      if (result.success && result.text) {\n        const analysis = JSON.parse(result.text);\n        if (analysis) {\n          setAnalysisText(`Felismerve: ${analysis.style} stlus ${analysis.color} ${analysis.category}.`);\n          const relevant = products.filter(p => p.category.toLowerCase().includes(analysis.category.toLowerCase()) || p.name.toLowerCase().includes(analysis.category.toLowerCase())).slice(0, 4);\n          setSearchResults(relevant);\n        }\n      } else {\n        setAnalysisText(\"Hiba az elemzsben.\");\n      }\n    } catch (error) { setAnalysisText(\"Hiba az elemzsben.\"); } \n    finally { setIsAnalyzing(false); }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto py-8 px-4\">\n      <div className=\"text-center mb-8\"><h2 className=\"text-3xl font-bold text-gray-900\">AI Vizulis Keres</h2></div>\n      <div className=\"bg-white rounded-xl shadow-lg p-8 mb-8 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-center\">\n        {!selectedImage ? (\n          <>\n            <div className=\"bg-primary-50 p-4 rounded-full mb-4\"><Camera className=\"w-8 h-8 text-primary-500\" /></div>\n            <label className=\"cursor-pointer bg-primary-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-600 transition-colors\">Fnykp feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleImageUpload} /></label>\n          </>\n        ) : (\n          <div className=\"relative w-full max-w-md mx-auto\">\n            <img src={selectedImage} alt=\"Uploaded\" className=\"rounded-lg shadow-md max-h-64 mx-auto\" />\n            <button onClick={() => { setSelectedImage(null); setSearchResults([]); }} className=\"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-md hover:bg-red-600\"><X className=\"w-4 h-4\" /></button>\n            {isAnalyzing && <div className=\"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center rounded-lg\"><span className=\"text-primary-700 font-bold animate-pulse\">Elemzs...</span></div>}\n          </div>\n        )}\n      </div>\n      {!isAnalyzing && selectedImage && searchResults.length === 0 && (\n        <p className=\"text-center text-gray-600 py-6\">Nincs tallat a feltlttt kp alapjn. Prblj msik fott vagy bngssz a kategrikban.</p>\n      )}\n      {searchResults.length > 0 && (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6\">{searchResults.map(product => (<div key={product.id} className=\"border border-gray-200 p-4 rounded-xl hover:shadow-lg transition-shadow\"><img src={product.images?.[0]} alt={product.name} className=\"h-32 mx-auto object-contain\" /><p className=\"font-bold mt-2 truncate\">{product.name}</p><p>{formatPrice(product.price)}</p></div>))}</div>\n      )}\n    </div>\n  );\n};\n\nconst RoomPlanner = ({ products }) => {\n  const [background, setBackground] = useState(null);\n  const [placedItems, setPlacedItems] = useState([]);\n  const [selectedItemId, setSelectedItemId] = useState(null);\n\n  const handleBackgroundUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) { const reader = new FileReader(); reader.onloadend = () => setBackground(reader.result); reader.readAsDataURL(file); }\n  };\n\n  const addItem = (product) => {\n    if (!background) { alert(\"Tlts fel szobt!\"); return; }\n    setPlacedItems([...placedItems, { id: Date.now(), image: product.images[0], x: 50, y: 50, scale: 1 }]);\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto py-8 px-4 flex flex-col lg:flex-row gap-6 h-[80vh]\">\n      <div className=\"lg:w-1/4 bg-white rounded-2xl shadow-lg border border-gray-200 flex flex-col overflow-hidden\">\n          <div className=\"p-4 border-b bg-gray-50\"><h3 className=\"font-bold\">Btorok</h3></div>\n          <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\n              {products.slice(0, 50).map(p => (\n                  <div key={p.id} onClick={() => addItem(p)} className=\"flex items-center gap-3 p-2 hover:bg-primary-50 rounded cursor-pointer\"><img src={p.images[0]} className=\"w-12 h-12 object-contain\" /><p className=\"text-xs font-bold truncate w-24\">{p.name}</p></div>\n              ))}\n          </div>\n      </div>\n      <div className=\"lg:w-3/4 bg-gray-100 rounded-2xl border-2 border-dashed relative overflow-hidden flex items-center justify-center\">\n          {!background ? (\n              <label className=\"bg-primary-500 text-white px-6 py-3 rounded-xl cursor-pointer\">Szobafot feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleBackgroundUpload} /></label>\n          ) : (\n              <div className=\"relative w-full h-full\">\n                  <img src={background} className=\"w-full h-full object-cover\" />\n                  {placedItems.map((item) => (\n                      <div key={item.id} className=\"absolute w-32 cursor-move\" style={{ left: `${item.x}%`, top: `${item.y}%`, transform: `translate(-50%, -50%) scale(${item.scale})` }} onClick={() => setSelectedItemId(item.id)}>\n                          <img src={item.image} className=\"w-full\" />\n                      </div>\n                  ))}\n              </div>\n          )}\n      </div>\n    </div>\n  );\n};\n\nconst App = () => {\n  const [activeTab, setActiveTabState] = useState(() => {\n    const hash = (typeof window !== 'undefined' && window.location.hash.slice(1)) || '';\n    return HASH_TO_TAB[hash] || 'shop';\n  });\n  const setActiveTab = useCallback((tab) => {\n    setActiveTabState(tab);\n    const hash = TAB_HASH[tab] ?? tab;\n    if (typeof window !== 'undefined') {\n      const newHash = hash ? `#${hash}` : '';\n      if (window.location.hash !== newHash) {\n        window.history.replaceState(null, '', window.location.pathname + window.location.search + newHash);\n      }\n    }\n  }, []);\n  const [products, setProducts] = useState([]);\n  const [totalProductsCount, setTotalProductsCount] = useState(0);\n  const [hasMoreProducts, setHasMoreProducts] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const filteredLengthRef = useRef(0);\n  const hasMoreProductsRef = useRef(hasMoreProducts);\n  const isLoadingMoreRef = useRef(isLoadingMore);\n  hasMoreProductsRef.current = hasMoreProducts;\n  isLoadingMoreRef.current = isLoadingMore;\n  const [wishlist, setWishlist] = useLocalStorage('mkt_wishlist', []);\n  const [wishlistItems, setWishlistItems] = useState([]);\n  const [sectionRotateTick, setSectionRotateTick] = useState(0);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const searchQueryRef = useRef(searchQuery);\n  searchQueryRef.current = searchQuery;\n  const SERVER_SEARCH_ONLY = true;\n  const MAX_LOCAL_INDEX = SERVER_SEARCH_ONLY ? 0 : 50000;\n  const searchIndexRef = useRef([]);\n  const [searchIndexReady, setSearchIndexReady] = useState(false);\n  const [searchIndexVersion, setSearchIndexVersion] = useState(0);\n  const [searchResults, setSearchResults] = useState([]);\n  const [searchTotalMatches, setSearchTotalMatches] = useState(0);\n  const [categoryFilter, setCategoryFilter] = useState(\"sszes\");\n  const [sortOption, setSortOption] = useState(\"default\");\n  const [isDemoMode, setIsDemoMode] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [isChatOpen, setIsChatOpen] = useState(false);\n  const [showAIOnboarding, setShowAIOnboarding] = useState(false);\n  const [onboardingFeature, setOnboardingFeature] = useState('chat');\n  const [advancedFilters, setAdvancedFilters] = useState({});\n  const [categoryHierarchy, setCategoryHierarchy] = useState({ mainCategories: [] });\n  const [categoryStats, setCategoryStats] = useState(null);\n  const [selectedCollection, setSelectedCollection] = useState(null);\n  const mainCategorySet = useMemo(() => {\n    return new Set((categoryHierarchy?.mainCategories || []).map((c) => c.name));\n  }, [categoryHierarchy]);\n  const activeHierarchyCount = useMemo(() => {\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === categoryFilter);\n    return typeof main?.productCount === 'number' ? main.productCount : null;\n  }, [categoryHierarchy, categoryFilter]);\n  const getCategoryMainList = useCallback((category) => {\n    if (!category) return [];\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === category);\n    if (!main) return [];\n    return Array.isArray(main.rawSegments) && main.rawSegments.length > 0 ? main.rawSegments : [category];\n  }, [categoryHierarchy]);\n  \n  // AI Feature states\n  const [showStyleQuiz, setShowStyleQuiz] = useState(false);\n  const [showRoomDesigner, setShowRoomDesigner] = useState(false);\n  const [aiRecommendedProducts, setAiRecommendedProducts] = useState([]);\n  const [aiRecommendationLabel, setAiRecommendationLabel] = useState('');\n  const [showDeferredAI, setShowDeferredAI] = useState(false);\n  \n  // Quick Peek & AR states\n  const [quickPeekProduct, setQuickPeekProduct] = useState(null);\n  const [showARPreview, setShowARPreview] = useState(false);\n  const [arProduct, setArProduct] = useState(null);\n  \n  // AR Measure & One-Click Checkout states\n  const [showARMeasure, setShowARMeasure] = useState(false);\n  const [arMeasureProduct, setArMeasureProduct] = useState(null);\n  const [showOneClickCheckout, setShowOneClickCheckout] = useState(false);\n  const [oneClickProduct, setOneClickProduct] = useState(null);\n  \n  // New UX states\n  const [showConfetti, setShowConfetti] = useState(false);\n  const [showFilterSheet, setShowFilterSheet] = useState(false);\n  const [showExitIntent, setShowExitIntent] = useState(true); // Exit intent enabled\n  \n  // Phase 2 UX states\n  const [showWishlistDrawer, setShowWishlistDrawer] = useState(false);\n  const [featuredPool, setFeaturedPool] = useState([]);\n  const featuredPoolKeyRef = useRef('');\n  \n  // Flash sale end time (set to 12 hours from now for demo)\n  const flashSaleEndTime = useMemo(() => {\n    const end = new Date();\n    end.setHours(end.getHours() + 12);\n    return end;\n  }, []);\n  \n  // UNAS API states\n  const [isLoadingUnas, setIsLoadingUnas] = useState(true);\n  const [unasError, setUnasError] = useState(null);\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [dataSource, setDataSource] = useState('demo');\n  \n  // New hooks\n  const toast = useToast();\n  const comparison = useComparison();\n  useScrollLock(showARMeasure || showOneClickCheckout);\n  \n  // Track product views - both for RecentlyViewed component and user preferences\n  const handleProductView = (product) => {\n    trackProductView(product); // RecentlyViewed component\n    trackProductViewPref(product); // User preferences service (for AI personalization)\n    setSelectedProduct(product);\n  };\n  \n  // Handle AI recommended products - scroll to products and show them\n  // Accepts either: (product, allRecommended) OR (recommendedProducts, label)\n  const handleShowAIProducts = useCallback((firstArg, secondArg) => {\n    let recommendedProducts = [];\n    let label = 'AI ajnlsok';\n    \n    // Check if first argument is a single product or an array\n    if (firstArg && !Array.isArray(firstArg) && firstArg.id) {\n      // Single product clicked - show it first, then add similar products\n      const clickedProduct = firstArg;\n      const allRecommended = secondArg || [];\n      \n      // Get similar products from the full products list\n      const similarProducts = products\n        .filter(p => {\n          if (p.id === clickedProduct.id) return false;\n          const clickedCat = (clickedProduct.category || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          // Same main category or similar price range\n          const sameCategory = clickedCat && pCat && pCat.includes(clickedCat.split(' > ')[0]);\n          const price = p.salePrice || p.price || 0;\n          const clickedPrice = clickedProduct.salePrice || clickedProduct.price || 0;\n          const similarPrice = clickedPrice > 0 && Math.abs(price - clickedPrice) / clickedPrice < 0.5;\n          return sameCategory || similarPrice;\n        })\n        .slice(0, 12);\n      \n      // Combine: clicked product + other recommendations + similar\n      recommendedProducts = [\n        clickedProduct,\n        ...allRecommended.filter(p => p.id !== clickedProduct.id),\n        ...similarProducts.filter(p => !allRecommended.some(r => r.id === p.id))\n      ].slice(0, 20);\n      \n      label = `\"${clickedProduct.name.slice(0, 30)}...\" s hasonl termkek`;\n    } else if (Array.isArray(firstArg)) {\n      // Array of products provided\n      recommendedProducts = firstArg;\n      label = typeof secondArg === 'string' ? secondArg : 'AI ajnlsok';\n    }\n    \n    if (recommendedProducts.length === 0) return;\n    \n    setAiRecommendedProducts(recommendedProducts);\n    setAiRecommendationLabel(label);\n    setCategoryFilter('sszes'); // Reset category\n    setSearchQuery(''); // Reset search\n    \n    setActiveTab('shop');\n    scheduleScrollToProductsRef.current?.();\n  }, [products]);\n  \n  // Clear AI recommendations\n  const clearAIRecommendations = useCallback(() => {\n    setAiRecommendedProducts([]);\n    setAiRecommendationLabel('');\n  }, []);\n\n  const toggleWishlist = (id) => {\n    const isAdding = !wishlist.includes(id);\n    setWishlist(prev => \n      isAdding \n        ? [...prev, id] \n        : prev.filter(item => item !== id)\n    );\n    \n    if (isAdding) {\n      toast.wishlist('Hozzadva a kvnsglisthoz!');\n    } else {\n      toast.info('Eltvoltva a kvnsglistrl');\n    }\n  };\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!showWishlistDrawer) return () => { cancelled = true; };\n    if (!wishlist || wishlist.length === 0) {\n      setWishlistItems([]);\n      return () => { cancelled = true; };\n    }\n    Promise.all(wishlist.map((id) => fetchUnasProductById(id)))\n      .then((items) => {\n        if (!cancelled) setWishlistItems(items.filter(Boolean));\n      });\n    return () => { cancelled = true; };\n  }, [wishlist, showWishlistDrawer]);\n  \n  const handleToggleComparison = (product) => {\n    const result = comparison.toggleComparison(product);\n    if (result.success) {\n      if (result.action === 'added') {\n        toast.success('Hozzadva az sszehasonltshoz!');\n      } else {\n        toast.info('Eltvoltva az sszehasonltsbl');\n      }\n    } else {\n      toast.error(result.message);\n    }\n  };\n  \n  // Handle add to cart with confetti celebration\n  const handleAddToCart = useCallback((product, quantity = 1) => {\n    try {\n      const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n      // UNAS kosrhoz ads (ha elrhet  widget UNAS oldalon fut)\n      const addedToUnas = addToUnasCart(product, qty);\n\n      if (addedToUnas) {\n        setShowConfetti(true);\n        toast.success(`${product.name} hozzadva a kosrhoz!`);\n        return;\n      }\n\n      // Fallback: cart_add nem mkdik  termk oldalra navigls (ott egy kattints = kosrba)\n      const productUrl = (product.link || product.url || '').trim();\n      const fullUrl = !productUrl || productUrl === '#' ? '' : productUrl.startsWith('http') ? productUrl : `${WEBSHOP_DOMAIN}${productUrl.startsWith('/') ? '' : '/'}${productUrl}`;\n      if (fullUrl && fullUrl !== WEBSHOP_DOMAIN && fullUrl !== WEBSHOP_DOMAIN + '/') {\n        toast.info('A termk oldalra naviglunk  ott egy kattintssal hozzadhatod a kosrhoz.');\n        window.location.href = fullUrl;\n      } else {\n        toast.warning('A termk link nem elrhet. Prbld ksbb.');\n      }\n    } catch (err) {\n      console.warn('[handleAddToCart]', err);\n      toast.error(err?.message || 'A kosrhoz ads sikertelen. Prbld a termk oldaln.');\n    }\n  }, [toast]);\n  \n  // Server-side search state\n  const [serverSearchQuery, setServerSearchQuery] = useState('');\n  const [serverCategory, setServerCategory] = useState('');\n  const searchTimeoutRef = useRef(null);\n  const scheduleScrollToProductsRef = useRef(null);\n\n  // API-first: kis lap, gyors first paint; soha nem tltnk 200k-t\n  const loadUnasData = useCallback(async (options = {}) => {\n    const { silent = false, search = '', category = '', categoryMain, categories, styleKeywords, append = false, limit = INITIAL_PAGE, offset = 0 } = options;\n    \n    if (!silent && !append) {\n      setIsLoadingUnas(true);\n      setUnasError(null);\n    }\n    if (append) setIsLoadingMore(true);\n    \n    try {\n      const categoryMainList = Array.isArray(categoryMain)\n        ? categoryMain.filter(Boolean)\n        : (typeof categoryMain === 'string' && categoryMain.trim()\n          ? [categoryMain.trim()]\n          : getCategoryMainList(category));\n      const categoriesList = Array.isArray(categories) ? categories.filter(Boolean) : [];\n      const params = {\n        limit,\n        offset,\n        slim: false,\n        ...(search && search.trim() && { search: search.trim() }),\n        ...(categoriesList.length > 0 && { categories: categoriesList }),\n        ...(categoriesList.length === 0 && categoryMainList.length > 0 && { categoryMain: categoryMainList }),\n        ...(categoriesList.length === 0 && categoryMainList.length === 0 && category && category !== 'sszes' && { category }),\n        ...(Array.isArray(styleKeywords) && styleKeywords.length > 0 && { styleKeywords })\n      };\n      const data = await fetchUnasProducts(params);\n      const newProducts = (data.products || []).map(normalizeProduct);\n      const totalCount = data.total ?? 0;\n      \n      if (append) {\n        setProducts(prev => [...prev, ...newProducts]);\n        setHasMoreProducts(newProducts.length > 0 && (data.count + offset) < totalCount);\n      } else {\n        setProducts(newProducts);\n        setTotalProductsCount(totalCount);\n        setHasMoreProducts(newProducts.length > 0 && newProducts.length < totalCount);\n      }\n      if (!append && search && String(search).trim()) {\n        scheduleScrollToProductsRef.current?.();\n      }\n      if (!append) setTotalProductsCount(totalCount);\n      setLastUpdated(data.lastSync || data.lastUpdated);\n      setDataSource('unas');\n      setUnasError(null);\n    } catch (err) {\n      if (!append) setUnasError('Termkek betltse sikertelen');\n    } finally {\n      if (!silent && !append) setIsLoadingUnas(false);\n      if (append) setIsLoadingMore(false);\n    }\n  }, [getCategoryMainList]);\n\n  // Server-side search (marketplace-style). scrollFromEffect: true = grgets az effect-ben (pl. header keress), false = hv intzi (pl. hero)\n  const requestScrollToProductsRef = useRef(false);\n  const handleServerSearch = useCallback((query, opts = {}) => {\n    hasUserSearchedRef.current = true;\n    if (opts.scrollFromEffect !== false) requestScrollToProductsRef.current = true;\n    setSearchQuery(query);\n  }, []);\n  const hasUserSearchedRef = useRef(false);\n  // Mindig headernl landoljon: els betlts s reload esetn\n  useLayoutEffect(() => {\n    if (typeof window === 'undefined') return;\n    window.history.scrollRestoration = 'manual';\n    const scrollToHeader = () => {\n      window.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n      const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root');\n      if (appRoot) {\n        let p = appRoot.parentElement;\n        while (p && p !== document.body) {\n          const s = getComputedStyle(p);\n          if ((s.overflowY === 'auto' || s.overflowY === 'scroll' || s.overflowY === 'overlay') && p.scrollHeight > p.clientHeight) {\n            p.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n            break;\n          }\n          p = p.parentElement;\n        }\n      }\n    };\n    scrollToHeader();\n    const t1 = setTimeout(scrollToHeader, 100);\n    const t2 = setTimeout(scrollToHeader, 300);\n    return () => { clearTimeout(t1); clearTimeout(t2); };\n  }, []);\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      setSectionRotateTick((t) => t + 1);\n    }, 180000);\n    return () => clearInterval(id);\n  }, []);\n\n\n  // Scroll container: ne hasznljunk olyan containert, ami a mi appunk belsejben van (#mkt-butorbolt-app).\n  // UNAS embed: gyakran a page_content article szlje a scroll container; standalone = window.\n  const getScrollParent = useCallback((element) => {\n    const appRoot = document.getElementById('mkt-butorbolt-app');\n    const isScrollable = (el) => {\n      if (!el || el === document.body) return false;\n      const style = getComputedStyle(el);\n      const oy = style.overflowY;\n      return (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && el.scrollHeight > el.clientHeight;\n    };\n    let parent = element.parentElement;\n    while (parent && parent !== document.body) {\n      if (isScrollable(parent)) {\n        const insideApp = appRoot && parent.closest('#mkt-butorbolt-app');\n        const wrapsApp = appRoot && parent.contains(appRoot);\n        if (wrapsApp || !insideApp) return parent;\n      }\n      parent = parent.parentElement;\n    }\n    return null;\n  }, []);\n\n  const lastScrollToProductsRef = useRef(0);\n  const scrollToProductsSection = useCallback((retryCount = 0) => {\n    const el = document.getElementById('products-section');\n    const main = document.getElementById('mkt-butorbolt-main');\n    const target = el || main;\n    if (!target) {\n      if (retryCount < SCROLL_RETRY_MAX) setTimeout(() => scrollToProductsSection(retryCount + 1), SCROLL_DELAY_INITIAL);\n      return;\n    }\n    const now = performance.now();\n    if (now - lastScrollToProductsRef.current < SCROLL_THROTTLE_MS) return;\n    const rect = target.getBoundingClientRect();\n    const inView = rect.top >= -50 && rect.top <= 180;\n    if (inView && retryCount === 0) return;\n    lastScrollToProductsRef.current = now;\n\n    const run = () => {\n      const scrollParent = getScrollParent(target);\n      const offset = 88;\n      if (scrollParent && scrollParent !== document.documentElement) {\n        const elRect = target.getBoundingClientRect();\n        const parentRect = scrollParent.getBoundingClientRect();\n        const targetScrollTop = scrollParent.scrollTop + (elRect.top - parentRect.top) - offset;\n        scrollParent.scrollTo({ top: Math.max(0, targetScrollTop), behavior: 'smooth' });\n      } else {\n        target.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });\n      }\n      if (typeof window !== 'undefined') delete window.__MKT_NAV_TO_PRODUCTS;\n    };\n    requestAnimationFrame(() => requestAnimationFrame(run));\n  }, [getScrollParent]);\n\n  const scrollToProductsSectionRef = useRef(scrollToProductsSection);\n  scrollToProductsSectionRef.current = scrollToProductsSection;\n\n  const scheduleScrollToProducts = useCallback(() => {\n    if (typeof window !== 'undefined') {\n      window.__MKT_NAV_TO_PRODUCTS = Date.now();\n    }\n    requestAnimationFrame(() => {\n      setTimeout(() => scrollToProductsSectionRef.current?.(), SCROLL_DELAY_INITIAL);\n      setTimeout(() => scrollToProductsSectionRef.current?.(1), SCROLL_DELAY_RETRY);\n      setTimeout(() => scrollToProductsSectionRef.current?.(2), SCROLL_DELAY_FINAL);\n    });\n  }, []);\n\n  scheduleScrollToProductsRef.current = scheduleScrollToProducts;\n\n  const handleCategoryChange = useCallback((category) => {\n    setSelectedCollection(null);\n    setCategoryFilter(category);\n    setCategoryStats(null);\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    setAdvancedFilters({});\n    setSortOption('default');\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    if (category && category !== 'sszes') setActiveTab('shop');\n    scheduleScrollToProducts();\n  }, [clearAIRecommendations, scheduleScrollToProducts]);\n\n  const handleCollectionSelect = useCallback((collection) => {\n    setSelectedCollection(collection);\n    setCategoryFilter('sszes');\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    setActiveTab('shop');\n    scheduleScrollToProducts();\n  }, [scheduleScrollToProducts]);\n\n  const handleCollectionBack = useCallback(() => {\n    setSelectedCollection(null);\n    handleCategoryChange('sszes');\n  }, [handleCategoryChange]);\n\n  const loadUnasDataRef = useRef(loadUnasData);\n  loadUnasDataRef.current = loadUnasData;\n\n  const canUseLocalSearch = useMemo(() => {\n    if (SERVER_SEARCH_ONLY) return false;\n    return searchIndexReady && searchIndexRef.current.length > 0 && searchIndexRef.current.length <= MAX_LOCAL_INDEX;\n  }, [SERVER_SEARCH_ONLY, searchIndexReady, searchIndexVersion]);\n\n  const debouncedSearch = useDebounce(searchQuery, 350);\n\n  // Kollekci termkbetlts  valdi termkek: categoryMain ( f kategria) vagy categories ( leaf kategrik )\n  useEffect(() => {\n    if (!selectedCollection) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n        categoryMainList = undefined;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n        categoriesList = undefined;\n      } else {\n        categoriesList = cats;\n      }\n    } else {\n      categoryMainList = undefined;\n      categoriesList = undefined;\n    }\n    const limit = INITIAL_PAGE;\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined,\n      limit,\n      offset: 0\n    });\n    scheduleScrollToProductsRef.current?.();\n  }, [selectedCollection, categoryHierarchy]);\n\n  const deferProductsLoadRef = useRef(true);\n  useEffect(() => {\n    if (selectedCollection) return;\n    const useApiSearch = !canUseLocalSearch || !debouncedSearch.trim();\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    const isInitialState = categoryFilter === 'sszes' && !debouncedSearch.trim();\n    const shouldDefer = deferProductsLoadRef.current && isInitialState;\n\n    const run = () => {\n      const searchStr = useApiSearch ? debouncedSearch.trim() || undefined : undefined;\n      const intent = searchStr && searchStr.length >= 3 ? parseSearchIntent(searchStr) : null;\n      const intentKeywords = intent\n        ? [...(intent.productTypes || []), ...(intent.styles || []), ...(intent.colors || []), ...(intent.materials || [])].filter(Boolean)\n        : [];\n      loadUnasDataRef.current({\n        search: searchStr,\n        category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n        categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined,\n        styleKeywords: intentKeywords.length > 0 ? intentKeywords : undefined,\n        minPrice: intent?.priceRange?.min,\n        maxPrice: intent?.priceRange?.max,\n        limit: INITIAL_PAGE,\n        offset: 0\n      });\n      if (requestScrollToProductsRef.current && debouncedSearch.trim()) {\n        requestScrollToProductsRef.current = false;\n        scheduleScrollToProductsRef.current?.();\n      }\n    };\n\n    if (shouldDefer) {\n      deferProductsLoadRef.current = false;\n      const t = setTimeout(run, 900);\n      return () => clearTimeout(t);\n    }\n    run();\n  }, [categoryFilter, debouncedSearch, canUseLocalSearch, getCategoryMainList, selectedCollection]);\n\n  useEffect(() => {\n    const onHashChange = () => {\n      const hash = window.location.hash.slice(1);\n      const tab = HASH_TO_TAB[hash] || 'shop';\n      setActiveTabState(tab);\n    };\n    window.addEventListener('hashchange', onHashChange);\n    return () => window.removeEventListener('hashchange', onHashChange);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    fetchCategoryHierarchy().then((data) => {\n      if (!cancelled && data?.mainCategories) setCategoryHierarchy(data);\n    });\n    return () => { cancelled = true; };\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!categoryFilter || categoryFilter === 'sszes') {\n      setCategoryStats(null);\n      return () => { cancelled = true; };\n    }\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    const category = categoryMainList.length === 0 ? categoryFilter : '';\n    fetchProductStats({ category, categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined }).then((stats) => {\n      if (!cancelled) setCategoryStats(stats);\n    });\n    return () => { cancelled = true; };\n  }, [categoryFilter, getCategoryMainList]);\n\n  // Defer heavy AI widgets to keep TTI under 3s\n  useEffect(() => {\n    const t = setTimeout(() => setShowDeferredAI(true), 1500);\n    return () => clearTimeout(t);\n  }, []);\n\n  // Keresindex httrben (800ms ksleltets, ne blokkolja az els paint-et); 5 percenknt frissts = kszlet napraksz\n  useEffect(() => {\n    if (SERVER_SEARCH_ONLY) return;\n    let cancelled = false;\n    const load = () => {\n      fetchSearchIndex({ minimal: true }).then(async (data) => {\n        if (!cancelled && data && Array.isArray(data.products)) {\n          searchIndexRef.current = data.products;\n          setSearchIndexReady(true);\n          setSearchIndexVersion((v) => v + 1);\n          if (data.lastSync) setLastUpdated(data.lastSync);\n          const q = searchQueryRef.current.trim();\n          if (q && data.products.length <= MAX_LOCAL_INDEX) {\n            const { smartSearch } = await import('./services/aiSearchService');\n            if (cancelled) return;\n            const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, q, { limit: 500 });\n            setSearchResults(results);\n            setSearchTotalMatches(totalMatches || results.length);\n          }\n        }\n      });\n    };\n    const t0 = setTimeout(load, 800);\n    const t1 = setInterval(load, 5 * 60 * 1000);\n    return () => { cancelled = true; clearTimeout(t0); clearInterval(t1); };\n  }, []);\n\n  // Keress a teljes indexen (ha mr betlttt); res keress = res tallat\n  useEffect(() => {\n    if (!searchQuery.trim()) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    if (!canUseLocalSearch) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    let cancelled = false;\n    import('./services/aiSearchService').then(({ smartSearch }) => {\n      if (cancelled) return;\n      const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, searchQuery.trim(), { limit: 500 });\n      setSearchResults(results);\n      setSearchTotalMatches(totalMatches || results.length);\n    });\n    return () => { cancelled = true; };\n  }, [searchQuery, canUseLocalSearch]);\n\n  useEffect(() => {\n    const t = setInterval(() => loadUnasDataRef.current?.({ silent: true }), 300000);\n    return () => clearInterval(t);\n  }, []);\n\n  // Featured pool for homepage modules  1. batch azonnal, 23. batch 1s ksleltetve\n  useEffect(() => {\n    if (!totalProductsCount || totalProductsCount <= 0) return;\n    const key = `${totalProductsCount}-${lastUpdated || ''}`;\n    if (featuredPoolKeyRef.current === key) return;\n    featuredPoolKeyRef.current = key;\n    let cancelled = false;\n    let extraTimeoutId = null;\n    const limit = 150;\n    const mergeInto = (map, data) => {\n      (data?.products || []).forEach((p) => {\n        if (!p || !p.id) return;\n        map.set(p.id, normalizeProduct(p));\n      });\n    };\n    fetchUnasProducts({ limit, offset: 0, slim: false })\n      .then((first) => {\n        if (cancelled) return;\n        const merged = new Map();\n        mergeInto(merged, first);\n        setFeaturedPool(Array.from(merged.values()));\n        if (totalProductsCount <= limit * 2) return;\n        const extraOffsets = [\n          Math.max(0, Math.floor(totalProductsCount / 3) - Math.floor(limit / 2)),\n          Math.max(0, Math.floor((totalProductsCount * 2) / 3) - Math.floor(limit / 2))\n        ];\n        extraTimeoutId = setTimeout(() => {\n          if (cancelled) return;\n          Promise.all(extraOffsets.map((o) => fetchUnasProducts({ limit, offset: o, slim: false })))\n            .then((batches) => {\n              if (cancelled) return;\n              const map = new Map(Array.from(merged.entries()));\n              batches.forEach((b) => mergeInto(map, b));\n              setFeaturedPool(Array.from(map.values()));\n            })\n            .catch(() => {});\n        }, 1000);\n      })\n      .catch(() => {\n        if (!cancelled) setFeaturedPool([]);\n      });\n    return () => {\n      cancelled = true;\n      if (extraTimeoutId != null) clearTimeout(extraTimeoutId);\n    };\n  }, [totalProductsCount, lastUpdated]);\n\n  const normalizedAdvancedFilters = useMemo(() => ({\n    priceMin: advancedFilters.priceMin ?? 0,\n    priceMax: advancedFilters.priceMax ?? 1000000,\n    inStockOnly: advancedFilters.inStockOnly ?? false,\n    categories: Array.isArray(advancedFilters.categories) ? advancedFilters.categories : []\n  }), [advancedFilters]);\n\n  const mobileActiveFilterCount = useMemo(() => [\n    normalizedAdvancedFilters.inStockOnly,\n    normalizedAdvancedFilters.categories.length > 0,\n    normalizedAdvancedFilters.priceMin > 0,\n    normalizedAdvancedFilters.priceMax < 1000000\n  ].filter(Boolean).length, [normalizedAdvancedFilters]);\n  \n  // Szerver mr szr (kategria, keress); itt csak rendezs + advanced filter a kis listn\n  const filteredAndSortedProducts = useMemo(() => {\n    let result = [...products];\n    if (Object.keys(advancedFilters).length > 0) {\n      result = applyFilters(result, normalizedAdvancedFilters);\n    }\n    if (sortOption === 'price-asc') result = result.sort((a, b) => (a.price || 0) - (b.price || 0));\n    if (sortOption === 'price-desc') result = result.sort((a, b) => (b.price || 0) - (a.price || 0));\n    return result;\n  }, [products, sortOption, advancedFilters, normalizedAdvancedFilters]);\n\n  // Kollekci-specifikus szrs: isSale -> salePrice, styleKeywords -> name/description/params\n  const collectionFilteredProducts = useMemo(() => {\n    if (!selectedCollection) return filteredAndSortedProducts;\n    let list = [...filteredAndSortedProducts];\n    if (selectedCollection.isSale) {\n      list = list.filter((p) => p.salePrice != null && p.price > 0 && p.salePrice < p.price);\n    }\n    const keywords = selectedCollection.styleKeywords || [];\n    if (keywords.length > 0) {\n      const lower = keywords.map((k) => String(k).toLowerCase());\n      list = list.filter((p) => {\n        const text = `${p.name || ''} ${p.description || ''} ${p.params || ''}`.toLowerCase();\n        return lower.some((kw) => text.includes(kw));\n      });\n    }\n    return list;\n  }, [selectedCollection, filteredAndSortedProducts]);\n\n  filteredLengthRef.current = filteredAndSortedProducts.length;\n\n  const isSearchMode = searchQuery.trim().length >= 2 && canUseLocalSearch;\n  const isSearchActive = searchQuery.trim().length > 0;\n  const sectionProducts = isSearchActive ? [] : filteredAndSortedProducts;\n  const sectionContextLabel = categoryFilter && categoryFilter !== 'sszes'\n    ? categoryFilter\n    : (mobileActiveFilterCount > 0 ? 'Szrt ajnlsok' : '');\n  const useContextSections = isSearchActive || (categoryFilter && categoryFilter !== 'sszes') || mobileActiveFilterCount > 0;\n  const featuredBase = useContextSections ? sectionProducts : (featuredPool.length > 0 ? featuredPool : sectionProducts);\n  const displayedProducts = aiRecommendedProducts.length > 0\n    ? aiRecommendedProducts\n    : isSearchMode\n      ? searchResults\n      : filteredAndSortedProducts;\n  const hasMoreToShow = aiRecommendedProducts.length === 0 && !isSearchMode && products.length < totalProductsCount;\n  const headerCount = isSearchMode\n    ? (searchTotalMatches || searchResults.length)\n    : (totalProductsCount || filteredAndSortedProducts.length);\n\n  const handleLoadMore = useCallback(() => {\n    if (isLoadingMore || !hasMoreProducts) return;\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: searchQuery.trim() || undefined,\n      category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n      categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined\n    });\n  }, [isLoadingMore, hasMoreProducts, products.length, searchQuery, categoryFilter, getCategoryMainList]);\n\n  const handleCollectionLoadMore = useCallback(() => {\n    if (!selectedCollection || isLoadingMore || !hasMoreProducts) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n      } else {\n        categoriesList = cats;\n      }\n    }\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined\n    });\n  }, [selectedCollection, isLoadingMore, hasMoreProducts, products.length, categoryHierarchy]);\n\n  // Categories with TOTAL counts (from hierarchy if available, fallback to loaded products)\n  const categories = useMemo(() => {\n    const total = totalProductsCount || products.length;\n    if (categoryHierarchy?.mainCategories?.length) {\n      const main = categoryHierarchy.mainCategories.map((m) => ({\n        id: m.name,\n        name: m.name,\n        totalCount: Number(m.productCount || 0)\n      }));\n      return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...main];\n    }\n    if (!products || products.length === 0) return [{ id: 'sszes', name: 'sszes', totalCount: total }];\n    const categoryCount = new Map();\n    for (const p of products) {\n      if (p.category) {\n        categoryCount.set(p.category, (categoryCount.get(p.category) || 0) + 1);\n      }\n    }\n    const sorted = Array.from(categoryCount.entries())\n      .sort((a, b) => b[1] - a[1])\n      .map(([name, count]) => ({ id: name, name, totalCount: count }));\n    return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...sorted];\n  }, [categoryHierarchy?.mainCategories, products, totalProductsCount]);\n\n  const recentPurchasesForSocialProof = useMemo(() => products.slice(0, 10), [products]);\n\n  return (\n    <ToastProvider>\n    <div id=\"mkt-butorbolt-app\" className=\"min-h-screen bg-white font-sans text-gray-900 rounded-3xl sm:rounded-[2rem] lg:rounded-[2.5rem] overflow-hidden shadow-2xl shadow-gray-300/50 mx-auto w-full max-w-[2000px]\">\n      {/* Scroll Progress Bar */}\n      <ScrollProgress />\n      \n      <Navbar \n        activeTab={activeTab} \n        setActiveTab={setActiveTab} \n        wishlistCount={wishlist.length}\n        productCount={totalProductsCount || products.length}\n        categories={categories}\n        categoryHierarchy={categoryHierarchy.mainCategories}\n        activeCategory={categoryFilter}\n        onOpenWishlist={() => setShowWishlistDrawer(true)}\n        onCategorySelect={handleCategoryChange}\n        onScrollToShop={scheduleScrollToProducts}\n        fixUrl={fixUrl}\n        onRecentProductClick={handleProductView}\n      />\n      \n      {/* AI Onboarding */}\n      <AIOnboarding \n        isOpen={showAIOnboarding} \n        onClose={() => setShowAIOnboarding(false)}\n        targetFeature={onboardingFeature}\n      />\n      \n      {/* Live Social Proof */}\n      <LiveSocialProof \n        currentProduct={selectedProduct} \n        recentPurchases={recentPurchasesForSocialProof}\n      />\n      \n      {/* Back to Top Button */}\n      <BackToTop />\n      \n      {/* AI Chat Assistant (deferred for faster first paint) */}\n      {showDeferredAI && (\n        <Suspense fallback={null}>\n            <AIChatAssistant\n              products={products}\n              catalogProducts={searchIndexReady ? searchIndexRef.current : products}\n              onShowProducts={handleShowAIProducts}\n              serverSearchMode={SERVER_SEARCH_ONLY}\n              totalProductsCount={totalProductsCount}\n              categoryHierarchy={categoryHierarchy}\n            />\n        </Suspense>\n      )}\n\n      <main id=\"mkt-butorbolt-main\">\n        {activeTab === 'shop' && (\n          <>\n            {/* Flash Sale Banner  nem teljes szlessg, lekerektett, vltakoz ajnlatok */}\n            <div className=\"px-[2px] sm:px-2 lg:px-4\">\n              <FlashSaleBanner\n                endTime={flashSaleEndTime}\n                title=\" Flash Sale!\"\n                subtitle=\"Csak ma! Akr 50% kedvezmny kivlasztott btorokra\"\n                onViewSale={scheduleScrollToProducts}\n                variant=\"banner\"\n              />\n            </div>\n\n            <ModernHero \n              onExplore={scheduleScrollToProducts}\n              onTryAI={() => setActiveTab('visual-search')}\n              products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n              onHeroQuickView={(product) => handleProductView(product)}\n              onHeroSearch={(query, meta = {}) => {\n                if (!query?.trim()) return;\n                if (meta?.source !== 'instant') {\n                  setActiveTab('shop');\n                }\n                handleServerSearch(query, { scrollFromEffect: false });\n                if (meta?.source !== 'instant') {\n                  scheduleScrollToProductsRef.current?.();\n                }\n              }}\n              quickCategories={categoryHierarchy?.mainCategories || []}\n              onQuickCategory={(name) => {\n                setActiveTab('shop');\n                handleCategoryChange(name);\n              }}\n              serverSearchMode={SERVER_SEARCH_ONLY}\n              onFetchSearchPreview={SERVER_SEARCH_ONLY ? async (q) => {\n                const searchStr = q?.trim() || '';\n                const intent = searchStr.length >= 3 ? parseSearchIntent(searchStr) : null;\n                const intentKw = intent\n                  ? [...(intent.productTypes || []), ...(intent.styles || []), ...(intent.colors || []), ...(intent.materials || [])].filter(Boolean)\n                  : [];\n                const data = await fetchUnasProducts({\n                  search: searchStr,\n                  limit: 24,\n                  offset: 0,\n                  slim: true,\n                  minPrice: intent?.priceRange?.min,\n                  maxPrice: intent?.priceRange?.max,\n                  styleKeywords: intentKw.length > 0 ? intentKw : undefined\n                });\n                return { results: data?.products || [], total: data?.total ?? 0 };\n              } : undefined}\n            />\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <Suspense fallback={null}>\n                <AIModuleUnified\n                  onFeatureClick={(feature) => {\n                  if (feature.id === 'visual-search') setActiveTab('visual-search');\n                  else if (feature.id === 'chat') {\n                    document.getElementById('mkt-butorbolt-chat')?.scrollIntoView({ behavior: 'smooth' });\n                  }\n                  else if (feature.id === 'room-planner') setActiveTab('room-planner');\n                  else if (feature.id === 'style-quiz') setShowStyleQuiz(true);\n                  else if (feature.id === 'room-designer') setShowRoomDesigner(true);\n                }}\n                />\n              </Suspense>\n            </FadeInOnScroll>\n\n            <DeferredSection rootMargin=\"200px\" className=\"section-perf section-gap-lg\">\n              <FadeInOnScroll direction=\"up\" className=\"section-perf section-gap-lg\">\n                <Suspense fallback={null}>\n                  <InspirationSection\n                    onExplore={scheduleScrollToProducts}\n                    onCategorySelect={(name) => {\n                      setActiveTab('shop');\n                      handleCategoryChange(name);\n                    }}\n                    onCollectionSelect={(col) => handleCollectionSelect(col)}\n                  />\n                </Suspense>\n              </FadeInOnScroll>\n            </DeferredSection>\n            \n            {featuredBase.length > 0 && (\n              <DeferredSection rootMargin=\"200px\" className=\"section-perf\">\n                <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n                  <Suspense fallback={null}>\n                    <div className=\"w-[100vw] relative left-1/2 -translate-x-1/2 sm:w-full sm:relative sm:left-auto sm:translate-x-0\">\n                      <ProductWorldsSection\n                      products={featuredBase}\n                      onProductClick={handleProductView}\n                      onToggleWishlist={toggleWishlist}\n                      wishlist={wishlist}\n                      onViewAll={scheduleScrollToProducts}\n                      onAddToCart={handleAddToCart}\n                      contextLabel={sectionContextLabel}\n                      rotationTick={sectionRotateTick}\n                      />\n                    </div>\n                  </Suspense>\n                </FadeInOnScroll>\n              </DeferredSection>\n            )}\n            \n            {/* Personalized Section - For You + Recently Viewed + Trending */}\n            {featuredBase.length > 0 && (\n              <DeferredSection rootMargin=\"200px\">\n                <Suspense fallback={null}>\n                  <PersonalizedSection\n                    products={featuredBase}\n                    onProductClick={handleProductView}\n                    onToggleWishlist={toggleWishlist}\n                    wishlist={wishlist}\n                    onAddToCart={handleAddToCart}\n                    contextLabel={sectionContextLabel}\n                  />\n                </Suspense>\n              </DeferredSection>\n            )}\n\n            <DeferredSection rootMargin=\"200px\">\n              <div className=\"w-full max-w-[500px] mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\n                <Suspense fallback={null}>\n                  <LoyaltyProgram\n                    currentPoints={2450}\n                    totalSpent={485000}\n                    tier=\"silver\"\n                    onViewRewards={() => {}}\n                    onRedeemPoints={(reward) => console.log('Redeem:', reward)}\n                  />\n                </Suspense>\n              </div>\n            </DeferredSection>\n\n            <DeferredSection rootMargin=\"200px\">\n              <Suspense fallback={null}>\n                <NewsletterStrip />\n              </Suspense>\n            </DeferredSection>\n\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <Features />\n            </FadeInOnScroll>\n            \n            {/* Collection Page  kollekci landing */}\n            {selectedCollection ? (\n              <CollectionPage\n                collection={selectedCollection}\n                products={collectionFilteredProducts}\n                onBack={handleCollectionBack}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                onNavigateToCategory={handleCategoryChange}\n                allCategories={categories}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                onLoadMore={handleCollectionLoadMore}\n                isLoading={isLoadingUnas}\n                onScrollToSection={scrollToProductsSection}\n              />\n            ) : categoryFilter && categoryFilter !== \"sszes\" && !isLoadingUnas ? (\n              <CategoryPage\n                category={categoryFilter}\n                products={filteredAndSortedProducts}\n                allCategories={categories}\n                onBack={() => handleCategoryChange(\"sszes\")}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                onCategoryChange={handleCategoryChange}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                stats={categoryStats}\n                onLoadMore={handleLoadMore}\n                onScrollToSection={scrollToProductsSection}\n              />\n            ) : (\n            <section id=\"products-section\" className=\"container-app section-padding section-perf\">\n                {/* Sticky products header - solid, breadcrumb when category selected */}\n                <div className=\"sticky top-16 sm:top-20 z-40 mx-0 sm:-mx-4 lg:-mx-8 xl:-mx-10 px-3 sm:px-4 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-5 xl:py-6 mb-3 sm:mb-4 lg:mb-8 bg-white border-b border-gray-200 shadow-sm search-shell rounded-2xl\">\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 mb-2 sm:mb-3\">\n                    <nav className=\"flex items-center gap-2 text-sm text-gray-500\" aria-label=\"Breadcrumb\">\n                      <button type=\"button\" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"Foldal teteje\">Foldal</button>\n                      <span aria-hidden=\"true\">/</span>\n                      <button type=\"button\" onClick={() => handleCategoryChange('sszes')} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"sszes kategria\">Termkek</button>\n                      {categoryFilter && categoryFilter !== 'sszes' && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"font-semibold text-gray-700\">{categoryFilter}</span>\n                        </>\n                      )}\n                      {searchQuery && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"text-gray-600\">Keress: &quot;{searchQuery}&quot;</span>\n                        </>\n                      )}\n                      <span className=\"text-gray-400\">({headerCount.toLocaleString('hu-HU')} termk)</span>\n                    </nav>\n                    <LiveActivityStrip className=\"hidden sm:flex shrink-0\" />\n                  </div>\n                  <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 lg:gap-6\">\n                    {/* Title & Count */}\n                    <div className=\"flex items-baseline gap-2 sm:gap-3 lg:gap-4 flex-wrap\">\n                      <h2 className=\"text-xl sm:text-2xl lg:text-3xl xl:text-4xl 2xl:text-5xl font-bold text-gray-900\">\n                        {searchQuery ? 'Keress' : 'Termkek'}\n                      </h2>\n                      {!isLoadingUnas && (\n                        <span className=\"text-sm sm:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-500\">\n                          <span className=\"font-semibold text-primary-500\">\n                            {(headerCount || 0).toLocaleString('hu-HU')}\n                          </span> db\n                        </span>\n                      )}\n                      {searchQuery && (\n                        <div className=\"flex items-center gap-2 ml-2\">\n                          <span className=\"px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium\">\n                            \"{searchQuery}\"\n                          </span>\n                          <button \n                            onClick={() => setSearchQuery('')}\n                            className=\"p-1 hover:bg-gray-100 rounded-full transition-colors\"\n                            title=\"Keress trlse\"\n                          >\n                            <X className=\"w-4 h-4 text-gray-500\" />\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Search & Filters */}\n                    <div className=\"w-full sm:w-auto\">\n                      <div className=\"w-full flex items-center gap-2 sm:gap-3 lg:gap-4 rounded-2xl border-2 border-primary-100 bg-gradient-to-r from-primary-50 via-white to-secondary-50 shadow-md p-2 sm:p-3\">\n                        <div className=\"flex-1 sm:flex-initial sm:w-64 lg:w-80 xl:w-[420px] 2xl:w-[520px]\">\n                          <SmartSearchBar \n                            products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n                            indexVersion={searchIndexVersion}\n                            shouldBuildIndex={!SERVER_SEARCH_ONLY && searchIndexReady}\n                            maxLocalIndex={MAX_LOCAL_INDEX}\n                            serverSearchMode={SERVER_SEARCH_ONLY}\n                            categories={categories}\n                            onSearch={handleServerSearch}\n                            onProductClick={handleProductView}\n                            placeholder=\"Keress btorok kztt...\"\n                          />\n                        </div>\n                        {/* Desktop filters */}\n                        <div className=\"hidden sm:block\">\n                          <AdvancedFilters\n                            products={products}\n                            onFilterChange={setAdvancedFilters}\n                            initialFilters={advancedFilters}\n                          />\n                        </div>\n                        {/* Mobile filter button  same state as desktop AdvancedFilters */}\n                        <button\n                          onClick={() => setShowFilterSheet(true)}\n                          className=\"sm:hidden relative p-3 min-h-[48px] min-w-[48px] border-2 border-gray-200 rounded-xl bg-white hover:bg-gray-50 transition-colors flex items-center justify-center\"\n                          aria-label=\"Szrk\"\n                        >\n                          <Filter className=\"w-5 h-5 text-gray-700\" />\n                          {mobileActiveFilterCount > 0 && (\n                            <span className=\"absolute -top-1 -right-1 bg-primary-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 px-1.5 flex items-center justify-center\">\n                              {mobileActiveFilterCount}\n                            </span>\n                          )}\n                        </button>\n                        <select \n                          onChange={(e) => setSortOption(e.target.value)} \n                          className=\"hidden sm:block px-4 lg:px-5 xl:px-6 py-3 lg:py-3.5 xl:py-4 min-h-[48px] lg:min-h-[52px] xl:min-h-[56px] text-sm sm:text-base lg:text-lg xl:text-xl border-2 border-gray-200 rounded-xl lg:rounded-2xl bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-100 outline-none transition-all cursor-pointer font-medium\"\n                          aria-label=\"Rendezs\"\n                        >\n                          <option value=\"default\">Rendezs</option>\n                          <option value=\"price-asc\">r: alacsony  magas</option>\n                          <option value=\"price-desc\">r: magas  alacsony</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                  {/* Active filter chips + sort chips  wrap mobil/tablet, 44px touch */}\n                  <div className=\"flex flex-wrap items-center gap-x-2 gap-y-3 mt-3 pt-3 border-t border-gray-100\">\n                    {mobileActiveFilterCount > 0 && (\n                      <div className=\"flex flex-wrap items-center gap-2 min-w-0\">\n                        {normalizedAdvancedFilters.inStockOnly && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Raktron\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, inStockOnly: false }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMin > 0 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Min. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMin)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMin: 0 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMax < 1000000 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Max. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMax)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMax: 1000000 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {(normalizedAdvancedFilters.categories || []).map(cat => (\n                          <span key={cat} className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            {cat}\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, categories: (prev.categories || []).filter(c => c !== cat) }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label={`${cat} eltvoltsa`}>\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        ))}\n                        <button type=\"button\" onClick={() => setAdvancedFilters({})} className=\"text-sm font-medium text-gray-500 hover:text-primary-600 transition-colors min-h-[44px] px-2 flex items-center sm:min-h-0\">\n                          sszes trlse\n                        </button>\n                      </div>\n                    )}\n                    <div className=\"flex items-center gap-1.5 w-full sm:w-auto sm:ml-auto flex-shrink-0\">\n                      <span className=\"text-xs sm:text-sm text-gray-500 mr-1 hidden sm:inline\">Rendezs:</span>\n                      {['default', 'price-asc', 'price-desc'].map((value) => (\n                        <button\n                          key={value}\n                          type=\"button\"\n                          onClick={() => setSortOption(value)}\n                          className={`min-h-[44px] sm:min-h-0 px-3 py-2 sm:py-1.5 rounded-full text-sm font-medium transition-colors flex items-center justify-center ${\n                            sortOption === value\n                              ? 'bg-primary-500 text-white'\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                          }`}\n                        >\n                          {value === 'default' ? 'Alap' : value === 'price-asc' ? 'r ' : 'r '}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Main categories (from hierarchy) + quick filter swipe */}\n                {categoryHierarchy?.mainCategories?.length > 0 && (\n                  <MainCategoriesSection\n                    mainCategories={categoryHierarchy.mainCategories}\n                    activeCategory={categoryFilter}\n                    onCategorySelect={handleCategoryChange}\n                    totalProductCount={totalProductsCount || products.length}\n                  />\n                )}\n                <CategorySwipe\n                  categories={(() => {\n                    if (categoryHierarchy?.mainCategories?.length > 0) {\n                      return [\n                        { id: 'sszes', name: 'sszes', totalCount: totalProductsCount || products.length },\n                        ...categoryHierarchy.mainCategories.map((m) => ({\n                          id: m.name,\n                          name: m.name,\n                          totalCount: m.productCount ?? 0,\n                          icon: null,\n                        })),\n                      ];\n                    }\n                    return categories.map((cat) => ({\n                      id: cat.name,\n                      name: cat.name,\n                      totalCount: cat.count,\n                      icon: null,\n                    }));\n                  })()}\n                  activeCategory={categoryFilter}\n                  onCategoryChange={handleCategoryChange}\n                  displayedCount={products.length}\n                  activeTotalOverride={categoryFilter === 'sszes'\n                    ? (totalProductsCount || products.length)\n                    : (categoryStats?.total ?? activeHierarchyCount ?? 0)}\n                />\n\n                {/* Loading State */}\n                {isLoadingUnas && (\n                  <div className=\"space-y-6\">\n                    <div className=\"flex items-center justify-center gap-3\">\n                      <div className=\"w-6 h-6 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                      <p className=\"text-sm text-gray-500 font-medium\">Termkek betltse...</p>\n                    </div>\n                    <div className=\"product-grid\">\n                      {[...Array(6)].map((_, i) => (\n                        <ProductCardSkeleton key={`skeleton-${i}`} />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* API Error State */}\n                {!isLoadingUnas && unasError && (\n                  <div className=\"flex flex-col items-center justify-center py-16 px-4 text-center\">\n                    <AlertCircle className=\"w-16 h-16 text-red-500 mb-4\" />\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Nem sikerlt betlteni a termkeket</h3>\n                    <p className=\"text-gray-600 mb-6 max-w-md\">Prbld ksbb, vagy ellenrizd a kapcsolatot.</p>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        const catMain = getCategoryMainList(categoryFilter);\n                        loadUnasDataRef.current({\n                          search: searchIndexReady ? undefined : (searchQuery.trim() || undefined),\n                          category: catMain.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n                          categoryMain: catMain.length > 0 ? catMain : undefined,\n                          limit: INITIAL_PAGE,\n                          offset: 0\n                        });\n                      }}\n                      className=\"px-6 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl font-bold hover:bg-primary-600 transition-colors\"\n                    >\n                      jraprbls\n                    </button>\n                  </div>\n                )}\n\n                {/* Empty State (no error, just no products) */}\n                {!isLoadingUnas && !unasError && displayedProducts.length === 0 && (\n                  searchQuery ? (\n                    <NoSearchResults \n                      query={searchQuery}\n                      onClear={() => setSearchQuery('')}\n                      didYouMean={getDidYouMeanSuggestion(searchQuery)}\n                      onDidYouMean={(s) => setSearchQuery(s)}\n                    />\n                  ) : (\n                    <NoFilterResults \n                      onClearFilters={() => {\n                        handleCategoryChange(\"sszes\");\n                        setAdvancedFilters({});\n                      }}\n                    />\n                  )\n                )}\n\n                {/* AI Recommendations Banner */}\n                {aiRecommendedProducts.length > 0 && (\n                  <div className=\"mb-6 p-4 sm:p-5 bg-gradient-to-r from-primary-500 via-secondary-600 to-secondary-500 rounded-2xl shadow-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-white/20 flex items-center justify-center\">\n                          <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                        </div>\n                        <div>\n                          <h3 className=\"text-white font-bold text-base sm:text-lg\">{aiRecommendationLabel}</h3>\n                          <p className=\"text-white/80 text-sm\">{aiRecommendedProducts.length} szemlyre szabott ajnls</p>\n                        </div>\n                      </div>\n                      <button\n                        onClick={clearAIRecommendations}\n                        className=\"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                        <span className=\"hidden sm:inline\">sszes termk</span>\n                      </button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Products Grid - Responsive with Scroll Animations */}\n                {!isLoadingUnas && displayedProducts.length > 0 && (\n                  <div className=\"product-grid\">\n                    {displayedProducts.map((product, index) => (\n                      <EnhancedProductCard \n                        key={product.id}\n                        product={product} \n                        onToggleWishlist={toggleWishlist} \n                        isWishlisted={wishlist.includes(product.id)} \n                        onQuickView={handleProductView}\n                        onAddToCart={handleAddToCart}\n                        index={index}\n                      />\n                    ))}\n                  </div>\n                )}\n                \n                {/* Load More Button */}\n                {!isLoadingUnas && !unasError && displayedProducts.length > 0 && (\n                  <div className=\"py-8 sm:py-10 lg:py-14 flex flex-col items-center gap-4\">\n                    {hasMoreToShow ? (\n                      <button\n                        onClick={handleLoadMore}\n                        disabled={isLoadingMore}\n                        className=\"px-6 sm:px-8 lg:px-10 py-3.5 sm:py-4 lg:py-5 min-h-[48px] lg:min-h-[56px] bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-semibold rounded-xl lg:rounded-2xl\n                                   hover:from-primary-600 hover:to-secondary-700 transition-all duration-200\n                                   shadow-lg hover:shadow-xl active:scale-[0.98]\n                                   flex items-center gap-3 sm:gap-4 text-base sm:text-lg lg:text-xl disabled:opacity-70 disabled:cursor-not-allowed\"\n                      >\n                        {isLoadingMore && (\n                          <span className=\"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white/70 border-t-transparent rounded-full animate-spin\" aria-hidden />\n                        )}\n                        <span>{isLoadingMore ? 'Betlts...' : 'Tbb termk'}</span>\n                        <span className=\"px-3 sm:px-3.5 py-1 sm:py-1.5 bg-white/20 rounded-lg text-sm sm:text-base\">\n                          {displayedProducts.length.toLocaleString('hu-HU')} / {totalProductsCount.toLocaleString('hu-HU')}\n                        </span>\n                      </button>\n                    ) : (\n                      <div className=\"flex items-center gap-2.5 text-sm sm:text-base lg:text-lg text-gray-400\">\n                        <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                        </svg>\n                        <span>Minden termk ({displayedProducts.length.toLocaleString('hu-HU')} db)</span>\n                      </div>\n                    )}\n                  </div>\n                )}\n            </section>\n            )}\n            \n            {/* Recently Viewed Products */}\n            <RecentlyViewed\n              onToggleWishlist={toggleWishlist}\n              wishlist={wishlist}\n              onQuickView={handleProductView}\n              onAddToCart={handleAddToCart}\n            />\n            \n            {/* Final CTA */}\n            <InteractiveCTA \n              onGetStarted={scheduleScrollToProducts}\n            />\n          </>\n        )}\n        \n        {activeTab === 'visual-search' && <VisualSearch products={products} onAddToCart={() => {}} />}\n        {activeTab === 'room-planner' && <RoomPlanner products={products} />}\n      </main>\n\n      <ProductModal \n        product={selectedProduct} \n        isOpen={!!selectedProduct} \n        onClose={() => setSelectedProduct(null)}\n        allProducts={products}\n        onAddToCart={handleAddToCart}\n      />\n      \n      {/* Similar Products AI Recommendation */}\n      {selectedProduct && (\n        <SimilarProducts\n          currentProduct={selectedProduct}\n          allProducts={products}\n          onToggleWishlist={toggleWishlist}\n          wishlist={wishlist}\n          onQuickView={handleProductView}\n          onAddToCart={handleAddToCart}\n        />\n      )}\n      \n      {/* Product Comparison */}\n      <ProductComparison\n        comparisonList={comparison.comparisonList}\n        onRemove={comparison.removeFromComparison}\n        onClear={comparison.clearComparison}\n      />\n      \n      {/* AI Style Quiz Modal */}\n      {showStyleQuiz && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIStyleQuiz\n            products={products}\n            onRecommendations={(recs) => {\n              toast.success(`${recs.length} termk a Style DNA-d alapjn!`);\n            }}\n            onClose={() => setShowStyleQuiz(false)}\n          />\n        </Suspense>\n      )}\n      \n      {/* AI Room Designer Modal */}\n      {showRoomDesigner && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIRoomDesigner\n            products={products}\n            onProductRecommendations={(recs) => {\n              toast.success(`${recs.length} termk ajnlat!`);\n            }}\n            onClose={() => setShowRoomDesigner(false)}\n          />\n        </Suspense>\n      )}\n\n      {/* Product Quick Peek Modal */}\n      <ProductQuickPeek\n        product={quickPeekProduct}\n        isOpen={!!quickPeekProduct}\n        onClose={() => setQuickPeekProduct(null)}\n        onAddToCart={(product) => {\n          handleAddToCart(product);\n          setQuickPeekProduct(null);\n        }}\n      />\n\n      {/* AR Product Preview */}\n      {showARPreview && arProduct && (\n        <ARProductPreview\n          product={arProduct}\n          onClose={() => {\n            setShowARPreview(false);\n            setArProduct(null);\n          }}\n        />\n      )}\n\n      {/* AR Measure - Room fit checker */}\n      {showARMeasure && arMeasureProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowARMeasure(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <ARMeasure\n              product={arMeasureProduct}\n              onClose={() => {\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n              onConfirmFit={() => {\n                handleAddToCart(arMeasureProduct);\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* One-Click Checkout */}\n      {showOneClickCheckout && oneClickProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowOneClickCheckout(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <OneClickCheckout\n              product={oneClickProduct}\n              savedAddress=\"1234 Budapest, Plda utca 12.\"\n              userEmail=\"user@example.com\"\n              userName=\"Felhasznl\"\n              onCheckout={({ product }) => {\n                toast.success('Sikeres rendels!');\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n              onClose={() => {\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Smart Newsletter Popup */}\n      <SmartNewsletterPopup\n        onSubscribe={(email) => {\n          toast.success('Sikeres feliratkozs! Ellenrizd az email fikod.');\n          return Promise.resolve();\n        }}\n      />\n\n      {/* Confetti Celebration */}\n      <Confetti \n        isActive={showConfetti} \n        onComplete={() => setShowConfetti(false)} \n      />\n\n      {/* Sticky Add to Cart (shows for selected product) */}\n      {selectedProduct && (\n        <StickyAddToCart\n          product={selectedProduct}\n          onAddToCart={handleAddToCart}\n          onToggleWishlist={toggleWishlist}\n          isWishlisted={wishlist.includes(selectedProduct.id)}\n          observedElementId=\"mkt-product-modal-root\"\n        />\n      )}\n\n      {/* Exit Intent Popup */}\n      {showExitIntent && (\n        <ExitIntentPopup \n          discountPercent={10}\n          onClose={() => setShowExitIntent(false)}\n        />\n      )}\n\n      {/* Mobile Filter Bottom Sheet  same state as desktop AdvancedFilters */}\n      <BottomSheet\n        isOpen={showFilterSheet}\n        onClose={() => setShowFilterSheet(false)}\n        title=\"Szrk\"\n        snapPoints={[0.7, 0.9]}\n      >\n        <AdvancedFiltersPanel\n          products={products}\n          filters={advancedFilters}\n          onFilterChange={setAdvancedFilters}\n          onApply={() => setShowFilterSheet(false)}\n          showHeader={false}\n        />\n      </BottomSheet>\n\n      {/* Wishlist Drawer */}\n      <WishlistDrawer\n        isOpen={showWishlistDrawer}\n        onClose={() => setShowWishlistDrawer(false)}\n        wishlistItems={wishlistItems}\n        onRemove={(id) => toggleWishlist(id)}\n        onAddToCart={handleAddToCart}\n        onProductClick={(product) => {\n          setShowWishlistDrawer(false);\n          handleProductView(product);\n        }}\n        onClearAll={() => {\n          wishlist.forEach(id => toggleWishlist(id));\n        }}\n      />\n\n      {/* Trust Badges Footer Section */}\n      <TrustBadges variant=\"footer\" />\n\n      {/* Sticky Mobile Add to Cart - shows on product view */}\n      {selectedProduct && (\n        <StickyAddToCartMobile\n          product={selectedProduct}\n          onAddToCart={(product, qty) => handleAddToCart(product, qty)}\n          onToggleWishlist={() => toggleWishlist(selectedProduct.id)}\n          isInWishlist={wishlist.includes(selectedProduct?.id)}\n          isVisible={true}\n          freeShippingThreshold={50000}\n        />\n      )}\n    </div>\n    </ToastProvider>\n  );\n};\n\nexport default App;\n","import React from 'react';\n\n/**\n * Root Error Boundary  elkapja a gyerek komponensek hibit,\n * fallback UI-t jelent meg, hogy az app ne dljn el teljesen.\n */\nexport class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    if (typeof window !== 'undefined' && window.console) {\n      console.error('[ErrorBoundary]', error, errorInfo);\n    }\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const Fallback = this.props.fallback;\n      if (Fallback) return <Fallback error={this.state.error} />;\n      return (\n        <div\n          role=\"alert\"\n          className=\"min-h-[200px] flex flex-col items-center justify-center p-6 bg-gray-50 border border-gray-200 rounded-xl text-center\"\n        >\n          <p className=\"text-gray-700 font-medium mb-2\">Valami hiba trtnt.</p>\n          <p className=\"text-sm text-gray-500 mb-4\">Frisstsd az oldalt, vagy prbld ksbb.</p>\n          <button\n            type=\"button\"\n            onClick={() => window.location.reload()}\n            className=\"px-4 py-2 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400\"\n          >\n            Oldal frisstse\n          </button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport { ErrorBoundary } from './components/ui/ErrorBoundary'\nimport './index.css'\n\nif (typeof window !== 'undefined' && !window.__MKT_SCROLL_INIT) {\n  window.__MKT_SCROLL_INIT = true\n  window.history.scrollRestoration = 'manual'\n  const NAV_TO_PRODUCTS_WINDOW_MS = 3000\n  const shouldSkipScrollToHeader = () =>\n    typeof window.__MKT_NAV_TO_PRODUCTS === 'number' &&\n    Date.now() - window.__MKT_NAV_TO_PRODUCTS < NAV_TO_PRODUCTS_WINDOW_MS\n  const scrollToHeader = () => {\n    if (shouldSkipScrollToHeader()) return\n    window.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n    const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root')\n    if (appRoot) {\n      let parent = appRoot.parentElement\n      while (parent && parent !== document.body) {\n        const style = getComputedStyle(parent)\n        const oy = style.overflowY\n        const isScrollable = (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && parent.scrollHeight > parent.clientHeight\n        if (isScrollable) {\n          parent.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n          break\n        }\n        parent = parent.parentElement\n      }\n    }\n  }\n  const handleLoad = () => {\n    scrollToHeader()\n    requestAnimationFrame(() => { scrollToHeader(); setTimeout(scrollToHeader, 50); setTimeout(scrollToHeader, 150) })\n  }\n  const handlePageshow = (e) => {\n    scrollToHeader()\n    if (e.persisted) {\n      setTimeout(scrollToHeader, 50)\n      setTimeout(scrollToHeader, 150)\n    }\n  }\n  scrollToHeader()\n  window.addEventListener('DOMContentLoaded', scrollToHeader)\n  window.addEventListener('load', handleLoad)\n  window.addEventListener('pageshow', handlePageshow)\n  window.__MKT_SCROLL_CLEANUP = () => {\n    window.removeEventListener('DOMContentLoaded', scrollToHeader)\n    window.removeEventListener('load', handleLoad)\n    window.removeEventListener('pageshow', handlePageshow)\n    window.__MKT_SCROLL_INIT = false\n    delete window.__MKT_SCROLL_CLEANUP\n  }\n}\n\nconst rootEl = document.getElementById('root')\nif (rootEl) {\n  if (!window.__MKT_BUTORBOLT_APP_MOUNTED) {\n    window.__MKT_BUTORBOLT_APP_MOUNTED = true\n    ReactDOM.createRoot(rootEl).render(\n      <React.StrictMode>\n        <ErrorBoundary>\n          <App />\n        </ErrorBoundary>\n      </React.StrictMode>,\n    )\n  }\n}\n"],"file":"assets/index.js"}