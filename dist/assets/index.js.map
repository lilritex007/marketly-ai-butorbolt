{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","getApiBase","base","_a","DEFAULT_LIMIT","fetchUnasProducts","filters","limit","offset","API_BASE","params","mainValue","url","res","data","products","error","fetchCategoryHierarchy","fetchUnasProductById","id","fetchProductStats","getCartAddPrefix","path","_c","_b","extractVxSku","product","m1","imgs","firstImg","imgUrl","m2","toUnasProductId","raw","s","str","getCartAddContext","wins","w","findUnasForm","doc","selectors","sel","form","ensureQtyInput","unasId","qty","targetDoc","numericId","ids","input","inputId","el","input2","addToUnasCart","quantity","ctx","err","INDEX","SYNONYMS","WORD_TO_ROOT","root","synonyms","rootNorm","normalize","syn","getWords","expandWithSynonyms","words","expanded","word","syns","buildSearchIndex","startTime","includeDesc","CHUNK_SIZE","processed","processChunk","resolve","end","i","nameNorm","catNorm","descNorm","allWords","pct","elapsed","getIndexStats","smartSearch","query","options","queryNorm","cacheKey","cached","buildSearchIndexSync","directSearch","queryWords","expandedQuery","candidateScores","matches","idx","indexedWord","idxSet","scored","baseScore","norm","score","nameWordMatches","results","searchTime","result","firstKey","getAutocompleteSuggestions","suggestions","seen","prods","norms","parseSearchIntent","intent","typeRoots","colorRoots","styleRoots","materialRoots","priceMatch","value","getProactiveSuggestions","STORAGE_KEYS","MAX_ITEMS","MAX_BACK_IN_STOCK","DEFAULT_RECO_TWEAKS","DEFAULT_RECO_WEIGHTS","getJSONSafe","key","fallback","trackProductView","filtered","getViewedProducts","updated","updateCategoryPreference","parsed","getRecentlyViewedIds","likeProduct","productId","liked","getLikedProducts","disliked","getDislikedProducts","dislikeProduct","SIGNAL_LIMITS","stopWords","clampSignal","extractSignalTokens","categories","keywords","getPreferenceSignals","savePreferenceSignals","signals","updatePreferenceSignals","delta","cat","next","kw","toggleLikeProduct","isLiked","isDisliked","nextLiked","toggleDislikeProduct","nextDisliked","isProductLiked","isProductDisliked","requestBackInStock","getBackInStockRequests","list","trackSectionEvent","sectionId","type","entry","trackSearch","getSearchHistory","saveStyleDNA","quizAnswers","styleDNAText","getStyleDNA","trackAIFeedback","messageId","isPositive","context","feedback","getAIFeedback","saveChatContext","summary","getChatContext","category","prefs","getUserPreferences","getRecommendationTweaks","setRecommendationTweaks","merged","resetRecommendationTweaks","getRecommendationWeights","getABVariant","testId","tests","variant","trackABEvent","getTopCategories","name","getPersonalizedContext","viewedProducts","likedProducts","topCategories","styleDNA","searchHistory","getPersonalizedRecommendations","allProducts","viewedIds","likedIds","dislikedIds","tweaks","weights","avgPriceBase","avgPrice","sum","price","productCategory","index","signal","space","colors","budget","priority","room","productText","styleKeywords","roomKeywords","diff","stockQty","getSimilarProducts","productName","productPrice","pName","pCategory","pPrice","priceDiff","generateText","prompt","temperature","maxTokens","response","analyzeImage","base64Image","mimeType","Skeleton","className","baseClasses","variants","jsx","ProductCardSkeleton","jsxs","ProductGridSkeleton","count","_","ToastContext","createContext","TOAST_TYPES","CheckCircle2","XCircle","AlertCircle","Info","ShoppingCart","Heart","Sparkles","Bell","Truck","Toast","title","message","duration","onClose","action","isVisible","setIsVisible","useState","isLeaving","setIsLeaving","config","Icon","useEffect","timer","handleClose","X","ToastContainer","toasts","removeToast","toast","ToastProvider","children","setToasts","addToast","useCallback","prev","t","useToast","useContext","EmptyState","Package","description","secondaryAction","size","NoSearchResults","onClear","onSuggest","Search","RefreshCw","NoFilterResults","onClearFilters","Filter","Badge","pulse","sizes","iconSizes","NewBadge","DiscountBadge","percent","Percent","HotBadge","Flame","BestsellerBadge","Award","LimitedBadge","Clock","FreeShippingBadge","StockBadge","inStock","SmartBadges","maxBadges","badges","topBadges","badge","CATEGORY_ICONS","LayoutGrid","Sofa","Armchair","Tv","BedDouble","Briefcase","Table","UtensilsCrossed","Warehouse","Shirt","Box","BookOpen","Lamp","LampDesk","Baby","Bath","TreeDeciduous","Flower2","Home","Gift","getCategoryIcon","categoryName","lowerName","CategoryIcon","props","AIOnboarding","isOpen","targetFeature","messages","MessageCircle","Camera","content","Lightbulb","CategorySwipe","activeCategory","onCategoryChange","displayedCount","activeTotalOverride","isExpanded","setIsExpanded","canScrollLeft","setCanScrollLeft","canScrollRight","setCanScrollRight","scrollRef","useRef","activeData","activeTotalCount","VISIBLE_MOBILE","VISIBLE_DESKTOP","isMobile","setIsMobile","checkMobile","visibleCount","visibleCategories","hasMore","updateScrollIndicators","scrollLeft","scrollWidth","clientWidth","scroll","direction","activeEl","Grid3X3","Fragment","ChevronLeft","ChevronRight","ChevronUp","ChevronDown","PLACEHOLDER_IMAGE","normalizeProduct","formatPrice","formatPriceNumber","isValidEmail","email","getStockLevel","direct","match","val","toWebP","imageUrl","quality","isWebPSupported","canvas","support","getResponsiveSrcSet","appendSizeParam","width","getOptimizedImageProps","alt","height","lazy","responsive","optimizedUrl","getAdaptiveQuality","EnhancedProductCard","onToggleWishlist","isWishlisted","onQuickView","onAddToCart","highlightBadge","recommendationReasons","showFeedback","tone","accentClass","skipScrollAnimation","isHovered","setIsHovered","imageLoaded","setImageLoaded","imageError","setImageError","notifySaved","setNotifySaved","toneClasses","sizeClasses","sizeConfig","feedbackState","setFeedbackState","cardRef","impressionRef","mainImage","discount","displayPrice","reasonsText","optimizedProps","element","observer","delay","handleQuickView","handleNotify","hasWorldAccent","worldGlow","worldCorner","Eye","ThumbsUp","ThumbsDown","PRESET_STORAGE_KEY","CATEGORY_IMAGES","getCategoryImage","getCategoryTheme","themes","theme","Breadcrumb","onBack","CategoryHero","productCount","bgImage","SidebarFilters","onFilterChange","priceRange","onPriceRangeChange","filterOptions","useMemo","brands","prices","minPrice","maxPrice","previewCounts","brandCounts","colorCounts","isInStock","brandOk","colorOk","toggleFilter","current","FilterSection","items","item","preview","Tag","SlidersHorizontal","RelatedCategories","currentCategory","allCategories","related","CategoryStory","blocks","ShieldCheck","MapPin","block","PriceStats","stats","computedStats","stat","FeaturedProducts","onProductClick","onWishlistToggle","wishlist","featured","Star","CompactProductCard","onCompare","isComparing","hasDiscount","discountPct","GitCompare","AIBanner","onAskAI","ViewControls","sortOption","onSortChange","viewMode","onViewModeChange","loadedCount","totalCount","onOpenFilters","compareCount","Rows3","mode","CategoryPage","onLoadMore","setSortOption","setViewMode","setFilters","setPriceRange","showFilters","setShowFilters","compareList","setCompareList","presetName","setPresetName","savedPresets","setSavedPresets","loadMoreRef","savePreset","applyPreset","preset","quickApply","quickCounts","under100","premium","displayedProducts","dA","stock","viewed","visibleProducts","hasMoreToShow","toggleCompare","CollectionHero","collection","CollectionCompactCard","CollectionPage","onNavigateToCategory","isLoading","activeCategoryFilter","setActiveCategoryFilter","styleFilteredProducts","searchStr","inCollectionCategories","set","CARD_COLORS","MainCategoriesSection","mainCategories","onCategorySelect","totalProductCount","main","isActive","color","child","RECENT_CATEGORIES_KEY","RECENT_CATEGORIES_MAX","ANNOUNCEMENT_MESSAGES","Zap","TrendingUp","POPULAR_CATEGORIES","MEGA_MENU_COLORS","Navbar","activeTab","setActiveTab","wishlistCount","categoryHierarchy","onOpenWishlist","onScrollToShop","recentlyViewedProp","fixUrl","onRecentProductClick","mobileMenuOpen","setMobileMenuOpen","isScrolled","setIsScrolled","announcementIndex","setAnnouncementIndex","announcementProgress","setAnnouncementProgress","announcementStartRef","isDarkMode","setIsDarkMode","showMegaMenu","setShowMegaMenu","isReturningUser","setIsReturningUser","userName","setUserName","mobileMenuClosing","setMobileMenuClosing","touchStartX","setTouchStartX","recentlyViewedLocal","setRecentlyViewedLocal","recentCategories","setRecentCategories","mobileCategoriesExpanded","setMobileCategoriesExpanded","mobileExpandedMain","setMobileExpandedMain","megaMenuHoverMain","setMegaMenuHoverMain","mobileMenuRef","megaMenuRef","megaMenuPanelRef","megaMenuCloseTimeoutRef","hamburgerButtonRef","lastVisit","savedName","load","pushRecentCategory","ANNOUNCEMENT_DURATION_MS","interval","announcementRafRef","start","tick","handleScroll","handleEsc","handleClickOutside","panel","focusables","first","handleKeyDown","closeMobileMenu","handleTouchStart","handleTouchEnd","focusSearchAndClose","openMobileMenu","setTabAndClose","tab","navItems","Move","currentAnnouncement","isHover","isActiveMain","MainIcon","isActiveChild","ArrowRight","menuCategories","isRealCategories","Sun","Moon","Menu","part","arr","React","v","realCats","initialCount","shown","isReal","Phone","Mail","Instagram","Facebook","ScrollProgress","scrollProgress","setScrollProgress","rafId","updateScrollProgress","scrollTop","scrollHeight","progress","onScroll","BackToTop","toggleVisibility","scrolled","scrollPercent","scrollToTop","ArrowUp","createMotionComponent","tag","forwardRef","initial","animate","exit","transition","whileHover","whileTap","style","ref","motion","AnimatePresence","onExitComplete","LiveSocialProof","currentProduct","recentPurchases","viewerCount","setViewerCount","showNotification","setShowNotification","currentNotification","setCurrentNotification","baseViewers","change","notifications","ShoppingBag","Users","random","MIN_VIEWERS","MAX_VIEWERS","getRandomViewers","LiveActivityStrip","viewers","setViewers","Circle","CountUp","suffix","decimals","setCount","countRef","hasStarted","easeOutQuad","easedProgress","formatNumber","num","QUICK_INTENTS","SUCCESSFUL_SEARCHES_KEY","SEARCH_DEBOUNCE_MS","LONG_PRESS_MS","QUICK_FILTER_PRESETS","PROACTIVE_QUICK","escapeRegExp","HeroSmartSearch","onSearch","onTryAI","onOpenProductQuickView","setQuery","setIsOpen","isSearching","setIsSearching","didSearch","setDidSearch","dismissedFilterIds","setDismissedFilterIds","compareProducts","setCompareProducts","searchJourney","setSearchJourney","showRewriteOptions","setShowRewriteOptions","showQuickFilterPanel","setShowQuickFilterPanel","likedProductIds","setLikedProductIds","viewedProductIds","setViewedProductIds","preferredCategories","setPreferredCategories","preferredKeywords","setPreferredKeywords","searchPulse","setSearchPulse","resultCountPulse","setResultCountPulse","hoverCard","setHoverCard","smartResults","setSmartResults","smartTotalMatches","setSmartTotalMatches","isIndexBuilding","setIsIndexBuilding","previewProduct","setPreviewProduct","previewAnchor","setPreviewAnchor","instantSearchRef","longPressTimerRef","trimmedQuery","cancelled","debouncedQuery","setDebouncedQuery","nextResults","nextTotal","queryTokens","parsedFilters","activeFilters","queryMatchedProducts","haystack","token","rankedQueryProducts","likedSet","viewedSet","categoryFull","categoryLeaf","previewProducts","unique","starterProducts","contextualSuggestions","categoryMap","actualResultCount","confidenceScore","confidenceMeta","dynamicQuickSuggestions","firstToken","quickHitSuggestions","text","rewriteSuggestions","mainCategory","topStyle","topColor","rewriteSuggestionsWithQuality","intentTimeline","timeline","priceText","hasNoResults","rescueSuggestions","triggerFullSearch","inputQuery","source","safeQuery","handleSubmit","now","prevNorm","x","applySuggestion","opts","submit","handlePreviewProductClick","removeFilter","filter","clearAllFilters","removeFromHistory","queryToRemove","toggleCompareProduct","runCompareSearch","composed","applyRewrite","applyQuickFilterToken","normalized","formatPriceHu","getProductImage","isPersonalMatch","getTopBadge","handleCardMouseMove","event","rect","px","rx","ry","displayedTopProducts","historyGrouped","startOfToday","startTs","today","earlier","categoryCounter","keywordCounter","topKeywords","stored","history","Wand2","group","values","BrainCircuit","step","RotateCcw","cp","Plus","QUICK_CARD_COLORS","QUICK_CATEGORY_LIMIT","MIN_QUICK_CATEGORY_PRODUCTS","CAROUSEL_SCROLL_DURATION","CAROUSEL_AUTO_INTERVAL","CAROUSEL_AUTO_STEP_FRACTION","smoothScrollTo","targetLeft","dist","easeInOutCubic","eased","HERO_REVEAL_DELAY","ModernHero","onExplore","quickCategories","onQuickCategory","onHeroSearch","onHeroQuickView","heroVariant","setHeroVariant","storageKey","existing","assigned","heroCopy","statCardStyles","HERO_BG_IMAGE","mains","subcats","allItems","byName","quickCategoryItems","categoryCarouselRef","categoryCarouselPaused","setCategoryCarouselPaused","getCategoryScrollStep","container","gap","maxScroll","scrollCategoryCarousel","target","img","gradient","FadeInOnScroll","threshold","prefersReducedMotion","setPrefersReducedMotion","mq","handler","getTransform","visible","Confetti","onComplete","particles","setParticles","newParticles","timeout","animationFrame","prefix","setHasStarted","timestamp","easeOut","FEATURES","Move3d","AUTO_SCROLL_MS","SECTION_ID","StatDisplay","feature","reduceMotion","statPos","FeatureCard","layout","onClick","AIModuleUnified","onFeatureClick","isPaused","setIsPaused","cardWidth","setCardWidth","activeIndex","setActiveIndex","isScrolling","setIsScrolling","setReduceMotion","fn","handleClick","updateWidth","ro","totalWidth","handleTouchMove","sectionInView","setSectionInView","sectionRef","show","InteractiveCTA","onGetStarted","SimilarProducts","maxResults","similarProducts","setSimilarProducts","setIsLoading","aiReason","setAiReason","findSimilarProducts","localSimilar","productContext","combined","findBasicSimilar","handleLike","handleDislike","RecentlyViewed","maxItems","recentProducts","setRecentProducts","recent","handleStorageChange","ProductComparison","comparisonList","onRemove","onAddMore","ArrowLeftRight","useComparison","setComparisonList","addToComparison","removeFromComparison","AdvancedFiltersPanel","onApply","showHeader","onCloseHeader","min","max","cap","effective","previousFiltersRef","hasRestorableFilters","setHasRestorableFilters","handlePriceChange","toggleCategory","clearFilters","restorePrevious","DollarSign","AdvancedFilters","initialFilters","materials","activeFilterCount","panelContent","applyFilters","QuickAddToCart","onAdd","isAdding","setIsAdding","showSuccess","setShowSuccess","handleQuickAdd","Loader2","Check","ProductQuickPeek","activeImage","setActiveImage","images","imageProps","Share2","ExternalLink","SmartNewsletterPopup","onSubscribe","isSubmitted","setIsSubmitted","setEmail","setError","dismissed","subscribed","timeOnSiteTimeout","scrollDepthTriggered","exitIntentTriggered","handleMouseLeave","CheckCircle","ExitIntentPopup","discountPercent","hasShown","setHasShown","countdown","setCountdown","inactivityTimer","resetTimer","formatTime","seconds","mins","secs","Timer","ARProductPreview","isARAvailable","setIsARAvailable","checkARSupport","isSupported","isIOSSafari","ua","isIOS","isSafari","handleARLaunch","usdzUrl","generateMockUSDZ","anchor","launchWebXR","openInARViewer","Smartphone","CompleteTheLook","onViewProduct","bundleItems","setBundleItems","selectedItems","setSelectedItems","bundleTitle","setBundleTitle","findComplementaryProducts","complementaryMap","searchTerms","complements","currentPrice","pCat","term","fallbackProducts","toggleItem","selectedProducts","bundleOriginalPrice","bundleDiscount","bundleFinalPrice","savedAmount","handleAddBundle","isSelected","ImageGallery","currentIndex","setCurrentIndex","isZoomed","setIsZoomed","zoomPosition","setZoomPosition","isFullscreen","setIsFullscreen","touchStart","setTouchStart","mainImageRef","imageList","currentImage","goToNext","goToPrev","handleMouseMove","y","toggleZoom","touchEnd","ZoomIn","Maximize2","StickyAddToCart","observedElementId","isShown","setIsShown","addedToCart","setAddedToCart","setQuantity","originalPrice","stockLevel","isLowStock","handleAddToCart","AlertTriangle","Shield","PriceAlert","targetPrice","setTargetPrice","isAlertSet","setIsAlertSet","suggestedPrice","alertData","removeAlert","BellRing","PriceAlertModal","onSubmit","TrendingDown","BottomSheet","snapPoints","initialSnap","showHandle","showClose","currentSnap","setCurrentSnap","isDragging","setIsDragging","dragOffset","setDragOffset","touchStartY","setTouchStartY","sheetRef","contentRef","getSheetHeight","WishlistDrawer","wishlistItems","onClearAll","isClosing","setIsClosing","totalValue","handleShare","Trash2","FLASH_DISMISS_KEY","getTodayKey","FLASH_OFFERS","FlashSaleBanner","endTime","subtitle","onViewSale","onDismiss","timeLeft","setTimeLeft","calculateTimeLeft","offerIndex","setOfferIndex","currentOffer","displayTitle","displaySubtitle","displayCta","displayCtaShort","bgGradient","ctaColor","isDismissed","setIsDismissed","isExpired","setIsExpired","newTime","offerTimer","goToOffer","endX","handlePrev","handleNext","handleDismiss","pad","TOTAL_SALE_MS","remainingMs","timeLeftProgress","unit","DeliveryEstimator","postalCode","setPostalCode","isChecking","setIsChecking","deliveryInfo","setDeliveryInfo","calculateDelivery","code","isBudapest","isLargeCity","standardDays","expressDays","standardDate","expressDate","formatDate","date","days","months","defaultEstimate","minDate","maxDate","StockUrgency","viewingCount","setViewingCount","setRecentPurchases","lastPurchaseTime","setLastPurchaseTime","minutes","viewInterval","purchaseInterval","isVeryLowStock","isOutOfStock","ProductShare","showModal","setShowModal","copied","setCopied","shareUrl","shareTitle","shareText","handleNativeShare","handleCopyLink","shareLinks","ShareModal","link","Link2","onCopy","Copy","ProductTabs","expandedFaq","setExpandedFaq","tabs","FileText","Ruler","HelpCircle","specs","reviews","avgRating","r","faqItems","spec","star","rating","review","PriceHistory","priceHistory","onSetAlert","alertSet","setAlertSet","validPrice","basePrice","month","variance","avg","previousPrice","priceChange","changePercent","isLowest","isHighest","chartHeight","chartWidth","chartPath","range","areaPath","handleSetAlert","getTrendIcon","Minus","getTrendColor","OneClickCheckout","savedAddress","savedPayment","userEmail","onCheckout","isProcessing","setIsProcessing","selectedPayment","setSelectedPayment","setStep","paymentMethods","CreditCard","Apple","handleCheckout","method","Lock","highlightMatch","re","parts","SmartSearchBar","indexVersion","shouldBuildIndex","maxLocalIndex","serverSearchMode","placeholder","selectedIndex","setSelectedIndex","indexStatus","setIndexStatus","serverPreview","setServerPreview","inputRef","containerRef","debounceTimerRef","resultsRef","indexedCountRef","indexedVersionRef","serverRequestIdRef","canUseLocalIndex","localIndexDisabled","doBuild","requestId","autocompleteSuggestions","searchResults","searchIntent","proactiveSuggestions","recentSearches","recentlyViewed","trendingSearches","viewedCategories","defaults","handleGlobalKeyDown","handleFocusSearch","handleInputChange","handleProductClickFn","full","handleSuggestionClick","suggestion","handleAutocompleteClickFn","clearQuery","handleProductClick","handleAutocompleteClick","allNavigableItems","sug","totalItems","selected","renderIntentTags","tags","priceLabel","ArrowUpRight","actualIndex","History","search","ARMeasure","onConfirmFit","roomDimensions","setRoomDimensions","fitResult","setFitResult","productDimensions","handleDimensionChange","field","numValue","handleCheckFit","roomW","roomL","roomH","fitsWidth","fitsDepth","fitsHeight","spaceFit","tightFit","resetMeasurement","isFormValid","StickyAddToCartMobile","isInWishlist","isInCart","freeShippingThreshold","showQuantity","setShowQuantity","justAdded","setJustAdded","totalPrice","freeShippingRemaining","incrementQuantity","decrementQuantity","TrustBadges","Headphones","checkoutBadges","useLocalStorage","initialValue","storedValue","setStoredValue","valueToStore","useDebounce","debouncedValue","setDebouncedValue","WEBSHOP_DOMAIN","SHOP_ID","DISPLAY_BATCH","INITIAL_PAGE","TAB_HASH","HASH_TO_TAB","AIChatAssistant","__vitePreload","AIRoomDesigner","AIStyleQuiz","InspirationSection","ProductWorldsSection","NewsletterStrip","PersonalizedSection","LoyaltyProgram","MODAL_LOADING_FALLBACK","cleanUrl","Features","ProductModal","aiTip","setAiTip","loadingTip","setLoadingTip","generateStyleTip","param","VisualSearch","selectedImage","setSelectedImage","isAnalyzing","setIsAnalyzing","setSearchResults","analysisText","setAnalysisText","handleImageUpload","file","reader","base64Data","analyzeImageAI","analysis","relevant","RoomPlanner","background","setBackground","placedItems","setPlacedItems","selectedItemId","setSelectedItemId","handleBackgroundUpload","addItem","App","setActiveTabState","hash","newHash","setProducts","totalProductsCount","setTotalProductsCount","hasMoreProducts","setHasMoreProducts","isLoadingMore","setIsLoadingMore","filteredLengthRef","hasMoreProductsRef","isLoadingMoreRef","setWishlist","setWishlistItems","sectionRotateTick","setSectionRotateTick","searchQuery","setSearchQuery","searchQueryRef","SERVER_SEARCH_ONLY","MAX_LOCAL_INDEX","searchIndexRef","searchIndexReady","setSearchIndexReady","searchIndexVersion","setSearchIndexVersion","searchTotalMatches","setSearchTotalMatches","categoryFilter","setCategoryFilter","isDemoMode","setIsDemoMode","selectedProduct","setSelectedProduct","isChatOpen","setIsChatOpen","showAIOnboarding","setShowAIOnboarding","onboardingFeature","setOnboardingFeature","advancedFilters","setAdvancedFilters","setCategoryHierarchy","categoryStats","setCategoryStats","selectedCollection","setSelectedCollection","activeHierarchyCount","getCategoryMainList","showStyleQuiz","setShowStyleQuiz","showRoomDesigner","setShowRoomDesigner","aiRecommendedProducts","setAiRecommendedProducts","aiRecommendationLabel","setAiRecommendationLabel","showDeferredAI","setShowDeferredAI","quickPeekProduct","setQuickPeekProduct","showARPreview","setShowARPreview","arProduct","setArProduct","showARMeasure","setShowARMeasure","arMeasureProduct","setArMeasureProduct","showOneClickCheckout","setShowOneClickCheckout","oneClickProduct","setOneClickProduct","showConfetti","setShowConfetti","showFilterSheet","setShowFilterSheet","showExitIntent","setShowExitIntent","showWishlistDrawer","setShowWishlistDrawer","featuredPool","setFeaturedPool","featuredPoolKeyRef","flashSaleEndTime","isLoadingUnas","setIsLoadingUnas","unasError","setUnasError","lastUpdated","setLastUpdated","dataSource","setDataSource","comparison","handleProductView","trackProductViewPref","handleShowAIProducts","firstArg","secondArg","recommendedProducts","label","clickedProduct","allRecommended","clickedCat","sameCategory","clickedPrice","similarPrice","scrollToProductsSectionRef","clearAIRecommendations","toggleWishlist","productUrl","fullUrl","serverSearchQuery","setServerSearchQuery","serverCategory","setServerCategory","loadUnasData","silent","categoryMain","append","categoryMainList","categoriesList","newProducts","requestScrollToProductsRef","handleServerSearch","hasUserSearchedRef","useLayoutEffect","getScrollParent","appRoot","isScrollable","oy","parent","insideApp","lastScrollToProductsRef","scrollToProductsSection","retryCount","scrollParent","elRect","parentRect","targetScrollTop","handleCategoryChange","handleCollectionSelect","handleCollectionBack","loadUnasDataRef","canUseLocalSearch","debouncedSearch","cats","mainNames","leafNames","mainSegments","styleKw","useApiSearch","onHashChange","totalMatches","extraTimeoutId","mergeInto","map","extraOffsets","o","batches","normalizedAdvancedFilters","mobileActiveFilterCount","filteredAndSortedProducts","collectionFilteredProducts","lower","isSearchMode","isSearchActive","sectionProducts","sectionContextLabel","featuredBase","headerCount","handleLoadMore","handleCollectionLoadMore","total","categoryCount","sorted","recentPurchasesForSocialProof","Suspense","meta","col","reward","catMain","recs","ErrorBoundary","errorInfo","Fallback","scrollTopNow","rootEl","ReactDOM"],"ignoreList":[0,1,2],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/services/unasApi.js","../../src/services/unasCartService.js","../../src/services/aiSearchService.js","../../src/services/userPreferencesService.js","../../src/services/geminiService.js","../../src/components/ui/Skeleton.jsx","../../src/components/ui/Toast.jsx","../../src/components/ui/EmptyState.jsx","../../src/components/ui/Badge.jsx","../../src/components/ui/Icons.jsx","../../src/components/ai/AIShowcase.jsx","../../src/components/category/CategorySwipe.jsx","../../src/utils/helpers.js","../../src/utils/imageOptimizer.js","../../src/components/product/EnhancedProductCard.jsx","../../src/components/category/CategoryPage.jsx","../../src/components/collection/CollectionPage.jsx","../../src/components/category/MainCategoriesSection.jsx","../../src/components/layout/Navbar.jsx","../../src/components/ux/ScrollProgress.jsx","../../src/components/ux/BackToTop.jsx","../../src/utils/motion-shim.jsx","../../src/components/ux/LiveSocialProof.jsx","../../src/components/ux/LiveActivityStrip.jsx","../../src/components/ui/CountUp.jsx","../../src/components/landing/HeroSmartSearch.jsx","../../src/utils/categoryImages.js","../../src/components/landing/ModernHero.jsx","../../src/components/ui/Animations.jsx","../../src/components/landing/AIModuleUnified.jsx","../../src/components/landing/ShowcaseSections.jsx","../../src/components/product/SimilarProducts.jsx","../../src/components/product/RecentlyViewed.jsx","../../src/components/product/ProductComparison.jsx","../../src/components/product/AdvancedFilters.jsx","../../src/components/product/QuickAddToCart.jsx","../../src/components/product/ProductQuickPeek.jsx","../../src/components/marketing/SmartNewsletterPopup.jsx","../../src/components/marketing/ExitIntentPopup.jsx","../../src/components/ar/ARProductPreview.jsx","../../src/components/product/CompleteTheLook.jsx","../../src/components/product/ImageGallery.jsx","../../src/components/product/StickyAddToCart.jsx","../../src/components/product/PriceAlert.jsx","../../src/components/mobile/BottomSheet.jsx","../../src/components/wishlist/WishlistDrawer.jsx","../../src/components/marketing/FlashSaleBanner.jsx","../../src/components/product/DeliveryEstimator.jsx","../../src/components/product/StockUrgency.jsx","../../src/components/product/ProductShare.jsx","../../src/components/product/ProductTabs.jsx","../../src/components/product/PriceHistory.jsx","../../src/components/checkout/OneClickCheckout.jsx","../../src/components/search/SmartSearchBar.jsx","../../src/components/ar/ARMeasure.jsx","../../src/components/mobile/StickyAddToCartMobile.jsx","../../src/components/trust/TrustBadges.jsx","../../src/hooks/index.js","../../src/config.js","../../src/App.jsx","../../src/components/ui/ErrorBoundary.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * UNAS API Service\n * API-first, kis lapmret: soha ne tltsnk 200k termket memriba.\n * Cl: 3 mp alatt interaktv, alacsony memria.\n */\n\nconst getApiBase = () => {\n  let base = '';\n  if (typeof window !== 'undefined' && window.MARKETLY_CONFIG?.apiBase) {\n    base = window.MARKETLY_CONFIG.apiBase;\n  } else {\n    base = import.meta.env.VITE_API_URL || 'http://localhost:3002';\n  }\n  base = (base || '').replace(/\\/+$/, '');\n  if (base && !base.endsWith('/api')) base = base + '/api';\n  return base;\n};\n\nconst getBackendOrigin = () => {\n  const api = getApiBase();\n  return api ? api.replace(/\\/api\\/?$/, '') : '';\n};\n\n/** Els lap mrete (gyors first paint) */\nconst DEFAULT_LIMIT = 200;\n\n/**\n * Termkek betltse  MINDIG API, limit/offset.\n * Nincs teljes katalgus a kliensen; lapozs s keress szerveren.\n */\nexport const fetchUnasProducts = async (filters = {}) => {\n  if (typeof window === 'undefined') return { products: [], total: 0, count: 0, lastSync: null, source: 'api' };\n\n  const limit = filters.limit != null ? Number(filters.limit) : DEFAULT_LIMIT;\n  const offset = filters.offset != null ? Number(filters.offset) : 0;\n\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    params.set('limit', String(limit));\n    params.set('offset', String(offset));\n    if (filters.slim !== undefined) {\n      params.set('slim', filters.slim ? 'true' : 'false');\n    }\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categories && Array.isArray(filters.categories) && filters.categories.length > 0) {\n      params.set('categories', filters.categories.filter(Boolean).join(','));\n    } else if (filters.categories && typeof filters.categories === 'string' && filters.categories.trim()) {\n      params.set('categories', filters.categories.trim());\n    }\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.styleKeywords && Array.isArray(filters.styleKeywords) && filters.styleKeywords.length > 0) {\n      params.set('styleKeywords', filters.styleKeywords.filter(Boolean).join(','));\n    }\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n\n    const url = `${API_BASE}/products?${params.toString()}`;\n    const res = await fetch(url, { method: 'GET' });\n\n    if (!res.ok) {\n      return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: res.status };\n    }\n\n    const data = await res.json();\n    const products = (data.products || []).map(p => ({\n      ...p,\n      images: p.images || (p.image ? [p.image] : []),\n      image: p.images?.[0] || p.image,\n      inStock: p.inStock !== undefined ? p.inStock : Boolean(p.in_stock)\n    }));\n\n    return {\n      products,\n      total: data.total ?? products.length,\n      count: products.length,\n      lastSync: data.lastSync ?? null,\n      source: 'api'\n    };\n  } catch (error) {\n    return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: error.message };\n  }\n};\n\n/**\n * Fetch categories from backend\n */\nexport const fetchCategories = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories`);\n    if (!res.ok) return ['sszes'];\n    const data = await res.json();\n    // Backend returns category objects, extract just the names\n    const categoryNames = (data.categories || [])\n      .map(cat => typeof cat === 'string' ? cat : cat.name)\n      .filter(Boolean)\n      .sort();\n    return ['sszes', ...categoryNames];\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    return ['sszes'];\n  }\n};\n\n/**\n * Keresindex: minden termk minimlis adattal (gyors, gzip-pel kisebb).\n * A keres ezen fut; frissts = jra letlti (kszlet napraksz).\n */\nexport const fetchSearchIndex = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/products/search-index`);\n    if (!res.ok) return { products: [], lastSync: null };\n    const data = await res.json();\n    if (Array.isArray(data)) return { products: data, lastSync: null };\n    return {\n      products: Array.isArray(data.products) ? data.products : [],\n      lastSync: data.lastSync || null\n    };\n  } catch (error) {\n    return { products: [], lastSync: null };\n  }\n};\n\n/**\n * Fetch category hierarchy (main + children) for navbar/mobile menu\n * Returns { mainCategories: [ { name, productCount, children: [ { name, productCount } ] } ] }\n */\nexport const fetchCategoryHierarchy = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories/hierarchy`);\n    if (!res.ok) return { mainCategories: [] };\n    const data = await res.json();\n    return { mainCategories: Array.isArray(data.mainCategories) ? data.mainCategories : [] };\n  } catch (error) {\n    console.error('Error fetching category hierarchy:', error);\n    return { mainCategories: [] };\n  }\n};\n\n/**\n * Fetch single product by ID (full detail)\n */\nexport const fetchUnasProductById = async (id) => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/products/${id}`);\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      ...data,\n      images: data.images || (data.image ? [data.image] : []),\n      image: data.images?.[0] || data.image,\n      inStock: data.inStock !== undefined ? data.inStock : Boolean(data.in_stock)\n    };\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Product stats (counts + price range + in stock)\n */\nexport const fetchProductStats = async (filters = {}) => {\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n    const res = await fetch(`${API_BASE}/products/stats?${params.toString()}`);\n    if (!res.ok) return null;\n    return await res.json();\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Force refresh products from UNAS (trigger sync)\n */\nexport const refreshUnasProducts = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.message || `HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return {\n      success: data.success,\n      fetched: data.fetched,\n      added: data.added,\n      updated: data.updated\n    };\n  } catch (error) {\n    console.error('Error refreshing UNAS products:', error);\n    throw new Error(`Failed to refresh products: ${error.message}`);\n  }\n};\n\n/**\n * Get cache information from backend\n */\nexport const getCacheInfo = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /stats, not /api/stats\n    const response = await fetch(`${API_BASE}/stats`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching stats:', error);\n    throw new Error(`Failed to fetch stats: ${error.message}`);\n  }\n};\n\n/**\n * Clear backend cache (trigger manual sync)\n */\nexport const clearCache = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error triggering sync:', error);\n    throw new Error(`Failed to trigger sync: ${error.message}`);\n  }\n};\n\n/**\n * Backend health (GET /health a gykrn, nem /api alatt)\n */\nexport const checkBackendHealth = async () => {\n  try {\n    const origin = getBackendOrigin();\n    const response = await fetch(`${origin}/health`, { method: 'GET' });\n    if (!response.ok) return { status: 'error', message: `HTTP ${response.status}` };\n    return await response.json();\n  } catch (error) {\n    return { status: 'error', message: error.message };\n  }\n};\n","/**\n * UNAS Cart Service  kosrhoz ads (cart_add)\n * A widget UNAS oldalon fut, a termkek a f UNAS kosrba kerlnek.\n *\n * cart_add(productId, prefix, null, quantity)  termk oldalon 4 paramter\n * A cart_add a mennyisg inputot keresi: id=\"db_{prefix}{productId}\" vagy id=\"db_{productId}\"\n */\n\n/** Kategria/kollekci oldalon az UNAS artlist_ prefixet vrja (db_artlist_{productId}) */\nfunction getCartAddPrefix() {\n  if (typeof window === 'undefined') return '';\n  try {\n    const path = (window.location?.pathname || '') + (window.top?.location?.pathname || '');\n    if (/\\/sct\\//.test(path)) return 'artlist_';\n  } catch (_) { /* cross-origin */ }\n  return '';\n}\n\n/** Kinyeri a VX-XXXXX formtum SKU-t linkbl vagy kpek URL-jbl (UNAS variant ref) */\nfunction extractVxSku(product) {\n  const link = (product?.link || product?.url || '').trim();\n  const m1 = link.match(/(VX-\\d+)/i);\n  if (m1) return m1[1];\n  const imgs = product?.images || (product?.image ? [product.image] : []);\n  const firstImg = Array.isArray(imgs) ? imgs[0] : imgs;\n  const imgUrl = typeof firstImg === 'string' ? firstImg : firstImg?.url || firstImg?.src || '';\n  const m2 = String(imgUrl).match(/(VX-\\d+)/i);\n  if (m2) return m2[1];\n  return null;\n}\n\n/**\n * UNAS termk ID formtum: VX__unas__{id}\n * Az UNAS add_to_favourites: cikk.replace(/-/g,'__unas__')  pl. VX-274769  VX__unas__274769\n * Preferlja: unas_ref (VX-xxx), sku, link/kpbl kinyert VX-xxx, unas_id, id.\n */\nfunction toUnasProductId(product) {\n  if (!product) return null;\n  // 1) unas_ref / sku  gyakran VX-274769 formtum\n  let raw = product?.unas_ref ?? product?.sku ?? extractVxSku(product);\n  if (raw) {\n    const s = String(raw).trim();\n    if (s && !s.startsWith('unas-prod-')) {\n      if (s.includes('-')) return s.replace(/-/g, '__unas__');\n      if (s.startsWith('VX__unas__')) return s;\n      return `VX__unas__${s}`;\n    }\n  }\n  // 2) unas_id / id  numerikus\n  const id = product?.unas_id ?? product?.id;\n  if (!id) return null;\n  const str = String(id).trim();\n  if (str.startsWith('unas-prod-') || str === '') return null;\n  if (str.startsWith('VX__unas__')) return str;\n  return `VX__unas__${str}`;\n}\n\n/**\n * cart_add s a hozz tartoz window  lehet iframe-ben, parent vagy top window-ban.\n * Fontos: az inputot UGYANABBA a documentba kell tenni, ahol a cart_add fut (pl. parent),\n * mert a cart_add document.getElementById()-ot hasznl a sajt documentjn.\n */\nfunction getCartAddContext() {\n  if (typeof window === 'undefined') return null;\n  const wins = [window, window.parent, window.top].filter(Boolean);\n  for (const w of wins) {\n    try {\n      if (typeof w.cart_add === 'function') return { cartAdd: w.cart_add, win: w };\n    } catch (_) { /* cross-origin */ }\n  }\n  return null;\n}\n\nfunction getCartAdd() {\n  const ctx = getCartAddContext();\n  return ctx ? ctx.cartAdd : null;\n}\n\n/**\n * UNAS form keresse  kosr/termk form, ahova az input kerlhet\n */\nfunction findUnasForm(doc) {\n  if (!doc) return null;\n  const selectors = [\n    'form[action*=\"cart\"]',\n    'form[id*=\"cart\"]',\n    'form[name*=\"cart\"]',\n    'form[action*=\"kosar\"]',\n    'form#product_form',\n    'form.product-form'\n  ];\n  for (const sel of selectors) {\n    try {\n      const form = doc.querySelector(sel);\n      if (form) return form;\n    } catch (_) { /* invalid selector */ }\n  }\n  return null;\n}\n\n/**\n * Mennyisg input ltrehozsa  a cart_add UGYANABBAN a documentban keresi!\n * Ha iframe-ben futunk, a cart_add a parent/top-ban van  az inputot is oda kell tenni.\n * Ltrehozunk db_{unasId} s db_{numericId} inputot is  UNAS klnbz sablonokban eltr formtumot vr.\n */\nfunction ensureQtyInput(unasId, qty, targetDoc) {\n  if (!targetDoc) return null;\n  const numericId = unasId.replace(/^VX__unas__/, '');\n  const ids = [`db_${unasId}`];\n  if (numericId && numericId !== unasId) ids.push(`db_${numericId}`);\n  let input = null;\n  for (const inputId of ids) {\n    input = targetDoc.getElementById(inputId);\n    if (input) break;\n  }\n  if (!input) {\n    input = targetDoc.createElement('input');\n    input.type = 'number';\n    input.name = 'db';\n    input.id = ids[0];\n    input.value = String(qty);\n    input.setAttribute('data-min', '1');\n    input.setAttribute('data-max', '999999');\n    input.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n    const form = findUnasForm(targetDoc);\n    (form || targetDoc.body).appendChild(input);\n    // Fallback: numeric id input (ha UNAS ezt keresi)\n    if (ids.length > 1) {\n      const input2 = targetDoc.createElement('input');\n      input2.type = 'number';\n      input2.name = 'db';\n      input2.id = ids[1];\n      input2.value = String(qty);\n      input2.setAttribute('data-min', '1');\n      input2.setAttribute('data-max', '999999');\n      input2.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n      (form || targetDoc.body).appendChild(input2);\n    }\n  } else {\n    for (const id of ids) {\n      const el = targetDoc.getElementById(id);\n      if (el) el.value = String(qty);\n    }\n  }\n  return input;\n}\n\n/**\n * Kosrhoz ads az UNAS kosrba (ha window.cart_add elrhet).\n * @param {object} product - termk objektum (id, unas_id)\n * @param {number} quantity - mennyisg\n * @returns {boolean} - true ha sikeres, false ha nem elrhet vagy hiba\n */\nexport function addToUnasCart(product, quantity = 1) {\n  if (typeof window === 'undefined') return false;\n  const ctx = getCartAddContext();\n  if (!ctx || typeof ctx.cartAdd !== 'function') return false;\n\n  const unasId = toUnasProductId(product);\n  if (!unasId) return false;\n\n  const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n  try {\n    // Mennyisg input  a cart_add UGYANABBAN a documentban keresi (pl. parent/top)\n    let targetDoc;\n    try {\n      targetDoc = ctx.win.document;\n    } catch (_) {\n      targetDoc = typeof document !== 'undefined' ? document : null;\n    }\n    if (!targetDoc) return false;\n    ensureQtyInput(unasId, qty, targetDoc);\n    // 4 paramter: productId, prefix ('' = termk oldal), null, quantity\n    ctx.cartAdd(unasId, getCartAddPrefix(), null, qty);\n    if (window.__MARKETLY_DEBUG) {\n      console.log('[unasCartService] cart_add called:', { unasId, qty }, ` cart_add('${unasId}','',null,${qty})`);\n    }\n    return true;\n  } catch (err) {\n    if (window.__MARKETLY_DEBUG || process.env.NODE_ENV === 'development') {\n      console.warn('[unasCartService] cart_add error:', err);\n    }\n    return false;\n  }\n}\n","/**\n * ============================================================================\n * MARKETLY AI SEARCH ENGINE v4.0 - NON-BLOCKING INSTANT SEARCH\n * ============================================================================\n * \n *  NON-BLOCKING: Chunked async indexing - never freezes UI\n *  PRECISE: Intent-based scoring for perfect results\n *  FUZZY: Handles typos gracefully\n *  CACHED: Instant repeat searches\n */\n\n// ============================================================================\n// ENGINE STATE\n// ============================================================================\n\nlet INDEX = {\n  ready: false,\n  building: false,\n  products: [],           // Original products array reference\n  normalized: [],         // [{nameNorm, catNorm, price}]\n  wordToProducts: new Map(), // word  Set<index>\n  cache: new Map(),       // query  results\n  stats: { products: 0, words: 0, buildTime: 0 }\n};\n\n// ============================================================================\n// HUNGARIAN SYNONYMS - COMPREHENSIVE\n// ============================================================================\n\nconst SYNONYMS = {\n  // === LBTOROK ===\n  'kanap': ['szfa', 'sofa', 'couch', 'kanape', 'lgarnitra', 'garnitra', 'sarokkanap', 'sarok kanap', 'hever', 'rekami', 'pamlag'],\n  'fotel': ['karosszk', 'armchair', 'pihenfotel', 'relax fotel', 'relaxfotel', 'fles fotel', 'flesfotel', 'zskfotel', 'babzsk'],\n  'puff': ['lke', 'zsmoly', 'lbtart', 'ottoman', 'puffok'],\n  \n  // === ASZTALOK ===\n  'asztal': ['table', 'asztalka'],\n  'dohnyzasztal': ['kvasztal', 'coffee table', 'nappali asztal', 'kisasztal', 'lerakasztal', 'dohanyzoasztal'],\n  'tkezasztal': ['ebdlasztal', 'dining table', 'konyhaasztal', 'tkezasztal', 'etkezoasztal'],\n  'rasztal': ['munkaasztal', 'desk', 'szmtgpasztal', 'pc asztal', 'gamer asztal', 'irodaasztal', 'iroasztal'],\n  'jjeliszekrny': ['jjeli szekrny', 'nightstand', 'jjeli', 'ejjeliszekreny'],\n  \n  // === SZKEK ===\n  'szk': ['chair', 'szkek', 'szekek'],\n  'tkezszk': ['konyhai szk', 'dining chair', 'vendgszk', 'etkezoszek'],\n  'irodai szk': ['forgszk', 'irodai', 'gamer szk', 'gaming szk', 'office chair'],\n  'brszk': ['pultszk', 'bar stool', 'magas szk', 'barszek'],\n  \n  // === TROLK ===\n  'szekrny': ['cabinet', 'gardrb', 'gardrbszekrny', 'ruhsszekrny', 'szekreny'],\n  'komd': ['fikos szekrny', 'drawer', 'komod', 'komdok'],\n  'polc': ['shelf', 'polcok', 'knyvespolc', 'falipolc'],\n  'vitrin': ['vegszekrny', 'tlal', 'display cabinet'],\n  'tv szekrny': ['tv llvny', 'mdia szekrny', 'lowboard', 'tv btor'],\n  \n  // === HLSZOBA ===\n  'gy': ['bed', 'franciagy', 'boxspring', 'gykeret', 'agy'],\n  'matrac': ['mattress', 'habmatrac', 'rugs matrac', 'tskarugs'],\n  \n  // === STLUSOK ===\n  'modern': ['kortrs', 'contemporary', 'minimalista', 'dizjn', 'design'],\n  'skandinv': ['nordic', 'scandi', 'szaki', 'skandinav'],\n  'rusztikus': ['vidki', 'country', 'provence', 'natr', 'rusztikus'],\n  'indusztrilis': ['industrial', 'loft', 'ipari'],\n  'klasszikus': ['hagyomnyos', 'elegns', 'antik'],\n  'retro': ['vintage', 'mid-century'],\n  \n  // === SZNEK ===\n  'fehr': ['white', 'feher', 'hfehr', 'krmfehr'],\n  'fekete': ['black', 'stt', 'antracit'],\n  'szrke': ['gray', 'grey', 'szurke', 'grafit'],\n  'barna': ['brown', 'di', 'tlgy', 'bkk', 'csokold', 'mogyor'],\n  'bzs': ['beige', 'krm', 'homok', 'cappuccino', 'bezs'],\n  'kk': ['blue', 'navy', 'tengerkk', 'trkiz', 'kek'],\n  'zld': ['green', 'olva', 'smaragd', 'zold'],\n  'piros': ['red', 'bord', 'vrs', 'burgundy'],\n  'srga': ['yellow', 'mustr', 'arany'],\n  'rzsaszn': ['pink', 'rozsaszin', 'pder'],\n  \n  // === ANYAGOK ===\n  'fa': ['wood', 'wooden', 'tmrfa', 'MDF'],\n  'fm': ['metal', 'acl', 'vas', 'krm'],\n  'br': ['leather', 'valdi br', 'mbr', 'bor'],\n  'szvet': ['fabric', 'textil', 'krpit'],\n  'brsony': ['velvet', 'velr', 'barsony'],\n  'veg': ['glass', 'edzett veg'],\n  \n  // === SZOBK ===\n  'nappali': ['living room', 'szalon'],\n  'hlszoba': ['bedroom', 'hl', 'haloszoba'],\n  'konyha': ['kitchen'],\n  'iroda': ['office', 'dolgozszoba', 'home office'],\n  'gyerekszoba': ['kids room', 'gyerek', 'ifjsgi'],\n  'elszoba': ['hall', 'folyos', 'eloszoba'],\n  \n  // === FUNKCIK ===\n  'kinyithat': ['gyazhat', 'talakthat', 'vendggy'],\n  'trols': ['gynemtarts', 'fikos'],\n  'llthat': ['dnthet', 'emelhet'],\n  \n  // === R ===\n  'olcs': ['akcis', 'akci', 'kedvezmnyes', 'lerazott', 'olcso'],\n  'prmium': ['luxus', 'drga', 'exkluzv', 'designer'],\n};\n\n// Build reverse lookup\nconst WORD_TO_ROOT = new Map();\nfor (const [root, synonyms] of Object.entries(SYNONYMS)) {\n  const rootNorm = normalize(root);\n  WORD_TO_ROOT.set(rootNorm, rootNorm);\n  for (const syn of synonyms) {\n    WORD_TO_ROOT.set(normalize(syn), rootNorm);\n  }\n}\n\n// ============================================================================\n// TEXT NORMALIZATION\n// ============================================================================\n\nfunction normalize(str) {\n  if (!str) return '';\n  return str\n    .toLowerCase()\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')  \n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'a').replace(//g, 'e').replace(//g, 'i')\n    .replace(/[^a-z0-9]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction getWords(str) {\n  return normalize(str).split(' ').filter(w => w.length >= 2);\n}\n\nfunction expandWithSynonyms(words) {\n  const expanded = new Set(words);\n  for (const word of words) {\n    const root = WORD_TO_ROOT.get(word);\n    if (root) {\n      expanded.add(root);\n      // Add all synonyms of this root\n      const syns = SYNONYMS[root] || SYNONYMS[Object.keys(SYNONYMS).find(k => normalize(k) === root)];\n      if (syns) {\n        syns.forEach(s => expanded.add(normalize(s)));\n      }\n    }\n  }\n  return Array.from(expanded);\n}\n\n// ============================================================================\n// INDEX BUILDING - NON-BLOCKING CHUNKED\n// ============================================================================\n\nexport async function buildSearchIndex(products) {\n  if (!products || products.length === 0) {\n    console.warn(' No products to index');\n    return false;\n  }\n  \n  if (INDEX.building) {\n    console.log(' Index already building...');\n    return false;\n  }\n  \n  // If already indexed same products, skip\n  if (INDEX.ready && INDEX.products === products && INDEX.stats.products === products.length) {\n    console.log(' Index already up to date');\n    return true;\n  }\n  \n  INDEX.building = true;\n  INDEX.ready = false;\n  console.log(` Starting to learn ${products.length.toLocaleString()} products...`);\n  \n  const startTime = performance.now();\n  \n  // Reset\n  INDEX.products = products;\n  INDEX.normalized = new Array(products.length);\n  INDEX.wordToProducts = new Map();\n  INDEX.cache = new Map();\n  \n  const includeDesc = products.length <= 50000;\n\n  // Process in chunks to not block UI\n  const CHUNK_SIZE = 5000;\n  let processed = 0;\n  \n  const processChunk = () => {\n    return new Promise(resolve => {\n      const end = Math.min(processed + CHUNK_SIZE, products.length);\n      \n      for (let i = processed; i < end; i++) {\n        const p = products[i];\n        const nameNorm = normalize(p.name || '');\n        const catNorm = normalize(p.category || '');\n        const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n        \n        // Get all words\n        const allWords = new Set([\n          ...getWords(nameNorm),\n          ...getWords(catNorm),\n          ...(includeDesc ? getWords(descNorm) : [])\n        ]);\n        \n        // Expand with synonyms\n        const expanded = expandWithSynonyms(Array.from(allWords));\n        \n        // Store normalized data\n        INDEX.normalized[i] = {\n          nameNorm,\n          catNorm,\n          price: p.salePrice || p.price || 0\n        };\n        \n        // Build inverted index\n        for (const word of expanded) {\n          if (!INDEX.wordToProducts.has(word)) {\n            INDEX.wordToProducts.set(word, new Set());\n          }\n          INDEX.wordToProducts.get(word).add(i);\n        }\n      }\n      \n      processed = end;\n      \n      // Let UI breathe\n      setTimeout(resolve, 0);\n    });\n  };\n  \n  // Process all chunks\n  while (processed < products.length) {\n    await processChunk();\n    \n    // Log progress every 20%\n    const pct = Math.round((processed / products.length) * 100);\n    if (pct % 20 === 0 && pct > 0) {\n      console.log(`    ${pct}% indexed...`);\n    }\n  }\n  \n  const elapsed = performance.now() - startTime;\n  \n  INDEX.ready = true;\n  INDEX.building = false;\n  INDEX.stats = {\n    products: products.length,\n    words: INDEX.wordToProducts.size,\n    buildTime: elapsed\n  };\n  \n  console.log(` LEARNED ${products.length.toLocaleString()} products in ${elapsed.toFixed(0)}ms`);\n  console.log(`    ${INDEX.wordToProducts.size.toLocaleString()} words indexed`);\n  \n  return true;\n}\n\nexport function isIndexReady() {\n  return INDEX.ready;\n}\n\nexport function getIndexStats() {\n  return {\n    isIndexed: INDEX.ready,\n    building: INDEX.building,\n    productCount: INDEX.stats.products,\n    wordCount: INDEX.stats.words,\n    buildTime: INDEX.stats.buildTime\n  };\n}\n\n// ============================================================================\n// MAIN SEARCH FUNCTION\n// ============================================================================\n\nexport function smartSearch(products, query, options = {}) {\n  const { limit = 100 } = options;\n  \n  if (!query || !query.trim()) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  // If no products provided and no index, nothing to search\n  if ((!products || products.length === 0) && !INDEX.ready) {\n    console.warn(' smartSearch: No products and no index');\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  const queryNorm = normalize(query.trim());\n  \n  // Check cache first\n  const cacheKey = `${queryNorm}:${limit}`;\n  if (INDEX.cache.has(cacheKey)) {\n    const cached = INDEX.cache.get(cacheKey);\n    console.log(` CACHE: \"${query}\"  ${cached.totalMatches} results`);\n    return { ...cached, fromCache: true };\n  }\n  \n  const startTime = performance.now();\n  \n  // Build index if needed (sync fallback)\n  if (!INDEX.ready && !INDEX.building) {\n    if (products && products.length > 0) {\n      console.log(' Building index synchronously for first search...');\n      buildSearchIndexSync(products);\n    }\n  }\n  \n  // If still building async, use direct search on products array\n  if (!INDEX.ready) {\n    console.log(' Index not ready, using direct search fallback...');\n    return directSearch(products, queryNorm, limit);\n  }\n  \n  // Get query words and expand\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  \n  console.log(` SEARCH: \"${query}\"  [${expandedQuery.slice(0, 5).join(', ')}${expandedQuery.length > 5 ? '...' : ''}]`);\n  \n  // Find candidates using inverted index\n  const candidateScores = new Map();\n  \n  for (const word of expandedQuery) {\n    const matches = INDEX.wordToProducts.get(word);\n    if (matches) {\n      for (const idx of matches) {\n        candidateScores.set(idx, (candidateScores.get(idx) || 0) + 10);\n      }\n    }\n    \n    // Also check prefix matches for partial typing\n    if (word.length >= 3) {\n      for (const [indexedWord, idxSet] of INDEX.wordToProducts) {\n        if (indexedWord.startsWith(word) && indexedWord !== word) {\n          for (const idx of idxSet) {\n            candidateScores.set(idx, (candidateScores.get(idx) || 0) + 5);\n          }\n        }\n      }\n    }\n  }\n  \n  // Score candidates\n  const scored = [];\n  \n  for (const [idx, baseScore] of candidateScores) {\n    const norm = INDEX.normalized[idx];\n    const product = INDEX.products[idx];\n    if (!norm || !product) continue;\n    \n    let score = baseScore;\n    \n    // === EXACT QUERY MATCH IN NAME (HIGHEST PRIORITY) ===\n    if (norm.nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (norm.nameNorm === queryNorm) {\n        score += 2000; // Perfect match\n      } else if (norm.nameNorm.startsWith(queryNorm)) {\n        score += 500; // Prefix match\n      }\n    }\n    \n    // === WORD MATCHES IN NAME ===\n    let nameWordMatches = 0;\n    for (const word of queryWords) {\n      if (norm.nameNorm.includes(word)) {\n        nameWordMatches++;\n        score += 50;\n      }\n    }\n    \n    // Bonus for ALL query words matching in name\n    if (nameWordMatches === queryWords.length && queryWords.length > 1) {\n      score += 300;\n    }\n    \n    // === CATEGORY MATCH ===\n    if (norm.catNorm.includes(queryNorm)) {\n      score += 100;\n    }\n    for (const word of queryWords) {\n      if (norm.catNorm.includes(word)) {\n        score += 30;\n      }\n    }\n    \n    scored.push({ idx, score, product });\n  }\n  \n  // Sort by score\n  scored.sort((a, b) => b.score - a.score);\n  \n  // Get results\n  const results = scored.slice(0, limit).map(s => s.product);\n  const searchTime = performance.now() - startTime;\n  \n  console.log(` Found ${scored.length} matches in ${searchTime.toFixed(1)}ms`);\n  if (scored.length > 0) {\n    console.log(`   #1: \"${scored[0].product.name}\" (score: ${scored[0].score})`);\n  }\n  \n  const result = {\n    results,\n    totalMatches: scored.length,\n    searchTime\n  };\n  \n  // Cache\n  if (scored.length > 0) {\n    INDEX.cache.set(cacheKey, result);\n    if (INDEX.cache.size > 500) {\n      const firstKey = INDEX.cache.keys().next().value;\n      INDEX.cache.delete(firstKey);\n    }\n  }\n  \n  return result;\n}\n\n// Sync version for first search\nfunction buildSearchIndexSync(products) {\n  if (INDEX.building) return; // Don't interrupt async build\n  \n  INDEX.products = products;\n  INDEX.normalized = [];\n  INDEX.wordToProducts = new Map();\n  \n  const includeDesc = products.length <= 50000;\n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n    \n    const allWords = new Set([\n      ...getWords(nameNorm),\n      ...getWords(catNorm),\n      ...(includeDesc ? getWords(descNorm) : [])\n    ]);\n    const expanded = expandWithSynonyms(Array.from(allWords));\n    \n    INDEX.normalized[i] = { nameNorm, catNorm, price: p.salePrice || p.price || 0 };\n    \n    for (const word of expanded) {\n      if (!INDEX.wordToProducts.has(word)) {\n        INDEX.wordToProducts.set(word, new Set());\n      }\n      INDEX.wordToProducts.get(word).add(i);\n    }\n  }\n  \n  INDEX.ready = true;\n  INDEX.stats = { products: products.length, words: INDEX.wordToProducts.size, buildTime: 0 };\n  console.log(` Sync index built: ${products.length} products`);\n}\n\n// Direct search fallback when index not ready\nfunction directSearch(products, queryNorm, limit) {\n  if (!products || products.length === 0) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  const startTime = performance.now();\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  const scored = [];\n  \n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    \n    let score = 0;\n    \n    // Direct query match in name\n    if (nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (nameNorm.startsWith(queryNorm)) score += 500;\n    }\n    \n    // Word matches\n    for (const word of expandedQuery) {\n      if (nameNorm.includes(word)) score += 50;\n      if (catNorm.includes(word)) score += 20;\n    }\n    \n    if (score > 0) {\n      scored.push({ product: p, score });\n    }\n  }\n  \n  scored.sort((a, b) => b.score - a.score);\n  const results = scored.slice(0, limit).map(s => s.product);\n  const searchTime = performance.now() - startTime;\n  \n  console.log(` Direct search: \"${queryNorm}\"  ${results.length} results in ${searchTime.toFixed(0)}ms`);\n  \n  return { results, totalMatches: scored.length, searchTime };\n}\n\n// ============================================================================\n// AUTOCOMPLETE\n// ============================================================================\n\nexport function getAutocompleteSuggestions(products, query, limit = 10) {\n  if (!query || query.length < 2) return [];\n  \n  const queryNorm = normalize(query);\n  const suggestions = [];\n  const seen = new Set();\n  \n  // Use index if ready\n  const prods = INDEX.ready ? INDEX.products : products;\n  const norms = INDEX.ready ? INDEX.normalized : null;\n  \n  // Find matching products\n  for (let i = 0; i < Math.min(prods.length, 50000); i++) {\n    const product = prods[i];\n    const nameNorm = norms ? norms[i]?.nameNorm : normalize(product.name || '');\n    \n    if (!nameNorm) continue;\n    \n    // Prefix match (highest priority)\n    if (nameNorm.startsWith(queryNorm)) {\n      if (!seen.has(product.name)) {\n        seen.add(product.name);\n        suggestions.push({\n          text: product.name,\n          type: 'product',\n          product,\n          score: 200\n        });\n      }\n    }\n    // Contains match\n    else if (nameNorm.includes(queryNorm)) {\n      if (!seen.has(product.name)) {\n        seen.add(product.name);\n        suggestions.push({\n          text: product.name,\n          type: 'product',\n          product,\n          score: 100\n        });\n      }\n    }\n    \n    if (suggestions.length >= limit * 3) break;\n  }\n  \n  // Add keyword suggestions from synonyms\n  for (const [root, syns] of Object.entries(SYNONYMS)) {\n    if (normalize(root).includes(queryNorm) && !seen.has(root)) {\n      seen.add(root);\n      suggestions.push({ text: root, type: 'keyword', score: 50 });\n    }\n  }\n  \n  // Sort and limit\n  suggestions.sort((a, b) => b.score - a.score);\n  return suggestions.slice(0, limit);\n}\n\n// ============================================================================\n// INTENT PARSING\n// ============================================================================\n\nexport function parseSearchIntent(query) {\n  const queryNorm = normalize(query);\n  const intent = {\n    originalQuery: query,\n    productTypes: [],\n    colors: [],\n    styles: [],\n    materials: [],\n    priceRange: null,\n    keywords: getWords(query)\n  };\n  \n  // Check each synonym category\n  const typeRoots = ['kanape', 'fotel', 'asztal', 'szek', 'agy', 'szekreny', 'polc', 'komod'];\n  const colorRoots = ['feher', 'fekete', 'szurke', 'barna', 'bezs', 'kek', 'zold', 'piros', 'sarga'];\n  const styleRoots = ['modern', 'skandinav', 'rusztikus', 'indusztrialis', 'klasszikus', 'retro'];\n  const materialRoots = ['fa', 'fem', 'bor', 'szovet', 'barsony', 'uveg'];\n  \n  for (const word of getWords(queryNorm)) {\n    const root = WORD_TO_ROOT.get(word) || word;\n    \n    if (typeRoots.includes(root)) intent.productTypes.push(root);\n    if (colorRoots.includes(root)) intent.colors.push(root);\n    if (styleRoots.includes(root)) intent.styles.push(root);\n    if (materialRoots.includes(root)) intent.materials.push(root);\n  }\n  \n  // Price detection\n  const priceMatch = query.match(/(\\d+)\\s*(ezer|e|k)?\\s*(ft|forint)?\\s*(alatt|ig|felett)?/i);\n  if (priceMatch) {\n    let value = parseInt(priceMatch[1]);\n    if (priceMatch[2]) value *= 1000;\n    \n    if (query.includes('alatt') || query.includes('ig')) {\n      intent.priceRange = { min: 0, max: value };\n    } else if (query.includes('felett')) {\n      intent.priceRange = { min: value, max: Infinity };\n    }\n  }\n  \n  if (queryNorm.includes('olcso') || queryNorm.includes('akcio')) {\n    intent.priceRange = intent.priceRange || { min: 0, max: 100000 };\n  }\n  \n  return intent;\n}\n\n// ============================================================================\n// PROACTIVE SUGGESTIONS\n// ============================================================================\n\nexport function getProactiveSuggestions() {\n  return [\n    { icon: '', text: 'kanap', query: 'kanap' },\n    { icon: '', text: 'fotel', query: 'fotel' },\n    { icon: '', text: 'szk', query: 'szk' },\n    { icon: '', text: 'gy', query: 'gy' },\n    { icon: '', text: 'szekrny', query: 'szekrny' },\n    { icon: '', text: 'akcis', query: 'akcis' },\n  ];\n}\n\nexport default {\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats,\n  smartSearch,\n  getAutocompleteSuggestions,\n  parseSearchIntent,\n  getProactiveSuggestions\n};\n","/**\n * User Preferences Service\n * Kzponti szolgltats a felhasznli viselkeds s preferencik kvetsre\n * localStorage-ban trolja az adatokat\n */\n\nconst STORAGE_KEYS = {\n  VIEWED_PRODUCTS: 'mkt_viewed_products',\n  LIKED_PRODUCTS: 'mkt_liked_products',\n  DISLIKED_PRODUCTS: 'mkt_disliked_products',\n  SEARCH_HISTORY: 'mkt_search_history',\n  STYLE_DNA: 'mkt_style_dna',\n  AI_FEEDBACK: 'mkt_ai_feedback',\n  CHAT_CONTEXT: 'mkt_chat_context',\n  USER_PREFERENCES: 'mkt_user_preferences',\n  RECO_TWEAKS: 'mkt_reco_tweaks',\n  RECO_WEIGHTS: 'mkt_reco_weights',\n  RECO_SIGNALS: 'mkt_reco_signals',\n  AB_TESTS: 'mkt_ab_tests',\n  BACK_IN_STOCK: 'mkt_back_in_stock',\n  SECTION_EVENTS: 'mkt_section_events',\n};\n\nconst MAX_ITEMS = {\n  VIEWED: 50,\n  LIKED: 100,\n  SEARCHES: 20,\n  FEEDBACK: 100,\n};\n\nconst MAX_BACK_IN_STOCK = 100;\n\nconst DEFAULT_RECO_TWEAKS = {\n  avoidStyles: [],\n  avoidRooms: [],\n};\n\nconst DEFAULT_RECO_WEIGHTS = {\n  likeBoost: 20,\n  viewPenalty: 8,\n  dislikePenalty: 50,\n  categoryBoost: 20,\n  styleBoost: 12,\n  roomBoost: 10,\n  stockBoost: 6,\n  priceFit: 8,\n  signalCategoryBoost: 4,\n  signalKeywordBoost: 2,\n};\n\nconst getJSONSafe = (key, fallback) => {\n  try {\n    const raw = localStorage.getItem(key);\n    return raw ? JSON.parse(raw) : fallback;\n  } catch {\n    return fallback;\n  }\n};\n\n// ==================== VIEWED PRODUCTS ====================\n\n/**\n * Termk megtekintsnek rgztse\n */\nexport function trackProductView(product) {\n  if (!product?.id) return;\n  \n  const viewed = getViewedProducts();\n  \n  // Eltvoltjuk ha mr volt, s az elejre tesszk\n  const filtered = viewed.filter(p => p.id !== product.id);\n  \n  const productData = {\n    id: product.id,\n    name: product.name,\n    price: product.salePrice || product.price,\n    category: product.category,\n    image: product.images?.[0] || product.image,\n    viewedAt: Date.now(),\n  };\n  \n  const updated = [productData, ...filtered].slice(0, MAX_ITEMS.VIEWED);\n  \n  try {\n    localStorage.setItem(STORAGE_KEYS.VIEWED_PRODUCTS, JSON.stringify(updated));\n  } catch (e) {\n    console.warn('Failed to save viewed products:', e);\n  }\n  \n  // Preferencik frisstse a kategria alapjn\n  updateCategoryPreference(product.category);\n}\n\n/**\n * Megtekintett termkek lekrdezse\n */\nexport function getViewedProducts(limit = 20) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.VIEWED_PRODUCTS);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * Legutbbi megtekintett termk ID-k\n */\nexport function getRecentlyViewedIds(limit = 10) {\n  return getViewedProducts(limit).map(p => p.id);\n}\n\n// ==================== LIKED/DISLIKED PRODUCTS ====================\n\n/**\n * Termk kedvelse\n */\nexport function likeProduct(productId) {\n  if (!productId) return;\n  \n  const liked = getLikedProducts();\n  if (!liked.includes(productId)) {\n    const updated = [productId, ...liked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a disliked-bl\n  const disliked = getDislikedProducts();\n  if (disliked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.DISLIKED_PRODUCTS, \n      JSON.stringify(disliked.filter(id => id !== productId))\n    );\n  }\n}\n\n/**\n * Termk elutastsa\n */\nexport function dislikeProduct(productId) {\n  if (!productId) return;\n  \n  const disliked = getDislikedProducts();\n  if (!disliked.includes(productId)) {\n    const updated = [productId, ...disliked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a liked-bl\n  const liked = getLikedProducts();\n  if (liked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.LIKED_PRODUCTS, \n      JSON.stringify(liked.filter(id => id !== productId))\n    );\n  }\n}\n\nconst SIGNAL_LIMITS = { min: -6, max: 12 };\n\nconst stopWords = new Set([\n  's', 'vagy', 'hogy', 'egy', 'egyik', 'mely', 'ami', 'az', 'a', 'de', 'is',\n  'val', 'valamint', 's', 's', 'the', 'for', 'with'\n]);\n\nconst clampSignal = (value) => Math.max(SIGNAL_LIMITS.min, Math.min(SIGNAL_LIMITS.max, value));\n\nconst extractSignalTokens = (product) => {\n  const categories = String(product?.category || '')\n    .split('>')\n    .map((c) => c.trim().toLowerCase())\n    .filter(Boolean);\n  const text = `${product?.name || ''} ${product?.category || ''}`.toLowerCase();\n  const keywords = text\n    .split(/[\\s,\\-\\/]+/)\n    .map((w) => w.trim())\n    .filter((w) => w.length > 3 && !stopWords.has(w))\n    .slice(0, 12);\n  return { categories, keywords };\n};\n\nexport function getPreferenceSignals() {\n  return getJSONSafe(STORAGE_KEYS.RECO_SIGNALS, { categories: {}, keywords: {} });\n}\n\nconst savePreferenceSignals = (signals) => {\n  try {\n    localStorage.setItem(STORAGE_KEYS.RECO_SIGNALS, JSON.stringify(signals));\n  } catch {}\n};\n\nconst updatePreferenceSignals = (product, delta) => {\n  if (!product?.id) return;\n  const signals = getPreferenceSignals();\n  const { categories, keywords } = extractSignalTokens(product);\n  categories.forEach((cat) => {\n    const next = clampSignal((signals.categories?.[cat] || 0) + delta);\n    signals.categories = signals.categories || {};\n    signals.categories[cat] = next;\n  });\n  keywords.forEach((kw) => {\n    const next = clampSignal((signals.keywords?.[kw] || 0) + delta);\n    signals.keywords = signals.keywords || {};\n    signals.keywords[kw] = next;\n  });\n  savePreferenceSignals(signals);\n};\n\nexport function likeProductWithSignals(product) {\n  if (!product?.id) return;\n  likeProduct(product.id);\n  updatePreferenceSignals(product, 2);\n}\n\nexport function dislikeProductWithSignals(product) {\n  if (!product?.id) return;\n  dislikeProduct(product.id);\n  updatePreferenceSignals(product, -3);\n}\n\nexport function toggleLikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n    return { liked: false, disliked: false };\n  }\n\n  const nextLiked = [product.id, ...liked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(nextLiked));\n  updatePreferenceSignals(product, 2);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n  }\n  return { liked: true, disliked: false };\n}\n\nexport function toggleDislikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n    return { liked: false, disliked: false };\n  }\n\n  const nextDisliked = [product.id, ...disliked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(nextDisliked));\n  updatePreferenceSignals(product, -3);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n  }\n  return { liked: false, disliked: true };\n}\n\nexport function getLikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function getDislikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.DISLIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function isProductLiked(productId) {\n  return getLikedProducts().includes(productId);\n}\n\nexport function isProductDisliked(productId) {\n  return getDislikedProducts().includes(productId);\n}\n\n// ==================== BACK IN STOCK REQUESTS ====================\n\nexport function requestBackInStock(product) {\n  if (!product?.id) return;\n  const list = getBackInStockRequests();\n  const filtered = list.filter((p) => p.id !== product.id);\n  const next = [\n    {\n      id: product.id,\n      name: product.name,\n      image: product.images?.[0] || product.image,\n      requestedAt: Date.now()\n    },\n    ...filtered\n  ].slice(0, MAX_BACK_IN_STOCK);\n  try {\n    localStorage.setItem(STORAGE_KEYS.BACK_IN_STOCK, JSON.stringify(next));\n  } catch (e) {\n    console.warn('Failed to save back-in-stock request:', e);\n  }\n}\n\nexport function getBackInStockRequests(limit = 50) {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEYS.BACK_IN_STOCK);\n    const list = raw ? JSON.parse(raw) : [];\n    return limit ? list.slice(0, limit) : list;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== SECTION EVENTS (CTR) ====================\n\nexport function trackSectionEvent(sectionId, type = 'impression', productId = null) {\n  if (!sectionId) return;\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  const entry = data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n  if (type === 'click') entry.clicks += 1;\n  else entry.impressions += 1;\n  entry.lastEventAt = Date.now();\n  if (productId) {\n    entry.products[productId] = (entry.products[productId] || 0) + 1;\n  }\n  data[sectionId] = entry;\n  try {\n    localStorage.setItem(STORAGE_KEYS.SECTION_EVENTS, JSON.stringify(data));\n  } catch {}\n}\n\nexport function getSectionStats(sectionId) {\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  return data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n}\n\n// ==================== SEARCH HISTORY ====================\n\n/**\n * Keress rgztse\n */\nexport function trackSearch(query) {\n  if (!query || query.length < 2) return;\n  \n  const searches = getSearchHistory();\n  const filtered = searches.filter(s => s.query.toLowerCase() !== query.toLowerCase());\n  \n  const updated = [\n    { query, timestamp: Date.now() },\n    ...filtered\n  ].slice(0, MAX_ITEMS.SEARCHES);\n  \n  localStorage.setItem(STORAGE_KEYS.SEARCH_HISTORY, JSON.stringify(updated));\n}\n\nexport function getSearchHistory(limit = 10) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.SEARCH_HISTORY);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n// ==================== STYLE DNA (Quiz Results) ====================\n\n/**\n * Style DNA mentse a quiz eredmnybl\n */\nexport function saveStyleDNA(quizAnswers, styleDNAText) {\n  const data = {\n    answers: quizAnswers,\n    styleDNA: styleDNAText,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.STYLE_DNA, JSON.stringify(data));\n}\n\nexport function getStyleDNA() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.STYLE_DNA);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== AI FEEDBACK ====================\n\n/**\n * AI vlasz visszajelzsnek rgztse\n */\nexport function trackAIFeedback(messageId, isPositive, context = {}) {\n  const feedback = getAIFeedback();\n  \n  const updated = [\n    {\n      messageId,\n      isPositive,\n      context,\n      timestamp: Date.now(),\n    },\n    ...feedback\n  ].slice(0, MAX_ITEMS.FEEDBACK);\n  \n  localStorage.setItem(STORAGE_KEYS.AI_FEEDBACK, JSON.stringify(updated));\n}\n\nexport function getAIFeedback() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.AI_FEEDBACK);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * AI feedback statisztikk\n */\nexport function getAIFeedbackStats() {\n  const feedback = getAIFeedback();\n  const positive = feedback.filter(f => f.isPositive).length;\n  const negative = feedback.filter(f => !f.isPositive).length;\n  \n  return {\n    total: feedback.length,\n    positive,\n    negative,\n    satisfactionRate: feedback.length > 0 ? (positive / feedback.length * 100).toFixed(1) : 0,\n  };\n}\n\n// ==================== CHAT CONTEXT ====================\n\n/**\n * Chat kontextus mentse (elz beszlgetsek sszefoglalja)\n */\nexport function saveChatContext(summary) {\n  const context = {\n    summary,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.CHAT_CONTEXT, JSON.stringify(context));\n}\n\nexport function getChatContext() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.CHAT_CONTEXT);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== USER PREFERENCES ====================\n\n/**\n * Kategria preferencia frisstse\n */\nfunction updateCategoryPreference(category) {\n  if (!category) return;\n  \n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  categories[category] = (categories[category] || 0) + 1;\n  \n  prefs.categoryInterests = categories;\n  prefs.lastUpdated = Date.now();\n  \n  localStorage.setItem(STORAGE_KEYS.USER_PREFERENCES, JSON.stringify(prefs));\n}\n\nexport function getUserPreferences() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.USER_PREFERENCES);\n    return data ? JSON.parse(data) : { categoryInterests: {} };\n  } catch (e) {\n    return { categoryInterests: {} };\n  }\n}\n\nexport function getRecommendationTweaks() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_TWEAKS, DEFAULT_RECO_TWEAKS);\n  return { ...DEFAULT_RECO_TWEAKS, ...data };\n}\n\nexport function setRecommendationTweaks(next) {\n  const current = getRecommendationTweaks();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function resetRecommendationTweaks() {\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(DEFAULT_RECO_TWEAKS));\n  return DEFAULT_RECO_TWEAKS;\n}\n\nexport function getRecommendationWeights() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_WEIGHTS, DEFAULT_RECO_WEIGHTS);\n  return { ...DEFAULT_RECO_WEIGHTS, ...data };\n}\n\nexport function setRecommendationWeights(next) {\n  const current = getRecommendationWeights();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_WEIGHTS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function getABVariant(testId) {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (tests[testId]?.variant) return tests[testId].variant;\n  const variant = Math.random() < 0.5 ? 'A' : 'B';\n  tests[testId] = { variant, impressions: 0, clicks: 0 };\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return variant;\n}\n\nexport function trackABEvent(testId, type = 'impression') {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (!tests[testId]) {\n    tests[testId] = { variant: getABVariant(testId), impressions: 0, clicks: 0 };\n  }\n  if (type === 'click') tests[testId].clicks += 1;\n  else tests[testId].impressions += 1;\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return tests[testId];\n}\n\n/**\n * Top kategrik a felhasznli rdeklds alapjn\n */\nexport function getTopCategories(limit = 5) {\n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  return Object.entries(categories)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, limit)\n    .map(([name]) => name);\n}\n\n// ==================== PERSONALIZED CONTEXT FOR AI ====================\n\n/**\n * Szemlyre szabott kontextus generlsa az AI szmra\n */\nexport function getPersonalizedContext() {\n  const viewedProducts = getViewedProducts(5);\n  const likedProducts = getLikedProducts();\n  const topCategories = getTopCategories(3);\n  const styleDNA = getStyleDNA();\n  const searchHistory = getSearchHistory(5);\n  \n  let context = '';\n  \n  if (styleDNA?.styleDNA) {\n    context += `A felhasznl stlus profilja: ${styleDNA.styleDNA}\\n`;\n  }\n  \n  if (topCategories.length > 0) {\n    context += `Kedvelt kategrik: ${topCategories.join(', ')}\\n`;\n  }\n  \n  if (viewedProducts.length > 0) {\n    context += `Nemrg nzett termkek: ${viewedProducts.map(p => p.name).join(', ')}\\n`;\n  }\n  \n  if (searchHistory.length > 0) {\n    context += `Korbbi keressek: ${searchHistory.map(s => s.query).join(', ')}\\n`;\n  }\n  \n  if (likedProducts.length > 0) {\n    context += `Kedvelt termkek szma: ${likedProducts.length}\\n`;\n  }\n  \n  return context || 'j felhasznl, nincs elzmny.';\n}\n\n/**\n * Szemlyre szabott termk ajnlsok\n * Figyelembe veszi: megtekintett, kedvelt, kategria preferencik\n */\nexport function getPersonalizedRecommendations(allProducts, limit = 12) {\n  if (!allProducts || allProducts.length === 0) return [];\n  \n  const viewedIds = getRecentlyViewedIds();\n  const likedIds = getLikedProducts();\n  const dislikedIds = getDislikedProducts();\n  const signals = getPreferenceSignals();\n  const topCategories = getTopCategories(5);\n  const styleDNA = getStyleDNA();\n  const tweaks = getRecommendationTweaks();\n  const weights = getRecommendationWeights();\n  const viewedProducts = getViewedProducts(20);\n  const avgPriceBase = viewedProducts.length > 0 ? viewedProducts : [];\n  const avgPrice = avgPriceBase.length > 0\n    ? avgPriceBase.reduce((sum, p) => sum + (p.price || 0), 0) / avgPriceBase.length\n    : null;\n  \n  // Pontozzuk a termkeket\n  const scored = allProducts.map(product => {\n    let score = 0;\n    const price = product.salePrice || product.price || 0;\n    \n    // Ne ajnljunk olyat, amit mr nzett vagy nem kedvelt\n    if (viewedIds.includes(product.id)) score -= weights.viewPenalty;\n    if (dislikedIds.includes(product.id)) score -= weights.dislikePenalty;\n    if (likedIds.includes(product.id)) score += weights.likeBoost;\n    \n    // Kategria preferencia\n    const productCategory = product.category || '';\n    topCategories.forEach((cat, index) => {\n      if (productCategory.toLowerCase().includes(cat.toLowerCase())) {\n        score += (5 - index) * weights.categoryBoost * 0.2;\n      }\n    });\n\n    const categoryParts = productCategory\n      .split('>')\n      .map((c) => c.trim().toLowerCase())\n      .filter(Boolean);\n    categoryParts.forEach((cat) => {\n      const signal = signals.categories?.[cat];\n      if (signal) score += signal * weights.signalCategoryBoost;\n    });\n\n    const text = `${product.name || ''} ${product.category || ''}`.toLowerCase();\n    const words = text\n      .split(/[\\s,\\-\\/]+/)\n      .map((w) => w.trim())\n      .filter((w) => w.length > 3 && !stopWords.has(w))\n      .slice(0, 12);\n    words.forEach((kw) => {\n      const signal = signals.keywords?.[kw];\n      if (signal) score += signal * weights.signalKeywordBoost;\n    });\n    \n    // Style DNA alap pontozs\n    if (styleDNA?.answers) {\n      const { space, colors, budget, priority, room } = styleDNA.answers;\n      const productText = `${product.name} ${product.category} ${product.description || ''}`.toLowerCase();\n      \n      // Stlus\n      const styleKeywords = {\n        modern: ['modern', 'minimalista', 'letisztult'],\n        scandinavian: ['skandinv', 'natr', 'vilgos', 'fehr'],\n        industrial: ['indusztrilis', 'loft', 'fm', 'ipari'],\n        vintage: ['vintage', 'retro', 'antik'],\n        bohemian: ['bohm', 'sznes', 'mints'],\n      };\n      \n      if (space && styleKeywords[space]) {\n        styleKeywords[space].forEach(kw => {\n          if (productText.includes(kw)) score += weights.styleBoost;\n        });\n        if (tweaks.avoidStyles?.includes(space)) score -= weights.styleBoost * 2;\n      }\n      \n    // Budget\n      if (budget === 'budget' && price < 100000) score += weights.priceFit;\n      if (budget === 'mid' && price >= 100000 && price <= 300000) score += weights.priceFit;\n      if (budget === 'premium' && price > 300000) score += weights.priceFit;\n      \n      // Szoba tpus\n      const roomKeywords = {\n        living: ['kanap', 'fotel', 'dohnyz', 'tv', 'nappali'],\n        bedroom: ['gy', 'matrac', 'jjeli', 'hlszoba'],\n        dining: ['tkez', 'asztal', 'szk'],\n        office: ['rasztal', 'iroda', 'forgszk'],\n      };\n      \n      if (room && roomKeywords[room]) {\n        roomKeywords[room].forEach(kw => {\n          if (productText.includes(kw)) score += weights.roomBoost;\n        });\n        if (tweaks.avoidRooms?.includes(room)) score -= weights.roomBoost * 2;\n      }\n    }\n\n    if (avgPrice && price > 0) {\n      const diff = Math.abs(price - avgPrice) / avgPrice;\n      score += Math.max(0, (1 - Math.min(diff, 1))) * weights.priceFit;\n    }\n\n    const stockQty = product.stock_qty ?? product.stockQty;\n    if (typeof stockQty === 'number') {\n      score += Math.min(20, stockQty) * (weights.stockBoost / 20);\n      if (stockQty === 0) score -= weights.stockBoost;\n    }\n    \n    // Kis random faktor a vltozatossgrt\n    score += Math.random() * 5;\n    \n    return { product, score };\n  });\n  \n  // Top termkek visszaadsa\n  return scored\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n/**\n * Hasonl termkek keresse\n */\nexport function getSimilarProducts(product, allProducts, limit = 8) {\n  if (!product || !allProducts) return [];\n  \n  const dislikedIds = getDislikedProducts();\n  \n  const productName = (product.name || '').toLowerCase();\n  const productCategory = (product.category || '').toLowerCase();\n  const productPrice = product.salePrice || product.price || 0;\n  \n  // Kulcsszavak kinyerse a nvbl\n  const keywords = productName\n    .split(/[\\s,\\-\\/]+/)\n    .filter(w => w.length > 3)\n    .slice(0, 5);\n  \n  const scored = allProducts\n    .filter(p => p.id !== product.id && !dislikedIds.includes(p.id))\n    .map(p => {\n      let score = 0;\n      const pName = (p.name || '').toLowerCase();\n      const pCategory = (p.category || '').toLowerCase();\n      const pPrice = p.salePrice || p.price || 0;\n      \n      // Ugyanaz a kategria\n      if (pCategory && productCategory && pCategory.includes(productCategory.split(' > ')[0])) {\n        score += 30;\n      }\n      \n      // Hasonl r (30%)\n      if (pPrice > 0 && productPrice > 0) {\n        const priceDiff = Math.abs(pPrice - productPrice) / productPrice;\n        if (priceDiff < 0.3) score += 20;\n        else if (priceDiff < 0.5) score += 10;\n      }\n      \n      // Kulcssz egyezs\n      keywords.forEach(kw => {\n        if (pName.includes(kw)) score += 5;\n      });\n      \n      return { product: p, score };\n    });\n  \n  return scored\n    .filter(s => s.score > 0)\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n// ==================== CLEAR DATA ====================\n\nexport function clearAllData() {\n  Object.values(STORAGE_KEYS).forEach(key => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport default {\n  trackProductView,\n  getViewedProducts,\n  getRecentlyViewedIds,\n  likeProduct,\n  dislikeProduct,\n  getLikedProducts,\n  getDislikedProducts,\n  isProductLiked,\n  trackSearch,\n  getSearchHistory,\n  saveStyleDNA,\n  getStyleDNA,\n  trackAIFeedback,\n  getAIFeedback,\n  getAIFeedbackStats,\n  saveChatContext,\n  getChatContext,\n  getUserPreferences,\n  getTopCategories,\n  getPersonalizedContext,\n  getPersonalizedRecommendations,\n  getSimilarProducts,\n  requestBackInStock,\n  getBackInStockRequests,\n  trackSectionEvent,\n  getSectionStats,\n  clearAllData,\n};\n","/**\n * Gemini AI Service - Frontend service for AI calls\n * All calls go through our backend proxy for security\n * The API key is stored on the server, NOT in the frontend\n */\n\n// Backend API URL - automatically detects if we're on the Railway server or localhost\nconst API_BASE = window.MARKETLY_CONFIG?.apiBase || \n  (window.location.hostname === 'localhost' \n    ? 'http://localhost:3001/api' \n    : 'https://marketly-ai-butorbolt-production.up.railway.app/api');\n\n/**\n * Generate text response from AI\n * @param {string} prompt - The prompt to send to AI\n * @param {object} options - Optional settings (temperature, maxTokens)\n * @returns {Promise<{success: boolean, text?: string, error?: string}>}\n */\nexport async function generateText(prompt, options = {}) {\n  const { temperature = 0.7, maxTokens = 500 } = options;\n  \n  console.log('[AI Service] Sending text generation request...');\n  \n  try {\n    const response = await fetch(`${API_BASE}/ai/generate`, {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        prompt,\n        temperature,\n        maxTokens,\n      }),\n    });\n\n    const data = await response.json();\n    \n    if (!response.ok || !data.success) {\n      console.error('[AI Service] Error:', data.error);\n      return { \n        success: false, \n        error: data.error || `HTTP ${response.status}` \n      };\n    }\n\n    console.log('[AI Service] Success, response received');\n    return { success: true, text: data.text };\n\n  } catch (error) {\n    console.error('[AI Service] Network error:', error);\n    return { \n      success: false, \n      error: `Network error: ${error.message}` \n    };\n  }\n}\n\n/**\n * Analyze image with AI\n * @param {string} base64Image - Base64 encoded image (without data URL prefix)\n * @param {string} mimeType - Image MIME type (e.g., 'image/jpeg')\n * @param {string} prompt - The analysis prompt\n * @returns {Promise<{success: boolean, text?: string, error?: string}>}\n */\nexport async function analyzeImage(base64Image, mimeType, prompt) {\n  console.log('[AI Service] Sending image analysis request...');\n  \n  try {\n    const response = await fetch(`${API_BASE}/ai/analyze-image`, {\n      method: 'POST',\n      headers: { \n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        imageBase64: base64Image,\n        mimeType,\n        prompt,\n      }),\n    });\n\n    const data = await response.json();\n    \n    if (!response.ok || !data.success) {\n      console.error('[AI Service] Error:', data.error);\n      return { \n        success: false, \n        error: data.error || `HTTP ${response.status}` \n      };\n    }\n\n    console.log('[AI Service] Image analysis success');\n    return { success: true, text: data.text };\n\n  } catch (error) {\n    console.error('[AI Service] Network error:', error);\n    return { \n      success: false, \n      error: `Network error: ${error.message}` \n    };\n  }\n}\n\n/**\n * Test AI connection\n * @returns {Promise<{success: boolean, message?: string, error?: string}>}\n */\nexport async function testConnection() {\n  console.log('[AI Service] Testing connection...');\n  \n  try {\n    const response = await fetch(`${API_BASE}/ai/health`);\n    const data = await response.json();\n    \n    if (data.success) {\n      console.log('[AI Service] Connection OK:', data.message);\n      return { success: true, message: data.message };\n    } else {\n      console.error('[AI Service] Connection failed:', data.error);\n      return { success: false, error: data.error };\n    }\n\n  } catch (error) {\n    console.error('[AI Service] Connection test failed:', error);\n    return { \n      success: false, \n      error: `Cannot reach server: ${error.message}` \n    };\n  }\n}\n\nexport default {\n  generateText,\n  analyzeImage,\n  testConnection,\n};\n","import React from 'react';\n\n/**\n * Modern Skeleton Loading Components\n * Shimmer effect with smooth animations\n */\n\n// Base skeleton with shimmer\nexport const Skeleton = ({ className = '', variant = 'rectangular' }) => {\n  const baseClasses = 'animate-pulse bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%] animate-shimmer';\n  \n  const variants = {\n    rectangular: 'rounded-lg',\n    circular: 'rounded-full',\n    text: 'rounded h-4',\n    rounded: 'rounded-xl'\n  };\n\n  return (\n    <div className={`${baseClasses} ${variants[variant]} ${className}`} />\n  );\n};\n\n// Product Card Skeleton\nexport const ProductCardSkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl overflow-hidden shadow-sm border border-gray-100 h-full\">\n    {/* Image placeholder */}\n    <div className=\"aspect-square relative overflow-hidden bg-gray-100\">\n      <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 animate-shimmer bg-[length:200%_100%]\" />\n      {/* Fake badge */}\n      <div className=\"absolute top-3 left-3\">\n        <Skeleton className=\"w-12 h-5 rounded-full\" />\n      </div>\n      {/* Fake wishlist button */}\n      <div className=\"absolute top-3 right-3\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n    \n    {/* Content */}\n    <div className=\"p-3 sm:p-4 lg:p-5 space-y-3\">\n      {/* Category */}\n      <Skeleton className=\"w-16 h-3\" />\n      \n      {/* Title - 2 lines */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"w-full h-4\" />\n        <Skeleton className=\"w-3/4 h-4\" />\n      </div>\n      \n      {/* Price section */}\n      <div className=\"pt-3 border-t border-gray-100 flex justify-between items-center\">\n        <div className=\"space-y-1\">\n          <Skeleton className=\"w-12 h-3\" />\n          <Skeleton className=\"w-20 h-6\" />\n        </div>\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Grid of Product Skeletons\nexport const ProductGridSkeleton = ({ count = 8 }) => (\n  <div className=\"product-grid\">\n    {Array.from({ length: count }).map((_, i) => (\n      <ProductCardSkeleton key={i} />\n    ))}\n  </div>\n);\n\n// Category Pills Skeleton\nexport const CategorySkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-100 mb-4 sm:mb-6 p-4\">\n    {/* Header */}\n    <div className=\"flex items-center justify-between mb-4\">\n      <div className=\"flex items-center gap-3\">\n        <Skeleton variant=\"rounded\" className=\"w-10 h-10\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"w-24 h-5\" />\n          <Skeleton className=\"w-16 h-3 hidden sm:block\" />\n        </div>\n      </div>\n      <div className=\"space-y-1 text-right\">\n        <Skeleton className=\"w-20 h-5\" />\n        <Skeleton className=\"w-16 h-3\" />\n      </div>\n    </div>\n    \n    {/* Pills */}\n    <div className=\"flex flex-wrap gap-2\">\n      {Array.from({ length: 8 }).map((_, i) => (\n        <Skeleton \n          key={i} \n          variant=\"rounded\" \n          className=\"h-10\"\n          style={{ width: `${60 + Math.random() * 40}px` }}\n        />\n      ))}\n    </div>\n  </div>\n);\n\n// Search Bar Skeleton\nexport const SearchSkeleton = () => (\n  <div className=\"relative\">\n    <Skeleton variant=\"rounded\" className=\"w-full h-12\" />\n  </div>\n);\n\n// Hero Section Skeleton\nexport const HeroSkeleton = () => (\n  <div className=\"min-h-[60vh] flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 p-8\">\n    <div className=\"text-center space-y-6 max-w-2xl\">\n      <Skeleton className=\"w-40 h-8 mx-auto rounded-full\" />\n      <div className=\"space-y-3\">\n        <Skeleton className=\"w-full h-12 mx-auto\" />\n        <Skeleton className=\"w-3/4 h-12 mx-auto\" />\n      </div>\n      <Skeleton className=\"w-2/3 h-6 mx-auto\" />\n      <div className=\"flex gap-4 justify-center pt-4\">\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Inline Content Skeleton (for text areas)\nexport const TextSkeleton = ({ lines = 3, className = '' }) => (\n  <div className={`space-y-2 ${className}`}>\n    {Array.from({ length: lines }).map((_, i) => (\n      <Skeleton \n        key={i} \n        variant=\"text\" \n        className={i === lines - 1 ? 'w-2/3' : 'w-full'}\n      />\n    ))}\n  </div>\n);\n\n// Stats Card Skeleton\nexport const StatsSkeleton = () => (\n  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n    {Array.from({ length: 4 }).map((_, i) => (\n      <div key={i} className=\"bg-white rounded-2xl p-6 text-center\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10 mx-auto mb-3\" />\n        <Skeleton className=\"w-16 h-8 mx-auto mb-2\" />\n        <Skeleton className=\"w-20 h-4 mx-auto\" />\n      </div>\n    ))}\n  </div>\n);\n\nexport default {\n  Skeleton,\n  ProductCardSkeleton,\n  ProductGridSkeleton,\n  CategorySkeleton,\n  SearchSkeleton,\n  HeroSkeleton,\n  TextSkeleton,\n  StatsSkeleton\n};\n","import React, { useState, useEffect, createContext, useContext, useCallback } from 'react';\nimport { \n  CheckCircle2, XCircle, AlertCircle, Info, X, \n  ShoppingCart, Heart, Sparkles, Bell, Truck\n} from 'lucide-react';\n\n/**\n * Modern Toast Notification System\n * Beautiful, accessible notifications with icons and animations\n */\n\n// Toast Context\nconst ToastContext = createContext(null);\n\n// Toast Types with icons and colors\nconst TOAST_TYPES = {\n  success: {\n    icon: CheckCircle2,\n    bg: 'bg-emerald-50 border-emerald-200',\n    iconBg: 'bg-emerald-100',\n    iconColor: 'text-emerald-600',\n    title: 'text-emerald-900',\n    message: 'text-emerald-700',\n    progress: 'bg-emerald-500'\n  },\n  error: {\n    icon: XCircle,\n    bg: 'bg-red-50 border-red-200',\n    iconBg: 'bg-red-100',\n    iconColor: 'text-red-600',\n    title: 'text-red-900',\n    message: 'text-red-700',\n    progress: 'bg-red-500'\n  },\n  warning: {\n    icon: AlertCircle,\n    bg: 'bg-amber-50 border-amber-200',\n    iconBg: 'bg-amber-100',\n    iconColor: 'text-amber-600',\n    title: 'text-amber-900',\n    message: 'text-amber-700',\n    progress: 'bg-amber-500'\n  },\n  info: {\n    icon: Info,\n    bg: 'bg-blue-50 border-blue-200',\n    iconBg: 'bg-blue-100',\n    iconColor: 'text-blue-600',\n    title: 'text-blue-900',\n    message: 'text-blue-700',\n    progress: 'bg-blue-500'\n  },\n  cart: {\n    icon: ShoppingCart,\n    bg: 'bg-primary-50 border-primary-200',\n    iconBg: 'bg-primary-100',\n    iconColor: 'text-primary-500',\n    title: 'text-primary-700',\n    message: 'text-primary-600',\n    progress: 'bg-primary-500'\n  },\n  wishlist: {\n    icon: Heart,\n    bg: 'bg-pink-50 border-pink-200',\n    iconBg: 'bg-pink-100',\n    iconColor: 'text-pink-600',\n    title: 'text-pink-900',\n    message: 'text-pink-700',\n    progress: 'bg-pink-500'\n  },\n  ai: {\n    icon: Sparkles,\n    bg: 'bg-secondary-50 border-secondary-200',\n    iconBg: 'bg-secondary-100',\n    iconColor: 'text-secondary-700',\n    title: 'text-secondary-800',\n    message: 'text-secondary-700',\n    progress: 'bg-secondary-600'\n  },\n  notification: {\n    icon: Bell,\n    bg: 'bg-gray-50 border-gray-200',\n    iconBg: 'bg-gray-100',\n    iconColor: 'text-gray-600',\n    title: 'text-gray-900',\n    message: 'text-gray-700',\n    progress: 'bg-gray-500'\n  },\n  shipping: {\n    icon: Truck,\n    bg: 'bg-teal-50 border-teal-200',\n    iconBg: 'bg-teal-100',\n    iconColor: 'text-teal-600',\n    title: 'text-teal-900',\n    message: 'text-teal-700',\n    progress: 'bg-teal-500'\n  }\n};\n\n// Single Toast Component\nconst Toast = ({ id, type = 'info', title, message, duration = 4000, onClose, action }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isLeaving, setIsLeaving] = useState(false);\n  const config = TOAST_TYPES[type] || TOAST_TYPES.info;\n  const Icon = config.icon;\n\n  useEffect(() => {\n    // Animate in\n    requestAnimationFrame(() => setIsVisible(true));\n    \n    // Auto dismiss\n    if (duration > 0) {\n      const timer = setTimeout(() => handleClose(), duration);\n      return () => clearTimeout(timer);\n    }\n  }, [duration]);\n\n  const handleClose = () => {\n    setIsLeaving(true);\n    setTimeout(() => onClose?.(id), 300);\n  };\n\n  return (\n    <div\n      className={`\n        relative w-full max-w-sm overflow-hidden\n        ${config.bg} border rounded-xl shadow-lg\n        transform transition-all duration-300 ease-out\n        ${isVisible && !isLeaving ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\n      `}\n      role=\"alert\"\n    >\n      <div className=\"p-4 flex items-start gap-3\">\n        {/* Icon */}\n        <div className={`${config.iconBg} rounded-lg p-2 shrink-0`}>\n          <Icon className={`w-5 h-5 ${config.iconColor}`} />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          {title && (\n            <h4 className={`font-semibold text-sm ${config.title}`}>{title}</h4>\n          )}\n          {message && (\n            <p className={`text-sm mt-0.5 ${config.message}`}>{message}</p>\n          )}\n          {action && (\n            <button\n              onClick={() => { action.onClick?.(); handleClose(); }}\n              className={`mt-2 text-sm font-semibold ${config.iconColor} hover:underline`}\n            >\n              {action.label}\n            </button>\n          )}\n        </div>\n\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-4 h-4 text-gray-400\" />\n        </button>\n      </div>\n\n      {/* Progress bar */}\n      {duration > 0 && (\n        <div className=\"h-1 w-full bg-black/5\">\n          <div\n            className={`h-full ${config.progress} transition-all ease-linear`}\n            style={{\n              width: '100%',\n              animation: `shrink ${duration}ms linear forwards`\n            }}\n          />\n        </div>\n      )}\n\n      <style>{`\n        @keyframes shrink {\n          from { width: 100%; }\n          to { width: 0%; }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// Toast Container - mobile aware of 40px UNAS bottom nav\nconst ToastContainer = ({ toasts, removeToast }) => {\n  if (!toasts || toasts.length === 0) return null;\n\n  return (\n    <div className=\"fixed bottom-[calc(1rem+44px)] md:bottom-4 right-2 md:right-4 z-[100] flex flex-col gap-2 md:gap-3 pointer-events-none max-w-[calc(100vw-1rem)] md:max-w-none\">\n      {toasts.map(toast => (\n        <div key={toast.id} className=\"pointer-events-auto\">\n          <Toast {...toast} onClose={removeToast} />\n        </div>\n      ))}\n    </div>\n  );\n};\n\n// Toast Provider\nexport const ToastProvider = ({ children }) => {\n  const [toasts, setToasts] = useState([]);\n\n  const addToast = useCallback((options) => {\n    const id = Date.now() + Math.random();\n    setToasts(prev => [...prev, { id, ...options }]);\n    return id;\n  }, []);\n\n  const removeToast = useCallback((id) => {\n    setToasts(prev => prev.filter(t => t.id !== id));\n  }, []);\n\n  // Convenience methods\n  const toast = {\n    success: (message, options = {}) => addToast({ type: 'success', title: 'Siker!', message, ...options }),\n    error: (message, options = {}) => addToast({ type: 'error', title: 'Hiba!', message, ...options }),\n    warning: (message, options = {}) => addToast({ type: 'warning', title: 'Figyelem!', message, ...options }),\n    info: (message, options = {}) => addToast({ type: 'info', message, ...options }),\n    cart: (message, options = {}) => addToast({ type: 'cart', title: 'Kosr', message, ...options }),\n    wishlist: (message, options = {}) => addToast({ type: 'wishlist', title: 'Kedvencek', message, ...options }),\n    ai: (message, options = {}) => addToast({ type: 'ai', title: 'AI Asszisztens', message, ...options }),\n    notification: (message, options = {}) => addToast({ type: 'notification', message, ...options }),\n    shipping: (message, options = {}) => addToast({ type: 'shipping', title: 'Szllts', message, ...options }),\n    custom: (options) => addToast(options),\n    dismiss: removeToast\n  };\n\n  return (\n    <ToastContext.Provider value={toast}>\n      {children}\n      <ToastContainer toasts={toasts} removeToast={removeToast} />\n    </ToastContext.Provider>\n  );\n};\n\n// Hook to use toast\nexport const useToast = () => {\n  const context = useContext(ToastContext);\n  if (!context) {\n    // Return a mock toast for when provider is not available\n    return {\n      success: console.log,\n      error: console.error,\n      warning: console.warn,\n      info: console.log,\n      cart: console.log,\n      wishlist: console.log,\n      ai: console.log,\n      notification: console.log,\n      shipping: console.log,\n      custom: console.log,\n      dismiss: () => {}\n    };\n  }\n  return context;\n};\n\nexport default { Toast, ToastProvider, useToast };\n","import React from 'react';\nimport { \n  Search, Package, Heart, ShoppingCart, Filter, \n  FolderOpen, AlertCircle, RefreshCw, ArrowRight,\n  Sparkles, Frown\n} from 'lucide-react';\n\n/**\n * Modern Empty State Components\n * Beautiful, helpful empty states with actions\n */\n\n// Base Empty State\nexport const EmptyState = ({ \n  icon: Icon = Package,\n  title,\n  description,\n  action,\n  secondaryAction,\n  size = 'md',\n  className = ''\n}) => {\n  const sizes = {\n    sm: {\n      container: 'py-8 px-4',\n      icon: 'w-12 h-12',\n      iconWrapper: 'w-16 h-16',\n      title: 'text-base',\n      description: 'text-sm',\n      button: 'px-4 py-2 text-sm'\n    },\n    md: {\n      container: 'py-12 px-6',\n      icon: 'w-16 h-16',\n      iconWrapper: 'w-24 h-24',\n      title: 'text-lg',\n      description: 'text-base',\n      button: 'px-5 py-2.5 text-sm'\n    },\n    lg: {\n      container: 'py-16 px-8',\n      icon: 'w-20 h-20',\n      iconWrapper: 'w-32 h-32',\n      title: 'text-xl',\n      description: 'text-lg',\n      button: 'px-6 py-3 text-base'\n    }\n  };\n\n  const s = sizes[size];\n\n  return (\n    <div className={`flex flex-col items-center justify-center text-center ${s.container} ${className}`}>\n      {/* Animated Icon Container */}\n      <div className={`\n        ${s.iconWrapper} rounded-full \n        bg-gradient-to-br from-gray-100 to-gray-50 \n        flex items-center justify-center mb-6\n        relative overflow-hidden\n      `}>\n        {/* Subtle animation ring */}\n        <div className=\"absolute inset-0 rounded-full border-2 border-dashed border-gray-200 animate-spin-slow\" />\n        <Icon className={`${s.icon} text-gray-400`} />\n      </div>\n\n      {/* Title */}\n      {title && (\n        <h3 className={`${s.title} font-bold text-gray-900 mb-2`}>\n          {title}\n        </h3>\n      )}\n\n      {/* Description */}\n      {description && (\n        <p className={`${s.description} text-gray-500 max-w-md mb-6`}>\n          {description}\n        </p>\n      )}\n\n      {/* Actions */}\n      {(action || secondaryAction) && (\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          {action && (\n            <button\n              onClick={action.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-primary-500 text-white font-semibold rounded-xl\n                hover:bg-primary-600 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {action.icon && <action.icon className=\"w-4 h-4\" />}\n              {action.label}\n            </button>\n          )}\n          {secondaryAction && (\n            <button\n              onClick={secondaryAction.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-gray-100 text-gray-700 font-semibold rounded-xl\n                hover:bg-gray-200 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {secondaryAction.icon && <secondaryAction.icon className=\"w-4 h-4\" />}\n              {secondaryAction.label}\n            </button>\n          )}\n        </div>\n      )}\n\n      <style>{`\n        @keyframes spin-slow {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n        .animate-spin-slow {\n          animation: spin-slow 20s linear infinite;\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// No Search Results\nexport const NoSearchResults = ({ query, onClear, onSuggest }) => (\n  <EmptyState\n    icon={Search}\n    title={`Nincs tallat: \"${query}\"`}\n    description=\"Prblj ms kulcsszavakat hasznlni, vagy bngssz a kategrik kztt.\"\n    action={onClear && {\n      label: 'Keress trlse',\n      icon: RefreshCw,\n      onClick: onClear\n    }}\n    secondaryAction={onSuggest && {\n      label: 'AI javaslatok',\n      icon: Sparkles,\n      onClick: onSuggest\n    }}\n  />\n);\n\n// No Products in Category\nexport const NoCategoryProducts = ({ category, onShowAll }) => (\n  <EmptyState\n    icon={FolderOpen}\n    title={`Nincs termk: ${category}`}\n    description=\"Ez a kategria jelenleg res. Nzd meg a tbbi kategrit!\"\n    action={onShowAll && {\n      label: 'sszes termk',\n      icon: ArrowRight,\n      onClick: onShowAll\n    }}\n  />\n);\n\n// Empty Wishlist\nexport const EmptyWishlist = ({ onBrowse }) => (\n  <EmptyState\n    icon={Heart}\n    title=\"res a kvnsglistd\"\n    description=\"Mg nem adtl hozz termkeket. Bngssz s jelld meg kedvenceidet!\"\n    action={onBrowse && {\n      label: 'Bngszs',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// Empty Cart\nexport const EmptyCart = ({ onBrowse }) => (\n  <EmptyState\n    icon={ShoppingCart}\n    title=\"res a kosarad\"\n    description=\"Mg nem tettl semmit a kosrba. Fedezd fel knlatunkat!\"\n    action={onBrowse && {\n      label: 'Vsrls',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// No Filter Results\nexport const NoFilterResults = ({ onClearFilters }) => (\n  <EmptyState\n    icon={Filter}\n    title=\"Nincs tallat a szrsre\"\n    description=\"A megadott szrknek egyetlen termk sem felel meg. Prbld laztani a feltteleket.\"\n    action={onClearFilters && {\n      label: 'Szrk trlse',\n      icon: RefreshCw,\n      onClick: onClearFilters\n    }}\n  />\n);\n\n// Error State\nexport const ErrorState = ({ message, onRetry }) => (\n  <EmptyState\n    icon={AlertCircle}\n    title=\"Hiba trtnt\"\n    description={message || \"Valami nem sikerlt. Krlek prbld jra!\"}\n    action={onRetry && {\n      label: 'jraprbls',\n      icon: RefreshCw,\n      onClick: onRetry\n    }}\n  />\n);\n\n// Coming Soon\nexport const ComingSoon = ({ feature }) => (\n  <EmptyState\n    icon={Sparkles}\n    title=\"Hamarosan\"\n    description={feature ? `${feature} - dolgozunk rajta!` : \"Ez a funkci hamarosan elrhet!\"}\n  />\n);\n\n// Not Found (404)\nexport const NotFound = ({ onGoHome }) => (\n  <EmptyState\n    icon={Frown}\n    title=\"Az oldal nem tallhat\"\n    description=\"A keresett oldal nem ltezik vagy thelyezsre kerlt.\"\n    action={onGoHome && {\n      label: 'Vissza a foldalra',\n      icon: ArrowRight,\n      onClick: onGoHome\n    }}\n    size=\"lg\"\n  />\n);\n\nexport default {\n  EmptyState,\n  NoSearchResults,\n  NoCategoryProducts,\n  EmptyWishlist,\n  EmptyCart,\n  NoFilterResults,\n  ErrorState,\n  ComingSoon,\n  NotFound\n};\n","import React from 'react';\nimport { \n  Sparkles, Flame, Star, TrendingUp, Clock, Tag, \n  Percent, Package, Truck, Shield, Award, Zap\n} from 'lucide-react';\n\n/**\n * Modern Badge Components\n * Consistent, accessible product badges with animations\n */\n\n// Base Badge Component\nexport const Badge = ({ \n  children, \n  variant = 'default',\n  size = 'sm',\n  icon: Icon,\n  pulse = false,\n  className = ''\n}) => {\n  const variants = {\n    default: 'bg-gray-100 text-gray-700',\n    primary: 'bg-primary-100 text-primary-700',\n    success: 'bg-emerald-100 text-emerald-700',\n    warning: 'bg-amber-100 text-amber-700',\n    danger: 'bg-red-100 text-red-700',\n    purple: 'bg-secondary-100 text-secondary-700',\n    pink: 'bg-pink-100 text-pink-700',\n    gradient: 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white',\n    outline: 'bg-transparent border-2 border-current'\n  };\n\n  // UNIFIED TYPOGRAPHY SCALE - Comfortable readable sizes\n  const sizes = {\n    xs: 'text-sm px-2.5 py-1',              // 14px - small but readable\n    sm: 'text-sm sm:text-base px-3 py-1.5', // 14-16px - standard badge\n    md: 'text-base sm:text-lg px-4 py-2',   // 16-18px - prominent\n    lg: 'text-lg sm:text-xl px-5 py-2.5'    // 18-20px - hero badges\n  };\n\n  const iconSizes = {\n    xs: 'w-4 h-4',\n    sm: 'w-4 h-4 sm:w-5 sm:h-5',\n    md: 'w-5 h-5 sm:w-6 sm:h-6',\n    lg: 'w-6 h-6'\n  };\n\n  return (\n    <span className={`\n      inline-flex items-center gap-1.5 font-semibold rounded-full\n      ${variants[variant]} ${sizes[size]}\n      ${pulse ? 'animate-pulse' : ''}\n      ${className}\n    `}>\n      {Icon && <Icon className={iconSizes[size]} />}\n      {children}\n    </span>\n  );\n};\n\n// New Product Badge\nexport const NewBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"primary\" size={size} icon={Sparkles}>\n    J\n  </Badge>\n);\n\n// Sale/Discount Badge\nexport const DiscountBadge = ({ percent, size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Percent}>\n    -{percent}%\n  </Badge>\n);\n\n// Hot/Popular Badge\nexport const HotBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Flame} pulse>\n    Npszer\n  </Badge>\n);\n\n// Bestseller Badge\nexport const BestsellerBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Award}>\n    Bestseller\n  </Badge>\n);\n\n// Trending Badge\nexport const TrendingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"purple\" size={size} icon={TrendingUp}>\n    Trend\n  </Badge>\n);\n\n// Limited Badge\nexport const LimitedBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"pink\" size={size} icon={Clock}>\n    Limitlt\n  </Badge>\n);\n\n// Free Shipping Badge\nexport const FreeShippingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Truck}>\n    Ingyenes szllts\n  </Badge>\n);\n\n// Stock Badge\nexport const StockBadge = ({ inStock, quantity, size = 'sm' }) => {\n  if (!inStock || quantity === 0) {\n    return (\n      <Badge variant=\"default\" size={size}>\n        Elfogyott\n      </Badge>\n    );\n  }\n  \n  if (quantity && quantity <= 5) {\n    return (\n      <Badge variant=\"warning\" size={size} icon={Package}>\n        Csak {quantity} db\n      </Badge>\n    );\n  }\n  \n  return (\n    <Badge variant=\"success\" size={size} icon={Package}>\n      Kszleten\n    </Badge>\n  );\n};\n\n// Rating Badge\nexport const RatingBadge = ({ rating, count, size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Star}>\n    {rating?.toFixed(1) || '5.0'} {count && `(${count})`}\n  </Badge>\n);\n\n// Premium/Quality Badge\nexport const PremiumBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Shield}>\n    Prmium\n  </Badge>\n);\n\n// Fast Delivery Badge  \nexport const FastDeliveryBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Zap}>\n    24h szllts\n  </Badge>\n);\n\n// Price Drop Badge\nexport const PriceDropBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Tag}>\n    ress\n  </Badge>\n);\n\n// Smart Badge - automatically determines which badge to show\n// Uses sm size for READABLE badges\nexport const SmartBadges = ({ product, maxBadges = 2 }) => {\n  const badges = [];\n  \n  // Check for new (last 7 days)\n  if (product.createdAt) {\n    const daysSinceCreation = (Date.now() - new Date(product.createdAt).getTime()) / (1000 * 60 * 60 * 24);\n    if (daysSinceCreation <= 7) {\n      badges.push({ component: NewBadge, priority: 3 });\n    }\n  }\n  \n  // Check for discount\n  if (product.salePrice && product.price > product.salePrice) {\n    const percent = Math.round(((product.price - product.salePrice) / product.price) * 100);\n    if (percent >= 10) {\n      badges.push({ \n        component: ({ size }) => <DiscountBadge percent={percent} size={size} />, \n        priority: 5 \n      });\n    }\n  }\n  \n  // Check for popularity (if we have sales data)\n  if (product.salesCount && product.salesCount > 50) {\n    badges.push({ component: HotBadge, priority: 2 });\n  }\n  \n  // Check for low stock\n  if (product.inStock && product.quantity && product.quantity <= 5 && product.quantity > 0) {\n    badges.push({ component: LimitedBadge, priority: 4 });\n  }\n  \n  // Check for bestseller\n  if (product.isBestseller) {\n    badges.push({ component: BestsellerBadge, priority: 6 });\n  }\n  \n  // Check for free shipping\n  if (product.freeShipping) {\n    badges.push({ component: FreeShippingBadge, priority: 1 });\n  }\n  \n  // Sort by priority and take top badges\n  const topBadges = badges\n    .sort((a, b) => b.priority - a.priority)\n    .slice(0, maxBadges);\n  \n  if (topBadges.length === 0) return null;\n  \n  return (\n    <div className=\"flex flex-col gap-1.5 sm:gap-2\">\n      {topBadges.map((badge, idx) => (\n        <badge.component key={idx} size=\"sm\" />\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  Badge,\n  NewBadge,\n  DiscountBadge,\n  HotBadge,\n  BestsellerBadge,\n  TrendingBadge,\n  LimitedBadge,\n  FreeShippingBadge,\n  StockBadge,\n  RatingBadge,\n  PremiumBadge,\n  FastDeliveryBadge,\n  PriceDropBadge,\n  SmartBadges\n};\n","import React from 'react';\nimport { \n  LayoutGrid, Sofa, Armchair, BedDouble, Lamp, LampDesk, Package, \n  Table, BookOpen, Tv, Bath, UtensilsCrossed, Briefcase, Baby,\n  Flower2, TreeDeciduous, Warehouse, Shirt, Home, Box,\n  MessageCircle, Camera, Move3d, Sparkles, Lightbulb, Zap,\n  Palette, DollarSign, Crown, Target, Handshake, Recycle,\n  ThumbsUp, Heart, Shield, Award, Clock, Truck, CheckCircle2,\n  Star, TrendingUp, Gift, Search, ArrowRight, Bot\n} from 'lucide-react';\n\n/**\n * Category Icon Mapping - consistent furniture-related icons\n */\nconst CATEGORY_ICONS = {\n  // Default & General\n  'sszes': LayoutGrid,\n  'default': Package,\n  \n  // Living Room\n  'Kanap': Sofa,\n  'Kanapk': Sofa,\n  'Fotel': Armchair,\n  'Fotelek': Armchair,\n  'lgarnitra': Sofa,\n  'lgarnitrk': Sofa,\n  'Nappali': Tv,\n  'Nappali btor': Tv,\n  \n  // Bedroom\n  'gy': BedDouble,\n  'gyak': BedDouble,\n  'Hlszoba': BedDouble,\n  'Hlszoba btor': BedDouble,\n  'Matrac': BedDouble,\n  'Matracok': BedDouble,\n  \n  // Seating\n  'Szk': Armchair,\n  'Szkek': Armchair,\n  'Irodai szk': Briefcase,\n  'Irodaszk': Briefcase,\n  \n  // Tables\n  'Asztal': Table,\n  'Asztalok': Table,\n  'tkezasztal': UtensilsCrossed,\n  'Dohnyzasztal': Table,\n  'rasztal': Briefcase,\n  \n  // Storage\n  'Szekrny': Warehouse,\n  'Szekrnyek': Warehouse,\n  'Gardrb': Shirt,\n  'Gardrbszekrny': Shirt,\n  'Komd': Box,\n  'Polc': BookOpen,\n  'Polcok': BookOpen,\n  'Knyvespolc': BookOpen,\n  'Trols': Package,\n  \n  // Lighting\n  'Lmpa': Lamp,\n  'Lmpk': Lamp,\n  'Vilgts': LampDesk,\n  'Asztali lmpa': LampDesk,\n  'lllmpa': Lamp,\n  \n  // Office\n  'Iroda': Briefcase,\n  'Iroda btor': Briefcase,\n  'Dolgozszoba': Briefcase,\n  \n  // Kids & Baby\n  'Gyerek': Baby,\n  'Gyerekszoba': Baby,\n  'Baba': Baby,\n  \n  // Bathroom\n  'Frdszoba': Bath,\n  'Frd': Bath,\n  \n  // Outdoor & Garden\n  'Kert': TreeDeciduous,\n  'Kerti': TreeDeciduous,\n  'Kerti btor': TreeDeciduous,\n  'Terasz': Flower2,\n  \n  // Home & Decor\n  'Dekorci': Flower2,\n  'Lakstextil': Home,\n  'Kiegszt': Gift,\n  'Otthon': Home,\n  'Lakberendezs': Home,\n  'Otthon s lakberendezs': Home,\n  'Btor': Sofa,\n  'Btorok': Sofa,\n  'Barkcs': Warehouse,\n  'Kert s Barkcs': TreeDeciduous,\n};\n\n/**\n * Get icon component for a category name\n */\nexport const getCategoryIcon = (categoryName) => {\n  if (!categoryName) return Package;\n  \n  // Direct match\n  if (CATEGORY_ICONS[categoryName]) {\n    return CATEGORY_ICONS[categoryName];\n  }\n  \n  // Partial match (case insensitive)\n  const lowerName = categoryName.toLowerCase();\n  for (const [key, Icon] of Object.entries(CATEGORY_ICONS)) {\n    if (lowerName.includes(key.toLowerCase()) || key.toLowerCase().includes(lowerName)) {\n      return Icon;\n    }\n  }\n  \n  return Package;\n};\n\n/**\n * Renders a category icon with consistent styling\n */\nexport const CategoryIcon = ({ name, className = \"w-4 h-4\", ...props }) => {\n  const Icon = getCategoryIcon(name);\n  return <Icon className={className} {...props} />;\n};\n\n/**\n * AI Feature Icons\n */\nexport const AIIcons = {\n  Chat: MessageCircle,\n  Camera: Camera,\n  RoomPlanner: Move3d,\n  Sparkles: Sparkles,\n  Tip: Lightbulb,\n  Quick: Zap,\n  Bot: Bot,\n};\n\n/**\n * Style Quiz Icons - modern alternatives to emojis\n */\nexport const StyleIcons = {\n  // Styles\n  modern: Sparkles,\n  scandinavian: TreeDeciduous,\n  industrial: Warehouse,\n  vintage: Clock,\n  bohemian: Palette,\n  \n  // Colors\n  neutral: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-gray-200 to-gray-400\" />,\n  earth: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-amber-600 to-green-700\" />,\n  bold: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-blue-500 to-red-500\" />,\n  pastel: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-pink-300 to-secondary-400\" />,\n  \n  // Budget\n  budget: DollarSign,\n  mid: Award,\n  premium: Crown,\n  flexible: Target,\n  \n  // Priorities\n  comfort: Sofa,\n  design: Palette,\n  durability: Shield,\n  versatility: Recycle,\n  eco: TreeDeciduous,\n  \n  // Rooms\n  living: Tv,\n  bedroom: BedDouble,\n  dining: UtensilsCrossed,\n  office: Briefcase,\n  all: Home,\n};\n\n/**\n * Trust/Feature Icons\n */\nexport const TrustIcons = {\n  quality: Shield,\n  delivery: Truck,\n  support: MessageCircle,\n  warranty: Award,\n  returns: Recycle,\n  secure: CheckCircle2,\n};\n\n/**\n * Animated Icon Wrapper\n */\nexport const AnimatedIcon = ({ icon: Icon, className = \"\", pulse = false, bounce = false, spin = false }) => {\n  const animationClass = pulse ? 'animate-pulse' : bounce ? 'animate-bounce' : spin ? 'animate-spin' : '';\n  return <Icon className={`${className} ${animationClass}`} />;\n};\n\n/**\n * Icon with gradient background\n */\nexport const GradientIcon = ({ \n  icon: Icon, \n  gradient = \"from-primary-500 to-secondary-700\",\n  size = \"md\",\n  className = \"\"\n}) => {\n  const sizes = {\n    sm: \"w-8 h-8 p-1.5\",\n    md: \"w-10 h-10 p-2\",\n    lg: \"w-12 h-12 p-2.5\",\n    xl: \"w-14 h-14 p-3\"\n  };\n  \n  const iconSizes = {\n    sm: \"w-4 h-4\",\n    md: \"w-5 h-5\",\n    lg: \"w-6 h-6\",\n    xl: \"w-7 h-7\"\n  };\n  \n  return (\n    <div className={`bg-gradient-to-br ${gradient} rounded-xl flex items-center justify-center ${sizes[size]} ${className}`}>\n      <Icon className={`${iconSizes[size]} text-white`} />\n    </div>\n  );\n};\n\n/**\n * Demo Flow - replaces emoji flows with icons\n */\nexport const DemoFlow = ({ steps, size = \"md\" }) => {\n  const iconSize = size === \"sm\" ? \"w-5 h-5\" : size === \"lg\" ? \"w-8 h-8\" : \"w-6 h-6\";\n  const arrowSize = size === \"sm\" ? \"w-3 h-3\" : size === \"lg\" ? \"w-5 h-5\" : \"w-4 h-4\";\n  \n  return (\n    <div className=\"flex items-center justify-center gap-2\">\n      {steps.map((step, idx) => (\n        <React.Fragment key={idx}>\n          <div className={`${step.bg || 'bg-gray-100'} rounded-lg p-2`}>\n            <step.icon className={`${iconSize} ${step.color || 'text-gray-600'}`} />\n          </div>\n          {idx < steps.length - 1 && (\n            <ArrowRight className={`${arrowSize} text-gray-300`} />\n          )}\n        </React.Fragment>\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  getCategoryIcon,\n  CategoryIcon,\n  AIIcons,\n  StyleIcons,\n  TrustIcons,\n  AnimatedIcon,\n  GradientIcon,\n  DemoFlow\n};\n","import React, { useState } from 'react';\nimport { Sparkles, X, ArrowRight, MessageCircle, Camera, Home, Lightbulb } from 'lucide-react';\nimport { GradientIcon } from '../ui/Icons';\n\n/**\n * AI Feature Showcase - highlights AI capabilities with modern icons\n */\nexport const AIShowcase = () => {\n  const [isDismissed, setIsDismissed] = useState(() => \n    localStorage.getItem('ai-showcase-dismissed') === 'true'\n  );\n\n  if (isDismissed) return null;\n\n  const handleDismiss = () => {\n    localStorage.setItem('ai-showcase-dismissed', 'true');\n    setIsDismissed(true);\n  };\n\n  const features = [\n    {\n      title: 'AI Asszisztens',\n      description: 'Beszlgess szakrtnkkel, krdezz, tancsot krj.',\n      icon: MessageCircle,\n      gradient: 'from-blue-500 to-primary-500',\n      feature: 'Chat'\n    },\n    {\n      title: 'Kpkeres',\n      description: 'Fotzd le a btort, mi megtalljuk a hasonlt.',\n      icon: Camera,\n      gradient: 'from-secondary-600 to-pink-600',\n      feature: 'Visual Search'\n    },\n    {\n      title: 'Szobatervez',\n      description: 'Tervezd meg a szobt virtulisan, lsd lben.',\n      icon: Home,\n      gradient: 'from-emerald-500 to-teal-600',\n      feature: 'Room Planner'\n    }\n  ];\n\n  return (\n    <div className=\"relative bg-gradient-to-br from-secondary-700 via-primary-500 to-blue-600 text-white py-6 sm:py-8 lg:py-12 xl:py-14 mb-4 sm:mb-6 lg:mb-8 overflow-hidden\">\n      {/* Animated background */}\n      <div className=\"absolute inset-0 opacity-20\">\n        <div className=\"absolute top-0 left-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-white rounded-full mix-blend-multiply filter blur-3xl animate-blob\"></div>\n        <div className=\"absolute top-0 right-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-secondary-400 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000\"></div>\n        <div className=\"absolute bottom-0 left-1/2 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-primary-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-4000\"></div>\n      </div>\n\n      <button \n        onClick={handleDismiss}\n        className=\"absolute top-2 right-2 sm:top-3 sm:right-3 lg:top-5 lg:right-5 w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-full transition-colors z-10\"\n        aria-label=\"Bezrs\"\n      >\n        <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n      </button>\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-6 lg:px-10 xl:px-16 relative z-10\">\n        <div className=\"text-center mb-6 sm:mb-10 lg:mb-14\">\n          <div className=\"inline-flex items-center px-3 py-1.5 sm:px-4 sm:py-2 lg:px-5 lg:py-2.5 bg-white/20 backdrop-blur-sm rounded-full text-xs sm:text-sm lg:text-base font-bold mb-3 sm:mb-4 lg:mb-6\">\n            <Sparkles className=\"w-4 h-4 lg:w-5 lg:h-5 mr-2 animate-pulse\" />\n            AI-Powered Shopping\n          </div>\n          <h2 className=\"text-xl sm:text-3xl lg:text-4xl xl:text-5xl font-extrabold mb-2 sm:mb-3 lg:mb-4\">\n            Talld meg az idelis btort <br className=\"hidden md:block\" />\n            <span className=\"text-yellow-300\">mestersges intelligencival</span>\n          </h2>\n          <p className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed\">\n            Hasznld az AI asszisztensnket, kpkeresnket s szobaterveznket.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 xl:gap-8\">\n          {features.map((item, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl sm:rounded-2xl lg:rounded-3xl p-4 sm:p-5 lg:p-6 xl:p-8 hover:bg-white/20 transition-all transform hover:-translate-y-1 cursor-pointer group\"\n            >\n              <GradientIcon \n                icon={item.icon} \n                gradient={item.gradient}\n                size=\"lg\"\n                className=\"mb-3 sm:mb-4 lg:mb-5 group-hover:scale-110 transition-transform\"\n              />\n              <h3 className=\"text-base sm:text-lg lg:text-xl xl:text-2xl font-bold mb-1.5 sm:mb-2 lg:mb-3\">{item.title}</h3>\n              <p className=\"text-white/80 text-xs sm:text-sm lg:text-base xl:text-lg mb-3 sm:mb-4 lg:mb-5 leading-relaxed\">{item.description}</p>\n              <div className=\"flex items-center text-xs sm:text-sm lg:text-base font-bold text-yellow-300 group-hover:text-yellow-200 transition-colors\">\n                Prbld ki <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5 ml-1 group-hover:translate-x-1 transition-transform\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <style>\n        {`\n          @keyframes blob {\n            0%, 100% { transform: translate(0, 0) scale(1); }\n            33% { transform: translate(30px, -50px) scale(1.1); }\n            66% { transform: translate(-20px, 20px) scale(0.9); }\n          }\n          .animate-blob {\n            animation: blob 7s infinite;\n          }\n          .animation-delay-2000 {\n            animation-delay: 2s;\n          }\n          .animation-delay-4000 {\n            animation-delay: 4s;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\n/**\n * AI Onboarding Tooltip\n */\nexport const AIOnboarding = ({ isOpen, onClose, targetFeature }) => {\n  if (!isOpen) return null;\n\n  const messages = {\n    chat: {\n      title: 'Prbld ki az AI Asszisztenst!',\n      description: 'Krdezz brmit a termkekrl, s azonnal vlaszt kapsz.',\n      tip: 'Pldul: \"Keresek egy skandinv kanapt 200.000 Ft alatt\"',\n      icon: MessageCircle\n    },\n    visualSearch: {\n      title: 'AI Kpkeres',\n      description: 'Tlts fel egy kpet, s megmutatjuk a hasonl termkeket.',\n      tip: 'Fotzd le a btort ami tetszik, mi megtalljuk!',\n      icon: Camera\n    },\n    roomPlanner: {\n      title: 'Virtulis Szobatervez',\n      description: 'Helyezd el a btorokat a sajt szobdban, s lsd lben.',\n      tip: 'Tlts fel egy fott a szobdrl, s kezdj el tervezni!',\n      icon: Home\n    }\n  };\n\n  const content = messages[targetFeature] || messages.chat;\n  const TipIcon = content.icon || Lightbulb;\n\n  return (\n    <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4\" onClick={onClose}>\n      <div className=\"bg-white rounded-2xl lg:rounded-3xl p-6 sm:p-8 lg:p-10 max-w-md lg:max-w-lg xl:max-w-xl w-full shadow-2xl animate-scale-in\" onClick={e => e.stopPropagation()}>\n        <div className=\"flex items-center justify-between mb-4 lg:mb-6\">\n          <div className=\"flex items-center gap-3 lg:gap-4\">\n            <div className=\"w-10 h-10 lg:w-12 lg:h-12 xl:w-14 xl:h-14 bg-primary-100 rounded-xl lg:rounded-2xl flex items-center justify-center\">\n              <Sparkles className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 text-primary-500 animate-pulse\" />\n            </div>\n            <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">{content.title}</h3>\n          </div>\n          <button onClick={onClose} className=\"w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\">\n            <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n          </button>\n        </div>\n        <p className=\"text-gray-600 mb-4 lg:mb-6 text-sm sm:text-base lg:text-lg xl:text-xl\">{content.description}</p>\n        <div className=\"bg-primary-50 border border-primary-100 rounded-xl lg:rounded-2xl p-3 sm:p-4 lg:p-5 mb-6 lg:mb-8 flex items-start gap-3 lg:gap-4\">\n          <div className=\"w-8 h-8 lg:w-10 lg:h-10 bg-primary-100 rounded-lg lg:rounded-xl flex items-center justify-center shrink-0\">\n            <Lightbulb className=\"w-4 h-4 lg:w-5 lg:h-5 text-primary-500\" />\n          </div>\n          <div>\n            <p className=\"text-xs lg:text-sm font-semibold text-primary-500 mb-1\">Tipp</p>\n            <p className=\"text-sm lg:text-base xl:text-lg text-primary-600\">{content.tip}</p>\n          </div>\n        </div>\n        <button \n          onClick={onClose}\n          className=\"w-full bg-primary-500 text-white py-3 lg:py-4 xl:py-5 rounded-xl lg:rounded-2xl font-bold text-base lg:text-lg xl:text-xl hover:bg-primary-600 transition-colors min-h-[44px] lg:min-h-[52px] xl:min-h-[60px]\"\n        >\n          rtem, kezdjk!\n        </button>\n      </div>\n      <style>\n        {`\n          @keyframes scale-in {\n            from {\n              transform: scale(0.9);\n              opacity: 0;\n            }\n            to {\n              transform: scale(1);\n              opacity: 1;\n            }\n          }\n          .animate-scale-in {\n            animation: scale-in 0.2s ease-out;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { ChevronDown, ChevronUp, ChevronLeft, ChevronRight, Grid3X3 } from 'lucide-react';\nimport { CategoryIcon } from '../ui/Icons';\n\n/**\n * CategorySwipe - Golden Standard Responsive Category Navigation\n * Typography: Mobile 13-14px, Tablet 14px, Desktop 14-15px\n * Touch targets: 44px minimum\n */\nconst CategorySwipe = ({ categories, activeCategory, onCategoryChange, displayedCount, activeTotalOverride }) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [canScrollLeft, setCanScrollLeft] = useState(false);\n  const [canScrollRight, setCanScrollRight] = useState(true);\n  const scrollRef = useRef(null);\n  \n  const activeData = categories.find(c => c.id === activeCategory);\n  const activeTotalCount = typeof activeTotalOverride === 'number' ? activeTotalOverride : (activeData?.totalCount || 0);\n  \n  const VISIBLE_MOBILE = 15;\n  const VISIBLE_DESKTOP = 18;\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() => {\n    const checkMobile = () => setIsMobile(window.innerWidth < 768);\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n  \n  const visibleCount = isMobile ? VISIBLE_MOBILE : VISIBLE_DESKTOP;\n  const visibleCategories = isExpanded ? categories : categories.slice(0, visibleCount);\n  const hasMore = categories.length > visibleCount;\n  \n  const updateScrollIndicators = () => {\n    if (scrollRef.current) {\n      const { scrollLeft, scrollWidth, clientWidth } = scrollRef.current;\n      setCanScrollLeft(scrollLeft > 5);\n      setCanScrollRight(scrollLeft < scrollWidth - clientWidth - 5);\n    }\n  };\n  \n  useEffect(() => {\n    updateScrollIndicators();\n    const el = scrollRef.current;\n    if (el) {\n      el.addEventListener('scroll', updateScrollIndicators);\n      return () => el.removeEventListener('scroll', updateScrollIndicators);\n    }\n  }, [categories]);\n  \n  const scroll = (direction) => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollBy({ \n        left: direction === 'left' ? -200 : 200, \n        behavior: 'smooth' \n      });\n    }\n  };\n\n  useEffect(() => {\n    if (scrollRef.current && isMobile) {\n      const activeEl = scrollRef.current.querySelector(`[data-category=\"${activeCategory}\"]`);\n      activeEl?.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });\n    }\n  }, [activeCategory, isMobile]);\n\n  return (\n    <div className=\"bg-white rounded-xl sm:rounded-2xl lg:rounded-3xl shadow-sm border border-gray-100 mb-4 sm:mb-6 lg:mb-8 xl:mb-10 overflow-hidden\">\n      {/* Header - UNIFIED spacing */}\n      <div className=\"px-3 sm:px-5 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-6 xl:py-7 bg-gradient-to-r from-primary-50/80 via-secondary-50/50 to-pink-50/30 border-b border-gray-100\">\n        <div className=\"flex items-center justify-between gap-3 lg:gap-6\">\n          <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-5 min-w-0\">\n            <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 xl:w-20 xl:h-20 rounded-xl lg:rounded-2xl xl:rounded-3xl bg-primary-100 flex items-center justify-center shrink-0\">\n              <Grid3X3 className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 xl:w-10 xl:h-10 text-primary-500\" />\n            </div>\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg lg:text-2xl xl:text-3xl font-bold text-gray-900\">Kategrik</h3>\n              <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-500 hidden sm:block\">{categories.length} kategria</p>\n            </div>\n          </div>\n          \n          {/* Counter - UNIFIED */}\n          <div className=\"text-right shrink-0\">\n            <div className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-gray-700\">\n              <span className=\"font-bold text-primary-500\">{displayedCount?.toLocaleString('hu-HU') || 0}</span>\n              <span className=\"text-gray-400 mx-1\">/</span>\n              <span className=\"font-semibold\">{activeTotalCount.toLocaleString('hu-HU')}</span>\n            </div>\n            <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-400\">termk lthat</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile: Horizontal Scroll */}\n      <div className=\"md:hidden relative\">\n        {canScrollLeft && (\n          <>\n            <div className=\"absolute left-0 top-0 bottom-0 w-6 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('left')}\n              className=\"absolute left-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronLeft className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        {canScrollRight && (\n          <>\n            <div className=\"absolute right-0 top-0 bottom-0 w-6 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('right')}\n              className=\"absolute right-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronRight className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        \n        <div \n          ref={scrollRef}\n          className=\"flex gap-2 overflow-x-auto py-3 px-3 scrollbar-hide\"\n        >\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              data-category={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold transition-all whitespace-nowrap\n                flex items-center gap-1.5\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-md'\n                  : 'bg-gray-100 text-gray-700 active:bg-gray-200'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-[11px] font-medium ${category.id === activeCategory ? 'text-white/80' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n          \n          {hasMore && !isExpanded && (\n            <button\n              onClick={() => setIsExpanded(true)}\n              className=\"shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold bg-primary-50 text-primary-500 whitespace-nowrap\"\n            >\n              +{categories.length - visibleCount}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Desktop: Grid Layout - UNIFIED spacing */}\n      <div className=\"hidden md:block p-4 lg:p-6 xl:p-8 2xl:p-10\">\n        <div className=\"flex flex-wrap gap-2 lg:gap-3 xl:gap-4\">\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                px-4 lg:px-5 xl:px-7 2xl:px-8 py-2.5 lg:py-3 xl:py-4 rounded-xl lg:rounded-2xl text-sm lg:text-base xl:text-lg 2xl:text-xl font-semibold transition-all\n                flex items-center gap-2 lg:gap-2.5 xl:gap-3\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-lg scale-[1.02]'\n                  : 'bg-gray-50 text-gray-700 hover:bg-gray-100 hover:shadow-md'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 lg:w-5 lg:h-5 xl:w-6 xl:h-6 2xl:w-7 2xl:h-7 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-xs lg:text-sm font-medium ${category.id === activeCategory ? 'text-white/85' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n        </div>\n\n        {hasMore && (\n          <button\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"mt-5 lg:mt-6 xl:mt-8 w-full py-3.5 lg:py-4 xl:py-5 text-base lg:text-lg xl:text-xl 2xl:text-2xl text-primary-500 hover:text-primary-600 font-bold flex items-center justify-center gap-2 lg:gap-3 transition-colors rounded-xl lg:rounded-2xl hover:bg-primary-50\"\n          >\n            {isExpanded ? (\n              <>\n                <ChevronUp className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Kevesebb\n              </>\n            ) : (\n              <>\n                <ChevronDown className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Mind a {categories.length} kategria\n              </>\n            )}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CategorySwipe;\n","/** Placeholder image (data URL)  nem fgg kls szolgltatstl (via.placeholder stb.) */\nexport const PLACEHOLDER_IMAGE = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23e5e7eb' width='400' height='400'/%3E%3Ctext fill='%239ca3af' x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16'%3ENincs kp%3C/text%3E%3C/svg%3E\";\n\n/**\n * Normalize product from UNAS API (images, inStock)\n */\nexport const normalizeProduct = (p) => ({\n  ...p,\n  images: p.images || (p.image ? [p.image] : []),\n  image: p.images?.[0] || p.image,\n  inStock: p.inStock ?? p.in_stock ?? true\n});\n\n/**\n * Format price to Hungarian currency (safe for null/undefined)\n */\nexport const formatPrice = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', {\n    style: 'currency',\n    currency: 'HUF',\n    maximumFractionDigits: 0\n  }).format(value);\n};\n\n/** Format price as number only (no \"Ft\") - for custom display */\nexport const formatPriceNumber = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(value);\n};\n\n/**\n * Format relative time (e.g., \"2 rja\")\n */\nexport const formatRelativeTime = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  const now = new Date();\n  const diffMs = now - date;\n  const diffMins = Math.floor(diffMs / 60000);\n  \n  if (diffMins < 1) return 'most';\n  if (diffMins < 60) return `${diffMins} perce`;\n  \n  const diffHours = Math.floor(diffMins / 60);\n  if (diffHours < 24) return `${diffHours} rja`;\n  \n  const diffDays = Math.floor(diffHours / 24);\n  if (diffDays < 7) return `${diffDays} napja`;\n  \n  return date.toLocaleDateString('hu-HU');\n};\n\n/**\n * Truncate text with ellipsis\n */\nexport const truncateText = (text, maxLength = 100) => {\n  if (!text) return '';\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength).trim() + '...';\n};\n\n/**\n * Generate random ID\n */\nexport const generateId = () => {\n  return Date.now().toString(36) + Math.random().toString(36).substr(2);\n};\n\n/**\n * Smooth scroll to element\n */\nexport const scrollToElement = (elementId, offset = 0) => {\n  const element = document.getElementById(elementId);\n  if (element) {\n    const top = element.getBoundingClientRect().top + window.pageYOffset - offset;\n    window.scrollTo({ top, behavior: 'smooth' });\n  }\n};\n\n/**\n * Copy to clipboard with fallback\n */\nexport const copyToClipboard = async (text) => {\n  try {\n    if (navigator.clipboard) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback for older browsers\n      const textarea = document.createElement('textarea');\n      textarea.value = text;\n      textarea.style.position = 'fixed';\n      textarea.style.opacity = '0';\n      document.body.appendChild(textarea);\n      textarea.select();\n      const success = document.execCommand('copy');\n      document.body.removeChild(textarea);\n      return success;\n    }\n  } catch (error) {\n    console.error('Failed to copy:', error);\n    return false;\n  }\n};\n\n/**\n * Validate email\n */\nexport const isValidEmail = (email) => {\n  const regex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return regex.test(email);\n};\n\n/**\n * Get contrast color (black or white) based on background\n */\nexport const getContrastColor = (hexColor) => {\n  const r = parseInt(hexColor.substr(1, 2), 16);\n  const g = parseInt(hexColor.substr(3, 2), 16);\n  const b = parseInt(hexColor.substr(5, 2), 16);\n  const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;\n  return (yiq >= 128) ? '#000000' : '#FFFFFF';\n};\n\n/**\n * Shuffle array (Fisher-Yates algorithm)\n */\nexport const shuffleArray = (array) => {\n  const newArray = [...array];\n  for (let i = newArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n  }\n  return newArray;\n};\n\n/**\n * Try to extract stock level from product data\n */\nexport const getStockLevel = (product) => {\n  if (!product) return null;\n  const direct = product.stockLevel ?? product.stock_level ?? product.stock ?? product.stock_qty ?? product.stockQty ?? null;\n  if (typeof direct === 'number' && Number.isFinite(direct)) return direct;\n  const params = product.params || '';\n  if (typeof params !== 'string' || params.length === 0) return null;\n  const match = params.match(/(rakt[a]r|k[e]szlet)[^0-9]{0,8}(\\d{1,3})/i);\n  if (match && match[2]) {\n    const val = parseInt(match[2], 10);\n    return Number.isFinite(val) ? val : null;\n  }\n  return null;\n};\n\n/**\n * Group items by key\n */\nexport const groupBy = (array, key) => {\n  return array.reduce((result, item) => {\n    const group = item[key];\n    if (!result[group]) {\n      result[group] = [];\n    }\n    result[group].push(item);\n    return result;\n  }, {});\n};\n\n/**\n * Calculate reading time\n */\nexport const calculateReadingTime = (text, wordsPerMinute = 200) => {\n  const words = text.trim().split(/\\s+/).length;\n  const minutes = Math.ceil(words / wordsPerMinute);\n  return `${minutes} perc olvass`;\n};\n","/**\n * Image Optimization Utilities\n * WebP conversion, lazy loading, responsive images\n */\n\n/**\n * Convert image URL to WebP format (if CDN supports it)\n * Falls back to original if WebP not supported\n */\nexport const toWebP = (imageUrl, quality = 80) => {\n  if (!imageUrl) return '';\n  \n  // Check if browser supports WebP\n  if (!isWebPSupported()) {\n    return imageUrl;\n  }\n\n  // If it's already a WebP, return as is\n  if (imageUrl.toLowerCase().endsWith('.webp')) {\n    return imageUrl;\n  }\n\n  // For external CDNs that support WebP conversion via query params\n  // Example: Cloudinary, Imgix, etc.\n  // Adjust based on your CDN provider\n  \n  // Generic approach: if URL has query params, append format\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&format=webp&quality=${quality}`;\n  }\n  \n  // Otherwise, try to replace extension (works if your server supports it)\n  return imageUrl.replace(/\\.(jpg|jpeg|png)$/i, '.webp');\n};\n\n/**\n * Check if browser supports WebP\n */\nexport const isWebPSupported = () => {\n  if (typeof window === 'undefined') return false;\n  \n  // Check for cached result\n  if (window._webpSupport !== undefined) {\n    return window._webpSupport;\n  }\n\n  const canvas = document.createElement('canvas');\n  if (canvas.getContext && canvas.getContext('2d')) {\n    // Check for WebP support\n    const support = canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\n    window._webpSupport = support;\n    return support;\n  }\n  \n  window._webpSupport = false;\n  return false;\n};\n\n/**\n * Generate responsive image srcset\n * Creates multiple sizes for different screen resolutions\n */\nexport const getResponsiveSrcSet = (imageUrl, sizes = [400, 800, 1200]) => {\n  if (!imageUrl) return '';\n  \n  return sizes\n    .map(size => {\n      const url = appendSizeParam(imageUrl, size);\n      return `${url} ${size}w`;\n    })\n    .join(', ');\n};\n\n/**\n * Append size parameter to image URL\n */\nconst appendSizeParam = (imageUrl, width) => {\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&w=${width}`;\n  }\n  return `${imageUrl}?w=${width}`;\n};\n\n/**\n * Lazy load image with Intersection Observer\n * Returns a ref to attach to image element\n */\nexport const useLazyLoad = () => {\n  if (typeof window === 'undefined' || !('IntersectionObserver' in window)) {\n    return null;\n  }\n\n  return (imageElement) => {\n    if (!imageElement || !(imageElement instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            const img = entry.target;\n            const src = img.getAttribute('data-src');\n            const srcset = img.getAttribute('data-srcset');\n            \n            if (src) {\n              img.src = src;\n            }\n            if (srcset) {\n              img.srcset = srcset;\n            }\n            \n            img.classList.add('loaded');\n            observer.unobserve(img);\n          }\n        });\n      },\n      {\n        rootMargin: '50px 0px', // Start loading 50px before entering viewport\n        threshold: 0.01\n      }\n    );\n\n    try {\n      observer.observe(imageElement);\n    } catch (err) {\n      return;\n    }\n  };\n};\n\n/**\n * OptimizedImage Component Helper\n * Returns optimized image props\n */\nexport const getOptimizedImageProps = (imageUrl, alt = '', options = {}) => {\n  const {\n    width,\n    height,\n    quality = 80,\n    lazy = true,\n    responsive = true,\n    className = ''\n  } = options;\n\n  const optimizedUrl = toWebP(imageUrl, quality);\n  const props = {\n    alt,\n    className: `${className} ${lazy ? 'lazy' : ''}`,\n    loading: lazy ? 'lazy' : 'eager',\n    decoding: 'async'\n  };\n\n  if (responsive) {\n    props.srcSet = getResponsiveSrcSet(optimizedUrl);\n    props.sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw';\n  }\n\n  if (lazy) {\n    props['data-src'] = optimizedUrl;\n    props.src = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 300\"%3E%3C/svg%3E'; // Placeholder\n  } else {\n    props.src = optimizedUrl;\n  }\n\n  if (width) props.width = width;\n  if (height) props.height = height;\n\n  return props;\n};\n\n/**\n * Preload critical images\n */\nexport const preloadImage = (imageUrl) => {\n  if (typeof window === 'undefined') return;\n  \n  const link = document.createElement('link');\n  link.rel = 'preload';\n  link.as = 'image';\n  link.href = toWebP(imageUrl);\n  document.head.appendChild(link);\n};\n\n/**\n * Calculate image dimensions to maintain aspect ratio\n */\nexport const calculateAspectRatio = (originalWidth, originalHeight, maxWidth) => {\n  const ratio = originalHeight / originalWidth;\n  return {\n    width: maxWidth,\n    height: Math.round(maxWidth * ratio)\n  };\n};\n\n/**\n * Image compression quality based on screen size\n */\nexport const getAdaptiveQuality = () => {\n  if (typeof window === 'undefined') return 80;\n  \n  const width = window.innerWidth;\n  \n  if (width < 768) {\n    return 70; // Mobile: lower quality\n  } else if (width < 1920) {\n    return 80; // Desktop: medium quality\n  } else {\n    return 90; // Large screens: high quality\n  }\n};\n\nexport default {\n  toWebP,\n  isWebPSupported,\n  getResponsiveSrcSet,\n  useLazyLoad,\n  getOptimizedImageProps,\n  preloadImage,\n  calculateAspectRatio,\n  getAdaptiveQuality\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { Heart, Eye, ShoppingBag, Info, ThumbsUp, ThumbsDown, Bell, ShoppingCart } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\nimport { SmartBadges, StockBadge } from '../ui/Badge';\nimport { getOptimizedImageProps, getAdaptiveQuality } from '../../utils/imageOptimizer';\nimport {\n  trackSectionEvent,\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n// Tiny placeholder for blur-up effect (1x1 transparent pixel)\nconst BLUR_PLACEHOLDER = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1 1\"%3E%3Crect fill=\"%23f3f4f6\" width=\"1\" height=\"1\"/%3E%3C/svg%3E';\n\nconst PLACEHOLDER_IMAGE = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\" viewBox=\"0 0 400 400\"%3E%3Crect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/%3E%3Ctext fill=\"%239ca3af\" font-family=\"sans-serif\" font-size=\"14\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\"%3ENo Image%3C/text%3E%3C/svg%3E';\n\n/**\n * Enhanced Product Card with:\n * - Blur-up lazy loading images\n * - Smart badges (New, Sale, Popular)\n * - Micro-interactions\n * - Scroll animations\n */\nexport const EnhancedProductCard = ({ \n  product, \n  onToggleWishlist, \n  isWishlisted, \n  onQuickView,\n  onAddToCart,\n  index = 0,\n  highlightBadge,\n  recommendationReasons = [],\n  sectionId,\n  showFeedback = true,\n  size = 'default',\n  tone = 'default',\n  accentClass, // vilg gradiens pl. 'from-pink-500 to-rose-600'  teljes krtys megklnbztets\n  skipScrollAnimation = false, // Worlds: lland megjelens, ne villanjon fel\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const [isVisible, setIsVisible] = useState(skipScrollAnimation);\n  const [notifySaved, setNotifySaved] = useState(false);\n  const toneClasses = {\n    default: 'lux-card',\n    popular: 'lux-card lux-card--popular',\n    new: 'lux-card lux-card--new',\n    favorites: 'lux-card lux-card--favorites',\n    personal: 'lux-card lux-card--personal'\n  };\n  const sizeClasses = {\n    default: {\n      image: 'p-2 sm:p-3 md:p-4 lg:p-5',\n      content: 'p-3 sm:p-4 md:p-5 lg:p-6',\n      contentMinH: 'min-h-[160px] sm:min-h-[180px]'\n    },\n    compact: {\n      image: 'p-2 sm:p-2.5 md:p-3 lg:p-3.5',\n      content: 'p-2.5 sm:p-3 md:p-4 lg:p-4',\n      contentMinH: 'min-h-[140px] sm:min-h-[155px]'\n    }\n  };\n  const sizeConfig = sizeClasses[size] || sizeClasses.default;\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const cardRef = useRef(null);\n  const impressionRef = useRef(false);\n\n  const images = product.images || [];\n  const mainImage = images[0] || PLACEHOLDER_IMAGE;\n\n  const discount = product.salePrice && product.price > product.salePrice\n    ? Math.round(((product.price - product.salePrice) / product.price) * 100)\n    : 0;\n\n  const displayPrice = product.salePrice || product.price;\n  const inStock = product.inStock ?? product.in_stock ?? true;\n  const reasonsText = recommendationReasons && recommendationReasons.length > 0\n    ? recommendationReasons.slice(0, 2).join('  ')\n    : '';\n  const optimizedProps = getOptimizedImageProps(mainImage, product.name, { responsive: true, lazy: false, quality: getAdaptiveQuality() });\n\n  // Intersection Observer for scroll animation  kihagyva ha skipScrollAnimation (Worlds)\n  useEffect(() => {\n    if (skipScrollAnimation) return;\n    const element = cardRef.current;\n    if (!element || !(element instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          const delay = Math.min((index % 4) * 25, 100);\n          if (delay > 0) setTimeout(() => setIsVisible(true), delay);\n          else setIsVisible(true);\n          observer.disconnect();\n        }\n      },\n      { threshold: 0.05, rootMargin: '100px 0px' }\n    );\n\n    try {\n      observer.observe(element);\n    } catch {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [index, skipScrollAnimation]);\n\n  useEffect(() => {\n    if (sectionId && isVisible && !impressionRef.current) {\n      impressionRef.current = true;\n      trackSectionEvent(sectionId, 'impression', product?.id);\n    }\n  }, [sectionId, isVisible, product?.id]);\n\n  useEffect(() => {\n    if (!product?.id) return;\n    setFeedbackState({\n      liked: isProductLiked(product.id),\n      disliked: isProductDisliked(product.id)\n    });\n  }, [product?.id]);\n\n  const handleQuickView = () => {\n    if (sectionId) trackSectionEvent(sectionId, 'click', product?.id);\n    onQuickView?.(product);\n  };\n\n  const handleNotify = (e) => {\n    e.stopPropagation();\n    requestBackInStock(product);\n    setNotifySaved(true);\n    setTimeout(() => setNotifySaved(false), 2000);\n  };\n\n  const hasWorldAccent = accentClass && (tone === 'favorites' || tone === 'new' || tone === 'popular');\n  const worldGlow = hasWorldAccent && {\n    favorites: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(244,63,94,0.18) 0%, transparent 50%)',\n    new: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(139,92,246,0.18) 0%, transparent 50%)',\n    popular: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(251,191,36,0.18) 0%, transparent 50%)',\n  }[tone];\n  const worldCorner = hasWorldAccent && {\n    favorites: 'linear-gradient(135deg, rgba(244,63,94,0.45) 0%, transparent 40%)',\n    new: 'linear-gradient(135deg, rgba(139,92,246,0.45) 0%, transparent 40%)',\n    popular: 'linear-gradient(135deg, rgba(251,191,36,0.45) 0%, transparent 40%)',\n  }[tone];\n\n  return (\n    <article \n      ref={cardRef}\n      className={`\n        group relative rounded-lg overflow-hidden bg-white border border-gray-200 shadow-sm\n        hover:shadow-md hover:border-gray-300 hover:-translate-y-0.5 active:scale-[0.99]\n        h-full flex flex-col touch-manipulation\n        ${toneClasses[tone] || ''}\n        ${isVisible ? 'opacity-100' : 'opacity-0 translate-y-3'}\n        transition-all duration-200\n      `}\n      style={{ willChange: isVisible ? 'auto' : 'opacity, transform' }}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Vilg dizjn  krtya elejn, nem mlyen (magas z-index, de badge/wishlist alatt) */}\n      {hasWorldAccent && (\n        <>\n          <div className=\"absolute inset-0 z-[1] pointer-events-none\" style={{ background: worldGlow }} aria-hidden />\n          <div className=\"absolute top-0 left-0 w-16 h-16 z-[2] pointer-events-none\" style={{ background: worldCorner, clipPath: 'polygon(0 0, 100% 0, 0 100%)' }} aria-hidden />\n          <div className={`absolute top-0 left-0 right-0 h-2 sm:h-2.5 bg-gradient-to-r ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n          <div className={`absolute top-0 left-0 h-10 sm:h-12 w-0.5 sm:w-1 bg-gradient-to-b ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n        </>\n      )}\n      {/* Smart Badges - kisebb mobilon */}\n      <div className=\"absolute top-2 sm:top-3 left-2 sm:left-3 z-20\">\n        <SmartBadges product={product} maxBadges={2} />\n        {highlightBadge && (\n          <span className=\"mt-1.5 inline-flex items-center px-2 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-700\">\n            {highlightBadge}\n          </span>\n        )}\n      </div>\n\n      {/* Wishlist Button - min 44px touch target mobilon */}\n      <button \n        onClick={(e) => { \n          e.stopPropagation(); \n          onToggleWishlist?.(product.id); \n        }} \n        className={`\n          absolute top-2 sm:top-3 right-2 sm:right-4 z-20\n          min-w-[44px] min-h-[44px] w-10 h-10 sm:w-11 sm:h-11 lg:w-12 lg:h-12 flex items-center justify-center \n          rounded-full shadow-md tap-scale touch-manipulation\n          ${isWishlisted \n            ? 'bg-red-500 text-white' \n            : 'bg-white/95 text-gray-500 hover:text-red-500'\n          }\n          focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n        `}\n        style={{ transition: 'background-color 0.15s, color 0.15s' }}\n        aria-label={isWishlisted ? 'Eltvolts' : 'Kedvencekhez'}\n      >\n        <Heart className={`w-5 h-5 sm:w-5 sm:h-5 lg:w-6 lg:h-6 ${isWishlisted ? 'fill-current' : ''}`} />\n      </button>\n\n      {reasonsText && (\n        <div className=\"absolute top-14 sm:top-16 right-3 sm:right-4 z-20 group\">\n          <button\n            type=\"button\"\n            className=\"w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center rounded-full bg-white/95 text-gray-500 shadow-md hover:text-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Mirt ezt ajnljuk?\"\n            title={reasonsText}\n          >\n            <Info className=\"w-4 h-4\" />\n          </button>\n          <div className=\"absolute right-0 mt-2 w-56 p-2 rounded-lg bg-gray-900 text-white text-xs opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity shadow-xl\">\n            {reasonsText}\n          </div>\n        </div>\n      )}\n\n      {/* Image Section - FILL the space */}\n      <div \n        onClick={handleQuickView} \n        className=\"relative aspect-square overflow-hidden ecom-card__image cursor-pointer\"\n      >\n        {/* Simple placeholder */}\n        {!imageLoaded && (\n          <div className=\"absolute inset-0 bg-gray-100\" />\n        )}\n        \n        {/* Actual image */}\n        <img \n          src={imageError ? PLACEHOLDER_IMAGE : (optimizedProps.src || mainImage)}\n          alt={product.name} \n          className={`\n            w-full h-full object-contain ${sizeConfig.image}\n            transition-opacity duration-300 ease-out\n            ${imageLoaded ? 'opacity-100' : 'opacity-0'}\n          `}\n          style={{ transform: 'translateZ(0)' }}\n          srcSet={optimizedProps.srcSet}\n          sizes={optimizedProps.sizes}\n          loading=\"lazy\"\n          decoding=\"async\"\n          onLoad={() => setImageLoaded(true)}\n          onError={() => { setImageError(true); setImageLoaded(true); }}\n        />\n\n        {!inStock && (\n          <div className=\"absolute inset-0 bg-white/70 backdrop-blur-[1px] flex items-center justify-center\">\n            <div className=\"flex flex-col items-center gap-2\">\n              <span className=\"px-3 py-1.5 rounded-full bg-gray-900 text-white text-xs font-bold tracking-wide\">\n                Elfogyott\n              </span>\n              <button\n                type=\"button\"\n                onClick={handleNotify}\n                className=\"px-3 py-1.5 rounded-full bg-white text-gray-800 text-xs font-semibold border border-gray-200 hover:bg-gray-50 flex items-center gap-1\"\n              >\n                <Bell className=\"w-3.5 h-3.5\" />\n                {notifySaved ? 'Elmentve' : 'rtestst krek'}\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {/* Stock badge - kompakt mobilon */}\n        <div className=\"absolute bottom-1.5 sm:bottom-2.5 left-1.5 sm:left-2.5\">\n          <StockBadge inStock={inStock} size=\"sm\" />\n        </div>\n        \n        {/* Desktop hover overlay */}\n        <div \n          className=\"hidden md:flex absolute inset-0 bg-black/40 items-end justify-center pb-6 lg:pb-8 transition-opacity duration-200\"\n          style={{ opacity: isHovered ? 1 : 0, pointerEvents: isHovered ? 'auto' : 'none' }}\n        >\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onQuickView?.(product);\n            }}\n            className=\"bg-white text-gray-900 px-6 py-3 lg:px-8 lg:py-3.5 rounded-full text-base lg:text-lg font-bold shadow-lg flex items-center gap-2 hover:bg-gray-50 tap-scale focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n          >\n            <Eye className=\"w-5 h-5 lg:w-6 lg:h-6\" /> \n            Megnzem\n          </button>\n        </div>\n      </div>\n\n      {/* Content Section - gombok alul, kzpre, magasabb krtya */}\n      <div className={`${sizeConfig.content} ${sizeConfig.contentMinH || 'min-h-[160px]'} flex flex-col flex-1`}>\n        {/* Category - kompakt */}\n        <span className=\"text-xs sm:text-sm font-semibold text-primary-600 uppercase tracking-wide mb-1 truncate\">\n          {product.category}\n        </span>\n        \n        {/* Product Name - 2 sor, biztosan frjen ki, kompakt betmret */}\n        <h3 \n          onClick={handleQuickView} \n          className=\"text-xs sm:text-sm lg:text-base font-bold text-gray-900 line-clamp-2 leading-tight cursor-pointer hover:text-primary-600 active:text-primary-700 transition-colors mb-2 min-h-[2.4em] overflow-hidden touch-manipulation\" \n          title={product.name}\n        >\n          {product.name}\n        </h3>\n        \n        {/* r - nagy, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"pt-2 sm:pt-3 border-t border-gray-100 text-center space-y-1 min-w-0\">\n          {discount > 0 ? (\n            <>\n              <span className=\"text-sm sm:text-base text-red-600 line-through block font-semibold\">\n                {formatPrice(product.price)}\n              </span>\n              <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-red-600 block\">\n                {formatPrice(displayPrice)}\n              </span>\n              <span className=\"inline-block px-2 py-1 rounded-md bg-red-100 text-red-700 text-xs sm:text-sm font-black\">\n                -{discount}%\n              </span>\n            </>\n          ) : (\n            <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-gray-900 block\">\n              {formatPrice(displayPrice)}\n            </span>\n          )}\n        </div>\n        \n        {/* Tetszik / Nem tetszik - ikonok csak, kzpre, a CTA gombok fl */}\n        {showFeedback && (\n          <div className=\"mt-3 flex justify-center items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleLikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.liked\n                  ? 'bg-green-500 text-white'\n                  : 'bg-green-50 text-green-600 hover:bg-green-100'\n              }`}\n              aria-label={feedbackState.liked ? 'Tetszik (eltvolts)' : 'Tetszik'}\n            >\n              <ThumbsUp className=\"w-5 h-5\" />\n            </button>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleDislikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.disliked\n                  ? 'bg-red-500 text-white'\n                  : 'bg-red-50 text-red-500 hover:bg-red-100'\n              }`}\n              aria-label={feedbackState.disliked ? 'Nem tetszik (eltvolts)' : 'Nem tetszik'}\n            >\n              <ThumbsDown className=\"w-5 h-5\" />\n            </button>\n          </div>\n        )}\n        \n        {/* CTA gombok - Kosrba hangslyosabb */}\n        <div className=\"mt-3 sm:mt-4 flex justify-center items-center gap-2 sm:gap-3\">\n          {inStock && onAddToCart && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                onAddToCart(product, 1);\n              }}\n              className=\"min-h-[44px] flex-1 sm:flex-initial flex items-center justify-center gap-1.5 px-4 py-2.5 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 active:bg-emerald-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 shadow-lg shadow-emerald-500/30 font-bold text-sm sm:text-base\"\n              aria-label=\"Kosrba\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-5 h-5 shrink-0\" />\n              <span>Kosrba</span>\n            </button>\n          )}\n          <button \n            onClick={(e) => { \n              e.stopPropagation(); \n              handleQuickView(); \n            }} \n            className=\"min-h-[44px] min-w-[44px] flex items-center justify-center p-2.5 sm:px-4 sm:py-2.5 bg-primary-500 text-white rounded-xl hover:bg-primary-600 active:bg-primary-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Megnzem\"\n            title=\"Megnzem\"\n          >\n            <Eye className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            <span className=\"hidden sm:inline text-sm font-bold ml-1.5\">Megnzem</span>\n          </button>\n        </div>\n      </div>\n    </article>\n  );\n};\n\nexport default EnhancedProductCard;\n","import React, { useMemo, useState, useEffect, useRef, useCallback } from 'react';\nimport { \n  ArrowLeft, TrendingUp, Package, Tag, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown,\n  ChevronRight, Filter, Grid3X3, List, Star, Home,\n  ArrowUpDown, SlidersHorizontal, X, Check, LayoutGrid,\n  Rows3, Plus, GitCompare, ChevronDown, ChevronUp, BookOpen,\n  ShieldCheck, MapPin\n} from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { formatPrice } from '../../utils/helpers';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getLikedProducts, getViewedProducts, toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\n\nconst PRESET_STORAGE_KEY = 'mkt_category_presets';\n\n/**\n * Category Images - unsplash stock photos by category\n */\nconst CATEGORY_IMAGES = {\n  'Kanap': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Kanapk': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Fotel': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=1200&q=80',\n  'Nappali': 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=1200&q=80',\n  'gy': 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=1200&q=80',\n  'Hlszoba': 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=1200&q=80',\n  'Matrac': 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=1200&q=80',\n  'Asztal': 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=1200&q=80',\n  'Szk': 'https://images.unsplash.com/photo-1503602642458-232111445657?w=1200&q=80',\n  'Iroda': 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=1200&q=80',\n  'Szekrny': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=1200&q=80',\n  'Lmpa': 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=1200&q=80',\n  'Kert': 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=1200&q=80',\n  'default': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80'\n};\n\nconst getCategoryImage = (name) => {\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (name?.toLowerCase().includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n\n/**\n * Category color themes\n */\nconst getCategoryTheme = (categoryName) => {\n  const themes = {\n    'Kanap': { gradient: 'from-blue-600/90 to-primary-700/90', accent: 'indigo' },\n    'Fotel': { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'purple' },\n    'Nappali': { gradient: 'from-secondary-700/90 to-secondary-800/90', accent: 'violet' },\n    'gy': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'purple' },\n    'Hlszoba': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'pink' },\n    'Asztal': { gradient: 'from-amber-600/90 to-orange-800/90', accent: 'amber' },\n    'Szk': { gradient: 'from-yellow-600/90 to-amber-800/90', accent: 'yellow' },\n    'Iroda': { gradient: 'from-slate-600/90 to-gray-800/90', accent: 'slate' },\n    'Szekrny': { gradient: 'from-teal-600/90 to-cyan-800/90', accent: 'teal' },\n    'Lmpa': { gradient: 'from-yellow-500/90 to-orange-700/90', accent: 'yellow' },\n    'Kert': { gradient: 'from-green-600/90 to-emerald-800/90', accent: 'green' },\n    default: { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'indigo' }\n  };\n  \n  for (const [key, theme] of Object.entries(themes)) {\n    if (categoryName?.toLowerCase().includes(key.toLowerCase())) return theme;\n  }\n  return themes.default;\n};\n\n/**\n * Breadcrumb Navigation\n */\nconst Breadcrumb = ({ category, onBack }) => (\n  <nav className=\"flex items-center gap-2 text-sm mb-4 animate-fade-in\">\n    <button onClick={onBack} className=\"flex items-center gap-1 text-white/70 hover:text-white transition-colors\">\n      <Home className=\"w-4 h-4\" />\n      <span>Foldal</span>\n    </button>\n    <ChevronRight className=\"w-4 h-4 text-white/50\" />\n    <span className=\"text-white font-medium\">{category}</span>\n  </nav>\n);\n\n/**\n * Category Hero with Image Background\n */\nconst CategoryHero = ({ category, productCount, theme, onBack }) => {\n  const CategoryIcon = getCategoryIcon(category);\n  const bgImage = getCategoryImage(category);\n  \n  return (\n    <div className=\"relative overflow-hidden\">\n      {/* Background Image */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${bgImage})` }}\n      />\n      \n      {/* Gradient Overlay */}\n      <div className={`absolute inset-0 bg-gradient-to-br ${theme.gradient}`} />\n      \n      {/* Content - FULL WIDTH and LARGER on desktop */}\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 xl:py-36 text-white\">\n        <Breadcrumb category={category} onBack={onBack} />\n        \n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6 sm:gap-10 lg:gap-14\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 lg:w-36 lg:h-36 xl:w-40 xl:h-40 bg-white/20 backdrop-blur rounded-2xl lg:rounded-3xl flex items-center justify-center animate-scale-in\">\n            <CategoryIcon className=\"w-10 h-10 sm:w-14 sm:h-14 lg:w-18 lg:h-18 xl:w-20 xl:h-20 text-white\" />\n          </div>\n          \n          <div className=\"animate-fade-in-up\">\n            <h1 className=\"text-4xl sm:text-6xl lg:text-7xl xl:text-8xl font-bold mb-3 lg:mb-5\">\n              {category}\n            </h1>\n            <p className=\"text-white/80 text-lg sm:text-xl lg:text-2xl xl:text-3xl\">\n              <span className=\"font-semibold text-white\">{productCount.toLocaleString('hu-HU')}</span> termk ebben a kategriban\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Sidebar Filters\n */\nconst SidebarFilters = ({ \n  products, \n  filters, \n  onFilterChange, \n  priceRange, \n  onPriceRangeChange,\n  isOpen,\n  onClose\n}) => {\n  // Extract unique values from products\n  const filterOptions = useMemo(() => {\n    const brands = new Map();\n    const colors = new Map();\n    \n    products.forEach(p => {\n      if (p.brand) brands.set(p.brand, (brands.get(p.brand) || 0) + 1);\n      if (p.color) colors.set(p.color, (colors.get(p.color) || 0) + 1);\n    });\n    \n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    const minPrice = Math.min(...prices) || 0;\n    const maxPrice = Math.max(...prices) || 1000000;\n    \n    return {\n      brands: Array.from(brands.entries()).sort((a, b) => b[1] - a[1]),\n      colors: Array.from(colors.entries()).sort((a, b) => b[1] - a[1]),\n      priceMin: minPrice,\n      priceMax: maxPrice\n    };\n  }, [products]);\n\n  const previewCounts = useMemo(() => {\n    const brandCounts = new Map();\n    const colorCounts = new Map();\n    let inStock = 0;\n\n    products.forEach((p) => {\n      const price = p.salePrice || p.price || 0;\n      if (price < priceRange[0] || price > priceRange[1]) return;\n\n      const isInStock = p.inStock ?? p.in_stock ?? true;\n      const brandOk = !filters.brands?.length || filters.brands.includes(p.brand);\n      const colorOk = !filters.colors?.length || filters.colors.includes(p.color);\n\n      if (brandOk && colorOk && isInStock) inStock += 1;\n\n      const baseForBrand = (filters.inStockOnly ? isInStock : true) && colorOk;\n      if (baseForBrand && p.brand) {\n        brandCounts.set(p.brand, (brandCounts.get(p.brand) || 0) + 1);\n      }\n\n      const baseForColor = (filters.inStockOnly ? isInStock : true) && brandOk;\n      if (baseForColor && p.color) {\n        colorCounts.set(p.color, (colorCounts.get(p.color) || 0) + 1);\n      }\n    });\n\n    return { brands: brandCounts, colors: colorCounts, inStock };\n  }, [products, filters, priceRange]);\n\n  const toggleFilter = (type, value) => {\n    const current = filters[type] || [];\n    const updated = current.includes(value)\n      ? current.filter(v => v !== value)\n      : [...current, value];\n    onFilterChange({ ...filters, [type]: updated });\n  };\n\n  const FilterSection = ({ title, items, type, icon: Icon }) => (\n    <div className=\"border-b border-gray-100 pb-4 mb-4\">\n      <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n        {Icon && <Icon className=\"w-4 h-4 text-gray-400\" />}\n        {title}\n      </h4>\n      <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n        {items.map(([item, count]) => {\n          const preview = type === 'brands'\n            ? previewCounts.brands.get(item)\n            : type === 'colors'\n              ? previewCounts.colors.get(item)\n              : count;\n          return (\n          <label key={item} className=\"flex items-center justify-between gap-2 cursor-pointer group\">\n            <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              checked={(filters[type] || []).includes(item)}\n              onChange={() => toggleFilter(type, item)}\n              className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n            />\n            <span className=\"text-sm text-gray-600 group-hover:text-gray-900\">{item}</span>\n            </div>\n            <span className=\"text-xs text-gray-400\">{preview ?? count}</span>\n          </label>\n        )})}\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div className=\"p-4 sm:p-0\">\n      <div className=\"flex items-center justify-between mb-6 sm:hidden\">\n        <h3 className=\"text-lg font-bold text-gray-900\">Szrk</h3>\n        <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg\">\n          <X className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Price Range */}\n      <div className=\"border-b border-gray-100 pb-4 mb-4\">\n        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n          <Tag className=\"w-4 h-4 text-gray-400\" />\n          rtartomny\n        </h4>\n        <div className=\"space-y-3\">\n          <input\n            type=\"range\"\n            min={filterOptions.priceMin}\n            max={filterOptions.priceMax}\n            value={priceRange[1]}\n            onChange={(e) => onPriceRangeChange([priceRange[0], parseInt(e.target.value)])}\n            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n          />\n          <div className=\"flex justify-between text-sm text-gray-500\">\n            <span>{priceRange[0].toLocaleString('hu-HU')} Ft</span>\n            <span>{priceRange[1].toLocaleString('hu-HU')} Ft</span>\n          </div>\n        </div>\n      </div>\n\n      {filterOptions.brands.length > 0 && (\n        <FilterSection title=\"Mrka\" items={filterOptions.brands} type=\"brands\" icon={Package} />\n      )}\n      \n      {filterOptions.colors.length > 0 && (\n        <FilterSection title=\"Szn\" items={filterOptions.colors} type=\"colors\" icon={Tag} />\n      )}\n\n      {/* Stock Filter */}\n      <div className=\"pb-4\">\n        <label className=\"flex items-center gap-2 cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={filters.inStockOnly}\n            onChange={() => onFilterChange({ ...filters, inStockOnly: !filters.inStockOnly })}\n            className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n          />\n          <span className=\"text-sm text-gray-700\">Csak kszleten ({previewCounts.inStock})</span>\n        </label>\n      </div>\n\n      {/* Clear Filters */}\n      <button\n        onClick={() => onFilterChange({})}\n        className=\"w-full py-2 text-sm text-primary-500 hover:text-primary-600 font-medium\"\n      >\n        Szrk trlse\n      </button>\n    </div>\n  );\n\n  return (\n    <>\n      {/* Desktop Sidebar */}\n      <div className=\"hidden lg:block w-64 shrink-0\">\n        <div className=\"sticky top-24 bg-white rounded-2xl border border-gray-100 p-5\">\n          <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n            <SlidersHorizontal className=\"w-5 h-5\" />\n            Szrk\n          </h3>\n          {content}\n        </div>\n      </div>\n\n      {/* Mobile Drawer */}\n      {isOpen && (\n        <div className=\"lg:hidden fixed inset-0 z-50\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={onClose} />\n          <div className=\"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-white animate-fade-in-right\">\n            {content}\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Related Categories\n */\nconst RelatedCategories = ({ currentCategory, allCategories, onCategoryChange }) => {\n  // Find related categories (same \"type\" or popular ones)\n  const related = useMemo(() => {\n    return allCategories\n      .filter(cat => cat.name !== currentCategory && cat.name !== 'sszes' && cat.count > 0)\n      .slice(0, 6);\n  }, [allCategories, currentCategory]);\n\n  if (related.length === 0) return null;\n\n  return (\n    <div className=\"bg-gray-50 rounded-2xl p-4 sm:p-6 mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Grid3X3 className=\"w-5 h-5 text-gray-400\" />\n        Kapcsold kategrik\n      </h3>\n      <div className=\"flex flex-wrap gap-2\">\n        {related.map(cat => {\n          const Icon = getCategoryIcon(cat.name);\n          return (\n            <button\n              key={cat.name}\n              onClick={() => onCategoryChange(cat.name)}\n              className=\"flex items-center gap-2 px-3 py-2 bg-white rounded-xl border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-colors tap-scale\"\n            >\n              <Icon className=\"w-4 h-4 text-gray-500\" />\n              <span className=\"text-sm font-medium text-gray-700\">{cat.name}</span>\n              <span className=\"text-xs text-gray-400\">({cat.count})</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Category Story Blocks\n */\nconst CategoryStory = ({ category }) => {\n  const base = category || 'Kategria';\n  const blocks = [\n    {\n      title: `${base} trtnet`,\n      text: 'Vlogatott anyagok, tarts szerkezet, idtll forma.',\n      icon: BookOpen\n    },\n    {\n      title: 'Anyag s komfort',\n      text: 'Llegz szvetek, masszv fa/fm vz, knyelmes hasznlat.',\n      icon: ShieldCheck\n    },\n    {\n      title: 'Elhelyezs',\n      text: 'Nappali, hl vagy iroda? Segtnk az idelis mret kivlasztsban.',\n      icon: MapPin\n    }\n  ];\n\n  return (\n    <div className=\"grid gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-3 mb-6\">\n      {blocks.map((block) => {\n        const Icon = block.icon;\n        return (\n          <div key={block.title} className=\"bg-white rounded-2xl border border-gray-100 p-4 sm:p-5 shadow-sm\">\n            <div className=\"w-10 h-10 rounded-xl bg-primary-50 text-primary-600 flex items-center justify-center mb-3\">\n              <Icon className=\"w-5 h-5\" />\n            </div>\n            <h3 className=\"font-bold text-gray-900 mb-1.5\">{block.title}</h3>\n            <p className=\"text-sm text-gray-600\">{block.text}</p>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n\n/**\n * Price Statistics Card\n */\nconst PriceStats = ({ products, stats }) => {\n  const computedStats = useMemo(() => {\n    if (stats && typeof stats.total === 'number') {\n      return {\n        min: stats.minPrice || 0,\n        max: stats.maxPrice || 0,\n        avg: stats.avgPrice || 0,\n        inStock: stats.inStockCount || 0\n      };\n    }\n    if (!products || products.length === 0) return null;\n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    if (prices.length === 0) return null;\n    return {\n      min: Math.min(...prices),\n      max: Math.max(...prices),\n      avg: prices.reduce((a, b) => a + b, 0) / prices.length,\n      inStock: products.filter(p => p.inStock !== false).length\n    };\n  }, [products, stats]);\n  \n  if (!computedStats) return null;\n  \n  return (\n    <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n      {[\n        { label: 'Legolcsbb', value: formatPrice(computedStats.min), color: 'text-green-600' },\n        { label: 'tlagr', value: formatPrice(computedStats.avg), color: 'text-gray-900' },\n        { label: 'Legdrgbb', value: formatPrice(computedStats.max), color: 'text-gray-900' },\n        { label: 'Kszleten', value: `${computedStats.inStock} db`, color: 'text-primary-500' }\n      ].map((stat, i) => (\n        <div key={i} className=\"bg-white rounded-xl p-3 sm:p-4 border border-gray-100\">\n          <p className=\"text-xs text-gray-500 mb-1\">{stat.label}</p>\n          <p className={`text-base sm:text-lg font-bold ${stat.color}`}>{stat.value}</p>\n        </div>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Featured Products\n */\nconst FeaturedProducts = ({ products, onProductClick, onWishlistToggle, wishlist, onAddToCart }) => {\n  const featured = useMemo(() => {\n    return products\n      .filter(p => p.salePrice && p.price > p.salePrice)\n      .sort((a, b) => ((b.price - b.salePrice) / b.price) - ((a.price - a.salePrice) / a.price))\n      .slice(0, 6);\n  }, [products]);\n  \n  if (featured.length === 0) return null;\n  \n  return (\n    <div className=\"mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Star className=\"w-5 h-5 text-amber-500\" />\n        Kiemelt ajnlatok\n      </h3>\n      <div className=\"flex gap-4 overflow-x-auto pb-4 scrollbar-hide -mx-4 px-4\">\n        {featured.map((product, index) => (\n          <div key={product.id} className=\"w-44 sm:w-52 shrink-0\">\n            <EnhancedProductCard\n              product={product}\n              onQuickView={onProductClick}\n              onToggleWishlist={onWishlistToggle}\n              onAddToCart={onAddToCart}\n              isWishlisted={wishlist?.includes(product.id)}\n              index={index}\n            />\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Compact Product Card - mint EnhancedProductCard: like/dislike, r formzs\n */\nconst CompactProductCard = ({ product, onQuickView, onToggleWishlist, isWishlisted, onAddToCart, onCompare, isComparing }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow tap-scale touch-manipulation\">\n      <img \n        src={product.images?.[0] || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onQuickView(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 \n          className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\"\n          onClick={() => onQuickView(product)}\n        >\n          {product.name}\n        </h4>\n        {/* r - nagyobb, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-xs sm:text-sm text-red-600 line-through block font-semibold\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-base sm:text-lg font-black text-red-600 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1.5 py-0.5 rounded bg-red-100 text-red-700 text-[10px] sm:text-xs font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-base sm:text-lg font-black text-gray-900 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        {/* Like/Dislike + CTA - Kosrba hangslyosabb */}\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onCompare?.(product)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isComparing ? 'bg-primary-100 text-primary-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <GitCompare className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => onToggleWishlist(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isWishlisted ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <Star className={`w-4 h-4 ${isWishlisted ? 'fill-current' : ''}`} />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * AI Recommendations Banner\n */\nconst AIBanner = ({ category, onAskAI }) => (\n  <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6 animate-fade-in\">\n    <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n      <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n        <Sparkles className=\"w-6 h-6\" />\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n        <p className=\"text-white/80 text-sm\">Melyik {category.toLowerCase()} illik hozzd?</p>\n      </div>\n      <button\n        onClick={onAskAI}\n        className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors tap-scale\"\n      >\n        AI Tancsad\n      </button>\n    </div>\n  </div>\n);\n\n/**\n * View & Sort Controls\n */\nconst ViewControls = ({ \n  sortOption, onSortChange, \n  viewMode, onViewModeChange, \n  loadedCount,\n  totalCount,\n  onOpenFilters,\n  compareCount\n}) => (\n  <div className=\"flex flex-wrap items-center justify-between gap-3 mb-4 pb-4 border-b border-gray-100\">\n    <div className=\"flex items-center gap-3\">\n      <button\n        onClick={onOpenFilters}\n        className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700 tap-scale\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        Szrk\n      </button>\n      <div className=\"text-sm text-gray-500\">\n        <p>\n          <span className=\"font-semibold text-gray-900\">{loadedCount.toLocaleString('hu-HU')}</span>\n          {totalCount > 0 && (\n            <span className=\"text-gray-400 ml-1\">/ {totalCount.toLocaleString('hu-HU')}</span>\n          )}\n          <span className=\"ml-1\">termk</span>\n        </p>\n        {totalCount > 0 && (\n          <div className=\"mt-1 h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-primary-500 rounded-full transition-all\"\n              style={{ width: `${Math.min(100, Math.round((loadedCount / totalCount) * 100))}%` }}\n            />\n          </div>\n        )}\n      </div>\n      {compareCount > 0 && (\n        <span className=\"px-2 py-1 bg-primary-100 text-primary-600 text-xs font-medium rounded-full\">\n          {compareCount} sszehasonltsra\n        </span>\n      )}\n    </div>\n    \n    <div className=\"flex items-center gap-2\">\n      <select\n        value={sortOption}\n        onChange={(e) => onSortChange(e.target.value)}\n        className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n      >\n        <option value=\"default\">Relevancia</option>\n        <option value=\"smart\">Okos (ajnlott)</option>\n        <option value=\"price-asc\">r </option>\n        <option value=\"price-desc\">r </option>\n        <option value=\"name-asc\">Nv A-Z</option>\n        <option value=\"discount\">Kedvezmny</option>\n      </select>\n      \n      <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n        {[\n          { mode: 'grid', icon: LayoutGrid },\n          { mode: 'compact', icon: Rows3 },\n        ].map(({ mode, icon: Icon }) => (\n          <button\n            key={mode}\n            onClick={() => onViewModeChange(mode)}\n            className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n          >\n            <Icon className=\"w-5 h-5\" />\n          </button>\n        ))}\n      </div>\n    </div>\n  </div>\n);\n\n/**\n * Main Category Page Component\n */\nconst CategoryPage = ({\n  category,\n  products,\n  allCategories = [],\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  onCategoryChange,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  totalCount = 0,\n  loadedCount = 0,\n  stats,\n  onLoadMore\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [filters, setFilters] = useState({});\n  const [priceRange, setPriceRange] = useState([0, 10000000]);\n  const [showFilters, setShowFilters] = useState(false);\n  const [compareList, setCompareList] = useState([]);\n  const [presetName, setPresetName] = useState('');\n  const [savedPresets, setSavedPresets] = useState([]);\n  const loadMoreRef = useRef(null);\n  \n  const theme = getCategoryTheme(category);\n  const likedIds = useMemo(() => getLikedProducts(), []);\n  const viewedIds = useMemo(() => getViewedProducts(30).map((p) => p.id), []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(PRESET_STORAGE_KEY);\n      setSavedPresets(raw ? JSON.parse(raw) : []);\n    } catch {\n      setSavedPresets([]);\n    }\n  }, [category]);\n\n  useEffect(() => {\n    window.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n  }, [category]);\n\n  const savePreset = () => {\n    const name = presetName.trim();\n    if (!name) return;\n    const next = [\n      {\n        id: `${Date.now()}`,\n        name,\n        filters,\n        priceRange,\n        sortOption,\n        viewMode\n      },\n      ...savedPresets.filter((p) => p.name !== name)\n    ].slice(0, 6);\n    setSavedPresets(next);\n    setPresetName('');\n    try {\n      localStorage.setItem(PRESET_STORAGE_KEY, JSON.stringify(next));\n    } catch {}\n  };\n\n  const applyPreset = (preset) => {\n    setFilters(preset.filters || {});\n    setPriceRange(preset.priceRange || [0, 10000000]);\n    setSortOption(preset.sortOption || 'default');\n    setViewMode(preset.viewMode || 'grid');\n  };\n\n  const quickApply = (type) => {\n    if (type === 'in-stock') {\n      setFilters((prev) => ({ ...prev, inStockOnly: true }));\n      return;\n    }\n    if (type === 'under-100') {\n      setPriceRange([0, 100000]);\n      return;\n    }\n    if (type === 'premium') {\n      setPriceRange([250000, priceRange[1]]);\n      return;\n    }\n    if (type === 'discount') {\n      setSortOption('discount');\n      return;\n    }\n  };\n\n  const quickCounts = useMemo(() => {\n    const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true)).length;\n    const under100 = products.filter((p) => (p.salePrice || p.price) <= 100000).length;\n    const premium = products.filter((p) => (p.salePrice || p.price) >= 250000).length;\n    const discount = products.filter((p) => p.salePrice && p.price > p.salePrice).length;\n    return { inStock, under100, premium, discount };\n  }, [products]);\n  \n  // Initialize price range from products\n  useEffect(() => {\n    if (products.length > 0) {\n      const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n      if (prices.length > 0) {\n        setPriceRange([Math.min(...prices), Math.max(...prices)]);\n      }\n    }\n  }, [products]);\n  \n  // Filter and sort products\n  const displayedProducts = useMemo(() => {\n    let filtered = [...products];\n    \n    // Price filter\n    filtered = filtered.filter(p => {\n      const price = p.salePrice || p.price;\n      return price >= priceRange[0] && price <= priceRange[1];\n    });\n    \n    // Brand filter\n    if (filters.brands?.length > 0) {\n      filtered = filtered.filter(p => filters.brands.includes(p.brand));\n    }\n    \n    // Color filter\n    if (filters.colors?.length > 0) {\n      filtered = filtered.filter(p => filters.colors.includes(p.color));\n    }\n    \n    // In stock only\n    if (filters.inStockOnly) {\n      filtered = filtered.filter(p => p.inStock !== false);\n    }\n    \n    // Sort\n    switch (sortOption) {\n      case 'price-asc':\n        filtered.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        filtered.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        filtered.sort((a, b) => a.name.localeCompare(b.name, 'hu'));\n        break;\n      case 'discount':\n        filtered.sort((a, b) => {\n          const dA = a.salePrice ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n      case 'smart':\n        filtered.sort((a, b) => {\n          const score = (p) => {\n            const stock = typeof p.stock_qty === 'number' ? p.stock_qty : 0;\n            const inStock = p.inStock ?? p.in_stock ?? true;\n            const liked = likedIds.includes(p.id) ? 6 : 0;\n            const viewed = viewedIds.includes(p.id) ? 3 : 0;\n            const discount = p.salePrice && p.price ? (p.price - p.salePrice) / p.price : 0;\n            return (inStock ? 5 : 0) + liked + viewed + Math.min(stock, 20) * 0.2 + discount * 10;\n          };\n          return score(b) - score(a);\n        });\n        break;\n    }\n    \n    return filtered;\n  }, [products, sortOption, filters, priceRange]);\n  \n  const visibleProducts = displayedProducts;\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n  \n  // Infinite scroll observer\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) {\n          onLoadMore?.();\n        }\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    \n    if (loadMoreRef.current instanceof Element) {\n      try {\n        observer.observe(loadMoreRef.current);\n      } catch (err) {\n        return;\n      }\n    }\n    \n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n  \n  const toggleCompare = (product) => {\n    setCompareList(prev => \n      prev.find(p => p.id === product.id)\n        ? prev.filter(p => p.id !== product.id)\n        : prev.length < 4 ? [...prev, product] : prev\n    );\n  };\n  \n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CategoryHero category={category} productCount={totalCount || products.length} theme={theme} onBack={onBack} />\n      \n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-8 sm:py-12 lg:py-16\">\n        <AIBanner category={category} onAskAI={onAskAI} />\n        <PriceStats products={products} stats={stats} />\n        <FeaturedProducts products={products} onProductClick={onProductClick} onWishlistToggle={onWishlistToggle} wishlist={wishlist} onAddToCart={onAddToCart} />\n        <RelatedCategories currentCategory={category} allCategories={allCategories} onCategoryChange={onCategoryChange} />\n        <CategoryStory category={category} />\n        \n        <div className=\"flex gap-8\">\n          <SidebarFilters\n            products={products}\n            filters={filters}\n            onFilterChange={setFilters}\n            priceRange={priceRange}\n            onPriceRangeChange={setPriceRange}\n            isOpen={showFilters}\n            onClose={() => setShowFilters(false)}\n          />\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"mb-4 rounded-2xl border border-gray-100 bg-white p-4 shadow-sm\">\n              <div className=\"flex flex-wrap items-center gap-2 mb-3\">\n                <span className=\"text-xs font-semibold text-gray-500\">Gyors szrk:</span>\n                <button onClick={() => quickApply('in-stock')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Kszleten ({quickCounts.inStock})</button>\n                <button onClick={() => quickApply('under-100')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">100k alatt ({quickCounts.under100})</button>\n                <button onClick={() => quickApply('premium')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Prmium ({quickCounts.premium})</button>\n                <button onClick={() => quickApply('discount')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Akcik ({quickCounts.discount})</button>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={presetName}\n                  onChange={(e) => setPresetName(e.target.value)}\n                  placeholder=\"Preset neve\"\n                  className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\"\n                />\n                <button onClick={savePreset} className=\"px-3 py-2 rounded-lg bg-primary-500 text-white text-sm font-semibold\">Ments</button>\n                {savedPresets.map((preset) => (\n                  <button\n                    key={preset.id}\n                    onClick={() => applyPreset(preset)}\n                    className=\"px-3 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200\"\n                  >\n                    {preset.name}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <ViewControls\n              sortOption={sortOption}\n              onSortChange={setSortOption}\n              viewMode={viewMode}\n              onViewModeChange={setViewMode}\n              loadedCount={loadedCount}\n              totalCount={totalCount}\n              onOpenFilters={() => setShowFilters(true)}\n              compareCount={compareList.length}\n            />\n            \n            {viewMode === 'grid' ? (\n              <div className=\"product-grid\">\n                {visibleProducts.map((product, index) => (\n                  <EnhancedProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    index={index}\n                    sectionId={`category-${category}`}\n                  />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {visibleProducts.map(product => (\n                  <CompactProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    onCompare={toggleCompare}\n                    isComparing={compareList.some(p => p.id === product.id)}\n                  />\n                ))}\n              </div>\n            )}\n            \n            {/* Infinite scroll trigger */}\n            {hasMoreToShow && (\n              <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n                <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n              </div>\n            )}\n            \n            {!hasMoreToShow && visibleProducts.length > 0 && (\n              <p className=\"text-center text-gray-400 text-base lg:text-lg py-10 lg:py-12\">\n                Minden termk betltve ({displayedProducts.length} db)\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CategoryPage;\n","import React, { useMemo, useState, useEffect, useRef } from 'react';\nimport { Home, ChevronRight, Filter, LayoutGrid, Rows3, SlidersHorizontal, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown } from 'lucide-react';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\nimport { ProductGridSkeleton } from '../ui/Skeleton';\n\n/**\n * CollectionHero  kollekci fejlc, gradient httr\n */\nconst CollectionHero = ({ collection, productCount, onBack }) => {\n  const Icon = collection.icon;\n  return (\n    <div className=\"relative overflow-hidden\">\n      {collection.image && (\n        <div className=\"absolute inset-0 bg-cover bg-center\" style={{ backgroundImage: `url(${collection.image})` }} aria-hidden />\n      )}\n      <div className={`absolute inset-0 bg-gradient-to-br ${collection.gradient}`} />\n      <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent\" />\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 text-white\">\n        <nav className=\"flex items-center gap-2 text-sm mb-6\">\n          <button onClick={onBack} className=\"flex items-center gap-1 text-white/80 hover:text-white transition-colors\">\n            <Home className=\"w-4 h-4\" />\n            <span>Foldal</span>\n          </button>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"text-white font-medium\">Kollekci</span>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"font-semibold\">{collection.title}</span>\n        </nav>\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center shrink-0\">\n            <Icon className=\"w-10 h-10 sm:w-14 sm:h-14 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold mb-2\">{collection.title}</h1>\n            <p className=\"text-white/90 text-lg sm:text-xl mb-2\">{collection.subtitle}</p>\n            <p className=\"text-white/80 text-base\">\n              <span className=\"font-semibold\">{productCount.toLocaleString('hu-HU')}</span> termk\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Collection compact card - mint foldal: like/dislike, r formzs\n */\nconst CollectionCompactCard = ({ product, onProductClick, onWishlistToggle, onAddToCart, wishlist }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow touch-manipulation\">\n      <img\n        src={product.images?.[0] || product.image || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onProductClick?.(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\" onClick={() => onProductClick?.(product)}>\n          {product.name}\n        </h4>\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-[10px] text-red-500 line-through block truncate\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-xs font-bold text-red-600 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1 py-0.5 rounded bg-red-100 text-red-600 text-[9px] font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-xs font-bold text-gray-900 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onWishlistToggle?.(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${wishlist?.includes(product.id) ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * CollectionPage  kollekci landing, vals termkekkel\n */\nconst CollectionPage = ({\n  collection,\n  products,\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  onNavigateToCategory,\n  allCategories = [],\n  totalCount = 0,\n  loadedCount = 0,\n  onLoadMore,\n  isLoading = false\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [showFilters, setShowFilters] = useState(false);\n  const [activeCategoryFilter, setActiveCategoryFilter] = useState('');\n  const loadMoreRef = useRef(null);\n\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n\n  const styleFilteredProducts = useMemo(() => {\n    let list = [...products];\n    if (collection.styleKeywords?.length > 0) {\n      const keywords = collection.styleKeywords.map((k) => k.toLowerCase());\n      list = list.filter((p) => {\n        const searchStr = [p.name || '', p.category || '', p.description || '', p.params || ''].join(' ').toLowerCase();\n        return keywords.some((kw) => searchStr.includes(kw));\n      });\n    }\n    return list;\n  }, [products, collection.styleKeywords]);\n\n  const inCollectionCategories = useMemo(() => {\n    const set = new Set();\n    styleFilteredProducts.forEach((p) => {\n      if (p.category && String(p.category).trim()) set.add(String(p.category).trim());\n    });\n    return Array.from(set).sort((a, b) => a.localeCompare(b, 'hu'));\n  }, [styleFilteredProducts]);\n\n  const displayedProducts = useMemo(() => {\n    let list = activeCategoryFilter\n      ? styleFilteredProducts.filter((p) => p.category === activeCategoryFilter)\n      : [...styleFilteredProducts];\n    switch (sortOption) {\n      case 'price-asc':\n        list.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        list.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        list.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'hu'));\n        break;\n      case 'discount':\n        list.sort((a, b) => {\n          const dA = a.salePrice && a.price ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice && b.price ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n    }\n    return list;\n  }, [styleFilteredProducts, activeCategoryFilter, sortOption]);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) onLoadMore?.();\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    if (loadMoreRef.current instanceof Element) observer.observe(loadMoreRef.current);\n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n\n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CollectionHero collection={collection} productCount={displayedProducts.length} onBack={onBack} />\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-6 xl:px-8 py-8 sm:py-12\">\n        {/* AI banner */}\n        <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n              <Sparkles className=\"w-6 h-6\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n              <p className=\"text-white/80 text-sm\">Melyik {collection.title.toLowerCase()} illik hozzd?</p>\n            </div>\n            <button\n              onClick={onAskAI}\n              className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors\"\n            >\n              AI Tancsad\n            </button>\n          </div>\n        </div>\n\n        {/* Kollekcin belli szrs  termktpus chipek */}\n        {inCollectionCategories.length > 0 && (\n          <div className=\"mb-6\">\n            <p className=\"text-sm font-medium text-gray-600 mb-2\">Szrs a kollekcin bell</p>\n            <div className=\"flex gap-2 overflow-x-auto scrollbar-hide pb-1 lg:flex-wrap lg:overflow-visible\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveCategoryFilter('')}\n                className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                  activeCategoryFilter === '' ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                }`}\n              >\n                sszes\n              </button>\n              {inCollectionCategories.map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => setActiveCategoryFilter(cat)}\n                  className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                    activeCategoryFilter === cat ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Bngssz kategrik szerint  kilps a kollekcibl */}\n        {onNavigateToCategory && (collection.relatedCategories?.length > 0 || allCategories.length > 0) && (\n          <div className=\"mb-6 p-4 rounded-xl bg-gray-100/80 border border-gray-200\">\n            <p className=\"text-sm font-medium text-gray-600 mb-3\">Bngssz kategrik szerint</p>\n            <div className=\"flex flex-wrap gap-2\">\n              {(collection.relatedCategories?.length > 0\n                ? collection.relatedCategories\n                : allCategories\n                    .filter((c) => (typeof c === 'string' ? c : c?.name) !== 'sszes')\n                    .slice(0, 8)\n                    .map((c) => (typeof c === 'string' ? c : c.name))\n              ).map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => onNavigateToCategory(cat)}\n                  className=\"px-4 py-2 rounded-lg bg-white border border-gray-200 text-sm font-medium text-gray-700 hover:border-primary-400 hover:text-primary-600 hover:bg-primary-50 transition-colors\"\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Toolbar */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3 mb-6 pb-4 border-b border-gray-200\">\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700\"\n            >\n              <Filter className=\"w-4 h-4\" />\n              Szrk\n            </button>\n            <span className=\"text-sm text-gray-500\">\n              <span className=\"font-semibold text-gray-900\">{displayedProducts.length.toLocaleString('hu-HU')}</span>\n              {totalCount > 0 && <span className=\"text-gray-400\"> / {totalCount.toLocaleString('hu-HU')}</span>} termk\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={sortOption}\n              onChange={(e) => setSortOption(e.target.value)}\n              className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n            >\n              <option value=\"default\">Relevancia</option>\n              <option value=\"price-asc\">r </option>\n              <option value=\"price-desc\">r </option>\n              <option value=\"name-asc\">Nv A-Z</option>\n              <option value=\"discount\">Kedvezmny</option>\n            </select>\n            <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n              {[\n                { mode: 'grid', icon: LayoutGrid },\n                { mode: 'compact', icon: Rows3 }\n              ].map(({ mode, icon: Icon }) => (\n                <button\n                  key={mode}\n                  onClick={() => setViewMode(mode)}\n                  className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n                >\n                  <Icon className=\"w-5 h-5\" />\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Product grid */}\n        {isLoading && products.length === 0 ? (\n          <ProductGridSkeleton count={8} />\n        ) : displayedProducts.length === 0 ? (\n          <div className=\"text-center py-16 text-gray-500\">\n            <p className=\"text-lg font-medium\">Nincs tallat ebben a kollekciban.</p>\n            <button onClick={onBack} className=\"mt-4 px-6 py-2 bg-primary-500 text-white rounded-xl font-semibold hover:bg-primary-600\">\n              Vissza a kollekcikhoz\n            </button>\n          </div>\n        ) : viewMode === 'grid' ? (\n          <div className=\"product-grid product-grid-collection\">\n            {displayedProducts.map((product, index) => (\n              <EnhancedProductCard\n                key={product.id}\n                product={product}\n                onQuickView={onProductClick}\n                onToggleWishlist={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                isWishlisted={wishlist?.includes(product.id)}\n                index={index}\n                sectionId={`collection-${collection.id}`}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"space-y-2 sm:space-y-3\">\n            {displayedProducts.map((product) => (\n              <CollectionCompactCard\n                key={product.id}\n                product={product}\n                onProductClick={onProductClick}\n                onWishlistToggle={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                wishlist={wishlist}\n              />\n            ))}\n          </div>\n        )}\n\n        {hasMoreToShow && (\n          <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n            <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n\n        {!hasMoreToShow && displayedProducts.length > 0 && (\n          <p className=\"text-center text-gray-400 py-10\">Minden termk betltve</p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CollectionPage;\n","import React from 'react';\nimport { ChevronRight } from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst CARD_COLORS = [\n  'from-primary-500 to-secondary-700',\n  'from-orange-500 to-amber-600',\n  'from-emerald-500 to-teal-600',\n  'from-violet-500 to-purple-600',\n];\n\n/**\n * F kategrik krtyk a foldalon  hierarchia alapjn.\n * Desktop: 3 oszlop, tablet: 2, mobil: horizontlis scroll vagy 1 oszlop.\n */\nexport default function MainCategoriesSection({\n  mainCategories = [],\n  activeCategory,\n  onCategorySelect,\n  totalProductCount = 0,\n}) {\n  if (!mainCategories.length) return null;\n\n  return (\n    <div className=\"mb-6 sm:mb-8 lg:mb-10\">\n      <div className=\"flex items-center justify-between gap-4 mb-4 sm:mb-5 lg:mb-6\">\n        <div>\n          <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">\n            Bngssz f kategrik szerint\n          </h3>\n          <p className=\"text-sm sm:text-base text-gray-500 mt-0.5\">\n            {totalProductCount > 0 && (\n              <span className=\"font-medium text-primary-600\">{totalProductCount.toLocaleString('hu-HU')}</span>\n            )}{' '}\n            termk egy helyen\n          </p>\n        </div>\n      </div>\n\n      {/* Desktop / tablet: grid */}\n      <div className=\"hidden sm:grid sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n        {mainCategories.map((main, idx) => {\n          const isActive = activeCategory === main.name;\n          const children = (main.children || []).slice(0, 6);\n          const Icon = getCategoryIcon(main.name);\n          const color = CARD_COLORS[idx % CARD_COLORS.length];\n          return (\n            <article\n              key={main.name}\n              className={`rounded-2xl lg:rounded-3xl border-2 overflow-hidden transition-all duration-200 hover:shadow-xl ${\n                isActive\n                  ? 'border-primary-400 bg-primary-50/50 shadow-lg'\n                  : 'border-gray-100 bg-white hover:border-gray-200'\n              }`}\n            >\n              <button\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className=\"w-full flex items-center gap-4 p-4 sm:p-5 lg:p-6 text-left min-h-[44px]\"\n              >\n                <div\n                  className={`w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}\n                >\n                  <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-9 lg:h-9\" />\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                  <h4 className=\"font-bold text-gray-900 text-base sm:text-lg lg:text-xl truncate\">\n                    {main.name}\n                  </h4>\n                  <p className=\"text-sm text-gray-500\">\n                    {Number(main.productCount || 0).toLocaleString('hu-HU')} termk\n                  </p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-gray-400 shrink-0\" />\n              </button>\n              {children.length > 0 && (\n                <div className=\"px-4 sm:px-5 lg:px-6 pb-4 sm:pb-5 lg:pb-6 pt-0 flex flex-wrap gap-2\">\n                  {children.map((child) => (\n                    <button\n                      key={child.name}\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onCategorySelect(child.name);\n                      }}\n                      className=\"px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors border border-gray-100 hover:border-primary-200\"\n                    >\n                      {child.name}\n                    </button>\n                  ))}\n                </div>\n              )}\n            </article>\n          );\n        })}\n      </div>\n\n      {/* Mobile: horizontal scroll */}\n      <div className=\"sm:hidden overflow-x-auto scrollbar-hide -mx-3 px-3\">\n        <div className=\"flex gap-3 pb-2\">\n          {mainCategories.map((main, idx) => {\n            const isActive = activeCategory === main.name;\n            const Icon = getCategoryIcon(main.name);\n            const color = CARD_COLORS[idx % CARD_COLORS.length];\n            return (\n              <button\n                key={main.name}\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className={`shrink-0 w-[160px] rounded-2xl border-2 p-4 text-left transition-all min-h-[100px] ${\n                  isActive ? 'border-primary-400 bg-primary-50/50' : 'border-gray-100 bg-white'\n                }`}\n              >\n                <div\n                  className={`w-12 h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white mb-3`}\n                >\n                  <Icon className=\"w-6 h-6\" />\n                </div>\n                <p className=\"font-bold text-gray-900 text-sm truncate\">{main.name}</p>\n                <p className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} db</p>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Home, Sparkles, Grid3X3, ChevronDown, ChevronUp, ArrowRight, Search, Sun, Moon, Heart, Menu, X, ChevronRight,\n  ShoppingCart, Camera, Move, Truck, Gift, Zap, TrendingUp, Star, Sofa, BedDouble, Armchair,\n  Lamp, Instagram, Facebook, MapPin, Mail, Phone, Clock\n} from 'lucide-react';\n\nconst RECENT_CATEGORIES_KEY = 'mkt_recent_categories';\nconst RECENT_CATEGORIES_MAX = 3;\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst ANNOUNCEMENT_MESSAGES = [\n  { icon: Truck, text: 'Ingyenes szllts 50.000 Ft felett', highlight: 'Ingyenes' },\n  { icon: Gift, text: 'Els rendels: 10% kupon ELSO10', highlight: '10%' },\n  { icon: Zap, text: 'AI szemlyre szabott ajnlatok', highlight: 'AI' },\n  { icon: Star, text: '4,9  10.000+ elgedett vsrl', highlight: '4,9' },\n  { icon: TrendingUp, text: '90.000+ btor egy helyen', highlight: '90.000+' },\n];\n\nconst POPULAR_CATEGORIES = [\n  { id: 'kanapek', name: 'Kanapk', icon: Sofa, color: 'from-blue-500 to-primary-500' },\n  { id: 'agyak', name: 'gyak', icon: BedDouble, color: 'from-secondary-600 to-secondary-600' },\n  { id: 'fotelek', name: 'Fotelek', icon: Armchair, color: 'from-orange-500 to-red-600' },\n  { id: 'lampak', name: 'Lmpk', icon: Lamp, color: 'from-yellow-500 to-orange-600' },\n  { id: 'szekrenyek', name: 'Szekrnyek', icon: Grid3X3, color: 'from-green-500 to-teal-600' },\n  { id: 'asztalok', name: 'Asztalok', icon: Grid3X3, color: 'from-cyan-500 to-blue-600' },\n];\n\nconst MEGA_MENU_COLORS = ['from-primary-500 to-secondary-700', 'from-orange-500 to-red-600', 'from-cyan-500 to-blue-600', 'from-green-500 to-teal-600', 'from-yellow-500 to-orange-600', 'from-pink-500 to-rose-600', 'from-indigo-500 to-purple-600', 'from-amber-500 to-orange-600', 'from-emerald-500 to-teal-600'];\n\n/**\n * Navbar  fejlc, kategria mega menu (f + alkategrik), mobil men, announcement sv.\n * Props: activeTab, setActiveTab, wishlistCount, productCount, categories, categoryHierarchy?, onOpenWishlist, onCategorySelect, onScrollToShop, recentlyViewed?, fixUrl?, onRecentProductClick?\n * categoryHierarchy: [ { name, productCount, children: [ { name, productCount } ] } ]  ha megadva, csak f kategrik + alkategrik jelennek meg.\n * activeCategory: aktulisan kivlasztott kategria (f vagy alkategria)  a menben kiemelve.\n */\nexport default function Navbar({\n  activeTab,\n  setActiveTab,\n  wishlistCount,\n  productCount = 0,\n  categories = [],\n  categoryHierarchy = [],\n  activeCategory = '',\n  onOpenWishlist,\n  onCategorySelect,\n  onScrollToShop,\n  recentlyViewed: recentlyViewedProp = [],\n  fixUrl = (url) => url || '',\n  onRecentProductClick\n}) {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const [isScrolled, setIsScrolled] = useState(false);\n  const [announcementIndex, setAnnouncementIndex] = useState(0);\n  const [announcementProgress, setAnnouncementProgress] = useState(0);\n  const announcementStartRef = useRef(Date.now());\n  const [isDarkMode, setIsDarkMode] = useState(false);\n  const [showMegaMenu, setShowMegaMenu] = useState(false);\n  const [isReturningUser, setIsReturningUser] = useState(false);\n  const [userName, setUserName] = useState('');\n  const [mobileMenuClosing, setMobileMenuClosing] = useState(false);\n  const [touchStartX, setTouchStartX] = useState(0);\n  const [recentlyViewedLocal, setRecentlyViewedLocal] = useState([]);\n  const [recentCategories, setRecentCategories] = useState([]);\n  const [mobileCategoriesExpanded, setMobileCategoriesExpanded] = useState(false);\n  const [mobileExpandedMain, setMobileExpandedMain] = useState(null);\n  const [megaMenuHoverMain, setMegaMenuHoverMain] = useState(null);\n  const mobileMenuRef = useRef(null);\n  const megaMenuRef = useRef(null);\n  const megaMenuPanelRef = useRef(null);\n  const megaMenuCloseTimeoutRef = useRef(null);\n  const hamburgerButtonRef = useRef(null);\n\n  useEffect(() => {\n    const lastVisit = localStorage.getItem('mkt_last_visit');\n    const savedName = localStorage.getItem('mkt_user_name');\n    if (lastVisit) {\n      setIsReturningUser(true);\n      if (savedName) setUserName(savedName);\n    }\n    localStorage.setItem('mkt_last_visit', Date.now().toString());\n  }, []);\n\n  useEffect(() => {\n    const load = () => {\n      try {\n        const raw = localStorage.getItem('recently_viewed');\n        const list = raw ? JSON.parse(raw) : [];\n        setRecentlyViewedLocal(Array.isArray(list) ? list.slice(0, 4) : []);\n      } catch {\n        setRecentlyViewedLocal([]);\n      }\n    };\n    load();\n    window.addEventListener('recently-viewed-updated', load);\n    window.addEventListener('storage', load);\n    return () => {\n      window.removeEventListener('recently-viewed-updated', load);\n      window.removeEventListener('storage', load);\n    };\n  }, []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(RECENT_CATEGORIES_KEY);\n      const list = raw ? JSON.parse(raw) : [];\n      setRecentCategories(Array.isArray(list) ? list.slice(0, RECENT_CATEGORIES_MAX) : []);\n    } catch {\n      setRecentCategories([]);\n    }\n  }, []);\n\n  const pushRecentCategory = (name) => {\n    if (!name || name === 'sszes') return;\n    setRecentCategories((prev) => {\n      const next = [name, ...prev.filter((c) => c !== name)].slice(0, RECENT_CATEGORIES_MAX);\n      try {\n        localStorage.setItem(RECENT_CATEGORIES_KEY, JSON.stringify(next));\n      } catch (_) {}\n      return next;\n    });\n  };\n\n  const ANNOUNCEMENT_DURATION_MS = 5500;\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setAnnouncementIndex(prev => (prev + 1) % ANNOUNCEMENT_MESSAGES.length);\n      announcementStartRef.current = Date.now();\n      setAnnouncementProgress(0);\n    }, ANNOUNCEMENT_DURATION_MS);\n    return () => clearInterval(interval);\n  }, []);\n\n  const announcementRafRef = useRef(null);\n  useEffect(() => {\n    const start = announcementStartRef.current;\n    const tick = () => {\n      const elapsed = Date.now() - start;\n      const p = Math.min(100, (elapsed / ANNOUNCEMENT_DURATION_MS) * 100);\n      setAnnouncementProgress(p);\n      if (p < 100) announcementRafRef.current = requestAnimationFrame(tick);\n    };\n    announcementRafRef.current = requestAnimationFrame(tick);\n    return () => {\n      if (announcementRafRef.current) cancelAnimationFrame(announcementRafRef.current);\n    };\n  }, [announcementIndex]);\n\n  useEffect(() => {\n    const handleScroll = () => setIsScrolled(window.scrollY > 20);\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  useEffect(() => {\n    const handleEsc = (e) => { if (e.key === 'Escape') setShowMegaMenu(false); };\n    window.addEventListener('keydown', handleEsc);\n    return () => window.removeEventListener('keydown', handleEsc);\n  }, []);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const handleClickOutside = (e) => {\n      if (megaMenuRef.current && !megaMenuRef.current.contains(e.target)) setShowMegaMenu(false);\n    };\n    document.addEventListener('click', handleClickOutside);\n    return () => document.removeEventListener('click', handleClickOutside);\n  }, [showMegaMenu]);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const panel = megaMenuPanelRef.current;\n    if (!panel || typeof panel.addEventListener !== 'function') {\n      return;\n    }\n    const focusables = panel.querySelectorAll('button:not([disabled])');\n    const first = focusables[0];\n    if (first) {\n      const t = setTimeout(() => first.focus(), 50);\n      const handleKeyDown = (e) => {\n        if (e.key !== 'Tab') return;\n        const idx = Array.from(focusables).indexOf(document.activeElement);\n        if (e.shiftKey) {\n          if (idx <= 0) {\n            e.preventDefault();\n            focusables[focusables.length - 1]?.focus();\n          }\n        } else {\n          if (idx >= focusables.length - 1 || idx === -1) {\n            e.preventDefault();\n            focusables[0]?.focus();\n          }\n        }\n      };\n      panel.addEventListener('keydown', handleKeyDown);\n      return () => {\n        clearTimeout(t);\n        panel.removeEventListener('keydown', handleKeyDown);\n      };\n    }\n  }, [showMegaMenu]);\n\n  useEffect(() => {\n    if (mobileMenuOpen) document.body.style.overflow = 'hidden';\n    else document.body.style.overflow = '';\n    return () => { document.body.style.overflow = ''; };\n  }, [mobileMenuOpen]);\n\n  useEffect(() => {\n    if (mobileMenuOpen) {\n      const handleEsc = (e) => { if (e.key === 'Escape') closeMobileMenu(); };\n      window.addEventListener('keydown', handleEsc);\n      const t = setTimeout(() => mobileMenuRef.current?.querySelector('button[aria-label=\"Men bezrsa\"]')?.focus(), 100);\n      return () => { window.removeEventListener('keydown', handleEsc); clearTimeout(t); };\n    }\n  }, [mobileMenuOpen]);\n\n  useEffect(() => {\n    if (isDarkMode) document.getElementById('mkt-butorbolt-app')?.classList.add('dark-mode');\n    else document.getElementById('mkt-butorbolt-app')?.classList.remove('dark-mode');\n  }, [isDarkMode]);\n\n  const handleTouchStart = (e) => setTouchStartX(e.touches[0].clientX);\n  const handleTouchEnd = (e) => {\n    const touchEndX = e.changedTouches[0].clientX;\n    if (touchEndX - touchStartX > 80) closeMobileMenu();\n  };\n\n  const closeMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuClosing(true);\n    setMobileCategoriesExpanded(false);\n    setMobileExpandedMain(null);\n    setTimeout(() => {\n      setMobileMenuOpen(false);\n      setMobileMenuClosing(false);\n      hamburgerButtonRef.current?.focus();\n    }, 300);\n  };\n\n  const focusSearchAndClose = () => {\n    setActiveTab('shop');\n    closeMobileMenu();\n    setTimeout(() => {\n      onScrollToShop?.();\n      window.dispatchEvent(new CustomEvent('mkt-focus-search'));\n    }, 400);\n  };\n\n  const openMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuOpen(true);\n  };\n\n  const setTabAndClose = (tab) => {\n    setActiveTab(tab);\n    closeMobileMenu();\n    if (tab === 'shop') requestAnimationFrame(() => requestAnimationFrame(() => onScrollToShop?.()));\n  };\n\n  const navItems = [\n    { id: 'shop', label: 'Termkek', icon: ShoppingCart, badge: productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : null, desc: 'Bngssz a knlatban' },\n    { id: 'visual-search', label: 'AI Kpkeres', icon: Camera, isAI: true, desc: 'Fotzz s keress' },\n    { id: 'room-planner', label: 'Szobatervez', icon: Move, isAI: true, desc: 'Tervezd meg a szobd' },\n  ];\n\n  const currentAnnouncement = ANNOUNCEMENT_MESSAGES[announcementIndex];\n\n  return (\n    <>\n      <nav\n        id=\"mkt-butorbolt-navbar\"\n        className={`sticky top-0 z-50 transition-all duration-200 ${isScrolled ? 'bg-white/95 backdrop-blur-xl shadow-md border-b border-gray-200' : 'bg-white/90 backdrop-blur-md border-b border-gray-100'}`}\n      >\n        <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-10 xl:px-16 2xl:px-20\">\n          <div className={`flex justify-between items-center transition-all duration-300 py-3 sm:py-2 lg:py-0 ${isScrolled ? 'min-h-[64px] sm:min-h-[72px] lg:min-h-[80px] xl:min-h-[96px]' : 'min-h-[76px] sm:min-h-[80px] lg:min-h-[96px] xl:min-h-[112px]'}`}>\n            <div\n              className=\"flex items-center cursor-pointer group\"\n              onClick={() => { setActiveTab('shop'); requestAnimationFrame(() => requestAnimationFrame(() => onScrollToShop?.())); }}\n              role=\"button\"\n              tabIndex={0}\n              onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab('shop'); requestAnimationFrame(() => requestAnimationFrame(() => onScrollToShop?.())); } }}\n              aria-label=\"Marketly.AI  Foldal\"\n            >\n              <div className={`relative bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-500 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mr-3 sm:mr-4 lg:mr-5 transform group-hover:scale-105 group-hover:rotate-3 transition-all duration-300 shadow-lg shadow-primary-300/50 group-hover:shadow-xl ${isScrolled ? 'w-11 h-11 sm:w-12 sm:h-12 lg:w-14 lg:h-14 xl:w-16 xl:h-16' : 'w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 xl:w-20 xl:h-20'}`}>\n                <Home className={isScrolled ? 'w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 xl:w-8 xl:h-8' : 'w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 xl:w-10 xl:h-10'} />\n                <div className=\"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 bg-green-400 rounded-full border-2 border-white flex items-center justify-center\">\n                  <Sparkles className=\"w-2 h-2 sm:w-2.5 sm:h-2.5 lg:w-3 lg:h-3 xl:w-4 xl:h-4 text-white\" />\n                </div>\n              </div>\n              <div className=\"flex flex-col\">\n                <div className=\"flex items-baseline\">\n                  <span className={`font-black text-gray-900 tracking-tight transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>Marketly</span>\n                  <span className={`font-black bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>.AI</span>\n                </div>\n                <span className=\"text-[10px] sm:text-xs lg:text-sm xl:text-base text-gray-500 font-semibold tracking-widest -mt-0.5\">BTORBOLT</span>\n              </div>\n            </div>\n\n            <div className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-4 2xl:gap-4\">\n              <div\n                ref={megaMenuRef}\n                className=\"relative\"\n                onMouseEnter={() => {\n                  if (megaMenuCloseTimeoutRef.current) {\n                    clearTimeout(megaMenuCloseTimeoutRef.current);\n                    megaMenuCloseTimeoutRef.current = null;\n                  }\n                  setShowMegaMenu(true);\n                }}\n                onMouseLeave={() => {\n                  megaMenuCloseTimeoutRef.current = setTimeout(() => setShowMegaMenu(false), 180);\n                }}\n              >\n                <button \n                  type=\"button\"\n                  className={`flex items-center gap-2 px-4 py-3 rounded-xl font-semibold text-base transition-all duration-200 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${showMegaMenu ? 'bg-primary-50 text-primary-700 border border-primary-200 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 border border-transparent'}`} \n                  aria-label=\"Kategrik men\" \n                  aria-expanded={showMegaMenu} \n                  aria-haspopup=\"true\"\n                >\n                  <Grid3X3 className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>Kategrik</span>\n                  <ChevronDown className={`w-4 h-4 lg:w-5 xl:w-5 transition-transform duration-200 ${showMegaMenu ? 'rotate-180' : ''}`} />\n                </button>\n                {showMegaMenu && (() => {\n                  const hasHierarchy = Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0;\n                  if (hasHierarchy) {\n                    return (\n                      <div\n                        ref={megaMenuPanelRef}\n                        className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] rounded-2xl lg:rounded-3xl z-50\"\n                        onMouseEnter={() => {\n                          if (megaMenuCloseTimeoutRef.current) {\n                            clearTimeout(megaMenuCloseTimeoutRef.current);\n                            megaMenuCloseTimeoutRef.current = null;\n                          }\n                        }}\n                        role=\"dialog\"\n                        aria-label=\"Kategrik men\"\n                      >\n                        <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                        <div className=\"p-4 lg:p-5 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                          <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                          <h3 className=\"text-sm lg:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                        </div>\n                        <div className=\"p-4 lg:p-5 xl:p-6 2xl:p-7 max-h-[65vh] md:max-h-[70vh] overflow-y-auto bg-white\">\n                          <div className=\"grid grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n                            {categoryHierarchy.slice(0, 12).map((main, idx) => {\n                              const isHover = megaMenuHoverMain === main.name;\n                              const isActiveMain = activeCategory === main.name;\n                              const children = (main.children || []).slice(0, 8);\n                              const MainIcon = getCategoryIcon(main.name);\n                              const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                              return (\n                                <div\n                                  key={main.name}\n                                  className={`rounded-xl xl:rounded-2xl border-2 transition-colors duration-200 ${isActiveMain ? 'border-primary-300 bg-primary-50' : 'border-gray-200 bg-gray-50 hover:border-primary-200 hover:bg-primary-50/70'}`}\n                                  onMouseEnter={() => setMegaMenuHoverMain(main.name)}\n                                  onMouseLeave={() => setMegaMenuHoverMain(null)}\n                                >\n                                  <button\n                                    onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                    className={`w-full flex items-center gap-3 p-3 xl:p-4 rounded-t-xl xl:rounded-t-2xl text-left min-h-[44px] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${isHover || isActiveMain ? 'bg-primary-50' : 'hover:bg-white'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={main.name}\n                                    aria-label={`F kategria: ${main.name}${isActiveMain ? ' (kivlasztva)' : ''}`}\n                                    aria-current={isActiveMain ? 'true' : undefined}\n                                  >\n                                    <div className={`w-10 h-10 xl:w-12 xl:h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                                      <MainIcon className=\"w-5 h-5 xl:w-6 xl:h-6\" />\n                                    </div>\n                                    <div className=\"min-w-0 flex-1\">\n                                      <span className=\"font-bold text-gray-800 text-sm xl:text-base block truncate\">{main.name}</span>\n                                      <span className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} termk</span>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400 shrink-0\" />\n                                  </button>\n                                  {children.length > 0 && (\n                                    <div className=\"px-3 xl:px-4 pb-3 xl:pb-4 pt-0 flex flex-wrap gap-1.5\">\n                                      {children.map((child) => {\n                                        const isActiveChild = activeCategory === child.name;\n                                        return (\n                                          <button\n                                            key={child.name}\n                                            onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                            className={`px-2.5 py-1.5 text-xs xl:text-sm font-medium rounded-lg transition-colors min-h-[32px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-1 ${isActiveChild ? 'bg-primary-500 text-white' : 'text-gray-600 hover:text-primary-600 hover:bg-primary-100'}`}\n                                            data-nav-action=\"category\"\n                                            data-nav-target={child.name}\n                                            aria-label={`Alkategria: ${child.name}${isActiveChild ? ' (kivlasztva)' : ''}`}\n                                            aria-current={isActiveChild ? 'true' : undefined}\n                                          >\n                                            {child.name}\n                                            {child.productCount != null && <span className={isActiveChild ? 'text-white/80 ml-1' : 'text-gray-400 ml-1'}>({Number(child.productCount).toLocaleString('hu-HU')})</span>}\n                                          </button>\n                                        );\n                                      })}\n                                    </div>\n                                  )}\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                        <div className=\"px-4 lg:px-5 xl:px-6 2xl:px-7 pb-4 lg:pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                          <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 lg:gap-3 py-3 lg:py-3.5 text-sm lg:text-base xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl lg:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                            sszes kategria megtekintse\n                            <ArrowRight className=\"w-4 h-4 lg:w-5 xl:w-5\" />\n                          </button>\n                        </div>\n                        </div>\n                      </div>\n                    );\n                  }\n                  const menuCategories = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes').slice(0, 12) : POPULAR_CATEGORIES;\n                  const isRealCategories = menuCategories.length > 0 && typeof menuCategories[0]?.count === 'number';\n                  return (\n                    <div ref={megaMenuPanelRef} className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] z-50\" onMouseEnter={() => { if (megaMenuCloseTimeoutRef.current) { clearTimeout(megaMenuCloseTimeoutRef.current); megaMenuCloseTimeoutRef.current = null; } }} role=\"dialog\" aria-label=\"Kategrik men\">\n                      <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                      <div className=\"p-4 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                        <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                        <h3 className=\"text-sm xl:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                      </div>\n                      <div className=\"p-5 xl:p-6 2xl:p-7\">\n                        <div className=\"grid grid-cols-4 gap-3 xl:gap-4 2xl:gap-5\">\n                          {menuCategories.map((cat, idx) => {\n                            const name = cat?.name ?? String(cat?.id ?? idx);\n                            const Icon = isRealCategories ? getCategoryIcon(name) : cat?.icon ?? Grid3X3;\n                            const color = isRealCategories ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                            return (\n                              <button key={isRealCategories ? name : (cat?.id ?? `cat-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"flex flex-col items-center gap-2 xl:gap-2.5 p-3 xl:p-4 rounded-xl xl:rounded-2xl hover:bg-gray-50 hover:scale-[1.02] active:scale-[0.98] active:bg-gray-100 transition-all duration-200 group min-h-[44px]\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                                <div className={`w-11 h-11 xl:w-14 xl:h-14 2xl:w-16 2xl:h-16 rounded-xl xl:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white group-hover:scale-110 shadow-md group-hover:shadow-lg transition-all duration-200`}>\n                                  <Icon className=\"w-5 h-5 xl:w-7 xl:h-7 2xl:w-8 2xl:h-8\" />\n                                </div>\n                                <span className=\"text-xs xl:text-sm 2xl:text-base font-semibold text-gray-700 text-center leading-tight line-clamp-2\">{name}</span>\n                                {isRealCategories && cat.count != null && <span className=\"text-[10px] xl:text-xs text-gray-400\">{Number(cat.count).toLocaleString('hu-HU')} db</span>}\n                              </button>\n                            );\n                          })}\n                        </div>\n                      </div>\n                      <div className=\"px-5 xl:px-6 2xl:px-7 pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                        <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 xl:gap-3 py-3 xl:py-3.5 text-sm xl:text-base 2xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl xl:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                          sszes kategria megtekintse\n                          <ArrowRight className=\"w-4 h-4 xl:w-5 xl:h-5\" />\n                        </button>\n                      </div>\n                      </div>\n                    </div>\n                  );\n                })()}\n              </div>\n              {navItems.map((item) => (\n                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`relative flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-6 2xl:px-7 py-2.5 lg:py-3 xl:py-3.5 2xl:py-4 rounded-xl lg:rounded-2xl font-bold text-sm lg:text-base xl:text-lg 2xl:text-xl transition-all duration-200 min-h-[44px] hover:scale-[1.02] active:scale-[0.98] ${activeTab === item.id ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg shadow-primary-300/50' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'}`} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <item.icon className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>{item.label}</span>\n                  {item.isAI && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-gradient-to-r from-primary-100 to-secondary-100 text-primary-500 rounded-full\">AI</span>}\n                  {item.badge && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-green-100 text-green-700 rounded-full\">{item.badge}</span>}\n                </button>\n              ))}\n            </div>\n\n            <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-4\">\n              <button onClick={() => { setActiveTab('shop'); requestAnimationFrame(() => requestAnimationFrame(() => { onScrollToShop?.(); window.dispatchEvent(new CustomEvent('mkt-focus-search')); })); }} className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-5 py-2.5 lg:py-3 min-h-[44px] bg-gray-100 hover:bg-gray-200 rounded-xl lg:rounded-2xl text-gray-600 hover:text-gray-900 hover:scale-[1.02] active:scale-[0.98] transition-all\" aria-label=\"Keress\" data-nav-action=\"search\">\n                <Search className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                <span className=\"text-sm lg:text-base font-bold\">Keress</span>\n              </button>\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"hidden sm:flex p-2.5 sm:p-3 min-w-[44px] min-h-[44px] items-center justify-center text-gray-600 hover:text-gray-900 rounded-xl lg:rounded-2xl hover:bg-gray-100 transition-all\" aria-label={isDarkMode ? 'Vilgos md' : 'Stt md'}>\n                {isDarkMode ? <Sun className=\"w-5 h-5 sm:w-6 sm:h-6\" /> : <Moon className=\"w-5 h-5 sm:w-6 sm:h-6\" />}\n              </button>\n              <button onClick={onOpenWishlist} className=\"relative p-2.5 sm:p-3 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 hover:text-red-500 rounded-xl lg:rounded-2xl hover:bg-red-50 transition-all group\" aria-label=\"Kvnsglista\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 transition-all group-hover:scale-110 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : ''}`} />\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center px-1.5 text-xs font-bold text-white bg-red-500 rounded-full shadow-lg animate-scale-in\">{wishlistCount}</span>}\n              </button>\n              <button ref={hamburgerButtonRef} type=\"button\" className=\"md:hidden p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl transition-all\" onClick={openMobileMenu} aria-label=\"Men megnyitsa\">\n                <Menu className=\"w-6 h-6\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <div className=\"bg-gradient-to-r from-primary-500/95 via-secondary-600 to-secondary-500/95 text-white py-1.5 sm:py-2 px-3 sm:px-4 lg:px-6 text-center relative overflow-hidden shadow-sm\">\n        <div className=\"absolute inset-0 opacity-15\" style={{ backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.4) 1px, transparent 1px)', backgroundSize: '12px 12px' }} aria-hidden=\"true\" />\n        <div className=\"relative flex items-center justify-center gap-2 sm:gap-3 min-h-[36px] sm:min-h-[40px]\">\n          <div key={announcementIndex} className=\"flex items-center gap-2 sm:gap-3 animate-fade-in max-w-full\" role=\"marquee\" aria-live=\"polite\">\n            <currentAnnouncement.icon className=\"w-4 h-4 shrink-0 text-white/90\" aria-hidden />\n            <span className=\"text-xs sm:text-sm lg:text-base font-semibold truncate\">\n              {currentAnnouncement.text.split(currentAnnouncement.highlight).map((part, i, arr) => (\n                <React.Fragment key={i}>\n                  {part}\n                  {i < arr.length - 1 && <span className=\"font-bold bg-white/25 px-1.5 py-0.5 rounded-md mx-1 shadow-sm\">{currentAnnouncement.highlight}</span>}\n                </React.Fragment>\n              ))}\n            </span>\n          </div>\n          <div className=\"hidden sm:flex items-center gap-1 ml-3\">\n            {ANNOUNCEMENT_MESSAGES.map((_, i) => (\n              <div key={i} className={`w-1.5 h-1.5 rounded-full transition-all duration-300 ${i === announcementIndex ? 'bg-white w-4' : 'bg-white/40'}`} />\n            ))}\n          </div>\n        </div>\n        <div className=\"absolute bottom-0 left-0 right-0 h-px bg-white/25\" aria-hidden=\"true\">\n          <div className=\"h-full bg-white/80 transition-[width] duration-150 ease-linear\" style={{ width: `${announcementProgress}%` }} />\n        </div>\n      </div>\n\n      {isReturningUser && (\n        <div className=\"w-full flex justify-center px-4 sm:px-6 lg:px-10 pt-2 pb-2\">\n          <div className=\"inline-flex items-center justify-center gap-2 sm:gap-3 bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200/60 rounded-full py-1.5 px-4 sm:px-6 lg:px-8 shadow-sm w-auto lg:min-w-[400px]\">\n            <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-emerald-400 to-green-500 rounded-full flex items-center justify-center text-white text-sm shrink-0\"></div>\n            <p className=\"text-sm font-bold text-gray-900 whitespace-nowrap\">dv jra{userName ? `, ${userName}` : ''}!</p>\n            <span className=\"text-xs text-emerald-600 whitespace-nowrap hidden sm:inline\">rlnk, hogy visszatrtl</span>\n            <Sparkles className=\"w-4 h-4 text-emerald-500/60 shrink-0\" />\n          </div>\n        </div>\n      )}\n\n      {mobileMenuOpen && (\n        <>\n          <button type=\"button\" className=\"fixed inset-0 z-[199] md:hidden bg-gray-900/60\" onClick={closeMobileMenu} aria-label=\"Men bezrsa (httr)\" />\n          <div\n            ref={mobileMenuRef}\n            className={`fixed top-0 right-0 z-[200] md:hidden ${mobileMenuClosing ? 'animate-slide-out-right' : 'animate-slide-in-right'}`}\n            style={{\n              width: 'min(400px, 88vw)',\n              minWidth: '280px',\n              maxWidth: '400px',\n              bottom: 'var(--unas-bottom-nav, 40px)',\n            }}\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-label=\"Navigcis men\"\n            onTouchStart={handleTouchStart}\n            onTouchEnd={handleTouchEnd}\n            onClick={(e) => e.stopPropagation()}\n          >\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary-600 via-secondary-700 to-secondary-800 rounded-l-2xl overflow-hidden shadow-2xl shadow-black/20\" />\n          <div className=\"relative h-full flex flex-col text-white p-4 sm:p-6 overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-5\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-12 h-12 sm:w-14 sm:h-14 bg-white rounded-xl flex items-center justify-center shadow-lg text-primary-600\"><Home className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                <div>\n                  <div className=\"flex items-baseline\"><span className=\"font-black text-2xl sm:text-3xl text-white\">Marketly</span><span className=\"font-black text-2xl sm:text-3xl text-white/90\">.AI</span></div>\n                  <p className=\"text-xs sm:text-sm text-white/70 font-medium tracking-wider\">BTORBOLT</p>\n                </div>\n              </div>\n              <button type=\"button\" className=\"p-3 min-w-[48px] min-h-[48px] flex items-center justify-center rounded-xl bg-white/20 hover:bg-white/30 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" onClick={closeMobileMenu} aria-label=\"Men bezrsa\"><X className=\"w-7 h-7\" /></button>\n            </div>\n            <div className=\"flex gap-3 sm:gap-4 mb-6\" role=\"region\" aria-label=\"Gyors mveletek\">\n              <button onClick={focusSearchAndClose} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Keress\" data-nav-action=\"search\"><Search className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-600\" /><span>Keress</span></button>\n              <button onClick={() => { onOpenWishlist?.(); closeMobileMenu(); }} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg relative hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Kedvencek\" data-nav-action=\"wishlist\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : 'text-gray-600'}`} /><span>Kedvencek</span>\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full text-sm flex items-center justify-center font-bold text-white\">{wishlistCount}</span>}\n              </button>\n            </div>\n            <div className=\"mb-4\" role=\"region\" aria-label=\"Kategrik\">\n              {recentCategories.length > 0 && (\n                <div className=\"mb-3\">\n                  <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-1.5\">Gyakran nzett</p>\n                  <div className=\"flex flex-wrap gap-2 justify-start\">\n                    {recentCategories.map((name) => {\n                      const Icon = getCategoryIcon(name);\n                      const idx = recentCategories.indexOf(name);\n                      const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                      return (\n                        <button key={name} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex items-center gap-2 py-2.5 px-3.5 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] min-w-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                          <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 text-white\" /></div>\n                          <span className=\"text-xs font-semibold text-left text-white\">{name}</span>\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-3\">Kategrik</p>\n              {Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {categoryHierarchy.slice(0, 16).map((main, idx) => {\n                    const isExpanded = mobileExpandedMain === main.name;\n                    const isActiveMain = activeCategory === main.name;\n                    const children = (main.children || []).slice(0, 10);\n                    const MainIcon = getCategoryIcon(main.name);\n                    const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                    return (\n                      <div key={main.name} className=\"rounded-xl overflow-hidden bg-white/15 border border-white/25 shadow-lg\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setMobileExpandedMain((v) => (v === main.name ? null : main.name))}\n                          className={`w-full flex items-center gap-3 px-4 py-4 min-h-[48px] text-left transition-colors duration-150 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-inset ${isExpanded ? 'bg-white/20' : 'hover:bg-white/20'}`}\n                          aria-expanded={isExpanded}\n                          aria-label={isExpanded ? `${main.name} sszecsuksa` : `${main.name} kategria megnyitsa`}\n                          data-nav-action=\"category-expand\"\n                          data-nav-target={main.name}\n                        >\n                          <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                            <MainIcon className=\"w-5 h-5\" />\n                          </div>\n                          <span className=\"font-bold text-white flex-1 text-left\">{main.name}</span>\n                          <span className=\"text-white/90 text-sm tabular-nums\">{Number(main.productCount || 0).toLocaleString('hu-HU')}</span>\n                          <span className=\"text-white/70\">{isExpanded ? <ChevronUp className=\"w-5 h-5\" /> : <ChevronDown className=\"w-5 h-5\" />}</span>\n                        </button>\n                        {isExpanded && children.length > 0 && (\n                          <div className=\"px-4 pb-4 pt-2 border-t border-white/20 bg-white/10\">\n                            <div className=\"flex flex-wrap gap-2 justify-start text-left\">\n                              <button\n                                onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                className={`px-3 py-2.5 text-sm font-semibold rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white ${isActiveMain ? 'bg-primary-500 text-white' : 'bg-white/20 text-white hover:bg-white/30 border border-white/25'}`}\n                                data-nav-action=\"category\"\n                                data-nav-target={main.name}\n                              >\n                                sszes ({main.name})\n                              </button>\n                              {children.map((child) => {\n                                const isActiveChild = activeCategory === child.name;\n                                return (\n                                  <button\n                                    key={child.name}\n                                    onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                    className={`px-3 py-2.5 text-sm font-medium rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white text-left ${isActiveChild ? 'bg-primary-500 text-white' : 'bg-white/20 text-white/95 hover:bg-white/30 border border-white/25'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={child.name}\n                                  >\n                                    {child.name}\n                                  </button>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                  <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); closeMobileMenu(); }} className=\"w-full flex items-center justify-center gap-2 py-4 mt-3 bg-white/15 rounded-xl font-bold text-white hover:bg-white/25 active:scale-[0.99] min-h-[48px] transition-all border border-white/25 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" data-nav-action=\"category\" data-nav-target=\"sszes\">\n                    sszes termk\n                    <ArrowRight className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              ) : (\n                (() => {\n                  const realCats = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes') : [];\n                  const list = realCats.length > 0 ? realCats : POPULAR_CATEGORIES;\n                  const initialCount = 6;\n                  const shown = mobileCategoriesExpanded ? list : list.slice(0, initialCount);\n                  const hasMore = list.length > initialCount;\n                  return (\n                    <>\n                      <div className=\"grid grid-cols-4 gap-2\">\n                        {shown.map((cat, idx) => {\n                          const name = typeof cat?.name === 'string' ? cat.name : (cat?.name ?? '');\n                          const isReal = realCats.length > 0;\n                          const Icon = isReal ? getCategoryIcon(name) : (cat?.icon ?? Grid3X3);\n                          const color = isReal ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                          return (\n                            <button key={isReal ? name : (cat?.id ?? `m-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex flex-col items-center gap-1 py-2.5 px-1 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                              <div className={`w-9 h-9 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 sm:w-5 sm:h-5 text-white\" /></div>\n                              <span className=\"text-[10px] sm:text-xs font-semibold text-center line-clamp-2 leading-tight text-white\">{name}</span>\n                            </button>\n                          );\n                        })}\n                      </div>\n                      {hasMore && (\n                        <button type=\"button\" onClick={() => setMobileCategoriesExpanded((v) => !v)} className=\"mt-2 w-full flex items-center justify-center gap-2 py-3.5 bg-white/15 rounded-xl hover:bg-white/25 transition-all min-h-[44px] text-white font-semibold text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" aria-expanded={mobileCategoriesExpanded} aria-label={mobileCategoriesExpanded ? 'Kevesebb kategria' : 'Tbb kategria megjelentse'}>\n                          {mobileCategoriesExpanded ? 'Kevesebb' : 'Tbb megjelentse'}\n                          {mobileCategoriesExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                        </button>\n                      )}\n                    </>\n                  );\n                })()\n              )}\n            </div>\n            <div className=\"space-y-3 mb-6\" role=\"region\" aria-label=\"Navigci\">\n              <p className=\"text-sm sm:text-base text-white/90 font-bold uppercase tracking-wider mb-3 sm:mb-4\">Navigci</p>\n              {navItems.map((item, index) => (\n                <button key={item.id} onClick={() => setTabAndClose(item.id)} className={`w-full flex items-center gap-4 px-4 sm:px-5 py-4 sm:py-5 rounded-xl text-left transition-all min-h-[44px] hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-700 ${activeTab === item.id ? 'bg-white text-gray-900 shadow-xl' : 'bg-gray-800 hover:bg-gray-700 border border-gray-700'}`} style={{ animationDelay: `${index * 50}ms` }} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-xl flex items-center justify-center shrink-0 ${activeTab === item.id ? 'bg-gradient-to-br from-primary-500 to-secondary-700 text-white' : 'bg-gray-700 text-white'}`}><item.icon className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`text-lg sm:text-xl font-bold ${activeTab === item.id ? 'text-gray-900' : 'text-white'}`}>{item.label}</span>\n                      {item.isAI && <span className={`px-2 py-0.5 text-xs font-bold rounded-full ${activeTab === item.id ? 'bg-primary-100 text-primary-500' : 'bg-white/20 text-white'}`}>AI</span>}\n                    </div>\n                    <p className={`text-sm sm:text-base ${activeTab === item.id ? 'text-gray-500' : 'text-white/60'}`}>{item.desc}</p>\n                  </div>\n                  <ChevronRight className={`w-5 h-5 sm:w-6 sm:h-6 shrink-0 ${activeTab === item.id ? 'text-primary-500' : 'text-white/40'}`} />\n                </button>\n              ))}\n            </div>\n            {((recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal) || []).length > 0 && (\n              <div className=\"mb-4\" role=\"region\" aria-label=\"Utoljra nzett termkek\">\n                <p className=\"text-xs text-white/90 font-semibold uppercase tracking-wider mb-2 flex items-center gap-1.5\"><Clock className=\"w-3.5 h-3.5\" />Utoljra nzett</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n                  {(recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal).slice(0, 4).map((product) => (\n                    <button key={product?.id ?? 'rv'} type=\"button\" onClick={() => { onRecentProductClick?.(product); closeMobileMenu(); }} className=\"shrink-0 w-20 min-h-[44px] text-left rounded-xl bg-gray-800 hover:bg-gray-700 hover:scale-[1.02] active:scale-[0.98] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white overflow-hidden\" data-nav-action=\"recent-product\" data-nav-target={product?.id} aria-label={`Termk megnyitsa: ${product?.name ?? ''}`}>\n                      <div className=\"w-20 h-20 bg-gray-700 rounded-t-xl overflow-hidden mb-1\">\n                        <img src={fixUrl(product?.imageUrl ?? product?.images?.[0])} alt={product?.name ?? ''} className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                      </div>\n                      <p className=\"text-[10px] text-white/90 truncate px-1 pb-1\">{product?.name ?? ''}</p>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n            <div className=\"mt-auto space-y-3 pb-[env(safe-area-inset-bottom,0)]\" role=\"region\" aria-label=\"Belltsok s elrhetsg\">\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"w-full flex items-center justify-between px-4 py-3.5 min-h-[44px] bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label={isDarkMode ? 'Vilgos md bekapcsolsa' : 'Stt md bekapcsolsa'}>\n                <div className=\"flex items-center gap-3\">{isDarkMode ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}<span className=\"font-semibold text-white\">{isDarkMode ? 'Vilgos md' : 'Stt md'}</span></div>\n                <div className={`w-10 h-6 rounded-full transition-colors ${isDarkMode ? 'bg-primary-400' : 'bg-gray-600'}`}><div className={`w-5 h-5 bg-white rounded-full mt-0.5 transition-transform ${isDarkMode ? 'translate-x-4.5 ml-0.5' : 'translate-x-0.5'}`} /></div>\n              </button>\n              <div className=\"flex gap-2\">\n                <a href=\"tel:+36123456789\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Hvs\"><Phone className=\"w-4 h-4\" />Hvs</a>\n                <a href=\"mailto:info@marketly.hu\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"E-mail kldse\"><Mail className=\"w-4 h-4\" />Email</a>\n              </div>\n              <div className=\"flex justify-center gap-3\">\n                <a href=\"https://instagram.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Instagram\"><Instagram className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://facebook.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Facebook\"><Facebook className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://maps.google.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Trkp\"><MapPin className=\"w-5 h-5 text-white\" /></a>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2\">\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">{productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : '...'}</p><p className=\"text-[9px] text-white/70\">Termk</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">24/7</p><p className=\"text-[9px] text-white/70\">AI Support</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">4.9</p><p className=\"text-[9px] text-white/70\">rtkels</p></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </>\n      )}\n    </>\n  );\n}\n","import React, { useState, useEffect } from 'react';\n\n/**\n * ScrollProgress - Shows reading/scrolling progress at top of page\n * Gradient bar that fills as user scrolls down\n */\nconst ScrollProgress = () => {\n  const [scrollProgress, setScrollProgress] = useState(0);\n\n  useEffect(() => {\n    let rafId = null;\n    const updateScrollProgress = () => {\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;\n      const progress = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;\n      setScrollProgress(Math.min(progress, 100));\n    };\n    const onScroll = () => {\n      if (rafId != null) return;\n      rafId = requestAnimationFrame(() => {\n        updateScrollProgress();\n        rafId = null;\n      });\n    };\n    window.addEventListener('scroll', onScroll, { passive: true });\n    updateScrollProgress();\n    return () => {\n      if (rafId != null) cancelAnimationFrame(rafId);\n      window.removeEventListener('scroll', onScroll);\n    };\n  }, []);\n\n  return (\n    <div className=\"fixed top-0 left-0 right-0 z-50 h-1 bg-gray-200/50\">\n      <div\n        className=\"h-full bg-gradient-to-r from-primary-500 via-secondary-600 to-pink-500 transition-all duration-150 ease-out\"\n        style={{ width: `${scrollProgress}%` }}\n      />\n      {/* Glow effect at the end */}\n      {scrollProgress > 0 && (\n        <div\n          className=\"absolute top-0 h-full w-8 bg-gradient-to-r from-transparent via-white to-transparent opacity-60 blur-sm\"\n          style={{ \n            left: `${Math.max(0, scrollProgress - 2)}%`,\n            transition: 'left 150ms ease-out'\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ScrollProgress;\n","import React, { useState, useEffect } from 'react';\nimport { ArrowUp } from 'lucide-react';\n\n/**\n * BackToTop - Floating button to scroll back to top\n * Only appears after scrolling down 50%\n */\nconst BackToTop = () => {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    let rafId = null;\n    const toggleVisibility = () => {\n      const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;\n      const scrolled = window.pageYOffset;\n      const scrollPercent = scrollHeight > 0 ? (scrolled / scrollHeight) * 100 : 0;\n      setIsVisible(scrollPercent > 30);\n    };\n    const onScroll = () => {\n      if (rafId != null) return;\n      rafId = requestAnimationFrame(() => {\n        toggleVisibility();\n        rafId = null;\n      });\n    };\n    window.addEventListener('scroll', onScroll, { passive: true });\n    toggleVisibility();\n    return () => {\n      if (rafId != null) cancelAnimationFrame(rafId);\n      window.removeEventListener('scroll', onScroll);\n    };\n  }, []);\n\n  const scrollToTop = () => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n    \n    // Haptic feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <button\n      type=\"button\"\n      onClick={scrollToTop}\n      className=\"\n        fixed bottom-[calc(5rem+44px)] md:bottom-24 right-4 md:right-6 z-40\n        w-11 h-11 md:w-12 md:h-12 rounded-full min-w-[44px] min-h-[44px]\n        bg-gradient-to-br from-primary-500 to-secondary-700\n        text-white shadow-lg\n        flex items-center justify-center\n        transition-all duration-300\n        hover:scale-110 hover:shadow-xl\n        active:scale-95\n        animate-fade-in-up\n        focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n      \"\n      aria-label=\"Vissza a tetejre\"\n      title=\"Vissza a tetejre\"\n    >\n      <ArrowUp className=\"w-5 h-5 md:w-6 md:h-6\" />\n      \n      {/* Pulse animation ring */}\n      <span className=\"absolute inset-0 rounded-full bg-primary-500 opacity-0 animate-ping\" />\n    </button>\n  );\n};\n\nexport default BackToTop;\n","/**\n * Framer-motion shim - CSS transition based replacements\n * Fixes Vite production build TDZ issues with framer-motion\n */\nimport React, { forwardRef } from 'react';\n\n// Motion component - just renders with CSS transitions\nconst createMotionComponent = (tag) => {\n  return forwardRef(({ \n    children, \n    initial, \n    animate, \n    exit, \n    transition,\n    whileHover,\n    whileTap,\n    variants,\n    className = '',\n    style = {},\n    ...props \n  }, ref) => {\n    const Tag = tag;\n    return (\n      <Tag\n        ref={ref}\n        className={`transition-all duration-300 ${className}`}\n        style={style}\n        {...props}\n      >\n        {children}\n      </Tag>\n    );\n  });\n};\n\nexport const motion = {\n  div: createMotionComponent('div'),\n  span: createMotionComponent('span'),\n  button: createMotionComponent('button'),\n  a: createMotionComponent('a'),\n  ul: createMotionComponent('ul'),\n  li: createMotionComponent('li'),\n  p: createMotionComponent('p'),\n  h1: createMotionComponent('h1'),\n  h2: createMotionComponent('h2'),\n  h3: createMotionComponent('h3'),\n  section: createMotionComponent('section'),\n  article: createMotionComponent('article'),\n  nav: createMotionComponent('nav'),\n  aside: createMotionComponent('aside'),\n  img: createMotionComponent('img'),\n};\n\n// AnimatePresence - just renders children\nexport const AnimatePresence = ({ children, mode, initial, onExitComplete }) => {\n  return <>{children}</>;\n};\n\nexport default motion;\n","import React, { useState, useEffect } from 'react';\nimport { Eye, ShoppingBag, TrendingUp, Users } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * LiveSocialProof - Real-time social proof notifications\n * Shows viewer count, recent purchases, trending items\n */\nconst LiveSocialProof = ({ currentProduct, recentPurchases = [] }) => {\n  const [viewerCount, setViewerCount] = useState(0);\n  const [showNotification, setShowNotification] = useState(false);\n  const [currentNotification, setCurrentNotification] = useState(null);\n\n  // Generate realistic viewer count\n  useEffect(() => {\n    const baseViewers = Math.floor(Math.random() * 30) + 15; // 15-45\n    setViewerCount(baseViewers);\n\n    const interval = setInterval(() => {\n      setViewerCount(prev => {\n        const change = Math.floor(Math.random() * 5) - 2; // -2 to +2\n        return Math.max(10, Math.min(50, prev + change));\n      });\n    }, 10000); // Update every 10s\n\n    return () => clearInterval(interval);\n  }, [currentProduct]);\n\n  // Show at most ONE notification per product view (after 5s), no repeated spam\n  useEffect(() => {\n    if (!currentProduct) {\n      setShowNotification(false);\n      setCurrentNotification(null);\n      return;\n    }\n\n    const notifications = [\n      {\n        icon: ShoppingBag,\n        text: `\"${currentProduct.name}\" npszer vlaszts`,\n        time: '2 perce',\n        color: 'text-green-600',\n        bg: 'bg-green-50'\n      },\n      {\n        icon: TrendingUp,\n        text: `Ez a ${currentProduct.category} most npszer`,\n        time: 'pp most',\n        color: 'text-orange-600',\n        bg: 'bg-orange-50'\n      },\n      {\n        icon: Users,\n        text: `${Math.floor(Math.random() * 10) + 5} ember nzi most`,\n        time: 'l',\n        color: 'text-blue-600',\n        bg: 'bg-blue-50'\n      }\n    ];\n\n    const random = notifications[Math.floor(Math.random() * notifications.length)];\n    setCurrentNotification(random);\n\n    // Single notification 5s after viewing this product; no interval\n    const t = setTimeout(() => {\n      setShowNotification(true);\n      setTimeout(() => setShowNotification(false), 5000);\n    }, 5000);\n\n    return () => {\n      clearTimeout(t);\n      setShowNotification(false);\n    };\n  }, [currentProduct?.id]);\n\n  return (\n    <>\n      {/* Floating Viewer Counter */}\n      {currentProduct && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"fixed bottom-[calc(10rem+44px)] md:bottom-40 left-4 md:left-6 z-40 bg-white rounded-full shadow-lg px-3 md:px-4 py-1.5 md:py-2 flex items-center gap-2\"\n        >\n          <div className=\"relative\">\n            <Eye className=\"w-5 h-5 text-primary-500\" />\n            <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold text-gray-800\">{viewerCount} ember</p>\n            <p className=\"text-xs text-gray-500\">nzi most</p>\n          </div>\n        </motion.div>\n      )}\n\n      {/* Notification Toasts */}\n      <AnimatePresence>\n        {showNotification && currentNotification && (\n          <motion.div\n            initial={{ opacity: 0, y: 50, scale: 0.9 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 50, scale: 0.9 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n            className={`\n              fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-2 md:left-6 z-50\n              max-w-[calc(100vw-1rem)] md:max-w-sm rounded-xl shadow-2xl p-3 md:p-4\n              ${currentNotification.bg} border border-gray-200\n              backdrop-blur-sm\n            `}\n          >\n            <div className=\"flex items-start gap-3\">\n              <div className={`p-2 rounded-lg ${currentNotification.color} bg-white/50`}>\n                <currentNotification.icon className=\"w-5 h-5\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-gray-800\">\n                  {currentNotification.text}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {currentNotification.time}\n                </p>\n              </div>\n              <button\n                onClick={() => setShowNotification(false)}\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                aria-label=\"Bezrs\"\n              >\n                \n              </button>\n            </div>\n\n            {/* Progress bar */}\n            <motion.div\n              initial={{ width: '100%' }}\n              animate={{ width: '0%' }}\n              transition={{ duration: 5, ease: 'linear' }}\n              className=\"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-primary-500 to-secondary-600 rounded-bl-xl\"\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  );\n};\n\nexport default LiveSocialProof;\n","import React, { useState, useEffect } from 'react';\nimport { Circle, Users } from 'lucide-react';\n\n/**\n * LiveActivityStrip  \"X vsrl most bngsz\" social proof.\n * Random szm 525, enyhe animci.\n */\nconst MIN_VIEWERS = 5;\nconst MAX_VIEWERS = 25;\n\nfunction getRandomViewers() {\n  return Math.floor(Math.random() * (MAX_VIEWERS - MIN_VIEWERS + 1)) + MIN_VIEWERS;\n}\n\nexport default function LiveActivityStrip({ className = '' }) {\n  const [viewers, setViewers] = useState(() => getRandomViewers());\n\n  useEffect(() => {\n    const t = setInterval(() => {\n      setViewers((prev) => {\n        const delta = Math.random() > 0.5 ? 1 : -1;\n        const next = prev + delta;\n        return Math.max(MIN_VIEWERS, Math.min(MAX_VIEWERS, next));\n      });\n    }, 4000 + Math.random() * 4000);\n    return () => clearInterval(t);\n  }, []);\n\n  return (\n    <div\n      className={`flex items-center gap-2 text-sm text-gray-600 ${className}`}\n      role=\"status\"\n      aria-live=\"polite\"\n      aria-label={`${viewers} vsrl jelenleg bngsz`}\n    >\n      <Circle className=\"w-2 h-2 text-emerald-500 fill-emerald-500 shrink-0 animate-pulse\" aria-hidden />\n      <Users className=\"w-4 h-4 text-gray-400 shrink-0\" aria-hidden />\n      <span>\n        <strong className=\"text-gray-900 font-semibold\">{viewers}</strong> vsrl most bngsz\n      </span>\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\n\n/**\n * CountUp animation component\n * Counts from 0 to target value with easing\n */\nexport const CountUp = ({ end, duration = 2000, suffix = '', decimals = 0, start = 0, delay = 0 }) => {\n  const [count, setCount] = useState(start);\n  const [isVisible, setIsVisible] = useState(false);\n  const countRef = useRef(null);\n  const hasStarted = useRef(false);\n\n  useEffect(() => {\n    const element = countRef.current;\n    if (!element) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted.current) {\n          hasStarted.current = true;\n          setTimeout(() => setIsVisible(true), delay);\n        }\n      },\n      { threshold: 0.1 }\n    );\n\n    observer.observe(element);\n    return () => observer.disconnect();\n  }, [delay]);\n\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const startTime = Date.now();\n    const diff = end - start;\n\n    const easeOutQuad = (t) => t * (2 - t);\n\n    const timer = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const easedProgress = easeOutQuad(progress);\n      const current = start + diff * easedProgress;\n\n      setCount(current);\n\n      if (progress === 1) {\n        clearInterval(timer);\n      }\n    }, 16); // ~60fps\n\n    return () => clearInterval(timer);\n  }, [isVisible, end, start, duration]);\n\n  const formatNumber = (num) => {\n    if (decimals > 0) {\n      return num.toFixed(decimals);\n    }\n    return Math.floor(num).toLocaleString('hu-HU');\n  };\n\n  return (\n    <span ref={countRef}>\n      {formatNumber(count)}\n      {suffix}\n    </span>\n  );\n};\n\nexport default CountUp;\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Search, Sparkles, Camera, ArrowRight, Wand2, X, Package, CheckCircle2, TrendingUp, ChevronRight, Plus, SlidersHorizontal, BrainCircuit, RotateCcw, Filter, Award, Lightbulb } from 'lucide-react';\nimport {\n  buildSearchIndex,\n  getAutocompleteSuggestions,\n  getProactiveSuggestions,\n  parseSearchIntent,\n  smartSearch\n} from '../../services/aiSearchService';\nimport { trackSearch, trackSectionEvent, getSearchHistory, getViewedProducts, getLikedProducts } from '../../services/userPreferencesService';\nimport { formatPrice as formatPriceHu } from '../../utils/helpers';\n\nconst QUICK_INTENTS = [\n  'bzs kanap 100e alatt',\n  'kis nappaliba fotel',\n  'skandinv stlus komd',\n  'gyors szlltssal'\n];\n\nconst SUCCESSFUL_SEARCHES_KEY = 'mkt_successful_hero_searches';\nconst SEARCH_DEBOUNCE_MS = 180;\nconst LONG_PRESS_MS = 450;\n\nconst QUICK_FILTER_PRESETS = {\n  r: ['80e alatt', '120e alatt', '180e alatt'],\n  Stlus: ['modern', 'skandinv', 'minimalista'],\n  Helyisg: ['nappaliba', 'hlszobba', 'elszobba']\n};\nconst PROACTIVE_QUICK = getProactiveSuggestions().map((item) => item.query);\n\nconst escapeRegExp = (value = '') => value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\nexport default function HeroSmartSearch({\n  products = [],\n  onSearch,\n  onTryAI,\n  variant = 'A',\n  onOpenProductQuickView\n}) {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [didSearch, setDidSearch] = useState(false);\n  const [dismissedFilterIds, setDismissedFilterIds] = useState([]);\n  const [compareProducts, setCompareProducts] = useState([]);\n  const [searchJourney, setSearchJourney] = useState([]);\n  const [showRewriteOptions, setShowRewriteOptions] = useState(false);\n  const [showQuickFilterPanel, setShowQuickFilterPanel] = useState(false);\n  const [likedProductIds, setLikedProductIds] = useState([]);\n  const [viewedProductIds, setViewedProductIds] = useState([]);\n  const [preferredCategories, setPreferredCategories] = useState([]);\n  const [preferredKeywords, setPreferredKeywords] = useState([]);\n  const [searchPulse, setSearchPulse] = useState(false);\n  const [resultCountPulse, setResultCountPulse] = useState(false);\n  const [hoverCard, setHoverCard] = useState({ id: null, rx: 0, ry: 0 });\n  const [smartResults, setSmartResults] = useState([]);\n  const [smartTotalMatches, setSmartTotalMatches] = useState(0);\n  const [isIndexBuilding, setIsIndexBuilding] = useState(false);\n  const [previewProduct, setPreviewProduct] = useState(null);\n  const [previewAnchor, setPreviewAnchor] = useState(null);\n  const instantSearchRef = useRef('');\n  const longPressTimerRef = useRef(null);\n\n  const trimmedQuery = query.trim();\n\n  const suggestions = useMemo(() => {\n    if (trimmedQuery.length < 2 || !Array.isArray(products) || products.length === 0) return [];\n    const local = getAutocompleteSuggestions(products, trimmedQuery, 6) || [];\n    return local;\n  }, [products, trimmedQuery]);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!Array.isArray(products) || products.length === 0) return () => { cancelled = true; };\n    setIsIndexBuilding(true);\n    buildSearchIndex(products)\n      .catch(() => false)\n      .finally(() => {\n        if (!cancelled) setIsIndexBuilding(false);\n      });\n    return () => { cancelled = true; };\n  }, [products]);\n\n  // Debounced query for expensive smartSearch\n  const [debouncedQuery, setDebouncedQuery] = useState(trimmedQuery);\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      const t = setTimeout(() => setDebouncedQuery(''), SEARCH_DEBOUNCE_MS);\n      return () => clearTimeout(t);\n    }\n    const t = setTimeout(() => setDebouncedQuery(trimmedQuery), SEARCH_DEBOUNCE_MS);\n    return () => clearTimeout(t);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (!Array.isArray(products) || products.length === 0) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      return;\n    }\n    if (debouncedQuery.length < 2) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      return;\n    }\n\n    const result = smartSearch(products, debouncedQuery, { limit: 24 });\n    const nextResults = result?.results || [];\n    const nextTotal = result?.totalMatches || 0;\n    setSmartResults(nextResults);\n    setSmartTotalMatches(nextTotal);\n    setResultCountPulse(true);\n  }, [products, debouncedQuery]);\n\n  useEffect(() => {\n    if (!resultCountPulse) return;\n    const t = setTimeout(() => setResultCountPulse(false), 500);\n    return () => clearTimeout(t);\n  }, [resultCountPulse]);\n\n  const queryTokens = useMemo(() => (\n    trimmedQuery\n      .toLowerCase()\n      .split(/[\\s,/-]+/)\n      .map((t) => t.trim())\n      .filter((t) => t.length >= 2)\n      .slice(0, 4)\n  ), [trimmedQuery]);\n\n  const intent = useMemo(() => {\n    if (trimmedQuery.length < 3) return null;\n    return parseSearchIntent(trimmedQuery);\n  }, [trimmedQuery]);\n\n  const parsedFilters = useMemo(() => {\n    if (!intent) return [];\n    const filters = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      const value = String(intent.productTypes[0]);\n      filters.push({ id: `product-${value}`, label: 'termk', value, rawValue: value });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      const value = String(intent.styles[0]);\n      filters.push({ id: `style-${value}`, label: 'stlus', value, rawValue: value });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      const value = String(intent.colors[0]);\n      filters.push({ id: `color-${value}`, label: 'szn', value, rawValue: value });\n    }\n    if (intent.priceRange?.max && Number.isFinite(intent.priceRange.max)) {\n      const value = `max ${Math.round(intent.priceRange.max / 1000)}k`;\n      filters.push({ id: 'price-max', label: 'r', value, rawValue: 'alatt' });\n    } else if (intent.priceRange?.min) {\n      const value = `min ${Math.round(intent.priceRange.min / 1000)}k`;\n      filters.push({ id: 'price-min', label: 'r', value, rawValue: 'felett' });\n    }\n    if (intent.isOnSale) filters.push({ id: 'sale', label: 'md', value: 'akcis', rawValue: 'akci' });\n    return filters.slice(0, 5);\n  }, [intent]);\n\n  const activeFilters = useMemo(\n    () => parsedFilters.filter((f) => !dismissedFilterIds.includes(f.id)),\n    [parsedFilters, dismissedFilterIds]\n  );\n\n  const queryMatchedProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0 || trimmedQuery.length < 2) return [];\n    if (smartResults.length > 0) return smartResults.slice(0, 40);\n    return products\n      .filter((p) => {\n        const haystack = `${p?.name || ''} ${p?.category || ''}`.toLowerCase();\n        return queryTokens.some((token) => haystack.includes(token));\n      })\n      .slice(0, 30);\n  }, [products, trimmedQuery, queryTokens, smartResults]);\n\n  const rankedQueryProducts = useMemo(() => {\n    if (queryMatchedProducts.length === 0) return [];\n\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n\n    return queryMatchedProducts\n      .map((product) => {\n        const name = String(product?.name || '').toLowerCase();\n        const categoryFull = String(product?.category || '').toLowerCase();\n        const categoryLeaf = categoryFull.split('>').pop()?.trim() || '';\n        let score = 0;\n\n        queryTokens.forEach((token) => {\n          if (name.includes(token)) score += 20;\n          if (categoryFull.includes(token)) score += 12;\n          if (preferredKeywords.some((kw) => token.includes(kw) || kw.includes(token))) score += 6;\n        });\n\n        if (preferredCategories.some((cat) => categoryFull.includes(cat.toLowerCase()))) score += 15;\n        if (categoryLeaf && preferredCategories.some((cat) => categoryLeaf.includes(cat.toLowerCase()))) score += 10;\n        if (likedSet.has(String(product?.id))) score += 40;\n        if (viewedSet.has(String(product?.id))) score += 12;\n\n        return { product, score };\n      })\n      .sort((a, b) => b.score - a.score)\n      .map((entry) => entry.product);\n  }, [queryMatchedProducts, queryTokens, preferredKeywords, preferredCategories, likedProductIds, viewedProductIds]);\n\n  const previewProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n\n    const byAutocomplete = suggestions\n      .filter((s) => s?.type === 'product' && s?.product)\n      .map((s) => s.product);\n\n    const merged = [...byAutocomplete, ...rankedQueryProducts];\n    const unique = [];\n    const seen = new Set();\n    for (const item of merged) {\n      const id = String(item?.id ?? item?.sku ?? item?.name ?? '');\n      if (!id || seen.has(id)) continue;\n      seen.add(id);\n      unique.push(item);\n      if (unique.length >= 10) break;\n    }\n    return unique;\n  }, [products, suggestions, rankedQueryProducts]);\n\n  const starterProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n    const scored = products.map((p) => {\n      const id = String(p?.id || '');\n      const category = String(p?.category || '').toLowerCase();\n      let score = 0;\n      if (likedSet.has(id)) score += 40;\n      if (viewedSet.has(id)) score += 20;\n      if (preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()))) score += 14;\n      if (Number(p?.salePrice || p?.price || 0) > 0) score += 6;\n      return { p, score };\n    });\n    return scored.sort((a, b) => b.score - a.score).slice(0, 10).map((entry) => entry.p);\n  }, [products, likedProductIds, viewedProductIds, preferredCategories]);\n\n  const contextualSuggestions = useMemo(() => {\n    if (rankedQueryProducts.length === 0) return [];\n    const categoryMap = new Map();\n    rankedQueryProducts.forEach((p) => {\n      const category = String(p?.category || '').split('>').pop()?.trim();\n      if (!category) return;\n      categoryMap.set(category, (categoryMap.get(category) || 0) + 1);\n    });\n    return [...categoryMap.entries()]\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3)\n      .map(([category]) => `${category} akci`);\n  }, [rankedQueryProducts]);\n\n  const actualResultCount = useMemo(() => {\n    if (trimmedQuery.length < 2) return null;\n    if (smartTotalMatches > 0) return smartTotalMatches;\n    return rankedQueryProducts.length;\n  }, [trimmedQuery, smartTotalMatches, rankedQueryProducts.length]);\n\n  const confidenceScore = useMemo(() => {\n    if (actualResultCount === null) return 0;\n    return Math.max(0, Math.min(100, Math.round((Math.min(actualResultCount, 24) / 24) * 100)));\n  }, [actualResultCount]);\n\n  const confidenceMeta = useMemo(() => {\n    if (actualResultCount === null) return { label: 'Kezdj el gpelni', tone: 'bg-gray-300' };\n    if (actualResultCount >= 18) return { label: `${actualResultCount} ers tallat`, tone: 'bg-emerald-500' };\n    if (actualResultCount >= 8) return { label: `${actualResultCount} relevns tallat`, tone: 'bg-amber-500' };\n    if (actualResultCount >= 1) return { label: `${actualResultCount} tallat`, tone: 'bg-orange-500' };\n    return { label: 'Nincs tallat', tone: 'bg-rose-500' };\n  }, [actualResultCount]);\n\n  const dynamicQuickSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [...PROACTIVE_QUICK, ...QUICK_INTENTS].slice(0, 6);\n    const base = [];\n    const firstToken = queryTokens[0];\n    if (firstToken) {\n      base.push(`${firstToken} akcis`);\n      base.push(`modern ${firstToken}`);\n      base.push(`${firstToken} gyors szlltssal`);\n      base.push(`${firstToken} 120e alatt`);\n    }\n    if (Array.isArray(intent?.styles) && intent.styles[0]) {\n      base.push(`${intent.styles[0]} stlus btor`);\n    }\n    if (Array.isArray(intent?.colors) && intent.colors[0]) {\n      base.push(`${intent.colors[0]} nappali`);\n    }\n    const unique = [];\n    const seen = new Set();\n    [...base, ...contextualSuggestions, ...PROACTIVE_QUICK, ...QUICK_INTENTS].forEach((q) => {\n      const key = q.toLowerCase();\n      if (!seen.has(key) && q.trim().length >= 3) {\n        seen.add(key);\n        unique.push(q.trim());\n      }\n    });\n    return unique.slice(0, 6);\n  }, [trimmedQuery, queryTokens, intent, activeFilters.length, contextualSuggestions]);\n\n  const quickHitSuggestions = useMemo(() => {\n    return dynamicQuickSuggestions.slice(0, 8).map((text) => {\n      const t = text.toLowerCase();\n      let badge = { label: 'Kapcsold', classes: 'bg-gray-100 text-gray-700 border-gray-200' };\n      if (trimmedQuery.length >= 2 && t.includes(trimmedQuery.toLowerCase())) {\n        badge = { label: 'Pontos egyezs', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      } else if (Array.isArray(intent?.styles) && intent.styles.some((s) => t.includes(String(s).toLowerCase()))) {\n        badge = { label: 'Stlus egyezs', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n      } else if (Array.isArray(intent?.colors) && intent.colors.some((c) => t.includes(String(c).toLowerCase()))) {\n        badge = { label: 'Szn egyezs', classes: 'bg-sky-50 text-sky-700 border-sky-200' };\n      } else if (t.includes('alatt') || t.includes('akci')) {\n        badge = { label: 'r / akci', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      }\n      return { text, badge };\n    });\n  }, [dynamicQuickSuggestions, trimmedQuery, intent]);\n\n  const rewriteSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [];\n    const first = queryTokens[0] || 'btor';\n    const topCategories = rankedQueryProducts\n      .map((p) => String(p?.category || '').split('>').pop()?.trim())\n      .filter(Boolean)\n      .slice(0, 3);\n    const mainCategory = topCategories[0] || first;\n    const topStyle = Array.isArray(intent?.styles) && intent.styles[0] ? intent.styles[0] : 'modern';\n    const topColor = Array.isArray(intent?.colors) && intent.colors[0] ? intent.colors[0] : 'bzs';\n\n    return [\n      `${mainCategory} ${topStyle} stlusban`,\n      `${topColor} ${mainCategory} 120e alatt`,\n      `${mainCategory} prmium kivitelben gyors szlltssal`,\n      `${mainCategory} kisebb trbe, keskeny kivitel`\n    ];\n  }, [trimmedQuery, queryTokens, rankedQueryProducts, intent]);\n\n  const rewriteSuggestionsWithQuality = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n    return rewriteSuggestions.map((text) => {\n      const result = smartSearch(products, text, { limit: 12 });\n      const count = Number(result?.totalMatches || 0);\n      let quality = { label: 'Kzepes', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      if (count >= 16) quality = { label: 'Ers', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      else if (count <= 3) quality = { label: 'Szk', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n      return { text, count, quality };\n    });\n  }, [rewriteSuggestions, products]);\n\n  const intentTimeline = useMemo(() => {\n    if (!intent || trimmedQuery.length < 2) return [];\n    const timeline = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      timeline.push({ title: 'Termktpus felismerve', value: intent.productTypes[0], tone: 'bg-primary-50 border-primary-200 text-primary-700' });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      timeline.push({ title: 'Stlus felismerve', value: intent.styles[0], tone: 'bg-secondary-50 border-secondary-200 text-secondary-700' });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      timeline.push({ title: 'Szn preferencia', value: intent.colors[0], tone: 'bg-sky-50 border-sky-200 text-sky-700' });\n    }\n    if (intent.priceRange?.max || intent.priceRange?.min) {\n      const priceText = intent.priceRange?.max\n        ? `${Math.round((intent.priceRange.max || 0) / 1000)}k alatt`\n        : `${Math.round((intent.priceRange.min || 0) / 1000)}k felett`;\n      timeline.push({ title: 'rhatr', value: priceText, tone: 'bg-amber-50 border-amber-200 text-amber-700' });\n    }\n    timeline.push({ title: 'Tallati magabiztossg', value: `${actualResultCount ?? 0} tallat`, tone: 'bg-emerald-50 border-emerald-200 text-emerald-700' });\n    return timeline.slice(0, 5);\n  }, [intent, trimmedQuery, actualResultCount]);\n\n  const hasNoResults = trimmedQuery.length >= 2 && suggestions.length === 0;\n  const rescueSuggestions = useMemo(() => {\n    if (!hasNoResults) return [];\n    const q = trimmedQuery.toLowerCase();\n    const base = [];\n    if (q.includes('alatt')) base.push(q.replace(/(\\d+\\s*(e|ez|ezer|k).*)/i, '').trim());\n    if (q.includes('olcs')) base.push(q.replace('olcs', ''));\n    base.push(`${trimmedQuery} akci`);\n    base.push(`${trimmedQuery} modern`);\n    return base.map((v) => v.trim()).filter((v) => v.length >= 3).slice(0, 3);\n  }, [hasNoResults, trimmedQuery]);\n\n  const triggerFullSearch = (inputQuery, source = 'submit') => {\n    const safeQuery = String(inputQuery || '').trim();\n    if (!safeQuery) return;\n    onSearch?.(safeQuery, { source });\n    setIsOpen(false);\n  };\n\n  const handleSubmit = (e) => {\n    e?.preventDefault?.();\n    if (!trimmedQuery) return;\n    setIsSearching(true);\n    setDidSearch(true);\n    trackSearch(trimmedQuery);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'submit');\n    setSearchPulse(true);\n    instantSearchRef.current = trimmedQuery;\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: trimmedQuery, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== trimmedQuery.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    triggerFullSearch(trimmedQuery, 'submit');\n    setTimeout(() => {\n      setIsSearching(false);\n      setIsOpen(false);\n    }, 350);\n  };\n\n  const applySuggestion = (text, opts = {}) => {\n    if (!text) return;\n    const { submit = true, source = 'suggestion' } = opts;\n    setQuery(text);\n    setDidSearch(true);\n    trackSearch(text);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'suggestion');\n    setSearchPulse(true);\n    instantSearchRef.current = text.trim();\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: text, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== text.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    if (submit) {\n      triggerFullSearch(text, source);\n      return;\n    }\n    setIsOpen(true);\n  };\n\n  const handlePreviewProductClick = (product) => {\n    const name = product?.name || '';\n    if (!name || !product) return;\n    trackSectionEvent(`hero-search-${variant}`, 'click', String(product?.id || 'preview-product'));\n    onOpenProductQuickView?.(product);\n  };\n\n  const removeFilter = (filter) => {\n    if (!filter?.id) return;\n    setDismissedFilterIds((prev) => (prev.includes(filter.id) ? prev : [...prev, filter.id]));\n    if (!filter.rawValue) return;\n    const raw = filter.rawValue.trim();\n    if (!raw) return;\n    setQuery((prev) => prev.replace(new RegExp(escapeRegExp(raw), 'ig'), '').replace(/\\s{2,}/g, ' ').trim());\n  };\n\n  const clearAllFilters = () => {\n    setDismissedFilterIds(parsedFilters.map((f) => f.id));\n  };\n\n  const removeFromHistory = (queryToRemove) => {\n    const key = String(queryToRemove || '').toLowerCase();\n    if (!key) return;\n    setSearchJourney((prev) => {\n      const next = prev\n        .map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x))\n        .filter((x) => (x.q || x).toLowerCase() !== key);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n  };\n\n  const toggleCompareProduct = (product) => {\n    if (!product?.id) return;\n    setCompareProducts((prev) => {\n      const exists = prev.some((p) => String(p.id) === String(product.id));\n      if (exists) return prev.filter((p) => String(p.id) !== String(product.id));\n      const next = [...prev, product].slice(-3);\n      return next;\n    });\n    trackSectionEvent(`hero-search-${variant}`, 'click', `compare-${product.id}`);\n  };\n\n  const runCompareSearch = () => {\n    if (compareProducts.length < 2) return;\n    const composed = compareProducts.map((p) => p?.name).filter(Boolean).join(' vs ');\n    applySuggestion(composed);\n  };\n\n  const applyRewrite = (text) => {\n    if (!text) return;\n    setQuery(text);\n    setShowRewriteOptions(false);\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'rewrite');\n  };\n\n  const applyQuickFilterToken = (token) => {\n    if (!token) return;\n    const normalized = String(token).trim();\n    if (!normalized) return;\n    setQuery((prev) => {\n      const base = prev.trim();\n      if (!base) return normalized;\n      if (base.toLowerCase().includes(normalized.toLowerCase())) return base;\n      return `${base} ${normalized}`.trim();\n    });\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', `quick-filter-${normalized}`);\n  };\n\n  const formatPrice = (value) => {\n    const amount = Number(value || 0);\n    return amount > 0 ? formatPriceHu(value) : 'r hamarosan';\n  };\n\n  const getProductImage = (product) => {\n    if (!product) return '';\n    return product.image || product.images?.[0] || product.thumbnail || '';\n  };\n\n  const isPersonalMatch = (product) => {\n    const category = String(product?.category || '').toLowerCase();\n    const id = String(product?.id || '');\n    if (likedProductIds.includes(id)) return true;\n    return preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()));\n  };\n\n  const getTopBadge = (product, index) => {\n    if (likedProductIds.includes(String(product?.id || ''))) {\n      return { text: 'Kedvenc tallat', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n    }\n    if (isPersonalMatch(product)) {\n      return { text: 'Neked ajnlott', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n    }\n    if (index === 0) return { text: 'Top #1', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n    if (index === 1) return { text: 'Top #2', classes: 'bg-blue-50 text-blue-700 border-blue-200' };\n    if (index === 2) return { text: 'Top #3', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n    return { text: 'Ajnlott', classes: 'bg-gray-50 text-gray-700 border-gray-200' };\n  };\n\n  const handleCardMouseMove = (event, productId) => {\n    const rect = event.currentTarget.getBoundingClientRect();\n    const px = (event.clientX - rect.left) / rect.width;\n    const py = (event.clientY - rect.top) / rect.height;\n    const rx = (0.5 - py) * 6;\n    const ry = (px - 0.5) * 8;\n    setHoverCard({ id: String(productId), rx, ry });\n  };\n\n  const displayedTopProducts = trimmedQuery.length < 2 ? starterProducts : previewProducts;\n\n  const historyGrouped = useMemo(() => {\n    const list = searchJourney.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n    if (list.length === 0) return { today: [], earlier: [] };\n    const startOfToday = new Date();\n    startOfToday.setHours(0, 0, 0, 0);\n    const startTs = startOfToday.getTime();\n    const today = list.filter((x) => (x.t || 0) >= startTs);\n    const earlier = list.filter((x) => (x.t || 0) < startTs);\n    return { today, earlier };\n  }, [searchJourney]);\n\n  useEffect(() => {\n    setDismissedFilterIds([]);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      setIsSearching(false);\n      return undefined;\n    }\n\n    const timer = setTimeout(() => {\n      if (instantSearchRef.current === trimmedQuery) {\n        setIsSearching(false);\n        return;\n      }\n      instantSearchRef.current = trimmedQuery;\n      setDidSearch(true);\n      setIsSearching(true);\n      trackSectionEvent(`hero-search-${variant}`, 'click', 'instant');\n      setTimeout(() => setIsSearching(false), 180);\n    }, 220);\n\n    return () => clearTimeout(timer);\n  }, [trimmedQuery, variant]);\n\n  useEffect(() => {\n    if (trimmedQuery.length >= 1) {\n      setIsOpen(true);\n    }\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      setPreviewProduct(null);\n      setPreviewAnchor(null);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!searchPulse) return undefined;\n    const timer = setTimeout(() => setSearchPulse(false), 650);\n    return () => clearTimeout(timer);\n  }, [searchPulse]);\n\n  useEffect(() => {\n    try {\n      const liked = getLikedProducts().map((id) => String(id));\n      const viewed = getViewedProducts(30);\n      const viewedIds = viewed.map((item) => String(item?.id)).filter(Boolean);\n      const categoryCounter = new Map();\n      const keywordCounter = new Map();\n\n      viewed.forEach((item) => {\n        const category = String(item?.category || '').split('>').pop()?.trim();\n        if (category) {\n          categoryCounter.set(category, (categoryCounter.get(category) || 0) + 1);\n        }\n        String(item?.name || '')\n          .toLowerCase()\n          .split(/[\\s,/-]+/)\n          .map((token) => token.trim())\n          .filter((token) => token.length >= 4)\n          .forEach((token) => keywordCounter.set(token, (keywordCounter.get(token) || 0) + 1));\n      });\n\n      const topCategories = [...categoryCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 4)\n        .map(([name]) => name);\n      const topKeywords = [...keywordCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 6)\n        .map(([name]) => name);\n\n      setLikedProductIds(liked);\n      setViewedProductIds(viewedIds);\n      setPreferredCategories(topCategories);\n      setPreferredKeywords(topKeywords);\n    } catch {\n      setLikedProductIds([]);\n      setViewedProductIds([]);\n      setPreferredCategories([]);\n      setPreferredKeywords([]);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      const stored = JSON.parse(localStorage.getItem(SUCCESSFUL_SEARCHES_KEY) || '[]');\n      const history = getSearchHistory(6).map((entry) => entry?.query).filter(Boolean);\n      const storedNorm = Array.isArray(stored)\n        ? stored.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : { q: x.q || x, t: x.t || 0 }))\n        : [];\n      const merged = [...storedNorm];\n      history.forEach((q) => {\n        const key = String(q).toLowerCase();\n        if (!merged.some((x) => (x.q || x).toLowerCase() === key)) merged.push({ q, t: 0 });\n      });\n      const unique = [];\n      const seen = new Set();\n      merged.forEach((item) => {\n        const q = item.q || item;\n        const key = String(q).toLowerCase();\n        if (!seen.has(key)) {\n          seen.add(key);\n          unique.push(typeof item === 'object' && item && 'q' in item ? item : { q, t: 0 });\n        }\n      });\n      setSearchJourney(unique.slice(0, 6));\n    } catch {\n      setSearchJourney([]);\n    }\n  }, []);\n\n  return (\n    <section\n      className=\"mb-8 sm:mb-12 min-w-0 w-full max-w-full\"\n      style={{ touchAction: 'pan-y' }}\n      aria-label=\"AI Keres\"\n    >\n      <div className=\"relative w-full max-w-none mx-auto animate-fade-in\">\n        <div className=\"pointer-events-none absolute inset-x-0 -top-16 h-44 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.18),transparent_65%)] blur-2xl\" aria-hidden />\n        <div className=\"pointer-events-none absolute inset-x-0 -bottom-24 h-60 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.14),transparent_70%)] blur-3xl\" aria-hidden />\n\n        <div className=\"relative rounded-xl sm:rounded-2xl overflow-hidden bg-white border border-gray-200 shadow-lg animate-scale-in\">\n          {/* ExitIntentPopup-style header bar with gradient + blobs */}\n          <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-5 sm:p-6 lg:p-7 text-center relative overflow-hidden\">\n            <div className=\"absolute inset-0 overflow-hidden pointer-events-none\" aria-hidden>\n              <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob motion-reduce:animate-none\" />\n              <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n            </div>\n            <div className=\"relative flex items-center justify-center sm:justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-14 h-14 sm:w-16 sm:h-16 bg-white/25 rounded-full flex items-center justify-center shrink-0 shadow-lg\">\n                  <Sparkles className=\"w-7 h-7 sm:w-8 sm:h-8 text-white\" aria-hidden />\n                </div>\n                <div className=\"text-left\">\n                  <h2 className=\"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-sm\">\n                    AI Keres\n                  </h2>\n                  <p className=\"text-white text-sm sm:text-base font-semibold mt-0.5\">\n                    rj termszetesen, tallj gyorsan\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"relative z-10 px-4 py-4 sm:p-6 lg:px-8 lg:py-7 bg-white\">\n            <div className=\"mb-4 flex flex-wrap items-center justify-between gap-2\">\n              <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.16em] text-primary-700 shadow-sm\">\n                <Sparkles className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                Next Search Stage\n              </span>\n              <span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-[11px] font-bold uppercase tracking-[0.13em] ${isIndexBuilding ? 'border-amber-200 bg-amber-50 text-amber-800' : 'border-emerald-200 bg-emerald-50 text-emerald-800'}`}>\n                <span className={`h-1.5 w-1.5 rounded-full ${isIndexBuilding ? 'bg-amber-300 animate-pulse' : 'bg-emerald-300'}`} aria-hidden />\n                {isIndexBuilding ? 'Rendszer tanul' : 'Rendszer ksz'}\n              </span>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className={`relative rounded-[22px] sm:rounded-[28px] border-2 border-primary-200 bg-gradient-to-r from-primary-50/50 to-secondary-50/50 p-3 sm:p-4 shadow-sm transition-all duration-200 focus-within:ring-4 focus-within:ring-primary-200 focus-within:border-primary-300 ${searchPulse ? 'ring-4 ring-emerald-300/50' : ''}`}>\n                <div className=\"pointer-events-none absolute inset-x-6 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300/50 to-transparent\" aria-hidden />\n                <div className=\"flex flex-col gap-3 lg:flex-row lg:items-center\">\n                  <div className=\"flex min-w-0 flex-1 items-center gap-3 sm:gap-4\">\n                    <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-700 text-white shadow-md sm:h-12 sm:w-12\">\n                      <Search className=\"h-5 w-5 sm:h-6 sm:w-6\" aria-hidden />\n                    </div>\n                    <div className=\"min-w-0 flex-1\">\n                      <input\n                        type=\"search\"\n                        value={query}\n                        onChange={(e) => setQuery(e.target.value)}\n                        onFocus={() => setIsOpen(true)}\n                        placeholder=\"Mit keresel? pl. bzs kanap 100e alatt, skandinv komd...\"\n                        className=\"w-full min-h-[50px] bg-transparent text-lg font-semibold tracking-[-0.01em] text-gray-900 outline-none placeholder:text-gray-500 sm:min-h-[58px] sm:text-[1.34rem] lg:min-h-[48px] lg:text-[1.15rem] xl:text-[1.28rem]\"\n                        aria-label=\"Keress a teljes katalgusban\"\n                        autoComplete=\"off\"\n                      />\n                      <p className=\"mt-1 text-xs text-gray-600 sm:text-sm\">\n                        rj termszetesen: termk + stlus + helyisg + rkeret\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2 sm:gap-3\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowQuickFilterPanel((prev) => !prev)}\n                      className={`min-h-[48px] rounded-xl border px-4 text-sm font-semibold transition-all touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5 ${showQuickFilterPanel ? 'border-primary-400 bg-primary-100 text-primary-800' : 'border-gray-300 bg-white text-gray-700 hover:border-primary-300 hover:bg-primary-50'}`}\n                      title=\"Gyors szrk\"\n                      aria-expanded={showQuickFilterPanel}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Filter className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Szrk</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"min-h-[48px] rounded-xl border border-secondary-200 bg-secondary-50 px-4 text-sm font-semibold text-secondary-800 transition-all hover:bg-secondary-100 touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5\"\n                      title=\"Kpbl keress\"\n                      aria-label=\"Kpbl keress\"\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Camera className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Kpbl</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"submit\"\n                      className=\"min-h-[48px] flex-1 rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 px-5 text-base font-bold text-white shadow-[0_10px_26px_rgba(255,138,0,0.38)] transition-all hover:-translate-y-0.5 hover:shadow-[0_14px_34px_rgba(255,138,0,0.48)] active:scale-[0.98] touch-manipulation sm:min-h-[54px] sm:flex-none sm:rounded-full sm:px-7\"\n                      aria-busy={isSearching}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        {isSearching ? (\n                          <span className=\"h-5 w-5 shrink-0 animate-spin rounded-full border-2 border-white/80 border-t-transparent\" aria-hidden />\n                        ) : (\n                          <ArrowRight className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        )}\n                        <span>{isSearching ? 'Keres...' : 'Keress'}</span>\n                      </span>\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                      <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-xs font-semibold text-primary-700 shadow-sm\">\n                    <Wand2 className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                    AI md\n                  </span>\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-xs font-semibold text-secondary-700\">\n                    <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                    Smart intent parsing\n                  </span>\n                </div>\n                {actualResultCount != null && trimmedQuery.length >= 2 && (\n                  <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1 text-sm font-bold text-primary-800 tabular-nums shadow-sm\">\n                    <span className=\"h-2 w-2 rounded-full bg-primary-500\" aria-hidden />\n                    {actualResultCount} tallat\n                  </span>\n                )}\n              </div>\n\n              <div className=\"pt-1\">\n                <p className=\"mb-2 text-[11px] font-extrabold uppercase tracking-[0.14em] text-gray-500\">Gyors parancsok</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-1 [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {dynamicQuickSuggestions.slice(0, 6).map((text) => (\n                    <button\n                      key={`hero-chip-${text}`}\n                      type=\"button\"\n                      onClick={() => applySuggestion(text, { submit: true, source: 'hero-chip' })}\n                      className=\"whitespace-nowrap inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-800 shadow-sm transition-all hover:-translate-y-0.5 hover:border-primary-300 hover:bg-primary-50 hover:text-primary-700 sm:text-sm\"\n                    >\n                      <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                      {text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2 border-t border-gray-200 pt-3\">\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-gray-600\">\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Enter</kbd>\n                  Keress\n                  <span className=\"text-gray-400\"></span>\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Esc</kbd>\n                  Bezrs\n                </div>\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-secondary-200 bg-secondary-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-secondary-700\">\n                  <Sparkles className=\"h-3.5 w-3.5 text-secondary-200\" aria-hidden />\n                  {actualResultCount != null && trimmedQuery.length >= 2 ? `${confidenceMeta.label}` : 'Adaptv AI ajnls'}\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n\n        {/* Tartalom  szrk, tallatok, stb. */}\n        <div className=\"relative z-10 mt-4 sm:mt-5 min-w-0 max-w-full\">\n          <div className=\"space-y-4 sm:space-y-5 lg:grid lg:grid-cols-12 lg:gap-4 lg:space-y-0\">\n          {showQuickFilterPanel && (\n            <div className=\"mt-3 lg:mt-0 rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-4 relative overflow-hidden w-full lg:col-span-6 shadow-sm animate-fade-in-up\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-primary-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-3\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Filter className=\"w-5 h-5\" aria-hidden /></span>\n                Gyors szrk\n              </p>\n              <div className=\"space-y-3\">\n                {Object.entries(QUICK_FILTER_PRESETS).map(([group, values]) => (\n                  <div key={group} className=\"flex flex-wrap items-center gap-2\">\n                    <span className=\"text-xs font-bold uppercase tracking-wide text-gray-600 min-w-14\">\n                      {group}\n                    </span>\n                    {values.map((value) => (\n                      <button\n                        key={`${group}-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-300 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                ))}\n                {preferredCategories.length > 0 && (\n                  <div className=\"flex flex-wrap items-center gap-2 pt-1\">\n                    <span className=\"text-xs font-semibold uppercase tracking-wide text-gray-600 min-w-14\">\n                      Neked\n                    </span>\n                    {preferredCategories.slice(0, 3).map((value) => (\n                      <button\n                        key={`fav-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-medium hover:bg-secondary-100 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {!isOpen && (\n          <>\n          {/* Pontossg  trust card */}\n          <div className=\"rounded-xl border border-emerald-200 bg-gradient-to-r from-emerald-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\" role=\"status\" aria-live=\"polite\">\n            <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-emerald-400 via-secondary-500 to-primary-500\" aria-hidden />\n            <div className=\"flex items-center justify-between gap-2 mb-2\">\n              <span className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-emerald-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Award className=\"w-5 h-5\" aria-hidden /></span>\n                Tallatok\n              </span>\n              <span className={`text-base font-bold text-emerald-800 tabular-nums transition-transform duration-300 ${resultCountPulse ? 'scale-110' : 'scale-100'}`}>{actualResultCount ?? 0}</span>\n            </div>\n            <div className=\"h-2 rounded-full bg-gray-200 overflow-hidden\">\n              <div className={`h-full rounded-full transition-all duration-300 ${confidenceMeta.tone}`} style={{ width: `${confidenceScore}%` }} />\n            </div>\n            {actualResultCount != null && (\n              <p className=\"mt-1.5 text-xs text-emerald-700\">{confidenceMeta.label}</p>\n            )}\n          </div>\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 lg:col-span-6\">\n              <button\n                type=\"button\"\n                onClick={() => triggerFullSearch(trimmedQuery, 'submit')}\n                className=\"w-full min-h-[48px] rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 text-white font-bold text-base shadow-[0_8px_22px_rgba(255,138,0,0.35)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.45)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 touch-manipulation\"\n              >\n                sszes tallat megnyitsa ({actualResultCount ?? 0})\n              </button>\n            </div>\n          )}\n\n          {activeFilters.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap gap-2 rounded-xl border border-sky-200 bg-gradient-to-r from-sky-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-sky-400 via-blue-500 to-secondary-500\" aria-hidden />\n              <span className=\"w-full flex items-center gap-2.5 mb-2 text-sm font-bold text-gray-800\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-sky-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><SlidersHorizontal className=\"w-5 h-5\" aria-hidden /></span>\n                Aktv szrk\n              </span>\n              {activeFilters.map((f) => (\n                <button\n                  key={f.id}\n                  type=\"button\"\n                  onClick={() => removeFilter(f)}\n                  className=\"inline-flex items-center gap-1.5 px-3 py-2 rounded-lg bg-white border border-sky-200 text-sky-800 text-sm font-medium hover:bg-sky-50 transition-colors touch-manipulation min-h-[40px]\"\n                >\n                  {f.label}: {f.value}\n                  <X className=\"w-3 h-3\" aria-hidden />\n                </button>\n              ))}\n              <button\n                type=\"button\"\n                onClick={clearAllFilters}\n                className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-700 text-sm font-medium hover:bg-gray-50 touch-manipulation min-h-[40px]\"\n              >\n                Szrk trlse\n              </button>\n            </div>\n          )}\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap items-center gap-2 rounded-xl border border-secondary-200 bg-gradient-to-r from-secondary-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-secondary-400 via-teal-500 to-primary-500\" aria-hidden />\n              <button\n                type=\"button\"\n                onClick={() => setShowRewriteOptions((prev) => !prev)}\n                className=\"inline-flex items-center gap-2.5 px-3 py-2 rounded-lg bg-white text-secondary-800 text-sm font-bold border border-secondary-200 hover:bg-secondary-50 transition-colors touch-manipulation min-h-[40px] shadow-sm\"\n              >\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-secondary-500 to-secondary-600 text-white flex items-center justify-center shrink-0 shadow-sm\"><BrainCircuit className=\"w-5 h-5\" aria-hidden /></span>\n                AI tfogalmazs\n              </button>\n              {showRewriteOptions && rewriteSuggestionsWithQuality.slice(0, 3).map((item) => (\n                <button\n                  key={item.text}\n                  type=\"button\"\n                  onClick={() => applyRewrite(item.text)}\n                  className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-white text-secondary-800 text-sm hover:bg-secondary-50 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                >\n                  <span>{item.text}</span>\n                  <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.quality.classes}`}>\n                    {item.quality.label}  {item.count}\n                  </span>\n                </button>\n              ))}\n            </div>\n          )}\n\n          {intentTimeline.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-indigo-200 bg-gradient-to-r from-indigo-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Lightbulb className=\"w-5 h-5\" aria-hidden /></span>\n                AI rtelmezs\n              </p>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                {intentTimeline.map((step, idx) => (\n                  <div key={`${step.title}-${idx}`} className=\"rounded-lg border px-3 py-2 bg-white border-indigo-200\">\n                    <p className=\"text-xs font-semibold uppercase tracking-wide opacity-90 text-indigo-600\">{step.title}</p>\n                    <p className=\"text-sm font-semibold mt-0.5 text-gray-900\">{step.value}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-gray-200 bg-gradient-to-r from-gray-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-12\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-gray-300 via-gray-400 to-primary-400\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><RotateCcw className=\"w-5 h-5\" aria-hidden /></span>\n                Elzmnyek\n              </p>\n              {historyGrouped.today.length > 0 && (\n                <div className=\"mb-2\">\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Ma</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.today.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`today-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              {historyGrouped.earlier.length > 0 && (\n                <div>\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Korbbi</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.earlier.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`earlier-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n        {didSearch && !isOpen && (\n          <div className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-50 text-emerald-800 text-sm font-semibold border border-emerald-200/80 lg:col-span-12\">\n            <CheckCircle2 className=\"w-4 h-4 text-emerald-600\" aria-hidden />\n            Keress elindtva\n          </div>\n        )}\n          </>\n        )}\n\n        {isOpen && (\n          <div\n            className=\"mt-4 lg:mt-0 rounded-xl sm:rounded-2xl border border-primary-200 bg-white overflow-hidden max-h-[70vh] sm:max-h-[65vh] overflow-y-auto overflow-x-hidden shadow-lg max-w-full min-w-0 w-full lg:col-span-12 animate-fade-in-up\"\n            style={{ WebkitOverflowScrolling: 'touch', touchAction: 'pan-y' }}\n            onScroll={() => {\n              setPreviewProduct(null);\n              setPreviewAnchor(null);\n            }}\n          >\n            <div className=\"sticky top-0 z-10 bg-gradient-to-r from-primary-50 to-secondary-50 border-b border-gray-200 rounded-t-xl px-4 py-3 min-h-[52px]\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <p className=\"text-base font-bold text-gray-800 flex items-center gap-2.5\">\n                  <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><TrendingUp className=\"w-5 h-5\" aria-hidden /></span>\n                  Javaslatok s tallatok\n                </p>\n                <button\n                  type=\"button\"\n                  onClick={() => setIsOpen(false)}\n                  className=\"p-2.5 rounded-xl text-gray-500 hover:text-gray-800 hover:bg-gray-100 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center touch-manipulation\"\n                  aria-label=\"Kerespanel bezrsa\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"mt-2 flex flex-wrap items-center gap-2\">\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-[11px] font-semibold text-primary-700\">\n                  Live\n                </span>\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-[11px] font-semibold text-secondary-700\">\n                  {displayedTopProducts.length} top termk\n                </span>\n                {trimmedQuery.length >= 2 && actualResultCount != null && (\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700\">\n                    {actualResultCount} relevns\n                  </span>\n                )}\n              </div>\n            </div>\n\n            {displayedTopProducts.length > 0 && (\n              <div className=\"px-4 py-4 border-b border-gray-200 bg-gradient-to-b from-primary-50/50 to-secondary-50/50 w-full\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <p className=\"inline-flex items-center gap-2 text-base font-bold text-gray-800\">\n                    <TrendingUp className=\"w-5 h-5 text-primary-500\" aria-hidden />\n                    {trimmedQuery.length < 2 ? 'Ajnlott indulsnak' : 'Legjobb tallatok'}\n                  </p>\n                  <span className=\"text-sm text-gray-600 tabular-nums\">{displayedTopProducts.length} db</span>\n                </div>\n                <div className=\"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 snap-x snap-mandatory [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {displayedTopProducts.map((p, index) => {\n                    const badge = getTopBadge(p, index);\n                    return (\n                      <div\n                        key={p.id || p.name}\n                        data-product-id={p.id || p.name}\n                        role=\"button\"\n                        tabIndex={0}\n                        onClick={() => {\n                          if (previewProduct?.id === p.id || previewProduct?.name === p.name) {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                            return;\n                          }\n                          handlePreviewProductClick(p);\n                        }}\n                        onMouseMove={(e) => handleCardMouseMove(e, p.id || p.name)}\n                        onMouseLeave={() => setHoverCard({ id: null, rx: 0, ry: 0 })}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter' || e.key === ' ') {\n                            e.preventDefault();\n                            handlePreviewProductClick(p);\n                          }\n                        }}\n                        className=\"min-w-[140px] xs:min-w-[160px] sm:min-w-[200px] lg:min-w-[220px] snap-start text-left rounded-xl border border-gray-200 bg-white hover:border-primary-300 hover:shadow-lg transition-all p-3 touch-manipulation active:scale-[0.98]\"\n                        style={hoverCard.id === String(p.id || p.name)\n                          ? { transform: `perspective(900px) rotateX(${hoverCard.rx}deg) rotateY(${hoverCard.ry}deg) translateY(-2px)` }\n                          : undefined}\n                      >\n                        <div\n                          className=\"relative w-full h-24 sm:h-28 rounded-lg bg-gray-100 overflow-hidden mb-2 flex items-center justify-center\"\n                          onMouseEnter={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            setPreviewProduct(p);\n                            setPreviewAnchor(rect);\n                          }}\n                          onMouseLeave={() => {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                          }}\n                          onTouchStart={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            longPressTimerRef.current = setTimeout(() => {\n                              longPressTimerRef.current = null;\n                              setPreviewProduct(p);\n                              setPreviewAnchor(rect);\n                            }, LONG_PRESS_MS);\n                          }}\n                          onTouchEnd={() => {\n                            if (longPressTimerRef.current) {\n                              clearTimeout(longPressTimerRef.current);\n                              longPressTimerRef.current = null;\n                            }\n                          }}\n                        >\n                          {getProductImage(p) ? <img src={getProductImage(p)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" /> : <Package className=\"w-5 h-5 text-gray-400\" aria-hidden />}\n                        </div>\n                        <div className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-xs font-semibold ${badge.classes}`}>\n                          <Award className=\"w-3.5 h-3.5\" aria-hidden />\n                          {badge.text}\n                        </div>\n                        <p className=\"text-sm font-medium text-gray-800 line-clamp-2 mt-1.5 min-h-[2.2rem]\">{p.name}</p>\n                        <div className=\"mt-1.5 flex items-center justify-between\">\n                          <p className=\"text-base sm:text-lg text-primary-600 font-semibold\">{formatPrice(p.salePrice || p.price)}</p>\n                          <ChevronRight className=\"w-3.5 h-3.5 text-gray-400\" aria-hidden />\n                        </div>\n                        <div className=\"mt-2 flex items-center gap-1.5\">\n                          <button\n                            type=\"button\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              toggleCompareProduct(p);\n                            }}\n                            className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-[11px] border transition-colors ${compareProducts.some((cp) => String(cp.id) === String(p.id))\n                              ? 'border-primary-300 bg-primary-50 text-primary-700'\n                              : 'border-gray-200 bg-gray-50 text-gray-700 hover:bg-gray-100'\n                              }`}\n                          >\n                            <Plus className=\"w-3.5 h-3.5\" aria-hidden />\n                            sszevets\n                          </button>\n                          <span className=\"text-xs text-primary-600 font-medium\">QuickView</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {suggestions.length > 0 ? (\n              <div className=\"px-4 py-4 space-y-4 bg-gradient-to-b from-primary-50/30 to-secondary-50/30 w-full\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                  {suggestions.slice(0, 6).map((s, idx) => (\n                    <button\n                      key={idx}\n                      type=\"button\"\n                      onClick={() => applySuggestion(s.text || s.query || '', { submit: true, source: 'suggestion' })}\n                      className=\"text-left px-4 py-3 rounded-xl border border-secondary-200 bg-white hover:border-secondary-300 hover:bg-secondary-50 transition-colors min-h-[48px] touch-manipulation\"\n                    >\n                      <p className=\"text-base font-semibold text-gray-800 truncate\">{s.text || s.query}</p>\n                    </button>\n                  ))}\n                </div>\n                <div>\n                  <p className=\"text-sm font-bold text-gray-800 mb-2\">Gyorstallatok</p>\n                  <div className=\"flex flex-wrap gap-2 mb-2\">\n                    {quickHitSuggestions.slice(0, 6).map((item) => (\n                      <button\n                        key={`dyn-${item.text}`}\n                        type=\"button\"\n                        onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-semibold hover:bg-secondary-100 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                      >\n                        <span>{item.text}</span>\n                        <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                      </button>\n                    ))}\n                  </div>\n                  {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n                    <div className=\"flex flex-wrap gap-2\">\n                      {[...historyGrouped.today, ...historyGrouped.earlier].slice(0, 2).map((item) => {\n                        const q = item.q || item;\n                        return (\n                          <button\n                            key={`journey-inline-${q}`}\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'journey' })}\n                            className=\"px-2.5 py-1 rounded-full border border-gray-200 bg-white text-gray-700 text-[11px] hover:bg-gray-50 transition-colors\"\n                          >\n                            Gyors jrafuttats: {q}\n                          </button>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"px-3 sm:px-4 py-3 sm:py-4 space-y-3 w-full bg-gray-50\">\n                <div className=\"flex flex-wrap gap-2\">\n                  {quickHitSuggestions.map((item) => (\n                    <button\n                      key={item.text}\n                      type=\"button\"\n                      onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                      className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-200 transition-colors inline-flex items-center gap-1.5\"\n                    >\n                      <span>{item.text}</span>\n                      <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                    </button>\n                  ))}\n                </div>\n                {hasNoResults && rescueSuggestions.length > 0 && (\n                  <div className=\"rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-3\">\n                    <p className=\"text-base font-semibold text-gray-800 mb-2\">Nincs tallat. Prbld inkbb:</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {rescueSuggestions.map((q) => (\n                        <button\n                          key={q}\n                          type=\"button\"\n                          onClick={() => applySuggestion(q, { submit: true, source: 'rescue' })}\n                          className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-primary-800 text-sm font-semibold hover:bg-primary-50 transition-colors\"\n                        >\n                          {q}\n                        </button>\n                      ))}\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-secondary-600 text-white text-sm font-semibold hover:bg-secondary-700 transition-colors\"\n                    >\n                      <Camera className=\"w-4 h-4\" aria-hidden />\n                      Kpalap keress\n                    </button>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {compareProducts.length > 0 && (\n              <div className=\"sticky bottom-0 z-10 border-t border-secondary-300/35 bg-gradient-to-b from-slate-900/95 to-slate-950 px-4 py-3 rounded-b-xl backdrop-blur-sm\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                  <p className=\"text-base font-bold text-secondary-100\">sszevet tlca</p>\n                  {compareProducts.map((p) => (\n                    <span key={`cmp-${p.id}`} className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 text-slate-100 text-sm font-medium\">\n                      {p.name}\n                      <button\n                        type=\"button\"\n                        onClick={() => toggleCompareProduct(p)}\n                        className=\"p-1 rounded-lg hover:bg-slate-700 transition-colors\"\n                        aria-label=\"Termk eltvoltsa sszevetsbl\"\n                      >\n                        <X className=\"w-3.5 h-3.5\" aria-hidden />\n                      </button>\n                    </span>\n                  ))}\n                  <button\n                    type=\"button\"\n                    onClick={runCompareSearch}\n                    disabled={compareProducts.length < 2}\n                    className=\"ml-auto min-h-[44px] px-4 py-2 rounded-xl bg-gradient-to-r from-primary-500 to-secondary-600 text-white text-sm font-bold shadow-[0_8px_22px_rgba(255,138,0,0.4)] disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-[0_12px_28px_rgba(255,138,0,0.5)] active:scale-[0.98] transition-all\"\n                  >\n                    sszehasonlts\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Elnzet tooltip (hover / long-press) */}\n            {previewProduct && previewAnchor && (\n              <div\n                className=\"fixed z-[100] rounded-xl border border-primary-300/40 bg-slate-900/95 shadow-xl p-3 w-[200px] sm:w-[220px] pointer-events-none\"\n                style={{\n                  left: Math.max(8, Math.min(previewAnchor.left, typeof window !== 'undefined' ? window.innerWidth - 220 : previewAnchor.left)),\n                  top: previewAnchor.top - 8,\n                  transform: 'translateY(-100%)',\n                }}\n              >\n                <div className=\"h-24 rounded-lg bg-slate-800 overflow-hidden mb-2 flex items-center justify-center\">\n                  {getProductImage(previewProduct) ? (\n                    <img src={getProductImage(previewProduct)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                  ) : (\n                    <Package className=\"w-8 h-8 text-slate-500\" aria-hidden />\n                  )}\n                </div>\n                <p className=\"text-sm font-semibold text-slate-100 line-clamp-2\">{previewProduct.name}</p>\n                <p className=\"text-base sm:text-lg text-primary-600 font-semibold mt-1\">{formatPrice(previewProduct.salePrice || previewProduct.price)}</p>\n                <p className=\"text-xs text-slate-300 mt-0.5\">Kattints a rszletekhez</p>\n              </div>\n            )}\n          </div>\n        )}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n\n","/**\n * Kategria kpek  Unsplash stock photos, kategrihoz kapcsold\n * Shared between CategoryPage, ModernHero quick categories, stb.\n */\nexport const CATEGORY_IMAGES = {\n  Kanap: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Kanapk: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Fotel: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Fotelek: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Nappali: 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=600&q=80',\n  gy: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  gyak: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  Hlszoba: 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=600&q=80',\n  Matrac: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Matracok: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Asztal: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Asztalok: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Szk: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Szkek: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Iroda: 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=600&q=80',\n  Szekrny: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Szekrnyek: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Lmpa: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Lmpk: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Kert: 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=600&q=80',\n  Gyerek: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Gyerekszoba: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Komd: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Gardrb: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  tkez: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  default: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80'\n};\n\nexport const getCategoryImage = (name) => {\n  if (!name) return CATEGORY_IMAGES.default;\n  const n = String(name).toLowerCase();\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (key === 'default') continue;\n    if (n.includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Sparkles, Camera, ArrowRight,\n  Package, Users, Star, Zap, ChevronRight, ChevronLeft\n} from 'lucide-react';\nimport { CountUp } from '../ui/CountUp';\nimport HeroSmartSearch from './HeroSmartSearch';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { getCategoryImage } from '../../utils/categoryImages';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\n\nconst QUICK_CARD_COLORS = [\n  'from-amber-500 via-orange-500 to-primary-600',\n  'from-emerald-500 via-teal-500 to-secondary-600',\n  'from-violet-500 via-purple-500 to-fuchsia-600',\n  'from-rose-500 via-pink-500 to-red-500',\n  'from-sky-500 via-blue-500 to-indigo-600',\n  'from-lime-500 via-green-500 to-emerald-600',\n];\n\nconst QUICK_CATEGORY_LIMIT = 18;\nconst MIN_QUICK_CATEGORY_PRODUCTS = 20;\nconst CAROUSEL_SCROLL_DURATION = 700;\nconst CAROUSEL_AUTO_INTERVAL = 6000;\nconst CAROUSEL_AUTO_STEP_FRACTION = 0.65;\n\n/** Sima grgets ease-in-out easinggel */\nconst smoothScrollTo = (element, targetLeft, duration = CAROUSEL_SCROLL_DURATION) => {\n  if (!element) return;\n  const start = element.scrollLeft;\n  const dist = targetLeft - start;\n  const startTime = performance.now();\n  const easeInOutCubic = (t) => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);\n  const tick = (now) => {\n    const elapsed = Math.min((now - startTime) / duration, 1);\n    const eased = easeInOutCubic(elapsed);\n    element.scrollLeft = start + dist * eased;\n    if (elapsed < 1) requestAnimationFrame(tick);\n  };\n  requestAnimationFrame(tick);\n};\n\nconst HERO_REVEAL_DELAY = { badge: 0, line1: 100, line2: 220, line3: 340, sub: 460, cta: 600, stats: [720, 820, 920, 1020] };\n\n/**\n * Premium Hero  egyetlen zenet, ers vizul, lgzs\n */\nexport const ModernHero = ({\n  onExplore,\n  onTryAI,\n  quickCategories = [],\n  onQuickCategory,\n  products = [],\n  onHeroSearch,\n  onHeroQuickView\n}) => {\n  const mounted = true;\n  const [heroVariant, setHeroVariant] = useState('A');\n\n  useEffect(() => {\n    try {\n      const storageKey = 'mkt_hero_ab_variant';\n      const existing = localStorage.getItem(storageKey);\n      if (existing === 'A' || existing === 'B') {\n        setHeroVariant(existing);\n        trackSectionEvent(`hero-variant-${existing}`, 'impression');\n        return;\n      }\n      const assigned = Math.random() < 0.5 ? 'A' : 'B';\n      localStorage.setItem(storageKey, assigned);\n      setHeroVariant(assigned);\n      trackSectionEvent(`hero-variant-${assigned}`, 'impression');\n    } catch {\n      setHeroVariant('A');\n      trackSectionEvent('hero-variant-A', 'impression');\n    }\n  }, []);\n\n  const heroCopy = heroVariant === 'B'\n    ? {\n      line1: 'Alaktsd t a teret,',\n      line2: 'mieltt egyetlen btort megvennl.',\n      sub: 'AI tvonalterv, azonnali vizualizci s valdi termkek egyetlen prmium lmnyben.',\n      ctaPrimary: 'Szemlyes AI terv indul',\n      ctaBadge: 'PRMIUM',\n      ctaSecondary: 'Inspirci bngszse'\n    }\n    : {\n      line1: 'Tervezz gy,',\n      line2: 'mintha ez lenne az lomotthonod.',\n      sub: 'Fot, AI-tervezs, vals ajnlatok. Egyetlen flow, ami 5 perc alatt eljuttat az ihlettl a rendelsig.',\n      ctaPrimary: 'Kezdjk AI-val',\n      ctaBadge: 'Most',\n      ctaSecondary: 'Kollekci megtekintse'\n    };\n\n  const stats = [\n    { icon: Package, value: 170, suffix: 'K+', label: 'Termk', decimals: 0 },\n    { icon: Users, value: 50, suffix: 'K+', label: 'Elgedett vsrl', decimals: 0 },\n    { icon: Star, value: 4.9, suffix: '/5', label: 'rtkels', decimals: 1 },\n    { icon: Zap, value: 24, suffix: '/7', label: 'AI tmogats', decimals: 0 }\n  ];\n  const statCardStyles = [\n    {\n      card: 'from-emerald-50 to-white border-emerald-200',\n      iconWrap: 'from-emerald-500 to-emerald-600',\n      edge: 'from-emerald-500 via-emerald-400 to-transparent'\n    },\n    {\n      card: 'from-blue-50 to-white border-blue-200',\n      iconWrap: 'from-blue-500 to-blue-600',\n      edge: 'from-blue-500 via-blue-400 to-transparent'\n    },\n    {\n      card: 'from-amber-50 to-white border-amber-200',\n      iconWrap: 'from-amber-500 to-orange-600',\n      edge: 'from-amber-500 via-amber-400 to-transparent'\n    },\n    {\n      card: 'from-secondary-50 to-white border-secondary-200',\n      iconWrap: 'from-secondary-600 to-secondary-700',\n      edge: 'from-secondary-600 via-secondary-500 to-transparent'\n    }\n  ];\n\n  const HERO_BG_IMAGE = 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=1920&q=85';\n\n  // Kiemelt kategrik  18 legfontosabb (termkszm szerint), ABC sorrendben megjelentve\n  const mains = Array.isArray(quickCategories) ? quickCategories : [];\n  const subcats = mains.flatMap((m) =>\n    (m?.children || []).map((c) => ({ ...c, parentName: m?.name }))\n  );\n  const allItems = [\n    ...mains.filter((m) => m?.name).map((m) => ({ name: m.name, productCount: m.productCount, parentName: null })),\n    ...subcats.filter((c) => c?.name)\n  ];\n  const byName = new Map();\n  for (const item of allItems) {\n    const count = Number(item?.productCount || 0);\n    if (count < MIN_QUICK_CATEGORY_PRODUCTS) continue;\n    const name = String(item.name).trim();\n    const existing = byName.get(name);\n    if (!existing || count > Number(existing.productCount || 0)) byName.set(name, { ...item, name });\n  }\n  const topByCount = [...byName.values()]\n    .sort((a, b) => Number(b?.productCount || 0) - Number(a?.productCount || 0))\n    .slice(0, QUICK_CATEGORY_LIMIT);\n  const quickCategoryItems = [...topByCount].sort((a, b) => String(a?.name || '').localeCompare(String(b?.name || ''), 'hu'));\n\n  const categoryCarouselRef = useRef(null);\n  const [categoryCarouselPaused, setCategoryCarouselPaused] = useState(false);\n\n  const getCategoryScrollStep = (container) => {\n    if (!container) return 191;\n    const first = container.firstElementChild;\n    if (!first) return 191;\n    const rect = first.getBoundingClientRect();\n    const gap = parseFloat(getComputedStyle(container).columnGap || '16');\n    return Math.max(130, rect.width + gap);\n  };\n\n  useEffect(() => {\n    if (!categoryCarouselPaused && quickCategoryItems.length > 0) {\n      const container = categoryCarouselRef.current;\n      if (!container) return undefined;\n      const id = setInterval(() => {\n        const step = getCategoryScrollStep(container) * CAROUSEL_AUTO_STEP_FRACTION;\n        const maxScroll = container.scrollWidth - container.clientWidth;\n        const next = container.scrollLeft + step;\n        if (maxScroll <= 0 || next >= maxScroll - 5) {\n          smoothScrollTo(container, 0);\n        } else {\n          smoothScrollTo(container, container.scrollLeft + step);\n        }\n      }, CAROUSEL_AUTO_INTERVAL);\n      return () => clearInterval(id);\n    }\n    return undefined;\n  }, [categoryCarouselPaused, quickCategoryItems.length]);\n\n  const scrollCategoryCarousel = (direction) => {\n    const container = categoryCarouselRef.current;\n    if (!container) return;\n    const step = getCategoryScrollStep(container) * 0.85;\n    const target = Math.max(0, Math.min(container.scrollWidth - container.clientWidth, container.scrollLeft + step * direction));\n    smoothScrollTo(container, target);\n  };\n\n  return (\n    <section\n      className=\"relative min-h-screen flex flex-col items-center justify-center overflow-x-clip overflow-y-auto bg-[#fcfcfb]\"\n      aria-label=\"Foldal  AI btorbolt\"\n    >\n      {/* Httrkp ~10% tltszsggal  ahogy volt */}\n      <div\n        className=\"absolute inset-0 bg-cover bg-center opacity-10 z-0\"\n        style={{ backgroundImage: `url(${HERO_BG_IMAGE})` }}\n        aria-hidden\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-b from-white/88 via-white/70 to-primary-50/88 z-[1]\" aria-hidden />\n      <div className=\"pointer-events-none absolute inset-0\" aria-hidden>\n        <div className=\"absolute left-1/2 top-[30%] h-[520px] w-[min(1100px,92vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.24),transparent_62%)] blur-2xl\" />\n        <div className=\"absolute left-1/2 top-[34%] h-[420px] w-[min(860px,84vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.16),transparent_70%)] blur-xl\" />\n      </div>\n      <div className=\"absolute inset-0 pointer-events-none\" aria-hidden=\"true\">\n        <div className=\"absolute inset-x-0 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300 to-transparent opacity-70\" />\n        <div className=\"absolute inset-x-0 bottom-0 h-[1px] bg-gradient-to-r from-transparent via-secondary-300 to-transparent opacity-60\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 pt-16 sm:pt-20 lg:pt-24 pb-2 sm:pb-3 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          <div\n            className={`inline-flex items-center gap-2.5 px-4 py-2 bg-white rounded-full border border-gray-200 shadow-sm mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.badge}ms` } : undefined}\n          >\n            <span className=\"flex h-2.5 w-2.5 rounded-full bg-primary-500\" aria-hidden />\n            <span className=\"text-xs sm:text-sm font-semibold text-gray-700 uppercase tracking-wide\">\n              Marketly AI rendszer\n            </span>\n          </div>\n\n          <h1 className=\"mb-6 sm:mb-7 lg:mb-8\">\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-[1.03] ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line1}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line1}\n            </span>\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold leading-[1.03] bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line2}\n            </span>\n          </h1>\n\n          <div\n            className={`mx-auto h-1.5 w-28 rounded-full bg-gradient-to-r from-primary-500 to-secondary-700 mb-2 sm:mb-3 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 40}ms` } : undefined}\n            aria-hidden\n          />\n        </div>\n      </div>\n\n      {/* Kiemelt kategrik  carousel: auto scroll, desktop nyilak */}\n      {quickCategoryItems.length > 0 && (\n        <div\n          className={`relative z-10 w-full mb-4 sm:mb-5 overflow-hidden ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n          style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 80}ms` } : undefined}\n        >\n          <h2 className=\"text-center text-lg sm:text-xl font-bold text-gray-800 mb-3 px-4\">\n            Kiemelt kategrik\n          </h2>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(-1)}\n            className=\"hidden lg:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Balra\"\n          >\n            <ChevronLeft className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(1)}\n            className=\"hidden lg:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Jobbra\"\n          >\n            <ChevronRight className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <div\n            ref={categoryCarouselRef}\n            onMouseEnter={() => setCategoryCarouselPaused(true)}\n            onMouseLeave={() => setCategoryCarouselPaused(false)}\n            onTouchStart={() => setCategoryCarouselPaused(true)}\n            onTouchEnd={() => setTimeout(() => setCategoryCarouselPaused(false), 3000)}\n            className=\"flex gap-3 sm:gap-4 overflow-x-auto scrollbar-hide pb-2 px-4 sm:px-6 lg:px-14 snap-x snap-mandatory scroll-smooth min-w-0\"\n          >\n            {quickCategoryItems.map((item, idx) => {\n              const name = item?.name;\n              const count = Number(item?.productCount || 0);\n              if (!name) return null;\n              const Icon = getCategoryIcon(name);\n              const productImg = (n) => Array.isArray(products) && products.length > 0\n                ? products.find((p) => (p?.category || '').toLowerCase().includes(String(n || '').toLowerCase()))?.images?.[0]\n                : null;\n              const img = productImg(name) || getCategoryImage(name);\n              const gradient = QUICK_CARD_COLORS[idx % QUICK_CARD_COLORS.length];\n              return (\n                <button\n                  key={`${item.parentName || ''}-${name}`}\n                  type=\"button\"\n                  onClick={() => onQuickCategory?.(name)}\n                  className=\"group relative shrink-0 w-[130px] sm:w-[150px] lg:w-[175px] aspect-[3/4] rounded-2xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-[1.02] snap-start focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 border-2 border-white/40\"\n                >\n                  <img\n                    src={img}\n                    alt=\"\"\n                    className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-105\"\n                    aria-hidden\n                  />\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent\" />\n                  <div className={`absolute inset-0 bg-gradient-to-br ${gradient} opacity-35`} aria-hidden />\n                  <div className=\"absolute inset-0 flex flex-col items-center justify-center p-3 sm:p-4 text-center\">\n                    <div className=\"w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-white/25 backdrop-blur-sm flex items-center justify-center mb-2 sm:mb-3 shadow-md group-hover:bg-white/40 group-hover:scale-105 transition-all duration-300 ease-out ring-2 ring-white/30\">\n                      <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-10 lg:h-10 text-white drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]\" strokeWidth={2.5} />\n                    </div>\n                    <span className=\"text-white font-bold text-xs sm:text-sm lg:text-base drop-shadow-lg line-clamp-2 leading-tight\">\n                      {name}\n                    </span>\n                    {count > 0 && (\n                      <span className=\"text-white/95 text-[10px] sm:text-xs mt-1 font-semibold\">\n                        {count.toLocaleString('hu-HU')} db\n                      </span>\n                    )}\n                    <ChevronRight className=\"absolute bottom-2 right-2 w-4 h-4 sm:w-5 sm:h-5 text-white/90 group-hover:translate-x-0.5 transition-transform duration-200 ease-out\" aria-hidden />\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          {/* Kzponti hero search  full width minus 2px */}\n          <div\n            className={`relative w-full min-w-0 max-w-full px-[1px] mb-6 sm:mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub - 60}ms` } : undefined}\n          >\n            <div className=\"pointer-events-none absolute inset-0 rounded-[32px] border border-white/70 bg-white/[0.04] backdrop-blur-[1px] shadow-[inset_0_1px_0_rgba(255,255,255,0.75)]\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-8 -top-10 h-24 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.22),transparent_65%)] blur-2xl\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-12 -bottom-12 h-28 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.18),transparent_70%)] blur-2xl\" aria-hidden />\n            <HeroSmartSearch\n              products={products}\n              onSearch={onHeroSearch}\n              onTryAI={onTryAI}\n              variant={heroVariant}\n              onOpenProductQuickView={onHeroQuickView}\n            />\n          </div>\n\n          <p\n            className={`text-sm sm:text-base text-gray-600/95 max-w-xl mx-auto mb-8 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub}ms`, lineHeight: '1.6' } : { lineHeight: '1.6' }}\n          >\n            {heroCopy.sub}\n          </p>\n\n          <div\n            className={`flex flex-col sm:flex-row gap-4 justify-center items-stretch sm:items-center mb-7 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 120}ms` } : undefined}\n          >\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-primary');\n                onTryAI?.();\n              }}\n              className=\"group relative w-full sm:w-auto min-h-[48px] px-8 py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white rounded-2xl font-semibold text-base shadow-[0_10px_26px_rgba(255,138,0,0.32)] hover:shadow-[0_14px_34px_rgba(255,138,0,0.42)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kezdj AI tervezssel\"\n            >\n              <span className=\"px-2.5 py-1 rounded-full bg-white/20 text-[11px] font-bold uppercase tracking-wide\">{heroCopy.ctaBadge}</span>\n              <Sparkles className=\"w-5 h-5\" aria-hidden />\n              {heroCopy.ctaPrimary}\n              <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-secondary');\n                onExplore?.();\n              }}\n              className=\"w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-gray-900 rounded-2xl font-semibold text-base border border-gray-200 shadow-sm hover:border-gray-300 hover:shadow-md hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kollekci bngszse\"\n            >\n              {heroCopy.ctaSecondary}\n              <ArrowRight className=\"w-5 h-5\" aria-hidden />\n            </button>\n          </div>\n\n          <div className={`flex flex-wrap items-center justify-center gap-x-5 gap-y-2 text-sm text-gray-600 mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 70}ms` } : undefined}>\n            <span className=\"inline-flex items-center gap-1.5\"><Star className=\"w-4 h-4 text-amber-500\" aria-hidden /> 4.9/5 vsrli rtkels</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Users className=\"w-4 h-4 text-primary-500\" aria-hidden /> 50K+ elgedett vsrl</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Zap className=\"w-4 h-4 text-secondary-700\" aria-hidden /> 24/7 AI tmogats</span>\n          </div>\n\n          <div className={`w-full max-w-6xl ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 180}ms` } : undefined}>\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n            {stats.map((stat, idx) => {\n              const style = statCardStyles[idx % statCardStyles.length];\n              return (\n              <div\n                key={idx}\n                    className={`group relative overflow-hidden bg-gradient-to-tr ${style.card} rounded-2xl p-4 border shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200`}\n              >\n                    <div className={`absolute left-0 bottom-0 w-[78%] h-[2px] bg-gradient-to-r ${style.edge}`} aria-hidden />\n                    <div className=\"absolute left-0 bottom-0 w-24 h-24 bg-gradient-to-tr from-black/5 to-transparent rotate-12 -translate-x-7 translate-y-7 blur-[1px]\" aria-hidden />\n                    <div className=\"relative z-10\">\n                    <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${style.iconWrap} text-white flex items-center justify-center mb-2.5 shadow-sm`}>\n                      <stat.icon className=\"w-5 h-5\" aria-hidden />\n                    </div>\n                    <div className=\"text-xl sm:text-2xl font-bold text-gray-900\">\n                  <CountUp\n                    end={stat.value}\n                    duration={1800}\n                    suffix={stat.suffix}\n                    decimals={stat.decimals}\n                    delay={HERO_REVEAL_DELAY.stats[idx] + 180}\n                  />\n                </div>\n                    <div className=\"text-xs text-gray-600\">{stat.label}</div>\n                    </div>\n              </div>\n              );\n            })}\n              </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { ModernHero };\n","import React, { useState, useEffect, useRef } from 'react';\n\n/**\n * FadeInOnScroll - Animates children when they enter viewport\n */\nexport const FadeInOnScroll = ({ \n  children, \n  direction = 'up', // 'up', 'down', 'left', 'right', 'none'\n  delay = 0,\n  duration = 500,\n  threshold = 0.1,\n  className = ''\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');\n    if (!mq) return undefined;\n    setPrefersReducedMotion(mq.matches);\n    const handler = () => setPrefersReducedMotion(mq.matches);\n    if (typeof mq.addEventListener === 'function') {\n      mq.addEventListener('change', handler);\n      return () => mq.removeEventListener('change', handler);\n    }\n    if (typeof mq.addListener === 'function') {\n      mq.addListener(handler);\n      return () => mq.removeListener(handler);\n    }\n    return undefined;\n  }, []);\n\n  useEffect(() => {\n    if (!ref.current || !(ref.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsVisible(true);\n          observer.unobserve(entry.target);\n        }\n      },\n      { threshold }\n    );\n\n    try {\n      observer.observe(ref.current);\n    } catch (err) {\n      return undefined;\n    }\n    return () => observer.disconnect();\n  }, [threshold]);\n\n  const getTransform = () => {\n    if (isVisible || prefersReducedMotion) return 'translate3d(0, 0, 0)';\n    switch (direction) {\n      case 'up': return 'translate3d(0, 30px, 0)';\n      case 'down': return 'translate3d(0, -30px, 0)';\n      case 'left': return 'translate3d(30px, 0, 0)';\n      case 'right': return 'translate3d(-30px, 0, 0)';\n      default: return 'translate3d(0, 0, 0)';\n    }\n  };\n\n  const visible = isVisible || prefersReducedMotion;\n  const transition = prefersReducedMotion ? 'none' : `transform ${duration}ms ease-out ${delay}ms, opacity ${duration}ms ease-out ${delay}ms`;\n\n  return (\n    <div\n      ref={ref}\n      className={className}\n      style={{\n        transform: getTransform(),\n        opacity: visible ? 1 : 0,\n        transition,\n        willChange: prefersReducedMotion || visible ? 'auto' : 'transform, opacity'\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\n/**\n * StaggerChildren - Staggers animation of child elements\n */\nexport const StaggerChildren = ({ \n  children, \n  staggerDelay = 100,\n  direction = 'up',\n  duration = 400,\n  className = ''\n}) => {\n  return (\n    <div className={className}>\n      {React.Children.map(children, (child, index) => (\n        <FadeInOnScroll\n          direction={direction}\n          delay={index * staggerDelay}\n          duration={duration}\n        >\n          {child}\n        </FadeInOnScroll>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Confetti - Celebration animation for add to cart, etc.\n */\nexport const Confetti = ({ isActive, duration = 2000, onComplete }) => {\n  const [particles, setParticles] = useState([]);\n  const canvasRef = useRef(null);\n\n  useEffect(() => {\n    if (!isActive) return;\n\n    // Generate confetti particles\n    const newParticles = Array.from({ length: 50 }, (_, i) => ({\n      id: i,\n      x: Math.random() * 100,\n      y: -10,\n      size: Math.random() * 8 + 4,\n      color: ['#6366f1', '#a855f7', '#ec4899', '#f59e0b', '#10b981', '#3b82f6'][Math.floor(Math.random() * 6)],\n      speedX: (Math.random() - 0.5) * 3,\n      speedY: Math.random() * 3 + 2,\n      rotation: Math.random() * 360,\n      rotationSpeed: (Math.random() - 0.5) * 10\n    }));\n\n    setParticles(newParticles);\n\n    const timeout = setTimeout(() => {\n      setParticles([]);\n      if (onComplete) onComplete();\n    }, duration);\n\n    return () => clearTimeout(timeout);\n  }, [isActive, duration, onComplete]);\n\n  useEffect(() => {\n    if (particles.length === 0) return;\n\n    let animationFrame;\n    const animate = () => {\n      setParticles(prev => \n        prev.map(p => ({\n          ...p,\n          y: p.y + p.speedY,\n          x: p.x + p.speedX,\n          rotation: p.rotation + p.rotationSpeed\n        })).filter(p => p.y < 110)\n      );\n      animationFrame = requestAnimationFrame(animate);\n    };\n\n    animationFrame = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationFrame);\n  }, [particles.length > 0]);\n\n  if (particles.length === 0) return null;\n\n  return (\n    <div className=\"fixed inset-0 pointer-events-none z-[200] overflow-hidden\">\n      {particles.map(p => (\n        <div\n          key={p.id}\n          className=\"absolute\"\n          style={{\n            left: `${p.x}%`,\n            top: `${p.y}%`,\n            width: p.size,\n            height: p.size,\n            backgroundColor: p.color,\n            transform: `rotate(${p.rotation}deg)`,\n            borderRadius: Math.random() > 0.5 ? '50%' : '0',\n            opacity: 1 - (p.y / 110)\n          }}\n        />\n      ))}\n    </div>\n  );\n};\n\n/**\n * PulseButton - Button with pulse animation\n */\nexport const PulseButton = ({ children, className = '', ...props }) => {\n  return (\n    <button \n      className={`relative ${className}`}\n      {...props}\n    >\n      <span className=\"absolute inset-0 rounded-xl bg-current opacity-20 animate-ping\" />\n      {children}\n    </button>\n  );\n};\n\n/**\n * ShimmerText - Text with shimmer effect\n */\nexport const ShimmerText = ({ children, className = '' }) => {\n  return (\n    <span \n      className={`relative inline-block ${className}`}\n      style={{\n        background: 'linear-gradient(90deg, currentColor 0%, #a78bfa 50%, currentColor 100%)',\n        backgroundSize: '200% 100%',\n        WebkitBackgroundClip: 'text',\n        WebkitTextFillColor: 'transparent',\n        animation: 'shimmer 2s linear infinite'\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes shimmer {\n          0% { background-position: 200% 0; }\n          100% { background-position: -200% 0; }\n        }\n      `}</style>\n    </span>\n  );\n};\n\n/**\n * FloatingElement - Gentle floating animation\n */\nexport const FloatingElement = ({ children, className = '', amplitude = 10, duration = 3 }) => {\n  return (\n    <div \n      className={className}\n      style={{\n        animation: `float ${duration}s ease-in-out infinite`\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes float {\n          0%, 100% { transform: translateY(0px); }\n          50% { transform: translateY(-${amplitude}px); }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n/**\n * CountUp - Animated number counter\n */\nexport const CountUp = ({ end, duration = 2000, prefix = '', suffix = '', className = '' }) => {\n  const [count, setCount] = useState(0);\n  const [hasStarted, setHasStarted] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    if (!ref.current || !(ref.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted) {\n          setHasStarted(true);\n        }\n      },\n      { threshold: 0.5 }\n    );\n\n    try {\n      observer.observe(ref.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [hasStarted]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    let startTime;\n    const animate = (timestamp) => {\n      if (!startTime) startTime = timestamp;\n      const progress = Math.min((timestamp - startTime) / duration, 1);\n      \n      // Easing function\n      const easeOut = 1 - Math.pow(1 - progress, 3);\n      setCount(Math.floor(easeOut * end));\n\n      if (progress < 1) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }, [hasStarted, end, duration]);\n\n  return (\n    <span ref={ref} className={className}>\n      {prefix}{count.toLocaleString('hu-HU')}{suffix}\n    </span>\n  );\n};\n\n/**\n * ProgressBar - Animated progress bar\n */\nexport const ProgressBar = ({ progress, className = '', color = 'primary' }) => {\n  const [width, setWidth] = useState(0);\n\n  useEffect(() => {\n    const timeout = setTimeout(() => setWidth(progress), 100);\n    return () => clearTimeout(timeout);\n  }, [progress]);\n\n  return (\n    <div className={`h-2 bg-gray-200 rounded-full overflow-hidden ${className}`}>\n      <div \n        className={`h-full bg-gradient-to-r from-${color}-500 to-${color}-500 rounded-full transition-all duration-1000 ease-out`}\n        style={{ width: `${width}%` }}\n      />\n    </div>\n  );\n};\n\nexport default {\n  FadeInOnScroll,\n  StaggerChildren,\n  Confetti,\n  PulseButton,\n  ShimmerText,\n  FloatingElement,\n  CountUp,\n  ProgressBar\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport { Camera, MessageCircle, Move3d, Sparkles, Home, ArrowRight } from 'lucide-react';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\nimport { CountUp } from '../ui/Animations';\n\nconst FEATURES = [\n  {\n    id: 'style-quiz',\n    title: 'AI Stlus Quiz',\n    subtitle: '5 krds a Style DNA-dhoz',\n    cta: 'Style DNA megismerse',\n    icon: Sparkles,\n    stat: null,\n    statLabel: null,\n    isHighlighted: true,\n    displayOrder: 0,\n    border: 'border-amber-200/80',\n    bg: 'from-amber-50/90 to-white',\n    accent: 'from-amber-400 via-amber-500 to-primary-500',\n    iconGradient: 'from-amber-500 to-orange-500',\n    text: 'text-amber-800'\n  },\n  {\n    id: 'visual-search',\n    title: 'Kpfelismers',\n    subtitle: 'Fotzz s keress',\n    cta: 'Keress indtsa',\n    icon: Camera,\n    stat: '99%',\n    statLabel: 'pontossg',\n    isHighlighted: false,\n    displayOrder: 1,\n    border: 'border-sky-200/80',\n    bg: 'from-sky-50/90 to-white',\n    accent: 'from-sky-400 via-blue-500 to-indigo-500',\n    iconGradient: 'from-sky-500 to-blue-600',\n    text: 'text-sky-800'\n  },\n  {\n    id: 'chat',\n    title: 'AI Chat',\n    subtitle: 'Szemlyes tancsad',\n    cta: 'Chat megnyitsa',\n    icon: MessageCircle,\n    stat: '24/7',\n    statLabel: 'elrhet',\n    isHighlighted: false,\n    displayOrder: 2,\n    border: 'border-secondary-200/80',\n    bg: 'from-secondary-50/90 to-white',\n    accent: 'from-secondary-400 via-teal-500 to-emerald-500',\n    iconGradient: 'from-secondary-500 to-secondary-600',\n    text: 'text-secondary-800'\n  },\n  {\n    id: 'room-planner',\n    title: 'Szobatervez',\n    subtitle: 'Virtulis elhelyezs',\n    cta: 'Tervezs indtsa',\n    icon: Move3d,\n    stat: 'AR',\n    statLabel: 'tmogats',\n    isHighlighted: false,\n    displayOrder: 3,\n    border: 'border-emerald-200/80',\n    bg: 'from-emerald-50/90 to-white',\n    accent: 'from-emerald-400 via-green-500 to-teal-500',\n    iconGradient: 'from-emerald-500 to-green-600',\n    text: 'text-emerald-800'\n  },\n  {\n    id: 'room-designer',\n    title: 'AI Szoba Tervez',\n    subtitle: 'Tervezd meg a tkletes szobt',\n    cta: 'Szoba megtervezse',\n    icon: Home,\n    stat: null,\n    statLabel: null,\n    isHighlighted: false,\n    displayOrder: 4,\n    border: 'border-indigo-200/80',\n    bg: 'from-indigo-50/90 to-white',\n    accent: 'from-indigo-400 via-violet-500 to-secondary-500',\n    iconGradient: 'from-indigo-500 to-violet-600',\n    text: 'text-indigo-800'\n  }\n].sort((a, b) => a.displayOrder - b.displayOrder);\n\nconst AUTO_SCROLL_MS = 4000;\nconst SECTION_ID = 'ai-module';\n\nfunction StatDisplay({ feature, isMobile, reduceMotion }) {\n  if (!feature.stat) return null;\n  const statPos = feature.isHighlighted ? 'top-4 left-4' : 'top-4 right-4 sm:top-5 sm:right-5';\n  const parsed = feature.stat === '99%' ? { num: 99, suffix: '%' } : feature.stat === '24/7' ? { num: 24, suffix: '/7' } : null;\n\n  return (\n    <div className={`absolute ${statPos} text-right`}>\n      <div className={`${isMobile ? 'text-sm' : 'text-base'} font-bold ${feature.text}`}>\n        {reduceMotion || !parsed ? feature.stat : <CountUp end={parsed.num} suffix={parsed.suffix} duration={1200} />}\n      </div>\n      <div className={`${isMobile ? 'text-[10px]' : 'text-xs'} text-gray-500`}>{feature.statLabel}</div>\n    </div>\n  );\n}\n\nfunction FeatureCard({ feature, layout, onClick, reduceMotion }) {\n  const Icon = feature.icon;\n  const isMobile = layout === 'mobile';\n  const badgePos = 'top-4 right-4 sm:top-5 sm:right-5';\n\n  return (\n    <button\n      type=\"button\"\n      onClick={() => {\n        trackSectionEvent(SECTION_ID, 'click', feature.id);\n        onClick?.(feature);\n      }}\n      className={`group relative flex-shrink-0 h-[220px] rounded-xl border bg-gradient-to-br ${feature.border} ${feature.bg} text-left shadow-lg hover:shadow-xl hover:ring-2 hover:ring-primary-200/80 active:scale-[0.98] transition-all duration-200 snap-start focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 [transform-style:preserve-3d] hover:[transform:perspective(1000px)_rotateX(-2deg)_rotateY(2deg)_translateY(-4px)] motion-reduce:hover:[transform:translateY(-2px)] ${feature.isHighlighted ? 'ring-2 ring-amber-300/60' : ''} ${isMobile ? 'w-full min-w-0' : 'hidden sm:block sm:w-auto sm:min-w-0 sm:h-[240px]'}`}\n      aria-label={`${feature.title}  ${feature.subtitle}`}\n    >\n      <div className={`absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r ${feature.accent}`} aria-hidden />\n      <div className={`relative h-full flex flex-col ${isMobile ? 'p-4' : 'p-5'}`}>\n        <div className={`${isMobile ? 'w-10 h-10 mb-3' : 'w-11 h-11 mb-4'} rounded-xl bg-gradient-to-br ${feature.iconGradient} text-white flex items-center justify-center shadow-sm transition-transform duration-200 group-hover:scale-110 group-hover:-translate-y-0.5`}>\n          <Icon className={`${isMobile ? 'w-5 h-5' : 'w-6 h-6'} transition-transform duration-200 group-hover:scale-105`} aria-hidden />\n        </div>\n        <StatDisplay feature={feature} isMobile={isMobile} reduceMotion={reduceMotion} />\n        {feature.isHighlighted && (\n          <span className={`absolute ${badgePos} px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 ${isMobile ? 'text-[10px]' : 'text-xs'} font-bold`}>\n            Prbld elszr\n          </span>\n        )}\n        <h3 className={`${isMobile ? 'text-base' : 'text-lg'} font-bold ${feature.text} mb-0.5 sm:mb-1`}>{feature.title}</h3>\n        <p className={`${isMobile ? 'text-xs' : 'text-sm'} text-gray-600 mb-auto`}>{feature.subtitle}</p>\n        <span className={`inline-flex items-center gap-1.5 sm:gap-2 ${isMobile ? 'text-sm' : 'text-sm'} font-semibold ${feature.text} mt-2`}>\n          {feature.cta} <ArrowRight className=\"w-4 h-4 group-hover:translate-x-1 group-hover:scale-110 transition-transform duration-200\" aria-hidden />\n        </span>\n      </div>\n    </button>\n  );\n}\n\nexport default function AIModuleUnified({ onFeatureClick }) {\n  const scrollRef = useRef(null);\n  const [isPaused, setIsPaused] = useState(false);\n  const [cardWidth, setCardWidth] = useState(0);\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [isScrolling, setIsScrolling] = useState(false);\n  const [reduceMotion, setReduceMotion] = useState(false);\n\n  useEffect(() => {\n    trackSectionEvent(SECTION_ID, 'impression');\n  }, []);\n\n  useEffect(() => {\n    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');\n    setReduceMotion(mq.matches);\n    const fn = (e) => setReduceMotion(e.matches);\n    mq.addEventListener('change', fn);\n    return () => mq.removeEventListener('change', fn);\n  }, []);\n\n  const handleClick = (feature) => {\n    onFeatureClick?.(feature);\n  };\n\n  useEffect(() => {\n    const el = scrollRef.current;\n    if (!el) return;\n    const updateWidth = () => {\n      const gap = 20;\n      const w = (el.offsetWidth - gap) / 2;\n      setCardWidth(w + gap);\n    };\n    updateWidth();\n    const ro = new ResizeObserver(updateWidth);\n    ro.observe(el);\n    return () => ro.disconnect();\n  }, []);\n\n  useEffect(() => {\n    const el = scrollRef.current;\n    if (!el || cardWidth <= 0) return;\n    const count = FEATURES.length;\n    const totalWidth = count * cardWidth;\n    const onScroll = () => {\n      const x = el.scrollLeft;\n      let idx = Math.min(count - 1, Math.round(x / cardWidth));\n      if (idx < 0) idx = 0;\n      setActiveIndex(idx);\n    };\n    el.addEventListener('scroll', onScroll, { passive: true });\n    return () => el.removeEventListener('scroll', onScroll);\n  }, [cardWidth]);\n\n  useEffect(() => {\n    if (reduceMotion || isPaused || !scrollRef.current || cardWidth <= 0) return;\n    const el = scrollRef.current;\n    const count = FEATURES.length;\n    const totalWidth = count * cardWidth;\n    const t = setInterval(() => {\n      const curr = el.scrollLeft;\n      const next = curr + cardWidth;\n      if (next >= totalWidth - 20) {\n        el.scrollTo({ left: 0, behavior: 'smooth' });\n      } else {\n        el.scrollTo({ left: next, behavior: 'smooth' });\n      }\n    }, AUTO_SCROLL_MS);\n    return () => clearInterval(t);\n  }, [reduceMotion, isPaused, cardWidth]);\n\n  const handleTouchStart = () => {\n    setIsPaused(true);\n    setIsScrolling(false);\n  };\n\n  const handleTouchEnd = () => {\n    setTimeout(() => setIsPaused(false), 3000);\n    setTimeout(() => setIsScrolling(false), 100);\n  };\n\n  const handleTouchMove = () => {\n    setIsScrolling(true);\n  };\n\n  const [sectionInView, setSectionInView] = useState(false);\n  const sectionRef = useRef(null);\n\n  useEffect(() => {\n    const el = sectionRef.current;\n    if (!el) return;\n    const observer = new IntersectionObserver(\n      ([e]) => e.isIntersecting && setSectionInView(true),\n      { threshold: 0.15 }\n    );\n    observer.observe(el);\n    return () => observer.disconnect();\n  }, []);\n\n  return (\n    <section\n      ref={sectionRef}\n      className=\"relative py-20 overflow-hidden bg-gradient-to-b from-primary-50/40 via-white to-white border-t border-gray-100\"\n      aria-labelledby=\"ai-module-heading\"\n    >\n      {/* Gradient orbs httr */}\n      <div className=\"pointer-events-none absolute inset-0\">\n        <div className=\"absolute top-0 left-1/4 w-[400px] h-[400px] rounded-full bg-primary-200/50 mix-blend-multiply filter blur-[100px] animate-blob motion-reduce:animate-none\" />\n        <div className=\"absolute top-1/2 right-0 w-[350px] h-[350px] rounded-full bg-secondary-300/40 mix-blend-multiply filter blur-[90px] animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n        <div className=\"absolute bottom-0 left-1/2 w-[300px] h-[300px] rounded-full bg-amber-200/40 mix-blend-multiply filter blur-[80px] animate-blob animation-delay-4000 motion-reduce:animate-none\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 xl:px-16\">\n        <div className=\"text-center mb-12\">\n          <h2\n            id=\"ai-module-heading\"\n            className=\"text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 tracking-tight mb-3\"\n          >\n            AI a <span className=\"bg-gradient-to-r from-primary-500 to-secondary-600 bg-clip-text text-transparent\">szolglatodban</span>\n          </h2>\n          <p className=\"text-base sm:text-lg text-gray-500 max-w-2xl mx-auto\">\n            Okos funkcik a tkletes vlasztshoz\n          </p>\n        </div>\n\n        {/* Mobil: scroll carousel, 2 krtya, auto-scroll */}\n        <div\n          ref={scrollRef}\n          onMouseEnter={() => setIsPaused(true)}\n          onMouseLeave={() => setIsPaused(false)}\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n          onTouchMove={handleTouchMove}\n          className={`flex sm:hidden gap-5 overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth pb-2 -mx-4 pl-4 pr-4 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden ${isScrolling ? 'opacity-95' : ''}`}\n          style={{\n            WebkitOverflowScrolling: 'touch',\n            scrollSnapType: 'x mandatory',\n            scrollPaddingLeft: 16\n          }}\n        >\n          {FEATURES.map((feature, idx) => (\n            <div\n              key={feature.id}\n              className={`flex-shrink-0 w-[calc(50%-10px)] min-w-[calc(50%-10px)] transition-all duration-500 ease-out ${(sectionInView || reduceMotion) ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}\n              style={!reduceMotion ? { transitionDelay: `${idx * 80}ms` } : undefined}\n            >\n              <FeatureCard\n                feature={feature}\n                layout=\"mobile\"\n                onClick={handleClick}\n                reduceMotion={reduceMotion}\n              />\n            </div>\n          ))}\n        </div>\n\n        {/* Dot indicator  mobil */}\n        <div className=\"flex sm:hidden justify-center gap-1.5 mt-4\">\n          {FEATURES.map((_, i) => (\n            <span\n              key={i}\n              className={`block w-2 h-2 rounded-full transition-colors ${i === activeIndex ? 'bg-primary-500' : 'bg-gray-300'}`}\n              aria-hidden\n            />\n          ))}\n        </div>\n\n        {/* Tablet + Desktop: 5 krtya egy sorban, staggered fade-in */}\n        <div className=\"hidden sm:grid sm:grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-5 mt-0\">\n          {FEATURES.map((feature, idx) => {\n            const Icon = feature.icon;\n            const show = sectionInView || reduceMotion;\n            return (\n            <div\n              key={feature.id}\n              className={`transition-all duration-500 ease-out ${show ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-6'}`}\n              style={!reduceMotion ? { transitionDelay: `${idx * 90}ms` } : undefined}\n            >\n              <button\n                type=\"button\"\n                onClick={() => {\n                  trackSectionEvent(SECTION_ID, 'click', feature.id);\n                  handleClick(feature);\n                }}\n                className={`group relative w-full rounded-xl border bg-gradient-to-br ${feature.border} ${feature.bg} h-[220px] lg:h-[240px] text-left shadow-lg hover:shadow-xl hover:ring-2 hover:ring-primary-200/80 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 overflow-hidden min-w-0 [transform-style:preserve-3d] hover:[transform:perspective(1000px)_rotateX(-2deg)_rotateY(2deg)_translateY(-4px)] motion-reduce:hover:[transform:translateY(-2px)] ${feature.isHighlighted ? 'ring-2 ring-amber-300/60' : ''}`}\n                aria-label={`${feature.title}  ${feature.subtitle}`}\n              >\n                <div className={`absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r ${feature.accent}`} aria-hidden />\n                <div className=\"relative h-full flex flex-col p-5\">\n                  <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${feature.iconGradient} text-white flex items-center justify-center mb-4 shadow-sm transition-transform duration-200 group-hover:scale-110 group-hover:-translate-y-0.5`}>\n                    <Icon className=\"w-6 h-6 transition-transform duration-200 group-hover:scale-105\" aria-hidden />\n                  </div>\n                  {feature.stat && (\n                    <div className={`absolute top-5 ${feature.isHighlighted ? 'left-5' : 'right-5'} text-right`}>\n                      <div className={`text-base font-bold ${feature.text}`}>\n                        {reduceMotion ? feature.stat : feature.stat === '99%' ? (\n                          <CountUp end={99} suffix=\"%\" duration={1200} />\n                        ) : feature.stat === '24/7' ? (\n                          <CountUp end={24} suffix=\"/7\" duration={1200} />\n                        ) : (\n                          feature.stat\n                        )}\n                      </div>\n                      <div className=\"text-xs text-gray-500\">{feature.statLabel}</div>\n                    </div>\n                  )}\n                  {feature.isHighlighted && (\n                    <span className=\"absolute top-5 right-5 px-2.5 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-bold\">\n                      Prbld elszr\n                    </span>\n                  )}\n                  <h3 className={`text-lg font-bold ${feature.text} mb-1`}>{feature.title}</h3>\n                  <p className=\"text-sm text-gray-600 mb-auto\">{feature.subtitle}</p>\n                  <span className={`inline-flex items-center gap-2 text-sm font-semibold ${feature.text} mt-2`}>\n                    {feature.cta} <ArrowRight className=\"w-4 h-4 group-hover:translate-x-1 group-hover:scale-110 transition-transform duration-200\" aria-hidden />\n                  </span>\n                </div>\n              </button>\n            </div>\n            );\n          })}\n        </div>\n      </div>\n    </section>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport { \n  Shield, Truck, Award, Clock, Heart, Star, \n  ArrowRight, Check, TrendingUp, Zap, Users,\n  ShoppingBag, Package, Sparkles, RefreshCw\n} from 'lucide-react';\nimport SectionHeader from './SectionHeader';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getStockLevel } from '../../utils/helpers';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\nimport ProductCarousel from '../ui/ProductCarousel';\n\n/**\n * Social Proof & Trust Signals\n */\nexport const SocialProof = () => {\n  const [count, setCount] = useState(0);\n  const targetCount = 50247;\n\n  useEffect(() => {\n    const duration = 2000;\n    const steps = 60;\n    const increment = targetCount / steps;\n    let current = 0;\n\n    const timer = setInterval(() => {\n      current += increment;\n      if (current >= targetCount) {\n        setCount(targetCount);\n        clearInterval(timer);\n      } else {\n        setCount(Math.floor(current));\n      }\n    }, duration / steps);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const trustBadges = [\n    { icon: Shield, label: 'Biztonsgos fizets', color: 'blue' },\n    { icon: Truck, label: 'Ingyenes szllts', color: 'green' },\n    { icon: Award, label: '2 v garancia', color: 'purple' },\n    { icon: Clock, label: '24h gyflszolglat', color: 'orange' }\n  ];\n\n  const colorClasses = {\n    blue: 'from-blue-500 to-blue-600',\n    green: 'from-green-500 to-green-600',\n    purple: 'from-secondary-500 to-secondary-700',\n    orange: 'from-orange-500 to-orange-600'\n  };\n\n  return (\n    <section className=\"relative py-24 bg-[#0f1218] overflow-hidden\" aria-labelledby=\"social-proof-heading\">\n      <div className=\"absolute inset-0 opacity-25\" aria-hidden>\n        <div className=\"absolute -top-32 left-1/2 -translate-x-1/2 w-[920px] h-[920px] rounded-full blur-[160px] bg-primary-500/60\" />\n        <div className=\"absolute -bottom-40 right-0 w-[680px] h-[680px] rounded-full blur-[140px] bg-secondary-600/50\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n        <div className=\"text-center mb-14\">\n          <div className=\"inline-flex items-center gap-2 mb-6 px-4 py-2 bg-white/10 border border-white/15 rounded-full backdrop-blur-sm\">\n            <Users className=\"w-5 h-5 text-primary-400\" aria-hidden />\n            <span className=\"text-xs font-bold text-white/90 uppercase tracking-wider\">Trsadalmi bizonytk</span>\n          </div>\n          <h2 id=\"social-proof-heading\" className=\"text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tight text-white mb-4\">\n            {count.toLocaleString('hu-HU')}+\n          </h2>\n          <p className=\"text-lg sm:text-xl text-white/80\">\n            ember vlasztotta mr a Marketly-t\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-14\">\n          {trustBadges.map((badge, idx) => (\n            <div\n              key={idx}\n              className=\"group relative rounded-2xl border border-white/15 bg-white/10 backdrop-blur-md p-6 shadow-[0_8px_28px_rgba(0,0,0,0.22)] hover:shadow-[0_16px_44px_rgba(0,0,0,0.32)] hover:-translate-y-1 transition-all duration-300\"\n            >\n              <div className={`absolute inset-x-4 top-0 h-px bg-gradient-to-r ${colorClasses[badge.color]} opacity-80`} />\n              <div className={`w-14 h-14 rounded-2xl bg-gradient-to-br ${colorClasses[badge.color]} flex items-center justify-center mb-4 shadow-lg`}>\n                <badge.icon className=\"w-7 h-7 text-white\" aria-hidden />\n              </div>\n              <h3 className=\"font-semibold text-white text-base leading-tight\">\n                {badge.label}\n              </h3>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"text-center rounded-2xl border border-white/15 bg-white/10 backdrop-blur-sm py-8 px-6\">\n          <div className=\"flex justify-center gap-2 mb-4\">\n            {[...Array(5)].map((_, i) => (\n              <Star key={i} className=\"w-7 h-7 fill-amber-400 text-amber-400\" aria-hidden />\n            ))}\n          </div>\n          <p className=\"text-2xl sm:text-3xl font-bold text-white mb-1\">\n            4.9 / 5.0 tlagos rtkels\n          </p>\n          <p className=\"text-sm sm:text-base text-white/75\">\n            12,487 vals vlemny alapjn\n          </p>\n        </div>\n      </div>\n    </section>\n  );\n};\n\n/**\n * Live Product Showcase with Swipeable Carousel\n * - Random products on each load\n * - Touch swipe support for mobile\n * - Arrow navigation for desktop\n * - Compact mobile cards\n */\nconst SECTION_ID = 'customer-favorites';\n\nexport const LiveShowcase = ({ products = [], onProductClick, rotationTick = 0 }) => {\n  const [seed, setSeed] = useState(0);\n  const [isInteracting, setIsInteracting] = useState(false);\n  const [isInView, setIsInView] = useState(true);\n  const sectionRef = useRef(null);\n\n  // Randomize and select products on each render\n  const showcaseProducts = React.useMemo(() => {\n    if (products.length > 0) {\n      const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true));\n      const shuffled = [...inStock].sort(() => (seed % 2 === 0 ? 1 : -1) * (Math.random() - 0.5));\n      return shuffled.slice(0, 12);\n    }\n    return [];\n  }, [products, seed]);\n\n  useEffect(() => {\n    trackSectionEvent(SECTION_ID, 'section_impression');\n  }, []);\n\n  useEffect(() => {\n    if (!rotationTick || isInView || isInteracting) return;\n    setSeed((v) => v + 1);\n  }, [rotationTick, isInView, isInteracting]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!sectionRef.current || !(sectionRef.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        setIsInView(entry.isIntersecting);\n      },\n      { threshold: 0.15 }\n    );\n    try {\n      observer.observe(sectionRef.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, []);\n\n  return (\n    <div\n      ref={sectionRef}\n      className=\"section-shell section-world section-world--favorites py-8 sm:py-10 lg:py-14 xl:py-16 overflow-hidden\"\n      role=\"region\"\n      aria-label=\"Vsrlink kedvencei\"\n      data-section={SECTION_ID}\n    >\n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16\">\n        <div className=\"section-frame\">\n          <SectionHeader\n            id=\"customer-favorites-heading\"\n            title=\"Vsrlink kedvencei\"\n            subtitle=\"A legjobbra rtkelt s legtbbet vlasztott btorok\"\n            Icon={Heart}\n            accentClass=\"from-pink-500 to-rose-600\"\n            eyebrow=\"Kzssgi kedvencek\"\n            badge=\"Kznsgkedvenc\"\n            prominent\n            className=\"border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites\"\n            meta={`sszesen: ${showcaseProducts.length.toLocaleString('hu-HU')} termk`}\n            helpText=\"Csak kszleten lv termkek\"\n            actions={\n              <button\n                type=\"button\"\n                onClick={() => setSeed((v) => v + 1)}\n                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Frisstem\n              </button>\n            }\n          />\n          {showcaseProducts.length > 0 ? (\n            <ProductCarousel className=\"mt-2\" onInteractionChange={setIsInteracting}>\n              {showcaseProducts.map((product, index) => {\n                const stockLevel = getStockLevel(product);\n                const highlightBadge = stockLevel !== null && stockLevel <= 3 ? `Utols ${stockLevel} db` : '';\n                return (\n                  <EnhancedProductCard\n                    key={product.id || index}\n                    product={product}\n                    onQuickView={onProductClick}\n                    index={index}\n                    highlightBadge={highlightBadge}\n                    sectionId={SECTION_ID}\n                    showFeedback\n                    size=\"compact\"\n                    tone=\"favorites\"\n                  />\n                );\n              })}\n            </ProductCarousel>\n          ) : (\n            <div className=\"text-center py-12 bg-white rounded-2xl shadow-inner\">\n              <Heart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n              <p className=\"text-gray-500\">Nincs elg adat a kedvencekhez</p>\n              <p className=\"text-gray-400 text-sm\">Trj vissza ksbb!</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Interactive CTA Section\n */\nexport const InteractiveCTA = ({ onGetStarted }) => {\n  return (\n    <section className=\"py-24 bg-gradient-to-br from-primary-500 to-secondary-700 relative overflow-hidden\">\n      <div className=\"absolute inset-0 opacity-10\" aria-hidden>\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-white rounded-full filter blur-[120px] animate-blob motion-reduce:animate-none\" />\n        <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-yellow-200 rounded-full filter blur-[120px] animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-3xl mx-auto px-4 sm:px-6 lg:px-16 text-center\">\n        <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-8\">\n          <Sparkles className=\"w-5 h-5 text-white\" aria-hidden />\n          <span className=\"text-xs font-bold text-white uppercase tracking-wider\">Kezdd el</span>\n        </div>\n\n        <h2 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight\">\n          Kszen llsz a tkletes btor megtallsra?\n        </h2>\n\n        <p className=\"text-lg text-white/90 mb-10\">\n          Csatlakozz 50.000+ elgedett vsrlnkhoz\n        </p>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n          <button\n            type=\"button\"\n            onClick={onGetStarted}\n            className=\"group w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-primary-600 rounded-xl font-semibold text-base shadow-2xl hover:shadow-white/30 hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2\"\n            aria-label=\"Bngszs indtsa\"\n          >\n            Bngszem a termkeket\n            <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n          </button>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { SocialProof, LiveShowcase, InteractiveCTA };\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Sparkles, ThumbsUp, ThumbsDown, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\nimport { generateText } from '../../services/geminiService';\nimport { \n  getSimilarProducts, \n  likeProduct, \n  dislikeProduct, \n  isProductLiked,\n  getDislikedProducts \n} from '../../services/userPreferencesService';\n\n/**\n * AI-Powered Similar Products Recommendation\n * Uses user preferences and AI for personalized recommendations\n */\nexport const SimilarProducts = ({ \n  currentProduct, \n  allProducts, \n  onToggleWishlist, \n  wishlist = [], \n  onQuickView,\n  onAddToCart,\n  maxResults = 4 \n}) => {\n  const [similarProducts, setSimilarProducts] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [aiReason, setAiReason] = useState('');\n\n  useEffect(() => {\n    if (currentProduct && allProducts.length > 0) {\n      findSimilarProducts();\n    }\n  }, [currentProduct, allProducts]);\n\n  const findSimilarProducts = async () => {\n    setIsLoading(true);\n    setAiReason('');\n\n    try {\n      // Elszr prbljuk a userPreferencesService-t (gyors, loklis)\n      const localSimilar = getSimilarProducts(currentProduct, allProducts, maxResults + 4);\n      \n      if (localSimilar.length >= maxResults) {\n        // Van elg loklis tallat\n        setSimilarProducts(localSimilar.slice(0, maxResults));\n        setAiReason('Szemlyre szabott ajnls a bngszsi elzmnyek alapjn');\n        setIsLoading(false);\n        return;\n      }\n\n      // Ha kevs loklis tallat van, krjnk AI-tl is segtsget\n      const productContext = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .slice(0, 30)\n        .map(p => `${p.name} (${p.category}) - ${(p.salePrice || p.price || 0).toLocaleString('hu-HU')} Ft`)\n        .join('\\n');\n\n      const prompt = `A vsrl pp ezt nzi: \"${currentProduct.name}\" (${currentProduct.category})\nr: ${(currentProduct.salePrice || currentProduct.price || 0).toLocaleString('hu-HU')} Ft\n\nElrhet termkek:\n${productContext}\n\nAjnlj 4 hasonl termket ami illik hozz! \nVlaszolj egyetlen mondatban, hogy MIRT passzolnak ezek.\nCsak az indoklst rd meg, ne a termkneveket!`;\n\n      const result = await generateText(prompt, { temperature: 0.7, maxTokens: 100 });\n      \n      if (result.success && result.text) {\n        setAiReason(result.text);\n      }\n\n      // Kombinljuk a loklis s egyszer hasonlsgot\n      const combined = localSimilar.length > 0 \n        ? localSimilar \n        : findBasicSimilar();\n      \n      setSimilarProducts(combined.slice(0, maxResults));\n\n    } catch (error) {\n      console.warn('Similar products error:', error);\n      setSimilarProducts(findBasicSimilar());\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const findBasicSimilar = () => {\n    // Basic similarity: same category, similar price range\n    const price = currentProduct.salePrice || currentProduct.price || 0;\n    const priceRange = price * 0.4; // 40%\n    const dislikedIds = getDislikedProducts();\n    \n    const similar = allProducts\n      .filter(p => \n        p.id !== currentProduct.id &&\n        !dislikedIds.includes(p.id) &&\n        (p.category || '').includes((currentProduct.category || '').split(' > ')[0]) &&\n        Math.abs((p.salePrice || p.price || 0) - price) <= priceRange\n      )\n      .sort(() => Math.random() - 0.5)\n      .slice(0, maxResults);\n\n    return similar;\n  };\n\n  // Feedback kezels\n  const handleLike = (productId) => {\n    likeProduct(productId);\n  };\n\n  const handleDislike = (productId) => {\n    dislikeProduct(productId);\n    // Eltvoltjuk a listbl\n    setSimilarProducts(prev => prev.filter(p => p.id !== productId));\n  };\n\n  if (similarProducts.length === 0 && !isLoading) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gradient-to-br from-secondary-50 to-primary-50 py-8 sm:py-12 px-4 sm:px-6 lg:px-8 my-8 sm:my-16 rounded-2xl sm:rounded-3xl\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 sm:mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-500\" />\n              <h2 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900\">\n                Neked ajnljuk\n              </h2>\n            </div>\n            {aiReason && (\n              <p className=\"text-sm sm:text-base text-gray-600 max-w-xl\">\n                {aiReason}\n              </p>\n            )}\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"flex items-center gap-3 text-primary-500\">\n              <Sparkles className=\"w-6 h-6 animate-pulse\" />\n              <span className=\"text-base sm:text-lg font-medium\">Szemlyre szabott ajnls kszl...</span>\n            </div>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6\">\n            {similarProducts.map((product, index) => (\n              <div key={product.id} className=\"relative group\">\n                <EnhancedProductCard\n                  product={product}\n                  onToggleWishlist={onToggleWishlist}\n                  isWishlisted={wishlist.includes(product.id)}\n                  onQuickView={onQuickView}\n                  onAddToCart={onAddToCart}\n                  showBadges={false}\n                  index={index}\n                />\n                \n                {/* Feedback buttons */}\n                <div className=\"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleLike(product.id); }}\n                    className={`p-1.5 rounded-full bg-white shadow-sm ${isProductLiked(product.id) ? 'text-green-600' : 'text-gray-400 hover:text-green-600'} transition-colors`}\n                    title=\"Tetszik\"\n                  >\n                    <ThumbsUp className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleDislike(product.id); }}\n                    className=\"p-1.5 rounded-full bg-white shadow-sm text-gray-400 hover:text-red-600 transition-colors\"\n                    title=\"Nem tetszik\"\n                  >\n                    <ThumbsDown className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import React, { useEffect, useState } from 'react';\nimport { Clock, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\n\n/**\n * Recently Viewed Products - Tracks and displays user's browsing history\n */\nexport const RecentlyViewed = ({ \n  onToggleWishlist, \n  wishlist, \n  onQuickView,\n  onAddToCart,\n  maxItems = 4 \n}) => {\n  const [recentProducts, setRecentProducts] = useState([]);\n\n  useEffect(() => {\n    // Load from localStorage\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    setRecentProducts(recent.slice(0, maxItems));\n\n    // Listen for storage changes (when new product is viewed)\n    const handleStorageChange = () => {\n      const updated = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n      setRecentProducts(updated.slice(0, maxItems));\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    window.addEventListener('recently-viewed-updated', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n      window.removeEventListener('recently-viewed-updated', handleStorageChange);\n    };\n  }, [maxItems]);\n\n  if (recentProducts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 my-16\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Clock className=\"w-6 h-6 text-gray-600\" />\n              <h2 className=\"text-2xl sm:text-3xl font-bold text-gray-900\">\n                Utoljra megtekintett\n              </h2>\n            </div>\n            <p className=\"text-gray-600\">\n              Bngssz vissza a nemrg nzett termkek kztt\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {recentProducts.map(product => (\n            <EnhancedProductCard\n              key={product.id}\n              product={product}\n              onToggleWishlist={onToggleWishlist}\n              isWishlisted={wishlist.includes(product.id)}\n              onQuickView={onQuickView}\n              onAddToCart={onAddToCart}\n              showBadges={false}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Utility function to track viewed products\n * Call this when a product is viewed (e.g., in ProductModal)\n */\nexport const trackProductView = (product) => {\n  try {\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    \n    // Remove if already exists\n    const filtered = recent.filter(p => p.id !== product.id);\n    \n    // Add to beginning\n    const updated = [product, ...filtered].slice(0, 10); // Keep max 10\n    \n    localStorage.setItem('recently_viewed', JSON.stringify(updated));\n    \n    // Dispatch custom event\n    window.dispatchEvent(new Event('recently-viewed-updated'));\n  } catch (error) {\n    console.error('Error tracking product view:', error);\n  }\n};\n","import React, { useState } from 'react';\nimport { X, Check, ArrowLeftRight, Plus } from 'lucide-react';\nimport { formatPrice, PLACEHOLDER_IMAGE } from '../../utils/helpers';\n\n/**\n * Product Comparison Tool\n */\nexport const ProductComparison = ({ \n  comparisonList = [], \n  onRemove, \n  onClear,\n  onAddMore \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  if (comparisonList.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Floating Comparison Button - mobile aware of 40px UNAS bottom nav */}\n      <button\n        onClick={() => setIsExpanded(true)}\n        className=\"fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-4 md:left-auto md:right-6 z-40 bg-primary-500 text-white px-4 md:px-6 py-2.5 md:py-3 rounded-full shadow-2xl hover:bg-primary-600 transition-all flex items-center gap-2 hover:scale-105 transform text-sm md:text-base\"\n      >\n        <ArrowLeftRight className=\"w-4 h-4 md:w-5 md:h-5\" />\n        <span className=\"font-bold\">sszehasonlts ({comparisonList.length})</span>\n      </button>\n\n      {/* Comparison Modal */}\n      {isExpanded && (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in\" onClick={() => setIsExpanded(false)}>\n          <div className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col\" onClick={e => e.stopPropagation()}>\n            {/* Header */}\n            <div className=\"p-6 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-primary-50 to-secondary-50\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n                  <ArrowLeftRight className=\"w-6 h-6 text-primary-500\" />\n                  Termkek sszehasonltsa\n                </h2>\n                <p className=\"text-sm text-gray-600 mt-1\">\n                  {comparisonList.length} termk kivlasztva\n                </p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={onClear}\n                  className=\"px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-xl transition-colors font-medium\"\n                >\n                  sszes trlse\n                </button>\n                <button\n                  onClick={() => setIsExpanded(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Comparison Table */}\n            <div className=\"flex-1 overflow-auto p-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {comparisonList.map((product) => (\n                  <div key={product.id} className=\"border border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg transition-shadow relative\">\n                    {/* Remove button */}\n                    <button\n                      onClick={() => onRemove(product.id)}\n                      className=\"absolute top-3 right-3 z-10 bg-white/90 p-1.5 rounded-full shadow-md hover:bg-red-50 hover:text-red-600 transition-colors\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </button>\n\n                    {/* Image */}\n                    <div className=\"h-48 bg-gray-50 flex items-center justify-center p-4\">\n                      <img\n                        src={product.images?.[0] || PLACEHOLDER_IMAGE}\n                        alt={product.name}\n                        className=\"max-h-full max-w-full object-contain\"\n                        onError={(e) => {e.target.src = PLACEHOLDER_IMAGE}}\n                      />\n                    </div>\n\n                    {/* Details */}\n                    <div className=\"p-4 space-y-3\">\n                      <h3 className=\"font-bold text-lg text-gray-900 line-clamp-2\">{product.name}</h3>\n                      \n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">r:</span>\n                          <span className=\"font-bold text-primary-500 text-lg\">{formatPrice(product.price)}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kategria:</span>\n                          <span className=\"font-medium text-gray-900\">{product.category}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kszlet:</span>\n                          <span className={`font-medium ${product.inStock ? 'text-green-600' : 'text-red-600'}`}>\n                            {product.inStock ? 'Raktron' : 'Nincs raktron'}\n                          </span>\n                        </div>\n\n                        {product.params && (\n                          <div className=\"pt-2\">\n                            <span className=\"text-gray-600 text-xs block mb-1\">Paramterek:</span>\n                            <p className=\"text-gray-700 text-xs line-clamp-3\">{product.params}</p>\n                          </div>\n                        )}\n                      </div>\n\n                      <a\n                        href={product.link}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"block w-full bg-primary-500 text-white py-2 rounded-xl text-center font-bold hover:bg-primary-600 transition-colors text-sm mt-4\"\n                      >\n                        Megveszem\n                      </a>\n                    </div>\n                  </div>\n                ))}\n\n                {/* Add More */}\n                {comparisonList.length < 6 && (\n                  <div\n                    onClick={() => {\n                      setIsExpanded(false);\n                      onAddMore?.();\n                    }}\n                    className=\"border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center p-8 hover:border-primary-400 hover:bg-primary-50 transition-all cursor-pointer\"\n                  >\n                    <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                      <Plus className=\"w-8 h-8 text-gray-400\" />\n                    </div>\n                    <p className=\"text-gray-600 font-medium\">Mg tbb termk</p>\n                    <p className=\"text-gray-400 text-sm mt-1\">Max. 6 termk</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Comparison Toggle Button for Product Cards\n */\nexport const ComparisonToggle = ({ product, isInComparison, onToggle }) => {\n  return (\n    <button\n      onClick={(e) => {\n        e.stopPropagation();\n        onToggle(product);\n      }}\n      className={`p-2 rounded-full shadow-md transition-all transform hover:scale-110 ${\n        isInComparison\n          ? 'bg-primary-500 text-white'\n          : 'bg-white text-gray-600 hover:bg-primary-50 hover:text-primary-500'\n      }`}\n      title={isInComparison ? 'Eltvolts az sszehasonltsbl' : 'Hozzads az sszehasonltshoz'}\n    >\n      <ArrowLeftRight className=\"w-4 h-4\" />\n    </button>\n  );\n};\n\n/**\n * Hook for managing comparison list\n */\nexport const useComparison = () => {\n  const [comparisonList, setComparisonList] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem('comparison_list') || '[]');\n    } catch {\n      return [];\n    }\n  });\n\n  const addToComparison = (product) => {\n    if (comparisonList.length >= 6) {\n      return { success: false, message: 'Maximum 6 termk hasonlthat ssze' };\n    }\n    \n    if (comparisonList.find(p => p.id === product.id)) {\n      return { success: false, message: 'Ez a termk mr az sszehasonltsban van' };\n    }\n\n    const updated = [...comparisonList, product];\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n    return { success: true, message: 'Hozzadva az sszehasonltshoz' };\n  };\n\n  const removeFromComparison = (productId) => {\n    const updated = comparisonList.filter(p => p.id !== productId);\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n  };\n\n  const clearComparison = () => {\n    setComparisonList([]);\n    localStorage.removeItem('comparison_list');\n  };\n\n  const toggleComparison = (product) => {\n    const exists = comparisonList.find(p => p.id === product.id);\n    if (exists) {\n      removeFromComparison(product.id);\n      return { success: true, message: 'Eltvoltva az sszehasonltsbl', action: 'removed' };\n    } else {\n      return { ...addToComparison(product), action: 'added' };\n    }\n  };\n\n  const isInComparison = (productId) => {\n    return comparisonList.some(p => p.id === productId);\n  };\n\n  return {\n    comparisonList,\n    addToComparison,\n    removeFromComparison,\n    clearComparison,\n    toggleComparison,\n    isInComparison\n  };\n};\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Filter, X, DollarSign, Package, Tag } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * Shared filter panel content (controlled). Used in desktop dropdown and mobile BottomSheet.\n * products, filters (from parent), onFilterChange(filters), onApply() when \"Alkalmaz\" is clicked.\n */\nexport const AdvancedFiltersPanel = ({\n  products = [],\n  filters = {},\n  onFilterChange,\n  onApply,\n  showHeader = true,\n  onCloseHeader\n}) => {\n  const priceRange = useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity, max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  const categories = useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  const effective = useMemo(() => ({\n    priceMin: filters.priceMin ?? priceRange.min,\n    priceMax: filters.priceMax ?? priceRange.max,\n    inStockOnly: filters.inStockOnly ?? false,\n    categories: Array.isArray(filters.categories) ? filters.categories : []\n  }), [filters, priceRange]);\n\n  const previousFiltersRef = React.useRef(null);\n  const [hasRestorableFilters, setHasRestorableFilters] = useState(false);\n\n  const handlePriceChange = (type, value) => {\n    const v = parseInt(value, 10);\n    if (Number.isNaN(v)) return;\n    onFilterChange?.({ ...effective, [type]: v });\n  };\n\n  const toggleCategory = (cat) => {\n    const next = effective.categories.includes(cat)\n      ? effective.categories.filter(c => c !== cat)\n      : [...effective.categories, cat];\n    onFilterChange?.({ ...effective, categories: next });\n  };\n\n  const clearFilters = () => {\n    previousFiltersRef.current = { ...effective };\n    setHasRestorableFilters(true);\n    onFilterChange?.({\n      priceMin: priceRange.min,\n      priceMax: priceRange.max,\n      inStockOnly: false,\n      categories: []\n    });\n  };\n\n  const restorePrevious = () => {\n    if (previousFiltersRef.current) {\n      onFilterChange?.(previousFiltersRef.current);\n      previousFiltersRef.current = null;\n      setHasRestorableFilters(false);\n    }\n  };\n\n  const activeCount = [\n    effective.inStockOnly,\n    effective.categories.length > 0,\n    effective.priceMin > priceRange.min,\n    effective.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  return (\n    <>\n      {showHeader && (\n        <div className=\"p-4 border-b border-gray-200 flex justify-between items-center shrink-0\">\n          <h3 className=\"font-bold text-lg flex items-center gap-2\">\n            <Filter className=\"w-5 h-5 text-primary-500\" />\n            Szrk\n          </h3>\n          {onCloseHeader && (\n            <button type=\"button\" onClick={onCloseHeader} className=\"p-2 min-w-[44px] min-h-[44px] flex items-center justify-center hover:bg-gray-100 rounded-lg transition-colors\" aria-label=\"Szrk bezrsa\">\n              <X className=\"w-5 h-5 text-gray-600\" />\n            </button>\n          )}\n        </div>\n      )}\n      <div className=\"p-4 space-y-6 max-h-[60vh] md:max-h-96 overflow-y-auto custom-scrollbar flex-1 min-h-0\">\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-3\">\n            <DollarSign className=\"w-4 h-4\" />\n            r tartomny\n          </label>\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"text-xs text-gray-600\">Minimum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMin} onChange={(e) => handlePriceChange('priceMin', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMin)}</div>\n            </div>\n            <div>\n              <label className=\"text-xs text-gray-600\">Maximum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMax} onChange={(e) => handlePriceChange('priceMax', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMax)}</div>\n            </div>\n          </div>\n        </div>\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n            <Package className=\"w-4 h-4\" />\n            Kszlet\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input type=\"checkbox\" checked={effective.inStockOnly} onChange={(e) => onFilterChange?.({ ...effective, inStockOnly: e.target.checked })} className=\"w-4 h-4 text-primary-500 rounded\" />\n            <span className=\"text-sm text-gray-700\">Csak raktron lv termkek</span>\n          </label>\n        </div>\n        {categories.length > 0 && (\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n              <Tag className=\"w-4 h-4\" />\n              Kategrik\n            </label>\n            <div className=\"space-y-1 max-h-40 overflow-y-auto\">\n              {categories.map(cat => (\n                <label key={cat} className=\"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded\">\n                  <input type=\"checkbox\" checked={effective.categories.includes(cat)} onChange={() => toggleCategory(cat)} className=\"w-4 h-4 text-primary-500 rounded\" />\n                  <span className=\"text-sm text-gray-700\">{cat}</span>\n                </label>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n      <div className=\"p-4 border-t border-gray-200 flex flex-wrap gap-2 shrink-0\">\n        <button type=\"button\" onClick={clearFilters} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-gray-300 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors\">Trls</button>\n        {hasRestorableFilters && (\n          <button type=\"button\" onClick={restorePrevious} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-primary-300 rounded-xl text-sm font-medium text-primary-600 hover:bg-primary-50 transition-colors\">Visszallts</button>\n        )}\n        <button type=\"button\" onClick={onApply} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl text-sm font-bold hover:bg-primary-600 transition-colors\">Alkalmaz</button>\n      </div>\n    </>\n  );\n};\n\n/**\n * Advanced Filters (desktop: button + dropdown)\n */\nexport const AdvancedFilters = ({ \n  products = [],\n  onFilterChange,\n  initialFilters = {}\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [filters, setFilters] = useState({\n    priceMin: initialFilters.priceMin || 0,\n    priceMax: initialFilters.priceMax || 1000000,\n    inStockOnly: initialFilters.inStockOnly || false,\n    categories: initialFilters.categories || [],\n    ...initialFilters\n  });\n\n  // Calculate price range from products (avoid Math.min/max spread  168k args = stack overflow)\n  const priceRange = React.useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity;\n    let max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  // Get unique categories (limit to 500 to avoid huge lists; sample if needed)\n  const categories = React.useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  // Extract colors and materials from params (sample to avoid long loop on 168k)\n  const extractedAttributes = React.useMemo(() => {\n    const colors = new Set();\n    const materials = new Set();\n    const step = Math.max(1, Math.floor(products.length / 5000));\n    for (let i = 0; i < products.length; i += step) {\n      const p = products[i];\n      if (p.params) {\n        const params = p.params.toLowerCase();\n        // Simple extraction - can be enhanced\n        if (params.includes('szn:') || params.includes('szne:')) {\n          const match = params.match(/szn[e]?:\\s*([^,]+)/i);\n          if (match) colors.add(match[1].trim());\n        }\n        if (params.includes('anyag:')) {\n          const match = params.match(/anyag:\\s*([^,]+)/i);\n          if (match) materials.add(match[1].trim());\n        }\n      }\n    }\n\n    return {\n      colors: Array.from(colors).slice(0, 10),\n      materials: Array.from(materials).slice(0, 10)\n    };\n  }, [products]);\n\n  useEffect(() => {\n    onFilterChange?.(filters);\n  }, [filters]);\n\n  const activeFilterCount = [\n    filters.inStockOnly,\n    filters.categories.length > 0,\n    filters.priceMin > priceRange.min,\n    filters.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  const panelContent = (\n    <AdvancedFiltersPanel\n      products={products}\n      filters={filters}\n      onFilterChange={(next) => {\n        setFilters(next);\n        onFilterChange?.(next);\n      }}\n      onApply={() => setIsOpen(false)}\n      showHeader={true}\n      onCloseHeader={() => setIsOpen(false)}\n    />\n  );\n\n  return (\n    <>\n      {/* Filter Toggle Button */}\n      <button\n        type=\"button\"\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"relative px-4 py-2 min-h-[44px] border-2 border-gray-200 rounded-xl hover:border-primary-500 transition-all flex items-center gap-2 font-medium\"\n        aria-label=\"Szrk megnyitsa\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        <span>Szrk</span>\n        {activeFilterCount > 0 && (\n          <span className=\"absolute -top-2 -right-2 bg-primary-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center\">\n            {activeFilterCount}\n          </span>\n        )}\n      </button>\n\n      {/* Mobile: full-screen overlay + bottom sheet */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-end md:hidden\" role=\"dialog\" aria-label=\"Szrk\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setIsOpen(false)} aria-hidden=\"true\" />\n          <div className=\"relative w-full max-h-[85vh] bg-white rounded-t-2xl shadow-2xl flex flex-col animate-fade-in-down\">\n            {panelContent}\n          </div>\n        </div>\n      )}\n\n      {/* Desktop: dropdown panel */}\n      {isOpen && (\n        <div className=\"hidden md:block absolute top-full right-0 mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 animate-fade-in-down\">\n          {panelContent}\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Apply filters to product list\n */\nexport const applyFilters = (products, filters) => {\n  return products.filter(product => {\n    // Price filter\n    if (product.price < filters.priceMin || product.price > filters.priceMax) {\n      return false;\n    }\n\n    // Stock filter (support both inStock and in_stock)\n    if (filters.inStockOnly && !(product.inStock ?? product.in_stock)) {\n      return false;\n    }\n\n    // Category filter\n    if (filters.categories.length > 0 && !filters.categories.includes(product.category)) {\n      return false;\n    }\n\n    return true;\n  });\n};\n","import React, { useState } from 'react';\nimport { ShoppingCart, Check, Loader2 } from 'lucide-react';\n\n/**\n * QuickAddToCart - One-click add to cart with visual feedback\n * Uses CSS transitions instead of framer-motion\n */\nconst QuickAddToCart = ({ product, onAdd, className = '' }) => {\n  const [isAdding, setIsAdding] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  const handleQuickAdd = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (window.navigator?.vibrate) {\n      window.navigator.vibrate(50);\n    }\n\n    setIsAdding(true);\n\n    try {\n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      if (onAdd) {\n        await onAdd(product);\n      }\n\n      setShowSuccess(true);\n      \n      setTimeout(() => {\n        setShowSuccess(false);\n        setIsAdding(false);\n      }, 2000);\n\n    } catch (error) {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleQuickAdd}\n      disabled={isAdding || showSuccess}\n      className={`\n        relative overflow-hidden\n        flex items-center justify-center gap-2\n        px-4 py-2 rounded-lg\n        font-medium text-sm\n        transition-all duration-200\n        transform hover:scale-105 active:scale-95\n        ${showSuccess \n          ? 'bg-green-500 text-white' \n          : 'bg-primary-500 text-white hover:bg-primary-600'\n        }\n        disabled:opacity-80\n        ${className}\n      `}\n    >\n      {isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n          <span>Hozzads...</span>\n        </span>\n      )}\n\n      {showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Check className=\"w-4 h-4\" />\n          <span>Hozzadva!</span>\n        </span>\n      )}\n\n      {!isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <ShoppingCart className=\"w-4 h-4\" />\n          <span>Kosrba</span>\n        </span>\n      )}\n    </button>\n  );\n};\n\nexport default QuickAddToCart;\n","import React, { useState, useEffect } from 'react';\nimport { X, ShoppingCart, Heart, Share2, ExternalLink, Sparkles, Bell } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport QuickAddToCart from './QuickAddToCart';\nimport { PLACEHOLDER_IMAGE, formatPrice } from '../../utils/helpers';\nimport { getOptimizedImageProps } from '../../utils/imageOptimizer';\nimport {\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n/**\n * ProductQuickPeek - Hover/click modal for quick product preview\n * Shows essential info without full page navigation\n */\nconst ProductQuickPeek = ({ product, isOpen, onClose, onAddToCart }) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [activeImage, setActiveImage] = useState(0);\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n\n  useEffect(() => {\n    if (isOpen) {\n      setImageLoaded(false);\n      setActiveImage(0);\n      setFeedbackState({\n        liked: isProductLiked(product?.id),\n        disliked: isProductDisliked(product?.id)\n      });\n      // Prevent body scroll\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = 'unset';\n    }\n\n    return () => {\n      document.body.style.overflow = 'unset';\n    };\n  }, [isOpen]);\n\n  if (!product) return null;\n\n  // Parse product images (array or single)\n  const images = Array.isArray(product.images) && product.images.length > 0\n    ? product.images\n    : product.image ? [product.image] : [];\n  const imageProps = getOptimizedImageProps(images[activeImage] || product.image || PLACEHOLDER_IMAGE, product.name, { responsive: true, lazy: false });\n  \n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Wrapper: always center modal on screen (safe area for mobile) */}\n          <div className=\"fixed inset-0 lg:top-[60px] flex items-center justify-center p-4 z-[9999] pointer-events-none overflow-y-auto\">\n            {/* Modal: centered, scrolls on small screens */}\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.9, y: 20 }}\n              transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n              className=\"w-full max-w-4xl max-h-[90vh] my-auto pointer-events-auto flex flex-col\"\n            >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] min-h-0\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-secondary-50\">\n                <div className=\"flex items-center gap-2\">\n                  <Sparkles className=\"w-5 h-5 text-primary-500\" />\n                  <h3 className=\"text-lg font-bold text-gray-900\">Gyors elnzet</h3>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  className=\"p-2 min-h-[44px] min-w-[44px] flex items-center justify-center hover:bg-white rounded-lg transition-colors\"\n                  aria-label=\"Bezrs\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n\n              {/* Content: scrollable, keeps modal centered */}\n              <div className=\"flex-1 min-h-0 overflow-y-auto\">\n                <div className=\"grid md:grid-cols-2 gap-6 p-6\">\n                  {/* Left: Image */}\n                  <div className=\"space-y-4\">\n                    <div className=\"relative aspect-square bg-gray-100 rounded-xl overflow-hidden group\">\n                      <img\n                        src={imageProps.src || (images[activeImage] || product.image || PLACEHOLDER_IMAGE)}\n                        alt={product.name}\n                        onLoad={() => setImageLoaded(true)}\n                        className={`\n                          w-full h-full object-cover\n                          transition-all duration-300\n                          ${imageLoaded ? 'opacity-100 scale-100' : 'opacity-0 scale-105'}\n                        `}\n                        srcSet={imageProps.srcSet}\n                        sizes={imageProps.sizes}\n                      />\n                      \n                      {!imageLoaded && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                          <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                        </div>\n                      )}\n\n                      {/* Quick View Badge */}\n                      <div className=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-primary-500\">\n                        Gyors elnzet\n                      </div>\n                    </div>\n\n                    {/* Additional images thumbnails (if any) */}\n                    {images.length > 1 && (\n                      <div className=\"flex gap-2 overflow-x-auto\">\n                        {images.map((img, idx) => (\n                          <button\n                            key={idx}\n                            onClick={() => setActiveImage(idx)}\n                            className={`\n                              flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                              ${activeImage === idx ? 'border-primary-500 scale-110' : 'border-gray-200 hover:border-primary-300'}\n                            `}\n                          >\n                            <img src={img} alt={`${product.name} ${idx + 1}`} className=\"w-full h-full object-cover\" />\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Right: Info */}\n                  <div className=\"flex flex-col gap-4\">\n                    {/* Category */}\n                    <div className=\"inline-flex items-center gap-2 text-sm text-primary-500 font-medium\">\n                      <span>{product.category}</span>\n                    </div>\n\n                    {/* Title */}\n                    <h2 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n                      {product.name}\n                    </h2>\n\n                    {/* Price */}\n                    <div className=\"flex items-baseline gap-2\">\n                      <span className=\"text-3xl font-bold text-primary-500\">\n                        {formatPrice(product.price)}\n                      </span>\n                      {product.originalPrice && product.originalPrice > product.price && (\n                        <span className=\"text-lg text-gray-400 line-through\">\n                          {formatPrice(product.originalPrice)}\n                        </span>\n                      )}\n                    </div>\n\n                    {/* Description/Params */}\n                    {product.params && (\n                      <div className=\"prose prose-sm max-w-none text-gray-600\">\n                        <p>{product.params.substring(0, 200)}{product.params.length > 200 ? '...' : ''}</p>\n                      </div>\n                    )}\n\n                    {/* Features/Specs (if available) */}\n                    <div className=\"border-t border-b border-gray-200 py-4 space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">llapot</span>\n                        <span className={`font-medium ${(product.inStock ?? product.in_stock) ? 'text-green-600' : 'text-red-500'}`}>\n                          {(product.inStock ?? product.in_stock) ? 'Raktron' : 'Kszlethiny'}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">Szllts</span>\n                        <span className=\"font-medium\">2-5 munkanap</span>\n                      </div>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex gap-3 mt-auto\">\n                      {(product.inStock ?? product.in_stock) ? (\n                        <QuickAddToCart\n                          product={product}\n                          onAdd={onAddToCart}\n                          className=\"flex-1\"\n                        />\n                      ) : (\n                        <button\n                          type=\"button\"\n                          onClick={() => requestBackInStock(product)}\n                          className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 border-gray-200 text-gray-700 font-semibold hover:bg-gray-50\"\n                        >\n                          <Bell className=\"w-4 h-4\" />\n                          rtestst krek\n                        </button>\n                      )}\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Add to wishlist logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-red-500 hover:text-red-500 transition-colors\"\n                      >\n                        <Heart className=\"w-5 h-5\" />\n                      </button>\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Share logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:text-primary-500 transition-colors\"\n                      >\n                        <Share2 className=\"w-5 h-5\" />\n                      </button>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleLikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.liked\n                            ? 'bg-green-600 text-white border-green-600'\n                            : 'bg-green-50 text-green-700 border-green-100 hover:bg-green-100'\n                        }`}\n                      >\n                        Tetszik\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleDislikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.disliked\n                            ? 'bg-gray-900 text-white border-gray-900'\n                            : 'bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100'\n                        }`}\n                      >\n                        Nem tetszik\n                      </button>\n                    </div>\n\n                    {/* Full Details Link */}\n                    <a\n                      href={product.link}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center justify-center gap-2 text-sm text-primary-500 hover:text-primary-600 font-medium py-2\"\n                    >\n                      <span>Teljes lers megtekintse</span>\n                      <ExternalLink className=\"w-4 h-4\" />\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </div>\n            </motion.div>\n          </div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default ProductQuickPeek;\n","import React, { useState, useEffect } from 'react';\nimport { X, Mail, Gift, Sparkles, CheckCircle } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * SmartNewsletterPopup - Intelligent newsletter popup\n * Shows based on exit intent, time on site, and scroll depth\n */\nconst SmartNewsletterPopup = ({ onSubscribe }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    // Check if user already dismissed or subscribed\n    const dismissed = localStorage.getItem('newsletter_dismissed');\n    const subscribed = localStorage.getItem('newsletter_subscribed');\n    \n    if (dismissed || subscribed) {\n      return;\n    }\n\n    let timeOnSiteTimeout;\n    let scrollDepthTriggered = false;\n    let exitIntentTriggered = false;\n\n    // Strategy 1: Time on site (30 seconds)\n    timeOnSiteTimeout = setTimeout(() => {\n      if (!scrollDepthTriggered && !exitIntentTriggered) {\n        setIsVisible(true);\n      }\n    }, 30000);\n\n    // Strategy 2: Scroll depth (70%)\n    const handleScroll = () => {\n      if (scrollDepthTriggered) return;\n\n      const scrolled = window.pageYOffset;\n      const height = document.documentElement.scrollHeight - window.innerHeight;\n      const scrollPercent = (scrolled / height) * 100;\n\n      if (scrollPercent > 70) {\n        scrollDepthTriggered = true;\n        clearTimeout(timeOnSiteTimeout);\n        setIsVisible(true);\n      }\n    };\n\n    // Strategy 3: Exit intent (mouse leaving viewport)\n    const handleMouseLeave = (e) => {\n      if (exitIntentTriggered) return;\n      \n      if (e.clientY <= 0) {\n        exitIntentTriggered = true;\n        clearTimeout(timeOnSiteTimeout);\n        setIsVisible(true);\n      }\n    };\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    document.addEventListener('mouseleave', handleMouseLeave);\n\n    return () => {\n      clearTimeout(timeOnSiteTimeout);\n      window.removeEventListener('scroll', handleScroll);\n      document.removeEventListener('mouseleave', handleMouseLeave);\n    };\n  }, []);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    localStorage.setItem('newsletter_dismissed', Date.now().toString());\n    // Show again after 7 days\n    setTimeout(() => {\n      localStorage.removeItem('newsletter_dismissed');\n    }, 7 * 24 * 60 * 60 * 1000);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      setError('Krlek adj meg egy rvnyes email cmet.');\n      return;\n    }\n\n    try {\n      // Here you would send to your newsletter service\n      if (onSubscribe) {\n        await onSubscribe(email);\n      }\n\n      setIsSubmitted(true);\n      localStorage.setItem('newsletter_subscribed', 'true');\n\n      // Close after 3 seconds\n      setTimeout(() => {\n        setIsVisible(false);\n      }, 3000);\n\n    } catch (err) {\n      setError('Hiba trtnt. Prbld jra ksbb!');\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={handleClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Popup */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[9999] w-[90%] max-w-md\"\n          >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden\">\n              {/* Header */}\n              <div className=\"relative bg-gradient-to-br from-primary-500 to-secondary-700 p-8 text-white\">\n                <button\n                  onClick={handleClose}\n                  className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n\n                <div className=\"flex items-center justify-center mb-4\">\n                  <div className=\"p-4 bg-white/20 backdrop-blur-sm rounded-full\">\n                    <Gift className=\"w-8 h-8\" />\n                  </div>\n                </div>\n\n                <h2 className=\"text-2xl font-bold text-center mb-2\">\n                  {isSubmitted ? 'Ksznjk!' : '10% KEDVEZMNY'}\n                </h2>\n                <p className=\"text-white/90 text-center text-sm\">\n                  {isSubmitted \n                    ? 'Feliratkoztl a hrlevelnkre!' \n                    : 'Iratkozz fel s kapd meg els vsrlsodhoz!'\n                  }\n                </p>\n              </div>\n\n              {/* Content */}\n              <div className=\"p-6\">\n                {!isSubmitted ? (\n                  <form onSubmit={handleSubmit} className=\"space-y-4\">\n                    {/* Benefits */}\n                    <div className=\"space-y-2 mb-4\">\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Exkluzv ajnlatok</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Korai hozzfrs j termkekhez</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Lakberendezsi tippek</span>\n                      </div>\n                    </div>\n\n                    {/* Email Input */}\n                    <div>\n                      <div className=\"relative\">\n                        <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                        <input\n                          type=\"email\"\n                          value={email}\n                          onChange={(e) => setEmail(e.target.value)}\n                          placeholder=\"Add meg az email cmed\"\n                          className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 outline-none transition-all\"\n                          required\n                        />\n                      </div>\n                      {error && (\n                        <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n                      )}\n                    </div>\n\n                    {/* Submit Button */}\n                    <button\n                      type=\"submit\"\n                      className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-3 rounded-lg transition-colors shadow-lg hover:shadow-xl\"\n                    >\n                      Feliratkozom!\n                    </button>\n\n                    {/* Privacy Notice */}\n                    <p className=\"text-xs text-gray-500 text-center\">\n                      Adataid biztonsgban vannak. Brmikor leiratkozhatsz.\n                    </p>\n                  </form>\n                ) : (\n                  <div className=\"text-center py-4\">\n                    <motion.div\n                      initial={{ scale: 0 }}\n                      animate={{ scale: 1 }}\n                      transition={{ type: 'spring', damping: 15 }}\n                      className=\"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4\"\n                    >\n                      <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                    </motion.div>\n                    <p className=\"text-gray-700 mb-2\">\n                      <strong>{email}</strong>\n                    </p>\n                    <p className=\"text-sm text-gray-600\">\n                      Nzd meg az email fikod a kedvezmny kdrt!\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default SmartNewsletterPopup;\n","import React, { useState, useEffect } from 'react';\nimport { X, Gift, Timer, Sparkles, ArrowRight, Mail, Check } from 'lucide-react';\n\n/**\n * ExitIntentPopup - Shows discount offer when user tries to leave\n * Also includes email capture for future marketing\n */\nconst ExitIntentPopup = ({ discountPercent = 10, onClose }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [hasShown, setHasShown] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [countdown, setCountdown] = useState(600); // 10 minutes\n\n  // Exit intent detection\n  useEffect(() => {\n    // Check if already shown in this session\n    if (sessionStorage.getItem('exitIntentShown')) {\n      return;\n    }\n\n    const handleMouseLeave = (e) => {\n      if (e.clientY <= 0 && !hasShown) {\n        setIsVisible(true);\n        setHasShown(true);\n        sessionStorage.setItem('exitIntentShown', 'true');\n      }\n    };\n\n    // Also show after 45 seconds of inactivity\n    let inactivityTimer;\n    const resetTimer = () => {\n      clearTimeout(inactivityTimer);\n      inactivityTimer = setTimeout(() => {\n        if (!hasShown) {\n          setIsVisible(true);\n          setHasShown(true);\n          sessionStorage.setItem('exitIntentShown', 'true');\n        }\n      }, 45000);\n    };\n\n    document.addEventListener('mouseleave', handleMouseLeave);\n    document.addEventListener('mousemove', resetTimer);\n    document.addEventListener('click', resetTimer);\n    resetTimer();\n\n    return () => {\n      document.removeEventListener('mouseleave', handleMouseLeave);\n      document.removeEventListener('mousemove', resetTimer);\n      document.removeEventListener('click', resetTimer);\n      clearTimeout(inactivityTimer);\n    };\n  }, [hasShown]);\n\n  // Countdown timer\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const timer = setInterval(() => {\n      setCountdown(prev => {\n        if (prev <= 1) {\n          clearInterval(timer);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [isVisible]);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    if (onClose) onClose();\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (email) {\n      // In real app: send to backend\n      localStorage.setItem('subscribedEmail', email);\n      setIsSubmitted(true);\n      \n      // Copy discount code\n      navigator.clipboard?.writeText(`MARADJ${discountPercent}`);\n      \n      setTimeout(() => {\n        handleClose();\n      }, 3000);\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fade-in\"\n      onClick={handleClose}\n    >\n      <div \n        className=\"relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden animate-scale-in\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors z-10\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n\n        {/* Decorative top section */}\n        <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-8 text-center relative overflow-hidden\">\n          {/* Animated background shapes */}\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob\" />\n            <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000\" />\n          </div>\n\n          <div className=\"relative\">\n            <div className=\"w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n              <Gift className=\"w-10 h-10 text-white\" />\n            </div>\n            <h2 className=\"text-3xl sm:text-4xl font-bold text-white mb-2\">\n              Vrj! Ne menj el!\n            </h2>\n            <p className=\"text-white/90 text-lg\">\n              Itt egy <span className=\"font-bold text-yellow-300\">{discountPercent}% kedvezmny</span> neked!\n            </p>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 sm:p-8\">\n          {!isSubmitted ? (\n            <>\n              {/* Timer */}\n              <div className=\"flex items-center justify-center gap-2 mb-6 text-red-600\">\n                <Timer className=\"w-5 h-5 animate-pulse\" />\n                <span className=\"font-bold text-lg\">\n                  Az ajnlat lejr: {formatTime(countdown)}\n                </span>\n              </div>\n\n              {/* Discount code */}\n              <div className=\"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-dashed border-amber-300 rounded-xl p-4 mb-6 text-center\">\n                <p className=\"text-sm text-gray-600 mb-1\">Kuponkd:</p>\n                <p className=\"text-2xl font-bold text-amber-600 tracking-wider\">\n                  MARADJ{discountPercent}\n                </p>\n              </div>\n\n              {/* Email form */}\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <p className=\"text-center text-gray-600 text-sm\">\n                  Add meg az email cmed s elkldjk a kuponkdot!\n                </p>\n                \n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-2 focus:ring-primary-200 outline-none transition-all text-lg\"\n                    required\n                  />\n                </div>\n\n                <button\n                  type=\"submit\"\n                  className=\"w-full py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-lg rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n                >\n                  <Sparkles className=\"w-5 h-5\" />\n                  Kedvezmny aktivlsa\n                  <ArrowRight className=\"w-5 h-5\" />\n                </button>\n              </form>\n\n              {/* No thanks */}\n              <button\n                onClick={handleClose}\n                className=\"w-full mt-4 py-2 text-gray-500 hover:text-gray-700 text-sm transition-colors\"\n              >\n                Nem, ksznm, inkbb teljes rat fizetek\n              </button>\n            </>\n          ) : (\n            /* Success state */\n            <div className=\"text-center py-8\">\n              <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-10 h-10 text-green-600\" />\n              </div>\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Ksznjk!</h3>\n              <p className=\"text-gray-600 mb-4\">\n                A kuponkd elmentve a vglapra!\n              </p>\n              <div className=\"bg-green-50 border border-green-200 rounded-xl p-4\">\n                <p className=\"text-green-800 font-bold text-xl\">MARADJ{discountPercent}</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes blob {\n          0%, 100% { transform: translate(0, 0) scale(1); }\n          33% { transform: translate(30px, -50px) scale(1.1); }\n          66% { transform: translate(-20px, 20px) scale(0.9); }\n        }\n        .animate-blob { animation: blob 7s infinite; }\n        .animation-delay-2000 { animation-delay: 2s; }\n        .animate-fade-in { animation: fadeIn 0.3s ease-out; }\n        .animate-scale-in { animation: scaleIn 0.3s ease-out; }\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ExitIntentPopup;\n","import React, { useState, useEffect } from 'react';\nimport { Box, Eye, Smartphone, X, AlertCircle } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * ARProductPreview - AR (Augmented Reality) product preview\n * Uses WebXR/AR Quick Look for supported devices\n */\nconst ARProductPreview = ({ product, onClose }) => {\n  const [isARAvailable, setIsARAvailable] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    checkARSupport();\n  }, []);\n\n  const checkARSupport = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Check for AR support\n      // WebXR (Android Chrome, Quest)\n      if ('xr' in navigator) {\n        const isSupported = await navigator.xr.isSessionSupported('immersive-ar');\n        setIsARAvailable(isSupported);\n      }\n      // AR Quick Look (iOS Safari)\n      else if (isIOSSafari()) {\n        setIsARAvailable(true);\n      }\n      // Fallback: no AR support\n      else {\n        setIsARAvailable(false);\n        setError('Az eszkzd nem tmogatja az AR megjelentst.');\n      }\n    } catch (err) {\n      setIsARAvailable(false);\n      setError('Nem sikerlt ellenrizni az AR tmogatst.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const isIOSSafari = () => {\n    const ua = navigator.userAgent;\n    const isIOS = /iPad|iPhone|iPod/.test(ua);\n    const isSafari = /Safari/.test(ua) && !/CriOS|FxiOS|OPiOS|mercury/.test(ua);\n    return isIOS && isSafari;\n  };\n\n  const handleARLaunch = () => {\n    if (!isARAvailable) return;\n\n    // For iOS: AR Quick Look\n    if (isIOSSafari()) {\n      // You would need USDZ file format for iOS AR\n      // Example: product.arModelUSDZ\n      const usdzUrl = product.arModelUSDZ || generateMockUSDZ(product);\n      \n      const anchor = document.createElement('a');\n      anchor.rel = 'ar';\n      anchor.href = usdzUrl;\n      anchor.appendChild(document.createElement('img'));\n      anchor.click();\n    }\n    // For Android: WebXR\n    else if ('xr' in navigator) {\n      launchWebXR();\n    }\n  };\n\n  const launchWebXR = async () => {\n    try {\n      const session = await navigator.xr.requestSession('immersive-ar', {\n        requiredFeatures: ['hit-test'],\n        optionalFeatures: ['dom-overlay']\n      });\n      \n      // Here you would initialize the WebXR rendering\n      // This is a simplified example\n      // In production, use libraries like three.js or babylon.js\n      \n      // Placeholder for WebXR session handling\n      session.addEventListener('end', () => {\n        // Cleanup\n      });\n      \n    } catch (err) {\n      setError('Nem sikerlt elindtani az AR nzetet.');\n    }\n  };\n\n  const generateMockUSDZ = (product) => {\n    // In production, you would have actual 3D models\n    // This is a placeholder that links to a sample USDZ file\n    // You can use services like Sketchfab, poly.google.com (deprecated), or custom 3D models\n    return `https://developer.apple.com/augmented-reality/quick-look/models/biplane/toy_biplane.usdz`;\n  };\n\n  const openInARViewer = () => {\n    // Alternative: Open in a web-based 3D viewer\n    // Using model-viewer web component (Google)\n    window.open(`https://arvr.google.com/scene-viewer?file=${product.arModel || ''}`, '_blank');\n  };\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 lg:top-[60px] bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.9, y: 20 }}\n          animate={{ scale: 1, y: 0 }}\n          exit={{ scale: 0.9, y: 20 }}\n          onClick={(e) => e.stopPropagation()}\n          className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 p-6 text-white relative\">\n            <button\n              onClick={onClose}\n              className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n            \n            <div className=\"flex items-center gap-3 mb-2\">\n              <Box className=\"w-6 h-6\" />\n              <h2 className=\"text-xl font-bold\">AR Elnzet</h2>\n            </div>\n            <p className=\"text-white/90 text-sm\">{product.name}</p>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            {isLoading && (\n              <div className=\"text-center py-8\">\n                <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n                <p className=\"text-gray-600\">AR kpessgek ellenrzse...</p>\n              </div>\n            )}\n\n            {!isLoading && error && (\n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4\">\n                <div className=\"flex items-start gap-3\">\n                  <AlertCircle className=\"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"text-sm text-yellow-800 font-medium mb-2\">{error}</p>\n                    <p className=\"text-xs text-yellow-700\">\n                      Az AR funkci csak iOS Safari vagy Android Chrome bngszben rhet el.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && isARAvailable && (\n              <div className=\"space-y-4\">\n                <div className=\"bg-gradient-to-br from-primary-50 to-secondary-50 rounded-xl p-6 text-center\">\n                  <div className=\"w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg\">\n                    <Eye className=\"w-10 h-10 text-primary-500\" />\n                  </div>\n                  <h3 className=\"font-bold text-gray-900 mb-2\">Nzd meg otthonodban!</h3>\n                  <p className=\"text-sm text-gray-600\">\n                    Helyezd el virtulisan a termket a sajt teremben AR segtsgvel.\n                  </p>\n                </div>\n\n                <button\n                  onClick={handleARLaunch}\n                  className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-4 rounded-xl transition-colors shadow-lg flex items-center justify-center gap-2\"\n                >\n                  <Smartphone className=\"w-5 h-5\" />\n                  AR Indtsa\n                </button>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">1</span>\n                    <span>Engedlyezd a kamera hozzfrst</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">2</span>\n                    <span>Clozd meg a padlt a telefonoddal</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">3</span>\n                    <span>Helyezd el s forgasd a termket</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && !isARAvailable && (\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                  <Smartphone className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <div>\n                  <p className=\"text-gray-600 mb-2\">AR nem elrhet ezen az eszkzn</p>\n                  <p className=\"text-sm text-gray-500\">\n                    Prbld meg iOS Safari vagy Android Chrome bngszbl!\n                  </p>\n                </div>\n                <button\n                  onClick={openInARViewer}\n                  className=\"text-primary-500 hover:text-primary-600 font-medium text-sm\"\n                >\n                  Megnyits web AR nzetben \n                </button>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport default ARProductPreview;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Sparkles, Plus, ShoppingBag, Check, ChevronRight, Package, Percent } from 'lucide-react';\nimport { formatPriceNumber } from '../../utils/helpers';\nimport { generateText } from '../../services/geminiService';\n\n/**\n * CompleteTheLook - AI-powered bundle suggestions\n * \"Add hozz ezeket is s kapj kedvezmnyt!\"\n */\nconst CompleteTheLook = ({ currentProduct, allProducts, onAddToCart, onViewProduct }) => {\n  const [bundleItems, setBundleItems] = useState([]);\n  const [selectedItems, setSelectedItems] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [bundleTitle, setBundleTitle] = useState('Tedd teljess a szobt');\n\n  useEffect(() => {\n    if (currentProduct && allProducts?.length > 0) {\n      findComplementaryProducts();\n    }\n  }, [currentProduct, allProducts]);\n\n  const findComplementaryProducts = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Kategria s tpus alap prostsok\n      const complementaryMap = {\n        'kanap': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'polc', 'puff'],\n        'lgarnitra': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'tv llvny'],\n        'gy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'tkr', 'szekrny'],\n        'franciagy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'gardrb'],\n        'tkezasztal': ['szk', 'tkez', 'tlal', 'lmpa', 'vitrin'],\n        'asztal': ['szk', 'lmpa', 'polc'],\n        'rasztal': ['forgszk', 'polc', 'lmpa', 'irattart'],\n        'szk': ['asztal', 'tkez'],\n        'fotel': ['dohnyzasztal', 'lmpa', 'puff', 'takar'],\n        'szekrny': ['komd', 'tkr', 'polc'],\n        'tv llvny': ['polc', 'lmpa', 'dohnyzasztal'],\n      };\n\n      const productName = (currentProduct.name || '').toLowerCase();\n      const productCategory = (currentProduct.category || '').toLowerCase();\n      \n      // Keressk meg a megfelel kiegsztket\n      let searchTerms = [];\n      \n      Object.entries(complementaryMap).forEach(([key, complements]) => {\n        if (productName.includes(key) || productCategory.includes(key)) {\n          searchTerms.push(...complements);\n        }\n      });\n\n      // Ha nincs specifikus match, ltalnos kiegsztk\n      if (searchTerms.length === 0) {\n        searchTerms = ['lmpa', 'polc', 'sznyeg', 'dekorci'];\n      }\n\n      // Keress a termkek kztt\n      const currentPrice = currentProduct.salePrice || currentProduct.price || 0;\n      const priceRange = currentPrice * 0.8; // Hasonl rkategria\n      \n      const matches = allProducts\n        .filter(p => {\n          if (p.id === currentProduct.id) return false;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          const pPrice = p.salePrice || p.price || 0;\n          \n          // Ne legyen tl drga\n          if (pPrice > currentPrice * 1.5) return false;\n          \n          // Keressk a kiegsztket\n          return searchTerms.some(term => pName.includes(term) || pCat.includes(term));\n        })\n        .map(p => {\n          let score = 0;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          \n          searchTerms.forEach(term => {\n            if (pName.includes(term)) score += 10;\n            if (pCat.includes(term)) score += 5;\n          });\n          \n          return { product: p, score };\n        })\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 6)\n        .map(m => m.product);\n\n      // Ha van tallat, tegyk be\n      if (matches.length >= 2) {\n        setBundleItems(matches.slice(0, 4));\n        \n        // AI generlt cm\n        const prompt = `rj egy rvid, vonz marketing cmet (max 6 sz) ami arra sztnz, hogy a \"${currentProduct.name}\" mell vegyk meg a kiegsztket is. Magyarul, kreatvan!`;\n        \n        const result = await generateText(prompt, { temperature: 0.9, maxTokens: 30 });\n        if (result.success && result.text) {\n          setBundleTitle(result.text.replace(/[\"']/g, '').trim());\n        }\n      } else {\n        // Fallback: random npszer termkek\n        const fallbackProducts = allProducts\n          .filter(p => p.id !== currentProduct.id)\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 4);\n        setBundleItems(fallbackProducts);\n      }\n\n    } catch (error) {\n      console.warn('Bundle search error:', error);\n      // Fallback\n      const fallback = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .sort(() => Math.random() - 0.5)\n        .slice(0, 4);\n      setBundleItems(fallback);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const toggleItem = (productId) => {\n    setSelectedItems(prev => \n      prev.includes(productId) \n        ? prev.filter(id => id !== productId)\n        : [...prev, productId]\n    );\n  };\n\n  const formatPrice = (price) => formatPriceNumber(price);\n\n  // Szmtsok\n  const selectedProducts = bundleItems.filter(p => selectedItems.includes(p.id));\n  const bundleOriginalPrice = selectedProducts.reduce((sum, p) => sum + (p.salePrice || p.price || 0), 0);\n  const bundleDiscount = selectedProducts.length >= 2 ? 0.1 : selectedProducts.length >= 3 ? 0.15 : 0; // 10-15% kedvezmny\n  const bundleFinalPrice = bundleOriginalPrice * (1 - bundleDiscount);\n  const savedAmount = bundleOriginalPrice - bundleFinalPrice;\n\n  const handleAddBundle = () => {\n    selectedProducts.forEach(product => {\n      if (onAddToCart) onAddToCart(product);\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 animate-pulse\">\n        <div className=\"h-6 bg-amber-200/50 rounded w-48 mb-4\" />\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n          {[1,2,3,4].map(i => (\n            <div key={i} className=\"bg-white rounded-xl p-3\">\n              <div className=\"aspect-square bg-amber-100 rounded-lg mb-2\" />\n              <div className=\"h-4 bg-amber-100 rounded w-3/4\" />\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (bundleItems.length < 2) return null;\n\n  return (\n    <div className=\"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 rounded-2xl p-5 sm:p-6 border border-amber-200/50 shadow-lg\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-5\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg\">\n            <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-gray-900 text-lg sm:text-xl\">{bundleTitle}</h3>\n            <p className=\"text-amber-700 text-sm\">Vlassz kiegsztket s sprolj!</p>\n          </div>\n        </div>\n        \n        {bundleDiscount > 0 && (\n          <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-1 shadow-lg animate-pulse\">\n            <Percent className=\"w-4 h-4\" />\n            -{Math.round(bundleDiscount * 100)}%\n          </div>\n        )}\n      </div>\n\n      {/* Products Grid */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-5\">\n        {bundleItems.map((product) => {\n          const isSelected = selectedItems.includes(product.id);\n          const price = product.salePrice || product.price || 0;\n          \n          return (\n            <button\n              key={product.id}\n              onClick={() => toggleItem(product.id)}\n              className={`\n                relative bg-white rounded-xl p-3 text-left transition-all duration-300\n                ${isSelected \n                  ? 'ring-2 ring-amber-500 shadow-lg scale-[1.02]' \n                  : 'hover:shadow-md hover:scale-[1.01] border border-gray-100'\n                }\n              `}\n            >\n              {/* Selection indicator */}\n              <div className={`\n                absolute -top-2 -right-2 w-6 h-6 rounded-full flex items-center justify-center transition-all\n                ${isSelected \n                  ? 'bg-amber-500 text-white scale-100' \n                  : 'bg-gray-200 text-gray-400 scale-90'\n                }\n              `}>\n                {isSelected ? <Check className=\"w-4 h-4\" /> : <Plus className=\"w-4 h-4\" />}\n              </div>\n\n              {/* Image */}\n              <div className=\"aspect-square bg-gray-50 rounded-lg mb-2 overflow-hidden\">\n                <img\n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-full h-full object-contain hover:scale-110 transition-transform duration-500\"\n                  onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                />\n              </div>\n\n              {/* Info */}\n              <p className=\"text-xs sm:text-sm font-medium text-gray-800 line-clamp-2 mb-1 leading-tight\">\n                {product.name}\n              </p>\n              <p className=\"text-sm sm:text-base font-bold text-amber-600\">\n                {formatPrice(price)} Ft\n              </p>\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Bundle Summary */}\n      {selectedItems.length > 0 && (\n        <div className=\"bg-white rounded-xl p-4 shadow-inner\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            <div>\n              <p className=\"text-sm text-gray-600 mb-1\">\n                {selectedItems.length} termk kivlasztva\n              </p>\n              <div className=\"flex items-center gap-3\">\n                {bundleDiscount > 0 && (\n                  <span className=\"text-gray-400 line-through text-sm\">\n                    {formatPrice(bundleOriginalPrice)} Ft\n                  </span>\n                )}\n                <span className=\"text-2xl font-bold text-gray-900\">\n                  {formatPrice(Math.round(bundleFinalPrice))} Ft\n                </span>\n              </div>\n              {savedAmount > 0 && (\n                <p className=\"text-green-600 text-sm font-medium mt-1\">\n                   Megtakarts: {formatPrice(Math.round(savedAmount))} Ft\n                </p>\n              )}\n            </div>\n\n            <button\n              onClick={handleAddBundle}\n              className=\"flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all\"\n            >\n              <ShoppingBag className=\"w-5 h-5\" />\n              Mind a kosrba\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Hint when nothing selected */}\n      {selectedItems.length === 0 && (\n        <p className=\"text-center text-amber-700 text-sm py-2\">\n           Kattints a termkekre a kivlasztshoz\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default CompleteTheLook;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { ZoomIn, ZoomOut, ChevronLeft, ChevronRight, X, Expand, Maximize2 } from 'lucide-react';\n\n/**\n * ImageGallery - Professional product image gallery\n * Features: Zoom, Swipe, Thumbnails, Fullscreen\n */\nconst ImageGallery = ({ images = [], productName = 'Termk' }) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isZoomed, setIsZoomed] = useState(false);\n  const [zoomPosition, setZoomPosition] = useState({ x: 50, y: 50 });\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [touchStart, setTouchStart] = useState(null);\n  const mainImageRef = useRef(null);\n\n  // Ensure we have at least one image\n  const imageList = images.length > 0 ? images : ['data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" fill=\"%239ca3af\" font-size=\"16\">Nincs kp</text></svg>'];\n  \n  const currentImage = imageList[currentIndex];\n\n  // Navigation\n  const goToNext = () => {\n    setCurrentIndex((prev) => (prev + 1) % imageList.length);\n    setIsZoomed(false);\n  };\n\n  const goToPrev = () => {\n    setCurrentIndex((prev) => (prev - 1 + imageList.length) % imageList.length);\n    setIsZoomed(false);\n  };\n\n  // Zoom handling\n  const handleMouseMove = (e) => {\n    if (!mainImageRef.current || !isZoomed) return;\n    \n    const rect = mainImageRef.current.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width) * 100;\n    const y = ((e.clientY - rect.top) / rect.height) * 100;\n    \n    setZoomPosition({ x, y });\n  };\n\n  const toggleZoom = () => {\n    setIsZoomed(!isZoomed);\n  };\n\n  // Touch handling for swipe\n  const handleTouchStart = (e) => {\n    setTouchStart(e.touches[0].clientX);\n  };\n\n  const handleTouchEnd = (e) => {\n    if (!touchStart) return;\n    \n    const touchEnd = e.changedTouches[0].clientX;\n    const diff = touchStart - touchEnd;\n    \n    if (Math.abs(diff) > 50) {\n      if (diff > 0) goToNext();\n      else goToPrev();\n    }\n    \n    setTouchStart(null);\n  };\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.key === 'ArrowLeft') goToPrev();\n      if (e.key === 'ArrowRight') goToNext();\n      if (e.key === 'Escape') {\n        setIsFullscreen(false);\n        setIsZoomed(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  // Fullscreen Gallery Modal\n  if (isFullscreen) {\n    return (\n      <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black flex items-center justify-center\">\n        {/* Close button */}\n        <button\n          onClick={() => setIsFullscreen(false)}\n          className=\"absolute top-4 right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n\n        {/* Navigation */}\n        {imageList.length > 1 && (\n          <>\n            <button\n              onClick={goToPrev}\n              className=\"absolute left-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n            >\n              <ChevronLeft className=\"w-8 h-8\" />\n            </button>\n            <button\n              onClick={goToNext}\n              className=\"absolute right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n            >\n              <ChevronRight className=\"w-8 h-8\" />\n            </button>\n          </>\n        )}\n\n        {/* Main Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className=\"max-h-[90vh] max-w-[90vw] object-contain\"\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n        />\n\n        {/* Counter */}\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-white/10 rounded-full text-white text-sm\">\n          {currentIndex + 1} / {imageList.length}\n        </div>\n\n        {/* Thumbnails */}\n        {imageList.length > 1 && (\n          <div className=\"absolute bottom-16 left-1/2 -translate-x-1/2 flex gap-2\">\n            {imageList.map((img, idx) => (\n              <button\n                key={idx}\n                onClick={() => setCurrentIndex(idx)}\n                className={`\n                  w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                  ${idx === currentIndex ? 'border-white scale-110' : 'border-transparent opacity-60 hover:opacity-100'}\n                `}\n              >\n                <img src={img} alt=\"\" className=\"w-full h-full object-cover\" />\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full\">\n      {/* Main Image Container */}\n      <div \n        ref={mainImageRef}\n        className=\"relative aspect-square bg-gray-50 rounded-2xl overflow-hidden cursor-zoom-in group\"\n        onClick={toggleZoom}\n        onMouseMove={handleMouseMove}\n        onMouseLeave={() => setIsZoomed(false)}\n        onTouchStart={handleTouchStart}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className={`\n            w-full h-full object-contain transition-transform duration-300\n            ${isZoomed ? 'scale-[2.5]' : 'group-hover:scale-105'}\n          `}\n          style={isZoomed ? {\n            transformOrigin: `${zoomPosition.x}% ${zoomPosition.y}%`\n          } : {}}\n          onError={(e) => { \n            e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/></svg>'; \n          }}\n          draggable={false}\n        />\n\n        {/* Zoom indicator */}\n        {!isZoomed && (\n          <div className=\"absolute bottom-4 right-4 px-3 py-1.5 bg-black/50 text-white text-xs rounded-full flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n            <ZoomIn className=\"w-4 h-4\" />\n            Kattints a nagytshoz\n          </div>\n        )}\n\n        {/* Navigation arrows */}\n        {imageList.length > 1 && !isZoomed && (\n          <>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToPrev(); }}\n              className=\"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n            >\n              <ChevronLeft className=\"w-5 h-5 text-gray-700\" />\n            </button>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToNext(); }}\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n            >\n              <ChevronRight className=\"w-5 h-5 text-gray-700\" />\n            </button>\n          </>\n        )}\n\n        {/* Fullscreen button */}\n        <button\n          onClick={(e) => { e.stopPropagation(); setIsFullscreen(true); }}\n          className=\"absolute top-4 right-4 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n          title=\"Teljes kperny\"\n        >\n          <Maximize2 className=\"w-5 h-5 text-gray-700\" />\n        </button>\n\n        {/* Image counter badge */}\n        {imageList.length > 1 && (\n          <div className=\"absolute top-4 left-4 px-2.5 py-1 bg-black/50 text-white text-xs rounded-full\">\n            {currentIndex + 1} / {imageList.length}\n          </div>\n        )}\n      </div>\n\n      {/* Thumbnails */}\n      {imageList.length > 1 && (\n        <div className=\"flex gap-2 mt-3 overflow-x-auto pb-2 scrollbar-hide\">\n          {imageList.map((img, idx) => (\n            <button\n              key={idx}\n              onClick={() => { setCurrentIndex(idx); setIsZoomed(false); }}\n              className={`\n                flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-xl overflow-hidden border-2 transition-all\n                ${idx === currentIndex \n                  ? 'border-primary-500 ring-2 ring-primary-200' \n                  : 'border-gray-200 hover:border-gray-300 opacity-70 hover:opacity-100'\n                }\n              `}\n            >\n              <img \n                src={img} \n                alt={`Thumbnail ${idx + 1}`}\n                className=\"w-full h-full object-contain bg-gray-50\"\n                onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n              />\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Dots indicator (mobile) */}\n      {imageList.length > 1 && (\n        <div className=\"flex justify-center gap-1.5 mt-3 sm:hidden\">\n          {imageList.map((_, idx) => (\n            <button\n              key={idx}\n              onClick={() => setCurrentIndex(idx)}\n              className={`\n                w-2 h-2 rounded-full transition-all\n                ${idx === currentIndex ? 'bg-primary-500 w-6' : 'bg-gray-300'}\n              `}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageGallery;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Check, AlertTriangle, Truck, Clock, Shield, ChevronUp } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * StickyAddToCart - Sticky bottom bar for product pages\n * Shows when the product view (modal) is not in viewport, or after scrolling past threshold\n */\nconst StickyAddToCart = ({ \n  product, \n  onAddToCart, \n  onToggleWishlist, \n  isWishlisted = false,\n  isVisible = true,\n  /** When set, bar is shown only when this element is NOT in viewport (e.g. product modal root) */\n  observedElementId = null\n}) => {\n  const [isShown, setIsShown] = useState(false);\n  const [addedToCart, setAddedToCart] = useState(false);\n  const [quantity, setQuantity] = useState(1);\n\n  useEffect(() => {\n    if (observedElementId) {\n      const el = document.getElementById(observedElementId);\n      if (!el || !(el instanceof Element)) {\n        setIsShown(window.scrollY > 400);\n        return;\n      }\n      if (typeof window === 'undefined' || !('IntersectionObserver' in window)) {\n        setIsShown(window.scrollY > 400);\n        return;\n      }\n      const observer = new IntersectionObserver(\n        ([entry]) => {\n          setIsShown(!entry.isIntersecting);\n        },\n        { threshold: 0.1, root: null }\n      );\n      try {\n        observer.observe(el);\n      } catch (err) {\n        return;\n      }\n      return () => observer.disconnect();\n    }\n    const handleScroll = () => setIsShown(window.scrollY > 400);\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [observedElementId]);\n\n  if (!product || !isVisible) return null;\n\n  const price = product.salePrice || product.price || 0;\n  const originalPrice = product.originalPrice || (product.salePrice ? product.price : null);\n  const hasDiscount = originalPrice && originalPrice > price;\n  const discountPercent = hasDiscount ? Math.round((1 - price / originalPrice) * 100) : 0;\n  \n  const stockLevel = typeof product.stockLevel === 'number' ? product.stockLevel : null;\n  const isInStock = product.inStock ?? product.in_stock ?? true;\n  const isLowStock = isInStock && stockLevel != null && stockLevel <= 5;\n\n  const handleAddToCart = () => {\n    if (onAddToCart) {\n      onAddToCart(product, quantity);\n    }\n    setAddedToCart(true);\n    \n    // Haptic feedback (if available)\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n    \n    setTimeout(() => setAddedToCart(false), 2000);\n  };\n\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  return (\n    <div \n      className={`\n        fixed bottom-0 left-0 right-0 z-40 transition-all duration-300\n        ${isShown ? 'translate-y-0' : 'translate-y-full'}\n      `}\n      style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }}\n    >\n      {/* Main sticky bar */}\n      <div className=\"bg-white border-t border-gray-200 shadow-2xl\">\n        {/* Stock urgency banner */}\n        {isLowStock && isInStock && (\n          <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 text-white text-center py-1.5 text-sm font-medium flex items-center justify-center gap-2\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            Mr csak {stockLevel} db van raktron!\n          </div>\n        )}\n\n        <div className=\"max-w-7xl mx-auto px-4 py-3.5 flex items-center justify-between gap-4\">\n          {/* Product info - mobile - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex-1 min-w-0 sm:hidden\">\n            <p className=\"text-base font-medium text-gray-900 truncate\">{product.name}</p>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xl font-bold text-primary-500\">{formatPrice(price)}</span>\n              {hasDiscount && (\n                <span className=\"text-sm line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n              )}\n            </div>\n          </div>\n\n          {/* Product info - desktop - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden sm:flex items-center gap-4 flex-1\">\n            <img \n              src={product.images?.[0] || product.image} \n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-gray-50 rounded-lg\"\n            />\n            <div>\n              <p className=\"font-medium text-gray-900 text-base lg:text-lg line-clamp-1\">{product.name}</p>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xl lg:text-2xl font-bold text-primary-500\">{formatPrice(price)}</span>\n                {hasDiscount && (\n                  <>\n                    <span className=\"text-base line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n                    <span className=\"px-2 py-0.5 bg-red-100 text-red-600 text-sm font-bold rounded\">\n                      -{discountPercent}%\n                    </span>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Trust badges - desktop only - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden lg:flex items-center gap-5 text-gray-500 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n              <span>Ingyenes szllts</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5 text-blue-600\" />\n              <span>2 v garancia</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-amber-600\" />\n              <span>24h kiszllts</span>\n            </div>\n          </div>\n\n          {/* Actions - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex items-center gap-3\">\n            {/* Quantity selector - desktop only */}\n            <div className=\"hidden sm:flex items-center border border-gray-200 rounded-xl\">\n              <button \n                onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                -\n              </button>\n              <span className=\"px-4 py-2.5 font-medium min-w-[48px] text-center text-base\">{quantity}</span>\n              <button \n                onClick={() => setQuantity(quantity + 1)}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                +\n              </button>\n            </div>\n\n            {/* Wishlist */}\n            <button\n              onClick={() => onToggleWishlist?.(product.id)}\n              className={`\n                p-3.5 rounded-xl transition-all\n                ${isWishlisted \n                  ? 'bg-red-100 text-red-500' \n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }\n              `}\n            >\n              <Heart className=\"w-6 h-6\" fill={isWishlisted ? 'currentColor' : 'none'} />\n            </button>\n\n            {/* Add to cart */}\n            <button\n              onClick={handleAddToCart}\n              disabled={!isInStock || addedToCart}\n              className={`\n                flex items-center gap-2 px-6 sm:px-7 py-3.5 rounded-xl font-bold text-base transition-all\n                ${addedToCart \n                  ? 'bg-green-500 text-white' \n                  : isInStock \n                    ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white hover:shadow-lg hover:scale-[1.02]'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }\n              `}\n            >\n              {addedToCart ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Hozzadva!</span>\n                </>\n              ) : isInStock ? (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Kosrba</span>\n                </>\n              ) : (\n                <>\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Elfogyott</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Scroll to top button */}\n      <button\n        onClick={scrollToTop}\n        className=\"absolute -top-12 right-4 p-2 bg-white rounded-full shadow-lg border border-gray-200 text-gray-600 hover:text-primary-500 hover:border-primary-300 transition-all\"\n      >\n        <ChevronUp className=\"w-5 h-5\" />\n      </button>\n    </div>\n  );\n};\n\nexport default StickyAddToCart;\n","import React, { useState } from 'react';\nimport { Bell, BellRing, Mail, Check, X, TrendingDown, Sparkles } from 'lucide-react';\nimport { formatPriceNumber } from '../../utils/helpers';\n\n/**\n * PriceAlert - \"rtests ha lecskken az r\" feature\n * Saves to localStorage, shows confirmation\n */\nconst PriceAlert = ({ product, variant = 'button' }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [email, setEmail] = useState('');\n  const [targetPrice, setTargetPrice] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [isAlertSet, setIsAlertSet] = useState(() => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    return alerts.some(a => a.productId === product?.id);\n  });\n\n  if (!product) return null;\n\n  const currentPrice = product.salePrice || product.price || 0;\n  const suggestedPrice = Math.floor(currentPrice * 0.85); // 15% kedvezmnyes r\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    \n    const alertData = {\n      productId: product.id,\n      productName: product.name,\n      currentPrice,\n      targetPrice: parseInt(targetPrice) || suggestedPrice,\n      email,\n      createdAt: Date.now()\n    };\n\n    // Save to localStorage\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    filtered.push(alertData);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n\n    setIsSubmitted(true);\n    setIsAlertSet(true);\n\n    setTimeout(() => {\n      setIsOpen(false);\n      setIsSubmitted(false);\n    }, 2000);\n  };\n\n  const removeAlert = () => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n    setIsAlertSet(false);\n  };\n\n  const formatPrice = (p) => formatPriceNumber(p);\n\n  // Button variant\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n          className={`\n            flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all text-sm font-medium\n            ${isAlertSet \n              ? 'bg-amber-100 text-amber-700 hover:bg-amber-200' \n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n            }\n          `}\n        >\n          {isAlertSet ? (\n            <>\n              <BellRing className=\"w-4 h-4\" />\n              rtests belltva\n            </>\n          ) : (\n            <>\n              <Bell className=\"w-4 h-4\" />\n              rcskkens rtest\n            </>\n          )}\n        </button>\n\n        {/* Modal */}\n        {isOpen && (\n          <PriceAlertModal\n            product={product}\n            currentPrice={currentPrice}\n            suggestedPrice={suggestedPrice}\n            email={email}\n            setEmail={setEmail}\n            targetPrice={targetPrice}\n            setTargetPrice={setTargetPrice}\n            isSubmitted={isSubmitted}\n            onSubmit={handleSubmit}\n            onClose={() => setIsOpen(false)}\n            formatPrice={formatPrice}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Inline variant (for product cards)\n  return (\n    <button\n      onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n      className={`\n        p-2 rounded-full transition-all\n        ${isAlertSet \n          ? 'bg-amber-500 text-white' \n          : 'bg-gray-100 text-gray-500 hover:bg-amber-100 hover:text-amber-600'\n        }\n      `}\n      title={isAlertSet ? 'rtests belltva' : 'rcskkens rtest'}\n    >\n      {isAlertSet ? <BellRing className=\"w-4 h-4\" /> : <Bell className=\"w-4 h-4\" />}\n    </button>\n  );\n};\n\n// Modal component\nconst PriceAlertModal = ({\n  product,\n  currentPrice,\n  suggestedPrice,\n  email,\n  setEmail,\n  targetPrice,\n  setTargetPrice,\n  isSubmitted,\n  onSubmit,\n  onClose,\n  formatPrice\n}) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 p-5 text-white relative\">\n          <button\n            onClick={onClose}\n            className=\"absolute top-3 right-3 p-1.5 hover:bg-white/20 rounded-full transition-colors\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n          \n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n              <TrendingDown className=\"w-6 h-6\" />\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold\">rcskkens rtest</h3>\n              <p className=\"text-white/80 text-sm\">Szlunk, ha cskken az r!</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-5\">\n          {!isSubmitted ? (\n            <form onSubmit={onSubmit} className=\"space-y-4\">\n              {/* Product info */}\n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n                <img \n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n                  <p className=\"text-lg font-bold text-primary-500\">{formatPrice(currentPrice)} Ft</p>\n                </div>\n              </div>\n\n              {/* Target price */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  rtests, ha az r ez al cskken:\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={targetPrice}\n                    onChange={(e) => setTargetPrice(e.target.value)}\n                    placeholder={suggestedPrice.toString()}\n                    className=\"w-full pl-4 pr-12 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                  />\n                  <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500\">Ft</span>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Javasolt r: {formatPrice(suggestedPrice)} Ft ({Math.round((1 - suggestedPrice/currentPrice) * 100)}% kedvezmny)\n                </p>\n              </div>\n\n              {/* Email */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  Email cm:\n                </label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                    required\n                  />\n                </div>\n              </div>\n\n              {/* Submit */}\n              <button\n                type=\"submit\"\n                className=\"w-full py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n              >\n                <Bell className=\"w-5 h-5\" />\n                rtests belltsa\n              </button>\n            </form>\n          ) : (\n            /* Success */\n            <div className=\"text-center py-6\">\n              <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-8 h-8 text-green-600\" />\n              </div>\n              <h4 className=\"text-xl font-bold text-gray-900 mb-2\">rtests belltva!</h4>\n              <p className=\"text-gray-600 text-sm\">\n                Emailben rtestnk, ha {formatPrice(parseInt(targetPrice) || suggestedPrice)} Ft al cskken az r.\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PriceAlert;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { X, ChevronDown } from 'lucide-react';\n\n/**\n * BottomSheet - iOS-style bottom sheet modal\n * Supports drag to close, snap points, and swipe gestures\n */\nconst BottomSheet = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  snapPoints = [0.5, 0.9], // Percentage of screen height\n  initialSnap = 0,\n  showHandle = true,\n  showClose = true\n}) => {\n  const [currentSnap, setCurrentSnap] = useState(initialSnap);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState(0);\n  const [touchStartY, setTouchStartY] = useState(0);\n  const sheetRef = useRef(null);\n  const contentRef = useRef(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n      setCurrentSnap(initialSnap);\n      setDragOffset(0);\n    } else {\n      document.body.style.overflow = '';\n    }\n    return () => { document.body.style.overflow = ''; };\n  }, [isOpen, initialSnap]);\n\n  const getSheetHeight = () => {\n    const snapHeight = snapPoints[currentSnap] * 100;\n    return `${snapHeight}vh`;\n  };\n\n  const handleTouchStart = (e) => {\n    // Only allow drag from handle area\n    if (e.target.closest('.sheet-content') && contentRef.current?.scrollTop > 0) {\n      return;\n    }\n    setTouchStartY(e.touches[0].clientY);\n    setIsDragging(true);\n  };\n\n  const handleTouchMove = (e) => {\n    if (!isDragging) return;\n    \n    const currentY = e.touches[0].clientY;\n    const diff = currentY - touchStartY;\n    \n    // Only allow dragging down\n    if (diff > 0) {\n      setDragOffset(diff);\n    } else {\n      // Allow dragging up to expand\n      setDragOffset(diff * 0.3); // Resistance when dragging up\n    }\n  };\n\n  const handleTouchEnd = () => {\n    if (!isDragging) return;\n    setIsDragging(false);\n\n    const threshold = 100;\n    \n    if (dragOffset > threshold) {\n      // Dragged down enough - close or snap to lower point\n      if (currentSnap === 0) {\n        onClose();\n      } else {\n        setCurrentSnap(currentSnap - 1);\n      }\n    } else if (dragOffset < -threshold && currentSnap < snapPoints.length - 1) {\n      // Dragged up - snap to higher point\n      setCurrentSnap(currentSnap + 1);\n    }\n    \n    setDragOffset(0);\n  };\n\n  const triggerHaptic = () => {\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[80] md:hidden\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 bg-black transition-opacity duration-300 ${isDragging ? 'opacity-40' : 'opacity-50'}`}\n        onClick={onClose}\n      />\n      \n      {/* Sheet */}\n      <div\n        ref={sheetRef}\n        className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl transition-all duration-300 ease-out\"\n        style={{\n          height: getSheetHeight(),\n          transform: `translateY(${Math.max(0, dragOffset)}px)`,\n          transitionProperty: isDragging ? 'none' : 'all'\n        }}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Handle */}\n        {showHandle && (\n          <div className=\"flex justify-center py-3 cursor-grab active:cursor-grabbing\">\n            <div className=\"w-12 h-1.5 bg-gray-300 rounded-full\" />\n          </div>\n        )}\n\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-5 pb-4 border-b border-gray-100\">\n          <h3 className=\"text-lg font-bold text-gray-900\">{title}</h3>\n          {showClose && (\n            <button\n              onClick={onClose}\n              className=\"p-2 -mr-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n\n        {/* Content */}\n        <div \n          ref={contentRef}\n          className=\"sheet-content flex-1 overflow-y-auto overscroll-contain\"\n          style={{ maxHeight: `calc(${getSheetHeight()} - 100px)` }}\n        >\n          {children}\n        </div>\n\n        {/* Safe area padding for iOS */}\n        <div style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }} />\n      </div>\n    </div>\n  );\n};\n\n/**\n * FilterBottomSheet - Pre-styled filter sheet\n */\nexport const FilterBottomSheet = ({\n  isOpen,\n  onClose,\n  filters,\n  activeFilters,\n  onFilterChange,\n  onClearAll,\n  onApply\n}) => {\n  return (\n    <BottomSheet isOpen={isOpen} onClose={onClose} title=\"Szrk\" snapPoints={[0.7, 0.9]}>\n      <div className=\"p-5 space-y-6\">\n        {/* Active filters count */}\n        {Object.keys(activeFilters).length > 0 && (\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-gray-600\">\n              {Object.keys(activeFilters).length} szr aktv\n            </span>\n            <button\n              onClick={onClearAll}\n              className=\"text-sm text-primary-500 font-medium\"\n            >\n              sszes trlse\n            </button>\n          </div>\n        )}\n\n        {/* Filter sections */}\n        {filters.map((filter) => (\n          <FilterSection\n            key={filter.id}\n            filter={filter}\n            value={activeFilters[filter.id]}\n            onChange={(value) => onFilterChange(filter.id, value)}\n          />\n        ))}\n\n        {/* Apply button */}\n        <button\n          onClick={onApply}\n          className=\"w-full py-4 bg-primary-500 text-white font-bold rounded-xl hover:bg-primary-600 transition-colors\"\n        >\n          Szrk alkalmazsa\n        </button>\n      </div>\n    </BottomSheet>\n  );\n};\n\nconst FilterSection = ({ filter, value, onChange }) => {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  return (\n    <div className=\"border-b border-gray-100 pb-4\">\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between py-2\"\n      >\n        <span className=\"font-medium text-gray-900\">{filter.label}</span>\n        <ChevronDown className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\n      </button>\n      \n      {isExpanded && (\n        <div className=\"mt-3 space-y-2\">\n          {filter.type === 'checkbox' && filter.options?.map((option) => (\n            <label key={option.value} className=\"flex items-center gap-3 py-2\">\n              <input\n                type=\"checkbox\"\n                checked={value?.includes(option.value)}\n                onChange={(e) => {\n                  const newValue = e.target.checked\n                    ? [...(value || []), option.value]\n                    : (value || []).filter(v => v !== option.value);\n                  onChange(newValue);\n                }}\n                className=\"w-5 h-5 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n              />\n              <span className=\"text-gray-700\">{option.label}</span>\n              {option.count && (\n                <span className=\"text-gray-400 text-sm ml-auto\">({option.count})</span>\n              )}\n            </label>\n          ))}\n          \n          {filter.type === 'range' && (\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Min</label>\n                  <input\n                    type=\"number\"\n                    value={value?.min || ''}\n                    onChange={(e) => onChange({ ...value, min: e.target.value })}\n                    placeholder={filter.min?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Max</label>\n                  <input\n                    type=\"number\"\n                    value={value?.max || ''}\n                    onChange={(e) => onChange({ ...value, max: e.target.value })}\n                    placeholder={filter.max?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BottomSheet;\n","import React, { useState, useEffect } from 'react';\nimport { X, Heart, Trash2, ShoppingCart, Share2, ChevronRight, Sparkles, Package } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * WishlistDrawer - Slide-in sidebar showing all wishlist items\n * Features: Remove items, add all to cart, share wishlist, AI recommendations\n */\nconst WishlistDrawer = ({ \n  isOpen, \n  onClose, \n  wishlistItems = [], \n  onRemove, \n  onAddToCart, \n  onProductClick,\n  onClearAll \n}) => {\n  const [isClosing, setIsClosing] = useState(false);\n\n  // Prevent body scroll when open\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = '';\n    }\n    return () => { document.body.style.overflow = ''; };\n  }, [isOpen]);\n\n  const handleClose = () => {\n    setIsClosing(true);\n    setTimeout(() => {\n      setIsClosing(false);\n      onClose();\n    }, 300);\n  };\n\n  const totalValue = wishlistItems.reduce((sum, item) => sum + (item.salePrice || item.price || 0), 0);\n\n  const handleShare = async () => {\n    const text = `Nzd meg a kvnsglistmat! ${wishlistItems.length} termk, sszesen ${formatPrice(totalValue)}`;\n    \n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: 'Kvnsglistm - Marketly.AI',\n          text,\n          url: window.location.href\n        });\n      } catch (err) {\n        console.log('Share cancelled');\n      }\n    } else {\n      // Fallback: copy to clipboard\n      navigator.clipboard?.writeText(text + ' ' + window.location.href);\n      alert('Link msolva a vglapra!');\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[9999]\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 lg:top-[60px] bg-black transition-opacity duration-300 ${isClosing ? 'opacity-0' : 'opacity-50'}`}\n        onClick={handleClose}\n      />\n\n      {/* Drawer */}\n      <div \n        className={`\n          absolute top-0 lg:top-[60px] right-0 h-full lg:h-[calc(100vh-60px)] w-full max-w-md bg-white shadow-2xl\n          transition-transform duration-300 ease-out\n          ${isClosing ? 'translate-x-full' : 'translate-x-0'}\n        `}\n      >\n        {/* Header - UNIFIED TYPOGRAPHY */}\n        <div className=\"bg-gradient-to-r from-pink-500 to-red-500 p-5 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n                <Heart className=\"w-6 h-6\" fill=\"white\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl sm:text-2xl font-bold\">Kvnsglista</h2>\n                <p className=\"text-white/80 text-sm sm:text-base\">{wishlistItems.length} termk</p>\n              </div>\n            </div>\n            <button\n              onClick={handleClose}\n              className=\"p-2 hover:bg-white/20 rounded-full transition-colors\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex flex-col h-[calc(100%-180px)] overflow-hidden\">\n          {wishlistItems.length === 0 ? (\n            /* Empty state - UNIFIED TYPOGRAPHY */\n            <div className=\"flex-1 flex flex-col items-center justify-center p-8 text-center\">\n              <div className=\"w-24 h-24 bg-pink-50 rounded-full flex items-center justify-center mb-4\">\n                <Heart className=\"w-12 h-12 text-pink-300\" />\n              </div>\n              <h3 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">res a kvnsglista</h3>\n              <p className=\"text-base text-gray-500 mb-6\">Adj hozz termkeket a szv ikonra kattintva!</p>\n              <button\n                onClick={handleClose}\n                className=\"px-6 py-3 bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                Bngszs\n              </button>\n            </div>\n          ) : (\n            /* Items list */\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n              {wishlistItems.map((item, index) => (\n                <div \n                  key={item.id}\n                  className=\"bg-white border border-gray-100 rounded-xl p-3 shadow-sm hover:shadow-md transition-all group\"\n                  style={{ animationDelay: `${index * 50}ms` }}\n                >\n                  <div className=\"flex gap-3\">\n                    {/* Image */}\n                    <div \n                      className=\"w-20 h-20 bg-gray-50 rounded-lg overflow-hidden cursor-pointer shrink-0\"\n                      onClick={() => {\n                        onProductClick?.(item);\n                        handleClose();\n                      }}\n                    >\n                      <img\n                        src={item.images?.[0] || item.image}\n                        alt={item.name}\n                        className=\"w-full h-full object-contain group-hover:scale-110 transition-transform\"\n                        onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                      />\n                    </div>\n\n                    {/* Info - UNIFIED TYPOGRAPHY */}\n                    <div className=\"flex-1 min-w-0\">\n                      <p \n                        className=\"font-medium text-gray-900 text-sm sm:text-base line-clamp-2 cursor-pointer hover:text-primary-500 transition-colors\"\n                        onClick={() => {\n                          onProductClick?.(item);\n                          handleClose();\n                        }}\n                      >\n                        {item.name}\n                      </p>\n                      <p className=\"text-lg sm:text-xl font-bold text-primary-500 mt-1\">\n                        {formatPrice(item.salePrice || item.price)}\n                      </p>\n                      \n                      {/* Actions */}\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <button\n                          onClick={() => onAddToCart?.(item)}\n                          className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-primary-500 text-white text-sm font-bold rounded-lg hover:bg-primary-600 transition-colors\"\n                        >\n                          <ShoppingCart className=\"w-4 h-4\" />\n                          Kosrba\n                        </button>\n                        <button\n                          onClick={() => onRemove?.(item.id)}\n                          className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                          title=\"Eltvolts\"\n                        >\n                          <Trash2 className=\"w-5 h-5\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer - UNIFIED TYPOGRAPHY */}\n        {wishlistItems.length > 0 && (\n          <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 space-y-3\">\n            {/* Total */}\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-base text-gray-600\">sszrtk:</span>\n              <span className=\"text-2xl font-bold text-gray-900\">{formatPrice(totalValue)}</span>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-2\">\n              <button\n                onClick={handleShare}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 border-2 border-gray-200 text-gray-700 font-bold text-sm sm:text-base rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <Share2 className=\"w-5 h-5\" />\n                Megoszts\n              </button>\n              <button\n                onClick={() => {\n                  wishlistItems.forEach(item => onAddToCart?.(item));\n                }}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-sm sm:text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                <ShoppingCart className=\"w-5 h-5\" />\n                Mind a kosrba\n              </button>\n            </div>\n\n            {/* Clear all */}\n            <button\n              onClick={onClearAll}\n              className=\"w-full text-center text-sm sm:text-base text-gray-400 hover:text-red-500 transition-colors py-2\"\n            >\n              Lista trlse\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default WishlistDrawer;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Zap, Clock, ArrowRight, X, Flame, ChevronLeft, ChevronRight } from 'lucide-react';\n\n/**\n * FlashSaleBanner - Impactful, urgent sale banner\n * Clear message: SALE + TIME + ACTION\n */\nconst FLASH_DISMISS_KEY = 'mkt_flash_dismissed_date';\n\nfunction getTodayKey() {\n  const d = new Date();\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\nconst FLASH_OFFERS = [\n  { title: ' Flash Sale!', badge: '-50%', text: 'Akr 50% kedvezmny kivlasztott btorokra', cta: 'Megnzem az akcikat', ctaShort: 'Megnzem', bg: 'from-red-600 via-orange-500 to-amber-500', ctaColor: 'text-red-600' },\n  { title: ' Megtakartsok', badge: 'OLCSBB', text: 'Kanapk, gyak, szekrnyek  ma legolcsbban', cta: 'Nzd meg a kedvezmnyeket', ctaShort: 'Nzd meg', bg: 'from-rose-600 via-pink-500 to-amber-500', ctaColor: 'text-rose-600' },\n  { title: ' Ingyenes szllts', badge: '50e+', text: 'Ingyenes szllts 50.000 Ft felett', cta: 'Vsrls most', ctaShort: 'Vsrolj', bg: 'from-emerald-600 via-teal-500 to-cyan-500', ctaColor: 'text-emerald-700' },\n  { title: ' Csak ma!', badge: 'SIESS', text: 'Korltozott id  ne maradj le', cta: 'Nem hagyom ki', ctaShort: 'Nem hagyom ki', bg: 'from-orange-600 via-red-500 to-rose-600', ctaColor: 'text-orange-600' },\n];\n\nconst FlashSaleBanner = ({ \n  endTime,\n  title = 'Flash Sale',\n  subtitle,\n  onViewSale,\n  onDismiss,\n  variant = 'banner'\n}) => {\n  const [timeLeft, setTimeLeft] = useState(calculateTimeLeft());\n  const [offerIndex, setOfferIndex] = useState(0);\n  const [isPaused, setIsPaused] = useState(false);\n  const touchStartX = useRef(0);\n  const currentOffer = FLASH_OFFERS[offerIndex];\n  const displayTitle = currentOffer.title;\n  const displaySubtitle = currentOffer.text;\n  const displayCta = currentOffer.cta;\n  const displayCtaShort = currentOffer.ctaShort;\n  const bgGradient = currentOffer.bg;\n  const ctaColor = currentOffer.ctaColor || 'text-red-600';\n  const [isDismissed, setIsDismissed] = useState(() => {\n    if (typeof sessionStorage === 'undefined') return false;\n    return sessionStorage.getItem(FLASH_DISMISS_KEY) === getTodayKey();\n  });\n  const [isExpired, setIsExpired] = useState(false);\n\n  function calculateTimeLeft() {\n    const end = endTime instanceof Date ? endTime : new Date(endTime);\n    const diff = end - new Date();\n    if (diff <= 0) return { hours: 0, minutes: 0, seconds: 0 };\n    return {\n      hours: Math.floor(diff / (1000 * 60 * 60)),\n      minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),\n      seconds: Math.floor((diff % (1000 * 60)) / 1000)\n    };\n  }\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const newTime = calculateTimeLeft();\n      setTimeLeft(newTime);\n      if (newTime.hours === 0 && newTime.minutes === 0 && newTime.seconds === 0) {\n        setIsExpired(true);\n        clearInterval(timer);\n      }\n    }, 1000);\n    return () => clearInterval(timer);\n  }, [endTime]);\n\n  useEffect(() => {\n    if (isPaused) return;\n    const offerTimer = setInterval(() => {\n      setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    }, 4500);\n    return () => clearInterval(offerTimer);\n  }, [isPaused]);\n\n  const goToOffer = (idx) => {\n    setOfferIndex(idx);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleTouchStart = (e) => {\n    touchStartX.current = e.touches?.[0]?.clientX ?? e.clientX;\n    setIsPaused(true);\n  };\n\n  const handleTouchEnd = (e) => {\n    const endX = e.changedTouches?.[0]?.clientX ?? e.clientX;\n    const diff = touchStartX.current - endX;\n    if (Math.abs(diff) > 50) {\n      if (diff > 0) {\n        setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n      } else {\n        setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n      }\n    }\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handlePrev = () => {\n    setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleNext = () => {\n    setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleDismiss = () => {\n    try {\n      sessionStorage.setItem(FLASH_DISMISS_KEY, getTodayKey());\n    } catch (_) {}\n    setIsDismissed(true);\n    onDismiss?.();\n  };\n\n  if (isDismissed || isExpired) return null;\n\n  const pad = (n) => String(n).padStart(2, '0');\n\n  /* Time-left progress: assume 24h sale duration so bar shrinks as time runs out */\n  const TOTAL_SALE_MS = 24 * 60 * 60 * 1000;\n  const remainingMs = timeLeft.hours * 3600000 + timeLeft.minutes * 60000 + timeLeft.seconds * 1000;\n  const timeLeftProgress = Math.min(100, (remainingMs / TOTAL_SALE_MS) * 100);\n\n  return (\n    <div\n      className={`relative bg-gradient-to-r ${bgGradient} overflow-hidden rounded-xl sm:rounded-2xl shadow-xl transition-all duration-500`}\n      onTouchStart={handleTouchStart}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Animated shine effect */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/15 to-transparent -skew-x-12 animate-[shimmer_3s_infinite]\" \n          style={{ animation: 'shimmer 3s infinite', transform: 'translateX(-100%)' }} />\n      </div>\n\n      {/* Decorative: subtle floating orbs */}\n      <div className=\"absolute top-1/4 right-1/4 w-24 h-24 rounded-full bg-white/5 blur-2xl pointer-events-none\" aria-hidden />\n      <div className=\"absolute bottom-1/3 left-1/4 w-16 h-16 rounded-full bg-white/10 blur-xl pointer-events-none\" aria-hidden />\n\n      {/* Mobile Layout - Stacked, centered */}\n      <div className=\"sm:hidden relative px-4 py-4 pb-20 min-h-[200px]\">\n        {/* Top row: Icon + Title + Dismiss */}\n        <div className=\"flex items-center justify-between gap-2 mb-2\">\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\n            <div className=\"w-8 h-8 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center\">\n              <Flame className=\"w-5 h-5 text-white animate-pulse\" />\n            </div>\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"flex items-center gap-1.5 flex-wrap\">\n                <span key={offerIndex} className=\"font-black text-white text-sm sm:text-base flash-offer-enter inline-block\">{displayTitle}</span>\n                <span className=\"px-1.5 py-0.5 bg-yellow-400 text-yellow-900 text-[10px] font-black rounded animate-pulse shrink-0\">\n                  {currentOffer.badge}\n                </span>\n              </div>\n            </div>\n          </div>\n          <button\n            type=\"button\"\n            onClick={handleDismiss}\n            className=\"min-w-[44px] min-h-[44px] flex items-center justify-center p-2 text-white/60 hover:text-white rounded-full hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n            aria-label=\"Banner elrejtse ma\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        {/* Center: Countdown - Big and clear */}\n        <div className=\"flex items-center justify-center gap-1 mb-2.5\">\n          <Clock className=\"w-4 h-4 text-white/80\" />\n          <span className=\"text-white/80 text-xs font-medium mr-1\">Vge:</span>\n          {[\n            { value: timeLeft.hours, label: '' },\n            { value: timeLeft.minutes, label: 'p' },\n            { value: timeLeft.seconds, label: 'mp' }\n          ].map((unit, idx) => (\n            <React.Fragment key={idx}>\n              <div className=\"bg-black/30 backdrop-blur-sm rounded px-2 py-1\">\n                <span className=\"flash-countdown-digit text-white font-black text-lg tabular-nums inline-block\">{pad(unit.value)}</span>\n                <span className=\"text-white/70 text-[10px] ml-0.5\">{unit.label}</span>\n              </div>\n              {idx < 2 && <span className=\"text-white/40 font-bold\">:</span>}\n            </React.Fragment>\n          ))}\n        </div>\n\n        {/* CTA Button - Full width */}\n        <button\n          type=\"button\"\n          onClick={onViewSale}\n          className={`w-full min-h-[44px] flex items-center justify-center gap-2 px-4 py-3 bg-white ${ctaColor} font-bold text-sm rounded-lg shadow-lg active:scale-[0.98] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-current`}\n          aria-label={displayCta}\n        >\n          <Zap className=\"w-4 h-4\" aria-hidden />\n          <span key={offerIndex} className=\"animate-fade-in\">{displayCta}</span>\n          <ArrowRight className=\"w-4 h-4\" aria-hidden />\n        </button>\n      </div>\n\n      {/* Desktop Layout - flex-col: tartalom + pttyk sor + progress */}\n      <div className=\"hidden sm:flex flex-col relative max-w-[1200px] mx-auto\">\n        <div className=\"flex items-center justify-between gap-3 sm:gap-4 lg:gap-6 px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6\">\n          {/* Left: Icon + Title + Badge */}\n          <div className=\"flex items-center gap-3 min-w-0 flex-shrink\">\n            <div className=\"w-10 h-10 lg:w-11 lg:h-11 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center\">\n              <Flame className=\"w-6 h-6 lg:w-7 lg:h-7 text-white animate-pulse\" />\n            </div>\n            <div className=\"min-w-0\">\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <span key={`title-${offerIndex}`} className=\"font-black text-white text-base sm:text-lg lg:text-xl flash-offer-enter\">{displayTitle}</span>\n                <span className=\"px-2 py-0.5 bg-yellow-400 text-yellow-900 text-xs font-black rounded-md shrink-0\">\n                  {currentOffer.badge}\n                </span>\n              </div>\n              <p key={`sub-${offerIndex}`} className=\"text-white/80 text-xs lg:text-sm flash-offer-enter line-clamp-2 mt-0.5\">{displaySubtitle}</p>\n            </div>\n          </div>\n\n          {/* Center: Countdown */}\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"w-5 h-5 text-white/80\" />\n            <span className=\"text-white/90 text-sm font-medium\">Lejr:</span>\n            <div className=\"flex items-center gap-1\">\n              {[\n                { value: timeLeft.hours, label: 'ra' },\n                { value: timeLeft.minutes, label: 'perc' },\n                { value: timeLeft.seconds, label: 'mp' }\n              ].map((unit, idx) => (\n                <React.Fragment key={idx}>\n                  <div className=\"bg-black/30 backdrop-blur-sm rounded-lg px-2.5 lg:px-3 py-1.5\">\n                    <span className=\"flash-countdown-digit text-white font-black text-xl lg:text-2xl tabular-nums inline-block\">{pad(unit.value)}</span>\n                    <span className=\"text-white/70 text-[10px] lg:text-xs ml-1\">{unit.label}</span>\n                  </div>\n                  {idx < 2 && <span className=\"text-white/40 font-bold text-xl mx-0.5\">:</span>}\n                </React.Fragment>\n              ))}\n            </div>\n          </div>\n\n          {/* Right: CTA + Dismiss */}\n          <div className=\"flex items-center gap-3\">\n            <button\n              type=\"button\"\n              onClick={onViewSale}\n              className={`min-h-[44px] flex items-center gap-2 px-5 lg:px-6 py-2.5 bg-white ${ctaColor} font-bold text-sm lg:text-base rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-current`}\n              aria-label={displayCta}\n            >\n              <Zap className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n              <span key={offerIndex} className=\"animate-fade-in\">{displayCtaShort}</span>\n              <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n            </button>\n            <button\n              type=\"button\"\n              onClick={handleDismiss}\n              className=\"min-w-[44px] min-h-[44px] flex items-center justify-center p-2 text-white/60 hover:text-white rounded-full hover:bg-white/10 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n              aria-label=\"Banner elrejtse ma\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n        {/* Desktop: pttyk dediklt sorban, progress bar fltt */}\n        <div className=\"flex justify-center gap-2 py-4 z-10\" role=\"tablist\" aria-label=\"Ajnlat vltsa\">\n          {FLASH_OFFERS.map((_, i) => (\n            <button\n              key={i}\n              type=\"button\"\n              role=\"tab\"\n              aria-selected={offerIndex === i}\n              onClick={() => goToOffer(i)}\n              className={`w-3 h-3 rounded-full transition-all duration-200 min-w-[12px] min-h-[12px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-600 ${\n                offerIndex === i ? 'bg-white scale-125 shadow-lg' : 'bg-white/50 hover:bg-white/80'\n              }`}\n              aria-label={`Ajnlat ${i + 1}`}\n            />\n          ))}\n        </div>\n      </div>\n\n      {/* Dots  mobil: absolute, progress bar fltt */}\n      <div className=\"sm:hidden absolute bottom-10 left-0 right-0 flex justify-center gap-2 z-10\" role=\"tablist\" aria-label=\"Ajnlat vltsa\">\n        {FLASH_OFFERS.map((_, i) => (\n          <button\n            key={i}\n            type=\"button\"\n            role=\"tab\"\n            aria-selected={offerIndex === i}\n            onClick={() => goToOffer(i)}\n            className={`w-3 h-3 rounded-full transition-all duration-200 min-w-[12px] min-h-[12px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-600 ${\n              offerIndex === i ? 'bg-white scale-125 shadow-lg' : 'bg-white/50 hover:bg-white/80'\n            }`}\n            aria-label={`Ajnlat ${i + 1}`}\n          />\n        ))}\n      </div>\n\n      {/* Desktop: nyilak */}\n      <button\n        type=\"button\"\n        onClick={handlePrev}\n        className=\"hidden sm:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Elz ajnlat\"\n      >\n        <ChevronLeft className=\"w-5 h-5\" />\n      </button>\n      <button\n        type=\"button\"\n        onClick={handleNext}\n        className=\"hidden sm:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Kvetkez ajnlat\"\n      >\n        <ChevronRight className=\"w-5 h-5\" />\n      </button>\n\n      {/* Time-left progress bar  shrinks as countdown runs out */}\n      <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-black/20\" aria-hidden=\"true\">\n        <div className=\"h-full bg-white/60 transition-[width] duration-1000 ease-linear\" style={{ width: `${timeLeftProgress}%` }} />\n      </div>\n\n      <style>{`\n        @keyframes shimmer {\n          0% { transform: translateX(-100%) skewX(-12deg); }\n          100% { transform: translateX(200%) skewX(-12deg); }\n        }\n        @keyframes flash-slide-in {\n          from { opacity: 0; transform: translateX(12px); }\n          to { opacity: 1; transform: translateX(0); }\n        }\n        .flash-offer-enter {\n          animation: flash-slide-in 0.35s ease-out forwards;\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default FlashSaleBanner;\n","import React, { useState, useMemo } from 'react';\nimport { Truck, Clock, MapPin, CheckCircle, Package, Calendar, Zap, Info } from 'lucide-react';\n\n/**\n * DeliveryEstimator - Shows estimated delivery date based on location\n * Features: Postal code lookup, express delivery option, store pickup\n */\nconst DeliveryEstimator = ({ \n  product, \n  variant = 'compact' // 'compact' | 'full'\n}) => {\n  const [postalCode, setPostalCode] = useState('');\n  const [isChecking, setIsChecking] = useState(false);\n  const [deliveryInfo, setDeliveryInfo] = useState(null);\n\n  // Simulated delivery calculation\n  const calculateDelivery = (code) => {\n    setIsChecking(true);\n    \n    // Simulate API call\n    setTimeout(() => {\n      const isBudapest = code.startsWith('1');\n      const isLargeCity = ['2', '3', '4', '5', '6', '7', '8', '9'].some(n => code.startsWith(n) && parseInt(code) < 5000);\n      \n      const today = new Date();\n      const standardDays = isBudapest ? 2 : isLargeCity ? 3 : 5;\n      const expressDays = isBudapest ? 1 : 2;\n      \n      const standardDate = new Date(today);\n      standardDate.setDate(standardDate.getDate() + standardDays);\n      \n      const expressDate = new Date(today);\n      expressDate.setDate(expressDate.getDate() + expressDays);\n\n      setDeliveryInfo({\n        postalCode: code,\n        city: isBudapest ? 'Budapest' : isLargeCity ? 'Nagyvros' : 'Vidk',\n        standard: {\n          date: standardDate,\n          days: standardDays,\n          price: 0, // Free\n          available: true\n        },\n        express: {\n          date: expressDate,\n          days: expressDays,\n          price: 2990,\n          available: isBudapest || isLargeCity\n        },\n        pickup: {\n          available: isBudapest,\n          stores: isBudapest ? ['Budapest - Westend', 'Budapest - rkd'] : []\n        }\n      });\n      \n      setIsChecking(false);\n    }, 800);\n  };\n\n  const formatDate = (date) => {\n    const days = ['Vasrnap', 'Htf', 'Kedd', 'Szerda', 'Cstrtk', 'Pntek', 'Szombat'];\n    const months = ['jan.', 'feb.', 'mrc.', 'pr.', 'mj.', 'jn.', 'jl.', 'aug.', 'szept.', 'okt.', 'nov.', 'dec.'];\n    \n    return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}.`;\n  };\n\n  // Default delivery estimate without postal code\n  const defaultEstimate = useMemo(() => {\n    const today = new Date();\n    const minDate = new Date(today);\n    minDate.setDate(minDate.getDate() + 2);\n    const maxDate = new Date(today);\n    maxDate.setDate(maxDate.getDate() + 5);\n    \n    return {\n      minDays: 2,\n      maxDays: 5,\n      minDate,\n      maxDate\n    };\n  }, []);\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"flex items-center gap-3 p-3 bg-green-50 border border-green-100 rounded-xl\">\n        <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n          <Truck className=\"w-5 h-5 text-green-600\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          {deliveryInfo ? (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts: {formatDate(deliveryInfo.standard.date)}\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                {deliveryInfo.city}  Ingyenes szllts\n              </p>\n            </>\n          ) : (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts {defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanapon bell\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                50.000 Ft felett ingyenes\n              </p>\n            </>\n          )}\n        </div>\n        {!deliveryInfo && (\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"text\"\n              value={postalCode}\n              onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n              placeholder=\"Ir.szm\"\n              className=\"w-16 px-2 py-1.5 text-xs border border-gray-200 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-200 outline-none\"\n              maxLength={4}\n            />\n            <button\n              onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n              disabled={postalCode.length !== 4 || isChecking}\n              className=\"px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {isChecking ? '...' : 'OK'}\n            </button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"bg-white border border-gray-200 rounded-2xl p-5\">\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-white\">\n          <Truck className=\"w-6 h-6\" />\n        </div>\n        <div>\n          <h3 className=\"font-bold text-gray-900\">Szllts & tvtel</h3>\n          <p className=\"text-sm text-gray-500\">Add meg az irnytszmot a pontos idpontrt</p>\n        </div>\n      </div>\n\n      {/* Postal code input */}\n      <div className=\"flex gap-2 mb-5\">\n        <div className=\"relative flex-1\">\n          <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={postalCode}\n            onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n            placeholder=\"Irnytszm (pl. 1052)\"\n            className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-100 outline-none transition-all\"\n            maxLength={4}\n          />\n        </div>\n        <button\n          onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n          disabled={postalCode.length !== 4 || isChecking}\n          className=\"px-6 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n        >\n          {isChecking ? (\n            <>\n              <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n              Keress\n            </>\n          ) : (\n            <>\n              <Clock className=\"w-5 h-5\" />\n              Ellenrzs\n            </>\n          )}\n        </button>\n      </div>\n\n      {/* Results */}\n      {deliveryInfo ? (\n        <div className=\"space-y-3\">\n          {/* Standard delivery */}\n          <div className=\"flex items-center gap-4 p-4 bg-green-50 border border-green-200 rounded-xl\">\n            <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <p className=\"font-bold text-green-800\">Standard szllts</p>\n                <span className=\"px-2 py-0.5 bg-green-200 text-green-800 text-xs font-bold rounded-full\">INGYENES</span>\n              </div>\n              <p className=\"text-green-700 text-sm\">\n                Megrkezik: <strong>{formatDate(deliveryInfo.standard.date)}</strong>\n              </p>\n            </div>\n            <CheckCircle className=\"w-6 h-6 text-green-500\" />\n          </div>\n\n          {/* Express delivery */}\n          {deliveryInfo.express.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-amber-50 border border-amber-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center shrink-0\">\n                <Zap className=\"w-5 h-5 text-amber-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  <p className=\"font-bold text-amber-800\">Express szllts</p>\n                  <span className=\"px-2 py-0.5 bg-amber-200 text-amber-800 text-xs font-bold rounded-full\">\n                    +{deliveryInfo.express.price.toLocaleString('hu-HU')} Ft\n                  </span>\n                </div>\n                <p className=\"text-amber-700 text-sm\">\n                  Megrkezik: <strong>{formatDate(deliveryInfo.express.date)}</strong>\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Store pickup */}\n          {deliveryInfo.pickup.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-blue-50 border border-blue-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Package className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-bold text-blue-800\">Szemlyes tvtel</p>\n                <p className=\"text-blue-700 text-sm\">\n                  {deliveryInfo.pickup.stores.join('  ')}\n                </p>\n              </div>\n              <span className=\"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs font-bold rounded-full\">INGYENES</span>\n            </div>\n          )}\n        </div>\n      ) : (\n        /* Default estimate */\n        <div className=\"bg-gray-50 rounded-xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <Info className=\"w-5 h-5 text-gray-400 shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"text-gray-700\">\n                A vrhat szlltsi id <strong>{defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanap</strong>.\n                Add meg az irnytszmot a pontos dtumrt!\n              </p>\n              <p className=\"text-gray-500 text-sm mt-1\">\n                50.000 Ft feletti rendelsnl ingyenes hzhozszllts.\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DeliveryEstimator;\n","import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, Eye, ShoppingCart, Clock, TrendingUp, Users, Package } from 'lucide-react';\n\n/**\n * StockUrgency - Creates urgency with stock levels and real-time activity\n * Shows: Low stock warnings, recent purchases, viewing count\n */\nconst StockUrgency = ({ \n  product, \n  variant = 'full' // 'full' | 'compact' | 'badge'\n}) => {\n  const [viewingCount, setViewingCount] = useState(0);\n  const [recentPurchases, setRecentPurchases] = useState(0);\n  const [lastPurchaseTime, setLastPurchaseTime] = useState(null);\n\n  // Simulated real-time data (in production this would come from websocket/API)\n  useEffect(() => {\n    // Random initial values\n    setViewingCount(Math.floor(Math.random() * 15) + 3);\n    setRecentPurchases(Math.floor(Math.random() * 8) + 1);\n    \n    // Random last purchase time (within last hour)\n    const minutes = Math.floor(Math.random() * 45) + 5;\n    setLastPurchaseTime(minutes);\n\n    // Simulate activity updates\n    const viewInterval = setInterval(() => {\n      setViewingCount(prev => {\n        const change = Math.random() > 0.5 ? 1 : -1;\n        return Math.max(2, Math.min(25, prev + change));\n      });\n    }, 15000);\n\n    const purchaseInterval = setInterval(() => {\n      if (Math.random() > 0.7) {\n        setRecentPurchases(prev => prev + 1);\n        setLastPurchaseTime(Math.floor(Math.random() * 5) + 1);\n      }\n    }, 30000);\n\n    return () => {\n      clearInterval(viewInterval);\n      clearInterval(purchaseInterval);\n    };\n  }, [product?.id]);\n\n  if (!product) return null;\n\n  // Simulated stock level (in production from product data)\n  const stockLevel = product.stockLevel || Math.floor(Math.random() * 20) + 1;\n  const isLowStock = stockLevel <= 5;\n  const isVeryLowStock = stockLevel <= 2;\n  const isOutOfStock = stockLevel === 0;\n\n  // Badge variant - just shows stock status\n  if (variant === 'badge') {\n    if (isOutOfStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-full\">\n          <Package className=\"w-3 h-3\" />\n          Elfogyott\n        </span>\n      );\n    }\n    \n    if (isVeryLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full animate-pulse\">\n          <AlertTriangle className=\"w-3 h-3\" />\n          Utols {stockLevel} db!\n        </span>\n      );\n    }\n    \n    if (isLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n          <Clock className=\"w-3 h-3\" />\n          Mg {stockLevel} db\n        </span>\n      );\n    }\n    \n    return (\n      <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n        <Package className=\"w-3 h-3\" />\n        Raktron\n      </span>\n    );\n  }\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"space-y-2\">\n        {/* Stock level */}\n        {isLowStock && !isOutOfStock && (\n          <div className={`flex items-center gap-2 px-3 py-2 rounded-lg ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n            <AlertTriangle className={`w-4 h-4 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n            <span className={`text-sm font-bold ${isVeryLowStock ? 'text-red-700' : 'text-amber-700'}`}>\n              {isVeryLowStock ? `Csak ${stockLevel} db maradt!` : `Mr csak ${stockLevel} db raktron`}\n            </span>\n          </div>\n        )}\n\n        {/* Viewing count */}\n        <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n          <Eye className=\"w-4 h-4 text-primary-500\" />\n          <span>{viewingCount} ember nzi most</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"space-y-3\">\n      {/* Stock warning */}\n      {isOutOfStock ? (\n        <div className=\"flex items-center gap-3 p-4 bg-gray-100 border border-gray-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-gray-500\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-gray-700\">Jelenleg nincs raktron</p>\n            <p className=\"text-gray-500 text-sm\">rtestst krhetsz az jbli elrhetsgrl</p>\n          </div>\n        </div>\n      ) : isLowStock ? (\n        <div className={`flex items-center gap-3 p-4 rounded-xl ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n          <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${isVeryLowStock ? 'bg-red-100' : 'bg-amber-100'}`}>\n            <AlertTriangle className={`w-5 h-5 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n          </div>\n          <div className=\"flex-1\">\n            <p className={`font-bold ${isVeryLowStock ? 'text-red-800' : 'text-amber-800'}`}>\n              {isVeryLowStock ? ' Utols darabok!' : 'Alacsony kszlet'}\n            </p>\n            <p className={`text-sm ${isVeryLowStock ? 'text-red-600' : 'text-amber-600'}`}>\n              Mr csak <strong>{stockLevel} db</strong> van raktron\n            </p>\n          </div>\n          {/* Progress bar */}\n          <div className=\"w-16\">\n            <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className={`h-full transition-all ${isVeryLowStock ? 'bg-red-500' : 'bg-amber-500'}`}\n                style={{ width: `${Math.max(10, (stockLevel / 20) * 100)}%` }}\n              />\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-green-600\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-green-800\"> Raktron</p>\n            <p className=\"text-green-600 text-sm\">Azonnali szlltsra ksz</p>\n          </div>\n        </div>\n      )}\n\n      {/* Social proof - viewing & purchases */}\n      {!isOutOfStock && (\n        <div className=\"grid grid-cols-2 gap-3\">\n          {/* Currently viewing */}\n          <div className=\"flex items-center gap-2 p-3 bg-primary-50 rounded-xl\">\n            <div className=\"relative\">\n              <Eye className=\"w-5 h-5 text-primary-500\" />\n              <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n            </div>\n            <div>\n              <p className=\"text-lg font-bold text-primary-600\">{viewingCount}</p>\n              <p className=\"text-[10px] text-primary-500\">nzi most</p>\n            </div>\n          </div>\n\n          {/* Recent purchases */}\n          <div className=\"flex items-center gap-2 p-3 bg-secondary-50 rounded-xl\">\n            <ShoppingCart className=\"w-5 h-5 text-secondary-700\" />\n            <div>\n              <p className=\"text-lg font-bold text-secondary-700\">{recentPurchases}</p>\n              <p className=\"text-[10px] text-secondary-700\">vette meg ma</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Last purchase notification */}\n      {!isOutOfStock && lastPurchaseTime && lastPurchaseTime <= 30 && (\n        <div className=\"flex items-center gap-2 p-2.5 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100 rounded-lg animate-fade-in\">\n          <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <TrendingUp className=\"w-3.5 h-3.5 text-green-600\" />\n          </div>\n          <p className=\"text-xs text-green-700\">\n            <strong>Valaki most vette meg</strong> {lastPurchaseTime} perce {product.city || 'Budapest'}bl\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default StockUrgency;\n","import React, { useState } from 'react';\nimport { Share2, Copy, Check, Facebook, MessageCircle, Mail, Link2, X } from 'lucide-react';\n\n/**\n * ProductShare - Share product via social media or copy link\n * Features: Native share API, social links, copy link, QR code\n */\nconst ProductShare = ({ \n  product, \n  variant = 'button' // 'button' | 'icons' | 'modal'\n}) => {\n  const [showModal, setShowModal] = useState(false);\n  const [copied, setCopied] = useState(false);\n\n  if (!product) return null;\n\n  const shareUrl = product.link || window.location.href;\n  const shareTitle = product.name;\n  const shareText = `Nzd meg ezt a termket: ${product.name} - ${(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft`;\n\n  const handleNativeShare = async () => {\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: shareTitle,\n          text: shareText,\n          url: shareUrl\n        });\n      } catch (err) {\n        if (err.name !== 'AbortError') {\n          setShowModal(true);\n        }\n      }\n    } else {\n      setShowModal(true);\n    }\n  };\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const shareLinks = [\n    {\n      name: 'Facebook',\n      icon: Facebook,\n      color: 'bg-blue-600 hover:bg-blue-700',\n      url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'Messenger',\n      icon: MessageCircle,\n      color: 'bg-gradient-to-r from-blue-500 to-secondary-600 hover:from-blue-600 hover:to-secondary-700',\n      url: `fb-messenger://share/?link=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'WhatsApp',\n      icon: () => (\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-5 h-5\">\n          <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\n        </svg>\n      ),\n      color: 'bg-green-500 hover:bg-green-600',\n      url: `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`\n    },\n    {\n      name: 'Email',\n      icon: Mail,\n      color: 'bg-gray-600 hover:bg-gray-700',\n      url: `mailto:?subject=${encodeURIComponent(shareTitle)}&body=${encodeURIComponent(shareText + '\\n\\n' + shareUrl)}`\n    }\n  ];\n\n  // Button variant - single button that opens native share or modal\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={handleNativeShare}\n          className=\"flex items-center gap-2 px-4 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n        >\n          <Share2 className=\"w-4 h-4\" />\n          <span>Megoszts</span>\n        </button>\n\n        {/* Modal */}\n        {showModal && (\n          <ShareModal\n            product={product}\n            shareLinks={shareLinks}\n            shareUrl={shareUrl}\n            copied={copied}\n            onCopy={handleCopyLink}\n            onClose={() => setShowModal(false)}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Icons variant - row of social icons\n  if (variant === 'icons') {\n    return (\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-sm text-gray-500 mr-1\">Megoszts:</span>\n        {shareLinks.map((link) => (\n          <a\n            key={link.name}\n            href={link.url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className={`p-2 rounded-full text-white transition-all hover:scale-110 ${link.color}`}\n            title={link.name}\n          >\n            <link.icon className=\"w-4 h-4\" />\n          </a>\n        ))}\n        <button\n          onClick={handleCopyLink}\n          className={`p-2 rounded-full transition-all hover:scale-110 ${\n            copied ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'\n          }`}\n          title=\"Link msolsa\"\n        >\n          {copied ? <Check className=\"w-4 h-4\" /> : <Link2 className=\"w-4 h-4\" />}\n        </button>\n      </div>\n    );\n  }\n\n  return null;\n};\n\n// Share Modal Component\nconst ShareModal = ({ product, shareLinks, shareUrl, copied, onCopy, onClose }) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-end sm:items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden animate-slide-up\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"p-5 border-b border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-bold text-gray-900\">Termk megosztsa</h3>\n            <button\n              onClick={onClose}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Product preview */}\n        <div className=\"p-5\">\n          <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl mb-5\">\n            <img\n              src={product.images?.[0] || product.image}\n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n            />\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n              <p className=\"text-primary-500 font-bold\">\n                {(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft\n              </p>\n            </div>\n          </div>\n\n          {/* Share options */}\n          <div className=\"grid grid-cols-4 gap-3 mb-5\">\n            {shareLinks.map((link) => (\n              <a\n                key={link.name}\n                href={link.url}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex flex-col items-center gap-2 p-3 rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white ${link.color}`}>\n                  <link.icon className=\"w-5 h-5\" />\n                </div>\n                <span className=\"text-xs text-gray-600\">{link.name}</span>\n              </a>\n            ))}\n          </div>\n\n          {/* Copy link */}\n          <div className=\"flex gap-2\">\n            <div className=\"flex-1 flex items-center gap-2 px-4 py-3 bg-gray-100 rounded-xl overflow-hidden\">\n              <Link2 className=\"w-4 h-4 text-gray-400 shrink-0\" />\n              <span className=\"text-sm text-gray-600 truncate\">{shareUrl}</span>\n            </div>\n            <button\n              onClick={onCopy}\n              className={`px-4 py-3 font-bold rounded-xl transition-all flex items-center gap-2 ${\n                copied \n                  ? 'bg-green-500 text-white' \n                  : 'bg-primary-500 text-white hover:bg-primary-600'\n              }`}\n            >\n              {copied ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Msolva!\n                </>\n              ) : (\n                <>\n                  <Copy className=\"w-4 h-4\" />\n                  Msols\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.3s ease-out; }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ProductShare;\n","import React, { useState } from 'react';\nimport { FileText, Ruler, Star, MessageCircle, Truck, Shield, HelpCircle, ChevronDown, ChevronUp, Check } from 'lucide-react';\n\n/**\n * ProductTabs - Tabbed content for product details\n * Features: Description, Specs, Reviews, Q&A, Shipping, Warranty\n */\nconst ProductTabs = ({ product }) => {\n  const [activeTab, setActiveTab] = useState('description');\n  const [expandedFaq, setExpandedFaq] = useState(null);\n\n  const tabs = [\n    { id: 'description', label: 'Lers', icon: FileText },\n    { id: 'specs', label: 'Adatok', icon: Ruler },\n    { id: 'reviews', label: 'Vlemnyek', icon: Star, badge: '24' },\n    { id: 'faq', label: 'Krdsek', icon: HelpCircle },\n    { id: 'shipping', label: 'Szllts', icon: Truck },\n  ];\n\n  // Parse specs from product params\n  const specs = product?.params \n    ? product.params.split(',').map(p => {\n        const [name, value] = p.split(':').map(s => s.trim());\n        return { name, value: value || name };\n      }).filter(s => s.name)\n    : [];\n\n  // Simulated reviews\n  const reviews = [\n    { id: 1, author: 'Kovcs Anna', rating: 5, date: '2025-01-15', text: 'Nagyon szp termk, pont ilyen kellett! A minsg kivl, gyors szllts.', verified: true },\n    { id: 2, author: 'Nagy Pter', rating: 4, date: '2025-01-10', text: 'J r-rtk arny. Egy csillagot levonok mert kicsit nehz volt sszerakni.', verified: true },\n    { id: 3, author: 'Szab va', rating: 5, date: '2025-01-05', text: 'Gynyr! Nagyon elgedett vagyok, ajnlom mindenkinek.', verified: false },\n  ];\n\n  const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;\n\n  // FAQ items\n  const faqItems = [\n    { q: 'Mennyi id alatt rkezik meg?', a: 'A standard szlltsi id 2-5 munkanap, expressz szlltssal 1-2 nap.' },\n    { q: 'Milyen garancit kapok?', a: 'Minden termknkre 2 v gyrti garancia vonatkozik. Ezen fell 14 napos elllsi jog.' },\n    { q: 'Szemlyesen is tvehet?', a: 'Igen, budapesti zleteinkben szemlyesen is tvehet ingyenesen.' },\n    { q: 'Hogyan kell sszeszerelni?', a: 'A termkhez rszletes magyar nyelv sszeszerelsi tmutat tartozik. Igny esetn szakembernk is segt.' },\n  ];\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden\">\n      {/* Tab buttons - UNIFIED TYPOGRAPHY */}\n      <div className=\"flex overflow-x-auto border-b border-gray-200 scrollbar-hide\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id)}\n            className={`\n              flex items-center gap-2.5 px-5 sm:px-6 py-4 font-medium text-base whitespace-nowrap border-b-2 transition-all\n              ${activeTab === tab.id \n                ? 'border-primary-500 text-primary-500 bg-primary-50/50' \n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n              }\n            `}\n          >\n            <tab.icon className=\"w-5 h-5\" />\n            <span>{tab.label}</span>\n            {tab.badge && (\n              <span className={`px-2 py-0.5 text-sm rounded-full ${\n                activeTab === tab.id ? 'bg-primary-100 text-primary-600' : 'bg-gray-100 text-gray-600'\n              }`}>\n                {tab.badge}\n              </span>\n            )}\n          </button>\n        ))}\n      </div>\n\n      {/* Tab content - UNIFIED TYPOGRAPHY */}\n      <div className=\"p-5 sm:p-6 lg:p-8\">\n        {/* Description */}\n        {activeTab === 'description' && (\n          <div className=\"prose max-w-none text-gray-700\">\n            <p className=\"text-base sm:text-lg leading-relaxed\">\n              {product?.description || 'Nincs rszletes lers ehhez a termkhez.'}\n            </p>\n            \n            {/* Features list */}\n            <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              {['Prmium minsg anyagok', 'Knny sszeszerels', 'Modern dizjn', 'Tarts kivitelezs'].map((feature, idx) => (\n                <div key={idx} className=\"flex items-center gap-2.5 text-green-700\">\n                  <Check className=\"w-5 h-5 text-green-500\" />\n                  <span className=\"text-base\">{feature}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Specifications */}\n        {activeTab === 'specs' && (\n          <div>\n            {specs.length > 0 ? (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                {specs.map((spec, idx) => (\n                  <div key={idx} className=\"flex justify-between p-4 bg-gray-50 rounded-lg\">\n                    <span className=\"text-gray-600 text-base\">{spec.name}</span>\n                    <span className=\"font-medium text-gray-900 text-base\">{spec.value}</span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-gray-500 text-center py-8 text-base\">Nincs elrhet mszaki adat.</p>\n            )}\n          </div>\n        )}\n\n        {/* Reviews - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'reviews' && (\n          <div>\n            {/* Summary */}\n            <div className=\"flex items-center gap-6 p-5 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl mb-6\">\n              <div className=\"text-center\">\n                <p className=\"text-4xl sm:text-5xl font-bold text-amber-600\">{avgRating.toFixed(1)}</p>\n                <div className=\"flex justify-center mt-2\">\n                  {[1,2,3,4,5].map(star => (\n                    <Star \n                      key={star} \n                      className={`w-5 h-5 ${star <= avgRating ? 'text-amber-400 fill-amber-400' : 'text-gray-300'}`} \n                    />\n                  ))}\n                </div>\n                <p className=\"text-sm text-gray-500 mt-1\">{reviews.length} vlemny</p>\n              </div>\n              <div className=\"flex-1\">\n                {[5,4,3,2,1].map(rating => {\n                  const count = reviews.filter(r => r.rating === rating).length;\n                  const percent = (count / reviews.length) * 100;\n                  return (\n                    <div key={rating} className=\"flex items-center gap-2 mb-1.5\">\n                      <span className=\"text-sm text-gray-500 w-4\">{rating}</span>\n                      <Star className=\"w-4 h-4 text-amber-400 fill-amber-400\" />\n                      <div className=\"flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden\">\n                        <div className=\"h-full bg-amber-400 rounded-full\" style={{ width: `${percent}%` }} />\n                      </div>\n                      <span className=\"text-sm text-gray-400 w-6\">{count}</span>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Review list */}\n            <div className=\"space-y-5\">\n              {reviews.map((review) => (\n                <div key={review.id} className=\"border-b border-gray-100 pb-5 last:border-0\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-base\">\n                        {review.author.charAt(0)}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900 text-base flex items-center gap-2\">\n                          {review.author}\n                          {review.verified && (\n                            <span className=\"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded\"> Ellenrztt</span>\n                          )}\n                        </p>\n                        <p className=\"text-sm text-gray-400\">{new Date(review.date).toLocaleDateString('hu-HU')}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex\">\n                      {[1,2,3,4,5].map(star => (\n                        <Star \n                          key={star} \n                          className={`w-5 h-5 ${star <= review.rating ? 'text-amber-400 fill-amber-400' : 'text-gray-200'}`}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                  <p className=\"text-gray-700 text-base\">{review.text}</p>\n                </div>\n              ))}\n            </div>\n\n            {/* Write review button */}\n            <button className=\"w-full mt-5 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors\">\n              + Vlemny rsa\n            </button>\n          </div>\n        )}\n\n        {/* FAQ - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'faq' && (\n          <div className=\"space-y-3\">\n            {faqItems.map((item, idx) => (\n              <div \n                key={idx}\n                className=\"border border-gray-200 rounded-xl overflow-hidden\"\n              >\n                <button\n                  onClick={() => setExpandedFaq(expandedFaq === idx ? null : idx)}\n                  className=\"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors\"\n                >\n                  <span className=\"font-medium text-gray-900 text-base\">{item.q}</span>\n                  {expandedFaq === idx ? (\n                    <ChevronUp className=\"w-5 h-5 text-gray-400\" />\n                  ) : (\n                    <ChevronDown className=\"w-5 h-5 text-gray-400\" />\n                  )}\n                </button>\n                {expandedFaq === idx && (\n                  <div className=\"px-4 pb-4 text-gray-600 text-base animate-fade-in\">\n                    {item.a}\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {/* Ask question */}\n            <button className=\"w-full mt-3 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors flex items-center justify-center gap-2\">\n              <MessageCircle className=\"w-5 h-5\" />\n              Krds feltevse\n            </button>\n          </div>\n        )}\n\n        {/* Shipping - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'shipping' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-start gap-4 p-5 bg-green-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n                <Truck className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-green-800 text-lg\">Ingyenes szllts 50.000 Ft felett</p>\n                <p className=\"text-green-700 text-base\">Standard szllts: 2-5 munkanap</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start gap-4 p-5 bg-blue-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Shield className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-blue-800 text-lg\">2 v garancia</p>\n                <p className=\"text-blue-700 text-base\">Teljes kr gyrti garancia minden termkre</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 mt-5\">\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">2-5</p>\n                <p className=\"text-sm text-gray-500\">munkanap</p>\n              </div>\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">14</p>\n                <p className=\"text-sm text-gray-500\">nap ellls</p>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ProductTabs;\n","import React, { useState, useMemo } from 'react';\nimport { TrendingDown, TrendingUp, Minus, Clock, Bell, ChevronDown, ChevronUp, AlertCircle, Check } from 'lucide-react';\n\n/**\n * PriceHistory - Dynamic pricing indicator with history chart\n * Shows price trends and alerts for best buying time\n */\nconst PriceHistory = ({ \n  currentPrice = 0, \n  priceHistory = [], \n  productId,\n  onSetAlert \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [alertSet, setAlertSet] = useState(false);\n\n  // Early return if no valid price\n  const validPrice = currentPrice && currentPrice > 0 ? currentPrice : 100000;\n\n  // Generate mock price history if not provided\n  const history = useMemo(() => {\n    if (priceHistory.length > 0) return priceHistory;\n    \n    // Generate 6 months of price data\n    const months = ['Aug', 'Szept', 'Okt', 'Nov', 'Dec', 'Jan'];\n    const basePrice = validPrice;\n    \n    return months.map((month, idx) => {\n      const variance = (Math.random() - 0.5) * 0.3; // 15% variance\n      const price = Math.round(basePrice * (1 + variance));\n      return {\n        month,\n        price: price || basePrice, // Ensure price is never 0\n        date: new Date(2025, 7 + idx, 1)\n      };\n    });\n  }, [validPrice, priceHistory]);\n\n  // Calculate stats\n  const stats = useMemo(() => {\n    if (!history || history.length === 0) {\n      return { min: validPrice, max: validPrice, avg: validPrice, priceChange: 0, changePercent: '0.0', isLowest: false, isHighest: false, previousPrice: validPrice };\n    }\n    \n    const prices = history.map(h => h.price || validPrice);\n    const min = Math.min(...prices) || validPrice;\n    const max = Math.max(...prices) || validPrice;\n    const avg = Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) || validPrice;\n    const previousPrice = history[history.length - 2]?.price || validPrice;\n    const priceChange = validPrice - previousPrice;\n    const changePercent = previousPrice > 0 ? ((priceChange / previousPrice) * 100).toFixed(1) : '0.0';\n    const isLowest = validPrice <= min * 1.05; // Within 5% of lowest\n    const isHighest = validPrice >= max * 0.95;\n    \n    return { min, max, avg, priceChange, changePercent, isLowest, isHighest, previousPrice };\n  }, [history, validPrice]);\n\n  // Chart dimensions\n  const chartHeight = 60;\n  const chartWidth = 200;\n\n  // Generate SVG path for price chart\n  const chartPath = useMemo(() => {\n    const prices = history.map(h => h.price);\n    const min = Math.min(...prices) * 0.95;\n    const max = Math.max(...prices) * 1.05;\n    const range = max - min;\n    \n    const points = prices.map((price, idx) => {\n      const x = (idx / (prices.length - 1)) * chartWidth;\n      const y = chartHeight - ((price - min) / range) * chartHeight;\n      return `${x},${y}`;\n    });\n    \n    return `M ${points.join(' L ')}`;\n  }, [history]);\n\n  // Area fill path\n  const areaPath = useMemo(() => {\n    return `${chartPath} L ${chartWidth},${chartHeight} L 0,${chartHeight} Z`;\n  }, [chartPath]);\n\n  const handleSetAlert = () => {\n    setAlertSet(true);\n    onSetAlert?.(productId, currentPrice);\n    setTimeout(() => setAlertSet(false), 3000);\n  };\n\n  const getTrendIcon = () => {\n    if (stats.priceChange < 0) return <TrendingDown className=\"w-4 h-4\" />;\n    if (stats.priceChange > 0) return <TrendingUp className=\"w-4 h-4\" />;\n    return <Minus className=\"w-4 h-4\" />;\n  };\n\n  const getTrendColor = () => {\n    if (stats.priceChange < 0) return 'text-green-600 bg-green-50';\n    if (stats.priceChange > 0) return 'text-red-600 bg-red-50';\n    return 'text-gray-600 bg-gray-50';\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n      {/* Compact Header - Always visible */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between p-3 sm:p-4 hover:bg-gray-50 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-sm font-medium ${getTrendColor()}`}>\n            {getTrendIcon()}\n            <span>{stats.priceChange > 0 ? '+' : ''}{stats.changePercent}%</span>\n          </div>\n          \n          {stats.isLowest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n              <TrendingDown className=\"w-3 h-3\" />\n              Most a legolcsbb!\n            </span>\n          )}\n          \n          {stats.isHighest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n              <AlertCircle className=\"w-3 h-3\" />\n              Magas r\n            </span>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2 text-gray-500\">\n          <Clock className=\"w-4 h-4\" />\n          <span className=\"text-xs\">rvltozs</span>\n          {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      {isExpanded && (\n        <div className=\"px-3 sm:px-4 pb-4 space-y-4\">\n          {/* Mini Chart */}\n          <div className=\"bg-gray-50 rounded-xl p-4\">\n            <div className=\"flex items-end justify-between mb-3\">\n              <span className=\"text-xs text-gray-500\">Elmlt 6 hnap</span>\n              <div className=\"text-right\">\n                <span className=\"text-lg font-bold text-gray-900\">{currentPrice.toLocaleString()} Ft</span>\n                <span className=\"text-xs text-gray-500 ml-1\">most</span>\n              </div>\n            </div>\n            \n            {/* SVG Chart */}\n            <div className=\"relative h-16\">\n              <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className=\"w-full h-full\" preserveAspectRatio=\"none\">\n                {/* Gradient fill */}\n                <defs>\n                  <linearGradient id=\"priceGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                    <stop offset=\"0%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0.3\" />\n                    <stop offset=\"100%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0\" />\n                  </linearGradient>\n                </defs>\n                \n                {/* Area fill */}\n                <path d={areaPath} fill=\"url(#priceGradient)\" />\n                \n                {/* Line */}\n                <path \n                  d={chartPath} \n                  fill=\"none\" \n                  stroke={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} \n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n                \n                {/* Current price dot */}\n                <circle \n                  cx={chartWidth} \n                  cy={chartHeight - ((currentPrice - stats.min * 0.95) / (stats.max * 1.05 - stats.min * 0.95)) * chartHeight}\n                  r=\"4\" \n                  fill={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'}\n                />\n              </svg>\n              \n              {/* Month labels */}\n              <div className=\"absolute bottom-0 left-0 right-0 flex justify-between text-[10px] text-gray-400 -mb-4\">\n                {history.filter((_, i) => i % 2 === 0).map((h, i) => (\n                  <span key={i}>{h.month}</span>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Stats Grid */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"bg-green-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-green-600 mb-0.5\">Legalacsonyabb</div>\n              <div className=\"font-bold text-green-700 text-sm\">{stats.min.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-gray-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-gray-500 mb-0.5\">tlagr</div>\n              <div className=\"font-bold text-gray-700 text-sm\">{stats.avg.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-red-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-red-600 mb-0.5\">Legmagasabb</div>\n              <div className=\"font-bold text-red-700 text-sm\">{stats.max.toLocaleString()} Ft</div>\n            </div>\n          </div>\n\n          {/* Price Alert Button */}\n          <button\n            onClick={handleSetAlert}\n            disabled={alertSet}\n            className={`\n              w-full flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-medium transition-all\n              ${alertSet \n                ? 'bg-green-100 text-green-700' \n                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }\n            `}\n          >\n            {alertSet ? (\n              <>\n                <Check className=\"w-4 h-4\" />\n                rtests belltva!\n              </>\n            ) : (\n              <>\n                <Bell className=\"w-4 h-4\" />\n                rtests, ha cskken az r\n              </>\n            )}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PriceHistory;\n","import React, { useState } from 'react';\nimport { Zap, CreditCard, Truck, Shield, Check, ChevronRight, Apple, Smartphone, Lock, MapPin, User, Mail } from 'lucide-react';\n\n/**\n * OneClickCheckout - Express checkout for returning customers\n * Sleek, trustworthy design with saved payment methods\n */\nconst OneClickCheckout = ({ \n  product,\n  savedAddress,\n  savedPayment,\n  userEmail,\n  userName,\n  onCheckout,\n  onClose \n}) => {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState('saved');\n  const [step, setStep] = useState('confirm'); // 'confirm' | 'processing' | 'success'\n\n  const paymentMethods = [\n    { id: 'saved', label: 'Mentett krtya', icon: CreditCard, detail: ' 4242', badge: 'Gyors' },\n    { id: 'apple', label: 'Apple Pay', icon: Apple, detail: 'Egy rintssel', badge: null },\n    { id: 'google', label: 'Google Pay', icon: Smartphone, detail: 'Egy rintssel', badge: null },\n  ];\n\n  const handleCheckout = async () => {\n    setStep('processing');\n    setIsProcessing(true);\n    \n    // Simulate processing\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    setStep('success');\n    setIsProcessing(false);\n    \n    // Call parent callback\n    setTimeout(() => {\n      onCheckout?.({ product, payment: selectedPayment });\n    }, 1500);\n  };\n\n  if (step === 'success') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n          <Check className=\"w-8 h-8 text-green-600\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Sikeres rendels!</h3>\n        <p className=\"text-gray-600 mb-4\">Visszaigazolst kldtnk emailben.</p>\n        <div className=\"bg-gray-50 rounded-xl p-4 text-sm text-gray-600\">\n          <p>Rendelsszm: <span className=\"font-mono font-bold\">#MKT-{Math.random().toString(36).substr(2, 8).toUpperCase()}</span></p>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'processing') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Feldolgozs...</h3>\n        <p className=\"text-gray-600\">Krjk vrj, a fizets folyamatban.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-2xl overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-primary-500 to-secondary-600 px-5 py-4 text-white\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n            <Zap className=\"w-5 h-5\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-lg\">Gyors vsrls</h3>\n            <p className=\"text-white/80 text-sm\">Egy kattintssal ksz</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-5 space-y-4\">\n        {/* Product Summary */}\n        <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl\">\n          <div className=\"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden shrink-0\">\n            {product?.image && (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n            <p className=\"font-bold text-primary-600 mt-1\">{product?.price?.toLocaleString()} Ft</p>\n          </div>\n        </div>\n\n        {/* Saved Info */}\n        <div className=\"space-y-2\">\n          {/* Delivery Address */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <MapPin className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Szlltsi cm</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {savedAddress || '1234 Budapest, Plda utca 12.'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n\n          {/* Contact */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <Mail className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Email</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {userEmail || 'pelda@email.com'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n        </div>\n\n        {/* Payment Methods */}\n        <div>\n          <p className=\"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2\">Fizetsi md</p>\n          <div className=\"space-y-2\">\n            {paymentMethods.map((method) => (\n              <button\n                key={method.id}\n                onClick={() => setSelectedPayment(method.id)}\n                className={`\n                  w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-left\n                  ${selectedPayment === method.id \n                    ? 'border-primary-400 bg-primary-50' \n                    : 'border-gray-200 hover:border-gray-300'\n                  }\n                `}\n              >\n                <div className={`\n                  w-9 h-9 rounded-lg flex items-center justify-center\n                  ${selectedPayment === method.id ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-600'}\n                `}>\n                  <method.icon className=\"w-5 h-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-gray-900 text-sm\">{method.label}</span>\n                    {method.badge && (\n                      <span className=\"px-1.5 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded\">\n                        {method.badge}\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-xs text-gray-500\">{method.detail}</p>\n                </div>\n                <div className={`\n                  w-5 h-5 rounded-full border-2 flex items-center justify-center\n                  ${selectedPayment === method.id \n                    ? 'border-primary-500 bg-primary-500' \n                    : 'border-gray-300'\n                  }\n                `}>\n                  {selectedPayment === method.id && <Check className=\"w-3 h-3 text-white\" />}\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Trust Badges */}\n        <div className=\"flex items-center justify-center gap-4 py-2 text-xs text-gray-500\">\n          <span className=\"flex items-center gap-1\">\n            <Shield className=\"w-3.5 h-3.5 text-green-600\" />\n            Biztonsgos\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Lock className=\"w-3.5 h-3.5 text-green-600\" />\n            SSL titkosts\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Truck className=\"w-3.5 h-3.5 text-primary-500\" />\n            Gyors szllts\n          </span>\n        </div>\n\n        {/* CTA Button */}\n        <button\n          onClick={handleCheckout}\n          disabled={isProcessing}\n          className=\"w-full flex items-center justify-center gap-2 py-4 bg-gradient-to-r from-primary-500 to-secondary-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all disabled:opacity-50\"\n        >\n          <Zap className=\"w-5 h-5\" />\n          Megrendelem - {product?.price?.toLocaleString()} Ft\n        </button>\n\n        {/* Cancel */}\n        <button\n          onClick={onClose}\n          className=\"w-full py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n        >\n          Mgse, vissza a termkhez\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default OneClickCheckout;\n","import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { \n  Search, X, Clock, TrendingUp, ArrowRight, Sparkles, Package, \n  Filter, ChevronRight, Lightbulb, Tag, Eye, Zap, Star, Wand2,\n  ShoppingBag, ArrowUpRight, Percent, History, Mic, Camera\n} from 'lucide-react';\nimport { \n  smartSearch, \n  getAutocompleteSuggestions, \n  getProactiveSuggestions,\n  parseSearchIntent,\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats\n} from '../../services/aiSearchService';\nimport { fetchUnasProducts, fetchUnasProductById } from '../../services/unasApi';\nimport { trackSearch, getSearchHistory, getViewedProducts } from '../../services/userPreferencesService';\n\n// Keresett sz kiemelse a szvegben (case-insensitive, split tartalmazza a tallatokat)\nconst highlightMatch = (text, query) => {\n  if (!text || !query || query.length < 2) return text;\n  const q = query.trim().replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  const re = new RegExp(`(${q})`, 'gi');\n  const parts = String(text).split(re);\n  if (parts.length <= 1) return text;\n  return parts.map((part, i) =>\n    i % 2 === 1 ? (\n      <mark key={i} className=\"bg-amber-200/80 text-gray-900 rounded px-0.5 font-semibold\">{part}</mark>\n    ) : (\n      part\n    )\n  );\n};\n\n/**\n * SmartSearchBar - Vilgsznvonal AI-alap btorkeres\n * \n * Funkcik:\n * - Vals idej intelligens autocomplete\n * - Termszetes nyelv keress\n * - Szinonimk s magyar nyelvi sajtossgok\n * - Fuzzy matching (elgpels tolerns)\n * - Kontextus-tudatos javaslatok\n * - Proaktv ajnlsok\n * - Keressi szndk felismers\n * - Termk elnzet a tallatokban\n * - UX: tallat kiemels, / fkusz, animcik\n */\nconst SmartSearchBar = ({ \n  products = [], \n  categories = [],\n  indexVersion = 0,\n  shouldBuildIndex = true,\n  maxLocalIndex = 50000,\n  serverSearchMode = false,\n  onSearch, \n  onProductClick,\n  placeholder = \"Mit keresel? pl. 'modern kanap 200 ezer alatt'\" \n}) => {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [debouncedQuery, setDebouncedQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(-1); // Keyboard navigation\n  const [indexStatus, setIndexStatus] = useState({ ready: false, building: false, count: 0 });\n  const [serverPreview, setServerPreview] = useState({ results: [], total: 0, loading: false });\n  const inputRef = useRef(null);\n  const containerRef = useRef(null);\n  const debounceTimerRef = useRef(null);\n  const resultsRef = useRef(null);\n  const indexedCountRef = useRef(0);\n  const indexedVersionRef = useRef(0);\n  const serverRequestIdRef = useRef(0);\n\n  const canUseLocalIndex = !serverSearchMode && shouldBuildIndex && products.length > 0 && products.length <= maxLocalIndex;\n  const localIndexDisabled = serverSearchMode || (shouldBuildIndex && products.length > maxLocalIndex);\n\n  //  BUILD SEARCH INDEX when products are loaded (async, non-blocking)\n  useEffect(() => {\n    if (!canUseLocalIndex) {\n      if (localIndexDisabled) {\n        setIndexStatus({ ready: false, building: false, count: 0 });\n      }\n      return;\n    }\n    if (products.length > 0 && (products.length !== indexedCountRef.current || indexVersion !== indexedVersionRef.current)) {\n      console.log(` Products: ${products.length}, starting async index build...`);\n      setIndexStatus({ ready: false, building: true, count: 0 });\n      \n      // Build async\n      const doBuild = async () => {\n        try {\n          const success = await buildSearchIndex(products);\n          if (success) {\n            const stats = getIndexStats();\n            indexedCountRef.current = products.length;\n            indexedVersionRef.current = indexVersion;\n            setIndexStatus({ \n              ready: true, \n              building: false, \n              count: stats.productCount \n            });\n          }\n        } catch (err) {\n          console.error('Index build error:', err);\n          setIndexStatus({ ready: false, building: false, count: 0 });\n        }\n      };\n      \n      // Start when browser is idle to avoid jank\n      if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n        window.requestIdleCallback(() => doBuild(), { timeout: 2000 });\n      } else {\n        setTimeout(doBuild, 300);\n      }\n    }\n  }, [products.length, indexVersion, canUseLocalIndex, localIndexDisabled]);\n\n  // Debounce query - csak 300ms utn kezdjen keresni\n  useEffect(() => {\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    debounceTimerRef.current = setTimeout(() => {\n      setDebouncedQuery(query);\n    }, 200);\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, [query]);\n\n  // Server-side search: trigger on debounced input\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    onSearch?.(q);\n  }, [debouncedQuery, onSearch, serverSearchMode]);\n\n  // Server-side preview results for typeahead\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    if (q.length < 2) {\n      setServerPreview({ results: [], total: 0, loading: false });\n      return;\n    }\n    const requestId = ++serverRequestIdRef.current;\n    setServerPreview((prev) => ({ ...prev, loading: true }));\n    fetchUnasProducts({ search: q, limit: 6, offset: 0, slim: true })\n      .then((data) => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({\n          results: Array.isArray(data.products) ? data.products : [],\n          total: typeof data.total === 'number' ? data.total : 0,\n          loading: false\n        });\n      })\n      .catch(() => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({ results: [], total: 0, loading: false });\n      });\n  }, [debouncedQuery, serverSearchMode]);\n\n  // Autocomplete javaslatok - TELJES katalgusbl keres\n  const autocompleteSuggestions = useMemo(() => {\n    if (!canUseLocalIndex) return [];\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2 || !products.length) return [];\n    // TELJES katalgus hasznlata - a getAutocompleteSuggestions mr optimalizlt\n    return getAutocompleteSuggestions(products, debouncedQuery, 8);\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Keressi eredmnyek - CSAK ha debounced query vltozik\n  const searchResults = useMemo(() => {\n    if (!canUseLocalIndex) return { results: [], intent: null, totalMatches: 0 };\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2) return { results: [], intent: null, totalMatches: 0 };\n    return smartSearch(products, debouncedQuery, { limit: 8, includeDebugInfo: false });\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Felismert keressi szndk\n  const searchIntent = useMemo(() => {\n    if (!debouncedQuery.trim() || debouncedQuery.length < 3) return null;\n    return parseSearchIntent(debouncedQuery);\n  }, [debouncedQuery]);\n\n  // Proaktv javaslatok - egyszer szmtva, nem minden renderben\n  const proactiveSuggestions = useMemo(() => {\n    // Nem hasznljuk a products-ot itt, mert lass lenne\n    return getProactiveSuggestions([]);\n  }, []);\n\n  // Keressi elzmnyek - egyszer beolvasva\n  const recentSearches = useMemo(() => {\n    const history = getSearchHistory(4);\n    return history.map(h => h.query).filter(q => q && q.length > 0);\n  }, []);\n\n  // Nemrg nzett termkek - egyszer beolvasva\n  const recentlyViewed = useMemo(() => {\n    return getViewedProducts(3);\n  }, []);\n\n  // Trendi keressek - statikus + szemlyre szabott\n  const trendingSearches = useMemo(() => {\n    const viewed = getViewedProducts(3);\n    const viewedCategories = viewed.map(p => p.category?.split(' > ')[0]).filter(Boolean);\n    \n    const defaults = [\n      { text: 'modern kanap', icon: '' },\n      { text: 'skandinv stlus', icon: '' },\n      { text: 'akcis btorok', icon: '' },\n      { text: 'kompakt btor', icon: '' },\n    ];\n    \n    const personalized = viewedCategories.map(c => ({\n      text: `${c} ajnlatok`,\n      icon: '',\n    }));\n    \n    const combined = [...personalized, ...defaults];\n    return combined.filter((v, i, a) => a.findIndex(t => t.text === v.text) === i).slice(0, 4);\n  }, []);\n\n  // Close on outside click\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Keyboard shortcut: \"/\" focuses search (unless already in input/textarea)\n  useEffect(() => {\n    const handleGlobalKeyDown = (e) => {\n      if (e.key !== '/' || e.ctrlKey || e.metaKey || e.altKey) return;\n      const target = e.target;\n      if (target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable)) return;\n      e.preventDefault();\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    document.addEventListener('keydown', handleGlobalKeyDown);\n    return () => document.removeEventListener('keydown', handleGlobalKeyDown);\n  }, []);\n\n  // Fejlc Keress gomb: scroll utn fkusz + dropdown nyits\n  useEffect(() => {\n    const handleFocusSearch = () => {\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    window.addEventListener('mkt-focus-search', handleFocusSearch);\n    return () => window.removeEventListener('mkt-focus-search', handleFocusSearch);\n  }, []);\n\n  // === CALLBACK DEFINCIK (useEffect ELTT kell lennik!) ===\n  \n  const handleSubmit = useCallback((e) => {\n    e?.preventDefault();\n    if (query.trim()) {\n      trackSearch(query);\n      onSearch?.(query);\n      setIsOpen(false);\n    }\n  }, [query, onSearch]);\n\n  const handleInputChange = useCallback((e) => {\n    const value = e.target.value;\n    setQuery(value);\n  }, []);\n\n  const handleProductClickFn = useCallback(async (product) => {\n    if (serverSearchMode && product?.id) {\n      const full = await fetchUnasProductById(product.id);\n      onProductClick?.(full || product);\n    } else {\n      onProductClick?.(product);\n    }\n    setQuery('');\n    setIsOpen(false);\n  }, [onProductClick, serverSearchMode]);\n\n  const handleSuggestionClick = useCallback((suggestion) => {\n    const text = typeof suggestion === 'string' ? suggestion : suggestion.text || suggestion.query;\n    setQuery(text);\n    trackSearch(text);\n    onSearch?.(text);\n    setIsOpen(false);\n  }, [onSearch]);\n\n  const handleAutocompleteClickFn = useCallback((item) => {\n    if (item.type === 'product' && item.product) {\n      handleProductClickFn(item.product);\n    } else {\n      handleSuggestionClick(item.text);\n    }\n  }, [handleProductClickFn, handleSuggestionClick]);\n\n  const clearQuery = useCallback(() => {\n    setQuery('');\n    inputRef.current?.focus();\n  }, []);\n\n  // Alias for backwards compatibility\n  const handleProductClick = handleProductClickFn;\n  const handleAutocompleteClick = handleAutocompleteClickFn;\n\n  // === NAVIGLHAT ELEMEK ===\n  \n  // sszes naviglhat elem (autocomplete + search results)\n  const allNavigableItems = useMemo(() => {\n    const items = [];\n    \n    // Autocomplete javaslatok\n    if (debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0) {\n      autocompleteSuggestions.forEach((sug, idx) => {\n        items.push({ type: 'autocomplete', item: sug, index: idx });\n      });\n    }\n    \n    // Keressi eredmnyek\n    if (debouncedQuery.length >= 2 && searchResults.results?.length > 0) {\n      searchResults.results.slice(0, 6).forEach((product, idx) => {\n        items.push({ type: 'result', item: product, index: idx });\n      });\n    }\n    \n    return items;\n  }, [debouncedQuery, autocompleteSuggestions, searchResults.results]);\n\n  // Reset selection when results change\n  useEffect(() => {\n    setSelectedIndex(-1);\n  }, [debouncedQuery]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (!isOpen) return;\n      \n      const totalItems = allNavigableItems.length;\n      \n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev < totalItems - 1 ? prev + 1 : 0;\n            return next;\n          });\n          break;\n          \n        case 'ArrowUp':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev > 0 ? prev - 1 : totalItems - 1;\n            return next;\n          });\n          break;\n          \n        case 'Enter':\n          if (selectedIndex >= 0 && selectedIndex < totalItems) {\n            e.preventDefault();\n            const selected = allNavigableItems[selectedIndex];\n            if (selected.type === 'autocomplete') {\n              handleAutocompleteClickFn(selected.item);\n            } else if (selected.type === 'result') {\n              handleProductClickFn(selected.item);\n            }\n          }\n          break;\n          \n        case 'Escape':\n          setIsOpen(false);\n          setSelectedIndex(-1);\n          inputRef.current?.blur();\n          break;\n          \n        case 'Tab':\n          if (totalItems > 0) {\n            e.preventDefault();\n            setSelectedIndex(prev => (prev + 1) % totalItems);\n          }\n          break;\n      }\n    };\n    \n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, allNavigableItems, selectedIndex, handleAutocompleteClickFn, handleProductClickFn]);\n\n  // Render intent tags\n  const renderIntentTags = () => {\n    if (!searchIntent) return null;\n    \n    const tags = [];\n    \n    if (searchIntent.productTypes.length > 0) {\n      tags.push({ label: searchIntent.productTypes[0], color: 'primary', icon: ShoppingBag });\n    }\n    if (searchIntent.styles.length > 0) {\n      tags.push({ label: searchIntent.styles[0], color: 'purple', icon: Sparkles });\n    }\n    if (searchIntent.colors.length > 0) {\n      tags.push({ label: searchIntent.colors[0], color: 'blue', icon: Tag });\n    }\n    if (searchIntent.priceRange) {\n      const priceLabel = searchIntent.priceRange.max === Infinity \n        ? `${(searchIntent.priceRange.min / 1000).toFixed(0)}k+ Ft`\n        : `${(searchIntent.priceRange.min / 1000).toFixed(0)}-${(searchIntent.priceRange.max / 1000).toFixed(0)}k Ft`;\n      tags.push({ label: priceLabel, color: 'green', icon: Tag });\n    }\n    if (searchIntent.isOnSale) {\n      tags.push({ label: 'Akcis', color: 'red', icon: Percent });\n    }\n    \n    if (tags.length === 0) return null;\n    \n    return (\n      <div className=\"flex flex-wrap gap-1.5 px-4 py-2.5 border-b border-gray-100 bg-gradient-to-r from-primary-50/40 to-transparent\">\n        <span className=\"text-xs text-gray-500 mr-1 flex items-center gap-1.5 font-medium\">\n          <Wand2 className=\"w-3.5 h-3.5 text-primary-500\" />\n          Felismert:\n        </span>\n        {tags.map((tag, i) => (\n          <span \n            key={i}\n            className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium\n              ${tag.color === 'primary' ? 'bg-primary-100 text-primary-700' : ''}\n              ${tag.color === 'purple' ? 'bg-purple-100 text-purple-700' : ''}\n              ${tag.color === 'blue' ? 'bg-blue-100 text-blue-700' : ''}\n              ${tag.color === 'green' ? 'bg-green-100 text-green-700' : ''}\n              ${tag.color === 'red' ? 'bg-red-100 text-red-700' : ''}\n            `}\n          >\n            <tag.icon className=\"w-3 h-3\" />\n            {tag.label}\n          </span>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div ref={containerRef} className=\"relative w-full max-w-3xl mx-auto\">\n      {/* Backdrop - subtle overlay when dropdown open (mobile-friendly) */}\n      {isOpen && (\n        <div \n          className=\"search-dropdown-backdrop fixed inset-0 bg-black/5 z-[9998] sm:bg-transparent sm:pointer-events-none\"\n          aria-hidden=\"true\"\n        />\n      )}\n      {/* Search Input */}\n      <form onSubmit={handleSubmit} className=\"relative\">\n        <div className={`search-input-wrapper\n          flex items-center gap-2 bg-white rounded-2xl border-2 transition-all duration-200\n          ${isOpen \n            ? 'border-primary-400 shadow-xl shadow-primary-100/50 ring-4 ring-primary-50' \n            : 'border-gray-200 hover:border-gray-300 hover:shadow-md'}\n        `}>\n          <div className=\"flex items-center pl-4\">\n            {indexStatus.building ? (\n              <div className=\"w-5 h-5 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" title=\"Index ptse...\" />\n            ) : query.length >= 2 && query !== debouncedQuery ? (\n              <div className=\"w-5 h-5 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n            ) : (\n              <Search className={`w-5 h-5 transition-colors ${isOpen ? 'text-primary-500' : 'text-gray-400'}`} />\n            )}\n          </div>\n          \n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={query}\n            onChange={handleInputChange}\n            onFocus={() => setIsOpen(true)}\n            placeholder={placeholder}\n            className=\"flex-1 py-3.5 sm:py-4 bg-transparent text-gray-900 placeholder-gray-400 text-sm sm:text-base focus:outline-none\"\n            autoComplete=\"off\"\n            spellCheck=\"false\"\n          />\n\n          {query && (\n            <button\n              type=\"button\"\n              onClick={clearQuery}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          <button\n            type=\"submit\"\n            className=\"flex items-center gap-2 px-5 sm:px-6 py-2.5 sm:py-3 mr-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold text-sm rounded-xl hover:from-primary-600 hover:to-primary-700 hover:shadow-lg hover:shadow-primary-500/25 transition-all active:scale-95\"\n          >\n            <Search className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Keress</span>\n          </button>\n        </div>\n      </form>\n\n      {/* Dropdown Panel */}\n      {isOpen && (\n        <div className=\"search-dropdown-enter search-dropdown-scroll absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md rounded-2xl border border-gray-100 overflow-hidden z-[9999] max-h-[75vh] overflow-y-auto\">\n          \n          {/* Intent Tags - ha van felismert szndk */}\n          {debouncedQuery.length >= 3 && renderIntentTags()}\n\n          {/* Autocomplete javaslatok - gpels kzben */}\n          {debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0 && (\n            <div className=\"border-b border-gray-100\">\n              <div className=\"p-2\">\n                <p className=\"px-3 py-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <Zap className=\"w-3.5 h-3.5 text-amber-500\" />\n                  Javaslatok\n                </p>\n                {autocompleteSuggestions.map((item, idx) => {\n                  const isSelected = selectedIndex === idx;\n                  return (\n                  <button\n                    key={idx}\n                    onClick={() => handleAutocompleteClick(item)}\n                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all text-left group\n                      ${isSelected \n                        ? 'bg-primary-100 ring-2 ring-primary-400 ring-inset' \n                        : 'hover:bg-primary-50'\n                      }`}\n                  >\n                    <div className={`\n                      w-8 h-8 rounded-lg flex items-center justify-center shrink-0\n                      ${item.type === 'product' ? 'bg-primary-100' : ''}\n                      ${item.type === 'category' ? 'bg-secondary-100' : ''}\n                      ${item.type === 'keyword' ? 'bg-gray-100' : ''}\n                      ${item.type === 'synonym' ? 'bg-purple-100' : ''}\n                      ${item.type === 'popular' ? 'bg-amber-100' : ''}\n                    `}>\n                      {item.type === 'product' && item.product?.image ? (\n                        <img src={item.product.image} alt=\"\" className=\"w-full h-full object-cover rounded-lg\" />\n                      ) : (\n                        <>\n                          {item.type === 'product' && <Package className=\"w-4 h-4 text-primary-600\" />}\n                          {item.type === 'category' && <Filter className=\"w-4 h-4 text-secondary-600\" />}\n                          {item.type === 'keyword' && <Search className=\"w-4 h-4 text-gray-500\" />}\n                          {item.type === 'synonym' && <Sparkles className=\"w-4 h-4 text-purple-600\" />}\n                          {item.type === 'popular' && <TrendingUp className=\"w-4 h-4 text-amber-600\" />}\n                        </>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <span className=\"text-sm text-gray-800 font-medium\">\n                        {item.type === 'product' && debouncedQuery ? highlightMatch(item.text, debouncedQuery) : item.text}\n                      </span>\n                      {item.type === 'product' && item.product && (\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {item.product.price?.toLocaleString()} Ft\n                        </p>\n                      )}\n                    </div>\n                    <ArrowUpRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (server-side preview) */}\n          {serverSearchMode && debouncedQuery.length >= 2 && serverPreview.results && serverPreview.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{(serverPreview.total || serverPreview.results.length).toLocaleString()} tallat</span>\n                  </p>\n                </div>\n                {(serverPreview.total || 0) > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {serverPreview.results.slice(0, 6).map((product, idx) => {\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (local index) */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.results && searchResults.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{searchResults.totalMatches.toLocaleString()} tallat</span>\n                  </p>\n                  {searchResults.searchTime != null && (\n                    <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-xs font-medium\">\n                      <Zap className=\"w-3 h-3\" />\n                      {searchResults.searchTime < 1 ? '<1' : Math.round(searchResults.searchTime)} ms\n                    </span>\n                  )}\n                </div>\n                {searchResults.totalMatches > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {searchResults.results.slice(0, 6).map((product, idx) => {\n                  // Calculate actual index for keyboard navigation (after autocomplete items)\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {/* Pozci badge */}\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.originalPrice && product.originalPrice > (product.salePrice || product.price) && (\n                          <>\n                            <span className=\"text-xs text-gray-400 line-through\">\n                              {product.originalPrice.toLocaleString()} Ft\n                            </span>\n                            <span className=\"text-xs bg-gradient-to-r from-red-500 to-pink-500 text-white px-2 py-0.5 rounded-full font-bold shadow-sm\">\n                              -{Math.round((1 - (product.salePrice || product.price) / product.originalPrice) * 100)}%\n                            </span>\n                          </>\n                        )}\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* \"Erre gondoltl?\" javaslat */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.didYouMean && (\n            <div className=\"px-4 py-3 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-amber-100\">\n              <button\n                onClick={() => handleSuggestionClick(searchResults.didYouMean.query)}\n                className=\"flex items-center gap-2 text-sm group\"\n              >\n                <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                <span className=\"text-gray-600\">Erre gondoltl?</span>\n                <span className=\"font-semibold text-amber-700 group-hover:text-amber-800 underline underline-offset-2\">\n                  {searchResults.didYouMean.query}\n                </span>\n                <ArrowRight className=\"w-4 h-4 text-amber-500 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </div>\n          )}\n\n          {/* Nincs tallat - finomtott empty state */}\n          {serverSearchMode && debouncedQuery.length >= 2 && !serverPreview.loading && serverPreview.results.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n          {!serverSearchMode && debouncedQuery.length >= 2 && (!searchResults.results || searchResults.results.length === 0) && autocompleteSuggestions.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              \n              {/* Javaslatok */}\n              {searchResults.suggestions?.length > 0 && (\n                <div className=\"space-y-3\">\n                  <p className=\"text-xs text-gray-500 uppercase tracking-wide font-semibold\">Prbld ezeket:</p>\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    {searchResults.suggestions.map((sug, i) => (\n                      <button\n                        key={i}\n                        onClick={() => handleSuggestionClick({ text: sug.action })}\n                        className=\"inline-flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-200 hover:border-primary-300 hover:bg-primary-50 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all shadow-sm hover:shadow\"\n                      >\n                        <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Npszer keressek fallback */}\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Betlts jelz gpels kzben - shimmer UX */}\n          {query.length >= 2 && query !== debouncedQuery && (\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-center gap-3 mb-4\">\n                <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin shrink-0\" />\n                <span className=\"text-sm font-medium text-gray-600\">Keress...</span>\n              </div>\n              <div className=\"space-y-2\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"search-loading-shimmer h-16 rounded-xl\" />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Kezdllapot - amikor nincs query */}\n          {debouncedQuery.length < 2 && query.length < 2 && (\n            <>\n              {/* Proaktv AI javaslatok */}\n              {proactiveSuggestions.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100 bg-gradient-to-r from-primary-50/50 to-secondary-50/50\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-600 uppercase tracking-wider flex items-center gap-1.5 mb-2\">\n                    <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                    Szemlyre szabott ajnlatok\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {proactiveSuggestions.map((sug, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(sug)}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-white hover:bg-primary-50 border border-gray-200 hover:border-primary-300 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all hover:shadow-sm\"\n                      >\n                        <span>{sug.icon}</span>\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Korbbi keressek */}\n              {recentSearches.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <History className=\"w-3.5 h-3.5\" />\n                    Korbbi keressek\n                  </p>\n                  <div className=\"mt-2 space-y-1\">\n                    {recentSearches.map((search, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(search)}\n                        className=\"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-gray-50 transition-colors text-left group\"\n                      >\n                        <Clock className=\"w-4 h-4 text-gray-400\" />\n                        <span className=\"flex-1 text-sm text-gray-700\">{search}</span>\n                        <ArrowRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Nemrg nzett termkek */}\n              {recentlyViewed.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Eye className=\"w-3.5 h-3.5\" />\n                    Nemrg nzett\n                  </p>\n                  <div className=\"mt-2 flex gap-3 overflow-x-auto pb-2 scrollbar-hide\">\n                    {recentlyViewed.map((product, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleProductClick(product)}\n                        className=\"flex-shrink-0 w-24 group\"\n                      >\n                        <div className=\"w-24 h-24 bg-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all\">\n                          {product.image ? (\n                            <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n                          ) : (\n                            <div className=\"w-full h-full flex items-center justify-center\">\n                              <Package className=\"w-8 h-8 text-gray-300\" />\n                            </div>\n                          )}\n                        </div>\n                        <p className=\"mt-1.5 text-xs text-gray-700 truncate group-hover:text-primary-600 transition-colors font-medium\">\n                          {product.name}\n                        </p>\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {product.price?.toLocaleString()} Ft\n                        </p>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Trendi keressek */}\n              <div className=\"p-3\">\n                <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <TrendingUp className=\"w-3.5 h-3.5 text-primary-500\" />\n                  Npszer keressek\n                </p>\n                <div className=\"mt-2 flex flex-wrap gap-2\">\n                  {trendingSearches.map((item, idx) => (\n                    <button\n                      key={idx}\n                      onClick={() => handleSuggestionClick(item.text)}\n                      className=\"flex items-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-xl text-sm font-medium transition-colors\"\n                    >\n                      <span>{item.icon}</span>\n                      {item.text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Gyors kategrik */}\n              {categories.length > 0 && (\n                <div className=\"p-3 pt-0\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Filter className=\"w-3.5 h-3.5\" />\n                    Kategrik\n                  </p>\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {categories.slice(0, 6).map((cat, idx) => {\n                      const name = typeof cat === 'string' ? cat : cat.name;\n                      const count = typeof cat === 'string' ? null : cat.totalCount;\n                      return (\n                        <button\n                          key={idx}\n                          onClick={() => handleSuggestionClick(name)}\n                          className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm transition-colors flex items-center gap-2\"\n                        >\n                          <span>{name}</span>\n                          {typeof count === 'number' && (\n                            <span className=\"text-xs text-gray-500\">({count.toLocaleString('hu-HU')})</span>\n                          )}\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {/* Footer - keressi tippek s keyboard hints */}\n          <div className=\"px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-t border-gray-100\">\n            <div className=\"flex items-center justify-between flex-wrap gap-2\">\n              <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                {indexStatus.building ? (\n                  <span className=\"flex items-center gap-1.5 text-amber-600\">\n                    <div className=\"w-3 h-3 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" />\n                     Tanuls folyamatban...\n                  </span>\n                ) : indexStatus.ready ? (\n                  <span className=\"flex items-center gap-1.5 text-green-600\">\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                     {indexStatus.count?.toLocaleString()} termk betanulva\n                  </span>\n                ) : (\n                  <span> Keress termszetesen, pl. &quot;fehr kanap 150e alatt&quot;</span>\n                )}\n              </div>\n              <div className=\"flex items-center gap-3 text-xs text-gray-400 flex-wrap\">\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">/</kbd>\n                  <span>keress</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\"></kbd>\n                  <span>navigls</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Enter</kbd>\n                  <span>kivlaszts</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Esc</kbd>\n                  <span>bezrs</span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SmartSearchBar;\n","import React, { useState } from 'react';\nimport { Ruler, Camera, Check, X, AlertTriangle, RefreshCw, Maximize2, ArrowRight, Home, HelpCircle, Sparkles } from 'lucide-react';\n\n/**\n * ARMeasure - AR Measurement tool for checking if furniture fits\n * Room dimension calculator and fit checker\n */\nconst ARMeasure = ({ \n  product,\n  onClose,\n  onConfirmFit \n}) => {\n  const [step, setStep] = useState('input'); // 'input' | 'measuring' | 'result'\n  const [roomDimensions, setRoomDimensions] = useState({\n    width: '',\n    length: '',\n    height: ''\n  });\n  const [fitResult, setFitResult] = useState(null);\n\n  // Product dimensions (mock if not provided)\n  const productDimensions = {\n    width: product?.dimensions?.width || 220,\n    depth: product?.dimensions?.depth || 95,\n    height: product?.dimensions?.height || 85,\n  };\n\n  const handleDimensionChange = (field, value) => {\n    const numValue = value.replace(/[^0-9]/g, '');\n    setRoomDimensions(prev => ({ ...prev, [field]: numValue }));\n  };\n\n  const handleCheckFit = () => {\n    setStep('measuring');\n    \n    // Simulate measurement processing\n    setTimeout(() => {\n      const roomW = parseInt(roomDimensions.width) || 0;\n      const roomL = parseInt(roomDimensions.length) || 0;\n      const roomH = parseInt(roomDimensions.height) || 300;\n      \n      const fitsWidth = productDimensions.width + 100 <= roomW; // 100cm clearance\n      const fitsDepth = productDimensions.depth + 80 <= roomL; // 80cm walkway\n      const fitsHeight = productDimensions.height + 50 <= roomH;\n      \n      const spaceFit = fitsWidth && fitsDepth && fitsHeight;\n      const tightFit = !spaceFit && (productDimensions.width <= roomW && productDimensions.depth <= roomL);\n      \n      setFitResult({\n        fits: spaceFit,\n        tightFit: tightFit,\n        details: {\n          width: { room: roomW, product: productDimensions.width, fits: fitsWidth },\n          depth: { room: roomL, product: productDimensions.depth, fits: fitsDepth },\n          height: { room: roomH, product: productDimensions.height, fits: fitsHeight },\n        },\n        suggestions: !spaceFit ? [\n          tightFit ? 'Szoros illeszkeds - kevs mozgstr marad' : 'Vlassz kisebb mretet',\n          'Mrj jra pontosan',\n          'Nzd meg a hasonl, kisebb termkeket'\n        ] : []\n      });\n      \n      setStep('result');\n    }, 1500);\n  };\n\n  const resetMeasurement = () => {\n    setStep('input');\n    setRoomDimensions({ width: '', length: '', height: '' });\n    setFitResult(null);\n  };\n\n  const isFormValid = roomDimensions.width && roomDimensions.length;\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-secondary-500 to-secondary-700 p-4 sm:p-5 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n              <Ruler className=\"w-5 h-5\" />\n            </div>\n            <div>\n              <h3 className=\"font-bold text-lg\">Befr-e?</h3>\n              <p className=\"text-white/80 text-sm\">Mret ellenrzs</p>\n            </div>\n          </div>\n          {onClose && (\n            <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-lg transition-colors\">\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Product Dimensions Card */}\n      <div className=\"p-4 bg-gray-50 border-b border-gray-200\">\n        <div className=\"flex items-center gap-3 mb-3\">\n          <div className=\"w-14 h-14 bg-white rounded-xl overflow-hidden shrink-0 shadow-sm\">\n            {product?.image ? (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\n                <Home className=\"w-6 h-6 text-gray-300\" />\n              </div>\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n          </div>\n        </div>\n        \n        <div className=\"grid grid-cols-3 gap-2\">\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Szlessg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.width} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Mlysg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.depth} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Magassg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.height} cm</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Step Content */}\n      <div className=\"p-4 sm:p-5\">\n        {/* Input Step */}\n        {step === 'input' && (\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <label className=\"text-sm font-medium text-gray-900\">Add meg a szoba mreteit</label>\n                <button className=\"text-gray-400 hover:text-gray-600\">\n                  <HelpCircle className=\"w-4 h-4\" />\n                </button>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Szlessg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.width}\n                    onChange={(e) => handleDimensionChange('width', e.target.value)}\n                    placeholder=\"pl. 400\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Hosszsg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.length}\n                    onChange={(e) => handleDimensionChange('length', e.target.value)}\n                    placeholder=\"pl. 500\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <label className=\"text-xs text-gray-500 mb-1 block\">Mennyezet magassg (opcionlis)</label>\n                <input\n                  type=\"text\"\n                  inputMode=\"numeric\"\n                  value={roomDimensions.height}\n                  onChange={(e) => handleDimensionChange('height', e.target.value)}\n                  placeholder=\"pl. 270\"\n                  className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                />\n              </div>\n            </div>\n\n            {/* AR Measure Option */}\n            <div className=\"bg-gradient-to-r from-secondary-50 to-primary-50 rounded-xl p-3 border border-secondary-100\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n                  <Camera className=\"w-5 h-5 text-secondary-600\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-gray-900\">AR Mrs</p>\n                  <p className=\"text-xs text-gray-500\">Mrd le kamerval</p>\n                </div>\n                <span className=\"px-2 py-1 bg-secondary-100 text-secondary-700 text-[10px] font-bold rounded-full\">\n                  Hamarosan\n                </span>\n              </div>\n            </div>\n\n            <button\n              onClick={handleCheckFit}\n              disabled={!isFormValid}\n              className={`w-full flex items-center justify-center gap-2 py-3.5 rounded-xl font-bold transition-all ${\n                isFormValid \n                  ? 'bg-gradient-to-r from-secondary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl hover:scale-[1.02]' \n                  : 'bg-gray-100 text-gray-400 cursor-not-allowed'\n              }`}\n            >\n              <Maximize2 className=\"w-5 h-5\" />\n              Ellenrzs\n            </button>\n          </div>\n        )}\n\n        {/* Measuring Step */}\n        {step === 'measuring' && (\n          <div className=\"text-center py-8\">\n            <div className=\"w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Ruler className=\"w-8 h-8 text-secondary-600 animate-pulse\" />\n            </div>\n            <h4 className=\"font-bold text-gray-900 mb-2\">Szmts folyamatban...</h4>\n            <p className=\"text-sm text-gray-500\">Ellenrizzk, hogy befr-e a btor</p>\n          </div>\n        )}\n\n        {/* Result Step */}\n        {step === 'result' && fitResult && (\n          <div className=\"space-y-4\">\n            {/* Result Header */}\n            <div className={`p-4 rounded-xl ${\n              fitResult.fits \n                ? 'bg-green-50 border border-green-200' \n                : fitResult.tightFit \n                  ? 'bg-amber-50 border border-amber-200'\n                  : 'bg-red-50 border border-red-200'\n            }`}>\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                  fitResult.fits \n                    ? 'bg-green-500' \n                    : fitResult.tightFit \n                      ? 'bg-amber-500' \n                      : 'bg-red-500'\n                }`}>\n                  {fitResult.fits ? (\n                    <Check className=\"w-6 h-6 text-white\" />\n                  ) : fitResult.tightFit ? (\n                    <AlertTriangle className=\"w-6 h-6 text-white\" />\n                  ) : (\n                    <X className=\"w-6 h-6 text-white\" />\n                  )}\n                </div>\n                <div>\n                  <h4 className={`font-bold ${\n                    fitResult.fits \n                      ? 'text-green-700' \n                      : fitResult.tightFit \n                        ? 'text-amber-700' \n                        : 'text-red-700'\n                  }`}>\n                    {fitResult.fits \n                      ? 'Tkletesen befr!' \n                      : fitResult.tightFit \n                        ? 'Szoros illeszkeds' \n                        : 'Nem fr be'}\n                  </h4>\n                  <p className=\"text-sm text-gray-600\">\n                    {fitResult.fits \n                      ? 'A btor knyelmesen elfr a szobban' \n                      : fitResult.tightFit \n                        ? 'Fizikailag befr, de kevs hely marad' \n                        : 'Sajnos tl nagy a termk'}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Dimension Details */}\n            <div className=\"space-y-2\">\n              {Object.entries(fitResult.details).map(([key, data]) => (\n                <div key={key} className=\"flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg\">\n                  <span className=\"text-sm text-gray-600 capitalize\">\n                    {key === 'width' ? 'Szlessg' : key === 'depth' ? 'Mlysg' : 'Magassg'}\n                  </span>\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm text-gray-900\">\n                      {data.product} / {data.room} cm\n                    </span>\n                    {data.fits ? (\n                      <Check className=\"w-4 h-4 text-green-500\" />\n                    ) : (\n                      <X className=\"w-4 h-4 text-red-500\" />\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Suggestions */}\n            {fitResult.suggestions.length > 0 && (\n              <div className=\"bg-gray-50 rounded-xl p-3\">\n                <p className=\"text-xs font-medium text-gray-500 mb-2\">Javaslatok:</p>\n                <ul className=\"space-y-1\">\n                  {fitResult.suggestions.map((suggestion, idx) => (\n                    <li key={idx} className=\"flex items-center gap-2 text-sm text-gray-700\">\n                      <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                      {suggestion}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={resetMeasurement}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                jra\n              </button>\n              {fitResult.fits && (\n                <button\n                  onClick={() => onConfirmFit?.()}\n                  className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:shadow-lg transition-all\"\n                >\n                  Kosrba\n                  <ArrowRight className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ARMeasure;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Minus, Plus, Check, Zap, ChevronUp, Star, Truck } from 'lucide-react';\n\n/**\n * StickyAddToCartMobile - Floating add to cart bar for mobile\n * Always visible, smooth UX with quantity selector\n */\nconst StickyAddToCartMobile = ({ \n  product,\n  isVisible = true,\n  onAddToCart,\n  onToggleWishlist,\n  isInWishlist = false,\n  isInCart = false,\n  freeShippingThreshold = 50000\n}) => {\n  const [quantity, setQuantity] = useState(1);\n  const [showQuantity, setShowQuantity] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [justAdded, setJustAdded] = useState(false);\n\n  const price = product?.price || 0;\n  const originalPrice = product?.originalPrice;\n  const discount = originalPrice ? Math.round((1 - price / originalPrice) * 100) : 0;\n  const totalPrice = price * quantity;\n  const freeShippingRemaining = Math.max(0, freeShippingThreshold - totalPrice);\n\n  const handleAddToCart = async () => {\n    setIsAdding(true);\n    await onAddToCart?.(product, quantity);\n    setIsAdding(false);\n    setJustAdded(true);\n    setTimeout(() => {\n      setJustAdded(false);\n      setQuantity(1);\n      setShowQuantity(false);\n    }, 2000);\n  };\n\n  const incrementQuantity = () => setQuantity(q => Math.min(q + 1, 10));\n  const decrementQuantity = () => setQuantity(q => Math.max(q - 1, 1));\n\n  if (!isVisible || !product) return null;\n\n  return (\n    <>\n      {/* Backdrop when quantity selector is open */}\n      {showQuantity && (\n        <div \n          className=\"fixed inset-0 bg-black/20 z-40 sm:hidden\"\n          onClick={() => setShowQuantity(false)}\n        />\n      )}\n\n      {/* Sticky Bar - Mobile Only */}\n      <div className=\"fixed bottom-0 left-0 right-0 z-50 sm:hidden\">\n        {/* Free Shipping Progress - Compact */}\n        {freeShippingRemaining > 0 && freeShippingRemaining < freeShippingThreshold && (\n          <div className=\"bg-gradient-to-r from-emerald-500 to-green-500 px-4 py-1.5\">\n            <div className=\"flex items-center justify-center gap-2 text-white text-xs\">\n              <Truck className=\"w-3.5 h-3.5\" />\n              <span>Mg <strong>{freeShippingRemaining.toLocaleString()} Ft</strong> az ingyenes szlltsig!</span>\n            </div>\n          </div>\n        )}\n\n        {/* Quantity Selector Panel */}\n        {showQuantity && (\n          <div className=\"bg-white border-t border-gray-200 px-4 py-3 animate-slide-up\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium text-gray-700\">Mennyisg</span>\n              <div className=\"flex items-center gap-3 bg-gray-100 rounded-xl p-1\">\n                <button\n                  onClick={decrementQuantity}\n                  disabled={quantity <= 1}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Minus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n                <span className=\"w-8 text-center font-bold text-gray-900 text-lg\">{quantity}</span>\n                <button\n                  onClick={incrementQuantity}\n                  disabled={quantity >= 10}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Plus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-gray-100\">\n              <span className=\"text-sm text-gray-600\">sszesen:</span>\n              <span className=\"text-xl font-black text-gray-900\">{totalPrice.toLocaleString()} Ft</span>\n            </div>\n          </div>\n        )}\n\n        {/* Main Bar */}\n        <div className=\"bg-white border-t border-gray-200 px-3 py-2.5 shadow-[0_-4px_20px_rgba(0,0,0,0.1)]\">\n          <div className=\"flex items-center gap-2\">\n            {/* Wishlist Button */}\n            <button\n              onClick={() => onToggleWishlist?.(product)}\n              className={`w-12 h-12 flex items-center justify-center rounded-xl border-2 transition-all ${\n                isInWishlist \n                  ? 'bg-red-50 border-red-200 text-red-500' \n                  : 'bg-white border-gray-200 text-gray-500'\n              }`}\n            >\n              <Heart className={`w-5 h-5 ${isInWishlist ? 'fill-current' : ''}`} />\n            </button>\n\n            {/* Price & Quantity Toggle */}\n            <button\n              onClick={() => setShowQuantity(!showQuantity)}\n              className=\"flex-1 flex items-center justify-between px-3 py-2 bg-gray-50 rounded-xl\"\n            >\n              <div className=\"text-left\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-black text-gray-900 text-lg\">{price.toLocaleString()} Ft</span>\n                  {discount > 0 && (\n                    <span className=\"px-1.5 py-0.5 bg-red-100 text-red-600 text-[10px] font-bold rounded\">\n                      -{discount}%\n                    </span>\n                  )}\n                </div>\n                {quantity > 1 && (\n                  <span className=\"text-xs text-gray-500\">{quantity} db = {totalPrice.toLocaleString()} Ft</span>\n                )}\n              </div>\n              <ChevronUp className={`w-5 h-5 text-gray-400 transition-transform ${showQuantity ? 'rotate-180' : ''}`} />\n            </button>\n\n            {/* Add to Cart Button */}\n            <button\n              onClick={handleAddToCart}\n              disabled={isAdding || justAdded}\n              className={`h-12 px-5 flex items-center justify-center gap-2 rounded-xl font-bold text-sm transition-all ${\n                justAdded\n                  ? 'bg-green-500 text-white'\n                  : isAdding\n                    ? 'bg-gray-200 text-gray-500'\n                    : 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white shadow-lg active:scale-95'\n              }`}\n            >\n              {justAdded ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span>Hozzadva!</span>\n                </>\n              ) : isAdding ? (\n                <div className=\"w-5 h-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\" />\n              ) : (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span>Kosrba</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.2s ease-out; }\n      `}</style>\n    </>\n  );\n};\n\nexport default StickyAddToCartMobile;\n","import React from 'react';\nimport { Shield, Truck, RefreshCw, CreditCard, Award, Clock, Phone, Lock, CheckCircle, Star, Heart, Headphones } from 'lucide-react';\n\n/**\n * TrustBadges - Trust signals and guarantees\n * Multiple variants for different placements\n */\nconst TrustBadges = ({ \n  variant = 'footer', // 'footer' | 'product' | 'checkout' | 'mini' | 'horizontal'\n  className = ''\n}) => {\n  const badges = [\n    {\n      icon: Truck,\n      title: 'Ingyenes szllts',\n      description: '50.000 Ft felett',\n      color: 'text-emerald-600',\n      bgColor: 'bg-emerald-50',\n    },\n    {\n      icon: RefreshCw,\n      title: '30 napos visszaklds',\n      description: 'Krds nlkl',\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n    },\n    {\n      icon: Shield,\n      title: 'Biztonsgos fizets',\n      description: 'SSL titkosts',\n      color: 'text-purple-600',\n      bgColor: 'bg-purple-50',\n    },\n    {\n      icon: Award,\n      title: '2 v garancia',\n      description: 'Minden termkre',\n      color: 'text-amber-600',\n      bgColor: 'bg-amber-50',\n    },\n    {\n      icon: Headphones,\n      title: 'gyflszolglat',\n      description: 'H-P 8:00-18:00',\n      color: 'text-secondary-600',\n      bgColor: 'bg-secondary-50',\n    },\n    {\n      icon: Heart,\n      title: '50.000+ elgedett vsrl',\n      description: '4.9/5 rtkels',\n      color: 'text-red-500',\n      bgColor: 'bg-red-50',\n    },\n  ];\n\n  // Mini variant - icons only, horizontal\n  if (variant === 'mini') {\n    return (\n      <div className={`flex items-center justify-center gap-4 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-1.5 text-gray-600\"\n            title={badge.title}\n          >\n            <badge.icon className=\"w-4 h-4\" />\n            <span className=\"text-xs font-medium hidden sm:inline\">{badge.title.split(' ')[0]}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Horizontal variant - single row with all info\n  if (variant === 'horizontal') {\n    return (\n      <div className={`bg-gray-50 border-y border-gray-200 py-4 ${className}`}>\n        <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 overflow-x-auto scrollbar-hide\">\n            {badges.slice(0, 4).map((badge, idx) => (\n              <div key={idx} className=\"flex items-center gap-3 shrink-0\">\n                <div className={`w-10 h-10 ${badge.bgColor} rounded-xl flex items-center justify-center`}>\n                  <badge.icon className={`w-5 h-5 ${badge.color}`} />\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900 text-sm whitespace-nowrap\">{badge.title}</p>\n                  <p className=\"text-xs text-gray-500\">{badge.description}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Product variant - compact badges for product page\n  if (variant === 'product') {\n    return (\n      <div className={`grid grid-cols-2 gap-2 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-2 p-2.5 bg-gray-50 rounded-xl\"\n          >\n            <badge.icon className={`w-5 h-5 ${badge.color} shrink-0`} />\n            <div className=\"min-w-0\">\n              <p className=\"text-xs font-medium text-gray-900 truncate\">{badge.title}</p>\n              <p className=\"text-[10px] text-gray-500 truncate\">{badge.description}</p>\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Checkout variant - reassurance badges\n  if (variant === 'checkout') {\n    const checkoutBadges = [\n      { icon: Lock, text: 'Biztonsgos fizets', color: 'text-green-600' },\n      { icon: Shield, text: 'Adatvdelem', color: 'text-blue-600' },\n      { icon: RefreshCw, text: 'Pnzvisszafizets', color: 'text-purple-600' },\n    ];\n\n    return (\n      <div className={`flex items-center justify-center gap-6 py-3 ${className}`}>\n        {checkoutBadges.map((badge, idx) => (\n          <div key={idx} className=\"flex items-center gap-1.5\">\n            <badge.icon className={`w-4 h-4 ${badge.color}`} />\n            <span className=\"text-xs text-gray-600 font-medium\">{badge.text}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Footer variant - full display\n  return (\n    <div className={`bg-gradient-to-b from-gray-50 to-gray-100 py-10 sm:py-12 ${className}`}>\n      <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h3 className=\"text-lg sm:text-xl font-bold text-gray-900 mb-2\">\n            Mirt vlassz minket?\n          </h3>\n          <p className=\"text-sm text-gray-600\">\n            Tbb mint 50.000 elgedett vsrl bzik bennnk\n          </p>\n        </div>\n\n        {/* Badges Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n          {badges.map((badge, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white rounded-2xl p-4 sm:p-5 text-center border border-gray-100 shadow-sm hover:shadow-md transition-shadow\"\n            >\n              <div className={`w-12 h-12 ${badge.bgColor} rounded-xl flex items-center justify-center mx-auto mb-3`}>\n                <badge.icon className={`w-6 h-6 ${badge.color}`} />\n              </div>\n              <h4 className=\"font-bold text-gray-900 text-sm mb-1\">{badge.title}</h4>\n              <p className=\"text-xs text-gray-500\">{badge.description}</p>\n            </div>\n          ))}\n        </div>\n\n        {/* Payment Methods & Security */}\n        <div className=\"mt-8 pt-8 border-t border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            {/* Payment Methods */}\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-xs text-gray-500\">Fizetsi mdok:</span>\n              <div className=\"flex items-center gap-2\">\n                {['Visa', 'Mastercard', 'PayPal', 'Apple Pay'].map((method, idx) => (\n                  <div \n                    key={idx}\n                    className=\"h-8 px-3 bg-white rounded-lg border border-gray-200 flex items-center justify-center\"\n                  >\n                    <span className=\"text-xs font-medium text-gray-700\">{method}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Security Badge */}\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-green-50 rounded-full\">\n              <Lock className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-xs font-medium text-green-700\">256-bit SSL titkosts</span>\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Trust Rating */}\n        <div className=\"mt-6 flex items-center justify-center gap-4\">\n          <div className=\"flex items-center gap-1\">\n            {[1, 2, 3, 4, 5].map(star => (\n              <Star key={star} className=\"w-5 h-5 text-yellow-400 fill-yellow-400\" />\n            ))}\n          </div>\n          <span className=\"text-sm text-gray-600\">\n            <strong className=\"text-gray-900\">4.9/5</strong> rtkels 12.000+ vlemny alapjn\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TrustBadges;\n","import { useEffect, useState, useRef } from 'react';\n\n/**\n * Custom hook for detecting mobile viewport\n */\nexport const useIsMobile = (breakpoint = 768) => {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < breakpoint);\n    };\n\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    \n    return () => window.removeEventListener('resize', checkMobile);\n  }, [breakpoint]);\n\n  return isMobile;\n};\n\n/**\n * Custom hook for managing localStorage\n */\nexport const useLocalStorage = (key, initialValue) => {\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      console.error(error);\n      return initialValue;\n    }\n  });\n\n  const setValue = (value) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return [storedValue, setValue];\n};\n\n/**\n * Custom hook for debouncing values\n */\nexport const useDebounce = (value, delay = 500) => {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n};\n\n/**\n * Custom hook for intersection observer (lazy loading).\n * options is read from ref to avoid re-creating observer on every render.\n */\nexport const useIntersectionObserver = (options = {}) => {\n  const [ref, setRef] = useState(null);\n  const [isIntersecting, setIsIntersecting] = useState(false);\n  const optionsRef = useRef(options);\n  optionsRef.current = options;\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!ref || !(ref instanceof Element)) return;\n\n    const observer = new IntersectionObserver(([entry]) => {\n      setIsIntersecting(entry.isIntersecting);\n    }, optionsRef.current);\n\n    try {\n      observer.observe(ref);\n    } catch (err) {\n      return;\n    }\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref]);\n\n  return [setRef, isIntersecting];\n};\n\n// Re-export from other hook files\nexport { useToast } from './useToast';\nexport { useInfiniteScroll, InfiniteScrollSentinel } from './useInfiniteScroll.jsx';\nexport { \n  useScrollAnimation, \n  useStaggerAnimation, \n  useParallax, \n  useScrollProgress \n} from './useScrollAnimation';\n","/**\n * Marketly AI Btorbolt  kzponti konfigurci\n * Egy helyen: domain, shop id, batch mret, tab hash mapping.\n */\n\nexport const WEBSHOP_DOMAIN = 'https://www.marketly.hu';\nexport const SHOP_ID = '81697';\n\n/** Kezdeti s \"load more\" batch mret a termk listnl */\nexport const DISPLAY_BATCH = 36;\n/** Els lap mrete (API)  gyors first paint, alacsony memria */\nexport const INITIAL_PAGE = 36;\n\n/** Tab rtkek s hash (#shop, #visual-search, #room-planner) */\nexport const TAB_HASH = {\n  shop: 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n\nexport const HASH_TO_TAB = {\n  '': 'shop',\n  'shop': 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n","import React, { useState, useEffect, useLayoutEffect, useRef, useMemo, useCallback, Suspense, lazy } from 'react';\nimport { ShoppingCart, Camera, MessageCircle, X, Send, Plus, Move, Trash2, Home, ZoomIn, ZoomOut, Upload, Settings, Link as LinkIcon, FileText, RefreshCw, AlertCircle, Database, Lock, Search, ChevronLeft, ChevronRight, Filter, Heart, ArrowDownUp, Info, Check, Star, Truck, ShieldCheck, Phone, ArrowRight, Mail, Eye, Sparkles, Lightbulb, Image as ImageIcon, MousePointer2, Menu, Bot, Moon, Sun, Clock, Gift, Zap, TrendingUp, Instagram, Facebook, MapPin, Sofa, Lamp, BedDouble, Armchair, Grid3X3, ExternalLink, Timer, ChevronDown } from 'lucide-react';\n// framer-motion removed due to Vite production build TDZ issues\nimport { fetchUnasProducts, refreshUnasProducts, fetchCategories, fetchCategoryHierarchy, fetchSearchIndex, fetchProductStats, fetchUnasProductById } from './services/unasApi';\nimport { addToUnasCart } from './services/unasCartService';\nimport { smartSearch } from './services/aiSearchService';\nimport { trackProductView as trackProductViewPref, getPersonalizedRecommendations, getSimilarProducts } from './services/userPreferencesService';\nimport { generateText, analyzeImage as analyzeImageAI } from './services/geminiService';\n\n// New UI Components\nimport { ProductCardSkeleton } from './components/ui/Skeleton';\nimport { ToastProvider, useToast } from './components/ui/Toast';\nimport { NoSearchResults, NoFilterResults, ErrorState } from './components/ui/EmptyState';\nimport { SmartBadges } from './components/ui/Badge';\n\n// AI Components\nimport { AIShowcase, AIOnboarding } from './components/ai/AIShowcase';\n// Lazy load heavier AI features for smaller initial bundle\nconst AIChatAssistant = lazy(() => import('./components/ai/AIChatAssistant'));\nconst AIRoomDesigner = lazy(() => import('./components/ai/AIRoomDesigner'));\nconst AIStyleQuiz = lazy(() => import('./components/ai/AIStyleQuiz'));\n\n// Category Components\nimport CategorySwipe from './components/category/CategorySwipe';\nimport CategoryPage from './components/category/CategoryPage';\nimport CollectionPage from './components/collection/CollectionPage';\nimport MainCategoriesSection from './components/category/MainCategoriesSection';\nimport { getCollectionById } from './config/collections';\nimport Navbar from './components/layout/Navbar';\n\n// UX Components\nimport ScrollProgress from './components/ux/ScrollProgress';\nimport BackToTop from './components/ux/BackToTop';\nimport LiveSocialProof from './components/ux/LiveSocialProof';\nimport LiveActivityStrip from './components/ux/LiveActivityStrip';\n\n// Landing Components  \nimport { ModernHero } from './components/landing/ModernHero';\nimport AIModuleUnified from './components/landing/AIModuleUnified';\nimport { InteractiveCTA } from './components/landing/ShowcaseSections';\nconst InspirationSection = lazy(() => import('./components/landing/InspirationSection'));\nconst ProductWorldsSection = lazy(() => import('./components/landing/ProductWorldsSection'));\n// Footer eltvoltva - a f UNAS shopnak mr van sajt lblcce\n\n// Product Components\nimport { EnhancedProductCard } from './components/product/EnhancedProductCard';\nimport { SimilarProducts } from './components/product/SimilarProducts';\nimport { RecentlyViewed, trackProductView } from './components/product/RecentlyViewed';\nimport { ProductComparison, useComparison } from './components/product/ProductComparison';\nimport { AdvancedFilters, AdvancedFiltersPanel, applyFilters } from './components/product/AdvancedFilters';\nimport QuickAddToCart from './components/product/QuickAddToCart';\nimport ProductQuickPeek from './components/product/ProductQuickPeek';\nimport AIPricePredictor from './components/ai/AIPricePredictor';\n\n// Search Components - removed VoiceSearch (framer-motion bundling issue)\n\n// Marketing Components\nimport SmartNewsletterPopup from './components/marketing/SmartNewsletterPopup';\nimport ExitIntentPopup from './components/marketing/ExitIntentPopup';\nconst NewsletterStrip = lazy(() => import('./components/marketing/NewsletterStrip'));\n\n// AR Components\nimport ARProductPreview from './components/ar/ARProductPreview';\n\n// New UX Components\nimport CompleteTheLook from './components/product/CompleteTheLook';\nconst PersonalizedSection = lazy(() => import('./components/home/PersonalizedSection'));\nimport ImageGallery from './components/product/ImageGallery';\nimport StickyAddToCart from './components/product/StickyAddToCart';\nimport PriceAlert from './components/product/PriceAlert';\nimport { FadeInOnScroll, Confetti, CountUp } from './components/ui/Animations';\nimport BottomSheet from './components/mobile/BottomSheet';\n\n// New UX Components - Phase 2\nimport WishlistDrawer from './components/wishlist/WishlistDrawer';\nimport FlashSaleBanner from './components/marketing/FlashSaleBanner';\nimport DeliveryEstimator from './components/product/DeliveryEstimator';\nimport StockUrgency from './components/product/StockUrgency';\nimport ProductShare from './components/product/ProductShare';\nimport QuickActionsBar from './components/product/QuickActionsBar';\nimport ProductTabs from './components/product/ProductTabs';\nimport SmartBundle from './components/product/SmartBundle';\nimport PriceHistory from './components/product/PriceHistory';\nimport OneClickCheckout from './components/checkout/OneClickCheckout';\nimport SmartSearchBar from './components/search/SmartSearchBar';\nconst LoyaltyProgram = lazy(() => import('./components/loyalty/LoyaltyProgram'));\nimport ARMeasure from './components/ar/ARMeasure';\nimport StickyAddToCartMobile from './components/mobile/StickyAddToCartMobile';\nimport TrustBadges from './components/trust/TrustBadges';\n\n// Hooks\nimport { useLocalStorage, useDebounce } from './hooks/index';\n// useInfiniteScroll removed - using manual \"Load More\" button instead\n\n// Utils\nimport { getOptimizedImageProps } from './utils/imageOptimizer';\nimport { PLACEHOLDER_IMAGE, formatPrice, normalizeProduct } from './utils/helpers';\nimport { WEBSHOP_DOMAIN, SHOP_ID, DISPLAY_BATCH, INITIAL_PAGE, TAB_HASH, HASH_TO_TAB } from './config';\n\n/* --- 1. KONFIGURCI & ADATOK (config.js) --- */\n\nconst MODAL_LOADING_FALLBACK = (\n  <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30\">\n    <div className=\"w-10 h-10 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n  </div>\n);\n\n/* --- 2. SEGDFGGVNYEK --- */\n\nconst fixUrl = (url, type = 'main') => {\n    if (!url) return PLACEHOLDER_IMAGE;\n    let cleanUrl = url.trim().replace(/^\"|\"$/g, '');\n    \n    if (cleanUrl.length === 0) return PLACEHOLDER_IMAGE;\n    if (cleanUrl.startsWith('http')) return cleanUrl;\n\n    // UNAS specilis tvonalak kezelse\n    if (!cleanUrl.includes('/')) {\n        const folder = type === 'alt' ? 'shop_altpic' : 'shop_pic';\n        return `${WEBSHOP_DOMAIN}/shop_ordered/${SHOP_ID}/${folder}/${cleanUrl}`;\n    }\n\n    // Relatv tvonalak\n    if (cleanUrl.startsWith('/') || cleanUrl.startsWith('img/')) {\n        const path = cleanUrl.startsWith('/') ? cleanUrl : '/' + cleanUrl;\n        return WEBSHOP_DOMAIN.replace(/\\/$/, '') + path;\n    }\n\n    return cleanUrl;\n};\n\nconst generateAltImages = (mainImageUrl) => {\n    if (mainImageUrl.includes('/shop_pic/')) {\n        const baseUrl = mainImageUrl.replace('/shop_pic/', '/shop_altpic/');\n        const extIndex = baseUrl.lastIndexOf('.');\n        if (extIndex > -1) {\n            const basePath = baseUrl.substring(0, extIndex);\n            const ext = baseUrl.substring(extIndex);\n            return [\n                `${basePath}_altpic_1${ext}`,\n                `${basePath}_altpic_2${ext}`\n            ];\n        }\n    }\n    return [];\n};\n\nconst splitCSVLine = (line, delimiter) => {\n    const values = [];\n    let current = '';\n    let inQuotes = false;\n    for (let i = 0; i < line.length; i++) {\n        const char = line[i];\n        if (char === '\"') { inQuotes = !inQuotes; }\n        else if (char === delimiter && !inQuotes) { values.push(current); current = ''; }\n        else { current += char; }\n    }\n    values.push(current);\n    return values;\n};\n\nconst parseCSV = (csvText) => {\n  const lines = csvText.split(/\\r?\\n/);\n  const products = [];\n  if (lines.length < 2) return [];\n\n  const firstLine = lines[0];\n  const delimiter = (firstLine.match(/;/g) || []).length > (firstLine.match(/,/g) || []).length ? ';' : ',';\n  const headers = splitCSVLine(firstLine, delimiter).map(h => h.trim().replace(/^\"|\"$/g, ''));\n  \n  const findCol = (name) => headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));\n\n  const nameCol = findCol(\"Termk Nv\");\n  const priceCol = findCol(\"Brutt r\"); \n  const catCol = findCol(\"Kategria\");\n  const imgCol = findCol(\"Kp link\"); \n  const urlCol = findCol(\"Termk link\");\n  const descCol = findCol(\"Tulajdonsgok\");\n  const stockCol = findCol(\"Raktrkszlet\");\n  const altImgCol = findCol(\"Kp kapcsolat\"); \n  \n  const paramCols = headers.reduce((acc, header, index) => {\n      if (header.startsWith(\"Paramter:\")) {\n          const cleanName = header.replace(\"Paramter:\", \"\").split(\"|\")[0].trim();\n          acc.push({ index, name: cleanName });\n      }\n      return acc;\n  }, []);\n\n  for (let i = 1; i < lines.length; i++) {\n      if (!lines[i].trim()) continue;\n      const row = splitCSVLine(lines[i], delimiter);\n      const getVal = (colIndex) => colIndex > -1 && row[colIndex] ? row[colIndex].replace(/^\"|\"$/g, '').trim() : \"\";\n\n      const stock = getVal(stockCol);\n      const priceStr = getVal(priceCol);\n      if (!priceStr || !getVal(nameCol)) continue;\n\n      let categoryPath = getVal(catCol) || \"Egyb\";\n      const category = categoryPath.includes('>') ? categoryPath.split('>').pop().trim() : categoryPath;\n\n      const mainImgUrl = fixUrl(getVal(imgCol), 'main');\n      let images = [mainImgUrl];\n      \n      const altImgsRaw = getVal(altImgCol);\n      if (altImgsRaw) {\n          const alts = altImgsRaw.split(/[|]/).map(url => fixUrl(url.trim(), 'alt'));\n          images = [...images, ...alts].slice(0, 4);\n      } else {\n          const generatedAlts = generateAltImages(mainImgUrl);\n          images = [...images, ...generatedAlts];\n      }\n\n      let aiContextParams = [];\n      paramCols.forEach(p => {\n          const val = getVal(p.index);\n          if (val) aiContextParams.push(`${p.name}: ${val}`);\n      });\n      const paramsString = aiContextParams.join(\", \");\n\n      products.push({\n          id: `mkt-prod-${i}`,\n          name: getVal(nameCol),\n          price: parseInt(priceStr.replace(/[^0-9]/g, '')) || 0,\n          category: category,\n          images: images, \n          description: getVal(descCol).replace(/<[^>]*>/g, ' ').substring(0, 500),\n          params: paramsString,\n          link: fixUrl(getVal(urlCol)),\n          inStock: !(stock === '0' || stock.toLowerCase() === 'nincs')\n      });\n  }\n  return products;\n};\n\n// --- 3. KOMPONENSEK ---\n\nconst FileLoaderBar = ({ onFileLoad, onUnasRefresh, isLoadingUnas, lastUpdated, unasError }) => {\n    const fileInputRef = useRef(null);\n    \n    const formatTimestamp = (timestamp) => {\n        if (!timestamp) return '';\n        const date = new Date(timestamp);\n        const now = new Date();\n        const diffMs = now - date;\n        const diffMins = Math.floor(diffMs / 60000);\n        \n        if (diffMins < 1) return 'most';\n        if (diffMins < 60) return `${diffMins} perce`;\n        const diffHours = Math.floor(diffMins / 60);\n        if (diffHours < 24) return `${diffHours} rja`;\n        return date.toLocaleDateString('hu-HU');\n    };\n    \n    return (\n        <div id=\"mkt-butorbolt-loader\" className=\"bg-primary-500 text-white py-3 px-4 shadow-md\">\n            <div className=\"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-3\">\n                <div className=\"flex items-center\">\n                    <Database className=\"w-5 h-5 mr-2\" />\n                    <span className=\"text-sm font-medium\">\n                        {lastUpdated ? `Frisstve: ${formatTimestamp(lastUpdated)}` : 'Adatok betltse...'}\n                    </span>\n                    {unasError && (\n                        <span className=\"ml-2 text-xs bg-red-500 px-2 py-0.5 rounded-full flex items-center\">\n                            <AlertCircle className=\"w-3 h-3 mr-1\" /> Hiba\n                        </span>\n                    )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <input type=\"file\" ref={fileInputRef} accept=\".csv\" className=\"hidden\" onChange={(e) => {\n                        const file = e.target.files[0];\n                        if(file) {\n                            file.text().then(text => onFileLoad(parseCSV(text)));\n                        }\n                    }} />\n                    <button \n                        onClick={() => fileInputRef.current?.click()} \n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm\"\n                    >\n                        <Upload className=\"w-4 h-4 mr-1.5\" /> CSV\n                    </button>\n                    <button \n                        onClick={onUnasRefresh}\n                        disabled={isLoadingUnas}\n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                        <RefreshCw className={`w-4 h-4 mr-1.5 ${isLoadingUnas ? 'animate-spin' : ''}`} /> \n                        {isLoadingUnas ? 'Frissts...' : 'UNAS Frissts'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst Features = () => (\n    <section className=\"py-12 sm:py-14 bg-white border-t border-gray-100\" aria-labelledby=\"features-heading\">\n        <div className=\"w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n            <h2 id=\"features-heading\" className=\"sr-only\">Szolgltatsok</h2>\n            <div className=\"flex flex-col lg:flex-row gap-4\">\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-emerald-50/50 border border-emerald-100 shadow-[0_6px_20px_rgba(16,185,129,0.08)] hover:shadow-[0_12px_28px_rgba(16,185,129,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-emerald-300 via-emerald-400 to-emerald-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Truck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">Ingyenes szllts</h3>\n                            <p className=\"text-sm text-gray-600\">50.000 Ft felett minden rendelsnl</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-blue-50/50 border border-blue-100 shadow-[0_6px_20px_rgba(59,130,246,0.08)] hover:shadow-[0_12px_28px_rgba(59,130,246,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-blue-300 via-blue-400 to-blue-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <ShieldCheck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">2 v garancia</h3>\n                            <p className=\"text-sm text-gray-600\">Minden termkre teljes kren</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-primary-50/45 border border-primary-100 shadow-[0_6px_20px_rgba(255,138,0,0.08)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-primary-300 via-primary-400 to-primary-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-700 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Phone className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">gyflszolglat</h3>\n                            <p className=\"text-sm text-gray-600\">Szakrt segtsg minden nap</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n);\n\nconst ProductModal = ({ product, isOpen, onClose, allProducts = [], onAddToCart }) => {\n    const [aiTip, setAiTip] = useState(null);\n    const [loadingTip, setLoadingTip] = useState(false);\n    \n    useEffect(() => {\n        setAiTip(null);\n    }, [product]);\n\n    if (!isOpen || !product) return null;\n\n    const generateStyleTip = async () => {\n        setLoadingTip(true);\n        try {\n            const prompt = `Lakberendez vagy. Adj 2 rvid, konkrt tippet ehhez:\n            Termk: ${product.name} (${product.category})\n            Paramterek: ${product.params || \"Nincs adat\"}\n            Vlaszolj magyarul, emojikkal.`;\n\n            const result = await generateText(prompt);\n            if (result.success) {\n                setAiTip(result.text);\n            } else {\n                setAiTip(\"Sajnos most nem tudok tippet adni.\");\n            }\n        } catch (error) {\n            setAiTip(\"Sajnos most nem tudok tippet adni.\");\n        } finally {\n            setLoadingTip(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in\" onClick={onClose}>\n            <div id=\"mkt-product-modal-root\" className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col relative\" onClick={e => e.stopPropagation()}>\n                <button onClick={onClose} className=\"absolute top-4 right-4 z-10 bg-white/80 p-2 rounded-full hover:bg-gray-100 transition-colors\"><X className=\"w-6 h-6 text-gray-600\" /></button>\n                \n                <div className=\"flex flex-col md:flex-row overflow-y-auto\">\n                  {/* Left: Image Gallery */}\n                  <div className=\"md:w-1/2 bg-gray-50 p-6\">\n                      <ImageGallery \n                        images={product.images || []} \n                        productName={product.name}\n                      />\n                  </div>\n\n                  {/* Right: Product Info */}\n                  <div className=\"md:w-1/2 p-6 md:p-8 overflow-y-auto\">\n                      <div className=\"flex items-center gap-2 mb-3\">\n                          <span className=\"bg-primary-50 text-primary-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide\">{product.category}</span>\n                          {product.inStock ?? product.in_stock ? \n                              <span className=\"text-green-600 text-xs font-bold flex items-center bg-green-50 px-2 py-1 rounded-full\"><Check className=\"w-3 h-3 mr-1\" /> Raktron</span> : \n                              <span className=\"text-red-500 text-xs font-bold bg-red-50 px-2 py-1 rounded-full\">Kszlethiny</span>\n                          }\n                      </div>\n                      <h2 className=\"text-2xl md:text-3xl font-extrabold text-gray-900 mb-2 leading-tight\">{product.name}</h2>\n                      <p className=\"text-2xl md:text-3xl font-bold text-primary-500 mb-4\">{formatPrice(product.price)}</p>\n                      \n                      {/* Price Alert & Share */}\n                      <div className=\"flex items-center gap-3 mb-4\">\n                        <PriceAlert product={product} />\n                        <ProductShare product={product} />\n                      </div>\n                      \n                      {/* Stock Urgency */}\n                      <div className=\"mb-4\">\n                        <StockUrgency product={product} variant=\"compact\" />\n                      </div>\n                      \n                      {/* Delivery Estimator */}\n                      <div className=\"mb-6\">\n                        <DeliveryEstimator product={product} variant=\"compact\" />\n                      </div>\n                      \n                      <div className=\"mb-6\">\n                          {!aiTip && !loadingTip && (\n                              <button onClick={generateStyleTip} className=\"w-full bg-gradient-to-r from-secondary-50 to-primary-50 hover:from-secondary-100 hover:to-primary-100 text-primary-600 p-4 rounded-xl border border-primary-100 flex items-center justify-center transition-all group\">\n                                  <Sparkles className=\"w-5 h-5 mr-2 group-hover:scale-110 transition-transform\" />\n                                  Krj AI Lakberendez tippet!\n                              </button>\n                          )}\n                          {loadingTip && (\n                              <div className=\"bg-gray-50 p-4 rounded-xl border border-gray-100 flex items-center justify-center text-gray-500 animate-pulse\">\n                                  <RefreshCw className=\"w-5 h-5 mr-2 animate-spin\" /> A tervez gondolkodik...\n                              </div>\n                          )}\n                          {aiTip && (\n                              <div className=\"bg-gradient-to-br from-primary-50 to-white p-5 rounded-xl border border-primary-100 shadow-sm animate-fade-in\">\n                                  <div className=\"flex items-center mb-2 text-primary-600 font-bold\"><Lightbulb className=\"w-5 h-5 mr-2\" /> AI Tipp:</div>\n                                  <div className=\"text-sm text-gray-700 leading-relaxed whitespace-pre-line\">{aiTip}</div>\n                              </div>\n                          )}\n                      </div>\n\n                      <div className=\"prose prose-sm text-gray-600 mb-6 border-t border-gray-100 pt-4\">\n                          <h4 className=\"font-bold text-gray-900 mb-2\">Lers</h4>\n                          <p className=\"text-sm\">{product.description || \"Nincs lers.\"}</p>\n                          {product.params && (\n                              <div className=\"mt-4 grid grid-cols-2 gap-2 text-xs\">\n                                  {product.params.split(',').slice(0, 6).map((param, i) => (\n                                      <div key={i} className=\"bg-gray-50 p-2 rounded text-gray-700\">{param.trim()}</div>\n                                  ))}\n                              </div>\n                          )}\n                      </div>\n\n                      {/* Complete The Look - AI Bundle */}\n                      {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <CompleteTheLook\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddToCart={onAddToCart}\n                          />\n                        </div>\n                      )}\n\n                      {/* Smart Bundle - temporarily disabled for debugging */}\n                      {/* {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <SmartBundle\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddBundle={(items, price) => {\n                              items.forEach(item => onAddToCart(item, 1));\n                            }}\n                          />\n                        </div>\n                      )} */}\n\n                      {/* Price History */}\n                      <div className=\"mb-6\">\n                        <PriceHistory\n                          currentPrice={product.price}\n                          productId={product.id}\n                          onSetAlert={(id, price) => console.log('Alert set for', id, price)}\n                        />\n                      </div>\n\n                      {/* Product Tabs - Details, Specs, Reviews */}\n                      <div className=\"mb-6\">\n                        <ProductTabs product={product} />\n                      </div>\n\n                      <div className=\"sticky bottom-0 bg-white pt-4 pb-4 border-t border-gray-200 mt-auto shadow-[0_-4px_12px_rgba(0,0,0,0.06)]\">\n                          <div className=\"flex flex-col xs:flex-row gap-3\">\n                              <button\n                                  type=\"button\"\n                                  onClick={() => onAddToCart(product, 1)}\n                                  disabled={!(product.inStock ?? product.in_stock)}\n                                  className=\"min-h-[44px] flex-1 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-xl font-bold text-base text-center transition-all shadow-lg flex items-center justify-center gap-2\"\n                              >\n                                  <ShoppingCart className=\"w-5 h-5\" />\n                                  Kosrba\n                              </button>\n                              <a href={product.link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"min-h-[44px] flex-1 bg-gray-900 text-white py-3 px-4 rounded-xl font-bold text-base text-center hover:bg-gray-800 transition-all shadow-lg flex items-center justify-center gap-2 border-2 border-gray-900 hover:border-gray-700\">\n                                  Megveszem a webshopban <ArrowRight className=\"w-5 h-5\" />\n                              </a>\n                          </div>\n                      </div>\n                  </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst VisualSearch = ({ products }) => {\n  const [selectedImage, setSelectedImage] = useState(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [searchResults, setSearchResults] = useState([]);\n  const [analysisText, setAnalysisText] = useState(\"\");\n\n  const handleImageUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => { setSelectedImage(reader.result); analyzeImage(reader.result); };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const analyzeImage = async (base64Image) => {\n    setIsAnalyzing(true); setSearchResults([]); setAnalysisText(\"Elemzs...\");\n    try {\n      const base64Data = base64Image.split(',')[1];\n      const prompt = \"Elemezd a btort. JSON: { \\\"style\\\": \\\"...\\\", \\\"category\\\": \\\"...\\\", \\\"color\\\": \\\"...\\\" } Magyarul.\";\n      \n      const result = await analyzeImageAI(base64Data, \"image/jpeg\", prompt);\n      \n      if (result.success && result.text) {\n        const analysis = JSON.parse(result.text);\n        if (analysis) {\n          setAnalysisText(`Felismerve: ${analysis.style} stlus ${analysis.color} ${analysis.category}.`);\n          const relevant = products.filter(p => p.category.toLowerCase().includes(analysis.category.toLowerCase()) || p.name.toLowerCase().includes(analysis.category.toLowerCase())).slice(0, 4);\n          setSearchResults(relevant);\n        }\n      } else {\n        setAnalysisText(\"Hiba az elemzsben.\");\n      }\n    } catch (error) { setAnalysisText(\"Hiba az elemzsben.\"); } \n    finally { setIsAnalyzing(false); }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto py-8 px-4\">\n      <div className=\"text-center mb-8\"><h2 className=\"text-3xl font-bold text-gray-900\">AI Vizulis Keres</h2></div>\n      <div className=\"bg-white rounded-xl shadow-lg p-8 mb-8 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-center\">\n        {!selectedImage ? (\n          <>\n            <div className=\"bg-primary-50 p-4 rounded-full mb-4\"><Camera className=\"w-8 h-8 text-primary-500\" /></div>\n            <label className=\"cursor-pointer bg-primary-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-600 transition-colors\">Fnykp feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleImageUpload} /></label>\n          </>\n        ) : (\n          <div className=\"relative w-full max-w-md mx-auto\">\n            <img src={selectedImage} alt=\"Uploaded\" className=\"rounded-lg shadow-md max-h-64 mx-auto\" />\n            <button onClick={() => { setSelectedImage(null); setSearchResults([]); }} className=\"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-md hover:bg-red-600\"><X className=\"w-4 h-4\" /></button>\n            {isAnalyzing && <div className=\"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center rounded-lg\"><span className=\"text-primary-700 font-bold animate-pulse\">Elemzs...</span></div>}\n          </div>\n        )}\n      </div>\n      {!isAnalyzing && selectedImage && searchResults.length === 0 && (\n        <p className=\"text-center text-gray-600 py-6\">Nincs tallat a feltlttt kp alapjn. Prblj msik fott vagy bngssz a kategrikban.</p>\n      )}\n      {searchResults.length > 0 && (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6\">{searchResults.map(product => (<div key={product.id} className=\"border border-gray-200 p-4 rounded-xl hover:shadow-lg transition-shadow\"><img src={product.images?.[0]} alt={product.name} className=\"h-32 mx-auto object-contain\" /><p className=\"font-bold mt-2 truncate\">{product.name}</p><p>{formatPrice(product.price)}</p></div>))}</div>\n      )}\n    </div>\n  );\n};\n\nconst RoomPlanner = ({ products }) => {\n  const [background, setBackground] = useState(null);\n  const [placedItems, setPlacedItems] = useState([]);\n  const [selectedItemId, setSelectedItemId] = useState(null);\n\n  const handleBackgroundUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) { const reader = new FileReader(); reader.onloadend = () => setBackground(reader.result); reader.readAsDataURL(file); }\n  };\n\n  const addItem = (product) => {\n    if (!background) { alert(\"Tlts fel szobt!\"); return; }\n    setPlacedItems([...placedItems, { id: Date.now(), image: product.images[0], x: 50, y: 50, scale: 1 }]);\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto py-8 px-4 flex flex-col lg:flex-row gap-6 h-[80vh]\">\n      <div className=\"lg:w-1/4 bg-white rounded-2xl shadow-lg border border-gray-200 flex flex-col overflow-hidden\">\n          <div className=\"p-4 border-b bg-gray-50\"><h3 className=\"font-bold\">Btorok</h3></div>\n          <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\n              {products.slice(0, 50).map(p => (\n                  <div key={p.id} onClick={() => addItem(p)} className=\"flex items-center gap-3 p-2 hover:bg-primary-50 rounded cursor-pointer\"><img src={p.images[0]} className=\"w-12 h-12 object-contain\" /><p className=\"text-xs font-bold truncate w-24\">{p.name}</p></div>\n              ))}\n          </div>\n      </div>\n      <div className=\"lg:w-3/4 bg-gray-100 rounded-2xl border-2 border-dashed relative overflow-hidden flex items-center justify-center\">\n          {!background ? (\n              <label className=\"bg-primary-500 text-white px-6 py-3 rounded-xl cursor-pointer\">Szobafot feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleBackgroundUpload} /></label>\n          ) : (\n              <div className=\"relative w-full h-full\">\n                  <img src={background} className=\"w-full h-full object-cover\" />\n                  {placedItems.map((item) => (\n                      <div key={item.id} className=\"absolute w-32 cursor-move\" style={{ left: `${item.x}%`, top: `${item.y}%`, transform: `translate(-50%, -50%) scale(${item.scale})` }} onClick={() => setSelectedItemId(item.id)}>\n                          <img src={item.image} className=\"w-full\" />\n                      </div>\n                  ))}\n              </div>\n          )}\n      </div>\n    </div>\n  );\n};\n\nconst App = () => {\n  const [activeTab, setActiveTabState] = useState(() => {\n    const hash = (typeof window !== 'undefined' && window.location.hash.slice(1)) || '';\n    return HASH_TO_TAB[hash] || 'shop';\n  });\n  const setActiveTab = useCallback((tab) => {\n    setActiveTabState(tab);\n    const hash = TAB_HASH[tab] ?? tab;\n    if (typeof window !== 'undefined') {\n      const newHash = hash ? `#${hash}` : '';\n      if (window.location.hash !== newHash) {\n        window.history.replaceState(null, '', window.location.pathname + window.location.search + newHash);\n      }\n    }\n  }, []);\n  const [products, setProducts] = useState([]);\n  const [totalProductsCount, setTotalProductsCount] = useState(0);\n  const [hasMoreProducts, setHasMoreProducts] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const filteredLengthRef = useRef(0);\n  const hasMoreProductsRef = useRef(hasMoreProducts);\n  const isLoadingMoreRef = useRef(isLoadingMore);\n  hasMoreProductsRef.current = hasMoreProducts;\n  isLoadingMoreRef.current = isLoadingMore;\n  const [wishlist, setWishlist] = useLocalStorage('mkt_wishlist', []);\n  const [wishlistItems, setWishlistItems] = useState([]);\n  const [sectionRotateTick, setSectionRotateTick] = useState(0);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const searchQueryRef = useRef(searchQuery);\n  searchQueryRef.current = searchQuery;\n  const SERVER_SEARCH_ONLY = true;\n  const MAX_LOCAL_INDEX = SERVER_SEARCH_ONLY ? 0 : 50000;\n  const searchIndexRef = useRef([]);\n  const [searchIndexReady, setSearchIndexReady] = useState(false);\n  const [searchIndexVersion, setSearchIndexVersion] = useState(0);\n  const [searchResults, setSearchResults] = useState([]);\n  const [searchTotalMatches, setSearchTotalMatches] = useState(0);\n  const [categoryFilter, setCategoryFilter] = useState(\"sszes\");\n  const [sortOption, setSortOption] = useState(\"default\");\n  const [isDemoMode, setIsDemoMode] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [isChatOpen, setIsChatOpen] = useState(false);\n  const [showAIOnboarding, setShowAIOnboarding] = useState(false);\n  const [onboardingFeature, setOnboardingFeature] = useState('chat');\n  const [advancedFilters, setAdvancedFilters] = useState({});\n  const [categoryHierarchy, setCategoryHierarchy] = useState({ mainCategories: [] });\n  const [categoryStats, setCategoryStats] = useState(null);\n  const [selectedCollection, setSelectedCollection] = useState(null);\n  const mainCategorySet = useMemo(() => {\n    return new Set((categoryHierarchy?.mainCategories || []).map((c) => c.name));\n  }, [categoryHierarchy]);\n  const activeHierarchyCount = useMemo(() => {\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === categoryFilter);\n    return typeof main?.productCount === 'number' ? main.productCount : null;\n  }, [categoryHierarchy, categoryFilter]);\n  const getCategoryMainList = useCallback((category) => {\n    if (!category) return [];\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === category);\n    if (!main) return [];\n    return Array.isArray(main.rawSegments) && main.rawSegments.length > 0 ? main.rawSegments : [category];\n  }, [categoryHierarchy]);\n  \n  // AI Feature states\n  const [showStyleQuiz, setShowStyleQuiz] = useState(false);\n  const [showRoomDesigner, setShowRoomDesigner] = useState(false);\n  const [aiRecommendedProducts, setAiRecommendedProducts] = useState([]);\n  const [aiRecommendationLabel, setAiRecommendationLabel] = useState('');\n  const [showDeferredAI, setShowDeferredAI] = useState(false);\n  \n  // Quick Peek & AR states\n  const [quickPeekProduct, setQuickPeekProduct] = useState(null);\n  const [showARPreview, setShowARPreview] = useState(false);\n  const [arProduct, setArProduct] = useState(null);\n  \n  // AR Measure & One-Click Checkout states\n  const [showARMeasure, setShowARMeasure] = useState(false);\n  const [arMeasureProduct, setArMeasureProduct] = useState(null);\n  const [showOneClickCheckout, setShowOneClickCheckout] = useState(false);\n  const [oneClickProduct, setOneClickProduct] = useState(null);\n  \n  // New UX states\n  const [showConfetti, setShowConfetti] = useState(false);\n  const [showFilterSheet, setShowFilterSheet] = useState(false);\n  const [showExitIntent, setShowExitIntent] = useState(true); // Exit intent enabled\n  \n  // Phase 2 UX states\n  const [showWishlistDrawer, setShowWishlistDrawer] = useState(false);\n  const [featuredPool, setFeaturedPool] = useState([]);\n  const featuredPoolKeyRef = useRef('');\n  \n  // Flash sale end time (set to 12 hours from now for demo)\n  const flashSaleEndTime = useMemo(() => {\n    const end = new Date();\n    end.setHours(end.getHours() + 12);\n    return end;\n  }, []);\n  \n  // UNAS API states\n  const [isLoadingUnas, setIsLoadingUnas] = useState(true);\n  const [unasError, setUnasError] = useState(null);\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [dataSource, setDataSource] = useState('demo');\n  \n  // New hooks\n  const toast = useToast();\n  const comparison = useComparison();\n  \n  // Track product views - both for RecentlyViewed component and user preferences\n  const handleProductView = (product) => {\n    trackProductView(product); // RecentlyViewed component\n    trackProductViewPref(product); // User preferences service (for AI personalization)\n    setSelectedProduct(product);\n  };\n  \n  // Handle AI recommended products - scroll to products and show them\n  // Accepts either: (product, allRecommended) OR (recommendedProducts, label)\n  const handleShowAIProducts = useCallback((firstArg, secondArg) => {\n    let recommendedProducts = [];\n    let label = 'AI ajnlsok';\n    \n    // Check if first argument is a single product or an array\n    if (firstArg && !Array.isArray(firstArg) && firstArg.id) {\n      // Single product clicked - show it first, then add similar products\n      const clickedProduct = firstArg;\n      const allRecommended = secondArg || [];\n      \n      // Get similar products from the full products list\n      const similarProducts = products\n        .filter(p => {\n          if (p.id === clickedProduct.id) return false;\n          const clickedCat = (clickedProduct.category || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          // Same main category or similar price range\n          const sameCategory = clickedCat && pCat && pCat.includes(clickedCat.split(' > ')[0]);\n          const price = p.salePrice || p.price || 0;\n          const clickedPrice = clickedProduct.salePrice || clickedProduct.price || 0;\n          const similarPrice = clickedPrice > 0 && Math.abs(price - clickedPrice) / clickedPrice < 0.5;\n          return sameCategory || similarPrice;\n        })\n        .slice(0, 12);\n      \n      // Combine: clicked product + other recommendations + similar\n      recommendedProducts = [\n        clickedProduct,\n        ...allRecommended.filter(p => p.id !== clickedProduct.id),\n        ...similarProducts.filter(p => !allRecommended.some(r => r.id === p.id))\n      ].slice(0, 20);\n      \n      label = `\"${clickedProduct.name.slice(0, 30)}...\" s hasonl termkek`;\n    } else if (Array.isArray(firstArg)) {\n      // Array of products provided\n      recommendedProducts = firstArg;\n      label = typeof secondArg === 'string' ? secondArg : 'AI ajnlsok';\n    }\n    \n    if (recommendedProducts.length === 0) return;\n    \n    setAiRecommendedProducts(recommendedProducts);\n    setAiRecommendationLabel(label);\n    setCategoryFilter('sszes'); // Reset category\n    setSearchQuery(''); // Reset search\n    \n    setActiveTab('shop');\n    requestAnimationFrame(() => requestAnimationFrame(() => scrollToProductsSectionRef.current?.()));\n  }, [products]);\n  \n  // Clear AI recommendations\n  const clearAIRecommendations = useCallback(() => {\n    setAiRecommendedProducts([]);\n    setAiRecommendationLabel('');\n  }, []);\n\n  const toggleWishlist = (id) => {\n    const isAdding = !wishlist.includes(id);\n    setWishlist(prev => \n      isAdding \n        ? [...prev, id] \n        : prev.filter(item => item !== id)\n    );\n    \n    if (isAdding) {\n      toast.wishlist('Hozzadva a kvnsglisthoz!');\n    } else {\n      toast.info('Eltvoltva a kvnsglistrl');\n    }\n  };\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!showWishlistDrawer) return () => { cancelled = true; };\n    if (!wishlist || wishlist.length === 0) {\n      setWishlistItems([]);\n      return () => { cancelled = true; };\n    }\n    Promise.all(wishlist.map((id) => fetchUnasProductById(id)))\n      .then((items) => {\n        if (!cancelled) setWishlistItems(items.filter(Boolean));\n      });\n    return () => { cancelled = true; };\n  }, [wishlist, showWishlistDrawer]);\n  \n  const handleToggleComparison = (product) => {\n    const result = comparison.toggleComparison(product);\n    if (result.success) {\n      if (result.action === 'added') {\n        toast.success('Hozzadva az sszehasonltshoz!');\n      } else {\n        toast.info('Eltvoltva az sszehasonltsbl');\n      }\n    } else {\n      toast.error(result.message);\n    }\n  };\n  \n  // Handle add to cart with confetti celebration\n  const handleAddToCart = useCallback((product, quantity = 1) => {\n    try {\n      const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n      // UNAS kosrhoz ads (ha elrhet  widget UNAS oldalon fut)\n      const addedToUnas = addToUnasCart(product, qty);\n\n      if (addedToUnas) {\n        setShowConfetti(true);\n        toast.success(`${product.name} hozzadva a kosrhoz!`);\n        return;\n      }\n\n      // Fallback: cart_add nem mkdik  termk oldalra navigls (ott egy kattints = kosrba)\n      const productUrl = (product.link || product.url || '').trim();\n      const fullUrl = !productUrl || productUrl === '#' ? '' : productUrl.startsWith('http') ? productUrl : `${WEBSHOP_DOMAIN}${productUrl.startsWith('/') ? '' : '/'}${productUrl}`;\n      if (fullUrl && fullUrl !== WEBSHOP_DOMAIN && fullUrl !== WEBSHOP_DOMAIN + '/') {\n        toast.info('A termk oldalra naviglunk  ott egy kattintssal hozzadhatod a kosrhoz.');\n        window.location.href = fullUrl;\n      } else {\n        toast.warning('A termk link nem elrhet. Prbld ksbb.');\n      }\n    } catch (err) {\n      console.warn('[handleAddToCart]', err);\n      toast.error(err?.message || 'A kosrhoz ads sikertelen. Prbld a termk oldaln.');\n    }\n  }, [toast]);\n  \n  // Server-side search state\n  const [serverSearchQuery, setServerSearchQuery] = useState('');\n  const [serverCategory, setServerCategory] = useState('');\n  const searchTimeoutRef = useRef(null);\n\n  // API-first: kis lap, gyors first paint; soha nem tltnk 200k-t\n  const loadUnasData = useCallback(async (options = {}) => {\n    const { silent = false, search = '', category = '', categoryMain, categories, styleKeywords, append = false, limit = INITIAL_PAGE, offset = 0 } = options;\n    \n    if (!silent && !append) {\n      setIsLoadingUnas(true);\n      setUnasError(null);\n    }\n    if (append) setIsLoadingMore(true);\n    \n    try {\n      const categoryMainList = Array.isArray(categoryMain)\n        ? categoryMain.filter(Boolean)\n        : (typeof categoryMain === 'string' && categoryMain.trim()\n          ? [categoryMain.trim()]\n          : getCategoryMainList(category));\n      const categoriesList = Array.isArray(categories) ? categories.filter(Boolean) : [];\n      const params = {\n        limit,\n        offset,\n        slim: false,\n        ...(search && search.trim() && { search: search.trim() }),\n        ...(categoriesList.length > 0 && { categories: categoriesList }),\n        ...(categoriesList.length === 0 && categoryMainList.length > 0 && { categoryMain: categoryMainList }),\n        ...(categoriesList.length === 0 && categoryMainList.length === 0 && category && category !== 'sszes' && { category }),\n        ...(Array.isArray(styleKeywords) && styleKeywords.length > 0 && { styleKeywords })\n      };\n      const data = await fetchUnasProducts(params);\n      const newProducts = (data.products || []).map(normalizeProduct);\n      const totalCount = data.total ?? 0;\n      \n      if (append) {\n        setProducts(prev => [...prev, ...newProducts]);\n        setHasMoreProducts(newProducts.length > 0 && (data.count + offset) < totalCount);\n      } else {\n        setProducts(newProducts);\n        setTotalProductsCount(totalCount);\n        setHasMoreProducts(newProducts.length > 0 && newProducts.length < totalCount);\n      }\n      if (!append && search && String(search).trim()) {\n        requestAnimationFrame(() => requestAnimationFrame(() => {\n          scrollToProductsSectionRef.current?.()\n        }));\n      }\n      if (!append) setTotalProductsCount(totalCount);\n      setLastUpdated(data.lastSync || data.lastUpdated);\n      setDataSource('unas');\n      setUnasError(null);\n    } catch (err) {\n      if (!append) setUnasError('Termkek betltse sikertelen');\n    } finally {\n      if (!silent && !append) setIsLoadingUnas(false);\n      if (append) setIsLoadingMore(false);\n    }\n  }, [getCategoryMainList]);\n\n  // Server-side search (marketplace-style). scrollFromEffect: true = grgets az effect-ben (pl. header keress), false = hv intzi (pl. hero)\n  const requestScrollToProductsRef = useRef(false);\n  const handleServerSearch = useCallback((query, opts = {}) => {\n    hasUserSearchedRef.current = true;\n    if (opts.scrollFromEffect !== false) requestScrollToProductsRef.current = true;\n    setSearchQuery(query);\n  }, []);\n  const hasUserSearchedRef = useRef(false);\n  useLayoutEffect(() => {\n    if (typeof window !== 'undefined') window.history.scrollRestoration = 'manual';\n  }, []);\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      setSectionRotateTick((t) => t + 1);\n    }, 180000);\n    return () => clearInterval(id);\n  }, []);\n\n\n  // Scroll container: ne hasznljunk olyan containert, ami a mi appunk belsejben van (#mkt-butorbolt-app).\n  // UNAS embed: gyakran a page_content article szlje a scroll container; standalone = window.\n  const getScrollParent = useCallback((element) => {\n    const appRoot = document.getElementById('mkt-butorbolt-app');\n    const isScrollable = (el) => {\n      if (!el || el === document.body) return false;\n      const style = getComputedStyle(el);\n      const oy = style.overflowY;\n      return (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && el.scrollHeight > el.clientHeight;\n    };\n    let parent = element.parentElement;\n    while (parent && parent !== document.body) {\n      if (isScrollable(parent)) {\n        const insideApp = appRoot && parent.closest('#mkt-butorbolt-app');\n        const wrapsApp = appRoot && parent.contains(appRoot);\n        if (wrapsApp || !insideApp) return parent;\n      }\n      parent = parent.parentElement;\n    }\n    return null;\n  }, []);\n\n  const lastScrollToProductsRef = useRef(0);\n  const scrollToProductsSection = useCallback((retryCount = 0) => {\n    const el = document.getElementById('products-section');\n    const main = document.getElementById('mkt-butorbolt-main');\n    const target = el || main;\n    if (!target) {\n      if (retryCount < 6) setTimeout(() => scrollToProductsSection(retryCount + 1), 50);\n      return;\n    }\n    const now = performance.now();\n    if (now - lastScrollToProductsRef.current < 200) return;\n    const rect = target.getBoundingClientRect();\n    const inView = rect.top >= 0 && rect.top <= 120;\n    if (inView) return;\n    lastScrollToProductsRef.current = now;\n\n    const run = () => {\n      const scrollParent = getScrollParent(target);\n      if (scrollParent && scrollParent !== document.documentElement) {\n        const elRect = target.getBoundingClientRect();\n        const parentRect = scrollParent.getBoundingClientRect();\n        const offset = 88;\n        const targetScrollTop = scrollParent.scrollTop + (elRect.top - parentRect.top) - offset;\n        scrollParent.scrollTo({ top: Math.max(0, targetScrollTop), behavior: 'smooth' });\n      } else {\n        target.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });\n      }\n    };\n    requestAnimationFrame(run);\n  }, [getScrollParent]);\n\n  const scrollToProductsSectionRef = useRef(scrollToProductsSection);\n  scrollToProductsSectionRef.current = scrollToProductsSection;\n\n  const handleCategoryChange = useCallback((category) => {\n    setSelectedCollection(null);\n    setCategoryFilter(category);\n    setCategoryStats(null);\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    setAdvancedFilters({});\n    setSortOption('default');\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    if (category && category !== 'sszes') setActiveTab('shop');\n    requestAnimationFrame(() => requestAnimationFrame(scrollToProductsSection));\n  }, [scrollToProductsSection, clearAIRecommendations]);\n\n  const handleCollectionSelect = useCallback((collection) => {\n    setSelectedCollection(collection);\n    setCategoryFilter('sszes');\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    setActiveTab('shop');\n  }, []);\n\n  const handleCollectionBack = useCallback(() => {\n    setSelectedCollection(null);\n    handleCategoryChange('sszes');\n  }, [handleCategoryChange]);\n\n  const loadUnasDataRef = useRef(loadUnasData);\n  loadUnasDataRef.current = loadUnasData;\n\n  const canUseLocalSearch = useMemo(() => {\n    if (SERVER_SEARCH_ONLY) return false;\n    return searchIndexReady && searchIndexRef.current.length > 0 && searchIndexRef.current.length <= MAX_LOCAL_INDEX;\n  }, [SERVER_SEARCH_ONLY, searchIndexReady, searchIndexVersion]);\n\n  const debouncedSearch = useDebounce(searchQuery, 400);\n\n  // Kollekci termkbetlts  valdi termkek: categoryMain ( f kategria) vagy categories ( leaf kategrik )\n  useEffect(() => {\n    if (!selectedCollection) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n        categoryMainList = undefined;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n        categoriesList = undefined;\n      } else {\n        categoriesList = cats;\n      }\n    } else {\n      categoryMainList = undefined;\n      categoriesList = undefined;\n    }\n    const limit = selectedCollection.isSale || selectedCollection.isNew ? 300 : INITIAL_PAGE;\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined,\n      limit,\n      offset: 0\n    });\n    requestAnimationFrame(() => requestAnimationFrame(() => scrollToProductsSectionRef.current?.()));\n  }, [selectedCollection, categoryHierarchy]);\n\n  useEffect(() => {\n    // Kollekci nzetben ne futtassuk a norml kategria/keress betltst\n    if (selectedCollection) return;\n    // Ha a keresindex ksz, a keress loklisan fut  ne rjuk fell a listt API keresssel\n    const useApiSearch = !canUseLocalSearch || !debouncedSearch.trim();\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    loadUnasDataRef.current({\n      search: useApiSearch ? (debouncedSearch.trim() || undefined) : undefined,\n      category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n      categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined,\n      limit: INITIAL_PAGE,\n      offset: 0\n    });\n    // Csak akkor grgetnk a termkekre, ha a felhasznl most indtott keresst/kategriavltst (ne listagrgetskor)\n    if (requestScrollToProductsRef.current && debouncedSearch.trim()) {\n      requestScrollToProductsRef.current = false;\n      requestAnimationFrame(() => requestAnimationFrame(() => scrollToProductsSectionRef.current?.()));\n    }\n  }, [categoryFilter, debouncedSearch, canUseLocalSearch, getCategoryMainList, selectedCollection]);\n\n  useEffect(() => {\n    const onHashChange = () => {\n      const hash = window.location.hash.slice(1);\n      const tab = HASH_TO_TAB[hash] || 'shop';\n      setActiveTabState(tab);\n    };\n    window.addEventListener('hashchange', onHashChange);\n    return () => window.removeEventListener('hashchange', onHashChange);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    fetchCategoryHierarchy().then((data) => {\n      if (!cancelled && data?.mainCategories) setCategoryHierarchy(data);\n    });\n    return () => { cancelled = true; };\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!categoryFilter || categoryFilter === 'sszes') {\n      setCategoryStats(null);\n      return () => { cancelled = true; };\n    }\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    const category = categoryMainList.length === 0 ? categoryFilter : '';\n    fetchProductStats({ category, categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined }).then((stats) => {\n      if (!cancelled) setCategoryStats(stats);\n    });\n    return () => { cancelled = true; };\n  }, [categoryFilter, getCategoryMainList]);\n\n  // Defer heavy AI widgets to keep TTI under 3s\n  useEffect(() => {\n    const t = setTimeout(() => setShowDeferredAI(true), 1500);\n    return () => clearTimeout(t);\n  }, []);\n\n  // Keresindex httrben (800ms ksleltets, ne blokkolja az els paint-et); 5 percenknt frissts = kszlet napraksz\n  useEffect(() => {\n    if (SERVER_SEARCH_ONLY) return;\n    let cancelled = false;\n    const load = () => {\n      fetchSearchIndex().then((data) => {\n        if (!cancelled && data && Array.isArray(data.products)) {\n          searchIndexRef.current = data.products;\n          setSearchIndexReady(true);\n          setSearchIndexVersion((v) => v + 1);\n          // #region agent log\n          // #endregion\n          if (data.lastSync) setLastUpdated(data.lastSync);\n          const q = searchQueryRef.current.trim();\n          if (q && data.products.length <= MAX_LOCAL_INDEX) {\n            const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, q, { limit: 500 });\n            setSearchResults(results);\n            setSearchTotalMatches(totalMatches || results.length);\n          }\n        }\n      });\n    };\n    const t0 = setTimeout(load, 800);\n    const t1 = setInterval(load, 5 * 60 * 1000);\n    return () => { cancelled = true; clearTimeout(t0); clearInterval(t1); };\n  }, []);\n\n  // Keress a teljes indexen (ha mr betlttt); res keress = res tallat\n  useEffect(() => {\n    if (!searchQuery.trim()) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    if (!canUseLocalSearch) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, searchQuery.trim(), { limit: 500 });\n    setSearchResults(results);\n    setSearchTotalMatches(totalMatches || results.length);\n  }, [searchQuery, canUseLocalSearch]);\n\n  useEffect(() => {\n    const t = setInterval(() => loadUnasDataRef.current?.({ silent: true }), 300000);\n    return () => clearInterval(t);\n  }, []);\n\n  // Featured pool for homepage modules  1. batch azonnal, 23. batch 1s ksleltetve\n  useEffect(() => {\n    if (!totalProductsCount || totalProductsCount <= 0) return;\n    const key = `${totalProductsCount}-${lastUpdated || ''}`;\n    if (featuredPoolKeyRef.current === key) return;\n    featuredPoolKeyRef.current = key;\n    let cancelled = false;\n    let extraTimeoutId = null;\n    const limit = 150;\n    const mergeInto = (map, data) => {\n      (data?.products || []).forEach((p) => {\n        if (!p || !p.id) return;\n        map.set(p.id, normalizeProduct(p));\n      });\n    };\n    fetchUnasProducts({ limit, offset: 0, slim: false })\n      .then((first) => {\n        if (cancelled) return;\n        const merged = new Map();\n        mergeInto(merged, first);\n        setFeaturedPool(Array.from(merged.values()));\n        if (totalProductsCount <= limit * 2) return;\n        const extraOffsets = [\n          Math.max(0, Math.floor(totalProductsCount / 3) - Math.floor(limit / 2)),\n          Math.max(0, Math.floor((totalProductsCount * 2) / 3) - Math.floor(limit / 2))\n        ];\n        extraTimeoutId = setTimeout(() => {\n          if (cancelled) return;\n          Promise.all(extraOffsets.map((o) => fetchUnasProducts({ limit, offset: o, slim: false })))\n            .then((batches) => {\n              if (cancelled) return;\n              const map = new Map(Array.from(merged.entries()));\n              batches.forEach((b) => mergeInto(map, b));\n              setFeaturedPool(Array.from(map.values()));\n            })\n            .catch(() => {});\n        }, 1000);\n      })\n      .catch(() => {\n        if (!cancelled) setFeaturedPool([]);\n      });\n    return () => {\n      cancelled = true;\n      if (extraTimeoutId != null) clearTimeout(extraTimeoutId);\n    };\n  }, [totalProductsCount, lastUpdated]);\n\n  const normalizedAdvancedFilters = useMemo(() => ({\n    priceMin: advancedFilters.priceMin ?? 0,\n    priceMax: advancedFilters.priceMax ?? 1000000,\n    inStockOnly: advancedFilters.inStockOnly ?? false,\n    categories: Array.isArray(advancedFilters.categories) ? advancedFilters.categories : []\n  }), [advancedFilters]);\n\n  const mobileActiveFilterCount = useMemo(() => [\n    normalizedAdvancedFilters.inStockOnly,\n    normalizedAdvancedFilters.categories.length > 0,\n    normalizedAdvancedFilters.priceMin > 0,\n    normalizedAdvancedFilters.priceMax < 1000000\n  ].filter(Boolean).length, [normalizedAdvancedFilters]);\n  \n  // Szerver mr szr (kategria, keress); itt csak rendezs + advanced filter a kis listn\n  const filteredAndSortedProducts = useMemo(() => {\n    let result = [...products];\n    if (Object.keys(advancedFilters).length > 0) {\n      result = applyFilters(result, normalizedAdvancedFilters);\n    }\n    if (sortOption === 'price-asc') result = result.sort((a, b) => (a.price || 0) - (b.price || 0));\n    if (sortOption === 'price-desc') result = result.sort((a, b) => (b.price || 0) - (a.price || 0));\n    return result;\n  }, [products, sortOption, advancedFilters, normalizedAdvancedFilters]);\n\n  // Kollekci-specifikus szrs: isSale -> salePrice, styleKeywords -> name/description/params\n  const collectionFilteredProducts = useMemo(() => {\n    if (!selectedCollection) return filteredAndSortedProducts;\n    let list = [...filteredAndSortedProducts];\n    if (selectedCollection.isSale) {\n      list = list.filter((p) => p.salePrice != null && p.price > 0 && p.salePrice < p.price);\n    }\n    const keywords = selectedCollection.styleKeywords || [];\n    if (keywords.length > 0) {\n      const lower = keywords.map((k) => String(k).toLowerCase());\n      list = list.filter((p) => {\n        const text = `${p.name || ''} ${p.description || ''} ${p.params || ''}`.toLowerCase();\n        return lower.some((kw) => text.includes(kw));\n      });\n    }\n    return list;\n  }, [selectedCollection, filteredAndSortedProducts]);\n\n  filteredLengthRef.current = filteredAndSortedProducts.length;\n\n  const isSearchMode = searchQuery.trim().length >= 2 && canUseLocalSearch;\n  const isSearchActive = searchQuery.trim().length > 0;\n  const sectionProducts = isSearchActive ? [] : filteredAndSortedProducts;\n  const sectionContextLabel = categoryFilter && categoryFilter !== 'sszes'\n    ? categoryFilter\n    : (mobileActiveFilterCount > 0 ? 'Szrt ajnlsok' : '');\n  const useContextSections = isSearchActive || (categoryFilter && categoryFilter !== 'sszes') || mobileActiveFilterCount > 0;\n  const featuredBase = useContextSections ? sectionProducts : (featuredPool.length > 0 ? featuredPool : sectionProducts);\n  const displayedProducts = aiRecommendedProducts.length > 0\n    ? aiRecommendedProducts\n    : isSearchMode\n      ? searchResults\n      : filteredAndSortedProducts;\n  const hasMoreToShow = aiRecommendedProducts.length === 0 && !isSearchMode && products.length < totalProductsCount;\n  const headerCount = isSearchMode\n    ? (searchTotalMatches || searchResults.length)\n    : (totalProductsCount || filteredAndSortedProducts.length);\n\n  const handleLoadMore = useCallback(() => {\n    if (isLoadingMore || !hasMoreProducts) return;\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: searchQuery.trim() || undefined,\n      category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n      categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined\n    });\n  }, [isLoadingMore, hasMoreProducts, products.length, searchQuery, categoryFilter, getCategoryMainList]);\n\n  const handleCollectionLoadMore = useCallback(() => {\n    if (!selectedCollection || isLoadingMore || !hasMoreProducts) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n      } else {\n        categoriesList = cats;\n      }\n    }\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined\n    });\n  }, [selectedCollection, isLoadingMore, hasMoreProducts, products.length, categoryHierarchy]);\n\n  // Categories with TOTAL counts (from hierarchy if available, fallback to loaded products)\n  const categories = useMemo(() => {\n    const total = totalProductsCount || products.length;\n    if (categoryHierarchy?.mainCategories?.length) {\n      const main = categoryHierarchy.mainCategories.map((m) => ({\n        id: m.name,\n        name: m.name,\n        totalCount: Number(m.productCount || 0)\n      }));\n      return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...main];\n    }\n    if (!products || products.length === 0) return [{ id: 'sszes', name: 'sszes', totalCount: total }];\n    const categoryCount = new Map();\n    for (const p of products) {\n      if (p.category) {\n        categoryCount.set(p.category, (categoryCount.get(p.category) || 0) + 1);\n      }\n    }\n    const sorted = Array.from(categoryCount.entries())\n      .sort((a, b) => b[1] - a[1])\n      .map(([name, count]) => ({ id: name, name, totalCount: count }));\n    return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...sorted];\n  }, [categoryHierarchy?.mainCategories, products, totalProductsCount]);\n\n  const recentPurchasesForSocialProof = useMemo(() => products.slice(0, 10), [products]);\n\n  return (\n    <ToastProvider>\n    <div id=\"mkt-butorbolt-app\" className=\"min-h-screen bg-white font-sans text-gray-900 rounded-3xl sm:rounded-[2rem] lg:rounded-[2.5rem] overflow-hidden shadow-2xl shadow-gray-300/50 mx-auto w-full max-w-[2000px]\">\n      {/* Scroll Progress Bar */}\n      <ScrollProgress />\n      \n      <Navbar \n        activeTab={activeTab} \n        setActiveTab={setActiveTab} \n        wishlistCount={wishlist.length}\n        productCount={totalProductsCount || products.length}\n        categories={categories}\n        categoryHierarchy={categoryHierarchy.mainCategories}\n        activeCategory={categoryFilter}\n        onOpenWishlist={() => setShowWishlistDrawer(true)}\n        onCategorySelect={handleCategoryChange}\n        onScrollToShop={scrollToProductsSection}\n        fixUrl={fixUrl}\n        onRecentProductClick={handleProductView}\n      />\n      \n      {/* AI Onboarding */}\n      <AIOnboarding \n        isOpen={showAIOnboarding} \n        onClose={() => setShowAIOnboarding(false)}\n        targetFeature={onboardingFeature}\n      />\n      \n      {/* Live Social Proof */}\n      <LiveSocialProof \n        currentProduct={selectedProduct} \n        recentPurchases={recentPurchasesForSocialProof}\n      />\n      \n      {/* Back to Top Button */}\n      <BackToTop />\n      \n      {/* AI Chat Assistant (deferred for faster first paint) */}\n      {showDeferredAI && (\n        <Suspense fallback={null}>\n            <AIChatAssistant\n              products={products}\n              catalogProducts={searchIndexReady ? searchIndexRef.current : products}\n              onShowProducts={handleShowAIProducts}\n              serverSearchMode={SERVER_SEARCH_ONLY}\n              totalProductsCount={totalProductsCount}\n              categoryHierarchy={categoryHierarchy}\n            />\n        </Suspense>\n      )}\n\n      <main id=\"mkt-butorbolt-main\">\n        {activeTab === 'shop' && (\n          <>\n            {/* Flash Sale Banner  nem teljes szlessg, lekerektett, vltakoz ajnlatok */}\n            <div className=\"px-[2px] sm:px-2 lg:px-4\">\n              <FlashSaleBanner\n                endTime={flashSaleEndTime}\n                title=\" Flash Sale!\"\n                subtitle=\"Csak ma! Akr 50% kedvezmny kivlasztott btorokra\"\n                onViewSale={scrollToProductsSection}\n                variant=\"banner\"\n              />\n            </div>\n\n            <ModernHero \n              onExplore={scrollToProductsSection}\n              onTryAI={() => setActiveTab('visual-search')}\n              products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n              onHeroQuickView={(product) => handleProductView(product)}\n              onHeroSearch={(query, meta = {}) => {\n                if (!query?.trim()) return;\n                if (meta?.source !== 'instant') {\n                  setActiveTab('shop');\n                }\n                handleServerSearch(query, { scrollFromEffect: false });\n                if (meta?.source !== 'instant') {\n                  requestAnimationFrame(() => requestAnimationFrame(() => scrollToProductsSectionRef.current?.()));\n                }\n              }}\n              quickCategories={categoryHierarchy?.mainCategories || []}\n              onQuickCategory={(name) => {\n                setActiveTab('shop');\n                handleCategoryChange(name);\n              }}\n            />\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <AIModuleUnified\n                onFeatureClick={(feature) => {\n                  if (feature.id === 'visual-search') setActiveTab('visual-search');\n                  else if (feature.id === 'chat') {\n                    document.getElementById('mkt-butorbolt-chat')?.scrollIntoView({ behavior: 'smooth' });\n                  }\n                  else if (feature.id === 'room-planner') setActiveTab('room-planner');\n                  else if (feature.id === 'style-quiz') setShowStyleQuiz(true);\n                  else if (feature.id === 'room-designer') setShowRoomDesigner(true);\n                }}\n              />\n            </FadeInOnScroll>\n\n            <FadeInOnScroll direction=\"up\" className=\"section-perf section-gap-lg\">\n              <Suspense fallback={null}>\n                <InspirationSection\n                  onExplore={scrollToProductsSection}\n                  onCategorySelect={(name) => {\n                    setActiveTab('shop');\n                    handleCategoryChange(name);\n                  }}\n                  onCollectionSelect={(col) => {\n                    handleCollectionSelect(col);\n                    requestAnimationFrame(() => requestAnimationFrame(() => scrollToProductsSectionRef.current?.()));\n                  }}\n                />\n              </Suspense>\n            </FadeInOnScroll>\n            \n            {featuredBase.length > 0 && (\n              <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n                <Suspense fallback={null}>\n                  <div className=\"w-[100vw] relative left-1/2 -translate-x-1/2 sm:w-full sm:relative sm:left-auto sm:translate-x-0\">\n                    <ProductWorldsSection\n                      products={featuredBase}\n                      onProductClick={handleProductView}\n                      onToggleWishlist={toggleWishlist}\n                      wishlist={wishlist}\n                      onViewAll={scrollToProductsSection}\n                      onAddToCart={handleAddToCart}\n                      contextLabel={sectionContextLabel}\n                      rotationTick={sectionRotateTick}\n                    />\n                  </div>\n                </Suspense>\n              </FadeInOnScroll>\n            )}\n            \n            {/* Personalized Section - For You + Recently Viewed + Trending */}\n            {featuredBase.length > 0 && (\n              <Suspense fallback={null}>\n                <PersonalizedSection\n                  products={featuredBase}\n                  onProductClick={handleProductView}\n                  onToggleWishlist={toggleWishlist}\n                  wishlist={wishlist}\n                  onAddToCart={handleAddToCart}\n                  contextLabel={sectionContextLabel}\n                />\n              </Suspense>\n            )}\n\n            <div className=\"w-full max-w-[500px] mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\n              <Suspense fallback={null}>\n                <LoyaltyProgram\n                  currentPoints={2450}\n                  totalSpent={485000}\n                  tier=\"silver\"\n                  onViewRewards={() => {}}\n                  onRedeemPoints={(reward) => console.log('Redeem:', reward)}\n                />\n              </Suspense>\n            </div>\n\n            <Suspense fallback={null}>\n              <NewsletterStrip />\n            </Suspense>\n\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <Features />\n            </FadeInOnScroll>\n            \n            {/* Collection Page  kollekci landing */}\n            {selectedCollection ? (\n              <CollectionPage\n                collection={selectedCollection}\n                products={collectionFilteredProducts}\n                onBack={handleCollectionBack}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                onNavigateToCategory={handleCategoryChange}\n                allCategories={categories}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                onLoadMore={handleCollectionLoadMore}\n                isLoading={isLoadingUnas}\n              />\n            ) : categoryFilter && categoryFilter !== \"sszes\" && !isLoadingUnas ? (\n              <CategoryPage\n                category={categoryFilter}\n                products={filteredAndSortedProducts}\n                allCategories={categories}\n                onBack={() => handleCategoryChange(\"sszes\")}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                onCategoryChange={handleCategoryChange}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                stats={categoryStats}\n                onLoadMore={handleLoadMore}\n              />\n            ) : (\n            <section id=\"products-section\" className=\"container-app section-padding section-perf\">\n                {/* Sticky products header - solid, breadcrumb when category selected */}\n                <div className=\"sticky top-16 sm:top-20 z-40 mx-0 sm:-mx-4 lg:-mx-8 xl:-mx-10 px-3 sm:px-4 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-5 xl:py-6 mb-3 sm:mb-4 lg:mb-8 bg-white border-b border-gray-200 shadow-sm search-shell rounded-2xl\">\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 mb-2 sm:mb-3\">\n                    <nav className=\"flex items-center gap-2 text-sm text-gray-500\" aria-label=\"Breadcrumb\">\n                      <button type=\"button\" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"Foldal teteje\">Foldal</button>\n                      <span aria-hidden=\"true\">/</span>\n                      <button type=\"button\" onClick={() => handleCategoryChange('sszes')} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"sszes kategria\">Termkek</button>\n                      {categoryFilter && categoryFilter !== 'sszes' && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"font-semibold text-gray-700\">{categoryFilter}</span>\n                        </>\n                      )}\n                      {searchQuery && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"text-gray-600\">Keress: &quot;{searchQuery}&quot;</span>\n                        </>\n                      )}\n                      <span className=\"text-gray-400\">({headerCount.toLocaleString('hu-HU')} termk)</span>\n                    </nav>\n                    <LiveActivityStrip className=\"hidden sm:flex shrink-0\" />\n                  </div>\n                  <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 lg:gap-6\">\n                    {/* Title & Count */}\n                    <div className=\"flex items-baseline gap-2 sm:gap-3 lg:gap-4 flex-wrap\">\n                      <h2 className=\"text-xl sm:text-2xl lg:text-3xl xl:text-4xl 2xl:text-5xl font-bold text-gray-900\">\n                        {searchQuery ? 'Keress' : 'Termkek'}\n                      </h2>\n                      {!isLoadingUnas && (\n                        <span className=\"text-sm sm:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-500\">\n                          <span className=\"font-semibold text-primary-500\">\n                            {(headerCount || 0).toLocaleString('hu-HU')}\n                          </span> db\n                        </span>\n                      )}\n                      {searchQuery && (\n                        <div className=\"flex items-center gap-2 ml-2\">\n                          <span className=\"px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium\">\n                            \"{searchQuery}\"\n                          </span>\n                          <button \n                            onClick={() => setSearchQuery('')}\n                            className=\"p-1 hover:bg-gray-100 rounded-full transition-colors\"\n                            title=\"Keress trlse\"\n                          >\n                            <X className=\"w-4 h-4 text-gray-500\" />\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Search & Filters */}\n                    <div className=\"w-full sm:w-auto\">\n                      <div className=\"w-full flex items-center gap-2 sm:gap-3 lg:gap-4 rounded-2xl border-2 border-primary-100 bg-gradient-to-r from-primary-50 via-white to-secondary-50 shadow-md p-2 sm:p-3\">\n                        <div className=\"flex-1 sm:flex-initial sm:w-64 lg:w-80 xl:w-[420px] 2xl:w-[520px]\">\n                          <SmartSearchBar \n                            products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n                            indexVersion={searchIndexVersion}\n                            shouldBuildIndex={!SERVER_SEARCH_ONLY && searchIndexReady}\n                            maxLocalIndex={MAX_LOCAL_INDEX}\n                            serverSearchMode={SERVER_SEARCH_ONLY}\n                            categories={categories}\n                            onSearch={handleServerSearch}\n                            onProductClick={handleProductView}\n                            placeholder=\"Keress btorok kztt...\"\n                          />\n                        </div>\n                        {/* Desktop filters */}\n                        <div className=\"hidden sm:block\">\n                          <AdvancedFilters\n                            products={products}\n                            onFilterChange={setAdvancedFilters}\n                            initialFilters={advancedFilters}\n                          />\n                        </div>\n                        {/* Mobile filter button  same state as desktop AdvancedFilters */}\n                        <button\n                          onClick={() => setShowFilterSheet(true)}\n                          className=\"sm:hidden relative p-3 min-h-[48px] min-w-[48px] border-2 border-gray-200 rounded-xl bg-white hover:bg-gray-50 transition-colors flex items-center justify-center\"\n                          aria-label=\"Szrk\"\n                        >\n                          <Filter className=\"w-5 h-5 text-gray-700\" />\n                          {mobileActiveFilterCount > 0 && (\n                            <span className=\"absolute -top-1 -right-1 bg-primary-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 px-1.5 flex items-center justify-center\">\n                              {mobileActiveFilterCount}\n                            </span>\n                          )}\n                        </button>\n                        <select \n                          onChange={(e) => setSortOption(e.target.value)} \n                          className=\"hidden sm:block px-4 lg:px-5 xl:px-6 py-3 lg:py-3.5 xl:py-4 min-h-[48px] lg:min-h-[52px] xl:min-h-[56px] text-sm sm:text-base lg:text-lg xl:text-xl border-2 border-gray-200 rounded-xl lg:rounded-2xl bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-100 outline-none transition-all cursor-pointer font-medium\"\n                          aria-label=\"Rendezs\"\n                        >\n                          <option value=\"default\">Rendezs</option>\n                          <option value=\"price-asc\">r: alacsony  magas</option>\n                          <option value=\"price-desc\">r: magas  alacsony</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                  {/* Active filter chips + sort chips  wrap mobil/tablet, 44px touch */}\n                  <div className=\"flex flex-wrap items-center gap-x-2 gap-y-3 mt-3 pt-3 border-t border-gray-100\">\n                    {mobileActiveFilterCount > 0 && (\n                      <div className=\"flex flex-wrap items-center gap-2 min-w-0\">\n                        {normalizedAdvancedFilters.inStockOnly && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Raktron\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, inStockOnly: false }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMin > 0 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Min. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMin)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMin: 0 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMax < 1000000 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Max. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMax)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMax: 1000000 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {(normalizedAdvancedFilters.categories || []).map(cat => (\n                          <span key={cat} className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            {cat}\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, categories: (prev.categories || []).filter(c => c !== cat) }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label={`${cat} eltvoltsa`}>\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        ))}\n                        <button type=\"button\" onClick={() => setAdvancedFilters({})} className=\"text-sm font-medium text-gray-500 hover:text-primary-600 transition-colors min-h-[44px] px-2 flex items-center sm:min-h-0\">\n                          sszes trlse\n                        </button>\n                      </div>\n                    )}\n                    <div className=\"flex items-center gap-1.5 w-full sm:w-auto sm:ml-auto flex-shrink-0\">\n                      <span className=\"text-xs sm:text-sm text-gray-500 mr-1 hidden sm:inline\">Rendezs:</span>\n                      {['default', 'price-asc', 'price-desc'].map((value) => (\n                        <button\n                          key={value}\n                          type=\"button\"\n                          onClick={() => setSortOption(value)}\n                          className={`min-h-[44px] sm:min-h-0 px-3 py-2 sm:py-1.5 rounded-full text-sm font-medium transition-colors flex items-center justify-center ${\n                            sortOption === value\n                              ? 'bg-primary-500 text-white'\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                          }`}\n                        >\n                          {value === 'default' ? 'Alap' : value === 'price-asc' ? 'r ' : 'r '}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Main categories (from hierarchy) + quick filter swipe */}\n                {categoryHierarchy?.mainCategories?.length > 0 && (\n                  <MainCategoriesSection\n                    mainCategories={categoryHierarchy.mainCategories}\n                    activeCategory={categoryFilter}\n                    onCategorySelect={handleCategoryChange}\n                    totalProductCount={totalProductsCount || products.length}\n                  />\n                )}\n                <CategorySwipe\n                  categories={(() => {\n                    if (categoryHierarchy?.mainCategories?.length > 0) {\n                      return [\n                        { id: 'sszes', name: 'sszes', totalCount: totalProductsCount || products.length },\n                        ...categoryHierarchy.mainCategories.map((m) => ({\n                          id: m.name,\n                          name: m.name,\n                          totalCount: m.productCount ?? 0,\n                          icon: null,\n                        })),\n                      ];\n                    }\n                    return categories.map((cat) => ({\n                      id: cat.name,\n                      name: cat.name,\n                      totalCount: cat.count,\n                      icon: null,\n                    }));\n                  })()}\n                  activeCategory={categoryFilter}\n                  onCategoryChange={handleCategoryChange}\n                  displayedCount={products.length}\n                  activeTotalOverride={categoryFilter === 'sszes'\n                    ? (totalProductsCount || products.length)\n                    : (categoryStats?.total ?? activeHierarchyCount ?? 0)}\n                />\n\n                {/* Loading State */}\n                {isLoadingUnas && (\n                  <div className=\"space-y-6\">\n                    <div className=\"flex items-center justify-center gap-3\">\n                      <div className=\"w-6 h-6 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                      <p className=\"text-sm text-gray-500 font-medium\">Termkek betltse...</p>\n                    </div>\n                    <div className=\"product-grid\">\n                      {[...Array(8)].map((_, i) => (\n                        <ProductCardSkeleton key={`skeleton-${i}`} />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* API Error State */}\n                {!isLoadingUnas && unasError && (\n                  <div className=\"flex flex-col items-center justify-center py-16 px-4 text-center\">\n                    <AlertCircle className=\"w-16 h-16 text-red-500 mb-4\" />\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Nem sikerlt betlteni a termkeket</h3>\n                    <p className=\"text-gray-600 mb-6 max-w-md\">Prbld ksbb, vagy ellenrizd a kapcsolatot.</p>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        const catMain = getCategoryMainList(categoryFilter);\n                        loadUnasDataRef.current({\n                          search: searchIndexReady ? undefined : (searchQuery.trim() || undefined),\n                          category: catMain.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n                          categoryMain: catMain.length > 0 ? catMain : undefined,\n                          limit: INITIAL_PAGE,\n                          offset: 0\n                        });\n                      }}\n                      className=\"px-6 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl font-bold hover:bg-primary-600 transition-colors\"\n                    >\n                      jraprbls\n                    </button>\n                  </div>\n                )}\n\n                {/* Empty State (no error, just no products) */}\n                {!isLoadingUnas && !unasError && displayedProducts.length === 0 && (\n                  searchQuery ? (\n                    <NoSearchResults \n                      query={searchQuery}\n                      onClear={() => setSearchQuery('')}\n                    />\n                  ) : (\n                    <NoFilterResults \n                      onClearFilters={() => {\n                        handleCategoryChange(\"sszes\");\n                        setAdvancedFilters({});\n                      }}\n                    />\n                  )\n                )}\n\n                {/* AI Recommendations Banner */}\n                {aiRecommendedProducts.length > 0 && (\n                  <div className=\"mb-6 p-4 sm:p-5 bg-gradient-to-r from-primary-500 via-secondary-600 to-secondary-500 rounded-2xl shadow-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-white/20 flex items-center justify-center\">\n                          <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                        </div>\n                        <div>\n                          <h3 className=\"text-white font-bold text-base sm:text-lg\">{aiRecommendationLabel}</h3>\n                          <p className=\"text-white/80 text-sm\">{aiRecommendedProducts.length} szemlyre szabott ajnls</p>\n                        </div>\n                      </div>\n                      <button\n                        onClick={clearAIRecommendations}\n                        className=\"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                        <span className=\"hidden sm:inline\">sszes termk</span>\n                      </button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Products Grid - Responsive with Scroll Animations */}\n                {!isLoadingUnas && displayedProducts.length > 0 && (\n                  <div className=\"product-grid\">\n                    {displayedProducts.map((product, index) => (\n                      <EnhancedProductCard \n                        key={product.id}\n                        product={product} \n                        onToggleWishlist={toggleWishlist} \n                        isWishlisted={wishlist.includes(product.id)} \n                        onQuickView={handleProductView}\n                        onAddToCart={handleAddToCart}\n                        index={index}\n                      />\n                    ))}\n                  </div>\n                )}\n                \n                {/* Load More Button */}\n                {!isLoadingUnas && !unasError && displayedProducts.length > 0 && (\n                  <div className=\"py-8 sm:py-10 lg:py-14 flex flex-col items-center gap-4\">\n                    {hasMoreToShow ? (\n                      <button\n                        onClick={handleLoadMore}\n                        disabled={isLoadingMore}\n                        className=\"px-6 sm:px-8 lg:px-10 py-3.5 sm:py-4 lg:py-5 min-h-[48px] lg:min-h-[56px] bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-semibold rounded-xl lg:rounded-2xl\n                                   hover:from-primary-600 hover:to-secondary-700 transition-all duration-200\n                                   shadow-lg hover:shadow-xl active:scale-[0.98]\n                                   flex items-center gap-3 sm:gap-4 text-base sm:text-lg lg:text-xl disabled:opacity-70 disabled:cursor-not-allowed\"\n                      >\n                        {isLoadingMore && (\n                          <span className=\"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white/70 border-t-transparent rounded-full animate-spin\" aria-hidden />\n                        )}\n                        <span>{isLoadingMore ? 'Betlts...' : 'Tbb termk'}</span>\n                        <span className=\"px-3 sm:px-3.5 py-1 sm:py-1.5 bg-white/20 rounded-lg text-sm sm:text-base\">\n                          {displayedProducts.length.toLocaleString('hu-HU')} / {totalProductsCount.toLocaleString('hu-HU')}\n                        </span>\n                      </button>\n                    ) : (\n                      <div className=\"flex items-center gap-2.5 text-sm sm:text-base lg:text-lg text-gray-400\">\n                        <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                        </svg>\n                        <span>Minden termk ({displayedProducts.length.toLocaleString('hu-HU')} db)</span>\n                      </div>\n                    )}\n                  </div>\n                )}\n            </section>\n            )}\n            \n            {/* Recently Viewed Products */}\n            <RecentlyViewed\n              onToggleWishlist={toggleWishlist}\n              wishlist={wishlist}\n              onQuickView={handleProductView}\n              onAddToCart={handleAddToCart}\n            />\n            \n            {/* Final CTA */}\n            <InteractiveCTA \n              onGetStarted={scrollToProductsSection}\n            />\n          </>\n        )}\n        \n        {activeTab === 'visual-search' && <VisualSearch products={products} onAddToCart={() => {}} />}\n        {activeTab === 'room-planner' && <RoomPlanner products={products} />}\n      </main>\n\n      <ProductModal \n        product={selectedProduct} \n        isOpen={!!selectedProduct} \n        onClose={() => setSelectedProduct(null)}\n        allProducts={products}\n        onAddToCart={handleAddToCart}\n      />\n      \n      {/* Similar Products AI Recommendation */}\n      {selectedProduct && (\n        <SimilarProducts\n          currentProduct={selectedProduct}\n          allProducts={products}\n          onToggleWishlist={toggleWishlist}\n          wishlist={wishlist}\n          onQuickView={handleProductView}\n          onAddToCart={handleAddToCart}\n        />\n      )}\n      \n      {/* Product Comparison */}\n      <ProductComparison\n        comparisonList={comparison.comparisonList}\n        onRemove={comparison.removeFromComparison}\n        onClear={comparison.clearComparison}\n      />\n      \n      {/* AI Style Quiz Modal */}\n      {showStyleQuiz && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIStyleQuiz\n            products={products}\n            onRecommendations={(recs) => {\n              toast.success(`${recs.length} termk a Style DNA-d alapjn!`);\n            }}\n            onClose={() => setShowStyleQuiz(false)}\n          />\n        </Suspense>\n      )}\n      \n      {/* AI Room Designer Modal */}\n      {showRoomDesigner && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIRoomDesigner\n            products={products}\n            onProductRecommendations={(recs) => {\n              toast.success(`${recs.length} termk ajnlat!`);\n            }}\n            onClose={() => setShowRoomDesigner(false)}\n          />\n        </Suspense>\n      )}\n\n      {/* Product Quick Peek Modal */}\n      <ProductQuickPeek\n        product={quickPeekProduct}\n        isOpen={!!quickPeekProduct}\n        onClose={() => setQuickPeekProduct(null)}\n        onAddToCart={(product) => {\n          handleAddToCart(product);\n          setQuickPeekProduct(null);\n        }}\n      />\n\n      {/* AR Product Preview */}\n      {showARPreview && arProduct && (\n        <ARProductPreview\n          product={arProduct}\n          onClose={() => {\n            setShowARPreview(false);\n            setArProduct(null);\n          }}\n        />\n      )}\n\n      {/* AR Measure - Room fit checker */}\n      {showARMeasure && arMeasureProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowARMeasure(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <ARMeasure\n              product={arMeasureProduct}\n              onClose={() => {\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n              onConfirmFit={() => {\n                handleAddToCart(arMeasureProduct);\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* One-Click Checkout */}\n      {showOneClickCheckout && oneClickProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowOneClickCheckout(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <OneClickCheckout\n              product={oneClickProduct}\n              savedAddress=\"1234 Budapest, Plda utca 12.\"\n              userEmail=\"user@example.com\"\n              userName=\"Felhasznl\"\n              onCheckout={({ product }) => {\n                toast.success('Sikeres rendels!');\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n              onClose={() => {\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Smart Newsletter Popup */}\n      <SmartNewsletterPopup\n        onSubscribe={(email) => {\n          toast.success('Sikeres feliratkozs! Ellenrizd az email fikod.');\n          return Promise.resolve();\n        }}\n      />\n\n      {/* Confetti Celebration */}\n      <Confetti \n        isActive={showConfetti} \n        onComplete={() => setShowConfetti(false)} \n      />\n\n      {/* Sticky Add to Cart (shows for selected product) */}\n      {selectedProduct && (\n        <StickyAddToCart\n          product={selectedProduct}\n          onAddToCart={handleAddToCart}\n          onToggleWishlist={toggleWishlist}\n          isWishlisted={wishlist.includes(selectedProduct.id)}\n          observedElementId=\"mkt-product-modal-root\"\n        />\n      )}\n\n      {/* Exit Intent Popup */}\n      {showExitIntent && (\n        <ExitIntentPopup \n          discountPercent={10}\n          onClose={() => setShowExitIntent(false)}\n        />\n      )}\n\n      {/* Mobile Filter Bottom Sheet  same state as desktop AdvancedFilters */}\n      <BottomSheet\n        isOpen={showFilterSheet}\n        onClose={() => setShowFilterSheet(false)}\n        title=\"Szrk\"\n        snapPoints={[0.7, 0.9]}\n      >\n        <AdvancedFiltersPanel\n          products={products}\n          filters={advancedFilters}\n          onFilterChange={setAdvancedFilters}\n          onApply={() => setShowFilterSheet(false)}\n          showHeader={false}\n        />\n      </BottomSheet>\n\n      {/* Wishlist Drawer */}\n      <WishlistDrawer\n        isOpen={showWishlistDrawer}\n        onClose={() => setShowWishlistDrawer(false)}\n        wishlistItems={wishlistItems}\n        onRemove={(id) => toggleWishlist(id)}\n        onAddToCart={handleAddToCart}\n        onProductClick={(product) => {\n          setShowWishlistDrawer(false);\n          handleProductView(product);\n        }}\n        onClearAll={() => {\n          wishlist.forEach(id => toggleWishlist(id));\n        }}\n      />\n\n      {/* Trust Badges Footer Section */}\n      <TrustBadges variant=\"footer\" />\n\n      {/* Sticky Mobile Add to Cart - shows on product view */}\n      {selectedProduct && (\n        <StickyAddToCartMobile\n          product={selectedProduct}\n          onAddToCart={(product, qty) => handleAddToCart(product, qty)}\n          onToggleWishlist={() => toggleWishlist(selectedProduct.id)}\n          isInWishlist={wishlist.includes(selectedProduct?.id)}\n          isVisible={true}\n          freeShippingThreshold={50000}\n        />\n      )}\n    </div>\n    </ToastProvider>\n  );\n};\n\nexport default App;\n","import React from 'react';\n\n/**\n * Root Error Boundary  elkapja a gyerek komponensek hibit,\n * fallback UI-t jelent meg, hogy az app ne dljn el teljesen.\n */\nexport class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    if (typeof window !== 'undefined' && window.console) {\n      console.error('[ErrorBoundary]', error, errorInfo);\n    }\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const Fallback = this.props.fallback;\n      if (Fallback) return <Fallback error={this.state.error} />;\n      return (\n        <div\n          role=\"alert\"\n          className=\"min-h-[200px] flex flex-col items-center justify-center p-6 bg-gray-50 border border-gray-200 rounded-xl text-center\"\n        >\n          <p className=\"text-gray-700 font-medium mb-2\">Valami hiba trtnt.</p>\n          <p className=\"text-sm text-gray-500 mb-4\">Frisstsd az oldalt, vagy prbld ksbb.</p>\n          <button\n            type=\"button\"\n            onClick={() => window.location.reload()}\n            className=\"px-4 py-2 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400\"\n          >\n            Oldal frisstse\n          </button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport { ErrorBoundary } from './components/ui/ErrorBoundary'\nimport './index.css'\n\nif (typeof window !== 'undefined' && !window.__MKT_SCROLL_INIT) {\n  window.__MKT_SCROLL_INIT = true\n  window.history.scrollRestoration = 'manual'\n  const scrollTopNow = () => {\n    window.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n    const appRoot = document.getElementById('mkt-butorbolt-app')\n    if (appRoot) {\n      let parent = appRoot.parentElement\n      while (parent && parent !== document.body) {\n        const style = getComputedStyle(parent)\n        const oy = style.overflowY\n        const isScrollable = (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && parent.scrollHeight > parent.clientHeight\n        if (isScrollable) {\n          parent.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n          break\n        }\n        parent = parent.parentElement\n      }\n    }\n  }\n  scrollTopNow()\n  window.addEventListener('DOMContentLoaded', scrollTopNow)\n  window.addEventListener('load', scrollTopNow)\n  window.addEventListener('pageshow', scrollTopNow)\n}\n\nconst rootEl = document.getElementById('root')\nif (rootEl) {\n  if (!window.__MKT_BUTORBOLT_APP_MOUNTED) {\n    window.__MKT_BUTORBOLT_APP_MOUNTED = true\n    ReactDOM.createRoot(rootEl).render(\n      <React.StrictMode>\n        <ErrorBoundary>\n          <App />\n        </ErrorBoundary>\n      </React.StrictMode>,\n    )\n  }\n}\n"],"file":"assets/index.js"}