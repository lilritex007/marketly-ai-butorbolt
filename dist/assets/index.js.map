{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","c","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","getApiBase","base","_a","DEFAULT_LIMIT","fetchUnasProducts","filters","limit","offset","API_BASE","params","mainValue","url","res","data","products","error","fetchCategoryHierarchy","fetchUnasProductById","id","fetchProductStats","getCartAddPrefix","path","_c","_b","extractVxSku","product","m1","imgs","firstImg","imgUrl","m2","toUnasProductId","raw","s","str","getCartAddContext","wins","w","findUnasForm","doc","selectors","sel","form","ensureQtyInput","unasId","qty","targetDoc","numericId","ids","input","inputId","el","input2","addToUnasCart","quantity","ctx","err","STORAGE_KEYS","MAX_ITEMS","MAX_BACK_IN_STOCK","DEFAULT_RECO_TWEAKS","DEFAULT_RECO_WEIGHTS","getJSONSafe","key","fallback","trackProductView","filtered","getViewedProducts","updated","updateCategoryPreference","parsed","getRecentlyViewedIds","likeProduct","productId","liked","getLikedProducts","disliked","getDislikedProducts","dislikeProduct","SIGNAL_LIMITS","stopWords","clampSignal","value","extractSignalTokens","categories","keywords","getPreferenceSignals","savePreferenceSignals","signals","updatePreferenceSignals","delta","cat","next","kw","toggleLikeProduct","isLiked","isDisliked","nextLiked","toggleDislikeProduct","nextDisliked","isProductLiked","isProductDisliked","requestBackInStock","getBackInStockRequests","list","trackSectionEvent","sectionId","type","entry","trackSearch","query","getSearchHistory","saveStyleDNA","quizAnswers","styleDNAText","getStyleDNA","trackAIFeedback","messageId","isPositive","context","feedback","getAIFeedback","saveChatContext","summary","getChatContext","category","prefs","getUserPreferences","getRecommendationTweaks","setRecommendationTweaks","merged","resetRecommendationTweaks","getRecommendationWeights","getABVariant","testId","tests","variant","trackABEvent","getTopCategories","name","getPersonalizedContext","viewedProducts","likedProducts","topCategories","styleDNA","searchHistory","getPersonalizedRecommendations","allProducts","viewedIds","likedIds","dislikedIds","tweaks","weights","avgPriceBase","avgPrice","sum","score","price","productCategory","index","signal","space","colors","budget","priority","room","productText","styleKeywords","roomKeywords","diff","stockQty","getSimilarProducts","productName","productPrice","pName","pCategory","pPrice","priceDiff","Skeleton","className","baseClasses","variants","jsx","ProductCardSkeleton","jsxs","ProductGridSkeleton","count","_","i","ToastContext","createContext","TOAST_TYPES","CheckCircle2","XCircle","AlertCircle","Info","ShoppingCart","Heart","Sparkles","Bell","Truck","Toast","title","message","duration","onClose","action","isVisible","setIsVisible","useState","isLeaving","setIsLeaving","config","Icon","useEffect","timer","handleClose","X","ToastContainer","toasts","removeToast","toast","ToastProvider","children","setToasts","addToast","useCallback","options","prev","t","useToast","useContext","EmptyState","Package","description","secondaryAction","size","NoSearchResults","onClear","onSuggest","Search","RefreshCw","NoFilterResults","onClearFilters","Filter","Badge","pulse","sizes","iconSizes","NewBadge","DiscountBadge","percent","Percent","HotBadge","Flame","BestsellerBadge","Award","LimitedBadge","Clock","FreeShippingBadge","StockBadge","inStock","SmartBadges","maxBadges","badges","topBadges","badge","idx","CATEGORY_ICONS","LayoutGrid","Sofa","Armchair","Tv","BedDouble","Briefcase","Table","UtensilsCrossed","Warehouse","Shirt","Box","BookOpen","Lamp","LampDesk","Baby","Bath","TreeDeciduous","Flower2","Home","Gift","getCategoryIcon","categoryName","lowerName","CategoryIcon","props","AIOnboarding","isOpen","targetFeature","messages","MessageCircle","Camera","content","Lightbulb","CategorySwipe","activeCategory","onCategoryChange","displayedCount","activeTotalOverride","isExpanded","setIsExpanded","canScrollLeft","setCanScrollLeft","canScrollRight","setCanScrollRight","scrollRef","useRef","activeData","activeTotalCount","VISIBLE_MOBILE","VISIBLE_DESKTOP","isMobile","setIsMobile","checkMobile","visibleCount","visibleCategories","hasMore","updateScrollIndicators","scrollLeft","scrollWidth","clientWidth","rafId","onScroll","scroll","direction","activeEl","Grid3X3","Fragment","ChevronLeft","ChevronRight","ChevronUp","ChevronDown","PLACEHOLDER_IMAGE","normalizeProduct","formatPrice","formatPriceNumber","isValidEmail","email","getStockLevel","direct","match","val","toWebP","imageUrl","quality","isWebPSupported","canvas","support","getResponsiveSrcSet","appendSizeParam","width","getOptimizedImageProps","alt","height","lazy","responsive","optimizedUrl","getAdaptiveQuality","EnhancedProductCard","onToggleWishlist","isWishlisted","onQuickView","onAddToCart","highlightBadge","recommendationReasons","showFeedback","tone","accentClass","skipScrollAnimation","isHovered","setIsHovered","imageLoaded","setImageLoaded","imageError","setImageError","notifySaved","setNotifySaved","toneClasses","sizeClasses","sizeConfig","feedbackState","setFeedbackState","cardRef","impressionRef","mainImage","discount","displayPrice","reasonsText","optimizedProps","timeoutRef","element","observer","delay","handleQuickView","handleNotify","hasWorldAccent","worldGlow","worldCorner","Eye","ThumbsUp","ThumbsDown","PRESET_STORAGE_KEY","CATEGORY_IMAGES","getCategoryImage","getCategoryTheme","themes","theme","Breadcrumb","onBack","CategoryHero","productCount","bgImage","SidebarFilters","onFilterChange","priceRange","onPriceRangeChange","filterOptions","useMemo","brands","prices","minPrice","maxPrice","previewCounts","brandCounts","colorCounts","isInStock","brandOk","colorOk","toggleFilter","current","v","FilterSection","items","item","preview","Tag","SlidersHorizontal","RelatedCategories","currentCategory","allCategories","related","CategoryStory","blocks","ShieldCheck","MapPin","block","PriceStats","stats","computedStats","stat","FeaturedProducts","onProductClick","onWishlistToggle","wishlist","featured","Star","CompactProductCard","onCompare","isComparing","hasDiscount","discountPct","GitCompare","AIBanner","onAskAI","ViewControls","sortOption","onSortChange","viewMode","onViewModeChange","loadedCount","totalCount","onOpenFilters","compareCount","Rows3","mode","CategoryPage","onLoadMore","onScrollToSection","setSortOption","setViewMode","setFilters","setPriceRange","showFilters","setShowFilters","compareList","setCompareList","presetName","setPresetName","savedPresets","setSavedPresets","loadMoreRef","savePreset","applyPreset","preset","quickApply","quickCounts","under100","premium","displayedProducts","dA","stock","viewed","visibleProducts","hasMoreToShow","toggleCompare","CollectionHero","collection","CollectionCompactCard","CollectionPage","onNavigateToCategory","isLoading","activeCategoryFilter","setActiveCategoryFilter","styleFilteredProducts","searchStr","inCollectionCategories","set","CARD_COLORS","MainCategoriesSection","mainCategories","onCategorySelect","totalProductCount","main","isActive","color","child","scrollY","scrollPercent","scrollHeight","snapshot","listeners","getScrollData","y","sh","pct","notify","fn","subscribe","listener","getSnapshot","getServerSnapshot","useScrollPosition","useSyncExternalStore","useScrollPastY","threshold","useScrollPastPercent","lockCount","savedStyles","lastScrollParent","getScrollParent","appRoot","parent","oy","lock","bodyOverflow","scrollParent","unlock","bodySaved","parentSaved","useScrollLock","RECENT_CATEGORIES_KEY","RECENT_CATEGORIES_MAX","ANNOUNCEMENT_MESSAGES","Zap","TrendingUp","POPULAR_CATEGORIES","MEGA_MENU_COLORS","Navbar","activeTab","setActiveTab","wishlistCount","categoryHierarchy","onOpenWishlist","onScrollToShop","recentlyViewedProp","fixUrl","onRecentProductClick","mobileMenuOpen","setMobileMenuOpen","isScrolled","announcementIndex","setAnnouncementIndex","announcementProgress","setAnnouncementProgress","announcementStartRef","isDarkMode","setIsDarkMode","showMegaMenu","setShowMegaMenu","isReturningUser","setIsReturningUser","userName","setUserName","mobileMenuClosing","setMobileMenuClosing","touchStartX","setTouchStartX","recentlyViewedLocal","setRecentlyViewedLocal","recentCategories","setRecentCategories","mobileCategoriesExpanded","setMobileCategoriesExpanded","mobileExpandedMain","setMobileExpandedMain","megaMenuHoverMain","setMegaMenuHoverMain","mobileMenuRef","megaMenuRef","megaMenuPanelRef","megaMenuCloseTimeoutRef","hamburgerButtonRef","lastVisit","savedName","load","pushRecentCategory","ANNOUNCEMENT_DURATION_MS","interval","announcementRafRef","start","tick","elapsed","handleEsc","handleClickOutside","panel","focusables","first","handleKeyDown","closeMobileMenu","handleTouchStart","handleTouchEnd","focusSearchAndClose","openMobileMenu","setTabAndClose","tab","navItems","Move","currentAnnouncement","isHover","isActiveMain","MainIcon","isActiveChild","ArrowRight","menuCategories","isRealCategories","Sun","Moon","Menu","part","arr","React","realCats","initialCount","shown","isReal","Phone","Mail","Instagram","Facebook","ScrollProgress","BackToTop","scrollToTop","ArrowUp","createMotionComponent","tag","forwardRef","initial","animate","exit","transition","whileHover","whileTap","style","ref","motion","AnimatePresence","LiveSocialProof","currentProduct","recentPurchases","viewerCount","setViewerCount","showNotification","setShowNotification","currentNotification","setCurrentNotification","baseViewers","change","notifications","ShoppingBag","Users","random","MIN_VIEWERS","MAX_VIEWERS","getRandomViewers","LiveActivityStrip","viewers","setViewers","Circle","CountUp","end","suffix","decimals","setCount","countRef","hasStarted","startTime","easeOutQuad","progress","easedProgress","formatNumber","num","INDEX","SYNONYMS","WORD_TO_ROOT","root","synonyms","rootNorm","normalize","syn","getWords","expandWithSynonyms","words","expanded","word","syns","buildSearchIndex","includeDesc","CHUNK_SIZE","processed","processChunk","resolve","nameNorm","catNorm","descNorm","allWords","getIndexStats","smartSearch","queryNorm","cacheKey","cached","buildSearchIndexSync","directSearch","queryWords","expandedQuery","candidateScores","matches","indexedWord","idxSet","scored","baseScore","norm","nameWordMatches","results","searchTime","result","firstKey","getAutocompleteSuggestions","suggestions","seen","prods","norms","parseSearchIntent","intent","typeRoots","colorRoots","styleRoots","materialRoots","priceMatch","getProactiveSuggestions","QUICK_INTENTS","SUCCESSFUL_SEARCHES_KEY","SEARCH_DEBOUNCE_MS","LONG_PRESS_MS","QUICK_FILTER_PRESETS","PROACTIVE_QUICK","escapeRegExp","HeroSmartSearch","onSearch","onTryAI","onOpenProductQuickView","setQuery","setIsOpen","isSearching","setIsSearching","didSearch","setDidSearch","dismissedFilterIds","setDismissedFilterIds","compareProducts","setCompareProducts","searchJourney","setSearchJourney","showRewriteOptions","setShowRewriteOptions","showQuickFilterPanel","setShowQuickFilterPanel","likedProductIds","setLikedProductIds","viewedProductIds","setViewedProductIds","preferredCategories","setPreferredCategories","preferredKeywords","setPreferredKeywords","searchPulse","setSearchPulse","resultCountPulse","setResultCountPulse","hoverCard","setHoverCard","smartResults","setSmartResults","smartTotalMatches","setSmartTotalMatches","isIndexBuilding","setIsIndexBuilding","previewProduct","setPreviewProduct","previewAnchor","setPreviewAnchor","instantSearchRef","longPressTimerRef","trimmedQuery","cancelled","debouncedQuery","setDebouncedQuery","nextResults","nextTotal","queryTokens","parsedFilters","activeFilters","queryMatchedProducts","haystack","token","rankedQueryProducts","likedSet","viewedSet","categoryFull","categoryLeaf","previewProducts","unique","starterProducts","contextualSuggestions","categoryMap","actualResultCount","confidenceScore","confidenceMeta","dynamicQuickSuggestions","firstToken","quickHitSuggestions","text","rewriteSuggestions","mainCategory","topStyle","topColor","rewriteSuggestionsWithQuality","intentTimeline","timeline","priceText","hasNoResults","rescueSuggestions","triggerFullSearch","inputQuery","source","safeQuery","handleSubmit","now","prevNorm","x","applySuggestion","opts","submit","handlePreviewProductClick","removeFilter","filter","clearAllFilters","removeFromHistory","queryToRemove","toggleCompareProduct","runCompareSearch","composed","applyRewrite","applyQuickFilterToken","normalized","formatPriceHu","getProductImage","isPersonalMatch","getTopBadge","handleCardMouseMove","event","rect","px","rx","ry","displayedTopProducts","historyGrouped","startOfToday","startTs","today","earlier","categoryCounter","keywordCounter","topKeywords","stored","history","Wand2","group","values","BrainCircuit","step","RotateCcw","cp","Plus","QUICK_CARD_COLORS","QUICK_CATEGORY_LIMIT","MIN_QUICK_CATEGORY_PRODUCTS","CAROUSEL_SCROLL_DURATION","CAROUSEL_AUTO_INTERVAL","CAROUSEL_AUTO_STEP_FRACTION","smoothScrollTo","targetLeft","dist","easeInOutCubic","eased","HERO_REVEAL_DELAY","ModernHero","onExplore","quickCategories","onQuickCategory","onHeroSearch","onHeroQuickView","heroVariant","setHeroVariant","storageKey","existing","assigned","heroCopy","statCardStyles","HERO_BG_IMAGE","mains","subcats","allItems","byName","quickCategoryItems","categoryCarouselRef","categoryCarouselPaused","setCategoryCarouselPaused","getCategoryScrollStep","container","gap","maxScroll","scrollCategoryCarousel","target","img","gradient","InteractiveCTA","onGetStarted","SimilarProducts","maxResults","similarProducts","setSimilarProducts","setIsLoading","aiReason","setAiReason","findBasicSimilar","findSimilarProducts","localSimilar","productContext","prompt","generateText","__vitePreload","combined","handleLike","handleDislike","RecentlyViewed","maxItems","recentProducts","setRecentProducts","recent","handleStorageChange","ProductComparison","comparisonList","onRemove","onAddMore","ArrowLeftRight","useComparison","setComparisonList","addToComparison","removeFromComparison","AdvancedFiltersPanel","onApply","showHeader","onCloseHeader","min","max","cap","effective","previousFiltersRef","hasRestorableFilters","setHasRestorableFilters","handlePriceChange","toggleCategory","clearFilters","restorePrevious","DollarSign","AdvancedFilters","initialFilters","materials","activeFilterCount","panelContent","applyFilters","QuickAddToCart","onAdd","isAdding","setIsAdding","showSuccess","setShowSuccess","handleQuickAdd","Loader2","Check","ProductQuickPeek","activeImage","setActiveImage","images","imageProps","Share2","ExternalLink","SmartNewsletterPopup","onSubscribe","isSubmitted","setIsSubmitted","setEmail","setError","timeOnSiteRef","scrollTriggeredRef","exitIntentRef","dismissed","subscribed","handleMouseLeave","CheckCircle","ExitIntentPopup","discountPercent","hasShown","setHasShown","countdown","setCountdown","hasShownRef","inactivityTimer","resetTimer","formatTime","seconds","mins","secs","Timer","ARProductPreview","isARAvailable","setIsARAvailable","checkARSupport","isSupported","isIOSSafari","ua","isIOS","isSafari","handleARLaunch","usdzUrl","generateMockUSDZ","anchor","launchWebXR","sessionEndHandlerRef","session","handler","openInARViewer","Smartphone","CompleteTheLook","onViewProduct","bundleItems","setBundleItems","selectedItems","setSelectedItems","bundleTitle","setBundleTitle","findComplementaryProducts","complementaryMap","searchTerms","complements","currentPrice","pCat","term","fallbackProducts","toggleItem","selectedProducts","bundleOriginalPrice","bundleDiscount","bundleFinalPrice","savedAmount","handleAddBundle","isSelected","ImageGallery","currentIndex","setCurrentIndex","isZoomed","setIsZoomed","isFullscreen","setIsFullscreen","zoomPosition","setZoomPosition","touchStart","setTouchStart","mainImageRef","imageList","currentImage","goToNext","goToPrev","handleMouseMove","toggleZoom","touchEnd","ZoomIn","Maximize2","StickyAddToCart","observedElementId","isShownObserved","setIsShownObserved","addedToCart","setAddedToCart","setQuantity","scrollPast400","isShown","originalPrice","stockLevel","isLowStock","handleAddToCart","AlertTriangle","Shield","PriceAlert","targetPrice","setTargetPrice","isAlertSet","setIsAlertSet","suggestedPrice","alertData","removeAlert","BellRing","PriceAlertModal","onSubmit","TrendingDown","FadeInOnScroll","prefersReducedMotion","setPrefersReducedMotion","mq","getTransform","visible","Confetti","onComplete","particles","setParticles","newParticles","timeout","animationFrame","prefix","setHasStarted","timestamp","easeOut","BottomSheet","snapPoints","initialSnap","showHandle","showClose","currentSnap","setCurrentSnap","isDragging","setIsDragging","dragOffset","setDragOffset","touchStartY","setTouchStartY","sheetRef","contentRef","getSheetHeight","handleTouchMove","WishlistDrawer","wishlistItems","onClearAll","isClosing","setIsClosing","totalValue","handleShare","Trash2","FLASH_DISMISS_KEY","getTodayKey","FLASH_OFFERS","FlashSaleBanner","endTime","subtitle","onViewSale","onDismiss","timeLeft","setTimeLeft","calculateTimeLeft","offerIndex","setOfferIndex","isPaused","setIsPaused","currentOffer","displayTitle","displaySubtitle","displayCta","displayCtaShort","bgGradient","ctaColor","isDismissed","setIsDismissed","isExpired","setIsExpired","newTime","offerTimer","goToOffer","endX","handlePrev","handleNext","handleDismiss","pad","TOTAL_SALE_MS","remainingMs","timeLeftProgress","unit","DeliveryEstimator","postalCode","setPostalCode","isChecking","setIsChecking","deliveryInfo","setDeliveryInfo","calculateDelivery","code","isBudapest","isLargeCity","standardDays","expressDays","standardDate","expressDate","formatDate","date","days","months","defaultEstimate","minDate","maxDate","StockUrgency","viewingCount","setViewingCount","setRecentPurchases","lastPurchaseTime","setLastPurchaseTime","minutes","viewInterval","purchaseInterval","isVeryLowStock","isOutOfStock","ProductShare","showModal","setShowModal","copied","setCopied","shareUrl","shareTitle","shareText","handleNativeShare","handleCopyLink","shareLinks","ShareModal","link","Link2","onCopy","Copy","ProductTabs","expandedFaq","setExpandedFaq","tabs","FileText","Ruler","HelpCircle","specs","reviews","avgRating","r","faqItems","feature","spec","star","rating","review","PriceHistory","priceHistory","onSetAlert","alertSet","setAlertSet","validPrice","basePrice","month","variance","avg","previousPrice","priceChange","changePercent","isLowest","isHighest","chartHeight","chartWidth","chartPath","range","areaPath","handleSetAlert","getTrendIcon","Minus","getTrendColor","OneClickCheckout","savedAddress","savedPayment","userEmail","onCheckout","isProcessing","setIsProcessing","selectedPayment","setSelectedPayment","setStep","paymentMethods","CreditCard","Apple","handleCheckout","method","Lock","highlightMatch","re","parts","SmartSearchBar","indexVersion","shouldBuildIndex","maxLocalIndex","serverSearchMode","placeholder","selectedIndex","setSelectedIndex","indexStatus","setIndexStatus","serverPreview","setServerPreview","inputRef","containerRef","debounceTimerRef","resultsRef","indexedCountRef","indexedVersionRef","serverRequestIdRef","canUseLocalIndex","localIndexDisabled","doBuild","requestId","autocompleteSuggestions","searchResults","searchIntent","proactiveSuggestions","recentSearches","recentlyViewed","trendingSearches","viewedCategories","defaults","handleGlobalKeyDown","handleFocusSearch","handleInputChange","handleProductClickFn","full","handleSuggestionClick","suggestion","handleAutocompleteClickFn","clearQuery","handleProductClick","handleAutocompleteClick","allNavigableItems","sug","totalItems","selected","renderIntentTags","tags","priceLabel","ArrowUpRight","actualIndex","History","search","ARMeasure","onConfirmFit","roomDimensions","setRoomDimensions","fitResult","setFitResult","productDimensions","handleDimensionChange","field","numValue","handleCheckFit","roomW","roomL","roomH","fitsWidth","fitsDepth","fitsHeight","spaceFit","tightFit","resetMeasurement","isFormValid","StickyAddToCartMobile","isInWishlist","isInCart","freeShippingThreshold","showQuantity","setShowQuantity","justAdded","setJustAdded","totalPrice","freeShippingRemaining","incrementQuantity","decrementQuantity","TrustBadges","Headphones","checkoutBadges","useLocalStorage","initialValue","storedValue","setStoredValue","valueToStore","useDebounce","debouncedValue","setDebouncedValue","DEFAULT_ROOT_MARGIN","DEFAULT_THRESHOLD","useDeferredSection","rootMargin","shouldMount","setShouldMount","io","DeferredSection","minHeight","rest","WEBSHOP_DOMAIN","SHOP_ID","DISPLAY_BATCH","INITIAL_PAGE","TAB_HASH","HASH_TO_TAB","AIChatAssistant","AIRoomDesigner","AIStyleQuiz","AIModuleUnified","InspirationSection","ProductWorldsSection","NewsletterStrip","PersonalizedSection","LoyaltyProgram","MODAL_LOADING_FALLBACK","SCROLL_DELAY_INITIAL","SCROLL_DELAY_RETRY","SCROLL_DELAY_FINAL","SCROLL_THROTTLE_MS","SCROLL_RETRY_MAX","cleanUrl","Features","ProductModal","aiTip","setAiTip","loadingTip","setLoadingTip","generateStyleTip","param","VisualSearch","selectedImage","setSelectedImage","isAnalyzing","setIsAnalyzing","setSearchResults","analysisText","setAnalysisText","handleImageUpload","file","reader","analyzeImage","base64Image","base64Data","analyzeImageAI","analysis","relevant","RoomPlanner","background","setBackground","placedItems","setPlacedItems","selectedItemId","setSelectedItemId","handleBackgroundUpload","addItem","App","setActiveTabState","hash","newHash","setProducts","totalProductsCount","setTotalProductsCount","hasMoreProducts","setHasMoreProducts","isLoadingMore","setIsLoadingMore","filteredLengthRef","hasMoreProductsRef","isLoadingMoreRef","setWishlist","setWishlistItems","sectionRotateTick","setSectionRotateTick","searchQuery","setSearchQuery","searchQueryRef","SERVER_SEARCH_ONLY","MAX_LOCAL_INDEX","searchIndexRef","searchIndexReady","setSearchIndexReady","searchIndexVersion","setSearchIndexVersion","searchTotalMatches","setSearchTotalMatches","categoryFilter","setCategoryFilter","isDemoMode","setIsDemoMode","selectedProduct","setSelectedProduct","isChatOpen","setIsChatOpen","showAIOnboarding","setShowAIOnboarding","onboardingFeature","setOnboardingFeature","advancedFilters","setAdvancedFilters","setCategoryHierarchy","categoryStats","setCategoryStats","selectedCollection","setSelectedCollection","activeHierarchyCount","getCategoryMainList","showStyleQuiz","setShowStyleQuiz","showRoomDesigner","setShowRoomDesigner","aiRecommendedProducts","setAiRecommendedProducts","aiRecommendationLabel","setAiRecommendationLabel","showDeferredAI","setShowDeferredAI","quickPeekProduct","setQuickPeekProduct","showARPreview","setShowARPreview","arProduct","setArProduct","showARMeasure","setShowARMeasure","arMeasureProduct","setArMeasureProduct","showOneClickCheckout","setShowOneClickCheckout","oneClickProduct","setOneClickProduct","showConfetti","setShowConfetti","showFilterSheet","setShowFilterSheet","showExitIntent","setShowExitIntent","showWishlistDrawer","setShowWishlistDrawer","featuredPool","setFeaturedPool","featuredPoolKeyRef","flashSaleEndTime","isLoadingUnas","setIsLoadingUnas","unasError","setUnasError","lastUpdated","setLastUpdated","dataSource","setDataSource","comparison","handleProductView","trackProductViewPref","handleShowAIProducts","firstArg","secondArg","recommendedProducts","label","clickedProduct","allRecommended","clickedCat","sameCategory","clickedPrice","similarPrice","scheduleScrollToProductsRef","clearAIRecommendations","toggleWishlist","productUrl","fullUrl","serverSearchQuery","setServerSearchQuery","serverCategory","setServerCategory","loadUnasData","silent","categoryMain","append","categoryMainList","categoriesList","newProducts","requestScrollToProductsRef","handleServerSearch","hasUserSearchedRef","useLayoutEffect","scrollToHeader","t1","t2","isScrollable","insideApp","lastScrollToProductsRef","scrollToProductsSection","retryCount","run","elRect","parentRect","targetScrollTop","scrollToProductsSectionRef","scheduleScrollToProducts","handleCategoryChange","handleCollectionSelect","handleCollectionBack","loadUnasDataRef","canUseLocalSearch","debouncedSearch","cats","mainNames","leafNames","mainSegments","styleKw","deferProductsLoadRef","useApiSearch","isInitialState","shouldDefer","onHashChange","totalMatches","extraTimeoutId","mergeInto","map","extraOffsets","o","batches","normalizedAdvancedFilters","mobileActiveFilterCount","filteredAndSortedProducts","collectionFilteredProducts","lower","isSearchMode","isSearchActive","sectionProducts","sectionContextLabel","featuredBase","headerCount","handleLoadMore","handleCollectionLoadMore","total","categoryCount","sorted","recentPurchasesForSocialProof","Suspense","meta","col","reward","catMain","recs","ErrorBoundary","errorInfo","Fallback","NAV_TO_PRODUCTS_WINDOW_MS","shouldSkipScrollToHeader","handleLoad","handlePageshow","rootEl","ReactDOM"],"ignoreList":[0,1,2],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/services/unasApi.js","../../src/services/unasCartService.js","../../src/services/userPreferencesService.js","../../src/components/ui/Skeleton.jsx","../../src/components/ui/Toast.jsx","../../src/components/ui/EmptyState.jsx","../../src/components/ui/Badge.jsx","../../src/components/ui/Icons.jsx","../../src/components/ai/AIShowcase.jsx","../../src/components/category/CategorySwipe.jsx","../../src/utils/helpers.js","../../src/utils/imageOptimizer.js","../../src/components/product/EnhancedProductCard.jsx","../../src/components/category/CategoryPage.jsx","../../src/components/collection/CollectionPage.jsx","../../src/components/category/MainCategoriesSection.jsx","../../src/hooks/useScrollPosition.js","../../src/hooks/useScrollLock.js","../../src/components/layout/Navbar.jsx","../../src/components/ux/ScrollProgress.jsx","../../src/components/ux/BackToTop.jsx","../../src/utils/motion-shim.jsx","../../src/components/ux/LiveSocialProof.jsx","../../src/components/ux/LiveActivityStrip.jsx","../../src/components/ui/CountUp.jsx","../../src/services/aiSearchService.js","../../src/components/landing/HeroSmartSearch.jsx","../../src/utils/categoryImages.js","../../src/components/landing/ModernHero.jsx","../../src/components/landing/ShowcaseSections.jsx","../../src/components/product/SimilarProducts.jsx","../../src/components/product/RecentlyViewed.jsx","../../src/components/product/ProductComparison.jsx","../../src/components/product/AdvancedFilters.jsx","../../src/components/product/QuickAddToCart.jsx","../../src/components/product/ProductQuickPeek.jsx","../../src/components/marketing/SmartNewsletterPopup.jsx","../../src/components/marketing/ExitIntentPopup.jsx","../../src/components/ar/ARProductPreview.jsx","../../src/components/product/CompleteTheLook.jsx","../../src/components/product/ImageGallery.jsx","../../src/components/product/StickyAddToCart.jsx","../../src/components/product/PriceAlert.jsx","../../src/components/ui/Animations.jsx","../../src/components/mobile/BottomSheet.jsx","../../src/components/wishlist/WishlistDrawer.jsx","../../src/components/marketing/FlashSaleBanner.jsx","../../src/components/product/DeliveryEstimator.jsx","../../src/components/product/StockUrgency.jsx","../../src/components/product/ProductShare.jsx","../../src/components/product/ProductTabs.jsx","../../src/components/product/PriceHistory.jsx","../../src/components/checkout/OneClickCheckout.jsx","../../src/components/search/SmartSearchBar.jsx","../../src/components/ar/ARMeasure.jsx","../../src/components/mobile/StickyAddToCartMobile.jsx","../../src/components/trust/TrustBadges.jsx","../../src/hooks/index.js","../../src/hooks/useDeferredSection.jsx","../../src/config.js","../../src/App.jsx","../../src/components/ui/ErrorBoundary.jsx","../../src/main.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * UNAS API Service\n * API-first, kis lapmret: soha ne tltsnk 200k termket memriba.\n * Cl: 3 mp alatt interaktv, alacsony memria.\n */\n\nconst getApiBase = () => {\n  let base = '';\n  if (typeof window !== 'undefined' && window.MARKETLY_CONFIG?.apiBase) {\n    base = window.MARKETLY_CONFIG.apiBase;\n  } else {\n    base = import.meta.env.VITE_API_URL || 'http://localhost:3002';\n  }\n  base = (base || '').replace(/\\/+$/, '');\n  if (base && !base.endsWith('/api')) base = base + '/api';\n  return base;\n};\n\nconst getBackendOrigin = () => {\n  const api = getApiBase();\n  return api ? api.replace(/\\/api\\/?$/, '') : '';\n};\n\n/** Els lap mrete (gyors first paint) */\nconst DEFAULT_LIMIT = 200;\n\n/**\n * Termkek betltse  MINDIG API, limit/offset.\n * Nincs teljes katalgus a kliensen; lapozs s keress szerveren.\n */\nexport const fetchUnasProducts = async (filters = {}) => {\n  if (typeof window === 'undefined') return { products: [], total: 0, count: 0, lastSync: null, source: 'api' };\n\n  const limit = filters.limit != null ? Number(filters.limit) : DEFAULT_LIMIT;\n  const offset = filters.offset != null ? Number(filters.offset) : 0;\n\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    params.set('limit', String(limit));\n    params.set('offset', String(offset));\n    if (filters.slim !== undefined) {\n      params.set('slim', filters.slim ? 'true' : 'false');\n    }\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categories && Array.isArray(filters.categories) && filters.categories.length > 0) {\n      params.set('categories', filters.categories.filter(Boolean).join(','));\n    } else if (filters.categories && typeof filters.categories === 'string' && filters.categories.trim()) {\n      params.set('categories', filters.categories.trim());\n    }\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.styleKeywords && Array.isArray(filters.styleKeywords) && filters.styleKeywords.length > 0) {\n      params.set('styleKeywords', filters.styleKeywords.filter(Boolean).join(','));\n    }\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n\n    const url = `${API_BASE}/products?${params.toString()}`;\n    const res = await fetch(url, { method: 'GET' });\n\n    if (!res.ok) {\n      return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: res.status };\n    }\n\n    const data = await res.json();\n    const products = (data.products || []).map(p => ({\n      ...p,\n      images: p.images || (p.image ? [p.image] : []),\n      image: p.images?.[0] || p.image,\n      inStock: p.inStock !== undefined ? p.inStock : Boolean(p.in_stock)\n    }));\n\n    return {\n      products,\n      total: data.total ?? products.length,\n      count: products.length,\n      lastSync: data.lastSync ?? null,\n      source: 'api'\n    };\n  } catch (error) {\n    return { products: [], total: 0, count: 0, lastSync: null, source: 'api', error: error.message };\n  }\n};\n\n/**\n * Fetch categories from backend\n */\nexport const fetchCategories = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories`);\n    if (!res.ok) return ['sszes'];\n    const data = await res.json();\n    // Backend returns category objects, extract just the names\n    const categoryNames = (data.categories || [])\n      .map(cat => typeof cat === 'string' ? cat : cat.name)\n      .filter(Boolean)\n      .sort();\n    return ['sszes', ...categoryNames];\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    return ['sszes'];\n  }\n};\n\n/**\n * Keresindex: minden termk minimlis adattal (gyors, gzip-pel kisebb).\n * A keres ezen fut; frissts = jra letlti (kszlet napraksz).\n */\nexport const fetchSearchIndex = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/products/search-index`);\n    if (!res.ok) return { products: [], lastSync: null };\n    const data = await res.json();\n    if (Array.isArray(data)) return { products: data, lastSync: null };\n    return {\n      products: Array.isArray(data.products) ? data.products : [],\n      lastSync: data.lastSync || null\n    };\n  } catch (error) {\n    return { products: [], lastSync: null };\n  }\n};\n\n/**\n * Fetch category hierarchy (main + children) for navbar/mobile menu\n * Returns { mainCategories: [ { name, productCount, children: [ { name, productCount } ] } ] }\n */\nexport const fetchCategoryHierarchy = async () => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/categories/hierarchy`);\n    if (!res.ok) return { mainCategories: [] };\n    const data = await res.json();\n    return { mainCategories: Array.isArray(data.mainCategories) ? data.mainCategories : [] };\n  } catch (error) {\n    console.error('Error fetching category hierarchy:', error);\n    return { mainCategories: [] };\n  }\n};\n\n/**\n * Fetch single product by ID (full detail)\n */\nexport const fetchUnasProductById = async (id) => {\n  try {\n    const API_BASE = getApiBase();\n    const res = await fetch(`${API_BASE}/products/${id}`);\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      ...data,\n      images: data.images || (data.image ? [data.image] : []),\n      image: data.images?.[0] || data.image,\n      inStock: data.inStock !== undefined ? data.inStock : Boolean(data.in_stock)\n    };\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Product stats (counts + price range + in stock)\n */\nexport const fetchProductStats = async (filters = {}) => {\n  try {\n    const API_BASE = getApiBase();\n    const params = new URLSearchParams();\n    if (filters.category && filters.category !== 'sszes') params.set('category', filters.category);\n    if (filters.categoryMain) {\n      const mainValue = Array.isArray(filters.categoryMain) ? filters.categoryMain.join(',') : filters.categoryMain;\n      params.set('categoryMain', mainValue);\n    }\n    if (filters.search && String(filters.search).trim()) params.set('search', String(filters.search).trim());\n    const res = await fetch(`${API_BASE}/products/stats?${params.toString()}`);\n    if (!res.ok) return null;\n    return await res.json();\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Force refresh products from UNAS (trigger sync)\n */\nexport const refreshUnasProducts = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.message || `HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return {\n      success: data.success,\n      fetched: data.fetched,\n      added: data.added,\n      updated: data.updated\n    };\n  } catch (error) {\n    console.error('Error refreshing UNAS products:', error);\n    throw new Error(`Failed to refresh products: ${error.message}`);\n  }\n};\n\n/**\n * Get cache information from backend\n */\nexport const getCacheInfo = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /stats, not /api/stats\n    const response = await fetch(`${API_BASE}/stats`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching stats:', error);\n    throw new Error(`Failed to fetch stats: ${error.message}`);\n  }\n};\n\n/**\n * Clear backend cache (trigger manual sync)\n */\nexport const clearCache = async () => {\n  try {\n    const API_BASE = getApiBase();\n    // API_BASE already includes /api, so we need /admin/sync, not /api/admin/sync\n    const response = await fetch(`${API_BASE}/admin/sync`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error('Error triggering sync:', error);\n    throw new Error(`Failed to trigger sync: ${error.message}`);\n  }\n};\n\n/**\n * Backend health (GET /health a gykrn, nem /api alatt)\n */\nexport const checkBackendHealth = async () => {\n  try {\n    const origin = getBackendOrigin();\n    const response = await fetch(`${origin}/health`, { method: 'GET' });\n    if (!response.ok) return { status: 'error', message: `HTTP ${response.status}` };\n    return await response.json();\n  } catch (error) {\n    return { status: 'error', message: error.message };\n  }\n};\n","/**\n * UNAS Cart Service  kosrhoz ads (cart_add)\n * A widget UNAS oldalon fut, a termkek a f UNAS kosrba kerlnek.\n *\n * cart_add(productId, prefix, null, quantity)  termk oldalon 4 paramter\n * A cart_add a mennyisg inputot keresi: id=\"db_{prefix}{productId}\" vagy id=\"db_{productId}\"\n */\n\n/** Kategria/kollekci oldalon az UNAS artlist_ prefixet vrja (db_artlist_{productId}) */\nfunction getCartAddPrefix() {\n  if (typeof window === 'undefined') return '';\n  try {\n    const path = (window.location?.pathname || '') + (window.top?.location?.pathname || '');\n    if (/\\/sct\\//.test(path)) return 'artlist_';\n  } catch (_) { /* cross-origin */ }\n  return '';\n}\n\n/** Kinyeri a VX-XXXXX formtum SKU-t linkbl vagy kpek URL-jbl (UNAS variant ref) */\nfunction extractVxSku(product) {\n  const link = (product?.link || product?.url || '').trim();\n  const m1 = link.match(/(VX-\\d+)/i);\n  if (m1) return m1[1];\n  const imgs = product?.images || (product?.image ? [product.image] : []);\n  const firstImg = Array.isArray(imgs) ? imgs[0] : imgs;\n  const imgUrl = typeof firstImg === 'string' ? firstImg : firstImg?.url || firstImg?.src || '';\n  const m2 = String(imgUrl).match(/(VX-\\d+)/i);\n  if (m2) return m2[1];\n  return null;\n}\n\n/**\n * UNAS termk ID formtum: VX__unas__{id}\n * Az UNAS add_to_favourites: cikk.replace(/-/g,'__unas__')  pl. VX-274769  VX__unas__274769\n * Preferlja: unas_ref (VX-xxx), sku, link/kpbl kinyert VX-xxx, unas_id, id.\n */\nfunction toUnasProductId(product) {\n  if (!product) return null;\n  // 1) unas_ref / sku  gyakran VX-274769 formtum\n  let raw = product?.unas_ref ?? product?.sku ?? extractVxSku(product);\n  if (raw) {\n    const s = String(raw).trim();\n    if (s && !s.startsWith('unas-prod-')) {\n      if (s.includes('-')) return s.replace(/-/g, '__unas__');\n      if (s.startsWith('VX__unas__')) return s;\n      return `VX__unas__${s}`;\n    }\n  }\n  // 2) unas_id / id  numerikus\n  const id = product?.unas_id ?? product?.id;\n  if (!id) return null;\n  const str = String(id).trim();\n  if (str.startsWith('unas-prod-') || str === '') return null;\n  if (str.startsWith('VX__unas__')) return str;\n  return `VX__unas__${str}`;\n}\n\n/**\n * cart_add s a hozz tartoz window  lehet iframe-ben, parent vagy top window-ban.\n * Fontos: az inputot UGYANABBA a documentba kell tenni, ahol a cart_add fut (pl. parent),\n * mert a cart_add document.getElementById()-ot hasznl a sajt documentjn.\n */\nfunction getCartAddContext() {\n  if (typeof window === 'undefined') return null;\n  const wins = [window, window.parent, window.top].filter(Boolean);\n  for (const w of wins) {\n    try {\n      if (typeof w.cart_add === 'function') return { cartAdd: w.cart_add, win: w };\n    } catch (_) { /* cross-origin */ }\n  }\n  return null;\n}\n\nfunction getCartAdd() {\n  const ctx = getCartAddContext();\n  return ctx ? ctx.cartAdd : null;\n}\n\n/**\n * UNAS form keresse  kosr/termk form, ahova az input kerlhet\n */\nfunction findUnasForm(doc) {\n  if (!doc) return null;\n  const selectors = [\n    'form[action*=\"cart\"]',\n    'form[id*=\"cart\"]',\n    'form[name*=\"cart\"]',\n    'form[action*=\"kosar\"]',\n    'form#product_form',\n    'form.product-form'\n  ];\n  for (const sel of selectors) {\n    try {\n      const form = doc.querySelector(sel);\n      if (form) return form;\n    } catch (_) { /* invalid selector */ }\n  }\n  return null;\n}\n\n/**\n * Mennyisg input ltrehozsa  a cart_add UGYANABBAN a documentban keresi!\n * Ha iframe-ben futunk, a cart_add a parent/top-ban van  az inputot is oda kell tenni.\n * Ltrehozunk db_{unasId} s db_{numericId} inputot is  UNAS klnbz sablonokban eltr formtumot vr.\n */\nfunction ensureQtyInput(unasId, qty, targetDoc) {\n  if (!targetDoc) return null;\n  const numericId = unasId.replace(/^VX__unas__/, '');\n  const ids = [`db_${unasId}`];\n  if (numericId && numericId !== unasId) ids.push(`db_${numericId}`);\n  let input = null;\n  for (const inputId of ids) {\n    input = targetDoc.getElementById(inputId);\n    if (input) break;\n  }\n  if (!input) {\n    input = targetDoc.createElement('input');\n    input.type = 'number';\n    input.name = 'db';\n    input.id = ids[0];\n    input.value = String(qty);\n    input.setAttribute('data-min', '1');\n    input.setAttribute('data-max', '999999');\n    input.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n    const form = findUnasForm(targetDoc);\n    (form || targetDoc.body).appendChild(input);\n    // Fallback: numeric id input (ha UNAS ezt keresi)\n    if (ids.length > 1) {\n      const input2 = targetDoc.createElement('input');\n      input2.type = 'number';\n      input2.name = 'db';\n      input2.id = ids[1];\n      input2.value = String(qty);\n      input2.setAttribute('data-min', '1');\n      input2.setAttribute('data-max', '999999');\n      input2.style.cssText = 'position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;';\n      (form || targetDoc.body).appendChild(input2);\n    }\n  } else {\n    for (const id of ids) {\n      const el = targetDoc.getElementById(id);\n      if (el) el.value = String(qty);\n    }\n  }\n  return input;\n}\n\n/**\n * Kosrhoz ads az UNAS kosrba (ha window.cart_add elrhet).\n * @param {object} product - termk objektum (id, unas_id)\n * @param {number} quantity - mennyisg\n * @returns {boolean} - true ha sikeres, false ha nem elrhet vagy hiba\n */\nexport function addToUnasCart(product, quantity = 1) {\n  if (typeof window === 'undefined') return false;\n  const ctx = getCartAddContext();\n  if (!ctx || typeof ctx.cartAdd !== 'function') return false;\n\n  const unasId = toUnasProductId(product);\n  if (!unasId) return false;\n\n  const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n  try {\n    // Mennyisg input  a cart_add UGYANABBAN a documentban keresi (pl. parent/top)\n    let targetDoc;\n    try {\n      targetDoc = ctx.win.document;\n    } catch (_) {\n      targetDoc = typeof document !== 'undefined' ? document : null;\n    }\n    if (!targetDoc) return false;\n    ensureQtyInput(unasId, qty, targetDoc);\n    // 4 paramter: productId, prefix ('' = termk oldal), null, quantity\n    ctx.cartAdd(unasId, getCartAddPrefix(), null, qty);\n    if (window.__MARKETLY_DEBUG) {\n      console.log('[unasCartService] cart_add called:', { unasId, qty }, ` cart_add('${unasId}','',null,${qty})`);\n    }\n    return true;\n  } catch (err) {\n    if (window.__MARKETLY_DEBUG || process.env.NODE_ENV === 'development') {\n      console.warn('[unasCartService] cart_add error:', err);\n    }\n    return false;\n  }\n}\n","/**\n * User Preferences Service\n * Kzponti szolgltats a felhasznli viselkeds s preferencik kvetsre\n * localStorage-ban trolja az adatokat\n */\n\nconst STORAGE_KEYS = {\n  VIEWED_PRODUCTS: 'mkt_viewed_products',\n  LIKED_PRODUCTS: 'mkt_liked_products',\n  DISLIKED_PRODUCTS: 'mkt_disliked_products',\n  SEARCH_HISTORY: 'mkt_search_history',\n  STYLE_DNA: 'mkt_style_dna',\n  AI_FEEDBACK: 'mkt_ai_feedback',\n  CHAT_CONTEXT: 'mkt_chat_context',\n  USER_PREFERENCES: 'mkt_user_preferences',\n  RECO_TWEAKS: 'mkt_reco_tweaks',\n  RECO_WEIGHTS: 'mkt_reco_weights',\n  RECO_SIGNALS: 'mkt_reco_signals',\n  AB_TESTS: 'mkt_ab_tests',\n  BACK_IN_STOCK: 'mkt_back_in_stock',\n  SECTION_EVENTS: 'mkt_section_events',\n};\n\nconst MAX_ITEMS = {\n  VIEWED: 50,\n  LIKED: 100,\n  SEARCHES: 20,\n  FEEDBACK: 100,\n};\n\nconst MAX_BACK_IN_STOCK = 100;\n\nconst DEFAULT_RECO_TWEAKS = {\n  avoidStyles: [],\n  avoidRooms: [],\n};\n\nconst DEFAULT_RECO_WEIGHTS = {\n  likeBoost: 20,\n  viewPenalty: 8,\n  dislikePenalty: 50,\n  categoryBoost: 20,\n  styleBoost: 12,\n  roomBoost: 10,\n  stockBoost: 6,\n  priceFit: 8,\n  signalCategoryBoost: 4,\n  signalKeywordBoost: 2,\n};\n\nconst getJSONSafe = (key, fallback) => {\n  try {\n    const raw = localStorage.getItem(key);\n    return raw ? JSON.parse(raw) : fallback;\n  } catch {\n    return fallback;\n  }\n};\n\n// ==================== VIEWED PRODUCTS ====================\n\n/**\n * Termk megtekintsnek rgztse\n */\nexport function trackProductView(product) {\n  if (!product?.id) return;\n  \n  const viewed = getViewedProducts();\n  \n  // Eltvoltjuk ha mr volt, s az elejre tesszk\n  const filtered = viewed.filter(p => p.id !== product.id);\n  \n  const productData = {\n    id: product.id,\n    name: product.name,\n    price: product.salePrice || product.price,\n    category: product.category,\n    image: product.images?.[0] || product.image,\n    viewedAt: Date.now(),\n  };\n  \n  const updated = [productData, ...filtered].slice(0, MAX_ITEMS.VIEWED);\n  \n  try {\n    localStorage.setItem(STORAGE_KEYS.VIEWED_PRODUCTS, JSON.stringify(updated));\n  } catch (e) {\n    console.warn('Failed to save viewed products:', e);\n  }\n  \n  // Preferencik frisstse a kategria alapjn\n  updateCategoryPreference(product.category);\n}\n\n/**\n * Megtekintett termkek lekrdezse\n */\nexport function getViewedProducts(limit = 20) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.VIEWED_PRODUCTS);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * Legutbbi megtekintett termk ID-k\n */\nexport function getRecentlyViewedIds(limit = 10) {\n  return getViewedProducts(limit).map(p => p.id);\n}\n\n// ==================== LIKED/DISLIKED PRODUCTS ====================\n\n/**\n * Termk kedvelse\n */\nexport function likeProduct(productId) {\n  if (!productId) return;\n  \n  const liked = getLikedProducts();\n  if (!liked.includes(productId)) {\n    const updated = [productId, ...liked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a disliked-bl\n  const disliked = getDislikedProducts();\n  if (disliked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.DISLIKED_PRODUCTS, \n      JSON.stringify(disliked.filter(id => id !== productId))\n    );\n  }\n}\n\n/**\n * Termk elutastsa\n */\nexport function dislikeProduct(productId) {\n  if (!productId) return;\n  \n  const disliked = getDislikedProducts();\n  if (!disliked.includes(productId)) {\n    const updated = [productId, ...disliked].slice(0, MAX_ITEMS.LIKED);\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(updated));\n  }\n  \n  // Eltvolts a liked-bl\n  const liked = getLikedProducts();\n  if (liked.includes(productId)) {\n    localStorage.setItem(\n      STORAGE_KEYS.LIKED_PRODUCTS, \n      JSON.stringify(liked.filter(id => id !== productId))\n    );\n  }\n}\n\nconst SIGNAL_LIMITS = { min: -6, max: 12 };\n\nconst stopWords = new Set([\n  's', 'vagy', 'hogy', 'egy', 'egyik', 'mely', 'ami', 'az', 'a', 'de', 'is',\n  'val', 'valamint', 's', 's', 'the', 'for', 'with'\n]);\n\nconst clampSignal = (value) => Math.max(SIGNAL_LIMITS.min, Math.min(SIGNAL_LIMITS.max, value));\n\nconst extractSignalTokens = (product) => {\n  const categories = String(product?.category || '')\n    .split('>')\n    .map((c) => c.trim().toLowerCase())\n    .filter(Boolean);\n  const text = `${product?.name || ''} ${product?.category || ''}`.toLowerCase();\n  const keywords = text\n    .split(/[\\s,\\-\\/]+/)\n    .map((w) => w.trim())\n    .filter((w) => w.length > 3 && !stopWords.has(w))\n    .slice(0, 12);\n  return { categories, keywords };\n};\n\nexport function getPreferenceSignals() {\n  return getJSONSafe(STORAGE_KEYS.RECO_SIGNALS, { categories: {}, keywords: {} });\n}\n\nconst savePreferenceSignals = (signals) => {\n  try {\n    localStorage.setItem(STORAGE_KEYS.RECO_SIGNALS, JSON.stringify(signals));\n  } catch {}\n};\n\nconst updatePreferenceSignals = (product, delta) => {\n  if (!product?.id) return;\n  const signals = getPreferenceSignals();\n  const { categories, keywords } = extractSignalTokens(product);\n  categories.forEach((cat) => {\n    const next = clampSignal((signals.categories?.[cat] || 0) + delta);\n    signals.categories = signals.categories || {};\n    signals.categories[cat] = next;\n  });\n  keywords.forEach((kw) => {\n    const next = clampSignal((signals.keywords?.[kw] || 0) + delta);\n    signals.keywords = signals.keywords || {};\n    signals.keywords[kw] = next;\n  });\n  savePreferenceSignals(signals);\n};\n\nexport function likeProductWithSignals(product) {\n  if (!product?.id) return;\n  likeProduct(product.id);\n  updatePreferenceSignals(product, 2);\n}\n\nexport function dislikeProductWithSignals(product) {\n  if (!product?.id) return;\n  dislikeProduct(product.id);\n  updatePreferenceSignals(product, -3);\n}\n\nexport function toggleLikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n    return { liked: false, disliked: false };\n  }\n\n  const nextLiked = [product.id, ...liked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(nextLiked));\n  updatePreferenceSignals(product, 2);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n  }\n  return { liked: true, disliked: false };\n}\n\nexport function toggleDislikeProduct(product) {\n  if (!product?.id) return { liked: false, disliked: false };\n  const liked = getLikedProducts();\n  const disliked = getDislikedProducts();\n  const isLiked = liked.includes(product.id);\n  const isDisliked = disliked.includes(product.id);\n\n  if (isDisliked) {\n    localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(disliked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, 3);\n    return { liked: false, disliked: false };\n  }\n\n  const nextDisliked = [product.id, ...disliked].slice(0, MAX_ITEMS.LIKED);\n  localStorage.setItem(STORAGE_KEYS.DISLIKED_PRODUCTS, JSON.stringify(nextDisliked));\n  updatePreferenceSignals(product, -3);\n\n  if (isLiked) {\n    localStorage.setItem(STORAGE_KEYS.LIKED_PRODUCTS, JSON.stringify(liked.filter(id => id !== product.id)));\n    updatePreferenceSignals(product, -2);\n  }\n  return { liked: false, disliked: true };\n}\n\nexport function getLikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.LIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function getDislikedProducts() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.DISLIKED_PRODUCTS);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\nexport function isProductLiked(productId) {\n  return getLikedProducts().includes(productId);\n}\n\nexport function isProductDisliked(productId) {\n  return getDislikedProducts().includes(productId);\n}\n\n// ==================== BACK IN STOCK REQUESTS ====================\n\nexport function requestBackInStock(product) {\n  if (!product?.id) return;\n  const list = getBackInStockRequests();\n  const filtered = list.filter((p) => p.id !== product.id);\n  const next = [\n    {\n      id: product.id,\n      name: product.name,\n      image: product.images?.[0] || product.image,\n      requestedAt: Date.now()\n    },\n    ...filtered\n  ].slice(0, MAX_BACK_IN_STOCK);\n  try {\n    localStorage.setItem(STORAGE_KEYS.BACK_IN_STOCK, JSON.stringify(next));\n  } catch (e) {\n    console.warn('Failed to save back-in-stock request:', e);\n  }\n}\n\nexport function getBackInStockRequests(limit = 50) {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEYS.BACK_IN_STOCK);\n    const list = raw ? JSON.parse(raw) : [];\n    return limit ? list.slice(0, limit) : list;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== SECTION EVENTS (CTR) ====================\n\nexport function trackSectionEvent(sectionId, type = 'impression', productId = null) {\n  if (!sectionId) return;\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  const entry = data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n  if (type === 'click') entry.clicks += 1;\n  else entry.impressions += 1;\n  entry.lastEventAt = Date.now();\n  if (productId) {\n    entry.products[productId] = (entry.products[productId] || 0) + 1;\n  }\n  data[sectionId] = entry;\n  try {\n    localStorage.setItem(STORAGE_KEYS.SECTION_EVENTS, JSON.stringify(data));\n  } catch {}\n}\n\nexport function getSectionStats(sectionId) {\n  const data = getJSONSafe(STORAGE_KEYS.SECTION_EVENTS, {});\n  return data[sectionId] || { impressions: 0, clicks: 0, lastEventAt: 0, products: {} };\n}\n\n// ==================== SEARCH HISTORY ====================\n\n/**\n * Keress rgztse\n */\nexport function trackSearch(query) {\n  if (!query || query.length < 2) return;\n  \n  const searches = getSearchHistory();\n  const filtered = searches.filter(s => s.query.toLowerCase() !== query.toLowerCase());\n  \n  const updated = [\n    { query, timestamp: Date.now() },\n    ...filtered\n  ].slice(0, MAX_ITEMS.SEARCHES);\n  \n  localStorage.setItem(STORAGE_KEYS.SEARCH_HISTORY, JSON.stringify(updated));\n}\n\nexport function getSearchHistory(limit = 10) {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.SEARCH_HISTORY);\n    const parsed = data ? JSON.parse(data) : [];\n    return limit ? parsed.slice(0, limit) : parsed;\n  } catch (e) {\n    return [];\n  }\n}\n\n// ==================== STYLE DNA (Quiz Results) ====================\n\n/**\n * Style DNA mentse a quiz eredmnybl\n */\nexport function saveStyleDNA(quizAnswers, styleDNAText) {\n  const data = {\n    answers: quizAnswers,\n    styleDNA: styleDNAText,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.STYLE_DNA, JSON.stringify(data));\n}\n\nexport function getStyleDNA() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.STYLE_DNA);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== AI FEEDBACK ====================\n\n/**\n * AI vlasz visszajelzsnek rgztse\n */\nexport function trackAIFeedback(messageId, isPositive, context = {}) {\n  const feedback = getAIFeedback();\n  \n  const updated = [\n    {\n      messageId,\n      isPositive,\n      context,\n      timestamp: Date.now(),\n    },\n    ...feedback\n  ].slice(0, MAX_ITEMS.FEEDBACK);\n  \n  localStorage.setItem(STORAGE_KEYS.AI_FEEDBACK, JSON.stringify(updated));\n}\n\nexport function getAIFeedback() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.AI_FEEDBACK);\n    return data ? JSON.parse(data) : [];\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * AI feedback statisztikk\n */\nexport function getAIFeedbackStats() {\n  const feedback = getAIFeedback();\n  const positive = feedback.filter(f => f.isPositive).length;\n  const negative = feedback.filter(f => !f.isPositive).length;\n  \n  return {\n    total: feedback.length,\n    positive,\n    negative,\n    satisfactionRate: feedback.length > 0 ? (positive / feedback.length * 100).toFixed(1) : 0,\n  };\n}\n\n// ==================== CHAT CONTEXT ====================\n\n/**\n * Chat kontextus mentse (elz beszlgetsek sszefoglalja)\n */\nexport function saveChatContext(summary) {\n  const context = {\n    summary,\n    savedAt: Date.now(),\n  };\n  \n  localStorage.setItem(STORAGE_KEYS.CHAT_CONTEXT, JSON.stringify(context));\n}\n\nexport function getChatContext() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.CHAT_CONTEXT);\n    return data ? JSON.parse(data) : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n// ==================== USER PREFERENCES ====================\n\n/**\n * Kategria preferencia frisstse\n */\nfunction updateCategoryPreference(category) {\n  if (!category) return;\n  \n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  categories[category] = (categories[category] || 0) + 1;\n  \n  prefs.categoryInterests = categories;\n  prefs.lastUpdated = Date.now();\n  \n  localStorage.setItem(STORAGE_KEYS.USER_PREFERENCES, JSON.stringify(prefs));\n}\n\nexport function getUserPreferences() {\n  try {\n    const data = localStorage.getItem(STORAGE_KEYS.USER_PREFERENCES);\n    return data ? JSON.parse(data) : { categoryInterests: {} };\n  } catch (e) {\n    return { categoryInterests: {} };\n  }\n}\n\nexport function getRecommendationTweaks() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_TWEAKS, DEFAULT_RECO_TWEAKS);\n  return { ...DEFAULT_RECO_TWEAKS, ...data };\n}\n\nexport function setRecommendationTweaks(next) {\n  const current = getRecommendationTweaks();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function resetRecommendationTweaks() {\n  localStorage.setItem(STORAGE_KEYS.RECO_TWEAKS, JSON.stringify(DEFAULT_RECO_TWEAKS));\n  return DEFAULT_RECO_TWEAKS;\n}\n\nexport function getRecommendationWeights() {\n  const data = getJSONSafe(STORAGE_KEYS.RECO_WEIGHTS, DEFAULT_RECO_WEIGHTS);\n  return { ...DEFAULT_RECO_WEIGHTS, ...data };\n}\n\nexport function setRecommendationWeights(next) {\n  const current = getRecommendationWeights();\n  const merged = { ...current, ...next };\n  localStorage.setItem(STORAGE_KEYS.RECO_WEIGHTS, JSON.stringify(merged));\n  return merged;\n}\n\nexport function getABVariant(testId) {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (tests[testId]?.variant) return tests[testId].variant;\n  const variant = Math.random() < 0.5 ? 'A' : 'B';\n  tests[testId] = { variant, impressions: 0, clicks: 0 };\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return variant;\n}\n\nexport function trackABEvent(testId, type = 'impression') {\n  const tests = getJSONSafe(STORAGE_KEYS.AB_TESTS, {});\n  if (!tests[testId]) {\n    tests[testId] = { variant: getABVariant(testId), impressions: 0, clicks: 0 };\n  }\n  if (type === 'click') tests[testId].clicks += 1;\n  else tests[testId].impressions += 1;\n  localStorage.setItem(STORAGE_KEYS.AB_TESTS, JSON.stringify(tests));\n  return tests[testId];\n}\n\n/**\n * Top kategrik a felhasznli rdeklds alapjn\n */\nexport function getTopCategories(limit = 5) {\n  const prefs = getUserPreferences();\n  const categories = prefs.categoryInterests || {};\n  \n  return Object.entries(categories)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, limit)\n    .map(([name]) => name);\n}\n\n// ==================== PERSONALIZED CONTEXT FOR AI ====================\n\n/**\n * Szemlyre szabott kontextus generlsa az AI szmra\n */\nexport function getPersonalizedContext() {\n  const viewedProducts = getViewedProducts(5);\n  const likedProducts = getLikedProducts();\n  const topCategories = getTopCategories(3);\n  const styleDNA = getStyleDNA();\n  const searchHistory = getSearchHistory(5);\n  \n  let context = '';\n  \n  if (styleDNA?.styleDNA) {\n    context += `A felhasznl stlus profilja: ${styleDNA.styleDNA}\\n`;\n  }\n  \n  if (topCategories.length > 0) {\n    context += `Kedvelt kategrik: ${topCategories.join(', ')}\\n`;\n  }\n  \n  if (viewedProducts.length > 0) {\n    context += `Nemrg nzett termkek: ${viewedProducts.map(p => p.name).join(', ')}\\n`;\n  }\n  \n  if (searchHistory.length > 0) {\n    context += `Korbbi keressek: ${searchHistory.map(s => s.query).join(', ')}\\n`;\n  }\n  \n  if (likedProducts.length > 0) {\n    context += `Kedvelt termkek szma: ${likedProducts.length}\\n`;\n  }\n  \n  return context || 'j felhasznl, nincs elzmny.';\n}\n\n/**\n * Szemlyre szabott termk ajnlsok\n * Figyelembe veszi: megtekintett, kedvelt, kategria preferencik\n */\nexport function getPersonalizedRecommendations(allProducts, limit = 12) {\n  if (!allProducts || allProducts.length === 0) return [];\n  \n  const viewedIds = getRecentlyViewedIds();\n  const likedIds = getLikedProducts();\n  const dislikedIds = getDislikedProducts();\n  const signals = getPreferenceSignals();\n  const topCategories = getTopCategories(5);\n  const styleDNA = getStyleDNA();\n  const tweaks = getRecommendationTweaks();\n  const weights = getRecommendationWeights();\n  const viewedProducts = getViewedProducts(20);\n  const avgPriceBase = viewedProducts.length > 0 ? viewedProducts : [];\n  const avgPrice = avgPriceBase.length > 0\n    ? avgPriceBase.reduce((sum, p) => sum + (p.price || 0), 0) / avgPriceBase.length\n    : null;\n  \n  // Pontozzuk a termkeket\n  const scored = allProducts.map(product => {\n    let score = 0;\n    const price = product.salePrice || product.price || 0;\n    \n    // Ne ajnljunk olyat, amit mr nzett vagy nem kedvelt\n    if (viewedIds.includes(product.id)) score -= weights.viewPenalty;\n    if (dislikedIds.includes(product.id)) score -= weights.dislikePenalty;\n    if (likedIds.includes(product.id)) score += weights.likeBoost;\n    \n    // Kategria preferencia\n    const productCategory = product.category || '';\n    topCategories.forEach((cat, index) => {\n      if (productCategory.toLowerCase().includes(cat.toLowerCase())) {\n        score += (5 - index) * weights.categoryBoost * 0.2;\n      }\n    });\n\n    const categoryParts = productCategory\n      .split('>')\n      .map((c) => c.trim().toLowerCase())\n      .filter(Boolean);\n    categoryParts.forEach((cat) => {\n      const signal = signals.categories?.[cat];\n      if (signal) score += signal * weights.signalCategoryBoost;\n    });\n\n    const text = `${product.name || ''} ${product.category || ''}`.toLowerCase();\n    const words = text\n      .split(/[\\s,\\-\\/]+/)\n      .map((w) => w.trim())\n      .filter((w) => w.length > 3 && !stopWords.has(w))\n      .slice(0, 12);\n    words.forEach((kw) => {\n      const signal = signals.keywords?.[kw];\n      if (signal) score += signal * weights.signalKeywordBoost;\n    });\n    \n    // Style DNA alap pontozs\n    if (styleDNA?.answers) {\n      const { space, colors, budget, priority, room } = styleDNA.answers;\n      const productText = `${product.name} ${product.category} ${product.description || ''}`.toLowerCase();\n      \n      // Stlus\n      const styleKeywords = {\n        modern: ['modern', 'minimalista', 'letisztult'],\n        scandinavian: ['skandinv', 'natr', 'vilgos', 'fehr'],\n        industrial: ['indusztrilis', 'loft', 'fm', 'ipari'],\n        vintage: ['vintage', 'retro', 'antik'],\n        bohemian: ['bohm', 'sznes', 'mints'],\n      };\n      \n      if (space && styleKeywords[space]) {\n        styleKeywords[space].forEach(kw => {\n          if (productText.includes(kw)) score += weights.styleBoost;\n        });\n        if (tweaks.avoidStyles?.includes(space)) score -= weights.styleBoost * 2;\n      }\n      \n    // Budget\n      if (budget === 'budget' && price < 100000) score += weights.priceFit;\n      if (budget === 'mid' && price >= 100000 && price <= 300000) score += weights.priceFit;\n      if (budget === 'premium' && price > 300000) score += weights.priceFit;\n      \n      // Szoba tpus\n      const roomKeywords = {\n        living: ['kanap', 'fotel', 'dohnyz', 'tv', 'nappali'],\n        bedroom: ['gy', 'matrac', 'jjeli', 'hlszoba'],\n        dining: ['tkez', 'asztal', 'szk'],\n        office: ['rasztal', 'iroda', 'forgszk'],\n      };\n      \n      if (room && roomKeywords[room]) {\n        roomKeywords[room].forEach(kw => {\n          if (productText.includes(kw)) score += weights.roomBoost;\n        });\n        if (tweaks.avoidRooms?.includes(room)) score -= weights.roomBoost * 2;\n      }\n    }\n\n    if (avgPrice && price > 0) {\n      const diff = Math.abs(price - avgPrice) / avgPrice;\n      score += Math.max(0, (1 - Math.min(diff, 1))) * weights.priceFit;\n    }\n\n    const stockQty = product.stock_qty ?? product.stockQty;\n    if (typeof stockQty === 'number') {\n      score += Math.min(20, stockQty) * (weights.stockBoost / 20);\n      if (stockQty === 0) score -= weights.stockBoost;\n    }\n    \n    // Kis random faktor a vltozatossgrt\n    score += Math.random() * 5;\n    \n    return { product, score };\n  });\n  \n  // Top termkek visszaadsa\n  return scored\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n/**\n * Hasonl termkek keresse\n */\nexport function getSimilarProducts(product, allProducts, limit = 8) {\n  if (!product || !allProducts) return [];\n  \n  const dislikedIds = getDislikedProducts();\n  \n  const productName = (product.name || '').toLowerCase();\n  const productCategory = (product.category || '').toLowerCase();\n  const productPrice = product.salePrice || product.price || 0;\n  \n  // Kulcsszavak kinyerse a nvbl\n  const keywords = productName\n    .split(/[\\s,\\-\\/]+/)\n    .filter(w => w.length > 3)\n    .slice(0, 5);\n  \n  const scored = allProducts\n    .filter(p => p.id !== product.id && !dislikedIds.includes(p.id))\n    .map(p => {\n      let score = 0;\n      const pName = (p.name || '').toLowerCase();\n      const pCategory = (p.category || '').toLowerCase();\n      const pPrice = p.salePrice || p.price || 0;\n      \n      // Ugyanaz a kategria\n      if (pCategory && productCategory && pCategory.includes(productCategory.split(' > ')[0])) {\n        score += 30;\n      }\n      \n      // Hasonl r (30%)\n      if (pPrice > 0 && productPrice > 0) {\n        const priceDiff = Math.abs(pPrice - productPrice) / productPrice;\n        if (priceDiff < 0.3) score += 20;\n        else if (priceDiff < 0.5) score += 10;\n      }\n      \n      // Kulcssz egyezs\n      keywords.forEach(kw => {\n        if (pName.includes(kw)) score += 5;\n      });\n      \n      return { product: p, score };\n    });\n  \n  return scored\n    .filter(s => s.score > 0)\n    .sort((a, b) => b.score - a.score)\n    .slice(0, limit)\n    .map(s => s.product);\n}\n\n// ==================== CLEAR DATA ====================\n\nexport function clearAllData() {\n  Object.values(STORAGE_KEYS).forEach(key => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport default {\n  trackProductView,\n  getViewedProducts,\n  getRecentlyViewedIds,\n  likeProduct,\n  dislikeProduct,\n  getLikedProducts,\n  getDislikedProducts,\n  isProductLiked,\n  trackSearch,\n  getSearchHistory,\n  saveStyleDNA,\n  getStyleDNA,\n  trackAIFeedback,\n  getAIFeedback,\n  getAIFeedbackStats,\n  saveChatContext,\n  getChatContext,\n  getUserPreferences,\n  getTopCategories,\n  getPersonalizedContext,\n  getPersonalizedRecommendations,\n  getSimilarProducts,\n  requestBackInStock,\n  getBackInStockRequests,\n  trackSectionEvent,\n  getSectionStats,\n  clearAllData,\n};\n","import React from 'react';\n\n/**\n * Modern Skeleton Loading Components\n * Shimmer effect with smooth animations\n */\n\n// Base skeleton with shimmer\nexport const Skeleton = ({ className = '', variant = 'rectangular' }) => {\n  const baseClasses = 'animate-pulse bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%] animate-shimmer';\n  \n  const variants = {\n    rectangular: 'rounded-lg',\n    circular: 'rounded-full',\n    text: 'rounded h-4',\n    rounded: 'rounded-xl'\n  };\n\n  return (\n    <div className={`${baseClasses} ${variants[variant]} ${className}`} />\n  );\n};\n\n// Product Card Skeleton\nexport const ProductCardSkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl overflow-hidden shadow-sm border border-gray-100 h-full\">\n    {/* Image placeholder */}\n    <div className=\"aspect-square relative overflow-hidden bg-gray-100\">\n      <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 animate-shimmer bg-[length:200%_100%]\" />\n      {/* Fake badge */}\n      <div className=\"absolute top-3 left-3\">\n        <Skeleton className=\"w-12 h-5 rounded-full\" />\n      </div>\n      {/* Fake wishlist button */}\n      <div className=\"absolute top-3 right-3\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n    \n    {/* Content */}\n    <div className=\"p-3 sm:p-4 lg:p-5 space-y-3\">\n      {/* Category */}\n      <Skeleton className=\"w-16 h-3\" />\n      \n      {/* Title - 2 lines */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"w-full h-4\" />\n        <Skeleton className=\"w-3/4 h-4\" />\n      </div>\n      \n      {/* Price section */}\n      <div className=\"pt-3 border-t border-gray-100 flex justify-between items-center\">\n        <div className=\"space-y-1\">\n          <Skeleton className=\"w-12 h-3\" />\n          <Skeleton className=\"w-20 h-6\" />\n        </div>\n        <Skeleton variant=\"circular\" className=\"w-10 h-10\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Grid of Product Skeletons\nexport const ProductGridSkeleton = ({ count = 8 }) => (\n  <div className=\"product-grid\">\n    {Array.from({ length: count }).map((_, i) => (\n      <ProductCardSkeleton key={i} />\n    ))}\n  </div>\n);\n\n// Category Pills Skeleton\nexport const CategorySkeleton = () => (\n  <div className=\"bg-white rounded-xl sm:rounded-2xl shadow-sm border border-gray-100 mb-4 sm:mb-6 p-4\">\n    {/* Header */}\n    <div className=\"flex items-center justify-between mb-4\">\n      <div className=\"flex items-center gap-3\">\n        <Skeleton variant=\"rounded\" className=\"w-10 h-10\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"w-24 h-5\" />\n          <Skeleton className=\"w-16 h-3 hidden sm:block\" />\n        </div>\n      </div>\n      <div className=\"space-y-1 text-right\">\n        <Skeleton className=\"w-20 h-5\" />\n        <Skeleton className=\"w-16 h-3\" />\n      </div>\n    </div>\n    \n    {/* Pills */}\n    <div className=\"flex flex-wrap gap-2\">\n      {Array.from({ length: 8 }).map((_, i) => (\n        <Skeleton \n          key={i} \n          variant=\"rounded\" \n          className=\"h-10\"\n          style={{ width: `${60 + Math.random() * 40}px` }}\n        />\n      ))}\n    </div>\n  </div>\n);\n\n// Search Bar Skeleton\nexport const SearchSkeleton = () => (\n  <div className=\"relative\">\n    <Skeleton variant=\"rounded\" className=\"w-full h-12\" />\n  </div>\n);\n\n// Hero Section Skeleton\nexport const HeroSkeleton = () => (\n  <div className=\"min-h-[60vh] flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 p-8\">\n    <div className=\"text-center space-y-6 max-w-2xl\">\n      <Skeleton className=\"w-40 h-8 mx-auto rounded-full\" />\n      <div className=\"space-y-3\">\n        <Skeleton className=\"w-full h-12 mx-auto\" />\n        <Skeleton className=\"w-3/4 h-12 mx-auto\" />\n      </div>\n      <Skeleton className=\"w-2/3 h-6 mx-auto\" />\n      <div className=\"flex gap-4 justify-center pt-4\">\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n        <Skeleton variant=\"rounded\" className=\"w-40 h-14\" />\n      </div>\n    </div>\n  </div>\n);\n\n// Inline Content Skeleton (for text areas)\nexport const TextSkeleton = ({ lines = 3, className = '' }) => (\n  <div className={`space-y-2 ${className}`}>\n    {Array.from({ length: lines }).map((_, i) => (\n      <Skeleton \n        key={i} \n        variant=\"text\" \n        className={i === lines - 1 ? 'w-2/3' : 'w-full'}\n      />\n    ))}\n  </div>\n);\n\n// Stats Card Skeleton\nexport const StatsSkeleton = () => (\n  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n    {Array.from({ length: 4 }).map((_, i) => (\n      <div key={i} className=\"bg-white rounded-2xl p-6 text-center\">\n        <Skeleton variant=\"circular\" className=\"w-10 h-10 mx-auto mb-3\" />\n        <Skeleton className=\"w-16 h-8 mx-auto mb-2\" />\n        <Skeleton className=\"w-20 h-4 mx-auto\" />\n      </div>\n    ))}\n  </div>\n);\n\nexport default {\n  Skeleton,\n  ProductCardSkeleton,\n  ProductGridSkeleton,\n  CategorySkeleton,\n  SearchSkeleton,\n  HeroSkeleton,\n  TextSkeleton,\n  StatsSkeleton\n};\n","import React, { useState, useEffect, createContext, useContext, useCallback } from 'react';\nimport { \n  CheckCircle2, XCircle, AlertCircle, Info, X, \n  ShoppingCart, Heart, Sparkles, Bell, Truck\n} from 'lucide-react';\n\n/**\n * Modern Toast Notification System\n * Beautiful, accessible notifications with icons and animations\n */\n\n// Toast Context\nconst ToastContext = createContext(null);\n\n// Toast Types with icons and colors\nconst TOAST_TYPES = {\n  success: {\n    icon: CheckCircle2,\n    bg: 'bg-emerald-50 border-emerald-200',\n    iconBg: 'bg-emerald-100',\n    iconColor: 'text-emerald-600',\n    title: 'text-emerald-900',\n    message: 'text-emerald-700',\n    progress: 'bg-emerald-500'\n  },\n  error: {\n    icon: XCircle,\n    bg: 'bg-red-50 border-red-200',\n    iconBg: 'bg-red-100',\n    iconColor: 'text-red-600',\n    title: 'text-red-900',\n    message: 'text-red-700',\n    progress: 'bg-red-500'\n  },\n  warning: {\n    icon: AlertCircle,\n    bg: 'bg-amber-50 border-amber-200',\n    iconBg: 'bg-amber-100',\n    iconColor: 'text-amber-600',\n    title: 'text-amber-900',\n    message: 'text-amber-700',\n    progress: 'bg-amber-500'\n  },\n  info: {\n    icon: Info,\n    bg: 'bg-blue-50 border-blue-200',\n    iconBg: 'bg-blue-100',\n    iconColor: 'text-blue-600',\n    title: 'text-blue-900',\n    message: 'text-blue-700',\n    progress: 'bg-blue-500'\n  },\n  cart: {\n    icon: ShoppingCart,\n    bg: 'bg-primary-50 border-primary-200',\n    iconBg: 'bg-primary-100',\n    iconColor: 'text-primary-500',\n    title: 'text-primary-700',\n    message: 'text-primary-600',\n    progress: 'bg-primary-500'\n  },\n  wishlist: {\n    icon: Heart,\n    bg: 'bg-pink-50 border-pink-200',\n    iconBg: 'bg-pink-100',\n    iconColor: 'text-pink-600',\n    title: 'text-pink-900',\n    message: 'text-pink-700',\n    progress: 'bg-pink-500'\n  },\n  ai: {\n    icon: Sparkles,\n    bg: 'bg-secondary-50 border-secondary-200',\n    iconBg: 'bg-secondary-100',\n    iconColor: 'text-secondary-700',\n    title: 'text-secondary-800',\n    message: 'text-secondary-700',\n    progress: 'bg-secondary-600'\n  },\n  notification: {\n    icon: Bell,\n    bg: 'bg-gray-50 border-gray-200',\n    iconBg: 'bg-gray-100',\n    iconColor: 'text-gray-600',\n    title: 'text-gray-900',\n    message: 'text-gray-700',\n    progress: 'bg-gray-500'\n  },\n  shipping: {\n    icon: Truck,\n    bg: 'bg-teal-50 border-teal-200',\n    iconBg: 'bg-teal-100',\n    iconColor: 'text-teal-600',\n    title: 'text-teal-900',\n    message: 'text-teal-700',\n    progress: 'bg-teal-500'\n  }\n};\n\n// Single Toast Component\nconst Toast = ({ id, type = 'info', title, message, duration = 4000, onClose, action }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isLeaving, setIsLeaving] = useState(false);\n  const config = TOAST_TYPES[type] || TOAST_TYPES.info;\n  const Icon = config.icon;\n\n  useEffect(() => {\n    // Animate in\n    requestAnimationFrame(() => setIsVisible(true));\n    \n    // Auto dismiss\n    if (duration > 0) {\n      const timer = setTimeout(() => handleClose(), duration);\n      return () => clearTimeout(timer);\n    }\n  }, [duration]);\n\n  const handleClose = () => {\n    setIsLeaving(true);\n    setTimeout(() => onClose?.(id), 300);\n  };\n\n  return (\n    <div\n      className={`\n        relative w-full max-w-sm overflow-hidden\n        ${config.bg} border rounded-xl shadow-lg\n        transform transition-all duration-300 ease-out\n        ${isVisible && !isLeaving ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}\n      `}\n      role=\"alert\"\n    >\n      <div className=\"p-4 flex items-start gap-3\">\n        {/* Icon */}\n        <div className={`${config.iconBg} rounded-lg p-2 shrink-0`}>\n          <Icon className={`w-5 h-5 ${config.iconColor}`} />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          {title && (\n            <h4 className={`font-semibold text-sm ${config.title}`}>{title}</h4>\n          )}\n          {message && (\n            <p className={`text-sm mt-0.5 ${config.message}`}>{message}</p>\n          )}\n          {action && (\n            <button\n              onClick={() => { action.onClick?.(); handleClose(); }}\n              className={`mt-2 text-sm font-semibold ${config.iconColor} hover:underline`}\n            >\n              {action.label}\n            </button>\n          )}\n        </div>\n\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"shrink-0 p-1 rounded-lg hover:bg-black/5 transition-colors\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-4 h-4 text-gray-400\" />\n        </button>\n      </div>\n\n      {/* Progress bar */}\n      {duration > 0 && (\n        <div className=\"h-1 w-full bg-black/5\">\n          <div\n            className={`h-full ${config.progress} transition-all ease-linear`}\n            style={{\n              width: '100%',\n              animation: `shrink ${duration}ms linear forwards`\n            }}\n          />\n        </div>\n      )}\n\n      <style>{`\n        @keyframes shrink {\n          from { width: 100%; }\n          to { width: 0%; }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// Toast Container - mobile aware of 40px UNAS bottom nav\nconst ToastContainer = ({ toasts, removeToast }) => {\n  if (!toasts || toasts.length === 0) return null;\n\n  return (\n    <div className=\"fixed bottom-[calc(1rem+44px)] md:bottom-4 right-2 md:right-4 z-[100] flex flex-col gap-2 md:gap-3 pointer-events-none max-w-[calc(100vw-1rem)] md:max-w-none\">\n      {toasts.map(toast => (\n        <div key={toast.id} className=\"pointer-events-auto\">\n          <Toast {...toast} onClose={removeToast} />\n        </div>\n      ))}\n    </div>\n  );\n};\n\n// Toast Provider\nexport const ToastProvider = ({ children }) => {\n  const [toasts, setToasts] = useState([]);\n\n  const addToast = useCallback((options) => {\n    const id = Date.now() + Math.random();\n    setToasts(prev => [...prev, { id, ...options }]);\n    return id;\n  }, []);\n\n  const removeToast = useCallback((id) => {\n    setToasts(prev => prev.filter(t => t.id !== id));\n  }, []);\n\n  // Convenience methods\n  const toast = {\n    success: (message, options = {}) => addToast({ type: 'success', title: 'Siker!', message, ...options }),\n    error: (message, options = {}) => addToast({ type: 'error', title: 'Hiba!', message, ...options }),\n    warning: (message, options = {}) => addToast({ type: 'warning', title: 'Figyelem!', message, ...options }),\n    info: (message, options = {}) => addToast({ type: 'info', message, ...options }),\n    cart: (message, options = {}) => addToast({ type: 'cart', title: 'Kosr', message, ...options }),\n    wishlist: (message, options = {}) => addToast({ type: 'wishlist', title: 'Kedvencek', message, ...options }),\n    ai: (message, options = {}) => addToast({ type: 'ai', title: 'AI Asszisztens', message, ...options }),\n    notification: (message, options = {}) => addToast({ type: 'notification', message, ...options }),\n    shipping: (message, options = {}) => addToast({ type: 'shipping', title: 'Szllts', message, ...options }),\n    custom: (options) => addToast(options),\n    dismiss: removeToast\n  };\n\n  return (\n    <ToastContext.Provider value={toast}>\n      {children}\n      <ToastContainer toasts={toasts} removeToast={removeToast} />\n    </ToastContext.Provider>\n  );\n};\n\n// Hook to use toast\nexport const useToast = () => {\n  const context = useContext(ToastContext);\n  if (!context) {\n    // Return a mock toast for when provider is not available\n    return {\n      success: console.log,\n      error: console.error,\n      warning: console.warn,\n      info: console.log,\n      cart: console.log,\n      wishlist: console.log,\n      ai: console.log,\n      notification: console.log,\n      shipping: console.log,\n      custom: console.log,\n      dismiss: () => {}\n    };\n  }\n  return context;\n};\n\nexport default { Toast, ToastProvider, useToast };\n","import React from 'react';\nimport { \n  Search, Package, Heart, ShoppingCart, Filter, \n  FolderOpen, AlertCircle, RefreshCw, ArrowRight,\n  Sparkles, Frown\n} from 'lucide-react';\n\n/**\n * Modern Empty State Components\n * Beautiful, helpful empty states with actions\n */\n\n// Base Empty State\nexport const EmptyState = ({ \n  icon: Icon = Package,\n  title,\n  description,\n  action,\n  secondaryAction,\n  size = 'md',\n  className = ''\n}) => {\n  const sizes = {\n    sm: {\n      container: 'py-8 px-4',\n      icon: 'w-12 h-12',\n      iconWrapper: 'w-16 h-16',\n      title: 'text-base',\n      description: 'text-sm',\n      button: 'px-4 py-2 text-sm'\n    },\n    md: {\n      container: 'py-12 px-6',\n      icon: 'w-16 h-16',\n      iconWrapper: 'w-24 h-24',\n      title: 'text-lg',\n      description: 'text-base',\n      button: 'px-5 py-2.5 text-sm'\n    },\n    lg: {\n      container: 'py-16 px-8',\n      icon: 'w-20 h-20',\n      iconWrapper: 'w-32 h-32',\n      title: 'text-xl',\n      description: 'text-lg',\n      button: 'px-6 py-3 text-base'\n    }\n  };\n\n  const s = sizes[size];\n\n  return (\n    <div className={`flex flex-col items-center justify-center text-center ${s.container} ${className}`}>\n      {/* Animated Icon Container */}\n      <div className={`\n        ${s.iconWrapper} rounded-full \n        bg-gradient-to-br from-gray-100 to-gray-50 \n        flex items-center justify-center mb-6\n        relative overflow-hidden\n      `}>\n        {/* Subtle animation ring */}\n        <div className=\"absolute inset-0 rounded-full border-2 border-dashed border-gray-200 animate-spin-slow\" />\n        <Icon className={`${s.icon} text-gray-400`} />\n      </div>\n\n      {/* Title */}\n      {title && (\n        <h3 className={`${s.title} font-bold text-gray-900 mb-2`}>\n          {title}\n        </h3>\n      )}\n\n      {/* Description */}\n      {description && (\n        <p className={`${s.description} text-gray-500 max-w-md mb-6`}>\n          {description}\n        </p>\n      )}\n\n      {/* Actions */}\n      {(action || secondaryAction) && (\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          {action && (\n            <button\n              onClick={action.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-primary-500 text-white font-semibold rounded-xl\n                hover:bg-primary-600 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {action.icon && <action.icon className=\"w-4 h-4\" />}\n              {action.label}\n            </button>\n          )}\n          {secondaryAction && (\n            <button\n              onClick={secondaryAction.onClick}\n              className={`\n                ${s.button} min-h-[44px]\n                bg-gray-100 text-gray-700 font-semibold rounded-xl\n                hover:bg-gray-200 transition-colors\n                flex items-center justify-center gap-2\n              `}\n            >\n              {secondaryAction.icon && <secondaryAction.icon className=\"w-4 h-4\" />}\n              {secondaryAction.label}\n            </button>\n          )}\n        </div>\n      )}\n\n      <style>{`\n        @keyframes spin-slow {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n        .animate-spin-slow {\n          animation: spin-slow 20s linear infinite;\n        }\n      `}</style>\n    </div>\n  );\n};\n\n// No Search Results\nexport const NoSearchResults = ({ query, onClear, onSuggest }) => (\n  <EmptyState\n    icon={Search}\n    title={`Nincs tallat: \"${query}\"`}\n    description=\"Prblj ms kulcsszavakat hasznlni, vagy bngssz a kategrik kztt.\"\n    action={onClear && {\n      label: 'Keress trlse',\n      icon: RefreshCw,\n      onClick: onClear\n    }}\n    secondaryAction={onSuggest && {\n      label: 'AI javaslatok',\n      icon: Sparkles,\n      onClick: onSuggest\n    }}\n  />\n);\n\n// No Products in Category\nexport const NoCategoryProducts = ({ category, onShowAll }) => (\n  <EmptyState\n    icon={FolderOpen}\n    title={`Nincs termk: ${category}`}\n    description=\"Ez a kategria jelenleg res. Nzd meg a tbbi kategrit!\"\n    action={onShowAll && {\n      label: 'sszes termk',\n      icon: ArrowRight,\n      onClick: onShowAll\n    }}\n  />\n);\n\n// Empty Wishlist\nexport const EmptyWishlist = ({ onBrowse }) => (\n  <EmptyState\n    icon={Heart}\n    title=\"res a kvnsglistd\"\n    description=\"Mg nem adtl hozz termkeket. Bngssz s jelld meg kedvenceidet!\"\n    action={onBrowse && {\n      label: 'Bngszs',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// Empty Cart\nexport const EmptyCart = ({ onBrowse }) => (\n  <EmptyState\n    icon={ShoppingCart}\n    title=\"res a kosarad\"\n    description=\"Mg nem tettl semmit a kosrba. Fedezd fel knlatunkat!\"\n    action={onBrowse && {\n      label: 'Vsrls',\n      icon: ArrowRight,\n      onClick: onBrowse\n    }}\n  />\n);\n\n// No Filter Results\nexport const NoFilterResults = ({ onClearFilters }) => (\n  <EmptyState\n    icon={Filter}\n    title=\"Nincs tallat a szrsre\"\n    description=\"A megadott szrknek egyetlen termk sem felel meg. Prbld laztani a feltteleket.\"\n    action={onClearFilters && {\n      label: 'Szrk trlse',\n      icon: RefreshCw,\n      onClick: onClearFilters\n    }}\n  />\n);\n\n// Error State\nexport const ErrorState = ({ message, onRetry }) => (\n  <EmptyState\n    icon={AlertCircle}\n    title=\"Hiba trtnt\"\n    description={message || \"Valami nem sikerlt. Krlek prbld jra!\"}\n    action={onRetry && {\n      label: 'jraprbls',\n      icon: RefreshCw,\n      onClick: onRetry\n    }}\n  />\n);\n\n// Coming Soon\nexport const ComingSoon = ({ feature }) => (\n  <EmptyState\n    icon={Sparkles}\n    title=\"Hamarosan\"\n    description={feature ? `${feature} - dolgozunk rajta!` : \"Ez a funkci hamarosan elrhet!\"}\n  />\n);\n\n// Not Found (404)\nexport const NotFound = ({ onGoHome }) => (\n  <EmptyState\n    icon={Frown}\n    title=\"Az oldal nem tallhat\"\n    description=\"A keresett oldal nem ltezik vagy thelyezsre kerlt.\"\n    action={onGoHome && {\n      label: 'Vissza a foldalra',\n      icon: ArrowRight,\n      onClick: onGoHome\n    }}\n    size=\"lg\"\n  />\n);\n\nexport default {\n  EmptyState,\n  NoSearchResults,\n  NoCategoryProducts,\n  EmptyWishlist,\n  EmptyCart,\n  NoFilterResults,\n  ErrorState,\n  ComingSoon,\n  NotFound\n};\n","import React from 'react';\nimport { \n  Sparkles, Flame, Star, TrendingUp, Clock, Tag, \n  Percent, Package, Truck, Shield, Award, Zap\n} from 'lucide-react';\n\n/**\n * Modern Badge Components\n * Consistent, accessible product badges with animations\n */\n\n// Base Badge Component\nexport const Badge = ({ \n  children, \n  variant = 'default',\n  size = 'sm',\n  icon: Icon,\n  pulse = false,\n  className = ''\n}) => {\n  const variants = {\n    default: 'bg-gray-100 text-gray-700',\n    primary: 'bg-primary-100 text-primary-700',\n    success: 'bg-emerald-100 text-emerald-700',\n    warning: 'bg-amber-100 text-amber-700',\n    danger: 'bg-red-100 text-red-700',\n    purple: 'bg-secondary-100 text-secondary-700',\n    pink: 'bg-pink-100 text-pink-700',\n    gradient: 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white',\n    outline: 'bg-transparent border-2 border-current'\n  };\n\n  // UNIFIED TYPOGRAPHY SCALE - Comfortable readable sizes\n  const sizes = {\n    xs: 'text-sm px-2.5 py-1',              // 14px - small but readable\n    sm: 'text-sm sm:text-base px-3 py-1.5', // 14-16px - standard badge\n    md: 'text-base sm:text-lg px-4 py-2',   // 16-18px - prominent\n    lg: 'text-lg sm:text-xl px-5 py-2.5'    // 18-20px - hero badges\n  };\n\n  const iconSizes = {\n    xs: 'w-4 h-4',\n    sm: 'w-4 h-4 sm:w-5 sm:h-5',\n    md: 'w-5 h-5 sm:w-6 sm:h-6',\n    lg: 'w-6 h-6'\n  };\n\n  return (\n    <span className={`\n      inline-flex items-center gap-1.5 font-semibold rounded-full\n      ${variants[variant]} ${sizes[size]}\n      ${pulse ? 'animate-pulse' : ''}\n      ${className}\n    `}>\n      {Icon && <Icon className={iconSizes[size]} />}\n      {children}\n    </span>\n  );\n};\n\n// New Product Badge\nexport const NewBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"primary\" size={size} icon={Sparkles}>\n    J\n  </Badge>\n);\n\n// Sale/Discount Badge\nexport const DiscountBadge = ({ percent, size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Percent}>\n    -{percent}%\n  </Badge>\n);\n\n// Hot/Popular Badge\nexport const HotBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Flame} pulse>\n    Npszer\n  </Badge>\n);\n\n// Bestseller Badge\nexport const BestsellerBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Award}>\n    Bestseller\n  </Badge>\n);\n\n// Trending Badge\nexport const TrendingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"purple\" size={size} icon={TrendingUp}>\n    Trend\n  </Badge>\n);\n\n// Limited Badge\nexport const LimitedBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"pink\" size={size} icon={Clock}>\n    Limitlt\n  </Badge>\n);\n\n// Free Shipping Badge\nexport const FreeShippingBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Truck}>\n    Ingyenes szllts\n  </Badge>\n);\n\n// Stock Badge\nexport const StockBadge = ({ inStock, quantity, size = 'sm' }) => {\n  if (!inStock || quantity === 0) {\n    return (\n      <Badge variant=\"default\" size={size}>\n        Elfogyott\n      </Badge>\n    );\n  }\n  \n  if (quantity && quantity <= 5) {\n    return (\n      <Badge variant=\"warning\" size={size} icon={Package}>\n        Csak {quantity} db\n      </Badge>\n    );\n  }\n  \n  return (\n    <Badge variant=\"success\" size={size} icon={Package}>\n      Kszleten\n    </Badge>\n  );\n};\n\n// Rating Badge\nexport const RatingBadge = ({ rating, count, size = 'sm' }) => (\n  <Badge variant=\"warning\" size={size} icon={Star}>\n    {rating?.toFixed(1) || '5.0'} {count && `(${count})`}\n  </Badge>\n);\n\n// Premium/Quality Badge\nexport const PremiumBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"gradient\" size={size} icon={Shield}>\n    Prmium\n  </Badge>\n);\n\n// Fast Delivery Badge  \nexport const FastDeliveryBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"success\" size={size} icon={Zap}>\n    24h szllts\n  </Badge>\n);\n\n// Price Drop Badge\nexport const PriceDropBadge = ({ size = 'sm' }) => (\n  <Badge variant=\"danger\" size={size} icon={Tag}>\n    ress\n  </Badge>\n);\n\n// Smart Badge - automatically determines which badge to show\n// Uses sm size for READABLE badges\nexport const SmartBadges = ({ product, maxBadges = 2 }) => {\n  const badges = [];\n  \n  // Check for new (last 7 days)\n  if (product.createdAt) {\n    const daysSinceCreation = (Date.now() - new Date(product.createdAt).getTime()) / (1000 * 60 * 60 * 24);\n    if (daysSinceCreation <= 7) {\n      badges.push({ component: NewBadge, priority: 3 });\n    }\n  }\n  \n  // Check for discount\n  if (product.salePrice && product.price > product.salePrice) {\n    const percent = Math.round(((product.price - product.salePrice) / product.price) * 100);\n    if (percent >= 10) {\n      badges.push({ \n        component: ({ size }) => <DiscountBadge percent={percent} size={size} />, \n        priority: 5 \n      });\n    }\n  }\n  \n  // Check for popularity (if we have sales data)\n  if (product.salesCount && product.salesCount > 50) {\n    badges.push({ component: HotBadge, priority: 2 });\n  }\n  \n  // Check for low stock\n  if (product.inStock && product.quantity && product.quantity <= 5 && product.quantity > 0) {\n    badges.push({ component: LimitedBadge, priority: 4 });\n  }\n  \n  // Check for bestseller\n  if (product.isBestseller) {\n    badges.push({ component: BestsellerBadge, priority: 6 });\n  }\n  \n  // Check for free shipping\n  if (product.freeShipping) {\n    badges.push({ component: FreeShippingBadge, priority: 1 });\n  }\n  \n  // Sort by priority and take top badges\n  const topBadges = badges\n    .sort((a, b) => b.priority - a.priority)\n    .slice(0, maxBadges);\n  \n  if (topBadges.length === 0) return null;\n  \n  return (\n    <div className=\"flex flex-col gap-1.5 sm:gap-2\">\n      {topBadges.map((badge, idx) => (\n        <badge.component key={idx} size=\"sm\" />\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  Badge,\n  NewBadge,\n  DiscountBadge,\n  HotBadge,\n  BestsellerBadge,\n  TrendingBadge,\n  LimitedBadge,\n  FreeShippingBadge,\n  StockBadge,\n  RatingBadge,\n  PremiumBadge,\n  FastDeliveryBadge,\n  PriceDropBadge,\n  SmartBadges\n};\n","import React from 'react';\nimport { \n  LayoutGrid, Sofa, Armchair, BedDouble, Lamp, LampDesk, Package, \n  Table, BookOpen, Tv, Bath, UtensilsCrossed, Briefcase, Baby,\n  Flower2, TreeDeciduous, Warehouse, Shirt, Home, Box,\n  MessageCircle, Camera, Move3d, Sparkles, Lightbulb, Zap,\n  Palette, DollarSign, Crown, Target, Handshake, Recycle,\n  ThumbsUp, Heart, Shield, Award, Clock, Truck, CheckCircle2,\n  Star, TrendingUp, Gift, Search, ArrowRight, Bot\n} from 'lucide-react';\n\n/**\n * Category Icon Mapping - consistent furniture-related icons\n */\nconst CATEGORY_ICONS = {\n  // Default & General\n  'sszes': LayoutGrid,\n  'default': Package,\n  \n  // Living Room\n  'Kanap': Sofa,\n  'Kanapk': Sofa,\n  'Fotel': Armchair,\n  'Fotelek': Armchair,\n  'lgarnitra': Sofa,\n  'lgarnitrk': Sofa,\n  'Nappali': Tv,\n  'Nappali btor': Tv,\n  \n  // Bedroom\n  'gy': BedDouble,\n  'gyak': BedDouble,\n  'Hlszoba': BedDouble,\n  'Hlszoba btor': BedDouble,\n  'Matrac': BedDouble,\n  'Matracok': BedDouble,\n  \n  // Seating\n  'Szk': Armchair,\n  'Szkek': Armchair,\n  'Irodai szk': Briefcase,\n  'Irodaszk': Briefcase,\n  \n  // Tables\n  'Asztal': Table,\n  'Asztalok': Table,\n  'tkezasztal': UtensilsCrossed,\n  'Dohnyzasztal': Table,\n  'rasztal': Briefcase,\n  \n  // Storage\n  'Szekrny': Warehouse,\n  'Szekrnyek': Warehouse,\n  'Gardrb': Shirt,\n  'Gardrbszekrny': Shirt,\n  'Komd': Box,\n  'Polc': BookOpen,\n  'Polcok': BookOpen,\n  'Knyvespolc': BookOpen,\n  'Trols': Package,\n  \n  // Lighting\n  'Lmpa': Lamp,\n  'Lmpk': Lamp,\n  'Vilgts': LampDesk,\n  'Asztali lmpa': LampDesk,\n  'lllmpa': Lamp,\n  \n  // Office\n  'Iroda': Briefcase,\n  'Iroda btor': Briefcase,\n  'Dolgozszoba': Briefcase,\n  \n  // Kids & Baby\n  'Gyerek': Baby,\n  'Gyerekszoba': Baby,\n  'Baba': Baby,\n  \n  // Bathroom\n  'Frdszoba': Bath,\n  'Frd': Bath,\n  \n  // Outdoor & Garden\n  'Kert': TreeDeciduous,\n  'Kerti': TreeDeciduous,\n  'Kerti btor': TreeDeciduous,\n  'Terasz': Flower2,\n  \n  // Home & Decor\n  'Dekorci': Flower2,\n  'Lakstextil': Home,\n  'Kiegszt': Gift,\n  'Otthon': Home,\n  'Lakberendezs': Home,\n  'Otthon s lakberendezs': Home,\n  'Btor': Sofa,\n  'Btorok': Sofa,\n  'Barkcs': Warehouse,\n  'Kert s Barkcs': TreeDeciduous,\n};\n\n/**\n * Get icon component for a category name\n */\nexport const getCategoryIcon = (categoryName) => {\n  if (!categoryName) return Package;\n  \n  // Direct match\n  if (CATEGORY_ICONS[categoryName]) {\n    return CATEGORY_ICONS[categoryName];\n  }\n  \n  // Partial match (case insensitive)\n  const lowerName = categoryName.toLowerCase();\n  for (const [key, Icon] of Object.entries(CATEGORY_ICONS)) {\n    if (lowerName.includes(key.toLowerCase()) || key.toLowerCase().includes(lowerName)) {\n      return Icon;\n    }\n  }\n  \n  return Package;\n};\n\n/**\n * Renders a category icon with consistent styling\n */\nexport const CategoryIcon = ({ name, className = \"w-4 h-4\", ...props }) => {\n  const Icon = getCategoryIcon(name);\n  return <Icon className={className} {...props} />;\n};\n\n/**\n * AI Feature Icons\n */\nexport const AIIcons = {\n  Chat: MessageCircle,\n  Camera: Camera,\n  RoomPlanner: Move3d,\n  Sparkles: Sparkles,\n  Tip: Lightbulb,\n  Quick: Zap,\n  Bot: Bot,\n};\n\n/**\n * Style Quiz Icons - modern alternatives to emojis\n */\nexport const StyleIcons = {\n  // Styles\n  modern: Sparkles,\n  scandinavian: TreeDeciduous,\n  industrial: Warehouse,\n  vintage: Clock,\n  bohemian: Palette,\n  \n  // Colors\n  neutral: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-gray-200 to-gray-400\" />,\n  earth: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-amber-600 to-green-700\" />,\n  bold: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-blue-500 to-red-500\" />,\n  pastel: () => <div className=\"w-4 h-4 rounded-full bg-gradient-to-br from-pink-300 to-secondary-400\" />,\n  \n  // Budget\n  budget: DollarSign,\n  mid: Award,\n  premium: Crown,\n  flexible: Target,\n  \n  // Priorities\n  comfort: Sofa,\n  design: Palette,\n  durability: Shield,\n  versatility: Recycle,\n  eco: TreeDeciduous,\n  \n  // Rooms\n  living: Tv,\n  bedroom: BedDouble,\n  dining: UtensilsCrossed,\n  office: Briefcase,\n  all: Home,\n};\n\n/**\n * Trust/Feature Icons\n */\nexport const TrustIcons = {\n  quality: Shield,\n  delivery: Truck,\n  support: MessageCircle,\n  warranty: Award,\n  returns: Recycle,\n  secure: CheckCircle2,\n};\n\n/**\n * Animated Icon Wrapper\n */\nexport const AnimatedIcon = ({ icon: Icon, className = \"\", pulse = false, bounce = false, spin = false }) => {\n  const animationClass = pulse ? 'animate-pulse' : bounce ? 'animate-bounce' : spin ? 'animate-spin' : '';\n  return <Icon className={`${className} ${animationClass}`} />;\n};\n\n/**\n * Icon with gradient background\n */\nexport const GradientIcon = ({ \n  icon: Icon, \n  gradient = \"from-primary-500 to-secondary-700\",\n  size = \"md\",\n  className = \"\"\n}) => {\n  const sizes = {\n    sm: \"w-8 h-8 p-1.5\",\n    md: \"w-10 h-10 p-2\",\n    lg: \"w-12 h-12 p-2.5\",\n    xl: \"w-14 h-14 p-3\"\n  };\n  \n  const iconSizes = {\n    sm: \"w-4 h-4\",\n    md: \"w-5 h-5\",\n    lg: \"w-6 h-6\",\n    xl: \"w-7 h-7\"\n  };\n  \n  return (\n    <div className={`bg-gradient-to-br ${gradient} rounded-xl flex items-center justify-center ${sizes[size]} ${className}`}>\n      <Icon className={`${iconSizes[size]} text-white`} />\n    </div>\n  );\n};\n\n/**\n * Demo Flow - replaces emoji flows with icons\n */\nexport const DemoFlow = ({ steps, size = \"md\" }) => {\n  const iconSize = size === \"sm\" ? \"w-5 h-5\" : size === \"lg\" ? \"w-8 h-8\" : \"w-6 h-6\";\n  const arrowSize = size === \"sm\" ? \"w-3 h-3\" : size === \"lg\" ? \"w-5 h-5\" : \"w-4 h-4\";\n  \n  return (\n    <div className=\"flex items-center justify-center gap-2\">\n      {steps.map((step, idx) => (\n        <React.Fragment key={idx}>\n          <div className={`${step.bg || 'bg-gray-100'} rounded-lg p-2`}>\n            <step.icon className={`${iconSize} ${step.color || 'text-gray-600'}`} />\n          </div>\n          {idx < steps.length - 1 && (\n            <ArrowRight className={`${arrowSize} text-gray-300`} />\n          )}\n        </React.Fragment>\n      ))}\n    </div>\n  );\n};\n\nexport default {\n  getCategoryIcon,\n  CategoryIcon,\n  AIIcons,\n  StyleIcons,\n  TrustIcons,\n  AnimatedIcon,\n  GradientIcon,\n  DemoFlow\n};\n","import React, { useState } from 'react';\nimport { Sparkles, X, ArrowRight, MessageCircle, Camera, Home, Lightbulb } from 'lucide-react';\nimport { GradientIcon } from '../ui/Icons';\n\n/**\n * AI Feature Showcase - highlights AI capabilities with modern icons\n */\nexport const AIShowcase = () => {\n  const [isDismissed, setIsDismissed] = useState(() => \n    localStorage.getItem('ai-showcase-dismissed') === 'true'\n  );\n\n  if (isDismissed) return null;\n\n  const handleDismiss = () => {\n    localStorage.setItem('ai-showcase-dismissed', 'true');\n    setIsDismissed(true);\n  };\n\n  const features = [\n    {\n      title: 'AI Asszisztens',\n      description: 'Beszlgess szakrtnkkel, krdezz, tancsot krj.',\n      icon: MessageCircle,\n      gradient: 'from-blue-500 to-primary-500',\n      feature: 'Chat'\n    },\n    {\n      title: 'Kpkeres',\n      description: 'Fotzd le a btort, mi megtalljuk a hasonlt.',\n      icon: Camera,\n      gradient: 'from-secondary-600 to-pink-600',\n      feature: 'Visual Search'\n    },\n    {\n      title: 'Szobatervez',\n      description: 'Tervezd meg a szobt virtulisan, lsd lben.',\n      icon: Home,\n      gradient: 'from-emerald-500 to-teal-600',\n      feature: 'Room Planner'\n    }\n  ];\n\n  return (\n    <div className=\"relative bg-gradient-to-br from-secondary-700 via-primary-500 to-blue-600 text-white py-6 sm:py-8 lg:py-12 xl:py-14 mb-4 sm:mb-6 lg:mb-8 overflow-hidden\">\n      {/* Animated background */}\n      <div className=\"absolute inset-0 opacity-20\">\n        <div className=\"absolute top-0 left-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-white rounded-full mix-blend-multiply filter blur-3xl animate-blob\"></div>\n        <div className=\"absolute top-0 right-0 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-secondary-400 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-2000\"></div>\n        <div className=\"absolute bottom-0 left-1/2 w-48 sm:w-72 lg:w-96 h-48 sm:h-72 lg:h-96 bg-primary-300 rounded-full mix-blend-multiply filter blur-3xl animate-blob animation-delay-4000\"></div>\n      </div>\n\n      <button \n        onClick={handleDismiss}\n        className=\"absolute top-2 right-2 sm:top-3 sm:right-3 lg:top-5 lg:right-5 w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-full transition-colors z-10\"\n        aria-label=\"Bezrs\"\n      >\n        <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n      </button>\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-6 lg:px-10 xl:px-16 relative z-10\">\n        <div className=\"text-center mb-6 sm:mb-10 lg:mb-14\">\n          <div className=\"inline-flex items-center px-3 py-1.5 sm:px-4 sm:py-2 lg:px-5 lg:py-2.5 bg-white/20 backdrop-blur-sm rounded-full text-xs sm:text-sm lg:text-base font-bold mb-3 sm:mb-4 lg:mb-6\">\n            <Sparkles className=\"w-4 h-4 lg:w-5 lg:h-5 mr-2 animate-pulse\" />\n            AI-Powered Shopping\n          </div>\n          <h2 className=\"text-xl sm:text-3xl lg:text-4xl xl:text-5xl font-extrabold mb-2 sm:mb-3 lg:mb-4\">\n            Talld meg az idelis btort <br className=\"hidden md:block\" />\n            <span className=\"text-yellow-300\">mestersges intelligencival</span>\n          </h2>\n          <p className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-white/90 max-w-3xl mx-auto leading-relaxed\">\n            Hasznld az AI asszisztensnket, kpkeresnket s szobaterveznket.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 xl:gap-8\">\n          {features.map((item, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl sm:rounded-2xl lg:rounded-3xl p-4 sm:p-5 lg:p-6 xl:p-8 hover:bg-white/20 transition-all transform hover:-translate-y-1 cursor-pointer group\"\n            >\n              <GradientIcon \n                icon={item.icon} \n                gradient={item.gradient}\n                size=\"lg\"\n                className=\"mb-3 sm:mb-4 lg:mb-5 group-hover:scale-110 transition-transform\"\n              />\n              <h3 className=\"text-base sm:text-lg lg:text-xl xl:text-2xl font-bold mb-1.5 sm:mb-2 lg:mb-3\">{item.title}</h3>\n              <p className=\"text-white/80 text-xs sm:text-sm lg:text-base xl:text-lg mb-3 sm:mb-4 lg:mb-5 leading-relaxed\">{item.description}</p>\n              <div className=\"flex items-center text-xs sm:text-sm lg:text-base font-bold text-yellow-300 group-hover:text-yellow-200 transition-colors\">\n                Prbld ki <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5 ml-1 group-hover:translate-x-1 transition-transform\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <style>\n        {`\n          @keyframes blob {\n            0%, 100% { transform: translate(0, 0) scale(1); }\n            33% { transform: translate(30px, -50px) scale(1.1); }\n            66% { transform: translate(-20px, 20px) scale(0.9); }\n          }\n          .animate-blob {\n            animation: blob 7s infinite;\n          }\n          .animation-delay-2000 {\n            animation-delay: 2s;\n          }\n          .animation-delay-4000 {\n            animation-delay: 4s;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\n/**\n * AI Onboarding Tooltip\n */\nexport const AIOnboarding = ({ isOpen, onClose, targetFeature }) => {\n  if (!isOpen) return null;\n\n  const messages = {\n    chat: {\n      title: 'Prbld ki az AI Asszisztenst!',\n      description: 'Krdezz brmit a termkekrl, s azonnal vlaszt kapsz.',\n      tip: 'Pldul: \"Keresek egy skandinv kanapt 200.000 Ft alatt\"',\n      icon: MessageCircle\n    },\n    visualSearch: {\n      title: 'AI Kpkeres',\n      description: 'Tlts fel egy kpet, s megmutatjuk a hasonl termkeket.',\n      tip: 'Fotzd le a btort ami tetszik, mi megtalljuk!',\n      icon: Camera\n    },\n    roomPlanner: {\n      title: 'Virtulis Szobatervez',\n      description: 'Helyezd el a btorokat a sajt szobdban, s lsd lben.',\n      tip: 'Tlts fel egy fott a szobdrl, s kezdj el tervezni!',\n      icon: Home\n    }\n  };\n\n  const content = messages[targetFeature] || messages.chat;\n  const TipIcon = content.icon || Lightbulb;\n\n  return (\n    <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4\" onClick={onClose}>\n      <div className=\"bg-white rounded-2xl lg:rounded-3xl p-6 sm:p-8 lg:p-10 max-w-md lg:max-w-lg xl:max-w-xl w-full shadow-2xl animate-scale-in\" onClick={e => e.stopPropagation()}>\n        <div className=\"flex items-center justify-between mb-4 lg:mb-6\">\n          <div className=\"flex items-center gap-3 lg:gap-4\">\n            <div className=\"w-10 h-10 lg:w-12 lg:h-12 xl:w-14 xl:h-14 bg-primary-100 rounded-xl lg:rounded-2xl flex items-center justify-center\">\n              <Sparkles className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 text-primary-500 animate-pulse\" />\n            </div>\n            <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">{content.title}</h3>\n          </div>\n          <button onClick={onClose} className=\"w-8 h-8 lg:w-10 lg:h-10 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\">\n            <X className=\"w-5 h-5 lg:w-6 lg:h-6\" />\n          </button>\n        </div>\n        <p className=\"text-gray-600 mb-4 lg:mb-6 text-sm sm:text-base lg:text-lg xl:text-xl\">{content.description}</p>\n        <div className=\"bg-primary-50 border border-primary-100 rounded-xl lg:rounded-2xl p-3 sm:p-4 lg:p-5 mb-6 lg:mb-8 flex items-start gap-3 lg:gap-4\">\n          <div className=\"w-8 h-8 lg:w-10 lg:h-10 bg-primary-100 rounded-lg lg:rounded-xl flex items-center justify-center shrink-0\">\n            <Lightbulb className=\"w-4 h-4 lg:w-5 lg:h-5 text-primary-500\" />\n          </div>\n          <div>\n            <p className=\"text-xs lg:text-sm font-semibold text-primary-500 mb-1\">Tipp</p>\n            <p className=\"text-sm lg:text-base xl:text-lg text-primary-600\">{content.tip}</p>\n          </div>\n        </div>\n        <button \n          onClick={onClose}\n          className=\"w-full bg-primary-500 text-white py-3 lg:py-4 xl:py-5 rounded-xl lg:rounded-2xl font-bold text-base lg:text-lg xl:text-xl hover:bg-primary-600 transition-colors min-h-[44px] lg:min-h-[52px] xl:min-h-[60px]\"\n        >\n          rtem, kezdjk!\n        </button>\n      </div>\n      <style>\n        {`\n          @keyframes scale-in {\n            from {\n              transform: scale(0.9);\n              opacity: 0;\n            }\n            to {\n              transform: scale(1);\n              opacity: 1;\n            }\n          }\n          .animate-scale-in {\n            animation: scale-in 0.2s ease-out;\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { ChevronDown, ChevronUp, ChevronLeft, ChevronRight, Grid3X3 } from 'lucide-react';\nimport { CategoryIcon } from '../ui/Icons';\n\n/**\n * CategorySwipe - Golden Standard Responsive Category Navigation\n * Typography: Mobile 13-14px, Tablet 14px, Desktop 14-15px\n * Touch targets: 44px minimum\n */\nconst CategorySwipe = ({ categories, activeCategory, onCategoryChange, displayedCount, activeTotalOverride }) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [canScrollLeft, setCanScrollLeft] = useState(false);\n  const [canScrollRight, setCanScrollRight] = useState(true);\n  const scrollRef = useRef(null);\n  \n  const activeData = categories.find(c => c.id === activeCategory);\n  const activeTotalCount = typeof activeTotalOverride === 'number' ? activeTotalOverride : (activeData?.totalCount || 0);\n  \n  const VISIBLE_MOBILE = 15;\n  const VISIBLE_DESKTOP = 18;\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() => {\n    const checkMobile = () => setIsMobile(window.innerWidth < 768);\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n  \n  const visibleCount = isMobile ? VISIBLE_MOBILE : VISIBLE_DESKTOP;\n  const visibleCategories = isExpanded ? categories : categories.slice(0, visibleCount);\n  const hasMore = categories.length > visibleCount;\n  \n  const updateScrollIndicators = () => {\n    if (scrollRef.current) {\n      const { scrollLeft, scrollWidth, clientWidth } = scrollRef.current;\n      setCanScrollLeft(scrollLeft > 5);\n      setCanScrollRight(scrollLeft < scrollWidth - clientWidth - 5);\n    }\n  };\n\n  useEffect(() => {\n    updateScrollIndicators();\n    const el = scrollRef.current;\n    if (!el) return;\n    let rafId = null;\n    const onScroll = () => {\n      if (rafId != null) return;\n      rafId = requestAnimationFrame(() => {\n        updateScrollIndicators();\n        rafId = null;\n      });\n    };\n    el.addEventListener('scroll', onScroll, { passive: true });\n    return () => {\n      if (rafId != null) cancelAnimationFrame(rafId);\n      el.removeEventListener('scroll', onScroll);\n    };\n  }, [categories]);\n  \n  const scroll = (direction) => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollBy({ \n        left: direction === 'left' ? -200 : 200, \n        behavior: 'smooth' \n      });\n    }\n  };\n\n  useEffect(() => {\n    if (scrollRef.current && isMobile) {\n      const activeEl = scrollRef.current.querySelector(`[data-category=\"${activeCategory}\"]`);\n      activeEl?.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });\n    }\n  }, [activeCategory, isMobile]);\n\n  return (\n    <div className=\"bg-white rounded-xl sm:rounded-2xl lg:rounded-3xl shadow-sm border border-gray-100 mb-4 sm:mb-6 lg:mb-8 xl:mb-10 overflow-hidden\">\n      {/* Header - UNIFIED spacing */}\n      <div className=\"px-3 sm:px-5 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-6 xl:py-7 bg-gradient-to-r from-primary-50/80 via-secondary-50/50 to-pink-50/30 border-b border-gray-100\">\n        <div className=\"flex items-center justify-between gap-3 lg:gap-6\">\n          <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-5 min-w-0\">\n            <div className=\"w-10 h-10 sm:w-12 sm:h-12 lg:w-16 lg:h-16 xl:w-20 xl:h-20 rounded-xl lg:rounded-2xl xl:rounded-3xl bg-primary-100 flex items-center justify-center shrink-0\">\n              <Grid3X3 className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 xl:w-10 xl:h-10 text-primary-500\" />\n            </div>\n            <div className=\"min-w-0\">\n              <h3 className=\"text-base sm:text-lg lg:text-2xl xl:text-3xl font-bold text-gray-900\">Kategrik</h3>\n              <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-500 hidden sm:block\">{categories.length} kategria</p>\n            </div>\n          </div>\n          \n          {/* Counter - UNIFIED */}\n          <div className=\"text-right shrink-0\">\n            <div className=\"text-sm sm:text-base lg:text-xl xl:text-2xl text-gray-700\">\n              <span className=\"font-bold text-primary-500\">{displayedCount?.toLocaleString('hu-HU') || 0}</span>\n              <span className=\"text-gray-400 mx-1\">/</span>\n              <span className=\"font-semibold\">{activeTotalCount.toLocaleString('hu-HU')}</span>\n            </div>\n            <p className=\"text-xs sm:text-sm lg:text-base xl:text-lg text-gray-400\">termk lthat</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Mobile: Horizontal Scroll */}\n      <div className=\"md:hidden relative\">\n        {canScrollLeft && (\n          <>\n            <div className=\"absolute left-0 top-0 bottom-0 w-6 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('left')}\n              className=\"absolute left-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronLeft className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        {canScrollRight && (\n          <>\n            <div className=\"absolute right-0 top-0 bottom-0 w-6 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none\" />\n            <button\n              onClick={() => scroll('right')}\n              className=\"absolute right-1 top-1/2 -translate-y-1/2 z-20 w-8 h-8 bg-white rounded-full shadow-md flex items-center justify-center\"\n            >\n              <ChevronRight className=\"w-4 h-4 text-gray-600\" />\n            </button>\n          </>\n        )}\n        \n        <div \n          ref={scrollRef}\n          className=\"flex gap-2 overflow-x-auto py-3 px-3 scrollbar-hide\"\n        >\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              data-category={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold transition-all whitespace-nowrap\n                flex items-center gap-1.5\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-md'\n                  : 'bg-gray-100 text-gray-700 active:bg-gray-200'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-[11px] font-medium ${category.id === activeCategory ? 'text-white/80' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n          \n          {hasMore && !isExpanded && (\n            <button\n              onClick={() => setIsExpanded(true)}\n              className=\"shrink-0 px-3 py-2.5 min-h-[44px] rounded-xl text-[13px] font-semibold bg-primary-50 text-primary-500 whitespace-nowrap\"\n            >\n              +{categories.length - visibleCount}\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Desktop: Grid Layout - UNIFIED spacing */}\n      <div className=\"hidden md:block p-4 lg:p-6 xl:p-8 2xl:p-10\">\n        <div className=\"flex flex-wrap gap-2 lg:gap-3 xl:gap-4\">\n          {visibleCategories.map((category) => (\n            <button\n              key={category.id}\n              onClick={() => onCategoryChange(category.id)}\n              className={`\n                px-4 lg:px-5 xl:px-7 2xl:px-8 py-2.5 lg:py-3 xl:py-4 rounded-xl lg:rounded-2xl text-sm lg:text-base xl:text-lg 2xl:text-xl font-semibold transition-all\n                flex items-center gap-2 lg:gap-2.5 xl:gap-3\n                ${category.id === activeCategory\n                  ? 'bg-primary-500 text-white shadow-lg scale-[1.02]'\n                  : 'bg-gray-50 text-gray-700 hover:bg-gray-100 hover:shadow-md'\n                }\n              `}\n            >\n              <CategoryIcon name={category.name} className=\"w-4 h-4 lg:w-5 lg:h-5 xl:w-6 xl:h-6 2xl:w-7 2xl:h-7 shrink-0\" />\n              <span>{category.name}</span>\n              {typeof category.totalCount === 'number' && (\n                <span className={`text-xs lg:text-sm font-medium ${category.id === activeCategory ? 'text-white/85' : 'text-gray-500'}`}>\n                  {category.totalCount.toLocaleString('hu-HU')}\n                </span>\n              )}\n            </button>\n          ))}\n        </div>\n\n        {hasMore && (\n          <button\n            onClick={() => setIsExpanded(!isExpanded)}\n            className=\"mt-5 lg:mt-6 xl:mt-8 w-full py-3.5 lg:py-4 xl:py-5 text-base lg:text-lg xl:text-xl 2xl:text-2xl text-primary-500 hover:text-primary-600 font-bold flex items-center justify-center gap-2 lg:gap-3 transition-colors rounded-xl lg:rounded-2xl hover:bg-primary-50\"\n          >\n            {isExpanded ? (\n              <>\n                <ChevronUp className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Kevesebb\n              </>\n            ) : (\n              <>\n                <ChevronDown className=\"w-5 h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7\" />\n                Mind a {categories.length} kategria\n              </>\n            )}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CategorySwipe;\n","/** Placeholder image (data URL)  nem fgg kls szolgltatstl (via.placeholder stb.) */\nexport const PLACEHOLDER_IMAGE = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Crect fill='%23e5e7eb' width='400' height='400'/%3E%3Ctext fill='%239ca3af' x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16'%3ENincs kp%3C/text%3E%3C/svg%3E\";\n\n/**\n * Normalize product from UNAS API (images, inStock)\n */\nexport const normalizeProduct = (p) => ({\n  ...p,\n  images: p.images || (p.image ? [p.image] : []),\n  image: p.images?.[0] || p.image,\n  inStock: p.inStock ?? p.in_stock ?? true\n});\n\n/**\n * Format price to Hungarian currency (safe for null/undefined)\n */\nexport const formatPrice = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', {\n    style: 'currency',\n    currency: 'HUF',\n    maximumFractionDigits: 0\n  }).format(value);\n};\n\n/** Format price as number only (no \"Ft\") - for custom display */\nexport const formatPriceNumber = (price) => {\n  const value = price != null && !Number.isNaN(Number(price)) ? Number(price) : 0;\n  return new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(value);\n};\n\n/**\n * Format relative time (e.g., \"2 rja\")\n */\nexport const formatRelativeTime = (timestamp) => {\n  if (!timestamp) return '';\n  \n  const date = new Date(timestamp);\n  const now = new Date();\n  const diffMs = now - date;\n  const diffMins = Math.floor(diffMs / 60000);\n  \n  if (diffMins < 1) return 'most';\n  if (diffMins < 60) return `${diffMins} perce`;\n  \n  const diffHours = Math.floor(diffMins / 60);\n  if (diffHours < 24) return `${diffHours} rja`;\n  \n  const diffDays = Math.floor(diffHours / 24);\n  if (diffDays < 7) return `${diffDays} napja`;\n  \n  return date.toLocaleDateString('hu-HU');\n};\n\n/**\n * Truncate text with ellipsis\n */\nexport const truncateText = (text, maxLength = 100) => {\n  if (!text) return '';\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength).trim() + '...';\n};\n\n/**\n * Generate random ID\n */\nexport const generateId = () => {\n  return Date.now().toString(36) + Math.random().toString(36).substr(2);\n};\n\n/**\n * Smooth scroll to element\n */\nexport const scrollToElement = (elementId, offset = 0) => {\n  const element = document.getElementById(elementId);\n  if (element) {\n    const top = element.getBoundingClientRect().top + window.pageYOffset - offset;\n    window.scrollTo({ top, behavior: 'smooth' });\n  }\n};\n\n/**\n * Copy to clipboard with fallback\n */\nexport const copyToClipboard = async (text) => {\n  try {\n    if (navigator.clipboard) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback for older browsers\n      const textarea = document.createElement('textarea');\n      textarea.value = text;\n      textarea.style.position = 'fixed';\n      textarea.style.opacity = '0';\n      document.body.appendChild(textarea);\n      textarea.select();\n      const success = document.execCommand('copy');\n      document.body.removeChild(textarea);\n      return success;\n    }\n  } catch (error) {\n    console.error('Failed to copy:', error);\n    return false;\n  }\n};\n\n/**\n * Validate email\n */\nexport const isValidEmail = (email) => {\n  const regex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return regex.test(email);\n};\n\n/**\n * Get contrast color (black or white) based on background\n */\nexport const getContrastColor = (hexColor) => {\n  const r = parseInt(hexColor.substr(1, 2), 16);\n  const g = parseInt(hexColor.substr(3, 2), 16);\n  const b = parseInt(hexColor.substr(5, 2), 16);\n  const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;\n  return (yiq >= 128) ? '#000000' : '#FFFFFF';\n};\n\n/**\n * Shuffle array (Fisher-Yates algorithm)\n */\nexport const shuffleArray = (array) => {\n  const newArray = [...array];\n  for (let i = newArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n  }\n  return newArray;\n};\n\n/**\n * Try to extract stock level from product data\n */\nexport const getStockLevel = (product) => {\n  if (!product) return null;\n  const direct = product.stockLevel ?? product.stock_level ?? product.stock ?? product.stock_qty ?? product.stockQty ?? null;\n  if (typeof direct === 'number' && Number.isFinite(direct)) return direct;\n  const params = product.params || '';\n  if (typeof params !== 'string' || params.length === 0) return null;\n  const match = params.match(/(rakt[a]r|k[e]szlet)[^0-9]{0,8}(\\d{1,3})/i);\n  if (match && match[2]) {\n    const val = parseInt(match[2], 10);\n    return Number.isFinite(val) ? val : null;\n  }\n  return null;\n};\n\n/**\n * Group items by key\n */\nexport const groupBy = (array, key) => {\n  return array.reduce((result, item) => {\n    const group = item[key];\n    if (!result[group]) {\n      result[group] = [];\n    }\n    result[group].push(item);\n    return result;\n  }, {});\n};\n\n/**\n * Calculate reading time\n */\nexport const calculateReadingTime = (text, wordsPerMinute = 200) => {\n  const words = text.trim().split(/\\s+/).length;\n  const minutes = Math.ceil(words / wordsPerMinute);\n  return `${minutes} perc olvass`;\n};\n","import { useRef } from 'react';\n\n/**\n * Image Optimization Utilities\n * WebP conversion, lazy loading, responsive images\n */\n\n/**\n * Convert image URL to WebP format (if CDN supports it)\n * Falls back to original if WebP not supported\n */\nexport const toWebP = (imageUrl, quality = 80) => {\n  if (!imageUrl) return '';\n  \n  // Check if browser supports WebP\n  if (!isWebPSupported()) {\n    return imageUrl;\n  }\n\n  // If it's already a WebP, return as is\n  if (imageUrl.toLowerCase().endsWith('.webp')) {\n    return imageUrl;\n  }\n\n  // For external CDNs that support WebP conversion via query params\n  // Example: Cloudinary, Imgix, etc.\n  // Adjust based on your CDN provider\n  \n  // Generic approach: if URL has query params, append format\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&format=webp&quality=${quality}`;\n  }\n  \n  // Otherwise, try to replace extension (works if your server supports it)\n  return imageUrl.replace(/\\.(jpg|jpeg|png)$/i, '.webp');\n};\n\n/**\n * Check if browser supports WebP\n */\nexport const isWebPSupported = () => {\n  if (typeof window === 'undefined') return false;\n  \n  // Check for cached result\n  if (window._webpSupport !== undefined) {\n    return window._webpSupport;\n  }\n\n  const canvas = document.createElement('canvas');\n  if (canvas.getContext && canvas.getContext('2d')) {\n    // Check for WebP support\n    const support = canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\n    window._webpSupport = support;\n    return support;\n  }\n  \n  window._webpSupport = false;\n  return false;\n};\n\n/**\n * Generate responsive image srcset\n * Creates multiple sizes for different screen resolutions\n */\nexport const getResponsiveSrcSet = (imageUrl, sizes = [400, 800, 1200]) => {\n  if (!imageUrl) return '';\n  \n  return sizes\n    .map(size => {\n      const url = appendSizeParam(imageUrl, size);\n      return `${url} ${size}w`;\n    })\n    .join(', ');\n};\n\n/**\n * Append size parameter to image URL\n */\nconst appendSizeParam = (imageUrl, width) => {\n  if (imageUrl.includes('?')) {\n    return `${imageUrl}&w=${width}`;\n  }\n  return `${imageUrl}?w=${width}`;\n};\n\n/**\n * Lazy load image with Intersection Observer.\n * Returns a ref callback. Callback receives element on mount and null on unmount.\n * Observer is disconnected when element is removed or component unmounts.\n */\nexport const useLazyLoad = () => {\n  const observerRef = useRef(null);\n  if (typeof window === 'undefined' || !('IntersectionObserver' in window)) {\n    return () => {}; // no-op when IO unavailable\n  }\n\n  return (imageElement) => {\n    const prev = observerRef.current;\n    if (prev) {\n      prev.disconnect();\n      observerRef.current = null;\n    }\n    if (!imageElement || !(imageElement instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            const img = entry.target;\n            const src = img.getAttribute('data-src');\n            const srcset = img.getAttribute('data-srcset');\n            if (src) img.src = src;\n            if (srcset) img.srcset = srcset;\n            img.classList.add('loaded');\n            observer.unobserve(img);\n          }\n        });\n      },\n      { rootMargin: '50px 0px', threshold: 0.01 }\n    );\n    try {\n      observer.observe(imageElement);\n      observerRef.current = observer;\n    } catch {\n      observerRef.current = null;\n    }\n  };\n};\n\n/**\n * OptimizedImage Component Helper\n * Returns optimized image props\n */\nexport const getOptimizedImageProps = (imageUrl, alt = '', options = {}) => {\n  const {\n    width,\n    height,\n    quality = 80,\n    lazy = true,\n    responsive = true,\n    className = ''\n  } = options;\n\n  const optimizedUrl = toWebP(imageUrl, quality);\n  const props = {\n    alt,\n    className: `${className} ${lazy ? 'lazy' : ''}`,\n    loading: lazy ? 'lazy' : 'eager',\n    decoding: 'async'\n  };\n\n  if (responsive) {\n    props.srcSet = getResponsiveSrcSet(optimizedUrl);\n    props.sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw';\n  }\n\n  if (lazy) {\n    props['data-src'] = optimizedUrl;\n    props.src = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 300\"%3E%3C/svg%3E'; // Placeholder\n  } else {\n    props.src = optimizedUrl;\n  }\n\n  if (width) props.width = width;\n  if (height) props.height = height;\n\n  return props;\n};\n\n/**\n * Preload critical images\n */\nexport const preloadImage = (imageUrl) => {\n  if (typeof window === 'undefined') return;\n  \n  const link = document.createElement('link');\n  link.rel = 'preload';\n  link.as = 'image';\n  link.href = toWebP(imageUrl);\n  document.head.appendChild(link);\n};\n\n/**\n * Calculate image dimensions to maintain aspect ratio\n */\nexport const calculateAspectRatio = (originalWidth, originalHeight, maxWidth) => {\n  const ratio = originalHeight / originalWidth;\n  return {\n    width: maxWidth,\n    height: Math.round(maxWidth * ratio)\n  };\n};\n\n/**\n * Image compression quality based on screen size\n */\nexport const getAdaptiveQuality = () => {\n  if (typeof window === 'undefined') return 80;\n  \n  const width = window.innerWidth;\n  \n  if (width < 768) {\n    return 70; // Mobile: lower quality\n  } else if (width < 1920) {\n    return 80; // Desktop: medium quality\n  } else {\n    return 90; // Large screens: high quality\n  }\n};\n\nexport default {\n  toWebP,\n  isWebPSupported,\n  getResponsiveSrcSet,\n  useLazyLoad,\n  getOptimizedImageProps,\n  preloadImage,\n  calculateAspectRatio,\n  getAdaptiveQuality\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { Heart, Eye, ShoppingBag, Info, ThumbsUp, ThumbsDown, Bell, ShoppingCart } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\nimport { SmartBadges, StockBadge } from '../ui/Badge';\nimport { getOptimizedImageProps, getAdaptiveQuality } from '../../utils/imageOptimizer';\nimport {\n  trackSectionEvent,\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n// Tiny placeholder for blur-up effect (1x1 transparent pixel)\nconst BLUR_PLACEHOLDER = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1 1\"%3E%3Crect fill=\"%23f3f4f6\" width=\"1\" height=\"1\"/%3E%3C/svg%3E';\n\nconst PLACEHOLDER_IMAGE = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\" viewBox=\"0 0 400 400\"%3E%3Crect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/%3E%3Ctext fill=\"%239ca3af\" font-family=\"sans-serif\" font-size=\"14\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dy=\".3em\"%3ENo Image%3C/text%3E%3C/svg%3E';\n\n/**\n * Enhanced Product Card with:\n * - Blur-up lazy loading images\n * - Smart badges (New, Sale, Popular)\n * - Micro-interactions\n * - Scroll animations\n */\nexport const EnhancedProductCard = ({ \n  product, \n  onToggleWishlist, \n  isWishlisted, \n  onQuickView,\n  onAddToCart,\n  index = 0,\n  highlightBadge,\n  recommendationReasons = [],\n  sectionId,\n  showFeedback = true,\n  size = 'default',\n  tone = 'default',\n  accentClass, // vilg gradiens pl. 'from-pink-500 to-rose-600'  teljes krtys megklnbztets\n  skipScrollAnimation = false, // Worlds: lland megjelens, ne villanjon fel\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [imageError, setImageError] = useState(false);\n  const [isVisible, setIsVisible] = useState(skipScrollAnimation);\n  const [notifySaved, setNotifySaved] = useState(false);\n  const toneClasses = {\n    default: 'lux-card',\n    popular: 'lux-card lux-card--popular',\n    new: 'lux-card lux-card--new',\n    favorites: 'lux-card lux-card--favorites',\n    personal: 'lux-card lux-card--personal'\n  };\n  const sizeClasses = {\n    default: {\n      image: 'p-2 sm:p-3 md:p-4 lg:p-5',\n      content: 'p-3 sm:p-4 md:p-5 lg:p-6',\n      contentMinH: 'min-h-[160px] sm:min-h-[180px]'\n    },\n    compact: {\n      image: 'p-2 sm:p-2.5 md:p-3 lg:p-3.5',\n      content: 'p-2.5 sm:p-3 md:p-4 lg:p-4',\n      contentMinH: 'min-h-[140px] sm:min-h-[155px]'\n    }\n  };\n  const sizeConfig = sizeClasses[size] || sizeClasses.default;\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const cardRef = useRef(null);\n  const impressionRef = useRef(false);\n\n  const images = product.images || [];\n  const mainImage = images[0] || PLACEHOLDER_IMAGE;\n\n  const discount = product.salePrice && product.price > product.salePrice\n    ? Math.round(((product.price - product.salePrice) / product.price) * 100)\n    : 0;\n\n  const displayPrice = product.salePrice || product.price;\n  const inStock = product.inStock ?? product.in_stock ?? true;\n  const reasonsText = recommendationReasons && recommendationReasons.length > 0\n    ? recommendationReasons.slice(0, 2).join('  ')\n    : '';\n  const optimizedProps = getOptimizedImageProps(mainImage, product.name, { responsive: true, lazy: false, quality: getAdaptiveQuality() });\n\n  // Intersection Observer for scroll animation  kihagyva ha skipScrollAnimation (Worlds)\n  const timeoutRef = useRef(null);\n  useEffect(() => {\n    if (skipScrollAnimation) return;\n    const element = cardRef.current;\n    if (!element || !(element instanceof Element)) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          const delay = Math.min((index % 4) * 25, 100);\n          if (delay > 0) {\n            timeoutRef.current = setTimeout(() => setIsVisible(true), delay);\n          } else {\n            setIsVisible(true);\n          }\n          observer.disconnect();\n        }\n      },\n      { threshold: 0.05, rootMargin: '100px 0px' }\n    );\n\n    try {\n      observer.observe(element);\n    } catch {\n      return;\n    }\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      observer.disconnect();\n    };\n  }, [index, skipScrollAnimation]);\n\n  useEffect(() => {\n    if (sectionId && isVisible && !impressionRef.current) {\n      impressionRef.current = true;\n      trackSectionEvent(sectionId, 'impression', product?.id);\n    }\n  }, [sectionId, isVisible, product?.id]);\n\n  useEffect(() => {\n    if (!product?.id) return;\n    setFeedbackState({\n      liked: isProductLiked(product.id),\n      disliked: isProductDisliked(product.id)\n    });\n  }, [product?.id]);\n\n  const handleQuickView = () => {\n    if (sectionId) trackSectionEvent(sectionId, 'click', product?.id);\n    onQuickView?.(product);\n  };\n\n  const handleNotify = (e) => {\n    e.stopPropagation();\n    requestBackInStock(product);\n    setNotifySaved(true);\n    setTimeout(() => setNotifySaved(false), 2000);\n  };\n\n  const hasWorldAccent = accentClass && (tone === 'favorites' || tone === 'new' || tone === 'popular');\n  const worldGlow = hasWorldAccent && {\n    favorites: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(244,63,94,0.18) 0%, transparent 50%)',\n    new: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(139,92,246,0.18) 0%, transparent 50%)',\n    popular: 'radial-gradient(ellipse 120% 120% at 0% 0%, rgba(251,191,36,0.18) 0%, transparent 50%)',\n  }[tone];\n  const worldCorner = hasWorldAccent && {\n    favorites: 'linear-gradient(135deg, rgba(244,63,94,0.45) 0%, transparent 40%)',\n    new: 'linear-gradient(135deg, rgba(139,92,246,0.45) 0%, transparent 40%)',\n    popular: 'linear-gradient(135deg, rgba(251,191,36,0.45) 0%, transparent 40%)',\n  }[tone];\n\n  return (\n    <article \n      ref={cardRef}\n      className={`\n        group relative rounded-lg overflow-hidden bg-white border border-gray-200 shadow-sm\n        hover:shadow-md hover:border-gray-300 hover:-translate-y-0.5 active:scale-[0.99]\n        h-full flex flex-col touch-manipulation\n        ${toneClasses[tone] || ''}\n        ${isVisible ? 'opacity-100' : 'opacity-0 translate-y-3'}\n        transition-all duration-200\n      `}\n      style={{ willChange: isVisible ? 'auto' : 'opacity, transform' }}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Vilg dizjn  krtya elejn, nem mlyen (magas z-index, de badge/wishlist alatt) */}\n      {hasWorldAccent && (\n        <>\n          <div className=\"absolute inset-0 z-[1] pointer-events-none\" style={{ background: worldGlow }} aria-hidden />\n          <div className=\"absolute top-0 left-0 w-16 h-16 z-[2] pointer-events-none\" style={{ background: worldCorner, clipPath: 'polygon(0 0, 100% 0, 0 100%)' }} aria-hidden />\n          <div className={`absolute top-0 left-0 right-0 h-2 sm:h-2.5 bg-gradient-to-r ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n          <div className={`absolute top-0 left-0 h-10 sm:h-12 w-0.5 sm:w-1 bg-gradient-to-b ${accentClass} z-[2] pointer-events-none`} aria-hidden />\n        </>\n      )}\n      {/* Smart Badges - kisebb mobilon */}\n      <div className=\"absolute top-2 sm:top-3 left-2 sm:left-3 z-20\">\n        <SmartBadges product={product} maxBadges={2} />\n        {highlightBadge && (\n          <span className=\"mt-1.5 inline-flex items-center px-2 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-700\">\n            {highlightBadge}\n          </span>\n        )}\n      </div>\n\n      {/* Wishlist Button - min 44px touch target mobilon */}\n      <button \n        onClick={(e) => { \n          e.stopPropagation(); \n          onToggleWishlist?.(product.id); \n        }} \n        className={`\n          absolute top-2 sm:top-3 right-2 sm:right-4 z-20\n          min-w-[44px] min-h-[44px] w-10 h-10 sm:w-11 sm:h-11 lg:w-12 lg:h-12 flex items-center justify-center \n          rounded-full shadow-md tap-scale touch-manipulation\n          ${isWishlisted \n            ? 'bg-red-500 text-white' \n            : 'bg-white/95 text-gray-500 hover:text-red-500'\n          }\n          focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n        `}\n        style={{ transition: 'background-color 0.15s, color 0.15s' }}\n        aria-label={isWishlisted ? 'Eltvolts' : 'Kedvencekhez'}\n      >\n        <Heart className={`w-5 h-5 sm:w-5 sm:h-5 lg:w-6 lg:h-6 ${isWishlisted ? 'fill-current' : ''}`} />\n      </button>\n\n      {reasonsText && (\n        <div className=\"absolute top-14 sm:top-16 right-3 sm:right-4 z-20 group\">\n          <button\n            type=\"button\"\n            className=\"w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center rounded-full bg-white/95 text-gray-500 shadow-md hover:text-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Mirt ezt ajnljuk?\"\n            title={reasonsText}\n          >\n            <Info className=\"w-4 h-4\" />\n          </button>\n          <div className=\"absolute right-0 mt-2 w-56 p-2 rounded-lg bg-gray-900 text-white text-xs opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity shadow-xl\">\n            {reasonsText}\n          </div>\n        </div>\n      )}\n\n      {/* Image Section - FILL the space */}\n      <div \n        onClick={handleQuickView} \n        className=\"relative aspect-square overflow-hidden ecom-card__image cursor-pointer\"\n      >\n        {/* Simple placeholder */}\n        {!imageLoaded && (\n          <div className=\"absolute inset-0 bg-gray-100\" />\n        )}\n        \n        {/* Actual image - width/height prevents CLS */}\n        <img \n          src={imageError ? PLACEHOLDER_IMAGE : (optimizedProps.src || mainImage)}\n          alt={product.name}\n          width={400}\n          height={400}\n          className={`\n            w-full h-full object-contain ${sizeConfig.image}\n            transition-opacity duration-300 ease-out\n            ${imageLoaded ? 'opacity-100' : 'opacity-0'}\n          `}\n          style={{ transform: 'translateZ(0)' }}\n          srcSet={optimizedProps.srcSet}\n          sizes={optimizedProps.sizes}\n          loading=\"lazy\"\n          decoding=\"async\"\n          onLoad={() => setImageLoaded(true)}\n          onError={() => { setImageError(true); setImageLoaded(true); }}\n        />\n\n        {!inStock && (\n          <div className=\"absolute inset-0 bg-white/70 backdrop-blur-[1px] flex items-center justify-center\">\n            <div className=\"flex flex-col items-center gap-2\">\n              <span className=\"px-3 py-1.5 rounded-full bg-gray-900 text-white text-xs font-bold tracking-wide\">\n                Elfogyott\n              </span>\n              <button\n                type=\"button\"\n                onClick={handleNotify}\n                className=\"px-3 py-1.5 rounded-full bg-white text-gray-800 text-xs font-semibold border border-gray-200 hover:bg-gray-50 flex items-center gap-1\"\n              >\n                <Bell className=\"w-3.5 h-3.5\" />\n                {notifySaved ? 'Elmentve' : 'rtestst krek'}\n              </button>\n            </div>\n          </div>\n        )}\n        \n        {/* Stock badge - kompakt mobilon */}\n        <div className=\"absolute bottom-1.5 sm:bottom-2.5 left-1.5 sm:left-2.5\">\n          <StockBadge inStock={inStock} size=\"sm\" />\n        </div>\n        \n        {/* Desktop hover overlay */}\n        <div \n          className=\"hidden md:flex absolute inset-0 bg-black/40 items-end justify-center pb-6 lg:pb-8 transition-opacity duration-200\"\n          style={{ opacity: isHovered ? 1 : 0, pointerEvents: isHovered ? 'auto' : 'none' }}\n        >\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onQuickView?.(product);\n            }}\n            className=\"bg-white text-gray-900 px-6 py-3 lg:px-8 lg:py-3.5 rounded-full text-base lg:text-lg font-bold shadow-lg flex items-center gap-2 hover:bg-gray-50 tap-scale focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n          >\n            <Eye className=\"w-5 h-5 lg:w-6 lg:h-6\" /> \n            Megnzem\n          </button>\n        </div>\n      </div>\n\n      {/* Content Section - gombok alul, kzpre, magasabb krtya */}\n      <div className={`${sizeConfig.content} ${sizeConfig.contentMinH || 'min-h-[160px]'} flex flex-col flex-1`}>\n        {/* Category - kompakt */}\n        <span className=\"text-xs sm:text-sm font-semibold text-primary-600 uppercase tracking-wide mb-1 truncate\">\n          {product.category}\n        </span>\n        \n        {/* Product Name - 2 sor, biztosan frjen ki, kompakt betmret */}\n        <h3 \n          onClick={handleQuickView} \n          className=\"text-xs sm:text-sm lg:text-base font-bold text-gray-900 line-clamp-2 leading-tight cursor-pointer hover:text-primary-600 active:text-primary-700 transition-colors mb-2 min-h-[2.4em] overflow-hidden touch-manipulation\" \n          title={product.name}\n        >\n          {product.name}\n        </h3>\n        \n        {/* r - nagy, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"pt-2 sm:pt-3 border-t border-gray-100 text-center space-y-1 min-w-0\">\n          {discount > 0 ? (\n            <>\n              <span className=\"text-sm sm:text-base text-red-600 line-through block font-semibold\">\n                {formatPrice(product.price)}\n              </span>\n              <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-red-600 block\">\n                {formatPrice(displayPrice)}\n              </span>\n              <span className=\"inline-block px-2 py-1 rounded-md bg-red-100 text-red-700 text-xs sm:text-sm font-black\">\n                -{discount}%\n              </span>\n            </>\n          ) : (\n            <span className=\"text-lg sm:text-xl lg:text-2xl font-black text-gray-900 block\">\n              {formatPrice(displayPrice)}\n            </span>\n          )}\n        </div>\n        \n        {/* Tetszik / Nem tetszik - ikonok csak, kzpre, a CTA gombok fl */}\n        {showFeedback && (\n          <div className=\"mt-3 flex justify-center items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleLikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.liked\n                  ? 'bg-green-500 text-white'\n                  : 'bg-green-50 text-green-600 hover:bg-green-100'\n              }`}\n              aria-label={feedbackState.liked ? 'Tetszik (eltvolts)' : 'Tetszik'}\n            >\n              <ThumbsUp className=\"w-5 h-5\" />\n            </button>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setFeedbackState(toggleDislikeProduct(product));\n              }}\n              className={`min-w-[44px] min-h-[44px] flex items-center justify-center rounded-full transition-colors tap-scale touch-manipulation ${\n                feedbackState.disliked\n                  ? 'bg-red-500 text-white'\n                  : 'bg-red-50 text-red-500 hover:bg-red-100'\n              }`}\n              aria-label={feedbackState.disliked ? 'Nem tetszik (eltvolts)' : 'Nem tetszik'}\n            >\n              <ThumbsDown className=\"w-5 h-5\" />\n            </button>\n          </div>\n        )}\n        \n        {/* CTA gombok - Kosrba hangslyosabb */}\n        <div className=\"mt-3 sm:mt-4 flex justify-center items-center gap-2 sm:gap-3\">\n          {inStock && onAddToCart && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                onAddToCart(product, 1);\n              }}\n              className=\"min-h-[44px] flex-1 sm:flex-initial flex items-center justify-center gap-1.5 px-4 py-2.5 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 active:bg-emerald-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 shadow-lg shadow-emerald-500/30 font-bold text-sm sm:text-base\"\n              aria-label=\"Kosrba\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-5 h-5 shrink-0\" />\n              <span>Kosrba</span>\n            </button>\n          )}\n          <button \n            onClick={(e) => { \n              e.stopPropagation(); \n              handleQuickView(); \n            }} \n            className=\"min-h-[44px] min-w-[44px] flex items-center justify-center p-2.5 sm:px-4 sm:py-2.5 bg-primary-500 text-white rounded-xl hover:bg-primary-600 active:bg-primary-700 transition-all tap-scale touch-manipulation focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\"\n            aria-label=\"Megnzem\"\n            title=\"Megnzem\"\n          >\n            <Eye className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n            <span className=\"hidden sm:inline text-sm font-bold ml-1.5\">Megnzem</span>\n          </button>\n        </div>\n      </div>\n    </article>\n  );\n};\n\nexport default EnhancedProductCard;\n","import React, { useMemo, useState, useEffect, useRef, useCallback } from 'react';\nimport { \n  ArrowLeft, TrendingUp, Package, Tag, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown,\n  ChevronRight, Filter, Grid3X3, List, Star, Home,\n  ArrowUpDown, SlidersHorizontal, X, Check, LayoutGrid,\n  Rows3, Plus, GitCompare, ChevronDown, ChevronUp, BookOpen,\n  ShieldCheck, MapPin\n} from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { formatPrice } from '../../utils/helpers';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getLikedProducts, getViewedProducts, toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\n\nconst PRESET_STORAGE_KEY = 'mkt_category_presets';\n\n/**\n * Category Images - unsplash stock photos by category\n */\nconst CATEGORY_IMAGES = {\n  'Kanap': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Kanapk': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80',\n  'Fotel': 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=1200&q=80',\n  'Nappali': 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=1200&q=80',\n  'gy': 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=1200&q=80',\n  'Hlszoba': 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=1200&q=80',\n  'Matrac': 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=1200&q=80',\n  'Asztal': 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=1200&q=80',\n  'Szk': 'https://images.unsplash.com/photo-1503602642458-232111445657?w=1200&q=80',\n  'Iroda': 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=1200&q=80',\n  'Szekrny': 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=1200&q=80',\n  'Lmpa': 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=1200&q=80',\n  'Kert': 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=1200&q=80',\n  'default': 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=1200&q=80'\n};\n\nconst getCategoryImage = (name) => {\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (name?.toLowerCase().includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n\n/**\n * Category color themes\n */\nconst getCategoryTheme = (categoryName) => {\n  const themes = {\n    'Kanap': { gradient: 'from-blue-600/90 to-primary-700/90', accent: 'indigo' },\n    'Fotel': { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'purple' },\n    'Nappali': { gradient: 'from-secondary-700/90 to-secondary-800/90', accent: 'violet' },\n    'gy': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'purple' },\n    'Hlszoba': { gradient: 'from-secondary-700/90 to-pink-800/90', accent: 'pink' },\n    'Asztal': { gradient: 'from-amber-600/90 to-orange-800/90', accent: 'amber' },\n    'Szk': { gradient: 'from-yellow-600/90 to-amber-800/90', accent: 'yellow' },\n    'Iroda': { gradient: 'from-slate-600/90 to-gray-800/90', accent: 'slate' },\n    'Szekrny': { gradient: 'from-teal-600/90 to-cyan-800/90', accent: 'teal' },\n    'Lmpa': { gradient: 'from-yellow-500/90 to-orange-700/90', accent: 'yellow' },\n    'Kert': { gradient: 'from-green-600/90 to-emerald-800/90', accent: 'green' },\n    default: { gradient: 'from-primary-500/90 to-secondary-800/90', accent: 'indigo' }\n  };\n  \n  for (const [key, theme] of Object.entries(themes)) {\n    if (categoryName?.toLowerCase().includes(key.toLowerCase())) return theme;\n  }\n  return themes.default;\n};\n\n/**\n * Breadcrumb Navigation\n */\nconst Breadcrumb = ({ category, onBack }) => (\n  <nav className=\"flex items-center gap-2 text-sm mb-4 animate-fade-in\">\n    <button onClick={onBack} className=\"flex items-center gap-1 text-white/70 hover:text-white transition-colors\">\n      <Home className=\"w-4 h-4\" />\n      <span>Foldal</span>\n    </button>\n    <ChevronRight className=\"w-4 h-4 text-white/50\" />\n    <span className=\"text-white font-medium\">{category}</span>\n  </nav>\n);\n\n/**\n * Category Hero with Image Background\n */\nconst CategoryHero = ({ category, productCount, theme, onBack }) => {\n  const CategoryIcon = getCategoryIcon(category);\n  const bgImage = getCategoryImage(category);\n  \n  return (\n    <div className=\"relative overflow-hidden\">\n      {/* Background Image */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center\"\n        style={{ backgroundImage: `url(${bgImage})` }}\n      />\n      \n      {/* Gradient Overlay */}\n      <div className={`absolute inset-0 bg-gradient-to-br ${theme.gradient}`} />\n      \n      {/* Content - FULL WIDTH and LARGER on desktop */}\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 xl:py-36 text-white\">\n        <Breadcrumb category={category} onBack={onBack} />\n        \n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6 sm:gap-10 lg:gap-14\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 lg:w-36 lg:h-36 xl:w-40 xl:h-40 bg-white/20 backdrop-blur rounded-2xl lg:rounded-3xl flex items-center justify-center animate-scale-in\">\n            <CategoryIcon className=\"w-10 h-10 sm:w-14 sm:h-14 lg:w-18 lg:h-18 xl:w-20 xl:h-20 text-white\" />\n          </div>\n          \n          <div className=\"animate-fade-in-up\">\n            <h1 className=\"text-4xl sm:text-6xl lg:text-7xl xl:text-8xl font-bold mb-3 lg:mb-5\">\n              {category}\n            </h1>\n            <p className=\"text-white/80 text-lg sm:text-xl lg:text-2xl xl:text-3xl\">\n              <span className=\"font-semibold text-white\">{productCount.toLocaleString('hu-HU')}</span> termk ebben a kategriban\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Sidebar Filters\n */\nconst SidebarFilters = ({ \n  products, \n  filters, \n  onFilterChange, \n  priceRange, \n  onPriceRangeChange,\n  isOpen,\n  onClose\n}) => {\n  // Extract unique values from products\n  const filterOptions = useMemo(() => {\n    const brands = new Map();\n    const colors = new Map();\n    \n    products.forEach(p => {\n      if (p.brand) brands.set(p.brand, (brands.get(p.brand) || 0) + 1);\n      if (p.color) colors.set(p.color, (colors.get(p.color) || 0) + 1);\n    });\n    \n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    const minPrice = Math.min(...prices) || 0;\n    const maxPrice = Math.max(...prices) || 1000000;\n    \n    return {\n      brands: Array.from(brands.entries()).sort((a, b) => b[1] - a[1]),\n      colors: Array.from(colors.entries()).sort((a, b) => b[1] - a[1]),\n      priceMin: minPrice,\n      priceMax: maxPrice\n    };\n  }, [products]);\n\n  const previewCounts = useMemo(() => {\n    const brandCounts = new Map();\n    const colorCounts = new Map();\n    let inStock = 0;\n\n    products.forEach((p) => {\n      const price = p.salePrice || p.price || 0;\n      if (price < priceRange[0] || price > priceRange[1]) return;\n\n      const isInStock = p.inStock ?? p.in_stock ?? true;\n      const brandOk = !filters.brands?.length || filters.brands.includes(p.brand);\n      const colorOk = !filters.colors?.length || filters.colors.includes(p.color);\n\n      if (brandOk && colorOk && isInStock) inStock += 1;\n\n      const baseForBrand = (filters.inStockOnly ? isInStock : true) && colorOk;\n      if (baseForBrand && p.brand) {\n        brandCounts.set(p.brand, (brandCounts.get(p.brand) || 0) + 1);\n      }\n\n      const baseForColor = (filters.inStockOnly ? isInStock : true) && brandOk;\n      if (baseForColor && p.color) {\n        colorCounts.set(p.color, (colorCounts.get(p.color) || 0) + 1);\n      }\n    });\n\n    return { brands: brandCounts, colors: colorCounts, inStock };\n  }, [products, filters, priceRange]);\n\n  const toggleFilter = (type, value) => {\n    const current = filters[type] || [];\n    const updated = current.includes(value)\n      ? current.filter(v => v !== value)\n      : [...current, value];\n    onFilterChange({ ...filters, [type]: updated });\n  };\n\n  const FilterSection = ({ title, items, type, icon: Icon }) => (\n    <div className=\"border-b border-gray-100 pb-4 mb-4\">\n      <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n        {Icon && <Icon className=\"w-4 h-4 text-gray-400\" />}\n        {title}\n      </h4>\n      <div className=\"space-y-2 max-h-40 overflow-y-auto\">\n        {items.map(([item, count]) => {\n          const preview = type === 'brands'\n            ? previewCounts.brands.get(item)\n            : type === 'colors'\n              ? previewCounts.colors.get(item)\n              : count;\n          return (\n          <label key={item} className=\"flex items-center justify-between gap-2 cursor-pointer group\">\n            <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              checked={(filters[type] || []).includes(item)}\n              onChange={() => toggleFilter(type, item)}\n              className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n            />\n            <span className=\"text-sm text-gray-600 group-hover:text-gray-900\">{item}</span>\n            </div>\n            <span className=\"text-xs text-gray-400\">{preview ?? count}</span>\n          </label>\n        )})}\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div className=\"p-4 sm:p-0\">\n      <div className=\"flex items-center justify-between mb-6 sm:hidden\">\n        <h3 className=\"text-lg font-bold text-gray-900\">Szrk</h3>\n        <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-lg\">\n          <X className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Price Range */}\n      <div className=\"border-b border-gray-100 pb-4 mb-4\">\n        <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2\">\n          <Tag className=\"w-4 h-4 text-gray-400\" />\n          rtartomny\n        </h4>\n        <div className=\"space-y-3\">\n          <input\n            type=\"range\"\n            min={filterOptions.priceMin}\n            max={filterOptions.priceMax}\n            value={priceRange[1]}\n            onChange={(e) => onPriceRangeChange([priceRange[0], parseInt(e.target.value)])}\n            className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n          />\n          <div className=\"flex justify-between text-sm text-gray-500\">\n            <span>{priceRange[0].toLocaleString('hu-HU')} Ft</span>\n            <span>{priceRange[1].toLocaleString('hu-HU')} Ft</span>\n          </div>\n        </div>\n      </div>\n\n      {filterOptions.brands.length > 0 && (\n        <FilterSection title=\"Mrka\" items={filterOptions.brands} type=\"brands\" icon={Package} />\n      )}\n      \n      {filterOptions.colors.length > 0 && (\n        <FilterSection title=\"Szn\" items={filterOptions.colors} type=\"colors\" icon={Tag} />\n      )}\n\n      {/* Stock Filter */}\n      <div className=\"pb-4\">\n        <label className=\"flex items-center gap-2 cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={filters.inStockOnly}\n            onChange={() => onFilterChange({ ...filters, inStockOnly: !filters.inStockOnly })}\n            className=\"w-4 h-4 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n          />\n          <span className=\"text-sm text-gray-700\">Csak kszleten ({previewCounts.inStock})</span>\n        </label>\n      </div>\n\n      {/* Clear Filters */}\n      <button\n        onClick={() => onFilterChange({})}\n        className=\"w-full py-2 text-sm text-primary-500 hover:text-primary-600 font-medium\"\n      >\n        Szrk trlse\n      </button>\n    </div>\n  );\n\n  return (\n    <>\n      {/* Desktop Sidebar */}\n      <div className=\"hidden lg:block w-64 shrink-0\">\n        <div className=\"sticky top-24 bg-white rounded-2xl border border-gray-100 p-5\">\n          <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n            <SlidersHorizontal className=\"w-5 h-5\" />\n            Szrk\n          </h3>\n          {content}\n        </div>\n      </div>\n\n      {/* Mobile Drawer */}\n      {isOpen && (\n        <div className=\"lg:hidden fixed inset-0 z-50\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={onClose} />\n          <div className=\"absolute right-0 top-0 bottom-0 w-80 max-w-full bg-white animate-fade-in-right\">\n            {content}\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Related Categories\n */\nconst RelatedCategories = ({ currentCategory, allCategories, onCategoryChange }) => {\n  // Find related categories (same \"type\" or popular ones)\n  const related = useMemo(() => {\n    return allCategories\n      .filter(cat => cat.name !== currentCategory && cat.name !== 'sszes' && cat.count > 0)\n      .slice(0, 6);\n  }, [allCategories, currentCategory]);\n\n  if (related.length === 0) return null;\n\n  return (\n    <div className=\"bg-gray-50 rounded-2xl p-4 sm:p-6 mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Grid3X3 className=\"w-5 h-5 text-gray-400\" />\n        Kapcsold kategrik\n      </h3>\n      <div className=\"flex flex-wrap gap-2\">\n        {related.map(cat => {\n          const Icon = getCategoryIcon(cat.name);\n          return (\n            <button\n              key={cat.name}\n              onClick={() => onCategoryChange(cat.name)}\n              className=\"flex items-center gap-2 px-3 py-2 bg-white rounded-xl border border-gray-200 hover:border-primary-300 hover:bg-primary-50 transition-colors tap-scale\"\n            >\n              <Icon className=\"w-4 h-4 text-gray-500\" />\n              <span className=\"text-sm font-medium text-gray-700\">{cat.name}</span>\n              <span className=\"text-xs text-gray-400\">({cat.count})</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Category Story Blocks\n */\nconst CategoryStory = ({ category }) => {\n  const base = category || 'Kategria';\n  const blocks = [\n    {\n      title: `${base} trtnet`,\n      text: 'Vlogatott anyagok, tarts szerkezet, idtll forma.',\n      icon: BookOpen\n    },\n    {\n      title: 'Anyag s komfort',\n      text: 'Llegz szvetek, masszv fa/fm vz, knyelmes hasznlat.',\n      icon: ShieldCheck\n    },\n    {\n      title: 'Elhelyezs',\n      text: 'Nappali, hl vagy iroda? Segtnk az idelis mret kivlasztsban.',\n      icon: MapPin\n    }\n  ];\n\n  return (\n    <div className=\"grid gap-4 sm:gap-6 sm:grid-cols-2 lg:grid-cols-3 mb-6\">\n      {blocks.map((block) => {\n        const Icon = block.icon;\n        return (\n          <div key={block.title} className=\"bg-white rounded-2xl border border-gray-100 p-4 sm:p-5 shadow-sm\">\n            <div className=\"w-10 h-10 rounded-xl bg-primary-50 text-primary-600 flex items-center justify-center mb-3\">\n              <Icon className=\"w-5 h-5\" />\n            </div>\n            <h3 className=\"font-bold text-gray-900 mb-1.5\">{block.title}</h3>\n            <p className=\"text-sm text-gray-600\">{block.text}</p>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\n\n/**\n * Price Statistics Card\n */\nconst PriceStats = ({ products, stats }) => {\n  const computedStats = useMemo(() => {\n    if (stats && typeof stats.total === 'number') {\n      return {\n        min: stats.minPrice || 0,\n        max: stats.maxPrice || 0,\n        avg: stats.avgPrice || 0,\n        inStock: stats.inStockCount || 0\n      };\n    }\n    if (!products || products.length === 0) return null;\n    const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n    if (prices.length === 0) return null;\n    return {\n      min: Math.min(...prices),\n      max: Math.max(...prices),\n      avg: prices.reduce((a, b) => a + b, 0) / prices.length,\n      inStock: products.filter(p => p.inStock !== false).length\n    };\n  }, [products, stats]);\n  \n  if (!computedStats) return null;\n  \n  return (\n    <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6\">\n      {[\n        { label: 'Legolcsbb', value: formatPrice(computedStats.min), color: 'text-green-600' },\n        { label: 'tlagr', value: formatPrice(computedStats.avg), color: 'text-gray-900' },\n        { label: 'Legdrgbb', value: formatPrice(computedStats.max), color: 'text-gray-900' },\n        { label: 'Kszleten', value: `${computedStats.inStock} db`, color: 'text-primary-500' }\n      ].map((stat, i) => (\n        <div key={i} className=\"bg-white rounded-xl p-3 sm:p-4 border border-gray-100\">\n          <p className=\"text-xs text-gray-500 mb-1\">{stat.label}</p>\n          <p className={`text-base sm:text-lg font-bold ${stat.color}`}>{stat.value}</p>\n        </div>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Featured Products\n */\nconst FeaturedProducts = ({ products, onProductClick, onWishlistToggle, wishlist, onAddToCart }) => {\n  const featured = useMemo(() => {\n    return products\n      .filter(p => p.salePrice && p.price > p.salePrice)\n      .sort((a, b) => ((b.price - b.salePrice) / b.price) - ((a.price - a.salePrice) / a.price))\n      .slice(0, 6);\n  }, [products]);\n  \n  if (featured.length === 0) return null;\n  \n  return (\n    <div className=\"mb-6\">\n      <h3 className=\"font-bold text-gray-900 mb-4 flex items-center gap-2\">\n        <Star className=\"w-5 h-5 text-amber-500\" />\n        Kiemelt ajnlatok\n      </h3>\n      <div className=\"flex gap-4 overflow-x-auto pb-4 scrollbar-hide -mx-4 px-4\">\n        {featured.map((product, index) => (\n          <div key={product.id} className=\"w-44 sm:w-52 shrink-0\">\n            <EnhancedProductCard\n              product={product}\n              onQuickView={onProductClick}\n              onToggleWishlist={onWishlistToggle}\n              onAddToCart={onAddToCart}\n              isWishlisted={wishlist?.includes(product.id)}\n              index={index}\n            />\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/**\n * Compact Product Card - mint EnhancedProductCard: like/dislike, r formzs\n */\nconst CompactProductCard = ({ product, onQuickView, onToggleWishlist, isWishlisted, onAddToCart, onCompare, isComparing }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow tap-scale touch-manipulation\">\n      <img \n        src={product.images?.[0] || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onQuickView(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 \n          className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\"\n          onClick={() => onQuickView(product)}\n        >\n          {product.name}\n        </h4>\n        {/* r - nagyobb, szembetn; eredeti thzva pirosan, kedvezmny % */}\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-xs sm:text-sm text-red-600 line-through block font-semibold\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-base sm:text-lg font-black text-red-600 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1.5 py-0.5 rounded bg-red-100 text-red-700 text-[10px] sm:text-xs font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-base sm:text-lg font-black text-gray-900 block\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        {/* Like/Dislike + CTA - Kosrba hangslyosabb */}\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onCompare?.(product)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isComparing ? 'bg-primary-100 text-primary-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <GitCompare className=\"w-4 h-4\" />\n          </button>\n          <button\n            onClick={() => onToggleWishlist(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${isWishlisted ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            <Star className={`w-4 h-4 ${isWishlisted ? 'fill-current' : ''}`} />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * AI Recommendations Banner\n */\nconst AIBanner = ({ category, onAskAI }) => (\n  <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6 animate-fade-in\">\n    <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n      <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n        <Sparkles className=\"w-6 h-6\" />\n      </div>\n      <div className=\"flex-1\">\n        <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n        <p className=\"text-white/80 text-sm\">Melyik {category.toLowerCase()} illik hozzd?</p>\n      </div>\n      <button\n        onClick={onAskAI}\n        className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors tap-scale\"\n      >\n        AI Tancsad\n      </button>\n    </div>\n  </div>\n);\n\n/**\n * View & Sort Controls\n */\nconst ViewControls = ({ \n  sortOption, onSortChange, \n  viewMode, onViewModeChange, \n  loadedCount,\n  totalCount,\n  onOpenFilters,\n  compareCount\n}) => (\n  <div className=\"flex flex-wrap items-center justify-between gap-3 mb-4 pb-4 border-b border-gray-100\">\n    <div className=\"flex items-center gap-3\">\n      <button\n        onClick={onOpenFilters}\n        className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700 tap-scale\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        Szrk\n      </button>\n      <div className=\"text-sm text-gray-500\">\n        <p>\n          <span className=\"font-semibold text-gray-900\">{loadedCount.toLocaleString('hu-HU')}</span>\n          {totalCount > 0 && (\n            <span className=\"text-gray-400 ml-1\">/ {totalCount.toLocaleString('hu-HU')}</span>\n          )}\n          <span className=\"ml-1\">termk</span>\n        </p>\n        {totalCount > 0 && (\n          <div className=\"mt-1 h-1.5 w-32 bg-gray-100 rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-primary-500 rounded-full transition-all\"\n              style={{ width: `${Math.min(100, Math.round((loadedCount / totalCount) * 100))}%` }}\n            />\n          </div>\n        )}\n      </div>\n      {compareCount > 0 && (\n        <span className=\"px-2 py-1 bg-primary-100 text-primary-600 text-xs font-medium rounded-full\">\n          {compareCount} sszehasonltsra\n        </span>\n      )}\n    </div>\n    \n    <div className=\"flex items-center gap-2\">\n      <select\n        value={sortOption}\n        onChange={(e) => onSortChange(e.target.value)}\n        className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n      >\n        <option value=\"default\">Relevancia</option>\n        <option value=\"smart\">Okos (ajnlott)</option>\n        <option value=\"price-asc\">r </option>\n        <option value=\"price-desc\">r </option>\n        <option value=\"name-asc\">Nv A-Z</option>\n        <option value=\"discount\">Kedvezmny</option>\n      </select>\n      \n      <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n        {[\n          { mode: 'grid', icon: LayoutGrid },\n          { mode: 'compact', icon: Rows3 },\n        ].map(({ mode, icon: Icon }) => (\n          <button\n            key={mode}\n            onClick={() => onViewModeChange(mode)}\n            className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n          >\n            <Icon className=\"w-5 h-5\" />\n          </button>\n        ))}\n      </div>\n    </div>\n  </div>\n);\n\n/**\n * Main Category Page Component\n */\nconst CategoryPage = ({\n  category,\n  products,\n  allCategories = [],\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  onCategoryChange,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  totalCount = 0,\n  loadedCount = 0,\n  stats,\n  onLoadMore,\n  onScrollToSection\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [filters, setFilters] = useState({});\n  const [priceRange, setPriceRange] = useState([0, 10000000]);\n  const [showFilters, setShowFilters] = useState(false);\n  const [compareList, setCompareList] = useState([]);\n  const [presetName, setPresetName] = useState('');\n  const [savedPresets, setSavedPresets] = useState([]);\n  const loadMoreRef = useRef(null);\n  \n  const theme = getCategoryTheme(category);\n  const likedIds = useMemo(() => getLikedProducts(), []);\n  const viewedIds = useMemo(() => getViewedProducts(30).map((p) => p.id), []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(PRESET_STORAGE_KEY);\n      setSavedPresets(raw ? JSON.parse(raw) : []);\n    } catch {\n      setSavedPresets([]);\n    }\n  }, [category]);\n\n  useEffect(() => {\n    const t = setTimeout(() => onScrollToSection?.(), 50);\n    return () => clearTimeout(t);\n  }, [category]);\n\n  const savePreset = () => {\n    const name = presetName.trim();\n    if (!name) return;\n    const next = [\n      {\n        id: `${Date.now()}`,\n        name,\n        filters,\n        priceRange,\n        sortOption,\n        viewMode\n      },\n      ...savedPresets.filter((p) => p.name !== name)\n    ].slice(0, 6);\n    setSavedPresets(next);\n    setPresetName('');\n    try {\n      localStorage.setItem(PRESET_STORAGE_KEY, JSON.stringify(next));\n    } catch {}\n  };\n\n  const applyPreset = (preset) => {\n    setFilters(preset.filters || {});\n    setPriceRange(preset.priceRange || [0, 10000000]);\n    setSortOption(preset.sortOption || 'default');\n    setViewMode(preset.viewMode || 'grid');\n  };\n\n  const quickApply = (type) => {\n    if (type === 'in-stock') {\n      setFilters((prev) => ({ ...prev, inStockOnly: true }));\n      return;\n    }\n    if (type === 'under-100') {\n      setPriceRange([0, 100000]);\n      return;\n    }\n    if (type === 'premium') {\n      setPriceRange([250000, priceRange[1]]);\n      return;\n    }\n    if (type === 'discount') {\n      setSortOption('discount');\n      return;\n    }\n  };\n\n  const quickCounts = useMemo(() => {\n    const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true)).length;\n    const under100 = products.filter((p) => (p.salePrice || p.price) <= 100000).length;\n    const premium = products.filter((p) => (p.salePrice || p.price) >= 250000).length;\n    const discount = products.filter((p) => p.salePrice && p.price > p.salePrice).length;\n    return { inStock, under100, premium, discount };\n  }, [products]);\n  \n  // Initialize price range from products\n  useEffect(() => {\n    if (products.length > 0) {\n      const prices = products.map(p => p.salePrice || p.price).filter(p => p > 0);\n      if (prices.length > 0) {\n        setPriceRange([Math.min(...prices), Math.max(...prices)]);\n      }\n    }\n  }, [products]);\n  \n  // Filter and sort products\n  const displayedProducts = useMemo(() => {\n    let filtered = [...products];\n    \n    // Price filter\n    filtered = filtered.filter(p => {\n      const price = p.salePrice || p.price;\n      return price >= priceRange[0] && price <= priceRange[1];\n    });\n    \n    // Brand filter\n    if (filters.brands?.length > 0) {\n      filtered = filtered.filter(p => filters.brands.includes(p.brand));\n    }\n    \n    // Color filter\n    if (filters.colors?.length > 0) {\n      filtered = filtered.filter(p => filters.colors.includes(p.color));\n    }\n    \n    // In stock only\n    if (filters.inStockOnly) {\n      filtered = filtered.filter(p => p.inStock !== false);\n    }\n    \n    // Sort\n    switch (sortOption) {\n      case 'price-asc':\n        filtered.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        filtered.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        filtered.sort((a, b) => a.name.localeCompare(b.name, 'hu'));\n        break;\n      case 'discount':\n        filtered.sort((a, b) => {\n          const dA = a.salePrice ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n      case 'smart':\n        filtered.sort((a, b) => {\n          const score = (p) => {\n            const stock = typeof p.stock_qty === 'number' ? p.stock_qty : 0;\n            const inStock = p.inStock ?? p.in_stock ?? true;\n            const liked = likedIds.includes(p.id) ? 6 : 0;\n            const viewed = viewedIds.includes(p.id) ? 3 : 0;\n            const discount = p.salePrice && p.price ? (p.price - p.salePrice) / p.price : 0;\n            return (inStock ? 5 : 0) + liked + viewed + Math.min(stock, 20) * 0.2 + discount * 10;\n          };\n          return score(b) - score(a);\n        });\n        break;\n    }\n    \n    return filtered;\n  }, [products, sortOption, filters, priceRange]);\n  \n  const visibleProducts = displayedProducts;\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n  \n  // Infinite scroll observer\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) {\n          onLoadMore?.();\n        }\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    \n    if (loadMoreRef.current instanceof Element) {\n      try {\n        observer.observe(loadMoreRef.current);\n      } catch (err) {\n        return;\n      }\n    }\n    \n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n  \n  const toggleCompare = (product) => {\n    setCompareList(prev => \n      prev.find(p => p.id === product.id)\n        ? prev.filter(p => p.id !== product.id)\n        : prev.length < 4 ? [...prev, product] : prev\n    );\n  };\n  \n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CategoryHero category={category} productCount={totalCount || products.length} theme={theme} onBack={onBack} />\n      \n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-8 sm:py-12 lg:py-16\">\n        <AIBanner category={category} onAskAI={onAskAI} />\n        <PriceStats products={products} stats={stats} />\n        <FeaturedProducts products={products} onProductClick={onProductClick} onWishlistToggle={onWishlistToggle} wishlist={wishlist} onAddToCart={onAddToCart} />\n        <RelatedCategories currentCategory={category} allCategories={allCategories} onCategoryChange={onCategoryChange} />\n        <CategoryStory category={category} />\n        \n        <div className=\"flex gap-8\">\n          <SidebarFilters\n            products={products}\n            filters={filters}\n            onFilterChange={setFilters}\n            priceRange={priceRange}\n            onPriceRangeChange={setPriceRange}\n            isOpen={showFilters}\n            onClose={() => setShowFilters(false)}\n          />\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"mb-4 rounded-2xl border border-gray-100 bg-white p-4 shadow-sm\">\n              <div className=\"flex flex-wrap items-center gap-2 mb-3\">\n                <span className=\"text-xs font-semibold text-gray-500\">Gyors szrk:</span>\n                <button onClick={() => quickApply('in-stock')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Kszleten ({quickCounts.inStock})</button>\n                <button onClick={() => quickApply('under-100')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">100k alatt ({quickCounts.under100})</button>\n                <button onClick={() => quickApply('premium')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Prmium ({quickCounts.premium})</button>\n                <button onClick={() => quickApply('discount')} className=\"px-3 py-1.5 rounded-full text-xs font-semibold border border-gray-200 hover:bg-gray-50\">Akcik ({quickCounts.discount})</button>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={presetName}\n                  onChange={(e) => setPresetName(e.target.value)}\n                  placeholder=\"Preset neve\"\n                  className=\"px-3 py-2 border border-gray-200 rounded-lg text-sm\"\n                />\n                <button onClick={savePreset} className=\"px-3 py-2 rounded-lg bg-primary-500 text-white text-sm font-semibold\">Ments</button>\n                {savedPresets.map((preset) => (\n                  <button\n                    key={preset.id}\n                    onClick={() => applyPreset(preset)}\n                    className=\"px-3 py-2 rounded-lg bg-gray-100 text-gray-700 text-sm font-semibold hover:bg-gray-200\"\n                  >\n                    {preset.name}\n                  </button>\n                ))}\n              </div>\n            </div>\n            <ViewControls\n              sortOption={sortOption}\n              onSortChange={setSortOption}\n              viewMode={viewMode}\n              onViewModeChange={setViewMode}\n              loadedCount={loadedCount}\n              totalCount={totalCount}\n              onOpenFilters={() => setShowFilters(true)}\n              compareCount={compareList.length}\n            />\n            \n            {viewMode === 'grid' ? (\n              <div className=\"product-grid\">\n                {visibleProducts.map((product, index) => (\n                  <EnhancedProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    index={index}\n                    sectionId={`category-${category}`}\n                  />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {visibleProducts.map(product => (\n                  <CompactProductCard\n                    key={product.id}\n                    product={product}\n                    onQuickView={onProductClick}\n                    onToggleWishlist={onWishlistToggle}\n                    onAddToCart={onAddToCart}\n                    isWishlisted={wishlist?.includes(product.id)}\n                    onCompare={toggleCompare}\n                    isComparing={compareList.some(p => p.id === product.id)}\n                  />\n                ))}\n              </div>\n            )}\n            \n            {/* Infinite scroll trigger */}\n            {hasMoreToShow && (\n              <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n                <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n              </div>\n            )}\n            \n            {!hasMoreToShow && visibleProducts.length > 0 && (\n              <p className=\"text-center text-gray-400 text-base lg:text-lg py-10 lg:py-12\">\n                Minden termk betltve ({displayedProducts.length} db)\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CategoryPage;\n","import React, { useMemo, useState, useEffect, useRef } from 'react';\nimport { Home, ChevronRight, Filter, LayoutGrid, Rows3, SlidersHorizontal, Sparkles, ShoppingCart, ThumbsUp, ThumbsDown } from 'lucide-react';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { toggleLikeProduct, toggleDislikeProduct, isProductLiked, isProductDisliked } from '../../services/userPreferencesService';\nimport { ProductGridSkeleton } from '../ui/Skeleton';\n\n/**\n * CollectionHero  kollekci fejlc, gradient httr\n */\nconst CollectionHero = ({ collection, productCount, onBack }) => {\n  const Icon = collection.icon;\n  return (\n    <div className=\"relative overflow-hidden\">\n      {collection.image && (\n        <div className=\"absolute inset-0 bg-cover bg-center\" style={{ backgroundImage: `url(${collection.image})` }} aria-hidden />\n      )}\n      <div className={`absolute inset-0 bg-gradient-to-br ${collection.gradient}`} />\n      <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 via-black/20 to-transparent\" />\n      <div className=\"relative w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16 py-12 sm:py-20 lg:py-28 text-white\">\n        <nav className=\"flex items-center gap-2 text-sm mb-6\">\n          <button onClick={onBack} className=\"flex items-center gap-1 text-white/80 hover:text-white transition-colors\">\n            <Home className=\"w-4 h-4\" />\n            <span>Foldal</span>\n          </button>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"text-white font-medium\">Kollekci</span>\n          <ChevronRight className=\"w-4 h-4 text-white/60\" />\n          <span className=\"font-semibold\">{collection.title}</span>\n        </nav>\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-6\">\n          <div className=\"w-20 h-20 sm:w-28 sm:h-28 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center shrink-0\">\n            <Icon className=\"w-10 h-10 sm:w-14 sm:h-14 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold mb-2\">{collection.title}</h1>\n            <p className=\"text-white/90 text-lg sm:text-xl mb-2\">{collection.subtitle}</p>\n            <p className=\"text-white/80 text-base\">\n              <span className=\"font-semibold\">{productCount.toLocaleString('hu-HU')}</span> termk\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Collection compact card - mint foldal: like/dislike, r formzs\n */\nconst CollectionCompactCard = ({ product, onProductClick, onWishlistToggle, onAddToCart, wishlist }) => {\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n  const displayPrice = product.salePrice || product.price;\n  const hasDiscount = product.salePrice && product.price > product.salePrice;\n  const discountPct = hasDiscount ? Math.round(((product.price - product.salePrice) / product.price) * 100) : 0;\n\n  useEffect(() => {\n    if (product?.id) setFeedbackState({ liked: isProductLiked(product.id), disliked: isProductDisliked(product.id) });\n  }, [product?.id]);\n\n  return (\n    <div className=\"flex gap-2 sm:gap-3 p-2.5 sm:p-3 bg-white rounded-xl border border-gray-100 hover:shadow-md transition-shadow touch-manipulation\">\n      <img\n        src={product.images?.[0] || product.image || '/placeholder.png'}\n        alt={product.name}\n        className=\"w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-lg bg-gray-50 shrink-0 cursor-pointer\"\n        onClick={() => onProductClick?.(product)}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-xs text-primary-500 font-medium mb-0.5 truncate\">{product.category}</p>\n        <h4 className=\"text-xs font-semibold text-gray-900 line-clamp-2 cursor-pointer hover:text-primary-500 leading-tight overflow-hidden\" onClick={() => onProductClick?.(product)}>\n          {product.name}\n        </h4>\n        <div className=\"mt-1.5 text-center min-w-0 space-y-0.5\">\n          {hasDiscount ? (\n            <>\n              <span className=\"text-[10px] text-red-500 line-through block truncate\">{product.price.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"text-xs font-bold text-red-600 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n              <span className=\"inline-block px-1 py-0.5 rounded bg-red-100 text-red-600 text-[9px] font-bold\">-{discountPct}%</span>\n            </>\n          ) : (\n            <span className=\"text-xs font-bold text-gray-900 block truncate\">{displayPrice.toLocaleString('hu-HU')} Ft</span>\n          )}\n        </div>\n        <div className=\"flex justify-center items-center gap-1 sm:gap-2 mt-2 flex-wrap\">\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleLikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.liked ? 'bg-green-500 text-white' : 'bg-green-50 text-green-600 hover:bg-green-100'}`}\n            aria-label=\"Tetszik\"\n          >\n            <ThumbsUp className=\"w-4 h-4\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={(e) => { e.stopPropagation(); setFeedbackState(toggleDislikeProduct(product)); }}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-full transition-colors ${feedbackState.disliked ? 'bg-red-500 text-white' : 'bg-red-50 text-red-500 hover:bg-red-100'}`}\n            aria-label=\"Nem tetszik\"\n          >\n            <ThumbsDown className=\"w-4 h-4\" />\n          </button>\n          {(product.inStock ?? product.in_stock) !== false && onAddToCart && (\n            <button\n              onClick={(e) => { e.stopPropagation(); onAddToCart(product, 1); }}\n              className=\"min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg bg-emerald-500 text-white hover:bg-emerald-600 transition-colors touch-manipulation shadow-md shadow-emerald-500/30 font-bold\"\n              title=\"Kosrba\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n            </button>\n          )}\n          <button\n            onClick={() => onWishlistToggle?.(product.id)}\n            className={`min-w-[36px] min-h-[36px] p-1.5 flex items-center justify-center rounded-lg transition-colors ${wishlist?.includes(product.id) ? 'bg-red-100 text-red-500' : 'hover:bg-gray-100 text-gray-400'}`}\n          >\n            \n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * CollectionPage  kollekci landing, vals termkekkel\n */\nconst CollectionPage = ({\n  collection,\n  products,\n  onBack,\n  onProductClick,\n  onWishlistToggle,\n  wishlist,\n  onAddToCart,\n  onAskAI,\n  onNavigateToCategory,\n  allCategories = [],\n  totalCount = 0,\n  loadedCount = 0,\n  onLoadMore,\n  isLoading = false,\n  onScrollToSection\n}) => {\n  const [sortOption, setSortOption] = useState('default');\n  const [viewMode, setViewMode] = useState('grid');\n  const [showFilters, setShowFilters] = useState(false);\n  const [activeCategoryFilter, setActiveCategoryFilter] = useState('');\n  const loadMoreRef = useRef(null);\n\n  const hasMoreToShow = totalCount > 0 && loadedCount < totalCount;\n\n  const styleFilteredProducts = useMemo(() => {\n    let list = [...products];\n    if (collection.styleKeywords?.length > 0) {\n      const keywords = collection.styleKeywords.map((k) => k.toLowerCase());\n      list = list.filter((p) => {\n        const searchStr = [p.name || '', p.category || '', p.description || '', p.params || ''].join(' ').toLowerCase();\n        return keywords.some((kw) => searchStr.includes(kw));\n      });\n    }\n    return list;\n  }, [products, collection.styleKeywords]);\n\n  const inCollectionCategories = useMemo(() => {\n    const set = new Set();\n    styleFilteredProducts.forEach((p) => {\n      if (p.category && String(p.category).trim()) set.add(String(p.category).trim());\n    });\n    return Array.from(set).sort((a, b) => a.localeCompare(b, 'hu'));\n  }, [styleFilteredProducts]);\n\n  const displayedProducts = useMemo(() => {\n    let list = activeCategoryFilter\n      ? styleFilteredProducts.filter((p) => p.category === activeCategoryFilter)\n      : [...styleFilteredProducts];\n    switch (sortOption) {\n      case 'price-asc':\n        list.sort((a, b) => (a.salePrice || a.price) - (b.salePrice || b.price));\n        break;\n      case 'price-desc':\n        list.sort((a, b) => (b.salePrice || b.price) - (a.salePrice || a.price));\n        break;\n      case 'name-asc':\n        list.sort((a, b) => (a.name || '').localeCompare(b.name || '', 'hu'));\n        break;\n      case 'discount':\n        list.sort((a, b) => {\n          const dA = a.salePrice && a.price ? (a.price - a.salePrice) / a.price : 0;\n          const dB = b.salePrice && b.price ? (b.price - b.salePrice) / b.price : 0;\n          return dB - dA;\n        });\n        break;\n    }\n    return list;\n  }, [styleFilteredProducts, activeCategoryFilter, sortOption]);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && hasMoreToShow) onLoadMore?.();\n      },\n      { threshold: 0.1, rootMargin: '200px' }\n    );\n    if (loadMoreRef.current instanceof Element) observer.observe(loadMoreRef.current);\n    return () => observer.disconnect();\n  }, [hasMoreToShow, onLoadMore]);\n\n  useEffect(() => {\n    const t = setTimeout(() => onScrollToSection?.(), 50);\n    return () => clearTimeout(t);\n  }, [collection?.id]);\n\n  return (\n    <div id=\"products-section\" className=\"min-h-screen bg-gray-50\">\n      <CollectionHero collection={collection} productCount={displayedProducts.length} onBack={onBack} />\n\n      <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-6 xl:px-8 py-8 sm:py-12\">\n        {/* AI banner */}\n        <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 rounded-2xl p-4 sm:p-6 text-white mb-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center shrink-0\">\n              <Sparkles className=\"w-6 h-6\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-bold text-lg mb-1\">AI segt vlasztani</h3>\n              <p className=\"text-white/80 text-sm\">Melyik {collection.title.toLowerCase()} illik hozzd?</p>\n            </div>\n            <button\n              onClick={onAskAI}\n              className=\"w-full sm:w-auto px-5 py-2.5 bg-white text-primary-500 rounded-xl font-semibold hover:bg-primary-50 transition-colors\"\n            >\n              AI Tancsad\n            </button>\n          </div>\n        </div>\n\n        {/* Kollekcin belli szrs  termktpus chipek */}\n        {inCollectionCategories.length > 0 && (\n          <div className=\"mb-6\">\n            <p className=\"text-sm font-medium text-gray-600 mb-2\">Szrs a kollekcin bell</p>\n            <div className=\"flex gap-2 overflow-x-auto scrollbar-hide pb-1 lg:flex-wrap lg:overflow-visible\">\n              <button\n                type=\"button\"\n                onClick={() => setActiveCategoryFilter('')}\n                className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                  activeCategoryFilter === '' ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                }`}\n              >\n                sszes\n              </button>\n              {inCollectionCategories.map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => setActiveCategoryFilter(cat)}\n                  className={`shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors ${\n                    activeCategoryFilter === cat ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Bngssz kategrik szerint  kilps a kollekcibl */}\n        {onNavigateToCategory && (collection.relatedCategories?.length > 0 || allCategories.length > 0) && (\n          <div className=\"mb-6 p-4 rounded-xl bg-gray-100/80 border border-gray-200\">\n            <p className=\"text-sm font-medium text-gray-600 mb-3\">Bngssz kategrik szerint</p>\n            <div className=\"flex flex-wrap gap-2\">\n              {(collection.relatedCategories?.length > 0\n                ? collection.relatedCategories\n                : allCategories\n                    .filter((c) => (typeof c === 'string' ? c : c?.name) !== 'sszes')\n                    .slice(0, 8)\n                    .map((c) => (typeof c === 'string' ? c : c.name))\n              ).map((cat) => (\n                <button\n                  key={cat}\n                  type=\"button\"\n                  onClick={() => onNavigateToCategory(cat)}\n                  className=\"px-4 py-2 rounded-lg bg-white border border-gray-200 text-sm font-medium text-gray-700 hover:border-primary-400 hover:text-primary-600 hover:bg-primary-50 transition-colors\"\n                >\n                  {cat}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Toolbar */}\n        <div className=\"flex flex-wrap items-center justify-between gap-3 mb-6 pb-4 border-b border-gray-200\">\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => setShowFilters(!showFilters)}\n              className=\"lg:hidden flex items-center gap-2 px-3 py-2 bg-gray-100 rounded-lg text-sm font-medium text-gray-700\"\n            >\n              <Filter className=\"w-4 h-4\" />\n              Szrk\n            </button>\n            <span className=\"text-sm text-gray-500\">\n              <span className=\"font-semibold text-gray-900\">{displayedProducts.length.toLocaleString('hu-HU')}</span>\n              {totalCount > 0 && <span className=\"text-gray-400\"> / {totalCount.toLocaleString('hu-HU')}</span>} termk\n            </span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={sortOption}\n              onChange={(e) => setSortOption(e.target.value)}\n              className=\"px-3 py-2 text-sm border border-gray-200 rounded-lg bg-white focus:border-primary-500 outline-none\"\n            >\n              <option value=\"default\">Relevancia</option>\n              <option value=\"price-asc\">r </option>\n              <option value=\"price-desc\">r </option>\n              <option value=\"name-asc\">Nv A-Z</option>\n              <option value=\"discount\">Kedvezmny</option>\n            </select>\n            <div className=\"hidden sm:flex border border-gray-200 rounded-lg overflow-hidden\">\n              {[\n                { mode: 'grid', icon: LayoutGrid },\n                { mode: 'compact', icon: Rows3 }\n              ].map(({ mode, icon: Icon }) => (\n                <button\n                  key={mode}\n                  onClick={() => setViewMode(mode)}\n                  className={`p-2 ${viewMode === mode ? 'bg-primary-500 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'}`}\n                >\n                  <Icon className=\"w-5 h-5\" />\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Product grid */}\n        {isLoading && products.length === 0 ? (\n          <ProductGridSkeleton count={8} />\n        ) : displayedProducts.length === 0 ? (\n          <div className=\"text-center py-16 text-gray-500\">\n            <p className=\"text-lg font-medium\">Nincs tallat ebben a kollekciban.</p>\n            <button onClick={onBack} className=\"mt-4 px-6 py-2 bg-primary-500 text-white rounded-xl font-semibold hover:bg-primary-600\">\n              Vissza a kollekcikhoz\n            </button>\n          </div>\n        ) : viewMode === 'grid' ? (\n          <div className=\"product-grid product-grid-collection\">\n            {displayedProducts.map((product, index) => (\n              <EnhancedProductCard\n                key={product.id}\n                product={product}\n                onQuickView={onProductClick}\n                onToggleWishlist={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                isWishlisted={wishlist?.includes(product.id)}\n                index={index}\n                sectionId={`collection-${collection.id}`}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className=\"space-y-2 sm:space-y-3\">\n            {displayedProducts.map((product) => (\n              <CollectionCompactCard\n                key={product.id}\n                product={product}\n                onProductClick={onProductClick}\n                onWishlistToggle={onWishlistToggle}\n                onAddToCart={onAddToCart}\n                wishlist={wishlist}\n              />\n            ))}\n          </div>\n        )}\n\n        {hasMoreToShow && (\n          <div ref={loadMoreRef} className=\"flex justify-center py-8\">\n            <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n\n        {!hasMoreToShow && displayedProducts.length > 0 && (\n          <p className=\"text-center text-gray-400 py-10\">Minden termk betltve</p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CollectionPage;\n","import React from 'react';\nimport { ChevronRight } from 'lucide-react';\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst CARD_COLORS = [\n  'from-primary-500 to-secondary-700',\n  'from-orange-500 to-amber-600',\n  'from-emerald-500 to-teal-600',\n  'from-violet-500 to-purple-600',\n];\n\n/**\n * F kategrik krtyk a foldalon  hierarchia alapjn.\n * Desktop: 3 oszlop, tablet: 2, mobil: horizontlis scroll vagy 1 oszlop.\n */\nexport default function MainCategoriesSection({\n  mainCategories = [],\n  activeCategory,\n  onCategorySelect,\n  totalProductCount = 0,\n}) {\n  if (!mainCategories.length) return null;\n\n  return (\n    <div className=\"mb-6 sm:mb-8 lg:mb-10\">\n      <div className=\"flex items-center justify-between gap-4 mb-4 sm:mb-5 lg:mb-6\">\n        <div>\n          <h3 className=\"text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900\">\n            Bngssz f kategrik szerint\n          </h3>\n          <p className=\"text-sm sm:text-base text-gray-500 mt-0.5\">\n            {totalProductCount > 0 && (\n              <span className=\"font-medium text-primary-600\">{totalProductCount.toLocaleString('hu-HU')}</span>\n            )}{' '}\n            termk egy helyen\n          </p>\n        </div>\n      </div>\n\n      {/* Desktop / tablet: grid */}\n      <div className=\"hidden sm:grid sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n        {mainCategories.map((main, idx) => {\n          const isActive = activeCategory === main.name;\n          const children = (main.children || []).slice(0, 6);\n          const Icon = getCategoryIcon(main.name);\n          const color = CARD_COLORS[idx % CARD_COLORS.length];\n          return (\n            <article\n              key={main.name}\n              className={`rounded-2xl lg:rounded-3xl border-2 overflow-hidden transition-all duration-200 hover:shadow-xl ${\n                isActive\n                  ? 'border-primary-400 bg-primary-50/50 shadow-lg'\n                  : 'border-gray-100 bg-white hover:border-gray-200'\n              }`}\n            >\n              <button\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className=\"w-full flex items-center gap-4 p-4 sm:p-5 lg:p-6 text-left min-h-[44px]\"\n              >\n                <div\n                  className={`w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}\n                >\n                  <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-9 lg:h-9\" />\n                </div>\n                <div className=\"min-w-0 flex-1\">\n                  <h4 className=\"font-bold text-gray-900 text-base sm:text-lg lg:text-xl truncate\">\n                    {main.name}\n                  </h4>\n                  <p className=\"text-sm text-gray-500\">\n                    {Number(main.productCount || 0).toLocaleString('hu-HU')} termk\n                  </p>\n                </div>\n                <ChevronRight className=\"w-5 h-5 text-gray-400 shrink-0\" />\n              </button>\n              {children.length > 0 && (\n                <div className=\"px-4 sm:px-5 lg:px-6 pb-4 sm:pb-5 lg:pb-6 pt-0 flex flex-wrap gap-2\">\n                  {children.map((child) => (\n                    <button\n                      key={child.name}\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        onCategorySelect(child.name);\n                      }}\n                      className=\"px-3 py-1.5 text-xs sm:text-sm font-medium text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors border border-gray-100 hover:border-primary-200\"\n                    >\n                      {child.name}\n                    </button>\n                  ))}\n                </div>\n              )}\n            </article>\n          );\n        })}\n      </div>\n\n      {/* Mobile: horizontal scroll */}\n      <div className=\"sm:hidden overflow-x-auto scrollbar-hide -mx-3 px-3\">\n        <div className=\"flex gap-3 pb-2\">\n          {mainCategories.map((main, idx) => {\n            const isActive = activeCategory === main.name;\n            const Icon = getCategoryIcon(main.name);\n            const color = CARD_COLORS[idx % CARD_COLORS.length];\n            return (\n              <button\n                key={main.name}\n                type=\"button\"\n                onClick={() => onCategorySelect(main.name)}\n                className={`shrink-0 w-[160px] rounded-2xl border-2 p-4 text-left transition-all min-h-[100px] ${\n                  isActive ? 'border-primary-400 bg-primary-50/50' : 'border-gray-100 bg-white'\n                }`}\n              >\n                <div\n                  className={`w-12 h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white mb-3`}\n                >\n                  <Icon className=\"w-6 h-6\" />\n                </div>\n                <p className=\"font-bold text-gray-900 text-sm truncate\">{main.name}</p>\n                <p className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} db</p>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useSyncExternalStore } from 'react';\n\n/** Kzs scroll store  egy listener, rAF throttling, passive */\nlet scrollY = 0;\nlet scrollPercent = 0;\nlet scrollHeight = 0;\nlet snapshot = { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\nconst listeners = new Set();\nlet rafId = null;\n\nfunction getScrollData() {\n  if (typeof window === 'undefined') return { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\n  const y = window.pageYOffset ?? document.documentElement.scrollTop ?? 0;\n  const sh = Math.max(0, document.documentElement.scrollHeight - (window.innerHeight ?? document.documentElement.clientHeight));\n  const pct = sh > 0 ? Math.min(100, (y / sh) * 100) : 0;\n  return { scrollY: y, scrollPercent: pct, scrollHeight: sh };\n}\n\nfunction notify() {\n  const data = getScrollData();\n  if (data.scrollY === scrollY && data.scrollPercent === scrollPercent) return;\n  scrollY = data.scrollY;\n  scrollPercent = data.scrollPercent;\n  scrollHeight = data.scrollHeight;\n  snapshot = { scrollY, scrollPercent, scrollHeight };\n  listeners.forEach((fn) => fn());\n}\n\nfunction onScroll() {\n  if (rafId != null) return;\n  rafId = requestAnimationFrame(() => {\n    notify();\n    rafId = null;\n  });\n}\n\nfunction subscribe(listener) {\n  if (listeners.size === 0) {\n    window.addEventListener('scroll', onScroll, { passive: true });\n    notify();\n  }\n  listeners.add(listener);\n  return () => {\n    listeners.delete(listener);\n    if (listeners.size === 0) {\n      window.removeEventListener('scroll', onScroll);\n    }\n  };\n}\n\nfunction getSnapshot() {\n  return snapshot;\n}\n\nfunction getServerSnapshot() {\n  return { scrollY: 0, scrollPercent: 0, scrollHeight: 0 };\n}\n\n/**\n * useScrollPosition - Egyetlen kzs scroll listener, rAF throttling.\n * Hasznlat: ScrollProgress, BackToTop, Navbar, SmartNewsletterPopup, StickyAddToCart\n */\nexport function useScrollPosition() {\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n}\n\n/** scrollY > threshold (pl. 20, 400) */\nexport function useScrollPastY(threshold) {\n  const { scrollY: y } = useScrollPosition();\n  return y > threshold;\n}\n\n/** scrollPercent > threshold (pl. 30, 70) */\nexport function useScrollPastPercent(threshold) {\n  const { scrollPercent: pct } = useScrollPosition();\n  return pct > threshold;\n}\n","import { useEffect } from 'react';\n\nlet lockCount = 0;\nconst savedStyles = new Map();\nlet lastScrollParent = null;\n\nfunction getScrollParent() {\n  if (typeof document === 'undefined') return null;\n  const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root');\n  if (!appRoot) return null;\n  let parent = appRoot.parentElement;\n  while (parent && parent !== document.body) {\n    const style = getComputedStyle(parent);\n    const oy = style.overflowY;\n    const isScrollable =\n      (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && parent.scrollHeight > parent.clientHeight;\n    if (isScrollable) return parent;\n    parent = parent.parentElement;\n  }\n  return null;\n}\n\nfunction lock() {\n  lockCount++;\n  if (lockCount !== 1) return;\n\n  const bodyOverflow = document.body.style.overflow || '';\n  savedStyles.set(document.body, bodyOverflow);\n  document.body.style.overflow = 'hidden';\n\n  const scrollParent = getScrollParent();\n  if (scrollParent) {\n    lastScrollParent = scrollParent;\n    savedStyles.set(scrollParent, scrollParent.style.overflow || '');\n    scrollParent.style.overflow = 'hidden';\n  }\n}\n\nfunction unlock() {\n  lockCount = Math.max(0, lockCount - 1);\n  if (lockCount > 0) return;\n\n  const bodySaved = savedStyles.get(document.body);\n  document.body.style.overflow = bodySaved !== undefined ? String(bodySaved) : '';\n  savedStyles.delete(document.body);\n\n  if (lastScrollParent) {\n    const parentSaved = savedStyles.get(lastScrollParent);\n    lastScrollParent.style.overflow = parentSaved !== undefined ? String(parentSaved) : '';\n    savedStyles.delete(lastScrollParent);\n    lastScrollParent = null;\n  }\n}\n\n/**\n * useScrollLock - Locks background scroll when modal/popup is open.\n * Works for both standalone (body) and embed (scroll parent).\n * Uses ref counter for nested modals.\n */\nexport function useScrollLock(isActive) {\n  useEffect(() => {\n    if (!isActive) return;\n    lock();\n    return unlock;\n  }, [isActive]);\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport { useScrollPastY } from '../../hooks/useScrollPosition';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport {\n  Home, Sparkles, Grid3X3, ChevronDown, ChevronUp, ArrowRight, Search, Sun, Moon, Heart, Menu, X, ChevronRight,\n  ShoppingCart, Camera, Move, Truck, Gift, Zap, TrendingUp, Star, Sofa, BedDouble, Armchair,\n  Lamp, Instagram, Facebook, MapPin, Mail, Phone, Clock\n} from 'lucide-react';\n\nconst RECENT_CATEGORIES_KEY = 'mkt_recent_categories';\nconst RECENT_CATEGORIES_MAX = 3;\nimport { getCategoryIcon } from '../ui/Icons';\n\nconst ANNOUNCEMENT_MESSAGES = [\n  { icon: Truck, text: 'Ingyenes szllts 50.000 Ft felett', highlight: 'Ingyenes' },\n  { icon: Gift, text: 'Els rendels: 10% kupon ELSO10', highlight: '10%' },\n  { icon: Zap, text: 'AI szemlyre szabott ajnlatok', highlight: 'AI' },\n  { icon: Star, text: '4,9  10.000+ elgedett vsrl', highlight: '4,9' },\n  { icon: TrendingUp, text: '90.000+ btor egy helyen', highlight: '90.000+' },\n];\n\nconst POPULAR_CATEGORIES = [\n  { id: 'kanapek', name: 'Kanapk', icon: Sofa, color: 'from-blue-500 to-primary-500' },\n  { id: 'agyak', name: 'gyak', icon: BedDouble, color: 'from-secondary-600 to-secondary-600' },\n  { id: 'fotelek', name: 'Fotelek', icon: Armchair, color: 'from-orange-500 to-red-600' },\n  { id: 'lampak', name: 'Lmpk', icon: Lamp, color: 'from-yellow-500 to-orange-600' },\n  { id: 'szekrenyek', name: 'Szekrnyek', icon: Grid3X3, color: 'from-green-500 to-teal-600' },\n  { id: 'asztalok', name: 'Asztalok', icon: Grid3X3, color: 'from-cyan-500 to-blue-600' },\n];\n\nconst MEGA_MENU_COLORS = ['from-primary-500 to-secondary-700', 'from-orange-500 to-red-600', 'from-cyan-500 to-blue-600', 'from-green-500 to-teal-600', 'from-yellow-500 to-orange-600', 'from-pink-500 to-rose-600', 'from-indigo-500 to-purple-600', 'from-amber-500 to-orange-600', 'from-emerald-500 to-teal-600'];\n\n/**\n * Navbar  fejlc, kategria mega menu (f + alkategrik), mobil men, announcement sv.\n * Props: activeTab, setActiveTab, wishlistCount, productCount, categories, categoryHierarchy?, onOpenWishlist, onCategorySelect, onScrollToShop, recentlyViewed?, fixUrl?, onRecentProductClick?\n * categoryHierarchy: [ { name, productCount, children: [ { name, productCount } ] } ]  ha megadva, csak f kategrik + alkategrik jelennek meg.\n * activeCategory: aktulisan kivlasztott kategria (f vagy alkategria)  a menben kiemelve.\n */\nexport default function Navbar({\n  activeTab,\n  setActiveTab,\n  wishlistCount,\n  productCount = 0,\n  categories = [],\n  categoryHierarchy = [],\n  activeCategory = '',\n  onOpenWishlist,\n  onCategorySelect,\n  onScrollToShop,\n  recentlyViewed: recentlyViewedProp = [],\n  fixUrl = (url) => url || '',\n  onRecentProductClick\n}) {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const isScrolled = useScrollPastY(20);\n  const [announcementIndex, setAnnouncementIndex] = useState(0);\n  const [announcementProgress, setAnnouncementProgress] = useState(0);\n  const announcementStartRef = useRef(Date.now());\n  const [isDarkMode, setIsDarkMode] = useState(false);\n  const [showMegaMenu, setShowMegaMenu] = useState(false);\n  const [isReturningUser, setIsReturningUser] = useState(false);\n  const [userName, setUserName] = useState('');\n  const [mobileMenuClosing, setMobileMenuClosing] = useState(false);\n  const [touchStartX, setTouchStartX] = useState(0);\n  const [recentlyViewedLocal, setRecentlyViewedLocal] = useState([]);\n  const [recentCategories, setRecentCategories] = useState([]);\n  const [mobileCategoriesExpanded, setMobileCategoriesExpanded] = useState(false);\n  const [mobileExpandedMain, setMobileExpandedMain] = useState(null);\n  const [megaMenuHoverMain, setMegaMenuHoverMain] = useState(null);\n  const mobileMenuRef = useRef(null);\n  const megaMenuRef = useRef(null);\n  const megaMenuPanelRef = useRef(null);\n  const megaMenuCloseTimeoutRef = useRef(null);\n  const hamburgerButtonRef = useRef(null);\n\n  useEffect(() => {\n    const lastVisit = localStorage.getItem('mkt_last_visit');\n    const savedName = localStorage.getItem('mkt_user_name');\n    if (lastVisit) {\n      setIsReturningUser(true);\n      if (savedName) setUserName(savedName);\n    }\n    localStorage.setItem('mkt_last_visit', Date.now().toString());\n  }, []);\n\n  useEffect(() => {\n    const load = () => {\n      try {\n        const raw = localStorage.getItem('recently_viewed');\n        const list = raw ? JSON.parse(raw) : [];\n        setRecentlyViewedLocal(Array.isArray(list) ? list.slice(0, 4) : []);\n      } catch {\n        setRecentlyViewedLocal([]);\n      }\n    };\n    load();\n    window.addEventListener('recently-viewed-updated', load);\n    window.addEventListener('storage', load);\n    return () => {\n      window.removeEventListener('recently-viewed-updated', load);\n      window.removeEventListener('storage', load);\n    };\n  }, []);\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(RECENT_CATEGORIES_KEY);\n      const list = raw ? JSON.parse(raw) : [];\n      setRecentCategories(Array.isArray(list) ? list.slice(0, RECENT_CATEGORIES_MAX) : []);\n    } catch {\n      setRecentCategories([]);\n    }\n  }, []);\n\n  const pushRecentCategory = (name) => {\n    if (!name || name === 'sszes') return;\n    setRecentCategories((prev) => {\n      const next = [name, ...prev.filter((c) => c !== name)].slice(0, RECENT_CATEGORIES_MAX);\n      try {\n        localStorage.setItem(RECENT_CATEGORIES_KEY, JSON.stringify(next));\n      } catch (_) {}\n      return next;\n    });\n  };\n\n  const ANNOUNCEMENT_DURATION_MS = 5500;\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setAnnouncementIndex(prev => (prev + 1) % ANNOUNCEMENT_MESSAGES.length);\n      announcementStartRef.current = Date.now();\n      setAnnouncementProgress(0);\n    }, ANNOUNCEMENT_DURATION_MS);\n    return () => clearInterval(interval);\n  }, []);\n\n  const announcementRafRef = useRef(null);\n  useEffect(() => {\n    const start = announcementStartRef.current;\n    const tick = () => {\n      const elapsed = Date.now() - start;\n      const p = Math.min(100, (elapsed / ANNOUNCEMENT_DURATION_MS) * 100);\n      setAnnouncementProgress(p);\n      if (p < 100) announcementRafRef.current = requestAnimationFrame(tick);\n    };\n    announcementRafRef.current = requestAnimationFrame(tick);\n    return () => {\n      if (announcementRafRef.current) cancelAnimationFrame(announcementRafRef.current);\n    };\n  }, [announcementIndex]);\n\n\n  useEffect(() => {\n    const handleEsc = (e) => { if (e.key === 'Escape') setShowMegaMenu(false); };\n    window.addEventListener('keydown', handleEsc);\n    return () => window.removeEventListener('keydown', handleEsc);\n  }, []);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const handleClickOutside = (e) => {\n      if (megaMenuRef.current && !megaMenuRef.current.contains(e.target)) setShowMegaMenu(false);\n    };\n    document.addEventListener('click', handleClickOutside);\n    return () => document.removeEventListener('click', handleClickOutside);\n  }, [showMegaMenu]);\n\n  useEffect(() => {\n    if (!showMegaMenu) return;\n    const panel = megaMenuPanelRef.current;\n    if (!panel || typeof panel.addEventListener !== 'function') {\n      return;\n    }\n    const focusables = panel.querySelectorAll('button:not([disabled])');\n    const first = focusables[0];\n    if (first) {\n      const t = setTimeout(() => first.focus(), 50);\n      const handleKeyDown = (e) => {\n        if (e.key !== 'Tab') return;\n        const idx = Array.from(focusables).indexOf(document.activeElement);\n        if (e.shiftKey) {\n          if (idx <= 0) {\n            e.preventDefault();\n            focusables[focusables.length - 1]?.focus();\n          }\n        } else {\n          if (idx >= focusables.length - 1 || idx === -1) {\n            e.preventDefault();\n            focusables[0]?.focus();\n          }\n        }\n      };\n      panel.addEventListener('keydown', handleKeyDown);\n      return () => {\n        clearTimeout(t);\n        panel.removeEventListener('keydown', handleKeyDown);\n      };\n    }\n  }, [showMegaMenu]);\n\n  useScrollLock(mobileMenuOpen);\n\n  useEffect(() => {\n    if (mobileMenuOpen) {\n      const handleEsc = (e) => { if (e.key === 'Escape') closeMobileMenu(); };\n      window.addEventListener('keydown', handleEsc);\n      const t = setTimeout(() => mobileMenuRef.current?.querySelector('button[aria-label=\"Men bezrsa\"]')?.focus(), 100);\n      return () => { window.removeEventListener('keydown', handleEsc); clearTimeout(t); };\n    }\n  }, [mobileMenuOpen]);\n\n  useEffect(() => {\n    if (isDarkMode) document.getElementById('mkt-butorbolt-app')?.classList.add('dark-mode');\n    else document.getElementById('mkt-butorbolt-app')?.classList.remove('dark-mode');\n  }, [isDarkMode]);\n\n  const handleTouchStart = (e) => setTouchStartX(e.touches[0].clientX);\n  const handleTouchEnd = (e) => {\n    const touchEndX = e.changedTouches[0].clientX;\n    if (touchEndX - touchStartX > 80) closeMobileMenu();\n  };\n\n  const closeMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuClosing(true);\n    setMobileCategoriesExpanded(false);\n    setMobileExpandedMain(null);\n    setTimeout(() => {\n      setMobileMenuOpen(false);\n      setMobileMenuClosing(false);\n      hamburgerButtonRef.current?.focus();\n    }, 300);\n  };\n\n  const focusSearchAndClose = () => {\n    setActiveTab('shop');\n    closeMobileMenu();\n    setTimeout(() => {\n      onScrollToShop?.();\n      window.dispatchEvent(new CustomEvent('mkt-focus-search'));\n    }, 400);\n  };\n\n  const openMobileMenu = () => {\n    if (navigator.vibrate) navigator.vibrate(10);\n    setMobileMenuOpen(true);\n  };\n\n  const setTabAndClose = (tab) => {\n    setActiveTab(tab);\n    closeMobileMenu();\n    if (tab === 'shop') onScrollToShop?.();\n  };\n\n  const navItems = [\n    { id: 'shop', label: 'Termkek', icon: ShoppingCart, badge: productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : null, desc: 'Bngssz a knlatban' },\n    { id: 'visual-search', label: 'AI Kpkeres', icon: Camera, isAI: true, desc: 'Fotzz s keress' },\n    { id: 'room-planner', label: 'Szobatervez', icon: Move, isAI: true, desc: 'Tervezd meg a szobd' },\n  ];\n\n  const currentAnnouncement = ANNOUNCEMENT_MESSAGES[announcementIndex];\n\n  return (\n    <>\n      <nav\n        id=\"mkt-butorbolt-navbar\"\n        className={`sticky top-0 z-50 transition-all duration-200 ${isScrolled ? 'bg-white/95 backdrop-blur-xl shadow-md border-b border-gray-200' : 'bg-white/90 backdrop-blur-md border-b border-gray-100'}`}\n      >\n        <div className=\"w-full max-w-[2000px] mx-auto px-3 sm:px-4 lg:px-10 xl:px-16 2xl:px-20\">\n          <div className={`flex justify-between items-center transition-all duration-300 py-3 sm:py-2 lg:py-0 ${isScrolled ? 'min-h-[64px] sm:min-h-[72px] lg:min-h-[80px] xl:min-h-[96px]' : 'min-h-[76px] sm:min-h-[80px] lg:min-h-[96px] xl:min-h-[112px]'}`}>\n            <div\n              className=\"flex items-center cursor-pointer group\"\n              onClick={() => { setActiveTab('shop'); onScrollToShop?.(); }}\n              role=\"button\"\n              tabIndex={0}\n              onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setActiveTab('shop'); onScrollToShop?.(); } }}\n              aria-label=\"Marketly.AI  Foldal\"\n            >\n              <div className={`relative bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-500 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mr-3 sm:mr-4 lg:mr-5 transform group-hover:scale-105 group-hover:rotate-3 transition-all duration-300 shadow-lg shadow-primary-300/50 group-hover:shadow-xl ${isScrolled ? 'w-11 h-11 sm:w-12 sm:h-12 lg:w-14 lg:h-14 xl:w-16 xl:h-16' : 'w-12 h-12 sm:w-14 sm:h-14 lg:w-16 lg:h-16 xl:w-20 xl:h-20'}`}>\n                <Home className={isScrolled ? 'w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 xl:w-8 xl:h-8' : 'w-6 h-6 sm:w-7 sm:h-7 lg:w-8 lg:h-8 xl:w-10 xl:h-10'} />\n                <div className=\"absolute -top-1 -right-1 w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6 xl:w-7 xl:h-7 bg-green-400 rounded-full border-2 border-white flex items-center justify-center\">\n                  <Sparkles className=\"w-2 h-2 sm:w-2.5 sm:h-2.5 lg:w-3 lg:h-3 xl:w-4 xl:h-4 text-white\" />\n                </div>\n              </div>\n              <div className=\"flex flex-col\">\n                <div className=\"flex items-baseline\">\n                  <span className={`font-black text-gray-900 tracking-tight transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>Marketly</span>\n                  <span className={`font-black bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent transition-all ${isScrolled ? 'text-xl sm:text-2xl lg:text-3xl xl:text-4xl' : 'text-2xl sm:text-3xl lg:text-4xl xl:text-5xl'}`}>.AI</span>\n                </div>\n                <span className=\"text-[10px] sm:text-xs lg:text-sm xl:text-base text-gray-500 font-semibold tracking-widest -mt-0.5\">BTORBOLT</span>\n              </div>\n            </div>\n\n            <div className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-4 2xl:gap-4\">\n              <div\n                ref={megaMenuRef}\n                className=\"relative\"\n                onMouseEnter={() => {\n                  if (megaMenuCloseTimeoutRef.current) {\n                    clearTimeout(megaMenuCloseTimeoutRef.current);\n                    megaMenuCloseTimeoutRef.current = null;\n                  }\n                  setShowMegaMenu(true);\n                }}\n                onMouseLeave={() => {\n                  megaMenuCloseTimeoutRef.current = setTimeout(() => setShowMegaMenu(false), 180);\n                }}\n              >\n                <button \n                  type=\"button\"\n                  className={`flex items-center gap-2 px-4 py-3 rounded-xl font-semibold text-base transition-all duration-200 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${showMegaMenu ? 'bg-primary-50 text-primary-700 border border-primary-200 shadow-sm' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100 border border-transparent'}`} \n                  aria-label=\"Kategrik men\" \n                  aria-expanded={showMegaMenu} \n                  aria-haspopup=\"true\"\n                >\n                  <Grid3X3 className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>Kategrik</span>\n                  <ChevronDown className={`w-4 h-4 lg:w-5 xl:w-5 transition-transform duration-200 ${showMegaMenu ? 'rotate-180' : ''}`} />\n                </button>\n                {showMegaMenu && (() => {\n                  const hasHierarchy = Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0;\n                  if (hasHierarchy) {\n                    return (\n                      <div\n                        ref={megaMenuPanelRef}\n                        className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] rounded-2xl lg:rounded-3xl z-50\"\n                        onMouseEnter={() => {\n                          if (megaMenuCloseTimeoutRef.current) {\n                            clearTimeout(megaMenuCloseTimeoutRef.current);\n                            megaMenuCloseTimeoutRef.current = null;\n                          }\n                        }}\n                        role=\"dialog\"\n                        aria-label=\"Kategrik men\"\n                      >\n                        <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                        <div className=\"p-4 lg:p-5 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                          <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                          <h3 className=\"text-sm lg:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                        </div>\n                        <div className=\"p-4 lg:p-5 xl:p-6 2xl:p-7 max-h-[65vh] md:max-h-[70vh] overflow-y-auto bg-white\">\n                          <div className=\"grid grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 xl:gap-6\">\n                            {categoryHierarchy.slice(0, 12).map((main, idx) => {\n                              const isHover = megaMenuHoverMain === main.name;\n                              const isActiveMain = activeCategory === main.name;\n                              const children = (main.children || []).slice(0, 8);\n                              const MainIcon = getCategoryIcon(main.name);\n                              const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                              return (\n                                <div\n                                  key={main.name}\n                                  className={`rounded-xl xl:rounded-2xl border-2 transition-colors duration-200 ${isActiveMain ? 'border-primary-300 bg-primary-50' : 'border-gray-200 bg-gray-50 hover:border-primary-200 hover:bg-primary-50/70'}`}\n                                  onMouseEnter={() => setMegaMenuHoverMain(main.name)}\n                                  onMouseLeave={() => setMegaMenuHoverMain(null)}\n                                >\n                                  <button\n                                    onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                    className={`w-full flex items-center gap-3 p-3 xl:p-4 rounded-t-xl xl:rounded-t-2xl text-left min-h-[44px] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 ${isHover || isActiveMain ? 'bg-primary-50' : 'hover:bg-white'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={main.name}\n                                    aria-label={`F kategria: ${main.name}${isActiveMain ? ' (kivlasztva)' : ''}`}\n                                    aria-current={isActiveMain ? 'true' : undefined}\n                                  >\n                                    <div className={`w-10 h-10 xl:w-12 xl:h-12 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                                      <MainIcon className=\"w-5 h-5 xl:w-6 xl:h-6\" />\n                                    </div>\n                                    <div className=\"min-w-0 flex-1\">\n                                      <span className=\"font-bold text-gray-800 text-sm xl:text-base block truncate\">{main.name}</span>\n                                      <span className=\"text-xs text-gray-500\">{Number(main.productCount || 0).toLocaleString('hu-HU')} termk</span>\n                                    </div>\n                                    <ChevronRight className=\"w-4 h-4 text-gray-400 shrink-0\" />\n                                  </button>\n                                  {children.length > 0 && (\n                                    <div className=\"px-3 xl:px-4 pb-3 xl:pb-4 pt-0 flex flex-wrap gap-1.5\">\n                                      {children.map((child) => {\n                                        const isActiveChild = activeCategory === child.name;\n                                        return (\n                                          <button\n                                            key={child.name}\n                                            onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); setShowMegaMenu(false); }}\n                                            className={`px-2.5 py-1.5 text-xs xl:text-sm font-medium rounded-lg transition-colors min-h-[32px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-1 ${isActiveChild ? 'bg-primary-500 text-white' : 'text-gray-600 hover:text-primary-600 hover:bg-primary-100'}`}\n                                            data-nav-action=\"category\"\n                                            data-nav-target={child.name}\n                                            aria-label={`Alkategria: ${child.name}${isActiveChild ? ' (kivlasztva)' : ''}`}\n                                            aria-current={isActiveChild ? 'true' : undefined}\n                                          >\n                                            {child.name}\n                                            {child.productCount != null && <span className={isActiveChild ? 'text-white/80 ml-1' : 'text-gray-400 ml-1'}>({Number(child.productCount).toLocaleString('hu-HU')})</span>}\n                                          </button>\n                                        );\n                                      })}\n                                    </div>\n                                  )}\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                        <div className=\"px-4 lg:px-5 xl:px-6 2xl:px-7 pb-4 lg:pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                          <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 lg:gap-3 py-3 lg:py-3.5 text-sm lg:text-base xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl lg:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                            sszes kategria megtekintse\n                            <ArrowRight className=\"w-4 h-4 lg:w-5 xl:w-5\" />\n                          </button>\n                        </div>\n                        </div>\n                      </div>\n                    );\n                  }\n                  const menuCategories = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes').slice(0, 12) : POPULAR_CATEGORIES;\n                  const isRealCategories = menuCategories.length > 0 && typeof menuCategories[0]?.count === 'number';\n                  return (\n                    <div ref={megaMenuPanelRef} className=\"absolute top-full left-0 pt-1 w-[min(90vw,640px)] md:w-[min(92vw,680px)] lg:w-[640px] xl:w-[720px] 2xl:w-[800px] z-50\" onMouseEnter={() => { if (megaMenuCloseTimeoutRef.current) { clearTimeout(megaMenuCloseTimeoutRef.current); megaMenuCloseTimeoutRef.current = null; } }} role=\"dialog\" aria-label=\"Kategrik men\">\n                      <div className=\"bg-white rounded-2xl lg:rounded-3xl shadow-[0_20px_60px_-12px_rgba(0,0,0,0.25),0_0_0_1px_rgba(0,0,0,0.06)] overflow-hidden animate-fade-in-up\">\n                      <div className=\"p-4 xl:p-5 border-b border-gray-200 bg-gray-50\">\n                        <p className=\"text-xs text-gray-500 font-medium\" aria-hidden=\"true\">Termkek &gt; Kategrik</p>\n                        <h3 className=\"text-sm xl:text-base font-bold text-gray-700 uppercase tracking-wider mt-0.5\">Bngssz kategrik szerint</h3>\n                      </div>\n                      <div className=\"p-5 xl:p-6 2xl:p-7\">\n                        <div className=\"grid grid-cols-4 gap-3 xl:gap-4 2xl:gap-5\">\n                          {menuCategories.map((cat, idx) => {\n                            const name = cat?.name ?? String(cat?.id ?? idx);\n                            const Icon = isRealCategories ? getCategoryIcon(name) : cat?.icon ?? Grid3X3;\n                            const color = isRealCategories ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                            return (\n                              <button key={isRealCategories ? name : (cat?.id ?? `cat-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"flex flex-col items-center gap-2 xl:gap-2.5 p-3 xl:p-4 rounded-xl xl:rounded-2xl hover:bg-gray-50 hover:scale-[1.02] active:scale-[0.98] active:bg-gray-100 transition-all duration-200 group min-h-[44px]\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                                <div className={`w-11 h-11 xl:w-14 xl:h-14 2xl:w-16 2xl:h-16 rounded-xl xl:rounded-2xl bg-gradient-to-br ${color} flex items-center justify-center text-white group-hover:scale-110 shadow-md group-hover:shadow-lg transition-all duration-200`}>\n                                  <Icon className=\"w-5 h-5 xl:w-7 xl:h-7 2xl:w-8 2xl:h-8\" />\n                                </div>\n                                <span className=\"text-xs xl:text-sm 2xl:text-base font-semibold text-gray-700 text-center leading-tight line-clamp-2\">{name}</span>\n                                {isRealCategories && cat.count != null && <span className=\"text-[10px] xl:text-xs text-gray-400\">{Number(cat.count).toLocaleString('hu-HU')} db</span>}\n                              </button>\n                            );\n                          })}\n                        </div>\n                      </div>\n                      <div className=\"px-5 xl:px-6 2xl:px-7 pb-5 xl:pb-6 2xl:pb-7 pt-0 border-t border-gray-200 bg-gray-50\">\n                        <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); setShowMegaMenu(false); }} className=\"w-full flex items-center justify-center gap-2 xl:gap-3 py-3 xl:py-3.5 text-sm xl:text-base 2xl:text-lg text-primary-600 hover:bg-primary-100 rounded-xl xl:rounded-2xl font-bold transition-all border-2 border-primary-200 hover:border-primary-300 min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\" data-nav-action=\"category\" data-nav-target=\"sszes\" aria-label=\"sszes kategria megtekintse\">\n                          sszes kategria megtekintse\n                          <ArrowRight className=\"w-4 h-4 xl:w-5 xl:h-5\" />\n                        </button>\n                      </div>\n                      </div>\n                    </div>\n                  );\n                })()}\n              </div>\n              {navItems.map((item) => (\n                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`relative flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-6 2xl:px-7 py-2.5 lg:py-3 xl:py-3.5 2xl:py-4 rounded-xl lg:rounded-2xl font-bold text-sm lg:text-base xl:text-lg 2xl:text-xl transition-all duration-200 min-h-[44px] hover:scale-[1.02] active:scale-[0.98] ${activeTab === item.id ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg shadow-primary-300/50' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'}`} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <item.icon className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                  <span>{item.label}</span>\n                  {item.isAI && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-gradient-to-r from-primary-100 to-secondary-100 text-primary-500 rounded-full\">AI</span>}\n                  {item.badge && activeTab !== item.id && <span className=\"px-2 py-0.5 xl:px-2.5 xl:py-1 text-[10px] xl:text-xs font-bold bg-green-100 text-green-700 rounded-full\">{item.badge}</span>}\n                </button>\n              ))}\n            </div>\n\n            <div className=\"flex items-center gap-2 sm:gap-3 lg:gap-4\">\n              <button onClick={() => { setActiveTab('shop'); onScrollToShop?.(); window.dispatchEvent(new CustomEvent('mkt-focus-search')); }} className=\"hidden md:flex items-center gap-2 lg:gap-3 xl:gap-3 px-3 lg:px-4 xl:px-5 py-2.5 lg:py-3 min-h-[44px] bg-gray-100 hover:bg-gray-200 rounded-xl lg:rounded-2xl text-gray-600 hover:text-gray-900 hover:scale-[1.02] active:scale-[0.98] transition-all\" aria-label=\"Keress\" data-nav-action=\"search\">\n                <Search className=\"w-5 h-5 lg:w-5 xl:w-6 xl:h-6\" />\n                <span className=\"text-sm lg:text-base font-bold\">Keress</span>\n              </button>\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"hidden sm:flex p-2.5 sm:p-3 min-w-[44px] min-h-[44px] items-center justify-center text-gray-600 hover:text-gray-900 rounded-xl lg:rounded-2xl hover:bg-gray-100 transition-all\" aria-label={isDarkMode ? 'Vilgos md' : 'Stt md'}>\n                {isDarkMode ? <Sun className=\"w-5 h-5 sm:w-6 sm:h-6\" /> : <Moon className=\"w-5 h-5 sm:w-6 sm:h-6\" />}\n              </button>\n              <button onClick={onOpenWishlist} className=\"relative p-2.5 sm:p-3 min-w-[44px] min-h-[44px] flex items-center justify-center text-gray-600 hover:text-red-500 rounded-xl lg:rounded-2xl hover:bg-red-50 transition-all group\" aria-label=\"Kvnsglista\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 transition-all group-hover:scale-110 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : ''}`} />\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 min-w-[20px] h-5 flex items-center justify-center px-1.5 text-xs font-bold text-white bg-red-500 rounded-full shadow-lg animate-scale-in\">{wishlistCount}</span>}\n              </button>\n              <button ref={hamburgerButtonRef} type=\"button\" className=\"md:hidden p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-xl bg-gradient-to-r from-primary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl transition-all\" onClick={openMobileMenu} aria-label=\"Men megnyitsa\">\n                <Menu className=\"w-6 h-6\" />\n              </button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <div className=\"bg-gradient-to-r from-primary-500/95 via-secondary-600 to-secondary-500/95 text-white py-1.5 sm:py-2 px-3 sm:px-4 lg:px-6 text-center relative overflow-hidden shadow-sm\">\n        <div className=\"absolute inset-0 opacity-15\" style={{ backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.4) 1px, transparent 1px)', backgroundSize: '12px 12px' }} aria-hidden=\"true\" />\n        <div className=\"relative flex items-center justify-center gap-2 sm:gap-3 min-h-[36px] sm:min-h-[40px]\">\n          <div key={announcementIndex} className=\"flex items-center gap-2 sm:gap-3 animate-fade-in max-w-full\" role=\"marquee\" aria-live=\"polite\">\n            <currentAnnouncement.icon className=\"w-4 h-4 shrink-0 text-white/90\" aria-hidden />\n            <span className=\"text-xs sm:text-sm lg:text-base font-semibold truncate\">\n              {currentAnnouncement.text.split(currentAnnouncement.highlight).map((part, i, arr) => (\n                <React.Fragment key={i}>\n                  {part}\n                  {i < arr.length - 1 && <span className=\"font-bold bg-white/25 px-1.5 py-0.5 rounded-md mx-1 shadow-sm\">{currentAnnouncement.highlight}</span>}\n                </React.Fragment>\n              ))}\n            </span>\n          </div>\n          <div className=\"hidden sm:flex items-center gap-1 ml-3\">\n            {ANNOUNCEMENT_MESSAGES.map((_, i) => (\n              <div key={i} className={`w-1.5 h-1.5 rounded-full transition-all duration-300 ${i === announcementIndex ? 'bg-white w-4' : 'bg-white/40'}`} />\n            ))}\n          </div>\n        </div>\n        <div className=\"absolute bottom-0 left-0 right-0 h-px bg-white/25\" aria-hidden=\"true\">\n          <div className=\"h-full bg-white/80 transition-[width] duration-150 ease-linear\" style={{ width: `${announcementProgress}%` }} />\n        </div>\n      </div>\n\n      {isReturningUser && (\n        <div className=\"w-full flex justify-center px-4 sm:px-6 lg:px-10 pt-2 pb-2\">\n          <div className=\"inline-flex items-center justify-center gap-2 sm:gap-3 bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200/60 rounded-full py-1.5 px-4 sm:px-6 lg:px-8 shadow-sm w-auto lg:min-w-[400px]\">\n            <div className=\"w-7 h-7 sm:w-8 sm:h-8 bg-gradient-to-br from-emerald-400 to-green-500 rounded-full flex items-center justify-center text-white text-sm shrink-0\"></div>\n            <p className=\"text-sm font-bold text-gray-900 whitespace-nowrap\">dv jra{userName ? `, ${userName}` : ''}!</p>\n            <span className=\"text-xs text-emerald-600 whitespace-nowrap hidden sm:inline\">rlnk, hogy visszatrtl</span>\n            <Sparkles className=\"w-4 h-4 text-emerald-500/60 shrink-0\" />\n          </div>\n        </div>\n      )}\n\n      {mobileMenuOpen && (\n        <>\n          <button type=\"button\" className=\"fixed inset-0 z-[199] md:hidden bg-gray-900/60\" onClick={closeMobileMenu} aria-label=\"Men bezrsa (httr)\" />\n          <div\n            ref={mobileMenuRef}\n            className={`fixed top-0 right-0 z-[200] md:hidden ${mobileMenuClosing ? 'animate-slide-out-right' : 'animate-slide-in-right'}`}\n            style={{\n              width: 'min(400px, 88vw)',\n              minWidth: '280px',\n              maxWidth: '400px',\n              bottom: 'var(--unas-bottom-nav, 40px)',\n            }}\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-label=\"Navigcis men\"\n            onTouchStart={handleTouchStart}\n            onTouchEnd={handleTouchEnd}\n            onClick={(e) => e.stopPropagation()}\n          >\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary-600 via-secondary-700 to-secondary-800 rounded-l-2xl overflow-hidden shadow-2xl shadow-black/20\" />\n          <div className=\"relative h-full flex flex-col text-white p-4 sm:p-6 overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-5\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-12 h-12 sm:w-14 sm:h-14 bg-white rounded-xl flex items-center justify-center shadow-lg text-primary-600\"><Home className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                <div>\n                  <div className=\"flex items-baseline\"><span className=\"font-black text-2xl sm:text-3xl text-white\">Marketly</span><span className=\"font-black text-2xl sm:text-3xl text-white/90\">.AI</span></div>\n                  <p className=\"text-xs sm:text-sm text-white/70 font-medium tracking-wider\">BTORBOLT</p>\n                </div>\n              </div>\n              <button type=\"button\" className=\"p-3 min-w-[48px] min-h-[48px] flex items-center justify-center rounded-xl bg-white/20 hover:bg-white/30 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" onClick={closeMobileMenu} aria-label=\"Men bezrsa\"><X className=\"w-7 h-7\" /></button>\n            </div>\n            <div className=\"flex gap-3 sm:gap-4 mb-6\" role=\"region\" aria-label=\"Gyors mveletek\">\n              <button onClick={focusSearchAndClose} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Keress\" data-nav-action=\"search\"><Search className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-600\" /><span>Keress</span></button>\n              <button onClick={() => { onOpenWishlist?.(); closeMobileMenu(); }} className=\"flex-1 flex items-center justify-center gap-2.5 py-4 min-h-[44px] bg-white rounded-xl font-bold text-gray-800 text-base sm:text-lg relative hover:bg-gray-100 active:scale-[0.98] transition-all shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-600\" aria-label=\"Kedvencek\" data-nav-action=\"wishlist\">\n                <Heart className={`w-5 h-5 sm:w-6 sm:h-6 ${wishlistCount > 0 ? 'fill-red-500 text-red-500' : 'text-gray-600'}`} /><span>Kedvencek</span>\n                {wishlistCount > 0 && <span className=\"absolute -top-1 -right-1 w-6 h-6 bg-red-500 rounded-full text-sm flex items-center justify-center font-bold text-white\">{wishlistCount}</span>}\n              </button>\n            </div>\n            <div className=\"mb-4\" role=\"region\" aria-label=\"Kategrik\">\n              {recentCategories.length > 0 && (\n                <div className=\"mb-3\">\n                  <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-1.5\">Gyakran nzett</p>\n                  <div className=\"flex flex-wrap gap-2 justify-start\">\n                    {recentCategories.map((name) => {\n                      const Icon = getCategoryIcon(name);\n                      const idx = recentCategories.indexOf(name);\n                      const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                      return (\n                        <button key={name} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex items-center gap-2 py-2.5 px-3.5 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] min-w-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                          <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 text-white\" /></div>\n                          <span className=\"text-xs font-semibold text-left text-white\">{name}</span>\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              <p className=\"text-xs text-white/90 font-bold uppercase tracking-wider mb-3\">Kategrik</p>\n              {Array.isArray(categoryHierarchy) && categoryHierarchy.length > 0 ? (\n                <div className=\"space-y-2\">\n                  {categoryHierarchy.slice(0, 16).map((main, idx) => {\n                    const isExpanded = mobileExpandedMain === main.name;\n                    const isActiveMain = activeCategory === main.name;\n                    const children = (main.children || []).slice(0, 10);\n                    const MainIcon = getCategoryIcon(main.name);\n                    const color = MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length];\n                    return (\n                      <div key={main.name} className=\"rounded-xl overflow-hidden bg-white/15 border border-white/25 shadow-lg\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setMobileExpandedMain((v) => (v === main.name ? null : main.name))}\n                          className={`w-full flex items-center gap-3 px-4 py-4 min-h-[48px] text-left transition-colors duration-150 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-inset ${isExpanded ? 'bg-white/20' : 'hover:bg-white/20'}`}\n                          aria-expanded={isExpanded}\n                          aria-label={isExpanded ? `${main.name} sszecsuksa` : `${main.name} kategria megnyitsa`}\n                          data-nav-action=\"category-expand\"\n                          data-nav-target={main.name}\n                        >\n                          <div className={`w-11 h-11 rounded-xl bg-gradient-to-br ${color} flex items-center justify-center text-white shrink-0 shadow-md`}>\n                            <MainIcon className=\"w-5 h-5\" />\n                          </div>\n                          <span className=\"font-bold text-white flex-1 text-left\">{main.name}</span>\n                          <span className=\"text-white/90 text-sm tabular-nums\">{Number(main.productCount || 0).toLocaleString('hu-HU')}</span>\n                          <span className=\"text-white/70\">{isExpanded ? <ChevronUp className=\"w-5 h-5\" /> : <ChevronDown className=\"w-5 h-5\" />}</span>\n                        </button>\n                        {isExpanded && children.length > 0 && (\n                          <div className=\"px-4 pb-4 pt-2 border-t border-white/20 bg-white/10\">\n                            <div className=\"flex flex-wrap gap-2 justify-start text-left\">\n                              <button\n                                onClick={() => { pushRecentCategory(main.name); onCategorySelect?.(main.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                className={`px-3 py-2.5 text-sm font-semibold rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white ${isActiveMain ? 'bg-primary-500 text-white' : 'bg-white/20 text-white hover:bg-white/30 border border-white/25'}`}\n                                data-nav-action=\"category\"\n                                data-nav-target={main.name}\n                              >\n                                sszes ({main.name})\n                              </button>\n                              {children.map((child) => {\n                                const isActiveChild = activeCategory === child.name;\n                                return (\n                                  <button\n                                    key={child.name}\n                                    onClick={() => { pushRecentCategory(child.name); onCategorySelect?.(child.name); setActiveTab('shop'); closeMobileMenu(); }}\n                                    className={`px-3 py-2.5 text-sm font-medium rounded-xl min-h-[44px] transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white text-left ${isActiveChild ? 'bg-primary-500 text-white' : 'bg-white/20 text-white/95 hover:bg-white/30 border border-white/25'}`}\n                                    data-nav-action=\"category\"\n                                    data-nav-target={child.name}\n                                  >\n                                    {child.name}\n                                  </button>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                  <button onClick={() => { onCategorySelect?.('sszes'); setActiveTab('shop'); closeMobileMenu(); }} className=\"w-full flex items-center justify-center gap-2 py-4 mt-3 bg-white/15 rounded-xl font-bold text-white hover:bg-white/25 active:scale-[0.99] min-h-[48px] transition-all border border-white/25 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" data-nav-action=\"category\" data-nav-target=\"sszes\">\n                    sszes termk\n                    <ArrowRight className=\"w-5 h-5\" />\n                  </button>\n                </div>\n              ) : (\n                (() => {\n                  const realCats = (Array.isArray(categories) && categories.length > 0) ? categories.filter(c => c && c.name && c.name !== 'sszes') : [];\n                  const list = realCats.length > 0 ? realCats : POPULAR_CATEGORIES;\n                  const initialCount = 6;\n                  const shown = mobileCategoriesExpanded ? list : list.slice(0, initialCount);\n                  const hasMore = list.length > initialCount;\n                  return (\n                    <>\n                      <div className=\"grid grid-cols-4 gap-2\">\n                        {shown.map((cat, idx) => {\n                          const name = typeof cat?.name === 'string' ? cat.name : (cat?.name ?? '');\n                          const isReal = realCats.length > 0;\n                          const Icon = isReal ? getCategoryIcon(name) : (cat?.icon ?? Grid3X3);\n                          const color = isReal ? MEGA_MENU_COLORS[idx % MEGA_MENU_COLORS.length] : (cat?.color ?? 'from-primary-500 to-secondary-700');\n                          return (\n                            <button key={isReal ? name : (cat?.id ?? `m-${idx}`)} onClick={() => { pushRecentCategory(name); onCategorySelect?.(name); setActiveTab('shop'); closeMobileMenu(); }} className=\"flex flex-col items-center gap-1 py-2.5 px-1 bg-white/15 rounded-xl hover:bg-white/25 active:scale-[0.98] transition-all min-h-[44px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" data-nav-action=\"category\" data-nav-target={name} aria-label={`Kategria: ${name}`}>\n                              <div className={`w-9 h-9 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br ${color} flex items-center justify-center shrink-0 shadow`}><Icon className=\"w-4 h-4 sm:w-5 sm:h-5 text-white\" /></div>\n                              <span className=\"text-[10px] sm:text-xs font-semibold text-center line-clamp-2 leading-tight text-white\">{name}</span>\n                            </button>\n                          );\n                        })}\n                      </div>\n                      {hasMore && (\n                        <button type=\"button\" onClick={() => setMobileCategoriesExpanded((v) => !v)} className=\"mt-2 w-full flex items-center justify-center gap-2 py-3.5 bg-white/15 rounded-xl hover:bg-white/25 transition-all min-h-[44px] text-white font-semibold text-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-white border border-white/20\" aria-expanded={mobileCategoriesExpanded} aria-label={mobileCategoriesExpanded ? 'Kevesebb kategria' : 'Tbb kategria megjelentse'}>\n                          {mobileCategoriesExpanded ? 'Kevesebb' : 'Tbb megjelentse'}\n                          {mobileCategoriesExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                        </button>\n                      )}\n                    </>\n                  );\n                })()\n              )}\n            </div>\n            <div className=\"space-y-3 mb-6\" role=\"region\" aria-label=\"Navigci\">\n              <p className=\"text-sm sm:text-base text-white/90 font-bold uppercase tracking-wider mb-3 sm:mb-4\">Navigci</p>\n              {navItems.map((item, index) => (\n                <button key={item.id} onClick={() => setTabAndClose(item.id)} className={`w-full flex items-center gap-4 px-4 sm:px-5 py-4 sm:py-5 rounded-xl text-left transition-all min-h-[44px] hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-primary-700 ${activeTab === item.id ? 'bg-white text-gray-900 shadow-xl' : 'bg-gray-800 hover:bg-gray-700 border border-gray-700'}`} style={{ animationDelay: `${index * 50}ms` }} aria-current={activeTab === item.id ? 'page' : undefined} aria-label={item.label} data-nav-action=\"tab\" data-nav-target={item.id}>\n                  <div className={`w-12 h-12 sm:w-14 sm:h-14 rounded-xl flex items-center justify-center shrink-0 ${activeTab === item.id ? 'bg-gradient-to-br from-primary-500 to-secondary-700 text-white' : 'bg-gray-700 text-white'}`}><item.icon className=\"w-6 h-6 sm:w-7 sm:h-7\" /></div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className={`text-lg sm:text-xl font-bold ${activeTab === item.id ? 'text-gray-900' : 'text-white'}`}>{item.label}</span>\n                      {item.isAI && <span className={`px-2 py-0.5 text-xs font-bold rounded-full ${activeTab === item.id ? 'bg-primary-100 text-primary-500' : 'bg-white/20 text-white'}`}>AI</span>}\n                    </div>\n                    <p className={`text-sm sm:text-base ${activeTab === item.id ? 'text-gray-500' : 'text-white/60'}`}>{item.desc}</p>\n                  </div>\n                  <ChevronRight className={`w-5 h-5 sm:w-6 sm:h-6 shrink-0 ${activeTab === item.id ? 'text-primary-500' : 'text-white/40'}`} />\n                </button>\n              ))}\n            </div>\n            {((recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal) || []).length > 0 && (\n              <div className=\"mb-4\" role=\"region\" aria-label=\"Utoljra nzett termkek\">\n                <p className=\"text-xs text-white/90 font-semibold uppercase tracking-wider mb-2 flex items-center gap-1.5\"><Clock className=\"w-3.5 h-3.5\" />Utoljra nzett</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n                  {(recentlyViewedProp?.length ? recentlyViewedProp : recentlyViewedLocal).slice(0, 4).map((product) => (\n                    <button key={product?.id ?? 'rv'} type=\"button\" onClick={() => { onRecentProductClick?.(product); closeMobileMenu(); }} className=\"shrink-0 w-20 min-h-[44px] text-left rounded-xl bg-gray-800 hover:bg-gray-700 hover:scale-[1.02] active:scale-[0.98] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white overflow-hidden\" data-nav-action=\"recent-product\" data-nav-target={product?.id} aria-label={`Termk megnyitsa: ${product?.name ?? ''}`}>\n                      <div className=\"w-20 h-20 bg-gray-700 rounded-t-xl overflow-hidden mb-1\">\n                        <img src={fixUrl(product?.imageUrl ?? product?.images?.[0])} alt={product?.name ?? ''} className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                      </div>\n                      <p className=\"text-[10px] text-white/90 truncate px-1 pb-1\">{product?.name ?? ''}</p>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n            <div className=\"mt-auto space-y-3 pb-[env(safe-area-inset-bottom,0)]\" role=\"region\" aria-label=\"Belltsok s elrhetsg\">\n              <button onClick={() => setIsDarkMode(!isDarkMode)} className=\"w-full flex items-center justify-between px-4 py-3.5 min-h-[44px] bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label={isDarkMode ? 'Vilgos md bekapcsolsa' : 'Stt md bekapcsolsa'}>\n                <div className=\"flex items-center gap-3\">{isDarkMode ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}<span className=\"font-semibold text-white\">{isDarkMode ? 'Vilgos md' : 'Stt md'}</span></div>\n                <div className={`w-10 h-6 rounded-full transition-colors ${isDarkMode ? 'bg-primary-400' : 'bg-gray-600'}`}><div className={`w-5 h-5 bg-white rounded-full mt-0.5 transition-transform ${isDarkMode ? 'translate-x-4.5 ml-0.5' : 'translate-x-0.5'}`} /></div>\n              </button>\n              <div className=\"flex gap-2\">\n                <a href=\"tel:+36123456789\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Hvs\"><Phone className=\"w-4 h-4\" />Hvs</a>\n                <a href=\"mailto:info@marketly.hu\" className=\"flex-1 flex items-center justify-center gap-2 py-2.5 min-h-[44px] bg-gray-800 rounded-xl text-sm font-semibold text-white hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"E-mail kldse\"><Mail className=\"w-4 h-4\" />Email</a>\n              </div>\n              <div className=\"flex justify-center gap-3\">\n                <a href=\"https://instagram.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Instagram\"><Instagram className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://facebook.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Facebook\"><Facebook className=\"w-5 h-5 text-white\" /></a>\n                <a href=\"https://maps.google.com\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"p-2.5 min-w-[44px] min-h-[44px] flex items-center justify-center bg-gray-800 rounded-xl hover:bg-gray-700 transition-all border border-gray-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-white\" aria-label=\"Trkp\"><MapPin className=\"w-5 h-5 text-white\" /></a>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2\">\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">{productCount > 0 ? `${(productCount / 1000).toFixed(0)}K+` : '...'}</p><p className=\"text-[9px] text-white/70\">Termk</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">24/7</p><p className=\"text-[9px] text-white/70\">AI Support</p></div>\n                <div className=\"bg-gray-800 rounded-xl p-2.5 text-center border border-gray-700\"><p className=\"text-lg font-bold text-white\">4.9</p><p className=\"text-[9px] text-white/70\">rtkels</p></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        </>\n      )}\n    </>\n  );\n}\n","import React from 'react';\nimport { useScrollPosition } from '../../hooks/useScrollPosition';\n\n/**\n * ScrollProgress - Shows reading/scrolling progress at top of page\n * Gradient bar that fills as user scrolls down. Uses shared scroll hook.\n */\nconst ScrollProgress = () => {\n  const { scrollPercent } = useScrollPosition();\n\n  return (\n    <div className=\"fixed top-0 left-0 right-0 z-50 h-1 bg-gray-200/50\">\n      <div\n        className=\"h-full bg-gradient-to-r from-primary-500 via-secondary-600 to-pink-500 transition-all duration-150 ease-out\"\n        style={{ width: `${scrollPercent}%` }}\n      />\n      {/* Glow effect at the end */}\n      {scrollPercent > 0 && (\n        <div\n          className=\"absolute top-0 h-full w-8 bg-gradient-to-r from-transparent via-white to-transparent opacity-60 blur-sm\"\n          style={{ \n            left: `${Math.max(0, scrollPercent - 2)}%`,\n            transition: 'left 150ms ease-out'\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ScrollProgress;\n","import React from 'react';\nimport { ArrowUp } from 'lucide-react';\nimport { useScrollPastPercent } from '../../hooks/useScrollPosition';\n\n/**\n * BackToTop - Floating button to scroll back to top\n * Only appears after scrolling down 30%. Uses shared scroll hook.\n */\nconst BackToTop = () => {\n  const isVisible = useScrollPastPercent(30);\n\n  const scrollToTop = () => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n    \n    // Haptic feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <button\n      type=\"button\"\n      onClick={scrollToTop}\n      className=\"\n        fixed bottom-[calc(5rem+44px)] md:bottom-24 right-4 md:right-6 z-40\n        w-11 h-11 md:w-12 md:h-12 rounded-full min-w-[44px] min-h-[44px]\n        bg-gradient-to-br from-primary-500 to-secondary-700\n        text-white shadow-lg\n        flex items-center justify-center\n        transition-all duration-300\n        hover:scale-110 hover:shadow-xl\n        active:scale-95\n        animate-fade-in-up\n        focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2\n      \"\n      aria-label=\"Vissza a tetejre\"\n      title=\"Vissza a tetejre\"\n    >\n      <ArrowUp className=\"w-5 h-5 md:w-6 md:h-6\" />\n      \n      {/* Pulse animation ring */}\n      <span className=\"absolute inset-0 rounded-full bg-primary-500 opacity-0 animate-ping\" />\n    </button>\n  );\n};\n\nexport default BackToTop;\n","/**\n * Framer-motion shim - CSS transition based replacements\n * Fixes Vite production build TDZ issues with framer-motion\n */\nimport React, { forwardRef } from 'react';\n\nconst createMotionComponent = (tag) => {\n  return forwardRef(({\n    children,\n    initial,\n    animate,\n    exit,\n    transition,\n    whileHover,\n    whileTap,\n    variants,\n    className = '',\n    style = {},\n    ...props\n  }, ref) => {\n    const Tag = tag;\n    return (\n      <Tag\n        ref={ref}\n        className={`transition-all duration-300 ${className}`}\n        style={style}\n        {...props}\n      >\n        {children}\n      </Tag>\n    );\n  });\n};\n\nexport const motion = {\n  div: createMotionComponent('div'),\n  span: createMotionComponent('span'),\n  button: createMotionComponent('button'),\n  a: createMotionComponent('a'),\n  ul: createMotionComponent('ul'),\n  li: createMotionComponent('li'),\n  p: createMotionComponent('p'),\n  h1: createMotionComponent('h1'),\n  h2: createMotionComponent('h2'),\n  h3: createMotionComponent('h3'),\n  section: createMotionComponent('section'),\n  article: createMotionComponent('article'),\n  nav: createMotionComponent('nav'),\n  aside: createMotionComponent('aside'),\n  img: createMotionComponent('img'),\n};\n\nexport const AnimatePresence = ({ children }) => <>{children}</>;\n\nexport default motion;\n","import React, { useState, useEffect } from 'react';\nimport { Eye, ShoppingBag, TrendingUp, Users } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * LiveSocialProof - Real-time social proof notifications\n * Shows viewer count, recent purchases, trending items\n */\nconst LiveSocialProof = ({ currentProduct, recentPurchases = [] }) => {\n  const [viewerCount, setViewerCount] = useState(0);\n  const [showNotification, setShowNotification] = useState(false);\n  const [currentNotification, setCurrentNotification] = useState(null);\n\n  // Generate realistic viewer count\n  useEffect(() => {\n    const baseViewers = Math.floor(Math.random() * 30) + 15; // 15-45\n    setViewerCount(baseViewers);\n\n    const interval = setInterval(() => {\n      setViewerCount(prev => {\n        const change = Math.floor(Math.random() * 5) - 2; // -2 to +2\n        return Math.max(10, Math.min(50, prev + change));\n      });\n    }, 10000); // Update every 10s\n\n    return () => clearInterval(interval);\n  }, [currentProduct]);\n\n  // Show at most ONE notification per product view (after 5s), no repeated spam\n  useEffect(() => {\n    if (!currentProduct) {\n      setShowNotification(false);\n      setCurrentNotification(null);\n      return;\n    }\n\n    const notifications = [\n      {\n        icon: ShoppingBag,\n        text: `\"${currentProduct.name}\" npszer vlaszts`,\n        time: '2 perce',\n        color: 'text-green-600',\n        bg: 'bg-green-50'\n      },\n      {\n        icon: TrendingUp,\n        text: `Ez a ${currentProduct.category} most npszer`,\n        time: 'pp most',\n        color: 'text-orange-600',\n        bg: 'bg-orange-50'\n      },\n      {\n        icon: Users,\n        text: `${Math.floor(Math.random() * 10) + 5} ember nzi most`,\n        time: 'l',\n        color: 'text-blue-600',\n        bg: 'bg-blue-50'\n      }\n    ];\n\n    const random = notifications[Math.floor(Math.random() * notifications.length)];\n    setCurrentNotification(random);\n\n    // Single notification 5s after viewing this product; no interval\n    const t = setTimeout(() => {\n      setShowNotification(true);\n      setTimeout(() => setShowNotification(false), 5000);\n    }, 5000);\n\n    return () => {\n      clearTimeout(t);\n      setShowNotification(false);\n    };\n  }, [currentProduct?.id]);\n\n  return (\n    <>\n      {/* Floating Viewer Counter */}\n      {currentProduct && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"fixed bottom-[calc(10rem+44px)] md:bottom-40 left-4 md:left-6 z-40 bg-white rounded-full shadow-lg px-3 md:px-4 py-1.5 md:py-2 flex items-center gap-2\"\n        >\n          <div className=\"relative\">\n            <Eye className=\"w-5 h-5 text-primary-500\" />\n            <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold text-gray-800\">{viewerCount} ember</p>\n            <p className=\"text-xs text-gray-500\">nzi most</p>\n          </div>\n        </motion.div>\n      )}\n\n      {/* Notification Toasts */}\n      <AnimatePresence>\n        {showNotification && currentNotification && (\n          <motion.div\n            initial={{ opacity: 0, y: 50, scale: 0.9 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 50, scale: 0.9 }}\n            transition={{ type: 'spring', stiffness: 300, damping: 25 }}\n            className={`\n              fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-2 md:left-6 z-50\n              max-w-[calc(100vw-1rem)] md:max-w-sm rounded-xl shadow-2xl p-3 md:p-4\n              ${currentNotification.bg} border border-gray-200\n              backdrop-blur-sm\n            `}\n          >\n            <div className=\"flex items-start gap-3\">\n              <div className={`p-2 rounded-lg ${currentNotification.color} bg-white/50`}>\n                <currentNotification.icon className=\"w-5 h-5\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-gray-800\">\n                  {currentNotification.text}\n                </p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {currentNotification.time}\n                </p>\n              </div>\n              <button\n                onClick={() => setShowNotification(false)}\n                className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                aria-label=\"Bezrs\"\n              >\n                \n              </button>\n            </div>\n\n            {/* Progress bar */}\n            <motion.div\n              initial={{ width: '100%' }}\n              animate={{ width: '0%' }}\n              transition={{ duration: 5, ease: 'linear' }}\n              className=\"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-primary-500 to-secondary-600 rounded-bl-xl\"\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  );\n};\n\nexport default LiveSocialProof;\n","import React, { useState, useEffect } from 'react';\nimport { Circle, Users } from 'lucide-react';\n\n/**\n * LiveActivityStrip  \"X vsrl most bngsz\" social proof.\n * Random szm 525, enyhe animci.\n */\nconst MIN_VIEWERS = 5;\nconst MAX_VIEWERS = 25;\n\nfunction getRandomViewers() {\n  return Math.floor(Math.random() * (MAX_VIEWERS - MIN_VIEWERS + 1)) + MIN_VIEWERS;\n}\n\nexport default function LiveActivityStrip({ className = '' }) {\n  const [viewers, setViewers] = useState(() => getRandomViewers());\n\n  useEffect(() => {\n    const t = setInterval(() => {\n      setViewers((prev) => {\n        const delta = Math.random() > 0.5 ? 1 : -1;\n        const next = prev + delta;\n        return Math.max(MIN_VIEWERS, Math.min(MAX_VIEWERS, next));\n      });\n    }, 4000 + Math.random() * 4000);\n    return () => clearInterval(t);\n  }, []);\n\n  return (\n    <div\n      className={`flex items-center gap-2 text-sm text-gray-600 ${className}`}\n      role=\"status\"\n      aria-live=\"polite\"\n      aria-label={`${viewers} vsrl jelenleg bngsz`}\n    >\n      <Circle className=\"w-2 h-2 text-emerald-500 fill-emerald-500 shrink-0 animate-pulse\" aria-hidden />\n      <Users className=\"w-4 h-4 text-gray-400 shrink-0\" aria-hidden />\n      <span>\n        <strong className=\"text-gray-900 font-semibold\">{viewers}</strong> vsrl most bngsz\n      </span>\n    </div>\n  );\n}\n","import { useState, useEffect, useRef } from 'react';\n\n/**\n * CountUp animation component\n * Counts from 0 to target value with easing\n */\nexport const CountUp = ({ end, duration = 2000, suffix = '', decimals = 0, start = 0, delay = 0 }) => {\n  const [count, setCount] = useState(start);\n  const [isVisible, setIsVisible] = useState(false);\n  const countRef = useRef(null);\n  const hasStarted = useRef(false);\n  const timeoutRef = useRef(null);\n\n  useEffect(() => {\n    const element = countRef.current;\n    if (!element) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted.current) {\n          hasStarted.current = true;\n          timeoutRef.current = setTimeout(() => setIsVisible(true), delay);\n        }\n      },\n      { threshold: 0.1 }\n    );\n\n    observer.observe(element);\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      observer.disconnect();\n    };\n  }, [delay]);\n\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const startTime = Date.now();\n    const diff = end - start;\n\n    const easeOutQuad = (t) => t * (2 - t);\n\n    const timer = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      const easedProgress = easeOutQuad(progress);\n      const current = start + diff * easedProgress;\n\n      setCount(current);\n\n      if (progress === 1) {\n        clearInterval(timer);\n      }\n    }, 16); // ~60fps\n\n    return () => clearInterval(timer);\n  }, [isVisible, end, start, duration]);\n\n  const formatNumber = (num) => {\n    if (decimals > 0) {\n      return num.toFixed(decimals);\n    }\n    return Math.floor(num).toLocaleString('hu-HU');\n  };\n\n  return (\n    <span ref={countRef}>\n      {formatNumber(count)}\n      {suffix}\n    </span>\n  );\n};\n\nexport default CountUp;\n","/**\n * ============================================================================\n * MARKETLY AI SEARCH ENGINE v4.0 - NON-BLOCKING INSTANT SEARCH\n * ============================================================================\n * \n *  NON-BLOCKING: Chunked async indexing - never freezes UI\n *  PRECISE: Intent-based scoring for perfect results\n *  FUZZY: Handles typos gracefully\n *  CACHED: Instant repeat searches\n */\n\n// ============================================================================\n// ENGINE STATE\n// ============================================================================\n\nlet INDEX = {\n  ready: false,\n  building: false,\n  products: [],           // Original products array reference\n  normalized: [],         // [{nameNorm, catNorm, price}]\n  wordToProducts: new Map(), // word  Set<index>\n  cache: new Map(),       // query  results\n  stats: { products: 0, words: 0, buildTime: 0 }\n};\n\n// ============================================================================\n// HUNGARIAN SYNONYMS - COMPREHENSIVE\n// ============================================================================\n\nconst SYNONYMS = {\n  // === LBTOROK ===\n  'kanap': ['szfa', 'sofa', 'couch', 'kanape', 'lgarnitra', 'garnitra', 'sarokkanap', 'sarok kanap', 'hever', 'rekami', 'pamlag'],\n  'fotel': ['karosszk', 'armchair', 'pihenfotel', 'relax fotel', 'relaxfotel', 'fles fotel', 'flesfotel', 'zskfotel', 'babzsk'],\n  'puff': ['lke', 'zsmoly', 'lbtart', 'ottoman', 'puffok'],\n  \n  // === ASZTALOK ===\n  'asztal': ['table', 'asztalka'],\n  'dohnyzasztal': ['kvasztal', 'coffee table', 'nappali asztal', 'kisasztal', 'lerakasztal', 'dohanyzoasztal'],\n  'tkezasztal': ['ebdlasztal', 'dining table', 'konyhaasztal', 'tkezasztal', 'etkezoasztal'],\n  'rasztal': ['munkaasztal', 'desk', 'szmtgpasztal', 'pc asztal', 'gamer asztal', 'irodaasztal', 'iroasztal'],\n  'jjeliszekrny': ['jjeli szekrny', 'nightstand', 'jjeli', 'ejjeliszekreny'],\n  \n  // === SZKEK ===\n  'szk': ['chair', 'szkek', 'szekek'],\n  'tkezszk': ['konyhai szk', 'dining chair', 'vendgszk', 'etkezoszek'],\n  'irodai szk': ['forgszk', 'irodai', 'gamer szk', 'gaming szk', 'office chair'],\n  'brszk': ['pultszk', 'bar stool', 'magas szk', 'barszek'],\n  \n  // === TROLK ===\n  'szekrny': ['cabinet', 'gardrb', 'gardrbszekrny', 'ruhsszekrny', 'szekreny'],\n  'komd': ['fikos szekrny', 'drawer', 'komod', 'komdok'],\n  'polc': ['shelf', 'polcok', 'knyvespolc', 'falipolc'],\n  'vitrin': ['vegszekrny', 'tlal', 'display cabinet'],\n  'tv szekrny': ['tv llvny', 'mdia szekrny', 'lowboard', 'tv btor'],\n  \n  // === HLSZOBA ===\n  'gy': ['bed', 'franciagy', 'boxspring', 'gykeret', 'agy'],\n  'matrac': ['mattress', 'habmatrac', 'rugs matrac', 'tskarugs'],\n  \n  // === STLUSOK ===\n  'modern': ['kortrs', 'contemporary', 'minimalista', 'dizjn', 'design'],\n  'skandinv': ['nordic', 'scandi', 'szaki', 'skandinav'],\n  'rusztikus': ['vidki', 'country', 'provence', 'natr', 'rusztikus'],\n  'indusztrilis': ['industrial', 'loft', 'ipari'],\n  'klasszikus': ['hagyomnyos', 'elegns', 'antik'],\n  'retro': ['vintage', 'mid-century'],\n  \n  // === SZNEK ===\n  'fehr': ['white', 'feher', 'hfehr', 'krmfehr'],\n  'fekete': ['black', 'stt', 'antracit'],\n  'szrke': ['gray', 'grey', 'szurke', 'grafit'],\n  'barna': ['brown', 'di', 'tlgy', 'bkk', 'csokold', 'mogyor'],\n  'bzs': ['beige', 'krm', 'homok', 'cappuccino', 'bezs'],\n  'kk': ['blue', 'navy', 'tengerkk', 'trkiz', 'kek'],\n  'zld': ['green', 'olva', 'smaragd', 'zold'],\n  'piros': ['red', 'bord', 'vrs', 'burgundy'],\n  'srga': ['yellow', 'mustr', 'arany'],\n  'rzsaszn': ['pink', 'rozsaszin', 'pder'],\n  \n  // === ANYAGOK ===\n  'fa': ['wood', 'wooden', 'tmrfa', 'MDF'],\n  'fm': ['metal', 'acl', 'vas', 'krm'],\n  'br': ['leather', 'valdi br', 'mbr', 'bor'],\n  'szvet': ['fabric', 'textil', 'krpit'],\n  'brsony': ['velvet', 'velr', 'barsony'],\n  'veg': ['glass', 'edzett veg'],\n  \n  // === SZOBK ===\n  'nappali': ['living room', 'szalon'],\n  'hlszoba': ['bedroom', 'hl', 'haloszoba'],\n  'konyha': ['kitchen'],\n  'iroda': ['office', 'dolgozszoba', 'home office'],\n  'gyerekszoba': ['kids room', 'gyerek', 'ifjsgi'],\n  'elszoba': ['hall', 'folyos', 'eloszoba'],\n  \n  // === FUNKCIK ===\n  'kinyithat': ['gyazhat', 'talakthat', 'vendggy'],\n  'trols': ['gynemtarts', 'fikos'],\n  'llthat': ['dnthet', 'emelhet'],\n  \n  // === R ===\n  'olcs': ['akcis', 'akci', 'kedvezmnyes', 'lerazott', 'olcso'],\n  'prmium': ['luxus', 'drga', 'exkluzv', 'designer'],\n};\n\n// Build reverse lookup\nconst WORD_TO_ROOT = new Map();\nfor (const [root, synonyms] of Object.entries(SYNONYMS)) {\n  const rootNorm = normalize(root);\n  WORD_TO_ROOT.set(rootNorm, rootNorm);\n  for (const syn of synonyms) {\n    WORD_TO_ROOT.set(normalize(syn), rootNorm);\n  }\n}\n\n// ============================================================================\n// TEXT NORMALIZATION\n// ============================================================================\n\nfunction normalize(str) {\n  if (!str) return '';\n  return str\n    .toLowerCase()\n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'o').replace(//g, 'u')  \n    .replace(//g, 'o').replace(//g, 'u')\n    .replace(//g, 'a').replace(//g, 'e').replace(//g, 'i')\n    .replace(/[^a-z0-9]/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\nfunction getWords(str) {\n  return normalize(str).split(' ').filter(w => w.length >= 2);\n}\n\nfunction expandWithSynonyms(words) {\n  const expanded = new Set(words);\n  for (const word of words) {\n    const root = WORD_TO_ROOT.get(word);\n    if (root) {\n      expanded.add(root);\n      // Add all synonyms of this root\n      const syns = SYNONYMS[root] || SYNONYMS[Object.keys(SYNONYMS).find(k => normalize(k) === root)];\n      if (syns) {\n        syns.forEach(s => expanded.add(normalize(s)));\n      }\n    }\n  }\n  return Array.from(expanded);\n}\n\n// ============================================================================\n// INDEX BUILDING - NON-BLOCKING CHUNKED\n// ============================================================================\n\nexport async function buildSearchIndex(products) {\n  if (!products || products.length === 0) {\n    console.warn(' No products to index');\n    return false;\n  }\n  \n  if (INDEX.building) {\n    console.log(' Index already building...');\n    return false;\n  }\n  \n  // If already indexed same products, skip\n  if (INDEX.ready && INDEX.products === products && INDEX.stats.products === products.length) {\n    console.log(' Index already up to date');\n    return true;\n  }\n  \n  INDEX.building = true;\n  INDEX.ready = false;\n  console.log(` Starting to learn ${products.length.toLocaleString()} products...`);\n  \n  const startTime = performance.now();\n  \n  // Reset\n  INDEX.products = products;\n  INDEX.normalized = new Array(products.length);\n  INDEX.wordToProducts = new Map();\n  INDEX.cache = new Map();\n  \n  const includeDesc = products.length <= 50000;\n\n  // Process in chunks to not block UI\n  const CHUNK_SIZE = 5000;\n  let processed = 0;\n  \n  const processChunk = () => {\n    return new Promise(resolve => {\n      const end = Math.min(processed + CHUNK_SIZE, products.length);\n      \n      for (let i = processed; i < end; i++) {\n        const p = products[i];\n        const nameNorm = normalize(p.name || '');\n        const catNorm = normalize(p.category || '');\n        const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n        \n        // Get all words\n        const allWords = new Set([\n          ...getWords(nameNorm),\n          ...getWords(catNorm),\n          ...(includeDesc ? getWords(descNorm) : [])\n        ]);\n        \n        // Expand with synonyms\n        const expanded = expandWithSynonyms(Array.from(allWords));\n        \n        // Store normalized data\n        INDEX.normalized[i] = {\n          nameNorm,\n          catNorm,\n          price: p.salePrice || p.price || 0\n        };\n        \n        // Build inverted index\n        for (const word of expanded) {\n          if (!INDEX.wordToProducts.has(word)) {\n            INDEX.wordToProducts.set(word, new Set());\n          }\n          INDEX.wordToProducts.get(word).add(i);\n        }\n      }\n      \n      processed = end;\n      \n      // Let UI breathe\n      setTimeout(resolve, 0);\n    });\n  };\n  \n  // Process all chunks\n  while (processed < products.length) {\n    await processChunk();\n    \n    // Log progress every 20%\n    const pct = Math.round((processed / products.length) * 100);\n    if (pct % 20 === 0 && pct > 0) {\n      console.log(`    ${pct}% indexed...`);\n    }\n  }\n  \n  const elapsed = performance.now() - startTime;\n  \n  INDEX.ready = true;\n  INDEX.building = false;\n  INDEX.stats = {\n    products: products.length,\n    words: INDEX.wordToProducts.size,\n    buildTime: elapsed\n  };\n  \n  console.log(` LEARNED ${products.length.toLocaleString()} products in ${elapsed.toFixed(0)}ms`);\n  console.log(`    ${INDEX.wordToProducts.size.toLocaleString()} words indexed`);\n  \n  return true;\n}\n\nexport function isIndexReady() {\n  return INDEX.ready;\n}\n\nexport function getIndexStats() {\n  return {\n    isIndexed: INDEX.ready,\n    building: INDEX.building,\n    productCount: INDEX.stats.products,\n    wordCount: INDEX.stats.words,\n    buildTime: INDEX.stats.buildTime\n  };\n}\n\n// ============================================================================\n// MAIN SEARCH FUNCTION\n// ============================================================================\n\nexport function smartSearch(products, query, options = {}) {\n  const { limit = 100 } = options;\n  \n  if (!query || !query.trim()) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  // If no products provided and no index, nothing to search\n  if ((!products || products.length === 0) && !INDEX.ready) {\n    console.warn(' smartSearch: No products and no index');\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  const queryNorm = normalize(query.trim());\n  \n  // Check cache first\n  const cacheKey = `${queryNorm}:${limit}`;\n  if (INDEX.cache.has(cacheKey)) {\n    const cached = INDEX.cache.get(cacheKey);\n    console.log(` CACHE: \"${query}\"  ${cached.totalMatches} results`);\n    return { ...cached, fromCache: true };\n  }\n  \n  const startTime = performance.now();\n  \n  // Build index if needed (sync fallback)\n  if (!INDEX.ready && !INDEX.building) {\n    if (products && products.length > 0) {\n      console.log(' Building index synchronously for first search...');\n      buildSearchIndexSync(products);\n    }\n  }\n  \n  // If still building async, use direct search on products array\n  if (!INDEX.ready) {\n    console.log(' Index not ready, using direct search fallback...');\n    return directSearch(products, queryNorm, limit);\n  }\n  \n  // Get query words and expand\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  \n  console.log(` SEARCH: \"${query}\"  [${expandedQuery.slice(0, 5).join(', ')}${expandedQuery.length > 5 ? '...' : ''}]`);\n  \n  // Find candidates using inverted index\n  const candidateScores = new Map();\n  \n  for (const word of expandedQuery) {\n    const matches = INDEX.wordToProducts.get(word);\n    if (matches) {\n      for (const idx of matches) {\n        candidateScores.set(idx, (candidateScores.get(idx) || 0) + 10);\n      }\n    }\n    \n    // Also check prefix matches for partial typing\n    if (word.length >= 3) {\n      for (const [indexedWord, idxSet] of INDEX.wordToProducts) {\n        if (indexedWord.startsWith(word) && indexedWord !== word) {\n          for (const idx of idxSet) {\n            candidateScores.set(idx, (candidateScores.get(idx) || 0) + 5);\n          }\n        }\n      }\n    }\n  }\n  \n  // Score candidates\n  const scored = [];\n  \n  for (const [idx, baseScore] of candidateScores) {\n    const norm = INDEX.normalized[idx];\n    const product = INDEX.products[idx];\n    if (!norm || !product) continue;\n    \n    let score = baseScore;\n    \n    // === EXACT QUERY MATCH IN NAME (HIGHEST PRIORITY) ===\n    if (norm.nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (norm.nameNorm === queryNorm) {\n        score += 2000; // Perfect match\n      } else if (norm.nameNorm.startsWith(queryNorm)) {\n        score += 500; // Prefix match\n      }\n    }\n    \n    // === WORD MATCHES IN NAME ===\n    let nameWordMatches = 0;\n    for (const word of queryWords) {\n      if (norm.nameNorm.includes(word)) {\n        nameWordMatches++;\n        score += 50;\n      }\n    }\n    \n    // Bonus for ALL query words matching in name\n    if (nameWordMatches === queryWords.length && queryWords.length > 1) {\n      score += 300;\n    }\n    \n    // === CATEGORY MATCH ===\n    if (norm.catNorm.includes(queryNorm)) {\n      score += 100;\n    }\n    for (const word of queryWords) {\n      if (norm.catNorm.includes(word)) {\n        score += 30;\n      }\n    }\n    \n    scored.push({ idx, score, product });\n  }\n  \n  // Sort by score\n  scored.sort((a, b) => b.score - a.score);\n  \n  // Get results\n  const results = scored.slice(0, limit).map(s => s.product);\n  const searchTime = performance.now() - startTime;\n  \n  console.log(` Found ${scored.length} matches in ${searchTime.toFixed(1)}ms`);\n  if (scored.length > 0) {\n    console.log(`   #1: \"${scored[0].product.name}\" (score: ${scored[0].score})`);\n  }\n  \n  const result = {\n    results,\n    totalMatches: scored.length,\n    searchTime\n  };\n  \n  // Cache\n  if (scored.length > 0) {\n    INDEX.cache.set(cacheKey, result);\n    if (INDEX.cache.size > 500) {\n      const firstKey = INDEX.cache.keys().next().value;\n      INDEX.cache.delete(firstKey);\n    }\n  }\n  \n  return result;\n}\n\n// Sync version for first search\nfunction buildSearchIndexSync(products) {\n  if (INDEX.building) return; // Don't interrupt async build\n  \n  INDEX.products = products;\n  INDEX.normalized = [];\n  INDEX.wordToProducts = new Map();\n  \n  const includeDesc = products.length <= 50000;\n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    const descNorm = includeDesc ? normalize((p.description || '').substring(0, 200)) : '';\n    \n    const allWords = new Set([\n      ...getWords(nameNorm),\n      ...getWords(catNorm),\n      ...(includeDesc ? getWords(descNorm) : [])\n    ]);\n    const expanded = expandWithSynonyms(Array.from(allWords));\n    \n    INDEX.normalized[i] = { nameNorm, catNorm, price: p.salePrice || p.price || 0 };\n    \n    for (const word of expanded) {\n      if (!INDEX.wordToProducts.has(word)) {\n        INDEX.wordToProducts.set(word, new Set());\n      }\n      INDEX.wordToProducts.get(word).add(i);\n    }\n  }\n  \n  INDEX.ready = true;\n  INDEX.stats = { products: products.length, words: INDEX.wordToProducts.size, buildTime: 0 };\n  console.log(` Sync index built: ${products.length} products`);\n}\n\n// Direct search fallback when index not ready\nfunction directSearch(products, queryNorm, limit) {\n  if (!products || products.length === 0) {\n    return { results: [], totalMatches: 0, searchTime: 0 };\n  }\n  \n  const startTime = performance.now();\n  const queryWords = getWords(queryNorm);\n  const expandedQuery = expandWithSynonyms(queryWords);\n  const scored = [];\n  \n  for (let i = 0; i < products.length; i++) {\n    const p = products[i];\n    const nameNorm = normalize(p.name || '');\n    const catNorm = normalize(p.category || '');\n    \n    let score = 0;\n    \n    // Direct query match in name\n    if (nameNorm.includes(queryNorm)) {\n      score += 1000;\n      if (nameNorm.startsWith(queryNorm)) score += 500;\n    }\n    \n    // Word matches\n    for (const word of expandedQuery) {\n      if (nameNorm.includes(word)) score += 50;\n      if (catNorm.includes(word)) score += 20;\n    }\n    \n    if (score > 0) {\n      scored.push({ product: p, score });\n    }\n  }\n  \n  scored.sort((a, b) => b.score - a.score);\n  const results = scored.slice(0, limit).map(s => s.product);\n  const searchTime = performance.now() - startTime;\n  \n  console.log(` Direct search: \"${queryNorm}\"  ${results.length} results in ${searchTime.toFixed(0)}ms`);\n  \n  return { results, totalMatches: scored.length, searchTime };\n}\n\n// ============================================================================\n// AUTOCOMPLETE\n// ============================================================================\n\nexport function getAutocompleteSuggestions(products, query, limit = 10) {\n  if (!query || query.length < 2) return [];\n  \n  const queryNorm = normalize(query);\n  const suggestions = [];\n  const seen = new Set();\n  \n  // Use index if ready\n  const prods = INDEX.ready ? INDEX.products : products;\n  const norms = INDEX.ready ? INDEX.normalized : null;\n  \n  // Find matching products\n  for (let i = 0; i < Math.min(prods.length, 50000); i++) {\n    const product = prods[i];\n    const nameNorm = norms ? norms[i]?.nameNorm : normalize(product.name || '');\n    \n    if (!nameNorm) continue;\n    \n    // Prefix match (highest priority)\n    if (nameNorm.startsWith(queryNorm)) {\n      if (!seen.has(product.name)) {\n        seen.add(product.name);\n        suggestions.push({\n          text: product.name,\n          type: 'product',\n          product,\n          score: 200\n        });\n      }\n    }\n    // Contains match\n    else if (nameNorm.includes(queryNorm)) {\n      if (!seen.has(product.name)) {\n        seen.add(product.name);\n        suggestions.push({\n          text: product.name,\n          type: 'product',\n          product,\n          score: 100\n        });\n      }\n    }\n    \n    if (suggestions.length >= limit * 3) break;\n  }\n  \n  // Add keyword suggestions from synonyms\n  for (const [root, syns] of Object.entries(SYNONYMS)) {\n    if (normalize(root).includes(queryNorm) && !seen.has(root)) {\n      seen.add(root);\n      suggestions.push({ text: root, type: 'keyword', score: 50 });\n    }\n  }\n  \n  // Sort and limit\n  suggestions.sort((a, b) => b.score - a.score);\n  return suggestions.slice(0, limit);\n}\n\n// ============================================================================\n// INTENT PARSING\n// ============================================================================\n\nexport function parseSearchIntent(query) {\n  const queryNorm = normalize(query);\n  const intent = {\n    originalQuery: query,\n    productTypes: [],\n    colors: [],\n    styles: [],\n    materials: [],\n    priceRange: null,\n    keywords: getWords(query)\n  };\n  \n  // Check each synonym category\n  const typeRoots = ['kanape', 'fotel', 'asztal', 'szek', 'agy', 'szekreny', 'polc', 'komod'];\n  const colorRoots = ['feher', 'fekete', 'szurke', 'barna', 'bezs', 'kek', 'zold', 'piros', 'sarga'];\n  const styleRoots = ['modern', 'skandinav', 'rusztikus', 'indusztrialis', 'klasszikus', 'retro'];\n  const materialRoots = ['fa', 'fem', 'bor', 'szovet', 'barsony', 'uveg'];\n  \n  for (const word of getWords(queryNorm)) {\n    const root = WORD_TO_ROOT.get(word) || word;\n    \n    if (typeRoots.includes(root)) intent.productTypes.push(root);\n    if (colorRoots.includes(root)) intent.colors.push(root);\n    if (styleRoots.includes(root)) intent.styles.push(root);\n    if (materialRoots.includes(root)) intent.materials.push(root);\n  }\n  \n  // Price detection\n  const priceMatch = query.match(/(\\d+)\\s*(ezer|e|k)?\\s*(ft|forint)?\\s*(alatt|ig|felett)?/i);\n  if (priceMatch) {\n    let value = parseInt(priceMatch[1]);\n    if (priceMatch[2]) value *= 1000;\n    \n    if (query.includes('alatt') || query.includes('ig')) {\n      intent.priceRange = { min: 0, max: value };\n    } else if (query.includes('felett')) {\n      intent.priceRange = { min: value, max: Infinity };\n    }\n  }\n  \n  if (queryNorm.includes('olcso') || queryNorm.includes('akcio')) {\n    intent.priceRange = intent.priceRange || { min: 0, max: 100000 };\n  }\n  \n  return intent;\n}\n\n// ============================================================================\n// PROACTIVE SUGGESTIONS\n// ============================================================================\n\nexport function getProactiveSuggestions() {\n  return [\n    { icon: '', text: 'kanap', query: 'kanap' },\n    { icon: '', text: 'fotel', query: 'fotel' },\n    { icon: '', text: 'szk', query: 'szk' },\n    { icon: '', text: 'gy', query: 'gy' },\n    { icon: '', text: 'szekrny', query: 'szekrny' },\n    { icon: '', text: 'akcis', query: 'akcis' },\n  ];\n}\n\nexport default {\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats,\n  smartSearch,\n  getAutocompleteSuggestions,\n  parseSearchIntent,\n  getProactiveSuggestions\n};\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Search, Sparkles, Camera, ArrowRight, Wand2, X, Package, CheckCircle2, TrendingUp, ChevronRight, Plus, SlidersHorizontal, BrainCircuit, RotateCcw, Filter, Award, Lightbulb } from 'lucide-react';\nimport {\n  buildSearchIndex,\n  getAutocompleteSuggestions,\n  getProactiveSuggestions,\n  parseSearchIntent,\n  smartSearch\n} from '../../services/aiSearchService';\nimport { trackSearch, trackSectionEvent, getSearchHistory, getViewedProducts, getLikedProducts } from '../../services/userPreferencesService';\nimport { formatPrice as formatPriceHu } from '../../utils/helpers';\n\nconst QUICK_INTENTS = [\n  'bzs kanap 100e alatt',\n  'kis nappaliba fotel',\n  'skandinv stlus komd',\n  'gyors szlltssal'\n];\n\nconst SUCCESSFUL_SEARCHES_KEY = 'mkt_successful_hero_searches';\nconst SEARCH_DEBOUNCE_MS = 180;\nconst LONG_PRESS_MS = 450;\n\nconst QUICK_FILTER_PRESETS = {\n  r: ['80e alatt', '120e alatt', '180e alatt'],\n  Stlus: ['modern', 'skandinv', 'minimalista'],\n  Helyisg: ['nappaliba', 'hlszobba', 'elszobba']\n};\nconst PROACTIVE_QUICK = getProactiveSuggestions().map((item) => item.query);\n\nconst escapeRegExp = (value = '') => value.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n\nexport default function HeroSmartSearch({\n  products = [],\n  onSearch,\n  onTryAI,\n  variant = 'A',\n  onOpenProductQuickView\n}) {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [isSearching, setIsSearching] = useState(false);\n  const [didSearch, setDidSearch] = useState(false);\n  const [dismissedFilterIds, setDismissedFilterIds] = useState([]);\n  const [compareProducts, setCompareProducts] = useState([]);\n  const [searchJourney, setSearchJourney] = useState([]);\n  const [showRewriteOptions, setShowRewriteOptions] = useState(false);\n  const [showQuickFilterPanel, setShowQuickFilterPanel] = useState(false);\n  const [likedProductIds, setLikedProductIds] = useState([]);\n  const [viewedProductIds, setViewedProductIds] = useState([]);\n  const [preferredCategories, setPreferredCategories] = useState([]);\n  const [preferredKeywords, setPreferredKeywords] = useState([]);\n  const [searchPulse, setSearchPulse] = useState(false);\n  const [resultCountPulse, setResultCountPulse] = useState(false);\n  const [hoverCard, setHoverCard] = useState({ id: null, rx: 0, ry: 0 });\n  const [smartResults, setSmartResults] = useState([]);\n  const [smartTotalMatches, setSmartTotalMatches] = useState(0);\n  const [isIndexBuilding, setIsIndexBuilding] = useState(false);\n  const [previewProduct, setPreviewProduct] = useState(null);\n  const [previewAnchor, setPreviewAnchor] = useState(null);\n  const instantSearchRef = useRef('');\n  const longPressTimerRef = useRef(null);\n\n  const trimmedQuery = query.trim();\n\n  const suggestions = useMemo(() => {\n    if (trimmedQuery.length < 2 || !Array.isArray(products) || products.length === 0) return [];\n    const local = getAutocompleteSuggestions(products, trimmedQuery, 6) || [];\n    return local;\n  }, [products, trimmedQuery]);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!Array.isArray(products) || products.length === 0) return () => { cancelled = true; };\n    setIsIndexBuilding(true);\n    buildSearchIndex(products)\n      .catch(() => false)\n      .finally(() => {\n        if (!cancelled) setIsIndexBuilding(false);\n      });\n    return () => { cancelled = true; };\n  }, [products]);\n\n  // Debounced query for expensive smartSearch\n  const [debouncedQuery, setDebouncedQuery] = useState(trimmedQuery);\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      const t = setTimeout(() => setDebouncedQuery(''), SEARCH_DEBOUNCE_MS);\n      return () => clearTimeout(t);\n    }\n    const t = setTimeout(() => setDebouncedQuery(trimmedQuery), SEARCH_DEBOUNCE_MS);\n    return () => clearTimeout(t);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (!Array.isArray(products) || products.length === 0) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      return;\n    }\n    if (debouncedQuery.length < 2) {\n      setSmartResults([]);\n      setSmartTotalMatches(0);\n      return;\n    }\n\n    const result = smartSearch(products, debouncedQuery, { limit: 24 });\n    const nextResults = result?.results || [];\n    const nextTotal = result?.totalMatches || 0;\n    setSmartResults(nextResults);\n    setSmartTotalMatches(nextTotal);\n    setResultCountPulse(true);\n  }, [products, debouncedQuery]);\n\n  useEffect(() => {\n    if (!resultCountPulse) return;\n    const t = setTimeout(() => setResultCountPulse(false), 500);\n    return () => clearTimeout(t);\n  }, [resultCountPulse]);\n\n  const queryTokens = useMemo(() => (\n    trimmedQuery\n      .toLowerCase()\n      .split(/[\\s,/-]+/)\n      .map((t) => t.trim())\n      .filter((t) => t.length >= 2)\n      .slice(0, 4)\n  ), [trimmedQuery]);\n\n  const intent = useMemo(() => {\n    if (trimmedQuery.length < 3) return null;\n    return parseSearchIntent(trimmedQuery);\n  }, [trimmedQuery]);\n\n  const parsedFilters = useMemo(() => {\n    if (!intent) return [];\n    const filters = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      const value = String(intent.productTypes[0]);\n      filters.push({ id: `product-${value}`, label: 'termk', value, rawValue: value });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      const value = String(intent.styles[0]);\n      filters.push({ id: `style-${value}`, label: 'stlus', value, rawValue: value });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      const value = String(intent.colors[0]);\n      filters.push({ id: `color-${value}`, label: 'szn', value, rawValue: value });\n    }\n    if (intent.priceRange?.max && Number.isFinite(intent.priceRange.max)) {\n      const value = `max ${Math.round(intent.priceRange.max / 1000)}k`;\n      filters.push({ id: 'price-max', label: 'r', value, rawValue: 'alatt' });\n    } else if (intent.priceRange?.min) {\n      const value = `min ${Math.round(intent.priceRange.min / 1000)}k`;\n      filters.push({ id: 'price-min', label: 'r', value, rawValue: 'felett' });\n    }\n    if (intent.isOnSale) filters.push({ id: 'sale', label: 'md', value: 'akcis', rawValue: 'akci' });\n    return filters.slice(0, 5);\n  }, [intent]);\n\n  const activeFilters = useMemo(\n    () => parsedFilters.filter((f) => !dismissedFilterIds.includes(f.id)),\n    [parsedFilters, dismissedFilterIds]\n  );\n\n  const queryMatchedProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0 || trimmedQuery.length < 2) return [];\n    if (smartResults.length > 0) return smartResults.slice(0, 40);\n    return products\n      .filter((p) => {\n        const haystack = `${p?.name || ''} ${p?.category || ''}`.toLowerCase();\n        return queryTokens.some((token) => haystack.includes(token));\n      })\n      .slice(0, 30);\n  }, [products, trimmedQuery, queryTokens, smartResults]);\n\n  const rankedQueryProducts = useMemo(() => {\n    if (queryMatchedProducts.length === 0) return [];\n\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n\n    return queryMatchedProducts\n      .map((product) => {\n        const name = String(product?.name || '').toLowerCase();\n        const categoryFull = String(product?.category || '').toLowerCase();\n        const categoryLeaf = categoryFull.split('>').pop()?.trim() || '';\n        let score = 0;\n\n        queryTokens.forEach((token) => {\n          if (name.includes(token)) score += 20;\n          if (categoryFull.includes(token)) score += 12;\n          if (preferredKeywords.some((kw) => token.includes(kw) || kw.includes(token))) score += 6;\n        });\n\n        if (preferredCategories.some((cat) => categoryFull.includes(cat.toLowerCase()))) score += 15;\n        if (categoryLeaf && preferredCategories.some((cat) => categoryLeaf.includes(cat.toLowerCase()))) score += 10;\n        if (likedSet.has(String(product?.id))) score += 40;\n        if (viewedSet.has(String(product?.id))) score += 12;\n\n        return { product, score };\n      })\n      .sort((a, b) => b.score - a.score)\n      .map((entry) => entry.product);\n  }, [queryMatchedProducts, queryTokens, preferredKeywords, preferredCategories, likedProductIds, viewedProductIds]);\n\n  const previewProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n\n    const byAutocomplete = suggestions\n      .filter((s) => s?.type === 'product' && s?.product)\n      .map((s) => s.product);\n\n    const merged = [...byAutocomplete, ...rankedQueryProducts];\n    const unique = [];\n    const seen = new Set();\n    for (const item of merged) {\n      const id = String(item?.id ?? item?.sku ?? item?.name ?? '');\n      if (!id || seen.has(id)) continue;\n      seen.add(id);\n      unique.push(item);\n      if (unique.length >= 10) break;\n    }\n    return unique;\n  }, [products, suggestions, rankedQueryProducts]);\n\n  const starterProducts = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n    const likedSet = new Set(likedProductIds.map(String));\n    const viewedSet = new Set(viewedProductIds.map(String));\n    const scored = products.map((p) => {\n      const id = String(p?.id || '');\n      const category = String(p?.category || '').toLowerCase();\n      let score = 0;\n      if (likedSet.has(id)) score += 40;\n      if (viewedSet.has(id)) score += 20;\n      if (preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()))) score += 14;\n      if (Number(p?.salePrice || p?.price || 0) > 0) score += 6;\n      return { p, score };\n    });\n    return scored.sort((a, b) => b.score - a.score).slice(0, 10).map((entry) => entry.p);\n  }, [products, likedProductIds, viewedProductIds, preferredCategories]);\n\n  const contextualSuggestions = useMemo(() => {\n    if (rankedQueryProducts.length === 0) return [];\n    const categoryMap = new Map();\n    rankedQueryProducts.forEach((p) => {\n      const category = String(p?.category || '').split('>').pop()?.trim();\n      if (!category) return;\n      categoryMap.set(category, (categoryMap.get(category) || 0) + 1);\n    });\n    return [...categoryMap.entries()]\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3)\n      .map(([category]) => `${category} akci`);\n  }, [rankedQueryProducts]);\n\n  const actualResultCount = useMemo(() => {\n    if (trimmedQuery.length < 2) return null;\n    if (smartTotalMatches > 0) return smartTotalMatches;\n    return rankedQueryProducts.length;\n  }, [trimmedQuery, smartTotalMatches, rankedQueryProducts.length]);\n\n  const confidenceScore = useMemo(() => {\n    if (actualResultCount === null) return 0;\n    return Math.max(0, Math.min(100, Math.round((Math.min(actualResultCount, 24) / 24) * 100)));\n  }, [actualResultCount]);\n\n  const confidenceMeta = useMemo(() => {\n    if (actualResultCount === null) return { label: 'Kezdj el gpelni', tone: 'bg-gray-300' };\n    if (actualResultCount >= 18) return { label: `${actualResultCount} ers tallat`, tone: 'bg-emerald-500' };\n    if (actualResultCount >= 8) return { label: `${actualResultCount} relevns tallat`, tone: 'bg-amber-500' };\n    if (actualResultCount >= 1) return { label: `${actualResultCount} tallat`, tone: 'bg-orange-500' };\n    return { label: 'Nincs tallat', tone: 'bg-rose-500' };\n  }, [actualResultCount]);\n\n  const dynamicQuickSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [...PROACTIVE_QUICK, ...QUICK_INTENTS].slice(0, 6);\n    const base = [];\n    const firstToken = queryTokens[0];\n    if (firstToken) {\n      base.push(`${firstToken} akcis`);\n      base.push(`modern ${firstToken}`);\n      base.push(`${firstToken} gyors szlltssal`);\n      base.push(`${firstToken} 120e alatt`);\n    }\n    if (Array.isArray(intent?.styles) && intent.styles[0]) {\n      base.push(`${intent.styles[0]} stlus btor`);\n    }\n    if (Array.isArray(intent?.colors) && intent.colors[0]) {\n      base.push(`${intent.colors[0]} nappali`);\n    }\n    const unique = [];\n    const seen = new Set();\n    [...base, ...contextualSuggestions, ...PROACTIVE_QUICK, ...QUICK_INTENTS].forEach((q) => {\n      const key = q.toLowerCase();\n      if (!seen.has(key) && q.trim().length >= 3) {\n        seen.add(key);\n        unique.push(q.trim());\n      }\n    });\n    return unique.slice(0, 6);\n  }, [trimmedQuery, queryTokens, intent, activeFilters.length, contextualSuggestions]);\n\n  const quickHitSuggestions = useMemo(() => {\n    return dynamicQuickSuggestions.slice(0, 8).map((text) => {\n      const t = text.toLowerCase();\n      let badge = { label: 'Kapcsold', classes: 'bg-gray-100 text-gray-700 border-gray-200' };\n      if (trimmedQuery.length >= 2 && t.includes(trimmedQuery.toLowerCase())) {\n        badge = { label: 'Pontos egyezs', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      } else if (Array.isArray(intent?.styles) && intent.styles.some((s) => t.includes(String(s).toLowerCase()))) {\n        badge = { label: 'Stlus egyezs', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n      } else if (Array.isArray(intent?.colors) && intent.colors.some((c) => t.includes(String(c).toLowerCase()))) {\n        badge = { label: 'Szn egyezs', classes: 'bg-sky-50 text-sky-700 border-sky-200' };\n      } else if (t.includes('alatt') || t.includes('akci')) {\n        badge = { label: 'r / akci', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      }\n      return { text, badge };\n    });\n  }, [dynamicQuickSuggestions, trimmedQuery, intent]);\n\n  const rewriteSuggestions = useMemo(() => {\n    if (trimmedQuery.length < 2) return [];\n    const first = queryTokens[0] || 'btor';\n    const topCategories = rankedQueryProducts\n      .map((p) => String(p?.category || '').split('>').pop()?.trim())\n      .filter(Boolean)\n      .slice(0, 3);\n    const mainCategory = topCategories[0] || first;\n    const topStyle = Array.isArray(intent?.styles) && intent.styles[0] ? intent.styles[0] : 'modern';\n    const topColor = Array.isArray(intent?.colors) && intent.colors[0] ? intent.colors[0] : 'bzs';\n\n    return [\n      `${mainCategory} ${topStyle} stlusban`,\n      `${topColor} ${mainCategory} 120e alatt`,\n      `${mainCategory} prmium kivitelben gyors szlltssal`,\n      `${mainCategory} kisebb trbe, keskeny kivitel`\n    ];\n  }, [trimmedQuery, queryTokens, rankedQueryProducts, intent]);\n\n  const rewriteSuggestionsWithQuality = useMemo(() => {\n    if (!Array.isArray(products) || products.length === 0) return [];\n    return rewriteSuggestions.map((text) => {\n      const result = smartSearch(products, text, { limit: 12 });\n      const count = Number(result?.totalMatches || 0);\n      let quality = { label: 'Kzepes', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n      if (count >= 16) quality = { label: 'Ers', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n      else if (count <= 3) quality = { label: 'Szk', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n      return { text, count, quality };\n    });\n  }, [rewriteSuggestions, products]);\n\n  const intentTimeline = useMemo(() => {\n    if (!intent || trimmedQuery.length < 2) return [];\n    const timeline = [];\n    if (Array.isArray(intent.productTypes) && intent.productTypes[0]) {\n      timeline.push({ title: 'Termktpus felismerve', value: intent.productTypes[0], tone: 'bg-primary-50 border-primary-200 text-primary-700' });\n    }\n    if (Array.isArray(intent.styles) && intent.styles[0]) {\n      timeline.push({ title: 'Stlus felismerve', value: intent.styles[0], tone: 'bg-secondary-50 border-secondary-200 text-secondary-700' });\n    }\n    if (Array.isArray(intent.colors) && intent.colors[0]) {\n      timeline.push({ title: 'Szn preferencia', value: intent.colors[0], tone: 'bg-sky-50 border-sky-200 text-sky-700' });\n    }\n    if (intent.priceRange?.max || intent.priceRange?.min) {\n      const priceText = intent.priceRange?.max\n        ? `${Math.round((intent.priceRange.max || 0) / 1000)}k alatt`\n        : `${Math.round((intent.priceRange.min || 0) / 1000)}k felett`;\n      timeline.push({ title: 'rhatr', value: priceText, tone: 'bg-amber-50 border-amber-200 text-amber-700' });\n    }\n    timeline.push({ title: 'Tallati magabiztossg', value: `${actualResultCount ?? 0} tallat`, tone: 'bg-emerald-50 border-emerald-200 text-emerald-700' });\n    return timeline.slice(0, 5);\n  }, [intent, trimmedQuery, actualResultCount]);\n\n  const hasNoResults = trimmedQuery.length >= 2 && suggestions.length === 0;\n  const rescueSuggestions = useMemo(() => {\n    if (!hasNoResults) return [];\n    const q = trimmedQuery.toLowerCase();\n    const base = [];\n    if (q.includes('alatt')) base.push(q.replace(/(\\d+\\s*(e|ez|ezer|k).*)/i, '').trim());\n    if (q.includes('olcs')) base.push(q.replace('olcs', ''));\n    base.push(`${trimmedQuery} akci`);\n    base.push(`${trimmedQuery} modern`);\n    return base.map((v) => v.trim()).filter((v) => v.length >= 3).slice(0, 3);\n  }, [hasNoResults, trimmedQuery]);\n\n  const triggerFullSearch = (inputQuery, source = 'submit') => {\n    const safeQuery = String(inputQuery || '').trim();\n    if (!safeQuery) return;\n    onSearch?.(safeQuery, { source });\n    setIsOpen(false);\n  };\n\n  const handleSubmit = (e) => {\n    e?.preventDefault?.();\n    if (!trimmedQuery) return;\n    setIsSearching(true);\n    setDidSearch(true);\n    trackSearch(trimmedQuery);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'submit');\n    setSearchPulse(true);\n    instantSearchRef.current = trimmedQuery;\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: trimmedQuery, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== trimmedQuery.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    triggerFullSearch(trimmedQuery, 'submit');\n    setTimeout(() => {\n      setIsSearching(false);\n      setIsOpen(false);\n    }, 350);\n  };\n\n  const applySuggestion = (text, opts = {}) => {\n    if (!text) return;\n    const { submit = true, source = 'suggestion' } = opts;\n    setQuery(text);\n    setDidSearch(true);\n    trackSearch(text);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'suggestion');\n    setSearchPulse(true);\n    instantSearchRef.current = text.trim();\n    setSearchJourney((prev) => {\n      const now = Date.now();\n      const prevNorm = prev.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n      const next = [{ q: text, t: now }, ...prevNorm.filter((x) => (x.q || x).toLowerCase() !== text.toLowerCase())].slice(0, 6);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n    if (submit) {\n      triggerFullSearch(text, source);\n      return;\n    }\n    setIsOpen(true);\n  };\n\n  const handlePreviewProductClick = (product) => {\n    const name = product?.name || '';\n    if (!name || !product) return;\n    trackSectionEvent(`hero-search-${variant}`, 'click', String(product?.id || 'preview-product'));\n    onOpenProductQuickView?.(product);\n  };\n\n  const removeFilter = (filter) => {\n    if (!filter?.id) return;\n    setDismissedFilterIds((prev) => (prev.includes(filter.id) ? prev : [...prev, filter.id]));\n    if (!filter.rawValue) return;\n    const raw = filter.rawValue.trim();\n    if (!raw) return;\n    setQuery((prev) => prev.replace(new RegExp(escapeRegExp(raw), 'ig'), '').replace(/\\s{2,}/g, ' ').trim());\n  };\n\n  const clearAllFilters = () => {\n    setDismissedFilterIds(parsedFilters.map((f) => f.id));\n  };\n\n  const removeFromHistory = (queryToRemove) => {\n    const key = String(queryToRemove || '').toLowerCase();\n    if (!key) return;\n    setSearchJourney((prev) => {\n      const next = prev\n        .map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x))\n        .filter((x) => (x.q || x).toLowerCase() !== key);\n      try {\n        localStorage.setItem(SUCCESSFUL_SEARCHES_KEY, JSON.stringify(next));\n      } catch {}\n      return next;\n    });\n  };\n\n  const toggleCompareProduct = (product) => {\n    if (!product?.id) return;\n    setCompareProducts((prev) => {\n      const exists = prev.some((p) => String(p.id) === String(product.id));\n      if (exists) return prev.filter((p) => String(p.id) !== String(product.id));\n      const next = [...prev, product].slice(-3);\n      return next;\n    });\n    trackSectionEvent(`hero-search-${variant}`, 'click', `compare-${product.id}`);\n  };\n\n  const runCompareSearch = () => {\n    if (compareProducts.length < 2) return;\n    const composed = compareProducts.map((p) => p?.name).filter(Boolean).join(' vs ');\n    applySuggestion(composed);\n  };\n\n  const applyRewrite = (text) => {\n    if (!text) return;\n    setQuery(text);\n    setShowRewriteOptions(false);\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', 'rewrite');\n  };\n\n  const applyQuickFilterToken = (token) => {\n    if (!token) return;\n    const normalized = String(token).trim();\n    if (!normalized) return;\n    setQuery((prev) => {\n      const base = prev.trim();\n      if (!base) return normalized;\n      if (base.toLowerCase().includes(normalized.toLowerCase())) return base;\n      return `${base} ${normalized}`.trim();\n    });\n    setIsOpen(true);\n    trackSectionEvent(`hero-search-${variant}`, 'click', `quick-filter-${normalized}`);\n  };\n\n  const formatPrice = (value) => {\n    const amount = Number(value || 0);\n    return amount > 0 ? formatPriceHu(value) : 'r hamarosan';\n  };\n\n  const getProductImage = (product) => {\n    if (!product) return '';\n    return product.image || product.images?.[0] || product.thumbnail || '';\n  };\n\n  const isPersonalMatch = (product) => {\n    const category = String(product?.category || '').toLowerCase();\n    const id = String(product?.id || '');\n    if (likedProductIds.includes(id)) return true;\n    return preferredCategories.some((cat) => category.includes(String(cat).toLowerCase()));\n  };\n\n  const getTopBadge = (product, index) => {\n    if (likedProductIds.includes(String(product?.id || ''))) {\n      return { text: 'Kedvenc tallat', classes: 'bg-rose-50 text-rose-700 border-rose-200' };\n    }\n    if (isPersonalMatch(product)) {\n      return { text: 'Neked ajnlott', classes: 'bg-emerald-50 text-emerald-700 border-emerald-200' };\n    }\n    if (index === 0) return { text: 'Top #1', classes: 'bg-amber-50 text-amber-700 border-amber-200' };\n    if (index === 1) return { text: 'Top #2', classes: 'bg-blue-50 text-blue-700 border-blue-200' };\n    if (index === 2) return { text: 'Top #3', classes: 'bg-secondary-50 text-secondary-700 border-secondary-200' };\n    return { text: 'Ajnlott', classes: 'bg-gray-50 text-gray-700 border-gray-200' };\n  };\n\n  const handleCardMouseMove = (event, productId) => {\n    const rect = event.currentTarget.getBoundingClientRect();\n    const px = (event.clientX - rect.left) / rect.width;\n    const py = (event.clientY - rect.top) / rect.height;\n    const rx = (0.5 - py) * 6;\n    const ry = (px - 0.5) * 8;\n    setHoverCard({ id: String(productId), rx, ry });\n  };\n\n  const displayedTopProducts = trimmedQuery.length < 2 ? starterProducts : previewProducts;\n\n  const historyGrouped = useMemo(() => {\n    const list = searchJourney.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : x));\n    if (list.length === 0) return { today: [], earlier: [] };\n    const startOfToday = new Date();\n    startOfToday.setHours(0, 0, 0, 0);\n    const startTs = startOfToday.getTime();\n    const today = list.filter((x) => (x.t || 0) >= startTs);\n    const earlier = list.filter((x) => (x.t || 0) < startTs);\n    return { today, earlier };\n  }, [searchJourney]);\n\n  useEffect(() => {\n    setDismissedFilterIds([]);\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (trimmedQuery.length < 2) {\n      setIsSearching(false);\n      return undefined;\n    }\n\n    const timer = setTimeout(() => {\n      if (instantSearchRef.current === trimmedQuery) {\n        setIsSearching(false);\n        return;\n      }\n      instantSearchRef.current = trimmedQuery;\n      setDidSearch(true);\n      setIsSearching(true);\n      trackSectionEvent(`hero-search-${variant}`, 'click', 'instant');\n      setTimeout(() => setIsSearching(false), 180);\n    }, 220);\n\n    return () => clearTimeout(timer);\n  }, [trimmedQuery, variant]);\n\n  useEffect(() => {\n    if (trimmedQuery.length >= 1) {\n      setIsOpen(true);\n    }\n  }, [trimmedQuery]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      setPreviewProduct(null);\n      setPreviewAnchor(null);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!searchPulse) return undefined;\n    const timer = setTimeout(() => setSearchPulse(false), 650);\n    return () => clearTimeout(timer);\n  }, [searchPulse]);\n\n  useEffect(() => {\n    try {\n      const liked = getLikedProducts().map((id) => String(id));\n      const viewed = getViewedProducts(30);\n      const viewedIds = viewed.map((item) => String(item?.id)).filter(Boolean);\n      const categoryCounter = new Map();\n      const keywordCounter = new Map();\n\n      viewed.forEach((item) => {\n        const category = String(item?.category || '').split('>').pop()?.trim();\n        if (category) {\n          categoryCounter.set(category, (categoryCounter.get(category) || 0) + 1);\n        }\n        String(item?.name || '')\n          .toLowerCase()\n          .split(/[\\s,/-]+/)\n          .map((token) => token.trim())\n          .filter((token) => token.length >= 4)\n          .forEach((token) => keywordCounter.set(token, (keywordCounter.get(token) || 0) + 1));\n      });\n\n      const topCategories = [...categoryCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 4)\n        .map(([name]) => name);\n      const topKeywords = [...keywordCounter.entries()]\n        .sort((a, b) => b[1] - a[1])\n        .slice(0, 6)\n        .map(([name]) => name);\n\n      setLikedProductIds(liked);\n      setViewedProductIds(viewedIds);\n      setPreferredCategories(topCategories);\n      setPreferredKeywords(topKeywords);\n    } catch {\n      setLikedProductIds([]);\n      setViewedProductIds([]);\n      setPreferredCategories([]);\n      setPreferredKeywords([]);\n    }\n  }, []);\n\n  useEffect(() => {\n    try {\n      const stored = JSON.parse(localStorage.getItem(SUCCESSFUL_SEARCHES_KEY) || '[]');\n      const history = getSearchHistory(6).map((entry) => entry?.query).filter(Boolean);\n      const storedNorm = Array.isArray(stored)\n        ? stored.map((x) => (typeof x === 'string' ? { q: x, t: 0 } : { q: x.q || x, t: x.t || 0 }))\n        : [];\n      const merged = [...storedNorm];\n      history.forEach((q) => {\n        const key = String(q).toLowerCase();\n        if (!merged.some((x) => (x.q || x).toLowerCase() === key)) merged.push({ q, t: 0 });\n      });\n      const unique = [];\n      const seen = new Set();\n      merged.forEach((item) => {\n        const q = item.q || item;\n        const key = String(q).toLowerCase();\n        if (!seen.has(key)) {\n          seen.add(key);\n          unique.push(typeof item === 'object' && item && 'q' in item ? item : { q, t: 0 });\n        }\n      });\n      setSearchJourney(unique.slice(0, 6));\n    } catch {\n      setSearchJourney([]);\n    }\n  }, []);\n\n  return (\n    <section\n      className=\"mb-8 sm:mb-12 min-w-0 w-full max-w-full\"\n      style={{ touchAction: 'pan-y' }}\n      aria-label=\"AI Keres\"\n    >\n      <div className=\"relative w-full max-w-none mx-auto animate-fade-in\">\n        <div className=\"pointer-events-none absolute inset-x-0 -top-16 h-44 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.18),transparent_65%)] blur-2xl\" aria-hidden />\n        <div className=\"pointer-events-none absolute inset-x-0 -bottom-24 h-60 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.14),transparent_70%)] blur-3xl\" aria-hidden />\n\n        <div className=\"relative rounded-xl sm:rounded-2xl overflow-hidden bg-white border border-gray-200 shadow-lg animate-scale-in\">\n          {/* ExitIntentPopup-style header bar with gradient + blobs */}\n          <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-5 sm:p-6 lg:p-7 text-center relative overflow-hidden\">\n            <div className=\"absolute inset-0 overflow-hidden pointer-events-none\" aria-hidden>\n              <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob motion-reduce:animate-none\" />\n              <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n            </div>\n            <div className=\"relative flex items-center justify-center sm:justify-between gap-4 flex-wrap\">\n              <div className=\"flex items-center gap-3 sm:gap-4\">\n                <div className=\"w-14 h-14 sm:w-16 sm:h-16 bg-white/25 rounded-full flex items-center justify-center shrink-0 shadow-lg\">\n                  <Sparkles className=\"w-7 h-7 sm:w-8 sm:h-8 text-white\" aria-hidden />\n                </div>\n                <div className=\"text-left\">\n                  <h2 className=\"text-2xl sm:text-3xl font-extrabold text-white drop-shadow-sm\">\n                    AI Keres\n                  </h2>\n                  <p className=\"text-white text-sm sm:text-base font-semibold mt-0.5\">\n                    rj termszetesen, tallj gyorsan\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"relative z-10 px-4 py-4 sm:p-6 lg:px-8 lg:py-7 bg-white\">\n            <div className=\"mb-4 flex flex-wrap items-center justify-between gap-2\">\n              <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1.5 text-[11px] font-extrabold uppercase tracking-[0.16em] text-primary-700 shadow-sm\">\n                <Sparkles className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                Next Search Stage\n              </span>\n              <span className={`inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-[11px] font-bold uppercase tracking-[0.13em] ${isIndexBuilding ? 'border-amber-200 bg-amber-50 text-amber-800' : 'border-emerald-200 bg-emerald-50 text-emerald-800'}`}>\n                <span className={`h-1.5 w-1.5 rounded-full ${isIndexBuilding ? 'bg-amber-300 animate-pulse' : 'bg-emerald-300'}`} aria-hidden />\n                {isIndexBuilding ? 'Rendszer tanul' : 'Rendszer ksz'}\n              </span>\n            </div>\n\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className={`relative rounded-[22px] sm:rounded-[28px] border-2 border-primary-200 bg-gradient-to-r from-primary-50/50 to-secondary-50/50 p-3 sm:p-4 shadow-sm transition-all duration-200 focus-within:ring-4 focus-within:ring-primary-200 focus-within:border-primary-300 ${searchPulse ? 'ring-4 ring-emerald-300/50' : ''}`}>\n                <div className=\"pointer-events-none absolute inset-x-6 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300/50 to-transparent\" aria-hidden />\n                <div className=\"flex flex-col gap-3 lg:flex-row lg:items-center\">\n                  <div className=\"flex min-w-0 flex-1 items-center gap-3 sm:gap-4\">\n                    <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-primary-500 via-secondary-600 to-secondary-700 text-white shadow-md sm:h-12 sm:w-12\">\n                      <Search className=\"h-5 w-5 sm:h-6 sm:w-6\" aria-hidden />\n                    </div>\n                    <div className=\"min-w-0 flex-1\">\n                      <input\n                        type=\"search\"\n                        value={query}\n                        onChange={(e) => setQuery(e.target.value)}\n                        onFocus={() => setIsOpen(true)}\n                        placeholder=\"Mit keresel? pl. bzs kanap 100e alatt, skandinv komd...\"\n                        className=\"w-full min-h-[50px] bg-transparent text-lg font-semibold tracking-[-0.01em] text-gray-900 outline-none placeholder:text-gray-500 sm:min-h-[58px] sm:text-[1.34rem] lg:min-h-[48px] lg:text-[1.15rem] xl:text-[1.28rem]\"\n                        aria-label=\"Keress a teljes katalgusban\"\n                        autoComplete=\"off\"\n                      />\n                      <p className=\"mt-1 text-xs text-gray-600 sm:text-sm\">\n                        rj termszetesen: termk + stlus + helyisg + rkeret\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2 sm:gap-3\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowQuickFilterPanel((prev) => !prev)}\n                      className={`min-h-[48px] rounded-xl border px-4 text-sm font-semibold transition-all touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5 ${showQuickFilterPanel ? 'border-primary-400 bg-primary-100 text-primary-800' : 'border-gray-300 bg-white text-gray-700 hover:border-primary-300 hover:bg-primary-50'}`}\n                      title=\"Gyors szrk\"\n                      aria-expanded={showQuickFilterPanel}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Filter className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Szrk</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"min-h-[48px] rounded-xl border border-secondary-200 bg-secondary-50 px-4 text-sm font-semibold text-secondary-800 transition-all hover:bg-secondary-100 touch-manipulation sm:min-h-[54px] sm:rounded-full sm:px-5\"\n                      title=\"Kpbl keress\"\n                      aria-label=\"Kpbl keress\"\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        <Camera className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        <span className=\"hidden sm:inline\">Kpbl</span>\n                      </span>\n                    </button>\n                    <button\n                      type=\"submit\"\n                      className=\"min-h-[48px] flex-1 rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 px-5 text-base font-bold text-white shadow-[0_10px_26px_rgba(255,138,0,0.38)] transition-all hover:-translate-y-0.5 hover:shadow-[0_14px_34px_rgba(255,138,0,0.48)] active:scale-[0.98] touch-manipulation sm:min-h-[54px] sm:flex-none sm:rounded-full sm:px-7\"\n                      aria-busy={isSearching}\n                    >\n                      <span className=\"inline-flex items-center justify-center gap-2\">\n                        {isSearching ? (\n                          <span className=\"h-5 w-5 shrink-0 animate-spin rounded-full border-2 border-white/80 border-t-transparent\" aria-hidden />\n                        ) : (\n                          <ArrowRight className=\"h-5 w-5 shrink-0\" aria-hidden />\n                        )}\n                        <span>{isSearching ? 'Keres...' : 'Keress'}</span>\n                      </span>\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                      <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-xs font-semibold text-primary-700 shadow-sm\">\n                    <Wand2 className=\"h-3.5 w-3.5 text-primary-500\" aria-hidden />\n                    AI md\n                  </span>\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-xs font-semibold text-secondary-700\">\n                    <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                    Smart intent parsing\n                  </span>\n                </div>\n                {actualResultCount != null && trimmedQuery.length >= 2 && (\n                  <span className=\"inline-flex items-center gap-2 rounded-full border border-primary-200 bg-primary-50 px-3 py-1 text-sm font-bold text-primary-800 tabular-nums shadow-sm\">\n                    <span className=\"h-2 w-2 rounded-full bg-primary-500\" aria-hidden />\n                    {actualResultCount} tallat\n                  </span>\n                )}\n              </div>\n\n              <div className=\"pt-1\">\n                <p className=\"mb-2 text-[11px] font-extrabold uppercase tracking-[0.14em] text-gray-500\">Gyors parancsok</p>\n                <div className=\"flex gap-2 overflow-x-auto pb-1 [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {dynamicQuickSuggestions.slice(0, 6).map((text) => (\n                    <button\n                      key={`hero-chip-${text}`}\n                      type=\"button\"\n                      onClick={() => applySuggestion(text, { submit: true, source: 'hero-chip' })}\n                      className=\"whitespace-nowrap inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-white px-3 py-1.5 text-xs font-semibold text-gray-800 shadow-sm transition-all hover:-translate-y-0.5 hover:border-primary-300 hover:bg-primary-50 hover:text-primary-700 sm:text-sm\"\n                    >\n                      <Sparkles className=\"h-3.5 w-3.5 text-secondary-600\" aria-hidden />\n                      {text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"flex flex-wrap items-center justify-between gap-2 border-t border-gray-200 pt-3\">\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-gray-600\">\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Enter</kbd>\n                  Keress\n                  <span className=\"text-gray-400\"></span>\n                  <kbd className=\"rounded border border-gray-300 bg-white px-1.5 py-0.5 text-[10px] font-bold text-gray-700\">Esc</kbd>\n                  Bezrs\n                </div>\n                <div className=\"inline-flex items-center gap-2 rounded-full border border-secondary-200 bg-secondary-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.12em] text-secondary-700\">\n                  <Sparkles className=\"h-3.5 w-3.5 text-secondary-200\" aria-hidden />\n                  {actualResultCount != null && trimmedQuery.length >= 2 ? `${confidenceMeta.label}` : 'Adaptv AI ajnls'}\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n\n        {/* Tartalom  szrk, tallatok, stb. */}\n        <div className=\"relative z-10 mt-4 sm:mt-5 min-w-0 max-w-full\">\n          <div className=\"space-y-4 sm:space-y-5 lg:grid lg:grid-cols-12 lg:gap-4 lg:space-y-0\">\n          {showQuickFilterPanel && (\n            <div className=\"mt-3 lg:mt-0 rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-4 relative overflow-hidden w-full lg:col-span-6 shadow-sm animate-fade-in-up\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-primary-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-3\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Filter className=\"w-5 h-5\" aria-hidden /></span>\n                Gyors szrk\n              </p>\n              <div className=\"space-y-3\">\n                {Object.entries(QUICK_FILTER_PRESETS).map(([group, values]) => (\n                  <div key={group} className=\"flex flex-wrap items-center gap-2\">\n                    <span className=\"text-xs font-bold uppercase tracking-wide text-gray-600 min-w-14\">\n                      {group}\n                    </span>\n                    {values.map((value) => (\n                      <button\n                        key={`${group}-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-300 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                ))}\n                {preferredCategories.length > 0 && (\n                  <div className=\"flex flex-wrap items-center gap-2 pt-1\">\n                    <span className=\"text-xs font-semibold uppercase tracking-wide text-gray-600 min-w-14\">\n                      Neked\n                    </span>\n                    {preferredCategories.slice(0, 3).map((value) => (\n                      <button\n                        key={`fav-${value}`}\n                        type=\"button\"\n                        onClick={() => applyQuickFilterToken(value)}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-medium hover:bg-secondary-100 transition-colors touch-manipulation min-h-[40px]\"\n                      >\n                        {value}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {!isOpen && (\n          <>\n          {/* Pontossg  trust card */}\n          <div className=\"rounded-xl border border-emerald-200 bg-gradient-to-r from-emerald-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\" role=\"status\" aria-live=\"polite\">\n            <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-emerald-400 via-secondary-500 to-primary-500\" aria-hidden />\n            <div className=\"flex items-center justify-between gap-2 mb-2\">\n              <span className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-emerald-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Award className=\"w-5 h-5\" aria-hidden /></span>\n                Tallatok\n              </span>\n              <span className={`text-base font-bold text-emerald-800 tabular-nums transition-transform duration-300 ${resultCountPulse ? 'scale-110' : 'scale-100'}`}>{actualResultCount ?? 0}</span>\n            </div>\n            <div className=\"h-2 rounded-full bg-gray-200 overflow-hidden\">\n              <div className={`h-full rounded-full transition-all duration-300 ${confidenceMeta.tone}`} style={{ width: `${confidenceScore}%` }} />\n            </div>\n            {actualResultCount != null && (\n              <p className=\"mt-1.5 text-xs text-emerald-700\">{confidenceMeta.label}</p>\n            )}\n          </div>\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 lg:col-span-6\">\n              <button\n                type=\"button\"\n                onClick={() => triggerFullSearch(trimmedQuery, 'submit')}\n                className=\"w-full min-h-[48px] rounded-xl bg-gradient-to-r from-primary-500 via-primary-600 to-secondary-600 text-white font-bold text-base shadow-[0_8px_22px_rgba(255,138,0,0.35)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.45)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 touch-manipulation\"\n              >\n                sszes tallat megnyitsa ({actualResultCount ?? 0})\n              </button>\n            </div>\n          )}\n\n          {activeFilters.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap gap-2 rounded-xl border border-sky-200 bg-gradient-to-r from-sky-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-sky-400 via-blue-500 to-secondary-500\" aria-hidden />\n              <span className=\"w-full flex items-center gap-2.5 mb-2 text-sm font-bold text-gray-800\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-sky-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><SlidersHorizontal className=\"w-5 h-5\" aria-hidden /></span>\n                Aktv szrk\n              </span>\n              {activeFilters.map((f) => (\n                <button\n                  key={f.id}\n                  type=\"button\"\n                  onClick={() => removeFilter(f)}\n                  className=\"inline-flex items-center gap-1.5 px-3 py-2 rounded-lg bg-white border border-sky-200 text-sky-800 text-sm font-medium hover:bg-sky-50 transition-colors touch-manipulation min-h-[40px]\"\n                >\n                  {f.label}: {f.value}\n                  <X className=\"w-3 h-3\" aria-hidden />\n                </button>\n              ))}\n              <button\n                type=\"button\"\n                onClick={clearAllFilters}\n                className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-700 text-sm font-medium hover:bg-gray-50 touch-manipulation min-h-[40px]\"\n              >\n                Szrk trlse\n              </button>\n            </div>\n          )}\n\n          {trimmedQuery.length >= 2 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 flex flex-wrap items-center gap-2 rounded-xl border border-secondary-200 bg-gradient-to-r from-secondary-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-secondary-400 via-teal-500 to-primary-500\" aria-hidden />\n              <button\n                type=\"button\"\n                onClick={() => setShowRewriteOptions((prev) => !prev)}\n                className=\"inline-flex items-center gap-2.5 px-3 py-2 rounded-lg bg-white text-secondary-800 text-sm font-bold border border-secondary-200 hover:bg-secondary-50 transition-colors touch-manipulation min-h-[40px] shadow-sm\"\n              >\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-secondary-500 to-secondary-600 text-white flex items-center justify-center shrink-0 shadow-sm\"><BrainCircuit className=\"w-5 h-5\" aria-hidden /></span>\n                AI tfogalmazs\n              </button>\n              {showRewriteOptions && rewriteSuggestionsWithQuality.slice(0, 3).map((item) => (\n                <button\n                  key={item.text}\n                  type=\"button\"\n                  onClick={() => applyRewrite(item.text)}\n                  className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-white text-secondary-800 text-sm hover:bg-secondary-50 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                >\n                  <span>{item.text}</span>\n                  <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.quality.classes}`}>\n                    {item.quality.label}  {item.count}\n                  </span>\n                </button>\n              ))}\n            </div>\n          )}\n\n          {intentTimeline.length > 0 && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-indigo-200 bg-gradient-to-r from-indigo-50 to-secondary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-6\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-indigo-400 via-secondary-500 to-primary-500\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><Lightbulb className=\"w-5 h-5\" aria-hidden /></span>\n                AI rtelmezs\n              </p>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                {intentTimeline.map((step, idx) => (\n                  <div key={`${step.title}-${idx}`} className=\"rounded-lg border px-3 py-2 bg-white border-indigo-200\">\n                    <p className=\"text-xs font-semibold uppercase tracking-wide opacity-90 text-indigo-600\">{step.title}</p>\n                    <p className=\"text-sm font-semibold mt-0.5 text-gray-900\">{step.value}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n            <div className=\"mt-3 sm:mt-4 lg:mt-0 rounded-xl border border-gray-200 bg-gradient-to-r from-gray-50 to-primary-50 px-4 py-3.5 relative overflow-hidden w-full shadow-sm lg:col-span-12\">\n              <div className=\"absolute left-0 bottom-0 w-full h-0.5 bg-gradient-to-r from-gray-300 via-gray-400 to-primary-400\" aria-hidden />\n              <p className=\"text-sm font-bold text-gray-800 flex items-center gap-2.5 mb-2\">\n                <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><RotateCcw className=\"w-5 h-5\" aria-hidden /></span>\n                Elzmnyek\n              </p>\n              {historyGrouped.today.length > 0 && (\n                <div className=\"mb-2\">\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Ma</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.today.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`today-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n              {historyGrouped.earlier.length > 0 && (\n                <div>\n                  <p className=\"text-xs font-bold uppercase tracking-wide text-gray-600 mb-1.5\">Korbbi</p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {historyGrouped.earlier.slice(0, 4).map((item) => {\n                      const q = item.q || item;\n                      return (\n                        <span key={`earlier-${q}`} className=\"inline-flex items-center gap-1 rounded-lg border border-gray-200 bg-white overflow-hidden min-h-[40px]\">\n                          <button\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'history' })}\n                            className=\"px-3 py-2 text-left text-gray-800 text-sm font-medium hover:bg-primary-50 hover:text-primary-700 flex-1 min-w-0 truncate max-w-[180px] sm:max-w-none touch-manipulation\"\n                          >\n                            <RotateCcw className=\"w-3 h-3 shrink-0 inline mr-1.5 align-middle\" aria-hidden />\n                            <span className=\"truncate\">{q}</span>\n                          </button>\n                          <button\n                            type=\"button\"\n                            onClick={(e) => { e.stopPropagation(); removeFromHistory(q); }}\n                            className=\"p-2 text-gray-400 hover:text-gray-700 hover:bg-gray-100 shrink-0 touch-manipulation\"\n                            aria-label={`${q} trlse`}\n                          >\n                            <X className=\"w-3.5 h-3.5\" aria-hidden />\n                          </button>\n                        </span>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n        {didSearch && !isOpen && (\n          <div className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-50 text-emerald-800 text-sm font-semibold border border-emerald-200/80 lg:col-span-12\">\n            <CheckCircle2 className=\"w-4 h-4 text-emerald-600\" aria-hidden />\n            Keress elindtva\n          </div>\n        )}\n          </>\n        )}\n\n        {isOpen && (\n          <div\n            className=\"mt-4 lg:mt-0 rounded-xl sm:rounded-2xl border border-primary-200 bg-white overflow-hidden max-h-[70vh] sm:max-h-[65vh] overflow-y-auto overflow-x-hidden shadow-lg max-w-full min-w-0 w-full lg:col-span-12 animate-fade-in-up\"\n            style={{ WebkitOverflowScrolling: 'touch', touchAction: 'pan-y' }}\n            onScroll={() => {\n              setPreviewProduct(null);\n              setPreviewAnchor(null);\n            }}\n          >\n            <div className=\"sticky top-0 z-10 bg-gradient-to-r from-primary-50 to-secondary-50 border-b border-gray-200 rounded-t-xl px-4 py-3 min-h-[52px]\">\n              <div className=\"flex items-center justify-between gap-3\">\n                <p className=\"text-base font-bold text-gray-800 flex items-center gap-2.5\">\n                  <span className=\"w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-600 text-white flex items-center justify-center shadow-sm\"><TrendingUp className=\"w-5 h-5\" aria-hidden /></span>\n                  Javaslatok s tallatok\n                </p>\n                <button\n                  type=\"button\"\n                  onClick={() => setIsOpen(false)}\n                  className=\"p-2.5 rounded-xl text-gray-500 hover:text-gray-800 hover:bg-gray-100 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center touch-manipulation\"\n                  aria-label=\"Kerespanel bezrsa\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"mt-2 flex flex-wrap items-center gap-2\">\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-primary-200 bg-primary-50 px-2.5 py-1 text-[11px] font-semibold text-primary-700\">\n                  Live\n                </span>\n                <span className=\"inline-flex items-center gap-1.5 rounded-full border border-secondary-200 bg-secondary-50 px-2.5 py-1 text-[11px] font-semibold text-secondary-700\">\n                  {displayedTopProducts.length} top termk\n                </span>\n                {trimmedQuery.length >= 2 && actualResultCount != null && (\n                  <span className=\"inline-flex items-center gap-1.5 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-1 text-[11px] font-semibold text-emerald-700\">\n                    {actualResultCount} relevns\n                  </span>\n                )}\n              </div>\n            </div>\n\n            {displayedTopProducts.length > 0 && (\n              <div className=\"px-4 py-4 border-b border-gray-200 bg-gradient-to-b from-primary-50/50 to-secondary-50/50 w-full\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <p className=\"inline-flex items-center gap-2 text-base font-bold text-gray-800\">\n                    <TrendingUp className=\"w-5 h-5 text-primary-500\" aria-hidden />\n                    {trimmedQuery.length < 2 ? 'Ajnlott indulsnak' : 'Legjobb tallatok'}\n                  </p>\n                  <span className=\"text-sm text-gray-600 tabular-nums\">{displayedTopProducts.length} db</span>\n                </div>\n                <div className=\"flex gap-3 overflow-x-auto pb-2 -mx-1 px-1 snap-x snap-mandatory [scrollbar-width:thin] [&::-webkit-scrollbar]:h-1.5\">\n                  {displayedTopProducts.map((p, index) => {\n                    const badge = getTopBadge(p, index);\n                    return (\n                      <div\n                        key={p.id || p.name}\n                        data-product-id={p.id || p.name}\n                        role=\"button\"\n                        tabIndex={0}\n                        onClick={() => {\n                          if (previewProduct?.id === p.id || previewProduct?.name === p.name) {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                            return;\n                          }\n                          handlePreviewProductClick(p);\n                        }}\n                        onMouseMove={(e) => handleCardMouseMove(e, p.id || p.name)}\n                        onMouseLeave={() => setHoverCard({ id: null, rx: 0, ry: 0 })}\n                        onKeyDown={(e) => {\n                          if (e.key === 'Enter' || e.key === ' ') {\n                            e.preventDefault();\n                            handlePreviewProductClick(p);\n                          }\n                        }}\n                        className=\"min-w-[140px] xs:min-w-[160px] sm:min-w-[200px] lg:min-w-[220px] snap-start text-left rounded-xl border border-gray-200 bg-white hover:border-primary-300 hover:shadow-lg transition-all p-3 touch-manipulation active:scale-[0.98]\"\n                        style={hoverCard.id === String(p.id || p.name)\n                          ? { transform: `perspective(900px) rotateX(${hoverCard.rx}deg) rotateY(${hoverCard.ry}deg) translateY(-2px)` }\n                          : undefined}\n                      >\n                        <div\n                          className=\"relative w-full h-24 sm:h-28 rounded-lg bg-gray-100 overflow-hidden mb-2 flex items-center justify-center\"\n                          onMouseEnter={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            setPreviewProduct(p);\n                            setPreviewAnchor(rect);\n                          }}\n                          onMouseLeave={() => {\n                            setPreviewProduct(null);\n                            setPreviewAnchor(null);\n                          }}\n                          onTouchStart={(e) => {\n                            const rect = e.currentTarget.getBoundingClientRect();\n                            longPressTimerRef.current = setTimeout(() => {\n                              longPressTimerRef.current = null;\n                              setPreviewProduct(p);\n                              setPreviewAnchor(rect);\n                            }, LONG_PRESS_MS);\n                          }}\n                          onTouchEnd={() => {\n                            if (longPressTimerRef.current) {\n                              clearTimeout(longPressTimerRef.current);\n                              longPressTimerRef.current = null;\n                            }\n                          }}\n                        >\n                          {getProductImage(p) ? <img src={getProductImage(p)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" /> : <Package className=\"w-5 h-5 text-gray-400\" aria-hidden />}\n                        </div>\n                        <div className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full border text-xs font-semibold ${badge.classes}`}>\n                          <Award className=\"w-3.5 h-3.5\" aria-hidden />\n                          {badge.text}\n                        </div>\n                        <p className=\"text-sm font-medium text-gray-800 line-clamp-2 mt-1.5 min-h-[2.2rem]\">{p.name}</p>\n                        <div className=\"mt-1.5 flex items-center justify-between\">\n                          <p className=\"text-base sm:text-lg text-primary-600 font-semibold\">{formatPrice(p.salePrice || p.price)}</p>\n                          <ChevronRight className=\"w-3.5 h-3.5 text-gray-400\" aria-hidden />\n                        </div>\n                        <div className=\"mt-2 flex items-center gap-1.5\">\n                          <button\n                            type=\"button\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              toggleCompareProduct(p);\n                            }}\n                            className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-[11px] border transition-colors ${compareProducts.some((cp) => String(cp.id) === String(p.id))\n                              ? 'border-primary-300 bg-primary-50 text-primary-700'\n                              : 'border-gray-200 bg-gray-50 text-gray-700 hover:bg-gray-100'\n                              }`}\n                          >\n                            <Plus className=\"w-3.5 h-3.5\" aria-hidden />\n                            sszevets\n                          </button>\n                          <span className=\"text-xs text-primary-600 font-medium\">QuickView</span>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {suggestions.length > 0 ? (\n              <div className=\"px-4 py-4 space-y-4 bg-gradient-to-b from-primary-50/30 to-secondary-50/30 w-full\">\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\n                  {suggestions.slice(0, 6).map((s, idx) => (\n                    <button\n                      key={idx}\n                      type=\"button\"\n                      onClick={() => applySuggestion(s.text || s.query || '', { submit: true, source: 'suggestion' })}\n                      className=\"text-left px-4 py-3 rounded-xl border border-secondary-200 bg-white hover:border-secondary-300 hover:bg-secondary-50 transition-colors min-h-[48px] touch-manipulation\"\n                    >\n                      <p className=\"text-base font-semibold text-gray-800 truncate\">{s.text || s.query}</p>\n                    </button>\n                  ))}\n                </div>\n                <div>\n                  <p className=\"text-sm font-bold text-gray-800 mb-2\">Gyorstallatok</p>\n                  <div className=\"flex flex-wrap gap-2 mb-2\">\n                    {quickHitSuggestions.slice(0, 6).map((item) => (\n                      <button\n                        key={`dyn-${item.text}`}\n                        type=\"button\"\n                        onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                        className=\"px-3 py-2 rounded-lg border border-secondary-200 bg-secondary-50 text-secondary-800 text-sm font-semibold hover:bg-secondary-100 transition-colors inline-flex items-center gap-1.5 touch-manipulation min-h-[40px]\"\n                      >\n                        <span>{item.text}</span>\n                        <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                      </button>\n                    ))}\n                  </div>\n                  {(historyGrouped.today.length > 0 || historyGrouped.earlier.length > 0) && (\n                    <div className=\"flex flex-wrap gap-2\">\n                      {[...historyGrouped.today, ...historyGrouped.earlier].slice(0, 2).map((item) => {\n                        const q = item.q || item;\n                        return (\n                          <button\n                            key={`journey-inline-${q}`}\n                            type=\"button\"\n                            onClick={() => applySuggestion(q, { submit: true, source: 'journey' })}\n                            className=\"px-2.5 py-1 rounded-full border border-gray-200 bg-white text-gray-700 text-[11px] hover:bg-gray-50 transition-colors\"\n                          >\n                            Gyors jrafuttats: {q}\n                          </button>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"px-3 sm:px-4 py-3 sm:py-4 space-y-3 w-full bg-gray-50\">\n                <div className=\"flex flex-wrap gap-2\">\n                  {quickHitSuggestions.map((item) => (\n                    <button\n                      key={item.text}\n                      type=\"button\"\n                      onClick={() => applySuggestion(item.text, { submit: true, source: 'quick-hit' })}\n                      className=\"px-3 py-2 rounded-lg border border-gray-200 bg-white text-gray-800 text-sm font-medium hover:bg-primary-50 hover:border-primary-200 transition-colors inline-flex items-center gap-1.5\"\n                    >\n                      <span>{item.text}</span>\n                      <span className={`px-1.5 py-0.5 rounded-md border text-[10px] font-medium ${item.badge.classes}`}>{item.badge.label}</span>\n                    </button>\n                  ))}\n                </div>\n                {hasNoResults && rescueSuggestions.length > 0 && (\n                  <div className=\"rounded-xl border border-primary-200 bg-gradient-to-r from-primary-50 to-secondary-50 px-4 py-3\">\n                    <p className=\"text-base font-semibold text-gray-800 mb-2\">Nincs tallat. Prbld inkbb:</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {rescueSuggestions.map((q) => (\n                        <button\n                          key={q}\n                          type=\"button\"\n                          onClick={() => applySuggestion(q, { submit: true, source: 'rescue' })}\n                          className=\"px-3 py-2 rounded-lg border border-primary-200 bg-white text-primary-800 text-sm font-semibold hover:bg-primary-50 transition-colors\"\n                        >\n                          {q}\n                        </button>\n                      ))}\n                    </div>\n                    <button\n                      type=\"button\"\n                      onClick={onTryAI}\n                      className=\"mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-secondary-600 text-white text-sm font-semibold hover:bg-secondary-700 transition-colors\"\n                    >\n                      <Camera className=\"w-4 h-4\" aria-hidden />\n                      Kpalap keress\n                    </button>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {compareProducts.length > 0 && (\n              <div className=\"sticky bottom-0 z-10 border-t border-secondary-300/35 bg-gradient-to-b from-slate-900/95 to-slate-950 px-4 py-3 rounded-b-xl backdrop-blur-sm\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                  <p className=\"text-base font-bold text-secondary-100\">sszevet tlca</p>\n                  {compareProducts.map((p) => (\n                    <span key={`cmp-${p.id}`} className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-slate-800 text-slate-100 text-sm font-medium\">\n                      {p.name}\n                      <button\n                        type=\"button\"\n                        onClick={() => toggleCompareProduct(p)}\n                        className=\"p-1 rounded-lg hover:bg-slate-700 transition-colors\"\n                        aria-label=\"Termk eltvoltsa sszevetsbl\"\n                      >\n                        <X className=\"w-3.5 h-3.5\" aria-hidden />\n                      </button>\n                    </span>\n                  ))}\n                  <button\n                    type=\"button\"\n                    onClick={runCompareSearch}\n                    disabled={compareProducts.length < 2}\n                    className=\"ml-auto min-h-[44px] px-4 py-2 rounded-xl bg-gradient-to-r from-primary-500 to-secondary-600 text-white text-sm font-bold shadow-[0_8px_22px_rgba(255,138,0,0.4)] disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-[0_12px_28px_rgba(255,138,0,0.5)] active:scale-[0.98] transition-all\"\n                  >\n                    sszehasonlts\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Elnzet tooltip (hover / long-press) */}\n            {previewProduct && previewAnchor && (\n              <div\n                className=\"fixed z-[100] rounded-xl border border-primary-300/40 bg-slate-900/95 shadow-xl p-3 w-[200px] sm:w-[220px] pointer-events-none\"\n                style={{\n                  left: Math.max(8, Math.min(previewAnchor.left, typeof window !== 'undefined' ? window.innerWidth - 220 : previewAnchor.left)),\n                  top: previewAnchor.top - 8,\n                  transform: 'translateY(-100%)',\n                }}\n              >\n                <div className=\"h-24 rounded-lg bg-slate-800 overflow-hidden mb-2 flex items-center justify-center\">\n                  {getProductImage(previewProduct) ? (\n                    <img src={getProductImage(previewProduct)} alt=\"\" className=\"w-full h-full object-cover\" loading=\"lazy\" />\n                  ) : (\n                    <Package className=\"w-8 h-8 text-slate-500\" aria-hidden />\n                  )}\n                </div>\n                <p className=\"text-sm font-semibold text-slate-100 line-clamp-2\">{previewProduct.name}</p>\n                <p className=\"text-base sm:text-lg text-primary-600 font-semibold mt-1\">{formatPrice(previewProduct.salePrice || previewProduct.price)}</p>\n                <p className=\"text-xs text-slate-300 mt-0.5\">Kattints a rszletekhez</p>\n              </div>\n            )}\n          </div>\n        )}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n\n","/**\n * Kategria kpek  Unsplash stock photos, kategrihoz kapcsold\n * Shared between CategoryPage, ModernHero quick categories, stb.\n */\nexport const CATEGORY_IMAGES = {\n  Kanap: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Kanapk: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80',\n  Fotel: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Fotelek: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=600&q=80',\n  Nappali: 'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=600&q=80',\n  gy: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  gyak: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=600&q=80',\n  Hlszoba: 'https://images.unsplash.com/photo-1616594039964-ae9021a400a0?w=600&q=80',\n  Matrac: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Matracok: 'https://images.unsplash.com/photo-1631049307264-da0ec9d70304?w=600&q=80',\n  Asztal: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Asztalok: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  Szk: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Szkek: 'https://images.unsplash.com/photo-1503602642458-232111445657?w=600&q=80',\n  Iroda: 'https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=600&q=80',\n  Szekrny: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Szekrnyek: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Lmpa: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Lmpk: 'https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=600&q=80',\n  Kert: 'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=600&q=80',\n  Gyerek: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Gyerekszoba: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&q=80',\n  Komd: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  Gardrb: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=600&q=80',\n  tkez: 'https://images.unsplash.com/photo-1611269154421-4e27233ac5c7?w=600&q=80',\n  default: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=600&q=80'\n};\n\nexport const getCategoryImage = (name) => {\n  if (!name) return CATEGORY_IMAGES.default;\n  const n = String(name).toLowerCase();\n  for (const [key, url] of Object.entries(CATEGORY_IMAGES)) {\n    if (key === 'default') continue;\n    if (n.includes(key.toLowerCase())) return url;\n  }\n  return CATEGORY_IMAGES.default;\n};\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Sparkles, Camera, ArrowRight,\n  Package, Users, Star, Zap, ChevronRight, ChevronLeft\n} from 'lucide-react';\nimport { CountUp } from '../ui/CountUp';\nimport HeroSmartSearch from './HeroSmartSearch';\nimport { getCategoryIcon } from '../ui/Icons';\nimport { getCategoryImage } from '../../utils/categoryImages';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\n\nconst QUICK_CARD_COLORS = [\n  'from-amber-500 via-orange-500 to-primary-600',\n  'from-emerald-500 via-teal-500 to-secondary-600',\n  'from-violet-500 via-purple-500 to-fuchsia-600',\n  'from-rose-500 via-pink-500 to-red-500',\n  'from-sky-500 via-blue-500 to-indigo-600',\n  'from-lime-500 via-green-500 to-emerald-600',\n];\n\nconst QUICK_CATEGORY_LIMIT = 8;\nconst MIN_QUICK_CATEGORY_PRODUCTS = 20;\nconst CAROUSEL_SCROLL_DURATION = 700;\nconst CAROUSEL_AUTO_INTERVAL = 6000;\nconst CAROUSEL_AUTO_STEP_FRACTION = 0.65;\n\n/** Sima grgets ease-in-out easinggel */\nconst smoothScrollTo = (element, targetLeft, duration = CAROUSEL_SCROLL_DURATION) => {\n  if (!element) return;\n  const start = element.scrollLeft;\n  const dist = targetLeft - start;\n  const startTime = performance.now();\n  const easeInOutCubic = (t) => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);\n  const tick = (now) => {\n    const elapsed = Math.min((now - startTime) / duration, 1);\n    const eased = easeInOutCubic(elapsed);\n    element.scrollLeft = start + dist * eased;\n    if (elapsed < 1) requestAnimationFrame(tick);\n  };\n  requestAnimationFrame(tick);\n};\n\nconst HERO_REVEAL_DELAY = { badge: 0, line1: 100, line2: 220, line3: 340, sub: 460, cta: 600, stats: [720, 820, 920, 1020] };\n\n/**\n * Premium Hero  egyetlen zenet, ers vizul, lgzs\n */\nexport const ModernHero = ({\n  onExplore,\n  onTryAI,\n  quickCategories = [],\n  onQuickCategory,\n  products = [],\n  onHeroSearch,\n  onHeroQuickView\n}) => {\n  const mounted = true;\n  const [heroVariant, setHeroVariant] = useState('A');\n\n  useEffect(() => {\n    try {\n      const storageKey = 'mkt_hero_ab_variant';\n      const existing = localStorage.getItem(storageKey);\n      if (existing === 'A' || existing === 'B') {\n        setHeroVariant(existing);\n        trackSectionEvent(`hero-variant-${existing}`, 'impression');\n        return;\n      }\n      const assigned = Math.random() < 0.5 ? 'A' : 'B';\n      localStorage.setItem(storageKey, assigned);\n      setHeroVariant(assigned);\n      trackSectionEvent(`hero-variant-${assigned}`, 'impression');\n    } catch {\n      setHeroVariant('A');\n      trackSectionEvent('hero-variant-A', 'impression');\n    }\n  }, []);\n\n  const heroCopy = heroVariant === 'B'\n    ? {\n      line1: 'Alaktsd t a teret,',\n      line2: 'mieltt egyetlen btort megvennl.',\n      sub: 'AI tvonalterv, azonnali vizualizci s valdi termkek egyetlen prmium lmnyben.',\n      ctaPrimary: 'Szemlyes AI terv indul',\n      ctaBadge: 'PRMIUM',\n      ctaSecondary: 'Inspirci bngszse'\n    }\n    : {\n      line1: 'Tervezz gy,',\n      line2: 'mintha ez lenne az lomotthonod.',\n      sub: 'Fot, AI-tervezs, vals ajnlatok. Egyetlen flow, ami 5 perc alatt eljuttat az ihlettl a rendelsig.',\n      ctaPrimary: 'Kezdjk AI-val',\n      ctaBadge: 'Most',\n      ctaSecondary: 'Kollekci megtekintse'\n    };\n\n  const stats = [\n    { icon: Package, value: 170, suffix: 'K+', label: 'Termk', decimals: 0 },\n    { icon: Users, value: 50, suffix: 'K+', label: 'Elgedett vsrl', decimals: 0 },\n    { icon: Star, value: 4.9, suffix: '/5', label: 'rtkels', decimals: 1 },\n    { icon: Zap, value: 24, suffix: '/7', label: 'AI tmogats', decimals: 0 }\n  ];\n  const statCardStyles = [\n    {\n      card: 'from-emerald-50 to-white border-emerald-200',\n      iconWrap: 'from-emerald-500 to-emerald-600',\n      edge: 'from-emerald-500 via-emerald-400 to-transparent'\n    },\n    {\n      card: 'from-blue-50 to-white border-blue-200',\n      iconWrap: 'from-blue-500 to-blue-600',\n      edge: 'from-blue-500 via-blue-400 to-transparent'\n    },\n    {\n      card: 'from-amber-50 to-white border-amber-200',\n      iconWrap: 'from-amber-500 to-orange-600',\n      edge: 'from-amber-500 via-amber-400 to-transparent'\n    },\n    {\n      card: 'from-secondary-50 to-white border-secondary-200',\n      iconWrap: 'from-secondary-600 to-secondary-700',\n      edge: 'from-secondary-600 via-secondary-500 to-transparent'\n    }\n  ];\n\n  const HERO_BG_IMAGE = 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=1920&q=85';\n\n  // Kiemelt kategrik  18 legfontosabb (termkszm szerint), ABC sorrendben megjelentve\n  const mains = Array.isArray(quickCategories) ? quickCategories : [];\n  const subcats = mains.flatMap((m) =>\n    (m?.children || []).map((c) => ({ ...c, parentName: m?.name }))\n  );\n  const allItems = [\n    ...mains.filter((m) => m?.name).map((m) => ({ name: m.name, productCount: m.productCount, parentName: null })),\n    ...subcats.filter((c) => c?.name)\n  ];\n  const byName = new Map();\n  for (const item of allItems) {\n    const count = Number(item?.productCount || 0);\n    if (count < MIN_QUICK_CATEGORY_PRODUCTS) continue;\n    const name = String(item.name).trim();\n    const existing = byName.get(name);\n    if (!existing || count > Number(existing.productCount || 0)) byName.set(name, { ...item, name });\n  }\n  const topByCount = [...byName.values()]\n    .sort((a, b) => Number(b?.productCount || 0) - Number(a?.productCount || 0))\n    .slice(0, QUICK_CATEGORY_LIMIT);\n  const quickCategoryItems = [...topByCount].sort((a, b) => String(a?.name || '').localeCompare(String(b?.name || ''), 'hu'));\n\n  const categoryCarouselRef = useRef(null);\n  const [categoryCarouselPaused, setCategoryCarouselPaused] = useState(false);\n\n  const getCategoryScrollStep = (container) => {\n    if (!container) return 191;\n    const first = container.firstElementChild;\n    if (!first) return 191;\n    const rect = first.getBoundingClientRect();\n    const gap = parseFloat(getComputedStyle(container).columnGap || '16');\n    return Math.max(130, rect.width + gap);\n  };\n\n  useEffect(() => {\n    if (!categoryCarouselPaused && quickCategoryItems.length > 0) {\n      const container = categoryCarouselRef.current;\n      if (!container) return undefined;\n      const id = setInterval(() => {\n        const step = getCategoryScrollStep(container) * CAROUSEL_AUTO_STEP_FRACTION;\n        const maxScroll = container.scrollWidth - container.clientWidth;\n        const next = container.scrollLeft + step;\n        if (maxScroll <= 0 || next >= maxScroll - 5) {\n          smoothScrollTo(container, 0);\n        } else {\n          smoothScrollTo(container, container.scrollLeft + step);\n        }\n      }, CAROUSEL_AUTO_INTERVAL);\n      return () => clearInterval(id);\n    }\n    return undefined;\n  }, [categoryCarouselPaused, quickCategoryItems.length]);\n\n  const scrollCategoryCarousel = (direction) => {\n    const container = categoryCarouselRef.current;\n    if (!container) return;\n    const step = getCategoryScrollStep(container) * 0.85;\n    const target = Math.max(0, Math.min(container.scrollWidth - container.clientWidth, container.scrollLeft + step * direction));\n    smoothScrollTo(container, target);\n  };\n\n  return (\n    <section\n      className=\"relative min-h-screen flex flex-col items-center justify-center overflow-x-clip overflow-y-auto bg-[#fcfcfb]\"\n      aria-label=\"Foldal  AI btorbolt\"\n    >\n      {/* Httrkp ~10% tltszsggal  ahogy volt */}\n      <div\n        className=\"absolute inset-0 bg-cover bg-center opacity-10 z-0\"\n        style={{ backgroundImage: `url(${HERO_BG_IMAGE})` }}\n        aria-hidden\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-b from-white/88 via-white/70 to-primary-50/88 z-[1]\" aria-hidden />\n      <div className=\"pointer-events-none absolute inset-0\" aria-hidden>\n        <div className=\"absolute left-1/2 top-[30%] h-[520px] w-[min(1100px,92vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.24),transparent_62%)] blur-2xl\" />\n        <div className=\"absolute left-1/2 top-[34%] h-[420px] w-[min(860px,84vw)] -translate-x-1/2 -translate-y-1/2 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.16),transparent_70%)] blur-xl\" />\n      </div>\n      <div className=\"absolute inset-0 pointer-events-none\" aria-hidden=\"true\">\n        <div className=\"absolute inset-x-0 top-0 h-[1px] bg-gradient-to-r from-transparent via-primary-300 to-transparent opacity-70\" />\n        <div className=\"absolute inset-x-0 bottom-0 h-[1px] bg-gradient-to-r from-transparent via-secondary-300 to-transparent opacity-60\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 pt-16 sm:pt-20 lg:pt-24 pb-2 sm:pb-3 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          <div\n            className={`inline-flex items-center gap-2.5 px-4 py-2 bg-white rounded-full border border-gray-200 shadow-sm mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.badge}ms` } : undefined}\n          >\n            <span className=\"flex h-2.5 w-2.5 rounded-full bg-primary-500\" aria-hidden />\n            <span className=\"text-xs sm:text-sm font-semibold text-gray-700 uppercase tracking-wide\">\n              Marketly AI rendszer\n            </span>\n          </div>\n\n          <h1 className=\"mb-6 sm:mb-7 lg:mb-8\">\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold text-gray-900 leading-[1.03] ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line1}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line1}\n            </span>\n            <span\n              className={`block text-[2.3rem] sm:text-5xl lg:text-6xl font-extrabold leading-[1.03] bg-gradient-to-r from-primary-500 to-secondary-700 bg-clip-text text-transparent ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n              style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2}ms`, letterSpacing: '-0.03em' } : { letterSpacing: '-0.03em' }}\n            >\n              {heroCopy.line2}\n            </span>\n          </h1>\n\n          <div\n            className={`mx-auto h-1.5 w-28 rounded-full bg-gradient-to-r from-primary-500 to-secondary-700 mb-2 sm:mb-3 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 40}ms` } : undefined}\n            aria-hidden\n          />\n        </div>\n      </div>\n\n      {/* Kiemelt kategrik  carousel: auto scroll, desktop nyilak */}\n      {quickCategoryItems.length > 0 && (\n        <div\n          className={`relative z-10 w-full mb-4 sm:mb-5 overflow-hidden ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n          style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.line2 + 80}ms` } : undefined}\n        >\n          <h2 className=\"text-center text-lg sm:text-xl font-bold text-gray-800 mb-3 px-4\">\n            Kiemelt kategrik\n          </h2>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(-1)}\n            className=\"hidden lg:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Balra\"\n          >\n            <ChevronLeft className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => scrollCategoryCarousel(1)}\n            className=\"hidden lg:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/90 shadow-md border border-gray-100 flex items-center justify-center hover:bg-white hover:shadow-lg hover:scale-105 active:scale-95 transition-all duration-200 ease-out\"\n            aria-label=\"Jobbra\"\n          >\n            <ChevronRight className=\"w-5 h-5 text-gray-600\" />\n          </button>\n          <div\n            ref={categoryCarouselRef}\n            onMouseEnter={() => setCategoryCarouselPaused(true)}\n            onMouseLeave={() => setCategoryCarouselPaused(false)}\n            onTouchStart={() => setCategoryCarouselPaused(true)}\n            onTouchEnd={() => setTimeout(() => setCategoryCarouselPaused(false), 3000)}\n            className=\"flex gap-3 sm:gap-4 overflow-x-auto scrollbar-hide pb-2 px-4 sm:px-6 lg:px-14 snap-x snap-mandatory scroll-smooth min-w-0\"\n          >\n            {quickCategoryItems.map((item, idx) => {\n              const name = item?.name;\n              const count = Number(item?.productCount || 0);\n              if (!name) return null;\n              const Icon = getCategoryIcon(name);\n              const productImg = (n) => Array.isArray(products) && products.length > 0\n                ? products.find((p) => (p?.category || '').toLowerCase().includes(String(n || '').toLowerCase()))?.images?.[0]\n                : null;\n              const img = productImg(name) || getCategoryImage(name);\n              const gradient = QUICK_CARD_COLORS[idx % QUICK_CARD_COLORS.length];\n              return (\n                <button\n                  key={`${item.parentName || ''}-${name}`}\n                  type=\"button\"\n                  onClick={() => onQuickCategory?.(name)}\n                  className=\"group relative shrink-0 w-[130px] sm:w-[150px] lg:w-[175px] aspect-[3/4] rounded-2xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 ease-out hover:-translate-y-0.5 hover:scale-[1.02] snap-start focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 border-2 border-white/40\"\n                >\n                  <img\n                    src={img}\n                    alt=\"\"\n                    width={175}\n                    height={233}\n                    loading={idx < 4 ? 'eager' : 'lazy'}\n                    fetchPriority={idx < 2 ? 'high' : undefined}\n                    className=\"absolute inset-0 w-full h-full object-cover transition-transform duration-500 ease-out group-hover:scale-105\"\n                    aria-hidden\n                  />\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent\" />\n                  <div className={`absolute inset-0 bg-gradient-to-br ${gradient} opacity-35`} aria-hidden />\n                  <div className=\"absolute inset-0 flex flex-col items-center justify-center p-3 sm:p-4 text-center\">\n                    <div className=\"w-14 h-14 sm:w-16 sm:h-16 lg:w-20 lg:h-20 rounded-xl lg:rounded-2xl bg-white/25 backdrop-blur-sm flex items-center justify-center mb-2 sm:mb-3 shadow-md group-hover:bg-white/40 group-hover:scale-105 transition-all duration-300 ease-out ring-2 ring-white/30\">\n                      <Icon className=\"w-7 h-7 sm:w-8 sm:h-8 lg:w-10 lg:h-10 text-white drop-shadow-[0_2px_8px_rgba(0,0,0,0.5)]\" strokeWidth={2.5} />\n                    </div>\n                    <span className=\"text-white font-bold text-xs sm:text-sm lg:text-base drop-shadow-lg line-clamp-2 leading-tight\">\n                      {name}\n                    </span>\n                    {count > 0 && (\n                      <span className=\"text-white/95 text-[10px] sm:text-xs mt-1 font-semibold\">\n                        {count.toLocaleString('hu-HU')} db\n                      </span>\n                    )}\n                    <ChevronRight className=\"absolute bottom-2 right-2 w-4 h-4 sm:w-5 sm:h-5 text-white/90 group-hover:translate-x-0.5 transition-transform duration-200 ease-out\" aria-hidden />\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      <div className=\"relative z-10 w-full max-w-[1500px] mx-auto px-4 sm:px-6 lg:px-10 min-w-0\">\n        <div className=\"flex flex-col items-center text-center w-full min-w-0 max-w-full\">\n          {/* Kzponti hero search  full width minus 2px */}\n          <div\n            className={`relative w-full min-w-0 max-w-full px-[1px] mb-6 sm:mb-8 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub - 60}ms` } : undefined}\n          >\n            <div className=\"pointer-events-none absolute inset-0 rounded-[32px] border border-white/70 bg-white/[0.04] backdrop-blur-[1px] shadow-[inset_0_1px_0_rgba(255,255,255,0.75)]\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-8 -top-10 h-24 bg-[radial-gradient(ellipse_at_center,rgba(255,138,0,0.22),transparent_65%)] blur-2xl\" aria-hidden />\n            <div className=\"pointer-events-none absolute inset-x-12 -bottom-12 h-28 bg-[radial-gradient(ellipse_at_center,rgba(0,107,111,0.18),transparent_70%)] blur-2xl\" aria-hidden />\n            <HeroSmartSearch\n              products={products}\n              onSearch={onHeroSearch}\n              onTryAI={onTryAI}\n              variant={heroVariant}\n              onOpenProductQuickView={onHeroQuickView}\n            />\n          </div>\n\n          <p\n            className={`text-sm sm:text-base text-gray-600/95 max-w-xl mx-auto mb-8 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.sub}ms`, lineHeight: '1.6' } : { lineHeight: '1.6' }}\n          >\n            {heroCopy.sub}\n          </p>\n\n          <div\n            className={`flex flex-col sm:flex-row gap-4 justify-center items-stretch sm:items-center mb-7 sm:mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`}\n            style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 120}ms` } : undefined}\n          >\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-primary');\n                onTryAI?.();\n              }}\n              className=\"group relative w-full sm:w-auto min-h-[48px] px-8 py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white rounded-2xl font-semibold text-base shadow-[0_10px_26px_rgba(255,138,0,0.32)] hover:shadow-[0_14px_34px_rgba(255,138,0,0.42)] hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kezdj AI tervezssel\"\n            >\n              <span className=\"px-2.5 py-1 rounded-full bg-white/20 text-[11px] font-bold uppercase tracking-wide\">{heroCopy.ctaBadge}</span>\n              <Sparkles className=\"w-5 h-5\" aria-hidden />\n              {heroCopy.ctaPrimary}\n              <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                trackSectionEvent(`hero-variant-${heroVariant}`, 'click', 'cta-secondary');\n                onExplore?.();\n              }}\n              className=\"w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-gray-900 rounded-2xl font-semibold text-base border border-gray-200 shadow-sm hover:border-gray-300 hover:shadow-md hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-300 focus-visible:ring-offset-2 flex items-center justify-center gap-2\"\n              aria-label=\"Kollekci bngszse\"\n            >\n              {heroCopy.ctaSecondary}\n              <ArrowRight className=\"w-5 h-5\" aria-hidden />\n            </button>\n          </div>\n\n          <div className={`flex flex-wrap items-center justify-center gap-x-5 gap-y-2 text-sm text-gray-600 mb-9 ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 70}ms` } : undefined}>\n            <span className=\"inline-flex items-center gap-1.5\"><Star className=\"w-4 h-4 text-amber-500\" aria-hidden /> 4.9/5 vsrli rtkels</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Users className=\"w-4 h-4 text-primary-500\" aria-hidden /> 50K+ elgedett vsrl</span>\n            <span className=\"inline-flex items-center gap-1.5\"><Zap className=\"w-4 h-4 text-secondary-700\" aria-hidden /> 24/7 AI tmogats</span>\n          </div>\n\n          <div className={`w-full max-w-6xl ${mounted ? 'hero-reveal' : 'opacity-0'}`} style={mounted ? { animationDelay: `${HERO_REVEAL_DELAY.cta + 180}ms` } : undefined}>\n            <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4\">\n            {stats.map((stat, idx) => {\n              const style = statCardStyles[idx % statCardStyles.length];\n              return (\n              <div\n                key={idx}\n                    className={`group relative overflow-hidden bg-gradient-to-tr ${style.card} rounded-2xl p-4 border shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200`}\n              >\n                    <div className={`absolute left-0 bottom-0 w-[78%] h-[2px] bg-gradient-to-r ${style.edge}`} aria-hidden />\n                    <div className=\"absolute left-0 bottom-0 w-24 h-24 bg-gradient-to-tr from-black/5 to-transparent rotate-12 -translate-x-7 translate-y-7 blur-[1px]\" aria-hidden />\n                    <div className=\"relative z-10\">\n                    <div className={`w-10 h-10 rounded-xl bg-gradient-to-br ${style.iconWrap} text-white flex items-center justify-center mb-2.5 shadow-sm`}>\n                      <stat.icon className=\"w-5 h-5\" aria-hidden />\n                    </div>\n                    <div className=\"text-xl sm:text-2xl font-bold text-gray-900\">\n                  <CountUp\n                    end={stat.value}\n                    duration={1800}\n                    suffix={stat.suffix}\n                    decimals={stat.decimals}\n                    delay={HERO_REVEAL_DELAY.stats[idx] + 180}\n                  />\n                </div>\n                    <div className=\"text-xs text-gray-600\">{stat.label}</div>\n                    </div>\n              </div>\n              );\n            })}\n              </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { ModernHero };\n","import React, { useState, useEffect, useRef } from 'react';\nimport { \n  Shield, Truck, Award, Clock, Heart, Star, \n  ArrowRight, Check, TrendingUp, Zap, Users,\n  ShoppingBag, Package, Sparkles, RefreshCw\n} from 'lucide-react';\nimport SectionHeader from './SectionHeader';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getStockLevel } from '../../utils/helpers';\nimport { trackSectionEvent } from '../../services/userPreferencesService';\nimport ProductCarousel from '../ui/ProductCarousel';\n\n/**\n * Social Proof & Trust Signals\n */\nexport const SocialProof = () => {\n  const [count, setCount] = useState(0);\n  const targetCount = 50247;\n\n  useEffect(() => {\n    const duration = 2000;\n    const steps = 60;\n    const increment = targetCount / steps;\n    let current = 0;\n\n    const timer = setInterval(() => {\n      current += increment;\n      if (current >= targetCount) {\n        setCount(targetCount);\n        clearInterval(timer);\n      } else {\n        setCount(Math.floor(current));\n      }\n    }, duration / steps);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const trustBadges = [\n    { icon: Shield, label: 'Biztonsgos fizets', color: 'blue' },\n    { icon: Truck, label: 'Ingyenes szllts', color: 'green' },\n    { icon: Award, label: '2 v garancia', color: 'purple' },\n    { icon: Clock, label: '24h gyflszolglat', color: 'orange' }\n  ];\n\n  const colorClasses = {\n    blue: 'from-blue-500 to-blue-600',\n    green: 'from-green-500 to-green-600',\n    purple: 'from-secondary-500 to-secondary-700',\n    orange: 'from-orange-500 to-orange-600'\n  };\n\n  return (\n    <section className=\"relative py-24 bg-[#0f1218] overflow-hidden\" aria-labelledby=\"social-proof-heading\">\n      <div className=\"absolute inset-0 opacity-25\" aria-hidden>\n        <div className=\"absolute -top-32 left-1/2 -translate-x-1/2 w-[920px] h-[920px] rounded-full blur-[160px] bg-primary-500/60\" />\n        <div className=\"absolute -bottom-40 right-0 w-[680px] h-[680px] rounded-full blur-[140px] bg-secondary-600/50\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n        <div className=\"text-center mb-14\">\n          <div className=\"inline-flex items-center gap-2 mb-6 px-4 py-2 bg-white/10 border border-white/15 rounded-full backdrop-blur-sm\">\n            <Users className=\"w-5 h-5 text-primary-400\" aria-hidden />\n            <span className=\"text-xs font-bold text-white/90 uppercase tracking-wider\">Trsadalmi bizonytk</span>\n          </div>\n          <h2 id=\"social-proof-heading\" className=\"text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tight text-white mb-4\">\n            {count.toLocaleString('hu-HU')}+\n          </h2>\n          <p className=\"text-lg sm:text-xl text-white/80\">\n            ember vlasztotta mr a Marketly-t\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-14\">\n          {trustBadges.map((badge, idx) => (\n            <div\n              key={idx}\n              className=\"group relative rounded-2xl border border-white/15 bg-white/10 backdrop-blur-md p-6 shadow-[0_8px_28px_rgba(0,0,0,0.22)] hover:shadow-[0_16px_44px_rgba(0,0,0,0.32)] hover:-translate-y-1 transition-all duration-300\"\n            >\n              <div className={`absolute inset-x-4 top-0 h-px bg-gradient-to-r ${colorClasses[badge.color]} opacity-80`} />\n              <div className={`w-14 h-14 rounded-2xl bg-gradient-to-br ${colorClasses[badge.color]} flex items-center justify-center mb-4 shadow-lg`}>\n                <badge.icon className=\"w-7 h-7 text-white\" aria-hidden />\n              </div>\n              <h3 className=\"font-semibold text-white text-base leading-tight\">\n                {badge.label}\n              </h3>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"text-center rounded-2xl border border-white/15 bg-white/10 backdrop-blur-sm py-8 px-6\">\n          <div className=\"flex justify-center gap-2 mb-4\">\n            {[...Array(5)].map((_, i) => (\n              <Star key={i} className=\"w-7 h-7 fill-amber-400 text-amber-400\" aria-hidden />\n            ))}\n          </div>\n          <p className=\"text-2xl sm:text-3xl font-bold text-white mb-1\">\n            4.9 / 5.0 tlagos rtkels\n          </p>\n          <p className=\"text-sm sm:text-base text-white/75\">\n            12,487 vals vlemny alapjn\n          </p>\n        </div>\n      </div>\n    </section>\n  );\n};\n\n/**\n * Live Product Showcase with Swipeable Carousel\n * - Random products on each load\n * - Touch swipe support for mobile\n * - Arrow navigation for desktop\n * - Compact mobile cards\n */\nconst SECTION_ID = 'customer-favorites';\n\nexport const LiveShowcase = ({ products = [], onProductClick, rotationTick = 0 }) => {\n  const [seed, setSeed] = useState(0);\n  const [isInteracting, setIsInteracting] = useState(false);\n  const [isInView, setIsInView] = useState(true);\n  const sectionRef = useRef(null);\n\n  // Randomize and select products on each render\n  const showcaseProducts = React.useMemo(() => {\n    if (products.length > 0) {\n      const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true));\n      const shuffled = [...inStock].sort(() => (seed % 2 === 0 ? 1 : -1) * (Math.random() - 0.5));\n      return shuffled.slice(0, 12);\n    }\n    return [];\n  }, [products, seed]);\n\n  useEffect(() => {\n    trackSectionEvent(SECTION_ID, 'section_impression');\n  }, []);\n\n  useEffect(() => {\n    if (!rotationTick || isInView || isInteracting) return;\n    setSeed((v) => v + 1);\n  }, [rotationTick, isInView, isInteracting]);\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!sectionRef.current || !(sectionRef.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        setIsInView(entry.isIntersecting);\n      },\n      { threshold: 0.15 }\n    );\n    try {\n      observer.observe(sectionRef.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, []);\n\n  return (\n    <div\n      ref={sectionRef}\n      className=\"section-shell section-world section-world--favorites py-8 sm:py-10 lg:py-14 xl:py-16 overflow-hidden\"\n      role=\"region\"\n      aria-label=\"Vsrlink kedvencei\"\n      data-section={SECTION_ID}\n    >\n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16\">\n        <div className=\"section-frame\">\n          <SectionHeader\n            id=\"customer-favorites-heading\"\n            title=\"Vsrlink kedvencei\"\n            subtitle=\"A legjobbra rtkelt s legtbbet vlasztott btorok\"\n            Icon={Heart}\n            accentClass=\"from-pink-500 to-rose-600\"\n            eyebrow=\"Kzssgi kedvencek\"\n            badge=\"Kznsgkedvenc\"\n            prominent\n            className=\"border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites\"\n            meta={`sszesen: ${showcaseProducts.length.toLocaleString('hu-HU')} termk`}\n            helpText=\"Csak kszleten lv termkek\"\n            actions={\n              <button\n                type=\"button\"\n                onClick={() => setSeed((v) => v + 1)}\n                className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                Frisstem\n              </button>\n            }\n          />\n          {showcaseProducts.length > 0 ? (\n            <ProductCarousel className=\"mt-2\" onInteractionChange={setIsInteracting}>\n              {showcaseProducts.map((product, index) => {\n                const stockLevel = getStockLevel(product);\n                const highlightBadge = stockLevel !== null && stockLevel <= 3 ? `Utols ${stockLevel} db` : '';\n                return (\n                  <EnhancedProductCard\n                    key={product.id || index}\n                    product={product}\n                    onQuickView={onProductClick}\n                    index={index}\n                    highlightBadge={highlightBadge}\n                    sectionId={SECTION_ID}\n                    showFeedback\n                    size=\"compact\"\n                    tone=\"favorites\"\n                  />\n                );\n              })}\n            </ProductCarousel>\n          ) : (\n            <div className=\"text-center py-12 bg-white rounded-2xl shadow-inner\">\n              <Heart className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n              <p className=\"text-gray-500\">Nincs elg adat a kedvencekhez</p>\n              <p className=\"text-gray-400 text-sm\">Trj vissza ksbb!</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Interactive CTA Section\n */\nexport const InteractiveCTA = ({ onGetStarted }) => {\n  return (\n    <section className=\"py-24 bg-gradient-to-br from-primary-500 to-secondary-700 relative overflow-hidden\">\n      <div className=\"absolute inset-0 opacity-10\" aria-hidden>\n        <div className=\"absolute top-0 left-0 w-96 h-96 bg-white rounded-full filter blur-[120px] animate-blob motion-reduce:animate-none\" />\n        <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-yellow-200 rounded-full filter blur-[120px] animate-blob animation-delay-2000 motion-reduce:animate-none\" />\n      </div>\n\n      <div className=\"relative z-10 w-full max-w-3xl mx-auto px-4 sm:px-6 lg:px-16 text-center\">\n        <div className=\"inline-flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full mb-8\">\n          <Sparkles className=\"w-5 h-5 text-white\" aria-hidden />\n          <span className=\"text-xs font-bold text-white uppercase tracking-wider\">Kezdd el</span>\n        </div>\n\n        <h2 className=\"text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight\">\n          Kszen llsz a tkletes btor megtallsra?\n        </h2>\n\n        <p className=\"text-lg text-white/90 mb-10\">\n          Csatlakozz 50.000+ elgedett vsrlnkhoz\n        </p>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n          <button\n            type=\"button\"\n            onClick={onGetStarted}\n            className=\"group w-full sm:w-auto min-h-[48px] px-8 py-4 bg-white text-primary-600 rounded-xl font-semibold text-base shadow-2xl hover:shadow-white/30 hover:-translate-y-0.5 active:scale-[0.98] transition-all duration-200 flex items-center justify-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2\"\n            aria-label=\"Bngszs indtsa\"\n          >\n            Bngszem a termkeket\n            <ArrowRight className=\"w-5 h-5 group-hover:translate-x-1 transition-transform duration-200\" aria-hidden />\n          </button>\n        </div>\n      </div>\n    </section>\n  );\n};\n\nexport default { SocialProof, LiveShowcase, InteractiveCTA };\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { Sparkles, ThumbsUp, ThumbsDown, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\nimport { \n  getSimilarProducts, \n  likeProduct, \n  dislikeProduct, \n  isProductLiked,\n  getDislikedProducts \n} from '../../services/userPreferencesService';\n\n/**\n * AI-Powered Similar Products Recommendation\n * Uses user preferences and AI for personalized recommendations\n */\nexport const SimilarProducts = ({ \n  currentProduct, \n  allProducts, \n  onToggleWishlist, \n  wishlist = [], \n  onQuickView,\n  onAddToCart,\n  maxResults = 4 \n}) => {\n  const [similarProducts, setSimilarProducts] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [aiReason, setAiReason] = useState('');\n\n  const findBasicSimilar = useCallback(() => {\n    if (!currentProduct || !allProducts?.length) return [];\n    const price = currentProduct.salePrice || currentProduct.price || 0;\n    const priceRange = price * 0.4;\n    const dislikedIds = getDislikedProducts();\n    return allProducts\n      .filter(p =>\n        p.id !== currentProduct.id &&\n        !dislikedIds.includes(p.id) &&\n        (p.category || '').includes((currentProduct.category || '').split(' > ')[0]) &&\n        Math.abs((p.salePrice || p.price || 0) - price) <= priceRange\n      )\n      .sort(() => Math.random() - 0.5)\n      .slice(0, maxResults);\n  }, [currentProduct, allProducts, maxResults]);\n\n  const findSimilarProducts = useCallback(async () => {\n    setIsLoading(true);\n    setAiReason('');\n\n    try {\n      // Elszr prbljuk a userPreferencesService-t (gyors, loklis)\n      const localSimilar = getSimilarProducts(currentProduct, allProducts, maxResults + 4);\n      \n      if (localSimilar.length >= maxResults) {\n        // Van elg loklis tallat\n        setSimilarProducts(localSimilar.slice(0, maxResults));\n        setAiReason('Szemlyre szabott ajnls a bngszsi elzmnyek alapjn');\n        setIsLoading(false);\n        return;\n      }\n\n      // Ha kevs loklis tallat van, krjnk AI-tl is segtsget\n      const productContext = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .slice(0, 30)\n        .map(p => `${p.name} (${p.category}) - ${(p.salePrice || p.price || 0).toLocaleString('hu-HU')} Ft`)\n        .join('\\n');\n\n      const prompt = `A vsrl pp ezt nzi: \"${currentProduct.name}\" (${currentProduct.category})\nr: ${(currentProduct.salePrice || currentProduct.price || 0).toLocaleString('hu-HU')} Ft\n\nElrhet termkek:\n${productContext}\n\nAjnlj 4 hasonl termket ami illik hozz! \nVlaszolj egyetlen mondatban, hogy MIRT passzolnak ezek.\nCsak az indoklst rd meg, ne a termkneveket!`;\n\n      const { generateText } = await import('../../services/geminiService');\n      const result = await generateText(prompt, { temperature: 0.7, maxTokens: 100 });\n      \n      if (result.success && result.text) {\n        setAiReason(result.text);\n      }\n\n      // Kombinljuk a loklis s egyszer hasonlsgot\n      const combined = localSimilar.length > 0 \n        ? localSimilar \n        : findBasicSimilar();\n      \n      setSimilarProducts(combined.slice(0, maxResults));\n\n    } catch (error) {\n      console.warn('Similar products error:', error);\n      setSimilarProducts(findBasicSimilar());\n    } finally {\n      setIsLoading(false);\n    }\n  }, [currentProduct, allProducts, maxResults, findBasicSimilar]);\n\n  useEffect(() => {\n    if (currentProduct && allProducts.length > 0) {\n      findSimilarProducts();\n    }\n  }, [currentProduct, allProducts, findSimilarProducts]);\n\n  // Feedback kezels\n  const handleLike = (productId) => {\n    likeProduct(productId);\n  };\n\n  const handleDislike = (productId) => {\n    dislikeProduct(productId);\n    // Eltvoltjuk a listbl\n    setSimilarProducts(prev => prev.filter(p => p.id !== productId));\n  };\n\n  if (similarProducts.length === 0 && !isLoading) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gradient-to-br from-secondary-50 to-primary-50 py-8 sm:py-12 px-4 sm:px-6 lg:px-8 my-8 sm:my-16 rounded-2xl sm:rounded-3xl\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 sm:mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-primary-500\" />\n              <h2 className=\"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900\">\n                Neked ajnljuk\n              </h2>\n            </div>\n            {aiReason && (\n              <p className=\"text-sm sm:text-base text-gray-600 max-w-xl\">\n                {aiReason}\n              </p>\n            )}\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"flex items-center gap-3 text-primary-500\">\n              <Sparkles className=\"w-6 h-6 animate-pulse\" />\n              <span className=\"text-base sm:text-lg font-medium\">Szemlyre szabott ajnls kszl...</span>\n            </div>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6\">\n            {similarProducts.map((product, index) => (\n              <div key={product.id} className=\"relative group\">\n                <EnhancedProductCard\n                  product={product}\n                  onToggleWishlist={onToggleWishlist}\n                  isWishlisted={wishlist.includes(product.id)}\n                  onQuickView={onQuickView}\n                  onAddToCart={onAddToCart}\n                  showBadges={false}\n                  index={index}\n                />\n                \n                {/* Feedback buttons */}\n                <div className=\"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleLike(product.id); }}\n                    className={`p-1.5 rounded-full bg-white shadow-sm ${isProductLiked(product.id) ? 'text-green-600' : 'text-gray-400 hover:text-green-600'} transition-colors`}\n                    title=\"Tetszik\"\n                  >\n                    <ThumbsUp className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); handleDislike(product.id); }}\n                    className=\"p-1.5 rounded-full bg-white shadow-sm text-gray-400 hover:text-red-600 transition-colors\"\n                    title=\"Nem tetszik\"\n                  >\n                    <ThumbsDown className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import React, { useEffect, useState } from 'react';\nimport { Clock, ArrowRight } from 'lucide-react';\nimport { EnhancedProductCard } from './EnhancedProductCard';\n\n/**\n * Recently Viewed Products - Tracks and displays user's browsing history\n */\nexport const RecentlyViewed = ({ \n  onToggleWishlist, \n  wishlist, \n  onQuickView,\n  onAddToCart,\n  maxItems = 4 \n}) => {\n  const [recentProducts, setRecentProducts] = useState([]);\n\n  useEffect(() => {\n    // Load from localStorage\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    setRecentProducts(recent.slice(0, maxItems));\n\n    // Listen for storage changes (when new product is viewed)\n    const handleStorageChange = () => {\n      const updated = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n      setRecentProducts(updated.slice(0, maxItems));\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    window.addEventListener('recently-viewed-updated', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n      window.removeEventListener('recently-viewed-updated', handleStorageChange);\n    };\n  }, [maxItems]);\n\n  if (recentProducts.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 my-16\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Clock className=\"w-6 h-6 text-gray-600\" />\n              <h2 className=\"text-2xl sm:text-3xl font-bold text-gray-900\">\n                Utoljra megtekintett\n              </h2>\n            </div>\n            <p className=\"text-gray-600\">\n              Bngssz vissza a nemrg nzett termkek kztt\n            </p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {recentProducts.map(product => (\n            <EnhancedProductCard\n              key={product.id}\n              product={product}\n              onToggleWishlist={onToggleWishlist}\n              isWishlisted={wishlist.includes(product.id)}\n              onQuickView={onQuickView}\n              onAddToCart={onAddToCart}\n              showBadges={false}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * Utility function to track viewed products\n * Call this when a product is viewed (e.g., in ProductModal)\n */\nexport const trackProductView = (product) => {\n  try {\n    const recent = JSON.parse(localStorage.getItem('recently_viewed') || '[]');\n    \n    // Remove if already exists\n    const filtered = recent.filter(p => p.id !== product.id);\n    \n    // Add to beginning\n    const updated = [product, ...filtered].slice(0, 10); // Keep max 10\n    \n    localStorage.setItem('recently_viewed', JSON.stringify(updated));\n    \n    // Dispatch custom event\n    window.dispatchEvent(new Event('recently-viewed-updated'));\n  } catch (error) {\n    console.error('Error tracking product view:', error);\n  }\n};\n","import React, { useState } from 'react';\nimport { X, Check, ArrowLeftRight, Plus } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice, PLACEHOLDER_IMAGE } from '../../utils/helpers';\n\n/**\n * Product Comparison Tool\n */\nexport const ProductComparison = ({ \n  comparisonList = [], \n  onRemove, \n  onClear,\n  onAddMore \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  useScrollLock(isExpanded);\n\n  if (comparisonList.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Floating Comparison Button - mobile aware of 40px UNAS bottom nav */}\n      <button\n        onClick={() => setIsExpanded(true)}\n        className=\"fixed bottom-[calc(1.5rem+44px)] md:bottom-6 left-4 md:left-auto md:right-6 z-40 bg-primary-500 text-white px-4 md:px-6 py-2.5 md:py-3 rounded-full shadow-2xl hover:bg-primary-600 transition-all flex items-center gap-2 hover:scale-105 transform text-sm md:text-base\"\n      >\n        <ArrowLeftRight className=\"w-4 h-4 md:w-5 md:h-5\" />\n        <span className=\"font-bold\">sszehasonlts ({comparisonList.length})</span>\n      </button>\n\n      {/* Comparison Modal */}\n      {isExpanded && (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in\" onClick={() => setIsExpanded(false)}>\n          <div className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col\" onClick={e => e.stopPropagation()}>\n            {/* Header */}\n            <div className=\"p-6 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-primary-50 to-secondary-50\">\n              <div>\n                <h2 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\n                  <ArrowLeftRight className=\"w-6 h-6 text-primary-500\" />\n                  Termkek sszehasonltsa\n                </h2>\n                <p className=\"text-sm text-gray-600 mt-1\">\n                  {comparisonList.length} termk kivlasztva\n                </p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={onClear}\n                  className=\"px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-xl transition-colors font-medium\"\n                >\n                  sszes trlse\n                </button>\n                <button\n                  onClick={() => setIsExpanded(false)}\n                  className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Comparison Table */}\n            <div className=\"flex-1 overflow-auto p-6\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {comparisonList.map((product) => (\n                  <div key={product.id} className=\"border border-gray-200 rounded-2xl overflow-hidden hover:shadow-lg transition-shadow relative\">\n                    {/* Remove button */}\n                    <button\n                      onClick={() => onRemove(product.id)}\n                      className=\"absolute top-3 right-3 z-10 bg-white/90 p-1.5 rounded-full shadow-md hover:bg-red-50 hover:text-red-600 transition-colors\"\n                    >\n                      <X className=\"w-4 h-4\" />\n                    </button>\n\n                    {/* Image */}\n                    <div className=\"h-48 bg-gray-50 flex items-center justify-center p-4\">\n                      <img\n                        src={product.images?.[0] || PLACEHOLDER_IMAGE}\n                        alt={product.name}\n                        className=\"max-h-full max-w-full object-contain\"\n                        onError={(e) => {e.target.src = PLACEHOLDER_IMAGE}}\n                      />\n                    </div>\n\n                    {/* Details */}\n                    <div className=\"p-4 space-y-3\">\n                      <h3 className=\"font-bold text-lg text-gray-900 line-clamp-2\">{product.name}</h3>\n                      \n                      <div className=\"space-y-2 text-sm\">\n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">r:</span>\n                          <span className=\"font-bold text-primary-500 text-lg\">{formatPrice(product.price)}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kategria:</span>\n                          <span className=\"font-medium text-gray-900\">{product.category}</span>\n                        </div>\n                        \n                        <div className=\"flex justify-between items-center py-2 border-b border-gray-100\">\n                          <span className=\"text-gray-600\">Kszlet:</span>\n                          <span className={`font-medium ${product.inStock ? 'text-green-600' : 'text-red-600'}`}>\n                            {product.inStock ? 'Raktron' : 'Nincs raktron'}\n                          </span>\n                        </div>\n\n                        {product.params && (\n                          <div className=\"pt-2\">\n                            <span className=\"text-gray-600 text-xs block mb-1\">Paramterek:</span>\n                            <p className=\"text-gray-700 text-xs line-clamp-3\">{product.params}</p>\n                          </div>\n                        )}\n                      </div>\n\n                      <a\n                        href={product.link}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"block w-full bg-primary-500 text-white py-2 rounded-xl text-center font-bold hover:bg-primary-600 transition-colors text-sm mt-4\"\n                      >\n                        Megveszem\n                      </a>\n                    </div>\n                  </div>\n                ))}\n\n                {/* Add More */}\n                {comparisonList.length < 6 && (\n                  <div\n                    onClick={() => {\n                      setIsExpanded(false);\n                      onAddMore?.();\n                    }}\n                    className=\"border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center p-8 hover:border-primary-400 hover:bg-primary-50 transition-all cursor-pointer\"\n                  >\n                    <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                      <Plus className=\"w-8 h-8 text-gray-400\" />\n                    </div>\n                    <p className=\"text-gray-600 font-medium\">Mg tbb termk</p>\n                    <p className=\"text-gray-400 text-sm mt-1\">Max. 6 termk</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Comparison Toggle Button for Product Cards\n */\nexport const ComparisonToggle = ({ product, isInComparison, onToggle }) => {\n  return (\n    <button\n      onClick={(e) => {\n        e.stopPropagation();\n        onToggle(product);\n      }}\n      className={`p-2 rounded-full shadow-md transition-all transform hover:scale-110 ${\n        isInComparison\n          ? 'bg-primary-500 text-white'\n          : 'bg-white text-gray-600 hover:bg-primary-50 hover:text-primary-500'\n      }`}\n      title={isInComparison ? 'Eltvolts az sszehasonltsbl' : 'Hozzads az sszehasonltshoz'}\n    >\n      <ArrowLeftRight className=\"w-4 h-4\" />\n    </button>\n  );\n};\n\n/**\n * Hook for managing comparison list\n */\nexport const useComparison = () => {\n  const [comparisonList, setComparisonList] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem('comparison_list') || '[]');\n    } catch {\n      return [];\n    }\n  });\n\n  const addToComparison = (product) => {\n    if (comparisonList.length >= 6) {\n      return { success: false, message: 'Maximum 6 termk hasonlthat ssze' };\n    }\n    \n    if (comparisonList.find(p => p.id === product.id)) {\n      return { success: false, message: 'Ez a termk mr az sszehasonltsban van' };\n    }\n\n    const updated = [...comparisonList, product];\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n    return { success: true, message: 'Hozzadva az sszehasonltshoz' };\n  };\n\n  const removeFromComparison = (productId) => {\n    const updated = comparisonList.filter(p => p.id !== productId);\n    setComparisonList(updated);\n    localStorage.setItem('comparison_list', JSON.stringify(updated));\n  };\n\n  const clearComparison = () => {\n    setComparisonList([]);\n    localStorage.removeItem('comparison_list');\n  };\n\n  const toggleComparison = (product) => {\n    const exists = comparisonList.find(p => p.id === product.id);\n    if (exists) {\n      removeFromComparison(product.id);\n      return { success: true, message: 'Eltvoltva az sszehasonltsbl', action: 'removed' };\n    } else {\n      return { ...addToComparison(product), action: 'added' };\n    }\n  };\n\n  const isInComparison = (productId) => {\n    return comparisonList.some(p => p.id === productId);\n  };\n\n  return {\n    comparisonList,\n    addToComparison,\n    removeFromComparison,\n    clearComparison,\n    toggleComparison,\n    isInComparison\n  };\n};\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Filter, X, DollarSign, Package, Tag } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * Shared filter panel content (controlled). Used in desktop dropdown and mobile BottomSheet.\n * products, filters (from parent), onFilterChange(filters), onApply() when \"Alkalmaz\" is clicked.\n */\nexport const AdvancedFiltersPanel = ({\n  products = [],\n  filters = {},\n  onFilterChange,\n  onApply,\n  showHeader = true,\n  onCloseHeader\n}) => {\n  const priceRange = useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity, max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  const categories = useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  const effective = useMemo(() => ({\n    priceMin: filters.priceMin ?? priceRange.min,\n    priceMax: filters.priceMax ?? priceRange.max,\n    inStockOnly: filters.inStockOnly ?? false,\n    categories: Array.isArray(filters.categories) ? filters.categories : []\n  }), [filters, priceRange]);\n\n  const previousFiltersRef = React.useRef(null);\n  const [hasRestorableFilters, setHasRestorableFilters] = useState(false);\n\n  const handlePriceChange = (type, value) => {\n    const v = parseInt(value, 10);\n    if (Number.isNaN(v)) return;\n    onFilterChange?.({ ...effective, [type]: v });\n  };\n\n  const toggleCategory = (cat) => {\n    const next = effective.categories.includes(cat)\n      ? effective.categories.filter(c => c !== cat)\n      : [...effective.categories, cat];\n    onFilterChange?.({ ...effective, categories: next });\n  };\n\n  const clearFilters = () => {\n    previousFiltersRef.current = { ...effective };\n    setHasRestorableFilters(true);\n    onFilterChange?.({\n      priceMin: priceRange.min,\n      priceMax: priceRange.max,\n      inStockOnly: false,\n      categories: []\n    });\n  };\n\n  const restorePrevious = () => {\n    if (previousFiltersRef.current) {\n      onFilterChange?.(previousFiltersRef.current);\n      previousFiltersRef.current = null;\n      setHasRestorableFilters(false);\n    }\n  };\n\n  const activeCount = [\n    effective.inStockOnly,\n    effective.categories.length > 0,\n    effective.priceMin > priceRange.min,\n    effective.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  return (\n    <>\n      {showHeader && (\n        <div className=\"p-4 border-b border-gray-200 flex justify-between items-center shrink-0\">\n          <h3 className=\"font-bold text-lg flex items-center gap-2\">\n            <Filter className=\"w-5 h-5 text-primary-500\" />\n            Szrk\n          </h3>\n          {onCloseHeader && (\n            <button type=\"button\" onClick={onCloseHeader} className=\"p-2 min-w-[44px] min-h-[44px] flex items-center justify-center hover:bg-gray-100 rounded-lg transition-colors\" aria-label=\"Szrk bezrsa\">\n              <X className=\"w-5 h-5 text-gray-600\" />\n            </button>\n          )}\n        </div>\n      )}\n      <div className=\"p-4 space-y-6 max-h-[60vh] md:max-h-96 overflow-y-auto custom-scrollbar flex-1 min-h-0\">\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-3\">\n            <DollarSign className=\"w-4 h-4\" />\n            r tartomny\n          </label>\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"text-xs text-gray-600\">Minimum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMin} onChange={(e) => handlePriceChange('priceMin', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMin)}</div>\n            </div>\n            <div>\n              <label className=\"text-xs text-gray-600\">Maximum</label>\n              <input type=\"range\" min={priceRange.min} max={priceRange.max} step=\"5000\" value={effective.priceMax} onChange={(e) => handlePriceChange('priceMax', e.target.value)} className=\"w-full\" />\n              <div className=\"text-sm font-medium text-gray-900\">{formatPrice(effective.priceMax)}</div>\n            </div>\n          </div>\n        </div>\n        <div>\n          <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n            <Package className=\"w-4 h-4\" />\n            Kszlet\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input type=\"checkbox\" checked={effective.inStockOnly} onChange={(e) => onFilterChange?.({ ...effective, inStockOnly: e.target.checked })} className=\"w-4 h-4 text-primary-500 rounded\" />\n            <span className=\"text-sm text-gray-700\">Csak raktron lv termkek</span>\n          </label>\n        </div>\n        {categories.length > 0 && (\n          <div>\n            <label className=\"flex items-center gap-2 text-sm font-bold text-gray-700 mb-2\">\n              <Tag className=\"w-4 h-4\" />\n              Kategrik\n            </label>\n            <div className=\"space-y-1 max-h-40 overflow-y-auto\">\n              {categories.map(cat => (\n                <label key={cat} className=\"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded\">\n                  <input type=\"checkbox\" checked={effective.categories.includes(cat)} onChange={() => toggleCategory(cat)} className=\"w-4 h-4 text-primary-500 rounded\" />\n                  <span className=\"text-sm text-gray-700\">{cat}</span>\n                </label>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n      <div className=\"p-4 border-t border-gray-200 flex flex-wrap gap-2 shrink-0\">\n        <button type=\"button\" onClick={clearFilters} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-gray-300 rounded-xl text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors\">Trls</button>\n        {hasRestorableFilters && (\n          <button type=\"button\" onClick={restorePrevious} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] border border-primary-300 rounded-xl text-sm font-medium text-primary-600 hover:bg-primary-50 transition-colors\">Visszallts</button>\n        )}\n        <button type=\"button\" onClick={onApply} className=\"flex-1 min-w-[80px] px-4 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl text-sm font-bold hover:bg-primary-600 transition-colors\">Alkalmaz</button>\n      </div>\n    </>\n  );\n};\n\n/**\n * Advanced Filters (desktop: button + dropdown)\n */\nexport const AdvancedFilters = ({ \n  products = [],\n  onFilterChange,\n  initialFilters = {}\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  useScrollLock(isOpen);\n  const [filters, setFilters] = useState({\n    priceMin: initialFilters.priceMin || 0,\n    priceMax: initialFilters.priceMax || 1000000,\n    inStockOnly: initialFilters.inStockOnly || false,\n    categories: initialFilters.categories || [],\n    ...initialFilters\n  });\n\n  // Calculate price range from products (avoid Math.min/max spread  168k args = stack overflow)\n  const priceRange = React.useMemo(() => {\n    if (products.length === 0) return { min: 0, max: 1000000 };\n    let min = Infinity;\n    let max = -Infinity;\n    const cap = Math.min(products.length, 100000);\n    for (let i = 0; i < cap; i++) {\n      const p = products[i].price;\n      if (p < min) min = p;\n      if (p > max) max = p;\n    }\n    return {\n      min: min === Infinity ? 0 : Math.floor(min / 1000) * 1000,\n      max: max === -Infinity ? 1000000 : Math.ceil(max / 1000) * 1000\n    };\n  }, [products]);\n\n  // Get unique categories (limit to 500 to avoid huge lists; sample if needed)\n  const categories = React.useMemo(() => {\n    const seen = new Set();\n    const step = Math.max(1, Math.floor(products.length / 20000));\n    for (let i = 0; i < products.length && seen.size < 500; i += step) {\n      const c = products[i]?.category;\n      if (c) seen.add(c);\n    }\n    return [...seen].sort();\n  }, [products]);\n\n  // Extract colors and materials from params (sample to avoid long loop on 168k)\n  const extractedAttributes = React.useMemo(() => {\n    const colors = new Set();\n    const materials = new Set();\n    const step = Math.max(1, Math.floor(products.length / 5000));\n    for (let i = 0; i < products.length; i += step) {\n      const p = products[i];\n      if (p.params) {\n        const params = p.params.toLowerCase();\n        // Simple extraction - can be enhanced\n        if (params.includes('szn:') || params.includes('szne:')) {\n          const match = params.match(/szn[e]?:\\s*([^,]+)/i);\n          if (match) colors.add(match[1].trim());\n        }\n        if (params.includes('anyag:')) {\n          const match = params.match(/anyag:\\s*([^,]+)/i);\n          if (match) materials.add(match[1].trim());\n        }\n      }\n    }\n\n    return {\n      colors: Array.from(colors).slice(0, 10),\n      materials: Array.from(materials).slice(0, 10)\n    };\n  }, [products]);\n\n  useEffect(() => {\n    onFilterChange?.(filters);\n  }, [filters]);\n\n  const activeFilterCount = [\n    filters.inStockOnly,\n    filters.categories.length > 0,\n    filters.priceMin > priceRange.min,\n    filters.priceMax < priceRange.max\n  ].filter(Boolean).length;\n\n  const panelContent = (\n    <AdvancedFiltersPanel\n      products={products}\n      filters={filters}\n      onFilterChange={(next) => {\n        setFilters(next);\n        onFilterChange?.(next);\n      }}\n      onApply={() => setIsOpen(false)}\n      showHeader={true}\n      onCloseHeader={() => setIsOpen(false)}\n    />\n  );\n\n  return (\n    <>\n      {/* Filter Toggle Button */}\n      <button\n        type=\"button\"\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"relative px-4 py-2 min-h-[44px] border-2 border-gray-200 rounded-xl hover:border-primary-500 transition-all flex items-center gap-2 font-medium\"\n        aria-label=\"Szrk megnyitsa\"\n      >\n        <Filter className=\"w-4 h-4\" />\n        <span>Szrk</span>\n        {activeFilterCount > 0 && (\n          <span className=\"absolute -top-2 -right-2 bg-primary-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center\">\n            {activeFilterCount}\n          </span>\n        )}\n      </button>\n\n      {/* Mobile: full-screen overlay + bottom sheet */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-end md:hidden\" role=\"dialog\" aria-label=\"Szrk\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setIsOpen(false)} aria-hidden=\"true\" />\n          <div className=\"relative w-full max-h-[85vh] bg-white rounded-t-2xl shadow-2xl flex flex-col animate-fade-in-down\">\n            {panelContent}\n          </div>\n        </div>\n      )}\n\n      {/* Desktop: dropdown panel */}\n      {isOpen && (\n        <div className=\"hidden md:block absolute top-full right-0 mt-2 w-80 bg-white rounded-2xl shadow-2xl border border-gray-200 z-50 animate-fade-in-down\">\n          {panelContent}\n        </div>\n      )}\n    </>\n  );\n};\n\n/**\n * Apply filters to product list\n */\nexport const applyFilters = (products, filters) => {\n  return products.filter(product => {\n    // Price filter\n    if (product.price < filters.priceMin || product.price > filters.priceMax) {\n      return false;\n    }\n\n    // Stock filter (support both inStock and in_stock)\n    if (filters.inStockOnly && !(product.inStock ?? product.in_stock)) {\n      return false;\n    }\n\n    // Category filter\n    if (filters.categories.length > 0 && !filters.categories.includes(product.category)) {\n      return false;\n    }\n\n    return true;\n  });\n};\n","import React, { useState } from 'react';\nimport { ShoppingCart, Check, Loader2 } from 'lucide-react';\n\n/**\n * QuickAddToCart - One-click add to cart with visual feedback\n * Uses CSS transitions instead of framer-motion\n */\nconst QuickAddToCart = ({ product, onAdd, className = '' }) => {\n  const [isAdding, setIsAdding] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  const handleQuickAdd = async (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (window.navigator?.vibrate) {\n      window.navigator.vibrate(50);\n    }\n\n    setIsAdding(true);\n\n    try {\n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      if (onAdd) {\n        await onAdd(product);\n      }\n\n      setShowSuccess(true);\n      \n      setTimeout(() => {\n        setShowSuccess(false);\n        setIsAdding(false);\n      }, 2000);\n\n    } catch (error) {\n      setIsAdding(false);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleQuickAdd}\n      disabled={isAdding || showSuccess}\n      className={`\n        relative overflow-hidden\n        flex items-center justify-center gap-2\n        px-4 py-2 rounded-lg\n        font-medium text-sm\n        transition-all duration-200\n        transform hover:scale-105 active:scale-95\n        ${showSuccess \n          ? 'bg-green-500 text-white' \n          : 'bg-primary-500 text-white hover:bg-primary-600'\n        }\n        disabled:opacity-80\n        ${className}\n      `}\n    >\n      {isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n          <span>Hozzads...</span>\n        </span>\n      )}\n\n      {showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <Check className=\"w-4 h-4\" />\n          <span>Hozzadva!</span>\n        </span>\n      )}\n\n      {!isAdding && !showSuccess && (\n        <span className=\"flex items-center gap-2\">\n          <ShoppingCart className=\"w-4 h-4\" />\n          <span>Kosrba</span>\n        </span>\n      )}\n    </button>\n  );\n};\n\nexport default QuickAddToCart;\n","import React, { useState, useEffect } from 'react';\nimport { X, ShoppingCart, Heart, Share2, ExternalLink, Sparkles, Bell } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport QuickAddToCart from './QuickAddToCart';\nimport { PLACEHOLDER_IMAGE, formatPrice } from '../../utils/helpers';\nimport { getOptimizedImageProps } from '../../utils/imageOptimizer';\nimport {\n  requestBackInStock,\n  toggleLikeProduct,\n  toggleDislikeProduct,\n  isProductLiked,\n  isProductDisliked\n} from '../../services/userPreferencesService';\n\n/**\n * ProductQuickPeek - Hover/click modal for quick product preview\n * Shows essential info without full page navigation\n */\nconst ProductQuickPeek = ({ product, isOpen, onClose, onAddToCart }) => {\n  const [imageLoaded, setImageLoaded] = useState(false);\n  const [activeImage, setActiveImage] = useState(0);\n  const [feedbackState, setFeedbackState] = useState(() => ({\n    liked: isProductLiked(product?.id),\n    disliked: isProductDisliked(product?.id)\n  }));\n\n  useScrollLock(isOpen);\n\n  useEffect(() => {\n    if (isOpen) {\n      setImageLoaded(false);\n      setActiveImage(0);\n      setFeedbackState({\n        liked: isProductLiked(product?.id),\n        disliked: isProductDisliked(product?.id)\n      });\n    }\n  }, [isOpen]);\n\n  if (!product) return null;\n\n  // Parse product images (array or single)\n  const images = Array.isArray(product.images) && product.images.length > 0\n    ? product.images\n    : product.image ? [product.image] : [];\n  const imageProps = getOptimizedImageProps(images[activeImage] || product.image || PLACEHOLDER_IMAGE, product.name, { responsive: true, lazy: false });\n  \n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Wrapper: always center modal on screen (safe area for mobile) */}\n          <div className=\"fixed inset-0 lg:top-[60px] flex items-center justify-center p-4 z-[9999] pointer-events-none overflow-y-auto\">\n            {/* Modal: centered, scrolls on small screens */}\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.9, y: 20 }}\n              transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n              className=\"w-full max-w-4xl max-h-[90vh] my-auto pointer-events-auto flex flex-col\"\n            >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] min-h-0\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-primary-50 to-secondary-50\">\n                <div className=\"flex items-center gap-2\">\n                  <Sparkles className=\"w-5 h-5 text-primary-500\" />\n                  <h3 className=\"text-lg font-bold text-gray-900\">Gyors elnzet</h3>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={onClose}\n                  className=\"p-2 min-h-[44px] min-w-[44px] flex items-center justify-center hover:bg-white rounded-lg transition-colors\"\n                  aria-label=\"Bezrs\"\n                >\n                  <X className=\"w-5 h-5 text-gray-600\" />\n                </button>\n              </div>\n\n              {/* Content: scrollable, keeps modal centered */}\n              <div className=\"flex-1 min-h-0 overflow-y-auto\">\n                <div className=\"grid md:grid-cols-2 gap-6 p-6\">\n                  {/* Left: Image */}\n                  <div className=\"space-y-4\">\n                    <div className=\"relative aspect-square bg-gray-100 rounded-xl overflow-hidden group\">\n                      <img\n                        src={imageProps.src || (images[activeImage] || product.image || PLACEHOLDER_IMAGE)}\n                        alt={product.name}\n                        onLoad={() => setImageLoaded(true)}\n                        className={`\n                          w-full h-full object-cover\n                          transition-all duration-300\n                          ${imageLoaded ? 'opacity-100 scale-100' : 'opacity-0 scale-105'}\n                        `}\n                        srcSet={imageProps.srcSet}\n                        sizes={imageProps.sizes}\n                      />\n                      \n                      {!imageLoaded && (\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                          <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                        </div>\n                      )}\n\n                      {/* Quick View Badge */}\n                      <div className=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium text-primary-500\">\n                        Gyors elnzet\n                      </div>\n                    </div>\n\n                    {/* Additional images thumbnails (if any) */}\n                    {images.length > 1 && (\n                      <div className=\"flex gap-2 overflow-x-auto\">\n                        {images.map((img, idx) => (\n                          <button\n                            key={idx}\n                            onClick={() => setActiveImage(idx)}\n                            className={`\n                              flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                              ${activeImage === idx ? 'border-primary-500 scale-110' : 'border-gray-200 hover:border-primary-300'}\n                            `}\n                          >\n                            <img src={img} alt={`${product.name} ${idx + 1}`} className=\"w-full h-full object-cover\" />\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Right: Info */}\n                  <div className=\"flex flex-col gap-4\">\n                    {/* Category */}\n                    <div className=\"inline-flex items-center gap-2 text-sm text-primary-500 font-medium\">\n                      <span>{product.category}</span>\n                    </div>\n\n                    {/* Title */}\n                    <h2 className=\"text-2xl font-bold text-gray-900 leading-tight\">\n                      {product.name}\n                    </h2>\n\n                    {/* Price */}\n                    <div className=\"flex items-baseline gap-2\">\n                      <span className=\"text-3xl font-bold text-primary-500\">\n                        {formatPrice(product.price)}\n                      </span>\n                      {product.originalPrice && product.originalPrice > product.price && (\n                        <span className=\"text-lg text-gray-400 line-through\">\n                          {formatPrice(product.originalPrice)}\n                        </span>\n                      )}\n                    </div>\n\n                    {/* Description/Params */}\n                    {product.params && (\n                      <div className=\"prose prose-sm max-w-none text-gray-600\">\n                        <p>{product.params.substring(0, 200)}{product.params.length > 200 ? '...' : ''}</p>\n                      </div>\n                    )}\n\n                    {/* Features/Specs (if available) */}\n                    <div className=\"border-t border-b border-gray-200 py-4 space-y-2\">\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">llapot</span>\n                        <span className={`font-medium ${(product.inStock ?? product.in_stock) ? 'text-green-600' : 'text-red-500'}`}>\n                          {(product.inStock ?? product.in_stock) ? 'Raktron' : 'Kszlethiny'}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">Szllts</span>\n                        <span className=\"font-medium\">2-5 munkanap</span>\n                      </div>\n                    </div>\n\n                    {/* Actions */}\n                    <div className=\"flex gap-3 mt-auto\">\n                      {(product.inStock ?? product.in_stock) ? (\n                        <QuickAddToCart\n                          product={product}\n                          onAdd={onAddToCart}\n                          className=\"flex-1\"\n                        />\n                      ) : (\n                        <button\n                          type=\"button\"\n                          onClick={() => requestBackInStock(product)}\n                          className=\"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg border-2 border-gray-200 text-gray-700 font-semibold hover:bg-gray-50\"\n                        >\n                          <Bell className=\"w-4 h-4\" />\n                          rtestst krek\n                        </button>\n                      )}\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Add to wishlist logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-red-500 hover:text-red-500 transition-colors\"\n                      >\n                        <Heart className=\"w-5 h-5\" />\n                      </button>\n                      \n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          // Share logic\n                        }}\n                        className=\"p-3 border-2 border-gray-200 rounded-lg hover:border-primary-500 hover:text-primary-500 transition-colors\"\n                      >\n                        <Share2 className=\"w-5 h-5\" />\n                      </button>\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleLikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.liked\n                            ? 'bg-green-600 text-white border-green-600'\n                            : 'bg-green-50 text-green-700 border-green-100 hover:bg-green-100'\n                        }`}\n                      >\n                        Tetszik\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          setFeedbackState(toggleDislikeProduct(product));\n                        }}\n                        className={`px-3 py-2 rounded-full text-xs font-semibold border flex items-center gap-1 transition-colors ${\n                          feedbackState.disliked\n                            ? 'bg-gray-900 text-white border-gray-900'\n                            : 'bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100'\n                        }`}\n                      >\n                        Nem tetszik\n                      </button>\n                    </div>\n\n                    {/* Full Details Link */}\n                    <a\n                      href={product.link}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"flex items-center justify-center gap-2 text-sm text-primary-500 hover:text-primary-600 font-medium py-2\"\n                    >\n                      <span>Teljes lers megtekintse</span>\n                      <ExternalLink className=\"w-4 h-4\" />\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </div>\n            </motion.div>\n          </div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default ProductQuickPeek;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { X, Mail, Gift, Sparkles, CheckCircle } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useScrollPosition } from '../../hooks/useScrollPosition';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * SmartNewsletterPopup - Intelligent newsletter popup\n * Shows based on exit intent, time on site, and scroll depth. Uses shared scroll hook.\n */\nconst SmartNewsletterPopup = ({ onSubscribe }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  useScrollLock(isVisible);\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState('');\n  const timeOnSiteRef = useRef(null);\n  const scrollTriggeredRef = useRef(false);\n  const exitIntentRef = useRef(false);\n  const { scrollPercent } = useScrollPosition();\n\n  useEffect(() => {\n    const dismissed = localStorage.getItem('newsletter_dismissed');\n    const subscribed = localStorage.getItem('newsletter_subscribed');\n    if (dismissed || subscribed) return;\n\n    timeOnSiteRef.current = setTimeout(() => {\n      if (!scrollTriggeredRef.current && !exitIntentRef.current) setIsVisible(true);\n    }, 30000);\n\n    const handleMouseLeave = (e) => {\n      if (exitIntentRef.current) return;\n      if (e.clientY <= 0) {\n        exitIntentRef.current = true;\n        if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n        setIsVisible(true);\n      }\n    };\n    document.addEventListener('mouseleave', handleMouseLeave);\n    return () => {\n      if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n      document.removeEventListener('mouseleave', handleMouseLeave);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (scrollPercent > 70 && !scrollTriggeredRef.current) {\n      scrollTriggeredRef.current = true;\n      if (timeOnSiteRef.current) clearTimeout(timeOnSiteRef.current);\n      setIsVisible(true);\n    }\n  }, [scrollPercent]);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    localStorage.setItem('newsletter_dismissed', Date.now().toString());\n    // Show again after 7 days\n    setTimeout(() => {\n      localStorage.removeItem('newsletter_dismissed');\n    }, 7 * 24 * 60 * 60 * 1000);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      setError('Krlek adj meg egy rvnyes email cmet.');\n      return;\n    }\n\n    try {\n      // Here you would send to your newsletter service\n      if (onSubscribe) {\n        await onSubscribe(email);\n      }\n\n      setIsSubmitted(true);\n      localStorage.setItem('newsletter_subscribed', 'true');\n\n      // Close after 3 seconds\n      setTimeout(() => {\n        setIsVisible(false);\n      }, 3000);\n\n    } catch (err) {\n      setError('Hiba trtnt. Prbld jra ksbb!');\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={handleClose}\n            className=\"fixed inset-0 lg:top-[60px] bg-black/50 backdrop-blur-sm z-[9999]\"\n          />\n\n          {/* Popup */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.9, y: 20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[9999] w-[90%] max-w-md\"\n          >\n            <div className=\"bg-white rounded-2xl shadow-2xl overflow-hidden\">\n              {/* Header */}\n              <div className=\"relative bg-gradient-to-br from-primary-500 to-secondary-700 p-8 text-white\">\n                <button\n                  onClick={handleClose}\n                  className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                  aria-label=\"Bezrs\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n\n                <div className=\"flex items-center justify-center mb-4\">\n                  <div className=\"p-4 bg-white/20 backdrop-blur-sm rounded-full\">\n                    <Gift className=\"w-8 h-8\" />\n                  </div>\n                </div>\n\n                <h2 className=\"text-2xl font-bold text-center mb-2\">\n                  {isSubmitted ? 'Ksznjk!' : '10% KEDVEZMNY'}\n                </h2>\n                <p className=\"text-white/90 text-center text-sm\">\n                  {isSubmitted \n                    ? 'Feliratkoztl a hrlevelnkre!' \n                    : 'Iratkozz fel s kapd meg els vsrlsodhoz!'\n                  }\n                </p>\n              </div>\n\n              {/* Content */}\n              <div className=\"p-6\">\n                {!isSubmitted ? (\n                  <form onSubmit={handleSubmit} className=\"space-y-4\">\n                    {/* Benefits */}\n                    <div className=\"space-y-2 mb-4\">\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Exkluzv ajnlatok</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Korai hozzfrs j termkekhez</span>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-700\">\n                        <Sparkles className=\"w-4 h-4 text-primary-500\" />\n                        <span>Lakberendezsi tippek</span>\n                      </div>\n                    </div>\n\n                    {/* Email Input */}\n                    <div>\n                      <div className=\"relative\">\n                        <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                        <input\n                          type=\"email\"\n                          value={email}\n                          onChange={(e) => setEmail(e.target.value)}\n                          placeholder=\"Add meg az email cmed\"\n                          className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 outline-none transition-all\"\n                          required\n                        />\n                      </div>\n                      {error && (\n                        <p className=\"mt-2 text-sm text-red-600\">{error}</p>\n                      )}\n                    </div>\n\n                    {/* Submit Button */}\n                    <button\n                      type=\"submit\"\n                      className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-3 rounded-lg transition-colors shadow-lg hover:shadow-xl\"\n                    >\n                      Feliratkozom!\n                    </button>\n\n                    {/* Privacy Notice */}\n                    <p className=\"text-xs text-gray-500 text-center\">\n                      Adataid biztonsgban vannak. Brmikor leiratkozhatsz.\n                    </p>\n                  </form>\n                ) : (\n                  <div className=\"text-center py-4\">\n                    <motion.div\n                      initial={{ scale: 0 }}\n                      animate={{ scale: 1 }}\n                      transition={{ type: 'spring', damping: 15 }}\n                      className=\"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4\"\n                    >\n                      <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                    </motion.div>\n                    <p className=\"text-gray-700 mb-2\">\n                      <strong>{email}</strong>\n                    </p>\n                    <p className=\"text-sm text-gray-600\">\n                      Nzd meg az email fikod a kedvezmny kdrt!\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default SmartNewsletterPopup;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { X, Gift, Timer, Sparkles, ArrowRight, Mail, Check } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ExitIntentPopup - Shows discount offer when user tries to leave\n * Also includes email capture for future marketing\n */\nconst ExitIntentPopup = ({ discountPercent = 10, onClose }) => {\n  const [isVisible, setIsVisible] = useState(false);\n  useScrollLock(isVisible);\n  const [hasShown, setHasShown] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [countdown, setCountdown] = useState(600); // 10 minutes\n\n  const hasShownRef = useRef(false);\n  hasShownRef.current = hasShown;\n\n  // Exit intent detection\n  useEffect(() => {\n    if (sessionStorage.getItem('exitIntentShown')) return;\n\n    const handleMouseLeave = (e) => {\n      if (e.clientY <= 0 && !hasShownRef.current) {\n        hasShownRef.current = true;\n        setIsVisible(true);\n        setHasShown(true);\n        sessionStorage.setItem('exitIntentShown', 'true');\n      }\n    };\n\n    let inactivityTimer;\n    const resetTimer = () => {\n      clearTimeout(inactivityTimer);\n      inactivityTimer = setTimeout(() => {\n        if (!hasShownRef.current) {\n          hasShownRef.current = true;\n          setIsVisible(true);\n          setHasShown(true);\n          sessionStorage.setItem('exitIntentShown', 'true');\n        }\n      }, 45000);\n    };\n\n    document.addEventListener('mouseleave', handleMouseLeave);\n    document.addEventListener('mousemove', resetTimer);\n    document.addEventListener('click', resetTimer);\n    resetTimer();\n\n    return () => {\n      document.removeEventListener('mouseleave', handleMouseLeave);\n      document.removeEventListener('mousemove', resetTimer);\n      document.removeEventListener('click', resetTimer);\n      clearTimeout(inactivityTimer);\n    };\n  }, []);\n\n  // Countdown timer\n  useEffect(() => {\n    if (!isVisible) return;\n\n    const timer = setInterval(() => {\n      setCountdown(prev => {\n        if (prev <= 1) {\n          clearInterval(timer);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [isVisible]);\n\n  const handleClose = () => {\n    setIsVisible(false);\n    if (onClose) onClose();\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (email) {\n      // In real app: send to backend\n      localStorage.setItem('subscribedEmail', email);\n      setIsSubmitted(true);\n      \n      // Copy discount code\n      navigator.clipboard?.writeText(`MARADJ${discountPercent}`);\n      \n      setTimeout(() => {\n        handleClose();\n      }, 3000);\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-fade-in\"\n      onClick={handleClose}\n    >\n      <div \n        className=\"relative w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden animate-scale-in\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Close button */}\n        <button\n          onClick={handleClose}\n          className=\"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors z-10\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n\n        {/* Decorative top section */}\n        <div className=\"bg-gradient-to-br from-primary-500 via-secondary-700 to-pink-500 p-8 text-center relative overflow-hidden\">\n          {/* Animated background shapes */}\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full animate-blob\" />\n            <div className=\"absolute -bottom-10 -right-10 w-40 h-40 bg-white/10 rounded-full animate-blob animation-delay-2000\" />\n          </div>\n\n          <div className=\"relative\">\n            <div className=\"w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n              <Gift className=\"w-10 h-10 text-white\" />\n            </div>\n            <h2 className=\"text-3xl sm:text-4xl font-bold text-white mb-2\">\n              Vrj! Ne menj el!\n            </h2>\n            <p className=\"text-white/90 text-lg\">\n              Itt egy <span className=\"font-bold text-yellow-300\">{discountPercent}% kedvezmny</span> neked!\n            </p>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 sm:p-8\">\n          {!isSubmitted ? (\n            <>\n              {/* Timer */}\n              <div className=\"flex items-center justify-center gap-2 mb-6 text-red-600\">\n                <Timer className=\"w-5 h-5 animate-pulse\" />\n                <span className=\"font-bold text-lg\">\n                  Az ajnlat lejr: {formatTime(countdown)}\n                </span>\n              </div>\n\n              {/* Discount code */}\n              <div className=\"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-dashed border-amber-300 rounded-xl p-4 mb-6 text-center\">\n                <p className=\"text-sm text-gray-600 mb-1\">Kuponkd:</p>\n                <p className=\"text-2xl font-bold text-amber-600 tracking-wider\">\n                  MARADJ{discountPercent}\n                </p>\n              </div>\n\n              {/* Email form */}\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <p className=\"text-center text-gray-600 text-sm\">\n                  Add meg az email cmed s elkldjk a kuponkdot!\n                </p>\n                \n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-primary-500 focus:ring-2 focus:ring-primary-200 outline-none transition-all text-lg\"\n                    required\n                  />\n                </div>\n\n                <button\n                  type=\"submit\"\n                  className=\"w-full py-4 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-lg rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n                >\n                  <Sparkles className=\"w-5 h-5\" />\n                  Kedvezmny aktivlsa\n                  <ArrowRight className=\"w-5 h-5\" />\n                </button>\n              </form>\n\n              {/* No thanks */}\n              <button\n                onClick={handleClose}\n                className=\"w-full mt-4 py-2 text-gray-500 hover:text-gray-700 text-sm transition-colors\"\n              >\n                Nem, ksznm, inkbb teljes rat fizetek\n              </button>\n            </>\n          ) : (\n            /* Success state */\n            <div className=\"text-center py-8\">\n              <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-10 h-10 text-green-600\" />\n              </div>\n              <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Ksznjk!</h3>\n              <p className=\"text-gray-600 mb-4\">\n                A kuponkd elmentve a vglapra!\n              </p>\n              <div className=\"bg-green-50 border border-green-200 rounded-xl p-4\">\n                <p className=\"text-green-800 font-bold text-xl\">MARADJ{discountPercent}</p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes blob {\n          0%, 100% { transform: translate(0, 0) scale(1); }\n          33% { transform: translate(30px, -50px) scale(1.1); }\n          66% { transform: translate(-20px, 20px) scale(0.9); }\n        }\n        .animate-blob { animation: blob 7s infinite; }\n        .animation-delay-2000 { animation-delay: 2s; }\n        .animate-fade-in { animation: fadeIn 0.3s ease-out; }\n        .animate-scale-in { animation: scaleIn 0.3s ease-out; }\n        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ExitIntentPopup;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Box, Eye, Smartphone, X, AlertCircle } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { motion, AnimatePresence } from 'framer-motion';\n\n/**\n * ARProductPreview - AR (Augmented Reality) product preview\n * Uses WebXR/AR Quick Look for supported devices\n */\nconst ARProductPreview = ({ product, onClose }) => {\n  useScrollLock(true);\n  const [isARAvailable, setIsARAvailable] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    checkARSupport();\n  }, []);\n\n  const checkARSupport = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Check for AR support\n      // WebXR (Android Chrome, Quest)\n      if ('xr' in navigator) {\n        const isSupported = await navigator.xr.isSessionSupported('immersive-ar');\n        setIsARAvailable(isSupported);\n      }\n      // AR Quick Look (iOS Safari)\n      else if (isIOSSafari()) {\n        setIsARAvailable(true);\n      }\n      // Fallback: no AR support\n      else {\n        setIsARAvailable(false);\n        setError('Az eszkzd nem tmogatja az AR megjelentst.');\n      }\n    } catch (err) {\n      setIsARAvailable(false);\n      setError('Nem sikerlt ellenrizni az AR tmogatst.');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const isIOSSafari = () => {\n    const ua = navigator.userAgent;\n    const isIOS = /iPad|iPhone|iPod/.test(ua);\n    const isSafari = /Safari/.test(ua) && !/CriOS|FxiOS|OPiOS|mercury/.test(ua);\n    return isIOS && isSafari;\n  };\n\n  const handleARLaunch = () => {\n    if (!isARAvailable) return;\n\n    // For iOS: AR Quick Look\n    if (isIOSSafari()) {\n      // You would need USDZ file format for iOS AR\n      // Example: product.arModelUSDZ\n      const usdzUrl = product.arModelUSDZ || generateMockUSDZ(product);\n      \n      const anchor = document.createElement('a');\n      anchor.rel = 'ar';\n      anchor.href = usdzUrl;\n      anchor.appendChild(document.createElement('img'));\n      anchor.click();\n    }\n    // For Android: WebXR\n    else if ('xr' in navigator) {\n      launchWebXR();\n    }\n  };\n\n  const sessionEndHandlerRef = useRef(null);\n  const launchWebXR = async () => {\n    try {\n      const session = await navigator.xr.requestSession('immersive-ar', {\n        requiredFeatures: ['hit-test'],\n        optionalFeatures: ['dom-overlay']\n      });\n      const handler = () => { /* Cleanup */ };\n      sessionEndHandlerRef.current = { session, handler };\n      session.addEventListener('end', handler);\n    } catch (err) {\n      setError('Nem sikerlt elindtani az AR nzetet.');\n    }\n  };\n\n  useEffect(() => {\n    return () => {\n      const current = sessionEndHandlerRef.current;\n      if (current?.session && current?.handler) {\n        current.session.removeEventListener('end', current.handler);\n        sessionEndHandlerRef.current = null;\n      }\n    };\n  }, []);\n\n  const generateMockUSDZ = (product) => {\n    // In production, you would have actual 3D models\n    // This is a placeholder that links to a sample USDZ file\n    // You can use services like Sketchfab, poly.google.com (deprecated), or custom 3D models\n    return `https://developer.apple.com/augmented-reality/quick-look/models/biplane/toy_biplane.usdz`;\n  };\n\n  const openInARViewer = () => {\n    // Alternative: Open in a web-based 3D viewer\n    // Using model-viewer web component (Google)\n    window.open(`https://arvr.google.com/scene-viewer?file=${product.arModel || ''}`, '_blank');\n  };\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 lg:top-[60px] bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center p-4\"\n        onClick={onClose}\n      >\n        <motion.div\n          initial={{ scale: 0.9, y: 20 }}\n          animate={{ scale: 1, y: 0 }}\n          exit={{ scale: 0.9, y: 20 }}\n          onClick={(e) => e.stopPropagation()}\n          className=\"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 p-6 text-white relative\">\n            <button\n              onClick={onClose}\n              className=\"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n            \n            <div className=\"flex items-center gap-3 mb-2\">\n              <Box className=\"w-6 h-6\" />\n              <h2 className=\"text-xl font-bold\">AR Elnzet</h2>\n            </div>\n            <p className=\"text-white/90 text-sm\">{product.name}</p>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6\">\n            {isLoading && (\n              <div className=\"text-center py-8\">\n                <div className=\"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n                <p className=\"text-gray-600\">AR kpessgek ellenrzse...</p>\n              </div>\n            )}\n\n            {!isLoading && error && (\n              <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4\">\n                <div className=\"flex items-start gap-3\">\n                  <AlertCircle className=\"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"text-sm text-yellow-800 font-medium mb-2\">{error}</p>\n                    <p className=\"text-xs text-yellow-700\">\n                      Az AR funkci csak iOS Safari vagy Android Chrome bngszben rhet el.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && isARAvailable && (\n              <div className=\"space-y-4\">\n                <div className=\"bg-gradient-to-br from-primary-50 to-secondary-50 rounded-xl p-6 text-center\">\n                  <div className=\"w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg\">\n                    <Eye className=\"w-10 h-10 text-primary-500\" />\n                  </div>\n                  <h3 className=\"font-bold text-gray-900 mb-2\">Nzd meg otthonodban!</h3>\n                  <p className=\"text-sm text-gray-600\">\n                    Helyezd el virtulisan a termket a sajt teremben AR segtsgvel.\n                  </p>\n                </div>\n\n                <button\n                  onClick={handleARLaunch}\n                  className=\"w-full bg-primary-500 hover:bg-primary-600 text-white font-bold py-4 rounded-xl transition-colors shadow-lg flex items-center justify-center gap-2\"\n                >\n                  <Smartphone className=\"w-5 h-5\" />\n                  AR Indtsa\n                </button>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">1</span>\n                    <span>Engedlyezd a kamera hozzfrst</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">2</span>\n                    <span>Clozd meg a padlt a telefonoddal</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                    <span className=\"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-xs\">3</span>\n                    <span>Helyezd el s forgasd a termket</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {!isLoading && !isARAvailable && (\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                  <Smartphone className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <div>\n                  <p className=\"text-gray-600 mb-2\">AR nem elrhet ezen az eszkzn</p>\n                  <p className=\"text-sm text-gray-500\">\n                    Prbld meg iOS Safari vagy Android Chrome bngszbl!\n                  </p>\n                </div>\n                <button\n                  onClick={openInARViewer}\n                  className=\"text-primary-500 hover:text-primary-600 font-medium text-sm\"\n                >\n                  Megnyits web AR nzetben \n                </button>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport default ARProductPreview;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { Sparkles, Plus, ShoppingBag, Check, ChevronRight, Package, Percent } from 'lucide-react';\nimport { formatPriceNumber } from '../../utils/helpers';\n\n/**\n * CompleteTheLook - AI-powered bundle suggestions\n * \"Add hozz ezeket is s kapj kedvezmnyt!\"\n */\nconst CompleteTheLook = ({ currentProduct, allProducts, onAddToCart, onViewProduct }) => {\n  const [bundleItems, setBundleItems] = useState([]);\n  const [selectedItems, setSelectedItems] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [bundleTitle, setBundleTitle] = useState('Tedd teljess a szobt');\n\n  useEffect(() => {\n    if (currentProduct && allProducts?.length > 0) {\n      findComplementaryProducts();\n    }\n  }, [currentProduct, allProducts]);\n\n  const findComplementaryProducts = async () => {\n    setIsLoading(true);\n    \n    try {\n      // Kategria s tpus alap prostsok\n      const complementaryMap = {\n        'kanap': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'polc', 'puff'],\n        'lgarnitra': ['dohnyzasztal', 'fotel', 'lmpa', 'sznyeg', 'tv llvny'],\n        'gy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'tkr', 'szekrny'],\n        'franciagy': ['jjeliszekrny', 'matrac', 'komd', 'lmpa', 'gardrb'],\n        'tkezasztal': ['szk', 'tkez', 'tlal', 'lmpa', 'vitrin'],\n        'asztal': ['szk', 'lmpa', 'polc'],\n        'rasztal': ['forgszk', 'polc', 'lmpa', 'irattart'],\n        'szk': ['asztal', 'tkez'],\n        'fotel': ['dohnyzasztal', 'lmpa', 'puff', 'takar'],\n        'szekrny': ['komd', 'tkr', 'polc'],\n        'tv llvny': ['polc', 'lmpa', 'dohnyzasztal'],\n      };\n\n      const productName = (currentProduct.name || '').toLowerCase();\n      const productCategory = (currentProduct.category || '').toLowerCase();\n      \n      // Keressk meg a megfelel kiegsztket\n      let searchTerms = [];\n      \n      Object.entries(complementaryMap).forEach(([key, complements]) => {\n        if (productName.includes(key) || productCategory.includes(key)) {\n          searchTerms.push(...complements);\n        }\n      });\n\n      // Ha nincs specifikus match, ltalnos kiegsztk\n      if (searchTerms.length === 0) {\n        searchTerms = ['lmpa', 'polc', 'sznyeg', 'dekorci'];\n      }\n\n      // Keress a termkek kztt\n      const currentPrice = currentProduct.salePrice || currentProduct.price || 0;\n      const priceRange = currentPrice * 0.8; // Hasonl rkategria\n      \n      const matches = allProducts\n        .filter(p => {\n          if (p.id === currentProduct.id) return false;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          const pPrice = p.salePrice || p.price || 0;\n          \n          // Ne legyen tl drga\n          if (pPrice > currentPrice * 1.5) return false;\n          \n          // Keressk a kiegsztket\n          return searchTerms.some(term => pName.includes(term) || pCat.includes(term));\n        })\n        .map(p => {\n          let score = 0;\n          const pName = (p.name || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          \n          searchTerms.forEach(term => {\n            if (pName.includes(term)) score += 10;\n            if (pCat.includes(term)) score += 5;\n          });\n          \n          return { product: p, score };\n        })\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 6)\n        .map(m => m.product);\n\n      // Ha van tallat, tegyk be\n      if (matches.length >= 2) {\n        setBundleItems(matches.slice(0, 4));\n        \n        // AI generlt cm\n        const prompt = `rj egy rvid, vonz marketing cmet (max 6 sz) ami arra sztnz, hogy a \"${currentProduct.name}\" mell vegyk meg a kiegsztket is. Magyarul, kreatvan!`;\n        const { generateText } = await import('../../services/geminiService');\n        const result = await generateText(prompt, { temperature: 0.9, maxTokens: 30 });\n        if (result.success && result.text) {\n          setBundleTitle(result.text.replace(/[\"']/g, '').trim());\n        }\n      } else {\n        // Fallback: random npszer termkek\n        const fallbackProducts = allProducts\n          .filter(p => p.id !== currentProduct.id)\n          .sort(() => Math.random() - 0.5)\n          .slice(0, 4);\n        setBundleItems(fallbackProducts);\n      }\n\n    } catch (error) {\n      console.warn('Bundle search error:', error);\n      // Fallback\n      const fallback = allProducts\n        .filter(p => p.id !== currentProduct.id)\n        .sort(() => Math.random() - 0.5)\n        .slice(0, 4);\n      setBundleItems(fallback);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const toggleItem = (productId) => {\n    setSelectedItems(prev => \n      prev.includes(productId) \n        ? prev.filter(id => id !== productId)\n        : [...prev, productId]\n    );\n  };\n\n  const formatPrice = (price) => formatPriceNumber(price);\n\n  // Szmtsok\n  const selectedProducts = bundleItems.filter(p => selectedItems.includes(p.id));\n  const bundleOriginalPrice = selectedProducts.reduce((sum, p) => sum + (p.salePrice || p.price || 0), 0);\n  const bundleDiscount = selectedProducts.length >= 2 ? 0.1 : selectedProducts.length >= 3 ? 0.15 : 0; // 10-15% kedvezmny\n  const bundleFinalPrice = bundleOriginalPrice * (1 - bundleDiscount);\n  const savedAmount = bundleOriginalPrice - bundleFinalPrice;\n\n  const handleAddBundle = () => {\n    selectedProducts.forEach(product => {\n      if (onAddToCart) onAddToCart(product);\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 animate-pulse\">\n        <div className=\"h-6 bg-amber-200/50 rounded w-48 mb-4\" />\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n          {[1,2,3,4].map(i => (\n            <div key={i} className=\"bg-white rounded-xl p-3\">\n              <div className=\"aspect-square bg-amber-100 rounded-lg mb-2\" />\n              <div className=\"h-4 bg-amber-100 rounded w-3/4\" />\n            </div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (bundleItems.length < 2) return null;\n\n  return (\n    <div className=\"bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 rounded-2xl p-5 sm:p-6 border border-amber-200/50 shadow-lg\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-5\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-xl flex items-center justify-center shadow-lg\">\n            <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-gray-900 text-lg sm:text-xl\">{bundleTitle}</h3>\n            <p className=\"text-amber-700 text-sm\">Vlassz kiegsztket s sprolj!</p>\n          </div>\n        </div>\n        \n        {bundleDiscount > 0 && (\n          <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-1 shadow-lg animate-pulse\">\n            <Percent className=\"w-4 h-4\" />\n            -{Math.round(bundleDiscount * 100)}%\n          </div>\n        )}\n      </div>\n\n      {/* Products Grid */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-5\">\n        {bundleItems.map((product) => {\n          const isSelected = selectedItems.includes(product.id);\n          const price = product.salePrice || product.price || 0;\n          \n          return (\n            <button\n              key={product.id}\n              onClick={() => toggleItem(product.id)}\n              className={`\n                relative bg-white rounded-xl p-3 text-left transition-all duration-300\n                ${isSelected \n                  ? 'ring-2 ring-amber-500 shadow-lg scale-[1.02]' \n                  : 'hover:shadow-md hover:scale-[1.01] border border-gray-100'\n                }\n              `}\n            >\n              {/* Selection indicator */}\n              <div className={`\n                absolute -top-2 -right-2 w-6 h-6 rounded-full flex items-center justify-center transition-all\n                ${isSelected \n                  ? 'bg-amber-500 text-white scale-100' \n                  : 'bg-gray-200 text-gray-400 scale-90'\n                }\n              `}>\n                {isSelected ? <Check className=\"w-4 h-4\" /> : <Plus className=\"w-4 h-4\" />}\n              </div>\n\n              {/* Image */}\n              <div className=\"aspect-square bg-gray-50 rounded-lg mb-2 overflow-hidden\">\n                <img\n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-full h-full object-contain hover:scale-110 transition-transform duration-500\"\n                  onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                />\n              </div>\n\n              {/* Info */}\n              <p className=\"text-xs sm:text-sm font-medium text-gray-800 line-clamp-2 mb-1 leading-tight\">\n                {product.name}\n              </p>\n              <p className=\"text-sm sm:text-base font-bold text-amber-600\">\n                {formatPrice(price)} Ft\n              </p>\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Bundle Summary */}\n      {selectedItems.length > 0 && (\n        <div className=\"bg-white rounded-xl p-4 shadow-inner\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n            <div>\n              <p className=\"text-sm text-gray-600 mb-1\">\n                {selectedItems.length} termk kivlasztva\n              </p>\n              <div className=\"flex items-center gap-3\">\n                {bundleDiscount > 0 && (\n                  <span className=\"text-gray-400 line-through text-sm\">\n                    {formatPrice(bundleOriginalPrice)} Ft\n                  </span>\n                )}\n                <span className=\"text-2xl font-bold text-gray-900\">\n                  {formatPrice(Math.round(bundleFinalPrice))} Ft\n                </span>\n              </div>\n              {savedAmount > 0 && (\n                <p className=\"text-green-600 text-sm font-medium mt-1\">\n                   Megtakarts: {formatPrice(Math.round(savedAmount))} Ft\n                </p>\n              )}\n            </div>\n\n            <button\n              onClick={handleAddBundle}\n              className=\"flex items-center justify-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all\"\n            >\n              <ShoppingBag className=\"w-5 h-5\" />\n              Mind a kosrba\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Hint when nothing selected */}\n      {selectedItems.length === 0 && (\n        <p className=\"text-center text-amber-700 text-sm py-2\">\n           Kattints a termkekre a kivlasztshoz\n        </p>\n      )}\n    </div>\n  );\n};\n\nexport default CompleteTheLook;\n","import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { ZoomIn, ZoomOut, ChevronLeft, ChevronRight, X, Expand, Maximize2 } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ImageGallery - Professional product image gallery\n * Features: Zoom, Swipe, Thumbnails, Fullscreen\n */\nconst ImageGallery = ({ images = [], productName = 'Termk' }) => {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isZoomed, setIsZoomed] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  useScrollLock(isFullscreen);\n  const [zoomPosition, setZoomPosition] = useState({ x: 50, y: 50 });\n  const [touchStart, setTouchStart] = useState(null);\n  const mainImageRef = useRef(null);\n\n  // Ensure we have at least one image\n  const imageList = images.length > 0 ? images : ['data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" fill=\"%239ca3af\" font-size=\"16\">Nincs kp</text></svg>'];\n  \n  const currentImage = imageList[currentIndex];\n\n  // Navigation\n  const goToNext = useCallback(() => {\n    setCurrentIndex((prev) => (prev + 1) % imageList.length);\n    setIsZoomed(false);\n  }, [imageList.length]);\n\n  const goToPrev = useCallback(() => {\n    setCurrentIndex((prev) => (prev - 1 + imageList.length) % imageList.length);\n    setIsZoomed(false);\n  }, [imageList.length]);\n\n  // Zoom handling\n  const handleMouseMove = (e) => {\n    if (!mainImageRef.current || !isZoomed) return;\n    \n    const rect = mainImageRef.current.getBoundingClientRect();\n    const x = ((e.clientX - rect.left) / rect.width) * 100;\n    const y = ((e.clientY - rect.top) / rect.height) * 100;\n    \n    setZoomPosition({ x, y });\n  };\n\n  const toggleZoom = () => {\n    setIsZoomed(!isZoomed);\n  };\n\n  // Touch handling for swipe\n  const handleTouchStart = (e) => {\n    setTouchStart(e.touches[0].clientX);\n  };\n\n  const handleTouchEnd = (e) => {\n    if (!touchStart) return;\n    \n    const touchEnd = e.changedTouches[0].clientX;\n    const diff = touchStart - touchEnd;\n    \n    if (Math.abs(diff) > 50) {\n      if (diff > 0) goToNext();\n      else goToPrev();\n    }\n    \n    setTouchStart(null);\n  };\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (e.key === 'ArrowLeft') goToPrev();\n      if (e.key === 'ArrowRight') goToNext();\n      if (e.key === 'Escape') {\n        setIsFullscreen(false);\n        setIsZoomed(false);\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [goToPrev, goToNext]);\n\n  // Fullscreen Gallery Modal\n  if (isFullscreen) {\n    return (\n      <div className=\"fixed inset-0 lg:top-[60px] z-[9999] bg-black flex items-center justify-center\">\n        {/* Close button */}\n        <button\n          onClick={() => setIsFullscreen(false)}\n          className=\"absolute top-4 right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n          aria-label=\"Bezrs\"\n        >\n          <X className=\"w-6 h-6\" />\n        </button>\n\n        {/* Navigation */}\n        {imageList.length > 1 && (\n          <>\n            <button\n              onClick={goToPrev}\n              className=\"absolute left-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n              aria-label=\"Elz kp\"\n            >\n              <ChevronLeft className=\"w-8 h-8\" />\n            </button>\n            <button\n              onClick={goToNext}\n              className=\"absolute right-4 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors z-10\"\n              aria-label=\"Kvetkez kp\"\n            >\n              <ChevronRight className=\"w-8 h-8\" />\n            </button>\n          </>\n        )}\n\n        {/* Main Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className=\"max-h-[90vh] max-w-[90vw] object-contain\"\n          onTouchStart={handleTouchStart}\n          onTouchEnd={handleTouchEnd}\n        />\n\n        {/* Counter */}\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 bg-white/10 rounded-full text-white text-sm\">\n          {currentIndex + 1} / {imageList.length}\n        </div>\n\n        {/* Thumbnails */}\n        {imageList.length > 1 && (\n          <div className=\"absolute bottom-16 left-1/2 -translate-x-1/2 flex gap-2\">\n            {imageList.map((img, idx) => (\n              <button\n                key={idx}\n                onClick={() => setCurrentIndex(idx)}\n                className={`\n                  w-16 h-16 rounded-lg overflow-hidden border-2 transition-all\n                  ${idx === currentIndex ? 'border-white scale-110' : 'border-transparent opacity-60 hover:opacity-100'}\n                `}\n              >\n                <img src={img} alt=\"\" className=\"w-full h-full object-cover\" />\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full\">\n      {/* Main Image Container */}\n      <div \n        ref={mainImageRef}\n        className=\"relative aspect-square bg-gray-50 rounded-2xl overflow-hidden cursor-zoom-in group\"\n        onClick={toggleZoom}\n        onMouseMove={handleMouseMove}\n        onMouseLeave={() => setIsZoomed(false)}\n        onTouchStart={handleTouchStart}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Image */}\n        <img\n          src={currentImage}\n          alt={`${productName} - ${currentIndex + 1}`}\n          className={`\n            w-full h-full object-contain transition-transform duration-300\n            ${isZoomed ? 'scale-[2.5]' : 'group-hover:scale-105'}\n          `}\n          style={isZoomed ? {\n            transformOrigin: `${zoomPosition.x}% ${zoomPosition.y}%`\n          } : {}}\n          onError={(e) => { \n            e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><rect fill=\"%23f3f4f6\" width=\"400\" height=\"400\"/></svg>'; \n          }}\n          draggable={false}\n        />\n\n        {/* Zoom indicator */}\n        {!isZoomed && (\n          <div className=\"absolute bottom-4 right-4 px-3 py-1.5 bg-black/50 text-white text-xs rounded-full flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity\">\n            <ZoomIn className=\"w-4 h-4\" />\n            Kattints a nagytshoz\n          </div>\n        )}\n\n        {/* Navigation arrows */}\n        {imageList.length > 1 && !isZoomed && (\n          <>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToPrev(); }}\n              className=\"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n              aria-label=\"Elz kp\"\n            >\n              <ChevronLeft className=\"w-5 h-5 text-gray-700\" />\n            </button>\n            <button\n              onClick={(e) => { e.stopPropagation(); goToNext(); }}\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n              aria-label=\"Kvetkez kp\"\n            >\n              <ChevronRight className=\"w-5 h-5 text-gray-700\" />\n            </button>\n          </>\n        )}\n\n        {/* Fullscreen button */}\n        <button\n          onClick={(e) => { e.stopPropagation(); setIsFullscreen(true); }}\n          className=\"absolute top-4 right-4 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all\"\n          aria-label=\"Teljes kperny\"\n          title=\"Teljes kperny\"\n        >\n          <Maximize2 className=\"w-5 h-5 text-gray-700\" />\n        </button>\n\n        {/* Image counter badge */}\n        {imageList.length > 1 && (\n          <div className=\"absolute top-4 left-4 px-2.5 py-1 bg-black/50 text-white text-xs rounded-full\">\n            {currentIndex + 1} / {imageList.length}\n          </div>\n        )}\n      </div>\n\n      {/* Thumbnails */}\n      {imageList.length > 1 && (\n        <div className=\"flex gap-2 mt-3 overflow-x-auto pb-2 scrollbar-hide\">\n          {imageList.map((img, idx) => (\n            <button\n              key={idx}\n              onClick={() => { setCurrentIndex(idx); setIsZoomed(false); }}\n              className={`\n                flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-xl overflow-hidden border-2 transition-all\n                ${idx === currentIndex \n                  ? 'border-primary-500 ring-2 ring-primary-200' \n                  : 'border-gray-200 hover:border-gray-300 opacity-70 hover:opacity-100'\n                }\n              `}\n            >\n              <img \n                src={img} \n                alt={`Thumbnail ${idx + 1}`}\n                className=\"w-full h-full object-contain bg-gray-50\"\n                onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n              />\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Dots indicator (mobile) */}\n      {imageList.length > 1 && (\n        <div className=\"flex justify-center gap-1.5 mt-3 sm:hidden\">\n          {imageList.map((_, idx) => (\n            <button\n              key={idx}\n              onClick={() => setCurrentIndex(idx)}\n              className={`\n                w-2 h-2 rounded-full transition-all\n                ${idx === currentIndex ? 'bg-primary-500 w-6' : 'bg-gray-300'}\n              `}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ImageGallery;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Check, AlertTriangle, Truck, Clock, Shield, ChevronUp } from 'lucide-react';\nimport { formatPrice } from '../../utils/helpers';\nimport { useScrollPastY } from '../../hooks/useScrollPosition';\n\n/**\n * StickyAddToCart - Sticky bottom bar for product pages\n * Shows when the product view (modal) is not in viewport, or after scrolling past threshold.\n * Uses shared scroll hook when no observedElementId.\n */\nconst StickyAddToCart = ({ \n  product, \n  onAddToCart, \n  onToggleWishlist, \n  isWishlisted = false,\n  isVisible = true,\n  /** When set, bar is shown only when this element is NOT in viewport (e.g. product modal root) */\n  observedElementId = null\n}) => {\n  const [isShownObserved, setIsShownObserved] = useState(false);\n  const [addedToCart, setAddedToCart] = useState(false);\n  const [quantity, setQuantity] = useState(1);\n  const scrollPast400 = useScrollPastY(400);\n\n  useEffect(() => {\n    if (!observedElementId) return;\n    const el = document.getElementById(observedElementId);\n    if (!el || !(el instanceof Element)) return;\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsShownObserved(!entry.isIntersecting),\n      { threshold: 0.1, root: null }\n    );\n    try {\n      observer.observe(el);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [observedElementId]);\n\n  const isShown = observedElementId ? isShownObserved : scrollPast400;\n\n  if (!product || !isVisible) return null;\n\n  const price = product.salePrice || product.price || 0;\n  const originalPrice = product.originalPrice || (product.salePrice ? product.price : null);\n  const hasDiscount = originalPrice && originalPrice > price;\n  const discountPercent = hasDiscount ? Math.round((1 - price / originalPrice) * 100) : 0;\n  \n  const stockLevel = typeof product.stockLevel === 'number' ? product.stockLevel : null;\n  const isInStock = product.inStock ?? product.in_stock ?? true;\n  const isLowStock = isInStock && stockLevel != null && stockLevel <= 5;\n\n  const handleAddToCart = () => {\n    if (onAddToCart) {\n      onAddToCart(product, quantity);\n    }\n    setAddedToCart(true);\n    \n    // Haptic feedback (if available)\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n    \n    setTimeout(() => setAddedToCart(false), 2000);\n  };\n\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  return (\n    <div \n      className={`\n        fixed bottom-0 left-0 right-0 z-40 transition-all duration-300\n        ${isShown ? 'translate-y-0' : 'translate-y-full'}\n      `}\n      style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }}\n    >\n      {/* Main sticky bar */}\n      <div className=\"bg-white border-t border-gray-200 shadow-2xl\">\n        {/* Stock urgency banner */}\n        {isLowStock && isInStock && (\n          <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 text-white text-center py-1.5 text-sm font-medium flex items-center justify-center gap-2\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            Mr csak {stockLevel} db van raktron!\n          </div>\n        )}\n\n        <div className=\"max-w-7xl mx-auto px-4 py-3.5 flex items-center justify-between gap-4\">\n          {/* Product info - mobile - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex-1 min-w-0 sm:hidden\">\n            <p className=\"text-base font-medium text-gray-900 truncate\">{product.name}</p>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xl font-bold text-primary-500\">{formatPrice(price)}</span>\n              {hasDiscount && (\n                <span className=\"text-sm line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n              )}\n            </div>\n          </div>\n\n          {/* Product info - desktop - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden sm:flex items-center gap-4 flex-1\">\n            <img \n              src={product.images?.[0] || product.image} \n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-gray-50 rounded-lg\"\n            />\n            <div>\n              <p className=\"font-medium text-gray-900 text-base lg:text-lg line-clamp-1\">{product.name}</p>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xl lg:text-2xl font-bold text-primary-500\">{formatPrice(price)}</span>\n                {hasDiscount && (\n                  <>\n                    <span className=\"text-base line-through text-gray-400\">{formatPrice(originalPrice)}</span>\n                    <span className=\"px-2 py-0.5 bg-red-100 text-red-600 text-sm font-bold rounded\">\n                      -{discountPercent}%\n                    </span>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* Trust badges - desktop only - UNIFIED TYPOGRAPHY */}\n          <div className=\"hidden lg:flex items-center gap-5 text-gray-500 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n              <span>Ingyenes szllts</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Shield className=\"w-5 h-5 text-blue-600\" />\n              <span>2 v garancia</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"w-5 h-5 text-amber-600\" />\n              <span>24h kiszllts</span>\n            </div>\n          </div>\n\n          {/* Actions - UNIFIED TYPOGRAPHY */}\n          <div className=\"flex items-center gap-3\">\n            {/* Quantity selector - desktop only */}\n            <div className=\"hidden sm:flex items-center border border-gray-200 rounded-xl\">\n              <button \n                onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                -\n              </button>\n              <span className=\"px-4 py-2.5 font-medium min-w-[48px] text-center text-base\">{quantity}</span>\n              <button \n                onClick={() => setQuantity(quantity + 1)}\n                className=\"px-4 py-2.5 text-gray-600 hover:bg-gray-100 transition-colors text-lg\"\n              >\n                +\n              </button>\n            </div>\n\n            {/* Wishlist */}\n            <button\n              onClick={() => onToggleWishlist?.(product.id)}\n              className={`\n                p-3.5 rounded-xl transition-all\n                ${isWishlisted \n                  ? 'bg-red-100 text-red-500' \n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }\n              `}\n            >\n              <Heart className=\"w-6 h-6\" fill={isWishlisted ? 'currentColor' : 'none'} />\n            </button>\n\n            {/* Add to cart */}\n            <button\n              onClick={handleAddToCart}\n              disabled={!isInStock || addedToCart}\n              className={`\n                flex items-center gap-2 px-6 sm:px-7 py-3.5 rounded-xl font-bold text-base transition-all\n                ${addedToCart \n                  ? 'bg-green-500 text-white' \n                  : isInStock \n                    ? 'bg-gradient-to-r from-primary-500 to-secondary-700 text-white hover:shadow-lg hover:scale-[1.02]'\n                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                }\n              `}\n            >\n              {addedToCart ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Hozzadva!</span>\n                </>\n              ) : isInStock ? (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Kosrba</span>\n                </>\n              ) : (\n                <>\n                  <AlertTriangle className=\"w-5 h-5\" />\n                  <span className=\"hidden sm:inline\">Elfogyott</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Scroll to top button */}\n      <button\n        onClick={scrollToTop}\n        className=\"absolute -top-12 right-4 p-2 bg-white rounded-full shadow-lg border border-gray-200 text-gray-600 hover:text-primary-500 hover:border-primary-300 transition-all\"\n        aria-label=\"Oldal tetejre\"\n      >\n        <ChevronUp className=\"w-5 h-5\" />\n      </button>\n    </div>\n  );\n};\n\nexport default StickyAddToCart;\n","import React, { useState } from 'react';\nimport { Bell, BellRing, Mail, Check, X, TrendingDown, Sparkles } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPriceNumber } from '../../utils/helpers';\n\n/**\n * PriceAlert - \"rtests ha lecskken az r\" feature\n * Saves to localStorage, shows confirmation\n */\nconst PriceAlert = ({ product, variant = 'button' }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [email, setEmail] = useState('');\n  const [targetPrice, setTargetPrice] = useState('');\n  const [isSubmitted, setIsSubmitted] = useState(false);\n  const [isAlertSet, setIsAlertSet] = useState(() => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    return alerts.some(a => a.productId === product?.id);\n  });\n  useScrollLock(isOpen);\n\n  if (!product) return null;\n\n  const currentPrice = product.salePrice || product.price || 0;\n  const suggestedPrice = Math.floor(currentPrice * 0.85); // 15% kedvezmnyes r\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    \n    const alertData = {\n      productId: product.id,\n      productName: product.name,\n      currentPrice,\n      targetPrice: parseInt(targetPrice) || suggestedPrice,\n      email,\n      createdAt: Date.now()\n    };\n\n    // Save to localStorage\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    filtered.push(alertData);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n\n    setIsSubmitted(true);\n    setIsAlertSet(true);\n\n    setTimeout(() => {\n      setIsOpen(false);\n      setIsSubmitted(false);\n    }, 2000);\n  };\n\n  const removeAlert = () => {\n    const alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');\n    const filtered = alerts.filter(a => a.productId !== product.id);\n    localStorage.setItem('priceAlerts', JSON.stringify(filtered));\n    setIsAlertSet(false);\n  };\n\n  const formatPrice = (p) => formatPriceNumber(p);\n\n  // Button variant\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n          className={`\n            flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all text-sm font-medium\n            ${isAlertSet \n              ? 'bg-amber-100 text-amber-700 hover:bg-amber-200' \n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n            }\n          `}\n        >\n          {isAlertSet ? (\n            <>\n              <BellRing className=\"w-4 h-4\" />\n              rtests belltva\n            </>\n          ) : (\n            <>\n              <Bell className=\"w-4 h-4\" />\n              rcskkens rtest\n            </>\n          )}\n        </button>\n\n        {/* Modal */}\n        {isOpen && (\n          <PriceAlertModal\n            product={product}\n            currentPrice={currentPrice}\n            suggestedPrice={suggestedPrice}\n            email={email}\n            setEmail={setEmail}\n            targetPrice={targetPrice}\n            setTargetPrice={setTargetPrice}\n            isSubmitted={isSubmitted}\n            onSubmit={handleSubmit}\n            onClose={() => setIsOpen(false)}\n            formatPrice={formatPrice}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Inline variant (for product cards)\n  return (\n    <button\n      onClick={() => isAlertSet ? removeAlert() : setIsOpen(true)}\n      className={`\n        p-2 rounded-full transition-all\n        ${isAlertSet \n          ? 'bg-amber-500 text-white' \n          : 'bg-gray-100 text-gray-500 hover:bg-amber-100 hover:text-amber-600'\n        }\n      `}\n      title={isAlertSet ? 'rtests belltva' : 'rcskkens rtest'}\n    >\n      {isAlertSet ? <BellRing className=\"w-4 h-4\" /> : <Bell className=\"w-4 h-4\" />}\n    </button>\n  );\n};\n\n// Modal component\nconst PriceAlertModal = ({\n  product,\n  currentPrice,\n  suggestedPrice,\n  email,\n  setEmail,\n  targetPrice,\n  setTargetPrice,\n  isSubmitted,\n  onSubmit,\n  onClose,\n  formatPrice\n}) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 p-5 text-white relative\">\n          <button\n            onClick={onClose}\n            className=\"absolute top-3 right-3 p-1.5 hover:bg-white/20 rounded-full transition-colors\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n          \n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n              <TrendingDown className=\"w-6 h-6\" />\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold\">rcskkens rtest</h3>\n              <p className=\"text-white/80 text-sm\">Szlunk, ha cskken az r!</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-5\">\n          {!isSubmitted ? (\n            <form onSubmit={onSubmit} className=\"space-y-4\">\n              {/* Product info */}\n              <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n                <img \n                  src={product.images?.[0] || product.image}\n                  alt={product.name}\n                  className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n                />\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n                  <p className=\"text-lg font-bold text-primary-500\">{formatPrice(currentPrice)} Ft</p>\n                </div>\n              </div>\n\n              {/* Target price */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  rtests, ha az r ez al cskken:\n                </label>\n                <div className=\"relative\">\n                  <input\n                    type=\"number\"\n                    value={targetPrice}\n                    onChange={(e) => setTargetPrice(e.target.value)}\n                    placeholder={suggestedPrice.toString()}\n                    className=\"w-full pl-4 pr-12 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                  />\n                  <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500\">Ft</span>\n                </div>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Javasolt r: {formatPrice(suggestedPrice)} Ft ({Math.round((1 - suggestedPrice/currentPrice) * 100)}% kedvezmny)\n                </p>\n              </div>\n\n              {/* Email */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1.5\">\n                  Email cm:\n                </label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n                  <input\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"pelda@email.com\"\n                    className=\"w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 outline-none transition-all\"\n                    required\n                  />\n                </div>\n              </div>\n\n              {/* Submit */}\n              <button\n                type=\"submit\"\n                className=\"w-full py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center gap-2\"\n              >\n                <Bell className=\"w-5 h-5\" />\n                rtests belltsa\n              </button>\n            </form>\n          ) : (\n            /* Success */\n            <div className=\"text-center py-6\">\n              <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Check className=\"w-8 h-8 text-green-600\" />\n              </div>\n              <h4 className=\"text-xl font-bold text-gray-900 mb-2\">rtests belltva!</h4>\n              <p className=\"text-gray-600 text-sm\">\n                Emailben rtestnk, ha {formatPrice(parseInt(targetPrice) || suggestedPrice)} Ft al cskken az r.\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default PriceAlert;\n","import React, { useState, useEffect, useRef } from 'react';\n\n/**\n * FadeInOnScroll - Animates children when they enter viewport\n */\nexport const FadeInOnScroll = ({ \n  children, \n  direction = 'up', // 'up', 'down', 'left', 'right', 'none'\n  delay = 0,\n  duration = 500,\n  threshold = 0.1,\n  className = ''\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    const mq = window.matchMedia('(prefers-reduced-motion: reduce)');\n    if (!mq) return undefined;\n    setPrefersReducedMotion(mq.matches);\n    const handler = () => setPrefersReducedMotion(mq.matches);\n    if (typeof mq.addEventListener === 'function') {\n      mq.addEventListener('change', handler);\n      return () => mq.removeEventListener('change', handler);\n    }\n    if (typeof mq.addListener === 'function') {\n      mq.addListener(handler);\n      return () => mq.removeListener(handler);\n    }\n    return undefined;\n  }, []);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el || !(el instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsVisible(true);\n          observer.unobserve(entry.target);\n        }\n      },\n      { threshold }\n    );\n\n    try {\n      observer.observe(el);\n    } catch (err) {\n      return undefined;\n    }\n    return () => observer.disconnect();\n  }, [threshold]);\n\n  const getTransform = () => {\n    if (isVisible || prefersReducedMotion) return 'translate3d(0, 0, 0)';\n    switch (direction) {\n      case 'up': return 'translate3d(0, 30px, 0)';\n      case 'down': return 'translate3d(0, -30px, 0)';\n      case 'left': return 'translate3d(30px, 0, 0)';\n      case 'right': return 'translate3d(-30px, 0, 0)';\n      default: return 'translate3d(0, 0, 0)';\n    }\n  };\n\n  const visible = isVisible || prefersReducedMotion;\n  const transition = prefersReducedMotion ? 'none' : `transform ${duration}ms ease-out ${delay}ms, opacity ${duration}ms ease-out ${delay}ms`;\n\n  return (\n    <div\n      ref={ref}\n      className={className}\n      style={{\n        transform: getTransform(),\n        opacity: visible ? 1 : 0,\n        transition,\n        willChange: prefersReducedMotion || visible ? 'auto' : 'transform, opacity'\n      }}\n    >\n      {children}\n    </div>\n  );\n};\n\n/**\n * StaggerChildren - Staggers animation of child elements\n */\nexport const StaggerChildren = ({ \n  children, \n  staggerDelay = 100,\n  direction = 'up',\n  duration = 400,\n  className = ''\n}) => {\n  return (\n    <div className={className}>\n      {React.Children.map(children, (child, index) => (\n        <FadeInOnScroll\n          direction={direction}\n          delay={index * staggerDelay}\n          duration={duration}\n        >\n          {child}\n        </FadeInOnScroll>\n      ))}\n    </div>\n  );\n};\n\n/**\n * Confetti - Celebration animation for add to cart, etc.\n */\nexport const Confetti = ({ isActive, duration = 2000, onComplete }) => {\n  const [particles, setParticles] = useState([]);\n  const canvasRef = useRef(null);\n\n  useEffect(() => {\n    if (!isActive) return;\n\n    // Generate confetti particles\n    const newParticles = Array.from({ length: 50 }, (_, i) => ({\n      id: i,\n      x: Math.random() * 100,\n      y: -10,\n      size: Math.random() * 8 + 4,\n      color: ['#6366f1', '#a855f7', '#ec4899', '#f59e0b', '#10b981', '#3b82f6'][Math.floor(Math.random() * 6)],\n      speedX: (Math.random() - 0.5) * 3,\n      speedY: Math.random() * 3 + 2,\n      rotation: Math.random() * 360,\n      rotationSpeed: (Math.random() - 0.5) * 10\n    }));\n\n    setParticles(newParticles);\n\n    const timeout = setTimeout(() => {\n      setParticles([]);\n      if (onComplete) onComplete();\n    }, duration);\n\n    return () => clearTimeout(timeout);\n  }, [isActive, duration, onComplete]);\n\n  useEffect(() => {\n    if (particles.length === 0) return;\n\n    let animationFrame;\n    const animate = () => {\n      setParticles(prev => \n        prev.map(p => ({\n          ...p,\n          y: p.y + p.speedY,\n          x: p.x + p.speedX,\n          rotation: p.rotation + p.rotationSpeed\n        })).filter(p => p.y < 110)\n      );\n      animationFrame = requestAnimationFrame(animate);\n    };\n\n    animationFrame = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationFrame);\n  }, [particles.length > 0]);\n\n  if (particles.length === 0) return null;\n\n  return (\n    <div className=\"fixed inset-0 pointer-events-none z-[200] overflow-hidden\">\n      {particles.map(p => (\n        <div\n          key={p.id}\n          className=\"absolute\"\n          style={{\n            left: `${p.x}%`,\n            top: `${p.y}%`,\n            width: p.size,\n            height: p.size,\n            backgroundColor: p.color,\n            transform: `rotate(${p.rotation}deg)`,\n            borderRadius: Math.random() > 0.5 ? '50%' : '0',\n            opacity: 1 - (p.y / 110)\n          }}\n        />\n      ))}\n    </div>\n  );\n};\n\n/**\n * PulseButton - Button with pulse animation\n */\nexport const PulseButton = ({ children, className = '', ...props }) => {\n  return (\n    <button \n      className={`relative ${className}`}\n      {...props}\n    >\n      <span className=\"absolute inset-0 rounded-xl bg-current opacity-20 animate-ping\" />\n      {children}\n    </button>\n  );\n};\n\n/**\n * ShimmerText - Text with shimmer effect\n */\nexport const ShimmerText = ({ children, className = '' }) => {\n  return (\n    <span \n      className={`relative inline-block ${className}`}\n      style={{\n        background: 'linear-gradient(90deg, currentColor 0%, #a78bfa 50%, currentColor 100%)',\n        backgroundSize: '200% 100%',\n        WebkitBackgroundClip: 'text',\n        WebkitTextFillColor: 'transparent',\n        animation: 'shimmer 2s linear infinite'\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes shimmer {\n          0% { background-position: 200% 0; }\n          100% { background-position: -200% 0; }\n        }\n      `}</style>\n    </span>\n  );\n};\n\n/**\n * FloatingElement - Gentle floating animation\n */\nexport const FloatingElement = ({ children, className = '', amplitude = 10, duration = 3 }) => {\n  return (\n    <div \n      className={className}\n      style={{\n        animation: `float ${duration}s ease-in-out infinite`\n      }}\n    >\n      {children}\n      <style jsx>{`\n        @keyframes float {\n          0%, 100% { transform: translateY(0px); }\n          50% { transform: translateY(-${amplitude}px); }\n        }\n      `}</style>\n    </div>\n  );\n};\n\n/**\n * CountUp - Animated number counter\n */\nexport const CountUp = ({ end, duration = 2000, prefix = '', suffix = '', className = '' }) => {\n  const [count, setCount] = useState(0);\n  const [hasStarted, setHasStarted] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    if (!ref.current || !(ref.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting && !hasStarted) {\n          setHasStarted(true);\n        }\n      },\n      { threshold: 0.5 }\n    );\n\n    try {\n      observer.observe(ref.current);\n    } catch (err) {\n      return;\n    }\n    return () => observer.disconnect();\n  }, [hasStarted]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    let startTime;\n    const animate = (timestamp) => {\n      if (!startTime) startTime = timestamp;\n      const progress = Math.min((timestamp - startTime) / duration, 1);\n      \n      // Easing function\n      const easeOut = 1 - Math.pow(1 - progress, 3);\n      setCount(Math.floor(easeOut * end));\n\n      if (progress < 1) {\n        requestAnimationFrame(animate);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }, [hasStarted, end, duration]);\n\n  return (\n    <span ref={ref} className={className}>\n      {prefix}{count.toLocaleString('hu-HU')}{suffix}\n    </span>\n  );\n};\n\n/**\n * ProgressBar - Animated progress bar\n */\nexport const ProgressBar = ({ progress, className = '', color = 'primary' }) => {\n  const [width, setWidth] = useState(0);\n\n  useEffect(() => {\n    const timeout = setTimeout(() => setWidth(progress), 100);\n    return () => clearTimeout(timeout);\n  }, [progress]);\n\n  return (\n    <div className={`h-2 bg-gray-200 rounded-full overflow-hidden ${className}`}>\n      <div \n        className={`h-full bg-gradient-to-r from-${color}-500 to-${color}-500 rounded-full transition-all duration-1000 ease-out`}\n        style={{ width: `${width}%` }}\n      />\n    </div>\n  );\n};\n\nexport default {\n  FadeInOnScroll,\n  StaggerChildren,\n  Confetti,\n  PulseButton,\n  ShimmerText,\n  FloatingElement,\n  CountUp,\n  ProgressBar\n};\n","import React, { useState, useRef, useEffect } from 'react';\nimport { X, ChevronDown } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * BottomSheet - iOS-style bottom sheet modal\n * Supports drag to close, snap points, and swipe gestures\n */\nconst BottomSheet = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  snapPoints = [0.5, 0.9], // Percentage of screen height\n  initialSnap = 0,\n  showHandle = true,\n  showClose = true\n}) => {\n  const [currentSnap, setCurrentSnap] = useState(initialSnap);\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState(0);\n  const [touchStartY, setTouchStartY] = useState(0);\n  const sheetRef = useRef(null);\n  const contentRef = useRef(null);\n  useScrollLock(isOpen);\n\n  useEffect(() => {\n    if (isOpen) {\n      setCurrentSnap(initialSnap);\n      setDragOffset(0);\n    }\n  }, [isOpen, initialSnap]);\n\n  const getSheetHeight = () => {\n    const snapHeight = snapPoints[currentSnap] * 100;\n    return `${snapHeight}vh`;\n  };\n\n  const handleTouchStart = (e) => {\n    // Only allow drag from handle area\n    if (e.target.closest('.sheet-content') && contentRef.current?.scrollTop > 0) {\n      return;\n    }\n    setTouchStartY(e.touches[0].clientY);\n    setIsDragging(true);\n  };\n\n  const handleTouchMove = (e) => {\n    if (!isDragging) return;\n    \n    const currentY = e.touches[0].clientY;\n    const diff = currentY - touchStartY;\n    \n    // Only allow dragging down\n    if (diff > 0) {\n      setDragOffset(diff);\n    } else {\n      // Allow dragging up to expand\n      setDragOffset(diff * 0.3); // Resistance when dragging up\n    }\n  };\n\n  const handleTouchEnd = () => {\n    if (!isDragging) return;\n    setIsDragging(false);\n\n    const threshold = 100;\n    \n    if (dragOffset > threshold) {\n      // Dragged down enough - close or snap to lower point\n      if (currentSnap === 0) {\n        onClose();\n      } else {\n        setCurrentSnap(currentSnap - 1);\n      }\n    } else if (dragOffset < -threshold && currentSnap < snapPoints.length - 1) {\n      // Dragged up - snap to higher point\n      setCurrentSnap(currentSnap + 1);\n    }\n    \n    setDragOffset(0);\n  };\n\n  const triggerHaptic = () => {\n    if (navigator.vibrate) {\n      navigator.vibrate(10);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[80] md:hidden\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 bg-black transition-opacity duration-300 ${isDragging ? 'opacity-40' : 'opacity-50'}`}\n        onClick={onClose}\n      />\n      \n      {/* Sheet */}\n      <div\n        ref={sheetRef}\n        className=\"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl transition-all duration-300 ease-out\"\n        style={{\n          height: getSheetHeight(),\n          transform: `translateY(${Math.max(0, dragOffset)}px)`,\n          transitionProperty: isDragging ? 'none' : 'all'\n        }}\n        onTouchStart={handleTouchStart}\n        onTouchMove={handleTouchMove}\n        onTouchEnd={handleTouchEnd}\n      >\n        {/* Handle */}\n        {showHandle && (\n          <div className=\"flex justify-center py-3 cursor-grab active:cursor-grabbing\">\n            <div className=\"w-12 h-1.5 bg-gray-300 rounded-full\" />\n          </div>\n        )}\n\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-5 pb-4 border-b border-gray-100\">\n          <h3 className=\"text-lg font-bold text-gray-900\">{title}</h3>\n          {showClose && (\n            <button\n              onClick={onClose}\n              className=\"p-2 -mr-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n\n        {/* Content */}\n        <div \n          ref={contentRef}\n          className=\"sheet-content flex-1 overflow-y-auto overscroll-contain\"\n          style={{ maxHeight: `calc(${getSheetHeight()} - 100px)` }}\n        >\n          {children}\n        </div>\n\n        {/* Safe area padding for iOS */}\n        <div style={{ paddingBottom: 'env(safe-area-inset-bottom, 0)' }} />\n      </div>\n    </div>\n  );\n};\n\n/**\n * FilterBottomSheet - Pre-styled filter sheet\n */\nexport const FilterBottomSheet = ({\n  isOpen,\n  onClose,\n  filters,\n  activeFilters,\n  onFilterChange,\n  onClearAll,\n  onApply\n}) => {\n  return (\n    <BottomSheet isOpen={isOpen} onClose={onClose} title=\"Szrk\" snapPoints={[0.7, 0.9]}>\n      <div className=\"p-5 space-y-6\">\n        {/* Active filters count */}\n        {Object.keys(activeFilters).length > 0 && (\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-gray-600\">\n              {Object.keys(activeFilters).length} szr aktv\n            </span>\n            <button\n              onClick={onClearAll}\n              className=\"text-sm text-primary-500 font-medium\"\n            >\n              sszes trlse\n            </button>\n          </div>\n        )}\n\n        {/* Filter sections */}\n        {filters.map((filter) => (\n          <FilterSection\n            key={filter.id}\n            filter={filter}\n            value={activeFilters[filter.id]}\n            onChange={(value) => onFilterChange(filter.id, value)}\n          />\n        ))}\n\n        {/* Apply button */}\n        <button\n          onClick={onApply}\n          className=\"w-full py-4 bg-primary-500 text-white font-bold rounded-xl hover:bg-primary-600 transition-colors\"\n        >\n          Szrk alkalmazsa\n        </button>\n      </div>\n    </BottomSheet>\n  );\n};\n\nconst FilterSection = ({ filter, value, onChange }) => {\n  const [isExpanded, setIsExpanded] = useState(true);\n\n  return (\n    <div className=\"border-b border-gray-100 pb-4\">\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between py-2\"\n      >\n        <span className=\"font-medium text-gray-900\">{filter.label}</span>\n        <ChevronDown className={`w-5 h-5 text-gray-400 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\n      </button>\n      \n      {isExpanded && (\n        <div className=\"mt-3 space-y-2\">\n          {filter.type === 'checkbox' && filter.options?.map((option) => (\n            <label key={option.value} className=\"flex items-center gap-3 py-2\">\n              <input\n                type=\"checkbox\"\n                checked={value?.includes(option.value)}\n                onChange={(e) => {\n                  const newValue = e.target.checked\n                    ? [...(value || []), option.value]\n                    : (value || []).filter(v => v !== option.value);\n                  onChange(newValue);\n                }}\n                className=\"w-5 h-5 rounded border-gray-300 text-primary-500 focus:ring-primary-500\"\n              />\n              <span className=\"text-gray-700\">{option.label}</span>\n              {option.count && (\n                <span className=\"text-gray-400 text-sm ml-auto\">({option.count})</span>\n              )}\n            </label>\n          ))}\n          \n          {filter.type === 'range' && (\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-4\">\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Min</label>\n                  <input\n                    type=\"number\"\n                    value={value?.min || ''}\n                    onChange={(e) => onChange({ ...value, min: e.target.value })}\n                    placeholder={filter.min?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Max</label>\n                  <input\n                    type=\"number\"\n                    value={value?.max || ''}\n                    onChange={(e) => onChange({ ...value, max: e.target.value })}\n                    placeholder={filter.max?.toString()}\n                    className=\"w-full px-3 py-2 border border-gray-200 rounded-lg focus:border-primary-500 focus:ring-1 focus:ring-primary-200 outline-none\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BottomSheet;\n","import React, { useState } from 'react';\nimport { X, Heart, Trash2, ShoppingCart, Share2, ChevronRight, Sparkles, Package } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\nimport { formatPrice } from '../../utils/helpers';\n\n/**\n * WishlistDrawer - Slide-in sidebar showing all wishlist items\n * Features: Remove items, add all to cart, share wishlist, AI recommendations\n */\nconst WishlistDrawer = ({ \n  isOpen, \n  onClose, \n  wishlistItems = [], \n  onRemove, \n  onAddToCart, \n  onProductClick,\n  onClearAll \n}) => {\n  const [isClosing, setIsClosing] = useState(false);\n  useScrollLock(isOpen);\n\n  const handleClose = () => {\n    setIsClosing(true);\n    setTimeout(() => {\n      setIsClosing(false);\n      onClose();\n    }, 300);\n  };\n\n  const totalValue = wishlistItems.reduce((sum, item) => sum + (item.salePrice || item.price || 0), 0);\n\n  const handleShare = async () => {\n    const text = `Nzd meg a kvnsglistmat! ${wishlistItems.length} termk, sszesen ${formatPrice(totalValue)}`;\n    \n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: 'Kvnsglistm - Marketly.AI',\n          text,\n          url: window.location.href\n        });\n      } catch (err) {\n        console.log('Share cancelled');\n      }\n    } else {\n      // Fallback: copy to clipboard\n      try {\n        if (navigator.clipboard?.writeText) {\n          await navigator.clipboard.writeText(text + ' ' + window.location.href);\n          alert('Link msolva a vglapra!');\n        } else {\n          alert('Nem sikerlt msolni. Prbld meg manulisan.');\n        }\n      } catch {\n        alert('Nem sikerlt msolni. Prbld meg manulisan.');\n      }\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[9999]\">\n      {/* Backdrop */}\n      <div \n        className={`absolute inset-0 lg:top-[60px] bg-black transition-opacity duration-300 ${isClosing ? 'opacity-0' : 'opacity-50'}`}\n        onClick={handleClose}\n      />\n\n      {/* Drawer */}\n      <div \n        className={`\n          absolute top-0 lg:top-[60px] right-0 h-full lg:h-[calc(100vh-60px)] w-full max-w-md bg-white shadow-2xl\n          transition-transform duration-300 ease-out\n          ${isClosing ? 'translate-x-full' : 'translate-x-0'}\n        `}\n      >\n        {/* Header - UNIFIED TYPOGRAPHY */}\n        <div className=\"bg-gradient-to-r from-pink-500 to-red-500 p-5 text-white\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center\">\n                <Heart className=\"w-6 h-6\" fill=\"white\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl sm:text-2xl font-bold\">Kvnsglista</h2>\n                <p className=\"text-white/80 text-sm sm:text-base\">{wishlistItems.length} termk</p>\n              </div>\n            </div>\n            <button\n              onClick={handleClose}\n              className=\"p-2 hover:bg-white/20 rounded-full transition-colors\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex flex-col h-[calc(100%-180px)] overflow-hidden\">\n          {wishlistItems.length === 0 ? (\n            /* Empty state - UNIFIED TYPOGRAPHY */\n            <div className=\"flex-1 flex flex-col items-center justify-center p-8 text-center\">\n              <div className=\"w-24 h-24 bg-pink-50 rounded-full flex items-center justify-center mb-4\">\n                <Heart className=\"w-12 h-12 text-pink-300\" />\n              </div>\n              <h3 className=\"text-xl sm:text-2xl font-bold text-gray-900 mb-2\">res a kvnsglista</h3>\n              <p className=\"text-base text-gray-500 mb-6\">Adj hozz termkeket a szv ikonra kattintva!</p>\n              <button\n                onClick={handleClose}\n                className=\"px-6 py-3 bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                Bngszs\n              </button>\n            </div>\n          ) : (\n            /* Items list */\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n              {wishlistItems.map((item, index) => (\n                <div \n                  key={item.id}\n                  className=\"bg-white border border-gray-100 rounded-xl p-3 shadow-sm hover:shadow-md transition-all group\"\n                  style={{ animationDelay: `${index * 50}ms` }}\n                >\n                  <div className=\"flex gap-3\">\n                    {/* Image */}\n                    <div \n                      className=\"w-20 h-20 bg-gray-50 rounded-lg overflow-hidden cursor-pointer shrink-0\"\n                      onClick={() => {\n                        onProductClick?.(item);\n                        handleClose();\n                      }}\n                    >\n                      <img\n                        src={item.images?.[0] || item.image}\n                        alt={item.name}\n                        className=\"w-full h-full object-contain group-hover:scale-110 transition-transform\"\n                        onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                      />\n                    </div>\n\n                    {/* Info - UNIFIED TYPOGRAPHY */}\n                    <div className=\"flex-1 min-w-0\">\n                      <p \n                        className=\"font-medium text-gray-900 text-sm sm:text-base line-clamp-2 cursor-pointer hover:text-primary-500 transition-colors\"\n                        onClick={() => {\n                          onProductClick?.(item);\n                          handleClose();\n                        }}\n                      >\n                        {item.name}\n                      </p>\n                      <p className=\"text-lg sm:text-xl font-bold text-primary-500 mt-1\">\n                        {formatPrice(item.salePrice || item.price)}\n                      </p>\n                      \n                      {/* Actions */}\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <button\n                          onClick={() => onAddToCart?.(item)}\n                          className=\"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-primary-500 text-white text-sm font-bold rounded-lg hover:bg-primary-600 transition-colors\"\n                        >\n                          <ShoppingCart className=\"w-4 h-4\" />\n                          Kosrba\n                        </button>\n                        <button\n                          onClick={() => onRemove?.(item.id)}\n                          className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\n                          title=\"Eltvolts\"\n                        >\n                          <Trash2 className=\"w-5 h-5\" />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer - UNIFIED TYPOGRAPHY */}\n        {wishlistItems.length > 0 && (\n          <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 space-y-3\">\n            {/* Total */}\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-base text-gray-600\">sszrtk:</span>\n              <span className=\"text-2xl font-bold text-gray-900\">{formatPrice(totalValue)}</span>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-2\">\n              <button\n                onClick={handleShare}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 border-2 border-gray-200 text-gray-700 font-bold text-sm sm:text-base rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <Share2 className=\"w-5 h-5\" />\n                Megoszts\n              </button>\n              <button\n                onClick={() => {\n                  wishlistItems.forEach(item => onAddToCart?.(item));\n                }}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-bold text-sm sm:text-base rounded-xl hover:shadow-lg transition-all\"\n              >\n                <ShoppingCart className=\"w-5 h-5\" />\n                Mind a kosrba\n              </button>\n            </div>\n\n            {/* Clear all */}\n            <button\n              onClick={onClearAll}\n              className=\"w-full text-center text-sm sm:text-base text-gray-400 hover:text-red-500 transition-colors py-2\"\n            >\n              Lista trlse\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default WishlistDrawer;\n","import React, { useState, useEffect, useRef } from 'react';\nimport { Zap, Clock, ArrowRight, X, Flame, ChevronLeft, ChevronRight } from 'lucide-react';\n\n/**\n * FlashSaleBanner - Impactful, urgent sale banner\n * Clear message: SALE + TIME + ACTION\n */\nconst FLASH_DISMISS_KEY = 'mkt_flash_dismissed_date';\n\nfunction getTodayKey() {\n  const d = new Date();\n  return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\nconst FLASH_OFFERS = [\n  { title: ' Flash Sale!', badge: '-50%', text: 'Akr 50% kedvezmny kivlasztott btorokra', cta: 'Megnzem az akcikat', ctaShort: 'Megnzem', bg: 'from-red-600 via-orange-500 to-amber-500', ctaColor: 'text-red-600' },\n  { title: ' Megtakartsok', badge: 'OLCSBB', text: 'Kanapk, gyak, szekrnyek  ma legolcsbban', cta: 'Nzd meg a kedvezmnyeket', ctaShort: 'Nzd meg', bg: 'from-rose-600 via-pink-500 to-amber-500', ctaColor: 'text-rose-600' },\n  { title: ' Ingyenes szllts', badge: '50e+', text: 'Ingyenes szllts 50.000 Ft felett', cta: 'Vsrls most', ctaShort: 'Vsrolj', bg: 'from-emerald-600 via-teal-500 to-cyan-500', ctaColor: 'text-emerald-700' },\n  { title: ' Csak ma!', badge: 'SIESS', text: 'Korltozott id  ne maradj le', cta: 'Nem hagyom ki', ctaShort: 'Nem hagyom ki', bg: 'from-orange-600 via-red-500 to-rose-600', ctaColor: 'text-orange-600' },\n];\n\nconst FlashSaleBanner = ({ \n  endTime,\n  title = 'Flash Sale',\n  subtitle,\n  onViewSale,\n  onDismiss,\n  variant = 'banner'\n}) => {\n  const [timeLeft, setTimeLeft] = useState(calculateTimeLeft());\n  const [offerIndex, setOfferIndex] = useState(0);\n  const [isPaused, setIsPaused] = useState(false);\n  const touchStartX = useRef(0);\n  const currentOffer = FLASH_OFFERS[offerIndex];\n  const displayTitle = currentOffer.title;\n  const displaySubtitle = currentOffer.text;\n  const displayCta = currentOffer.cta;\n  const displayCtaShort = currentOffer.ctaShort;\n  const bgGradient = currentOffer.bg;\n  const ctaColor = currentOffer.ctaColor || 'text-red-600';\n  const [isDismissed, setIsDismissed] = useState(() => {\n    if (typeof sessionStorage === 'undefined') return false;\n    return sessionStorage.getItem(FLASH_DISMISS_KEY) === getTodayKey();\n  });\n  const [isExpired, setIsExpired] = useState(false);\n\n  function calculateTimeLeft() {\n    const end = endTime instanceof Date ? endTime : new Date(endTime);\n    const diff = end - new Date();\n    if (diff <= 0) return { hours: 0, minutes: 0, seconds: 0 };\n    return {\n      hours: Math.floor(diff / (1000 * 60 * 60)),\n      minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),\n      seconds: Math.floor((diff % (1000 * 60)) / 1000)\n    };\n  }\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const newTime = calculateTimeLeft();\n      setTimeLeft(newTime);\n      if (newTime.hours === 0 && newTime.minutes === 0 && newTime.seconds === 0) {\n        setIsExpired(true);\n        clearInterval(timer);\n      }\n    }, 1000);\n    return () => clearInterval(timer);\n  }, [endTime]);\n\n  useEffect(() => {\n    if (isPaused) return;\n    const offerTimer = setInterval(() => {\n      setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    }, 4500);\n    return () => clearInterval(offerTimer);\n  }, [isPaused]);\n\n  const goToOffer = (idx) => {\n    setOfferIndex(idx);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleTouchStart = (e) => {\n    touchStartX.current = e.touches?.[0]?.clientX ?? e.clientX;\n    setIsPaused(true);\n  };\n\n  const handleTouchEnd = (e) => {\n    const endX = e.changedTouches?.[0]?.clientX ?? e.clientX;\n    const diff = touchStartX.current - endX;\n    if (Math.abs(diff) > 50) {\n      if (diff > 0) {\n        setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n      } else {\n        setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n      }\n    }\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handlePrev = () => {\n    setOfferIndex((i) => (i - 1 + FLASH_OFFERS.length) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleNext = () => {\n    setOfferIndex((i) => (i + 1) % FLASH_OFFERS.length);\n    setIsPaused(true);\n    setTimeout(() => setIsPaused(false), 3000);\n  };\n\n  const handleDismiss = () => {\n    try {\n      sessionStorage.setItem(FLASH_DISMISS_KEY, getTodayKey());\n    } catch (_) {}\n    setIsDismissed(true);\n    onDismiss?.();\n  };\n\n  if (isDismissed || isExpired) return null;\n\n  const pad = (n) => String(n).padStart(2, '0');\n\n  /* Time-left progress: assume 24h sale duration so bar shrinks as time runs out */\n  const TOTAL_SALE_MS = 24 * 60 * 60 * 1000;\n  const remainingMs = timeLeft.hours * 3600000 + timeLeft.minutes * 60000 + timeLeft.seconds * 1000;\n  const timeLeftProgress = Math.min(100, (remainingMs / TOTAL_SALE_MS) * 100);\n\n  return (\n    <div\n      className={`relative bg-gradient-to-r ${bgGradient} overflow-hidden rounded-xl sm:rounded-2xl shadow-xl transition-all duration-500`}\n      onTouchStart={handleTouchStart}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Animated shine effect */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/15 to-transparent -skew-x-12 animate-[shimmer_3s_infinite]\" \n          style={{ animation: 'shimmer 3s infinite', transform: 'translateX(-100%)' }} />\n      </div>\n\n      {/* Decorative: subtle floating orbs */}\n      <div className=\"absolute top-1/4 right-1/4 w-24 h-24 rounded-full bg-white/5 blur-2xl pointer-events-none\" aria-hidden />\n      <div className=\"absolute bottom-1/3 left-1/4 w-16 h-16 rounded-full bg-white/10 blur-xl pointer-events-none\" aria-hidden />\n\n      {/* Dismiss  egyetlen gomb, absolute top-right */}\n      <button\n        type=\"button\"\n        onClick={handleDismiss}\n        className=\"absolute top-4 right-4 z-20 min-w-[44px] min-h-[44px] flex items-center justify-center p-2 text-white/60 hover:text-white rounded-full hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Banner elrejtse ma\"\n      >\n        <X className=\"w-4 h-4 sm:w-5 sm:h-5\" />\n      </button>\n\n      {/* Egyetlen responsive layout  flex-col mobil, flex-row desktop */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 lg:gap-6 px-4 sm:px-6 lg:px-8 py-4 sm:py-5 lg:py-6 pr-14 min-h-[200px] sm:min-h-0 pb-16 sm:pb-5 max-w-[1200px] mx-auto\">\n        {/* Bal: Icon + Title + Badge + Subtitle (desktop) */}\n        <div className=\"flex items-center gap-2 sm:gap-3 min-w-0 flex-shrink\">\n          <div className=\"w-8 h-8 sm:w-10 sm:h-10 lg:w-11 lg:h-11 bg-white/20 backdrop-blur-sm rounded-lg sm:rounded-xl flex items-center justify-center flex-shrink-0\">\n            <Flame className=\"w-5 h-5 sm:w-6 sm:h-6 lg:w-7 lg:h-7 text-white animate-pulse\" />\n          </div>\n          <div className=\"min-w-0 flex-1\">\n            <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n              <span key={`title-${offerIndex}`} className=\"font-black text-white text-sm sm:text-base lg:text-lg flash-offer-enter inline-block\">{displayTitle}</span>\n              <span className=\"px-1.5 sm:px-2 py-0.5 bg-yellow-400 text-yellow-900 text-[10px] sm:text-xs font-black rounded sm:rounded-md animate-pulse shrink-0\">\n                {currentOffer.badge}\n              </span>\n            </div>\n            <p key={`sub-${offerIndex}`} className=\"text-white/80 text-xs lg:text-sm flash-offer-enter line-clamp-2 mt-0.5 hidden sm:block\">{displaySubtitle}</p>\n          </div>\n        </div>\n\n        {/* Kzp: Countdown  rvid cmkk (, p, mp) mindkt nzetben */}\n        <div className=\"flex items-center justify-center sm:justify-start gap-1 sm:gap-2\">\n          <Clock className=\"w-4 h-4 sm:w-5 sm:h-5 text-white/80 flex-shrink-0\" />\n          <span className=\"text-white/80 sm:text-white/90 text-xs sm:text-sm font-medium mr-1 sm:mr-0\">Lejr:</span>\n          <div className=\"flex items-center gap-1\">\n            {[\n              { value: timeLeft.hours, label: '' },\n              { value: timeLeft.minutes, label: 'p' },\n              { value: timeLeft.seconds, label: 'mp' }\n            ].map((unit, idx) => (\n              <React.Fragment key={idx}>\n                <div className=\"bg-black/30 backdrop-blur-sm rounded sm:rounded-lg px-2 sm:px-2.5 lg:px-3 py-1 sm:py-1.5\">\n                  <span className=\"flash-countdown-digit text-white font-black text-lg sm:text-xl lg:text-2xl tabular-nums inline-block\">{pad(unit.value)}</span>\n                  <span className=\"text-white/70 text-[10px] lg:text-xs ml-0.5 sm:ml-1\">{unit.label}</span>\n                </div>\n                {idx < 2 && <span className=\"text-white/40 font-bold\">:</span>}\n              </React.Fragment>\n            ))}\n          </div>\n        </div>\n\n        {/* Jobb: CTA  full width mobil, auto desktop */}\n        <button\n          type=\"button\"\n          onClick={onViewSale}\n          className={`w-full sm:w-auto min-h-[44px] flex items-center justify-center gap-2 px-4 sm:px-5 lg:px-6 py-3 sm:py-2.5 bg-white ${ctaColor} font-bold text-sm sm:text-base rounded-lg sm:rounded-xl shadow-lg hover:shadow-xl active:scale-[0.98] sm:hover:scale-[1.02] transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-current`}\n          aria-label={displayCta}\n        >\n          <Zap className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n          <span key={offerIndex} className=\"animate-fade-in sm:hidden\">{displayCta}</span>\n          <span key={`short-${offerIndex}`} className=\"animate-fade-in hidden sm:inline\">{displayCtaShort}</span>\n          <ArrowRight className=\"w-4 h-4 lg:w-5 lg:h-5\" aria-hidden />\n        </button>\n      </div>\n\n      {/* Dots  egyetlen sor, absolute mobil (progress fltt), normal flow desktop */}\n      <div className=\"absolute bottom-10 sm:static left-0 right-0 flex justify-center gap-2 py-0 sm:py-4 z-10\" role=\"tablist\" aria-label=\"Ajnlat vltsa\">\n        {FLASH_OFFERS.map((_, i) => (\n          <button\n            key={i}\n            type=\"button\"\n            role=\"tab\"\n            aria-selected={offerIndex === i}\n            onClick={() => goToOffer(i)}\n            className={`w-3 h-3 rounded-full transition-all duration-200 min-w-[12px] min-h-[12px] focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-600 ${\n              offerIndex === i ? 'bg-white scale-125 shadow-lg' : 'bg-white/50 hover:bg-white/80'\n            }`}\n            aria-label={`Ajnlat ${i + 1}`}\n          />\n        ))}\n      </div>\n\n      {/* Desktop: nyilak */}\n      <button\n        type=\"button\"\n        onClick={handlePrev}\n        className=\"hidden sm:flex absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Elz ajnlat\"\n      >\n        <ChevronLeft className=\"w-5 h-5\" />\n      </button>\n      <button\n        type=\"button\"\n        onClick={handleNext}\n        className=\"hidden sm:flex absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 backdrop-blur-sm items-center justify-center text-white transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-white/50\"\n        aria-label=\"Kvetkez ajnlat\"\n      >\n        <ChevronRight className=\"w-5 h-5\" />\n      </button>\n\n      {/* Time-left progress bar  shrinks as countdown runs out */}\n      <div className=\"absolute bottom-0 left-0 right-0 h-1 bg-black/20\" aria-hidden=\"true\">\n        <div className=\"h-full bg-white/60 transition-[width] duration-1000 ease-linear\" style={{ width: `${timeLeftProgress}%` }} />\n      </div>\n\n      <style>{`\n        @keyframes shimmer {\n          0% { transform: translateX(-100%) skewX(-12deg); }\n          100% { transform: translateX(200%) skewX(-12deg); }\n        }\n        @keyframes flash-slide-in {\n          from { opacity: 0; transform: translateX(12px); }\n          to { opacity: 1; transform: translateX(0); }\n        }\n        .flash-offer-enter {\n          animation: flash-slide-in 0.35s ease-out forwards;\n        }\n      `}</style>\n    </div>\n  );\n};\n\nexport default FlashSaleBanner;\n","import React, { useState, useMemo } from 'react';\nimport { Truck, Clock, MapPin, CheckCircle, Package, Calendar, Zap, Info } from 'lucide-react';\n\n/**\n * DeliveryEstimator - Shows estimated delivery date based on location\n * Features: Postal code lookup, express delivery option, store pickup\n */\nconst DeliveryEstimator = ({ \n  product, \n  variant = 'compact' // 'compact' | 'full'\n}) => {\n  const [postalCode, setPostalCode] = useState('');\n  const [isChecking, setIsChecking] = useState(false);\n  const [deliveryInfo, setDeliveryInfo] = useState(null);\n\n  // Simulated delivery calculation\n  const calculateDelivery = (code) => {\n    setIsChecking(true);\n    \n    // Simulate API call\n    setTimeout(() => {\n      const isBudapest = code.startsWith('1');\n      const isLargeCity = ['2', '3', '4', '5', '6', '7', '8', '9'].some(n => code.startsWith(n) && parseInt(code) < 5000);\n      \n      const today = new Date();\n      const standardDays = isBudapest ? 2 : isLargeCity ? 3 : 5;\n      const expressDays = isBudapest ? 1 : 2;\n      \n      const standardDate = new Date(today);\n      standardDate.setDate(standardDate.getDate() + standardDays);\n      \n      const expressDate = new Date(today);\n      expressDate.setDate(expressDate.getDate() + expressDays);\n\n      setDeliveryInfo({\n        postalCode: code,\n        city: isBudapest ? 'Budapest' : isLargeCity ? 'Nagyvros' : 'Vidk',\n        standard: {\n          date: standardDate,\n          days: standardDays,\n          price: 0, // Free\n          available: true\n        },\n        express: {\n          date: expressDate,\n          days: expressDays,\n          price: 2990,\n          available: isBudapest || isLargeCity\n        },\n        pickup: {\n          available: isBudapest,\n          stores: isBudapest ? ['Budapest - Westend', 'Budapest - rkd'] : []\n        }\n      });\n      \n      setIsChecking(false);\n    }, 800);\n  };\n\n  const formatDate = (date) => {\n    const days = ['Vasrnap', 'Htf', 'Kedd', 'Szerda', 'Cstrtk', 'Pntek', 'Szombat'];\n    const months = ['jan.', 'feb.', 'mrc.', 'pr.', 'mj.', 'jn.', 'jl.', 'aug.', 'szept.', 'okt.', 'nov.', 'dec.'];\n    \n    return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}.`;\n  };\n\n  // Default delivery estimate without postal code\n  const defaultEstimate = useMemo(() => {\n    const today = new Date();\n    const minDate = new Date(today);\n    minDate.setDate(minDate.getDate() + 2);\n    const maxDate = new Date(today);\n    maxDate.setDate(maxDate.getDate() + 5);\n    \n    return {\n      minDays: 2,\n      maxDays: 5,\n      minDate,\n      maxDate\n    };\n  }, []);\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"flex items-center gap-3 p-3 bg-green-50 border border-green-100 rounded-xl\">\n        <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n          <Truck className=\"w-5 h-5 text-green-600\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          {deliveryInfo ? (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts: {formatDate(deliveryInfo.standard.date)}\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                {deliveryInfo.city}  Ingyenes szllts\n              </p>\n            </>\n          ) : (\n            <>\n              <p className=\"font-bold text-green-800 text-sm\">\n                Kiszllts {defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanapon bell\n              </p>\n              <p className=\"text-green-600 text-xs\">\n                50.000 Ft felett ingyenes\n              </p>\n            </>\n          )}\n        </div>\n        {!deliveryInfo && (\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"text\"\n              value={postalCode}\n              onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n              placeholder=\"Ir.szm\"\n              className=\"w-16 px-2 py-1.5 text-xs border border-gray-200 rounded-lg focus:border-green-500 focus:ring-1 focus:ring-green-200 outline-none\"\n              maxLength={4}\n            />\n            <button\n              onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n              disabled={postalCode.length !== 4 || isChecking}\n              className=\"px-3 py-1.5 bg-green-600 text-white text-xs font-bold rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {isChecking ? '...' : 'OK'}\n            </button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"bg-white border border-gray-200 rounded-2xl p-5\">\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center text-white\">\n          <Truck className=\"w-6 h-6\" />\n        </div>\n        <div>\n          <h3 className=\"font-bold text-gray-900\">Szllts & tvtel</h3>\n          <p className=\"text-sm text-gray-500\">Add meg az irnytszmot a pontos idpontrt</p>\n        </div>\n      </div>\n\n      {/* Postal code input */}\n      <div className=\"flex gap-2 mb-5\">\n        <div className=\"relative flex-1\">\n          <MapPin className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n          <input\n            type=\"text\"\n            value={postalCode}\n            onChange={(e) => setPostalCode(e.target.value.replace(/\\D/g, '').slice(0, 4))}\n            placeholder=\"Irnytszm (pl. 1052)\"\n            className=\"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-100 outline-none transition-all\"\n            maxLength={4}\n          />\n        </div>\n        <button\n          onClick={() => postalCode.length === 4 && calculateDelivery(postalCode)}\n          disabled={postalCode.length !== 4 || isChecking}\n          className=\"px-6 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n        >\n          {isChecking ? (\n            <>\n              <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n              Keress\n            </>\n          ) : (\n            <>\n              <Clock className=\"w-5 h-5\" />\n              Ellenrzs\n            </>\n          )}\n        </button>\n      </div>\n\n      {/* Results */}\n      {deliveryInfo ? (\n        <div className=\"space-y-3\">\n          {/* Standard delivery */}\n          <div className=\"flex items-center gap-4 p-4 bg-green-50 border border-green-200 rounded-xl\">\n            <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n              <Truck className=\"w-5 h-5 text-green-600\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <p className=\"font-bold text-green-800\">Standard szllts</p>\n                <span className=\"px-2 py-0.5 bg-green-200 text-green-800 text-xs font-bold rounded-full\">INGYENES</span>\n              </div>\n              <p className=\"text-green-700 text-sm\">\n                Megrkezik: <strong>{formatDate(deliveryInfo.standard.date)}</strong>\n              </p>\n            </div>\n            <CheckCircle className=\"w-6 h-6 text-green-500\" />\n          </div>\n\n          {/* Express delivery */}\n          {deliveryInfo.express.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-amber-50 border border-amber-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center shrink-0\">\n                <Zap className=\"w-5 h-5 text-amber-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  <p className=\"font-bold text-amber-800\">Express szllts</p>\n                  <span className=\"px-2 py-0.5 bg-amber-200 text-amber-800 text-xs font-bold rounded-full\">\n                    +{deliveryInfo.express.price.toLocaleString('hu-HU')} Ft\n                  </span>\n                </div>\n                <p className=\"text-amber-700 text-sm\">\n                  Megrkezik: <strong>{formatDate(deliveryInfo.express.date)}</strong>\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Store pickup */}\n          {deliveryInfo.pickup.available && (\n            <div className=\"flex items-center gap-4 p-4 bg-blue-50 border border-blue-200 rounded-xl\">\n              <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Package className=\"w-5 h-5 text-blue-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-bold text-blue-800\">Szemlyes tvtel</p>\n                <p className=\"text-blue-700 text-sm\">\n                  {deliveryInfo.pickup.stores.join('  ')}\n                </p>\n              </div>\n              <span className=\"px-2 py-0.5 bg-blue-200 text-blue-800 text-xs font-bold rounded-full\">INGYENES</span>\n            </div>\n          )}\n        </div>\n      ) : (\n        /* Default estimate */\n        <div className=\"bg-gray-50 rounded-xl p-4\">\n          <div className=\"flex items-start gap-3\">\n            <Info className=\"w-5 h-5 text-gray-400 shrink-0 mt-0.5\" />\n            <div>\n              <p className=\"text-gray-700\">\n                A vrhat szlltsi id <strong>{defaultEstimate.minDays}-{defaultEstimate.maxDays} munkanap</strong>.\n                Add meg az irnytszmot a pontos dtumrt!\n              </p>\n              <p className=\"text-gray-500 text-sm mt-1\">\n                50.000 Ft feletti rendelsnl ingyenes hzhozszllts.\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DeliveryEstimator;\n","import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, Eye, ShoppingCart, Clock, TrendingUp, Users, Package } from 'lucide-react';\n\n/**\n * StockUrgency - Creates urgency with stock levels and real-time activity\n * Shows: Low stock warnings, recent purchases, viewing count\n */\nconst StockUrgency = ({ \n  product, \n  variant = 'full' // 'full' | 'compact' | 'badge'\n}) => {\n  const [viewingCount, setViewingCount] = useState(0);\n  const [recentPurchases, setRecentPurchases] = useState(0);\n  const [lastPurchaseTime, setLastPurchaseTime] = useState(null);\n\n  // Simulated real-time data (in production this would come from websocket/API)\n  useEffect(() => {\n    // Random initial values\n    setViewingCount(Math.floor(Math.random() * 15) + 3);\n    setRecentPurchases(Math.floor(Math.random() * 8) + 1);\n    \n    // Random last purchase time (within last hour)\n    const minutes = Math.floor(Math.random() * 45) + 5;\n    setLastPurchaseTime(minutes);\n\n    // Simulate activity updates\n    const viewInterval = setInterval(() => {\n      setViewingCount(prev => {\n        const change = Math.random() > 0.5 ? 1 : -1;\n        return Math.max(2, Math.min(25, prev + change));\n      });\n    }, 15000);\n\n    const purchaseInterval = setInterval(() => {\n      if (Math.random() > 0.7) {\n        setRecentPurchases(prev => prev + 1);\n        setLastPurchaseTime(Math.floor(Math.random() * 5) + 1);\n      }\n    }, 30000);\n\n    return () => {\n      clearInterval(viewInterval);\n      clearInterval(purchaseInterval);\n    };\n  }, [product?.id]);\n\n  if (!product) return null;\n\n  // Simulated stock level (in production from product data)\n  const stockLevel = product.stockLevel || Math.floor(Math.random() * 20) + 1;\n  const isLowStock = stockLevel <= 5;\n  const isVeryLowStock = stockLevel <= 2;\n  const isOutOfStock = stockLevel === 0;\n\n  // Badge variant - just shows stock status\n  if (variant === 'badge') {\n    if (isOutOfStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-full\">\n          <Package className=\"w-3 h-3\" />\n          Elfogyott\n        </span>\n      );\n    }\n    \n    if (isVeryLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full animate-pulse\">\n          <AlertTriangle className=\"w-3 h-3\" />\n          Utols {stockLevel} db!\n        </span>\n      );\n    }\n    \n    if (isLowStock) {\n      return (\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n          <Clock className=\"w-3 h-3\" />\n          Mg {stockLevel} db\n        </span>\n      );\n    }\n    \n    return (\n      <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n        <Package className=\"w-3 h-3\" />\n        Raktron\n      </span>\n    );\n  }\n\n  // Compact variant\n  if (variant === 'compact') {\n    return (\n      <div className=\"space-y-2\">\n        {/* Stock level */}\n        {isLowStock && !isOutOfStock && (\n          <div className={`flex items-center gap-2 px-3 py-2 rounded-lg ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n            <AlertTriangle className={`w-4 h-4 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n            <span className={`text-sm font-bold ${isVeryLowStock ? 'text-red-700' : 'text-amber-700'}`}>\n              {isVeryLowStock ? `Csak ${stockLevel} db maradt!` : `Mr csak ${stockLevel} db raktron`}\n            </span>\n          </div>\n        )}\n\n        {/* Viewing count */}\n        <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n          <Eye className=\"w-4 h-4 text-primary-500\" />\n          <span>{viewingCount} ember nzi most</span>\n        </div>\n      </div>\n    );\n  }\n\n  // Full variant\n  return (\n    <div className=\"space-y-3\">\n      {/* Stock warning */}\n      {isOutOfStock ? (\n        <div className=\"flex items-center gap-3 p-4 bg-gray-100 border border-gray-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-gray-500\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-gray-700\">Jelenleg nincs raktron</p>\n            <p className=\"text-gray-500 text-sm\">rtestst krhetsz az jbli elrhetsgrl</p>\n          </div>\n        </div>\n      ) : isLowStock ? (\n        <div className={`flex items-center gap-3 p-4 rounded-xl ${isVeryLowStock ? 'bg-red-50 border border-red-200' : 'bg-amber-50 border border-amber-200'}`}>\n          <div className={`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${isVeryLowStock ? 'bg-red-100' : 'bg-amber-100'}`}>\n            <AlertTriangle className={`w-5 h-5 ${isVeryLowStock ? 'text-red-500 animate-pulse' : 'text-amber-500'}`} />\n          </div>\n          <div className=\"flex-1\">\n            <p className={`font-bold ${isVeryLowStock ? 'text-red-800' : 'text-amber-800'}`}>\n              {isVeryLowStock ? ' Utols darabok!' : 'Alacsony kszlet'}\n            </p>\n            <p className={`text-sm ${isVeryLowStock ? 'text-red-600' : 'text-amber-600'}`}>\n              Mr csak <strong>{stockLevel} db</strong> van raktron\n            </p>\n          </div>\n          {/* Progress bar */}\n          <div className=\"w-16\">\n            <div className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <div \n                className={`h-full transition-all ${isVeryLowStock ? 'bg-red-500' : 'bg-amber-500'}`}\n                style={{ width: `${Math.max(10, (stockLevel / 20) * 100)}%` }}\n              />\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl\">\n          <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <Package className=\"w-5 h-5 text-green-600\" />\n          </div>\n          <div>\n            <p className=\"font-bold text-green-800\"> Raktron</p>\n            <p className=\"text-green-600 text-sm\">Azonnali szlltsra ksz</p>\n          </div>\n        </div>\n      )}\n\n      {/* Social proof - viewing & purchases */}\n      {!isOutOfStock && (\n        <div className=\"grid grid-cols-2 gap-3\">\n          {/* Currently viewing */}\n          <div className=\"flex items-center gap-2 p-3 bg-primary-50 rounded-xl\">\n            <div className=\"relative\">\n              <Eye className=\"w-5 h-5 text-primary-500\" />\n              <span className=\"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n            </div>\n            <div>\n              <p className=\"text-lg font-bold text-primary-600\">{viewingCount}</p>\n              <p className=\"text-[10px] text-primary-500\">nzi most</p>\n            </div>\n          </div>\n\n          {/* Recent purchases */}\n          <div className=\"flex items-center gap-2 p-3 bg-secondary-50 rounded-xl\">\n            <ShoppingCart className=\"w-5 h-5 text-secondary-700\" />\n            <div>\n              <p className=\"text-lg font-bold text-secondary-700\">{recentPurchases}</p>\n              <p className=\"text-[10px] text-secondary-700\">vette meg ma</p>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Last purchase notification */}\n      {!isOutOfStock && lastPurchaseTime && lastPurchaseTime <= 30 && (\n        <div className=\"flex items-center gap-2 p-2.5 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100 rounded-lg animate-fade-in\">\n          <div className=\"w-6 h-6 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n            <TrendingUp className=\"w-3.5 h-3.5 text-green-600\" />\n          </div>\n          <p className=\"text-xs text-green-700\">\n            <strong>Valaki most vette meg</strong> {lastPurchaseTime} perce {product.city || 'Budapest'}bl\n          </p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default StockUrgency;\n","import React, { useState } from 'react';\nimport { Share2, Copy, Check, Facebook, MessageCircle, Mail, Link2, X } from 'lucide-react';\nimport { useScrollLock } from '../../hooks/useScrollLock';\n\n/**\n * ProductShare - Share product via social media or copy link\n * Features: Native share API, social links, copy link, QR code\n */\nconst ProductShare = ({ \n  product, \n  variant = 'button' // 'button' | 'icons' | 'modal'\n}) => {\n  const [showModal, setShowModal] = useState(false);\n  const [copied, setCopied] = useState(false);\n  useScrollLock(showModal);\n\n  if (!product) return null;\n\n  const shareUrl = product.link || window.location.href;\n  const shareTitle = product.name;\n  const shareText = `Nzd meg ezt a termket: ${product.name} - ${(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft`;\n\n  const handleNativeShare = async () => {\n    if (navigator.share) {\n      try {\n        await navigator.share({\n          title: shareTitle,\n          text: shareText,\n          url: shareUrl\n        });\n      } catch (err) {\n        if (err.name !== 'AbortError') {\n          setShowModal(true);\n        }\n      }\n    } else {\n      setShowModal(true);\n    }\n  };\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy:', err);\n    }\n  };\n\n  const shareLinks = [\n    {\n      name: 'Facebook',\n      icon: Facebook,\n      color: 'bg-blue-600 hover:bg-blue-700',\n      url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'Messenger',\n      icon: MessageCircle,\n      color: 'bg-gradient-to-r from-blue-500 to-secondary-600 hover:from-blue-600 hover:to-secondary-700',\n      url: `fb-messenger://share/?link=${encodeURIComponent(shareUrl)}`\n    },\n    {\n      name: 'WhatsApp',\n      icon: () => (\n        <svg viewBox=\"0 0 24 24\" fill=\"currentColor\" className=\"w-5 h-5\">\n          <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\n        </svg>\n      ),\n      color: 'bg-green-500 hover:bg-green-600',\n      url: `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`\n    },\n    {\n      name: 'Email',\n      icon: Mail,\n      color: 'bg-gray-600 hover:bg-gray-700',\n      url: `mailto:?subject=${encodeURIComponent(shareTitle)}&body=${encodeURIComponent(shareText + '\\n\\n' + shareUrl)}`\n    }\n  ];\n\n  // Button variant - single button that opens native share or modal\n  if (variant === 'button') {\n    return (\n      <>\n        <button\n          onClick={handleNativeShare}\n          className=\"flex items-center gap-2 px-4 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n        >\n          <Share2 className=\"w-4 h-4\" />\n          <span>Megoszts</span>\n        </button>\n\n        {/* Modal */}\n        {showModal && (\n          <ShareModal\n            product={product}\n            shareLinks={shareLinks}\n            shareUrl={shareUrl}\n            copied={copied}\n            onCopy={handleCopyLink}\n            onClose={() => setShowModal(false)}\n          />\n        )}\n      </>\n    );\n  }\n\n  // Icons variant - row of social icons\n  if (variant === 'icons') {\n    return (\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-sm text-gray-500 mr-1\">Megoszts:</span>\n        {shareLinks.map((link) => (\n          <a\n            key={link.name}\n            href={link.url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className={`p-2 rounded-full text-white transition-all hover:scale-110 ${link.color}`}\n            title={link.name}\n          >\n            <link.icon className=\"w-4 h-4\" />\n          </a>\n        ))}\n        <button\n          onClick={handleCopyLink}\n          className={`p-2 rounded-full transition-all hover:scale-110 ${\n            copied ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'\n          }`}\n          title=\"Link msolsa\"\n        >\n          {copied ? <Check className=\"w-4 h-4\" /> : <Link2 className=\"w-4 h-4\" />}\n        </button>\n      </div>\n    );\n  }\n\n  return null;\n};\n\n// Share Modal Component\nconst ShareModal = ({ product, shareLinks, shareUrl, copied, onCopy, onClose }) => {\n  return (\n    <div \n      className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-end sm:items-center justify-center p-4 bg-black/50 backdrop-blur-sm\"\n      onClick={onClose}\n    >\n      <div \n        className=\"w-full max-w-md bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-hidden animate-slide-up\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"p-5 border-b border-gray-100\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-lg font-bold text-gray-900\">Termk megosztsa</h3>\n            <button\n              onClick={onClose}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Product preview */}\n        <div className=\"p-5\">\n          <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl mb-5\">\n            <img\n              src={product.images?.[0] || product.image}\n              alt={product.name}\n              className=\"w-16 h-16 object-contain bg-white rounded-lg\"\n            />\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"font-medium text-gray-900 text-sm line-clamp-2\">{product.name}</p>\n              <p className=\"text-primary-500 font-bold\">\n                {(product.salePrice || product.price || 0).toLocaleString('hu-HU')} Ft\n              </p>\n            </div>\n          </div>\n\n          {/* Share options */}\n          <div className=\"grid grid-cols-4 gap-3 mb-5\">\n            {shareLinks.map((link) => (\n              <a\n                key={link.name}\n                href={link.url}\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex flex-col items-center gap-2 p-3 rounded-xl hover:bg-gray-50 transition-colors\"\n              >\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white ${link.color}`}>\n                  <link.icon className=\"w-5 h-5\" />\n                </div>\n                <span className=\"text-xs text-gray-600\">{link.name}</span>\n              </a>\n            ))}\n          </div>\n\n          {/* Copy link */}\n          <div className=\"flex gap-2\">\n            <div className=\"flex-1 flex items-center gap-2 px-4 py-3 bg-gray-100 rounded-xl overflow-hidden\">\n              <Link2 className=\"w-4 h-4 text-gray-400 shrink-0\" />\n              <span className=\"text-sm text-gray-600 truncate\">{shareUrl}</span>\n            </div>\n            <button\n              onClick={onCopy}\n              className={`px-4 py-3 font-bold rounded-xl transition-all flex items-center gap-2 ${\n                copied \n                  ? 'bg-green-500 text-white' \n                  : 'bg-primary-500 text-white hover:bg-primary-600'\n              }`}\n            >\n              {copied ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Msolva!\n                </>\n              ) : (\n                <>\n                  <Copy className=\"w-4 h-4\" />\n                  Msols\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.3s ease-out; }\n      `}</style>\n    </div>\n  );\n};\n\nexport default ProductShare;\n","import React, { useState } from 'react';\nimport { FileText, Ruler, Star, MessageCircle, Truck, Shield, HelpCircle, ChevronDown, ChevronUp, Check } from 'lucide-react';\n\n/**\n * ProductTabs - Tabbed content for product details\n * Features: Description, Specs, Reviews, Q&A, Shipping, Warranty\n */\nconst ProductTabs = ({ product }) => {\n  const [activeTab, setActiveTab] = useState('description');\n  const [expandedFaq, setExpandedFaq] = useState(null);\n\n  const tabs = [\n    { id: 'description', label: 'Lers', icon: FileText },\n    { id: 'specs', label: 'Adatok', icon: Ruler },\n    { id: 'reviews', label: 'Vlemnyek', icon: Star, badge: '24' },\n    { id: 'faq', label: 'Krdsek', icon: HelpCircle },\n    { id: 'shipping', label: 'Szllts', icon: Truck },\n  ];\n\n  // Parse specs from product params\n  const specs = product?.params \n    ? product.params.split(',').map(p => {\n        const [name, value] = p.split(':').map(s => s.trim());\n        return { name, value: value || name };\n      }).filter(s => s.name)\n    : [];\n\n  // Simulated reviews\n  const reviews = [\n    { id: 1, author: 'Kovcs Anna', rating: 5, date: '2025-01-15', text: 'Nagyon szp termk, pont ilyen kellett! A minsg kivl, gyors szllts.', verified: true },\n    { id: 2, author: 'Nagy Pter', rating: 4, date: '2025-01-10', text: 'J r-rtk arny. Egy csillagot levonok mert kicsit nehz volt sszerakni.', verified: true },\n    { id: 3, author: 'Szab va', rating: 5, date: '2025-01-05', text: 'Gynyr! Nagyon elgedett vagyok, ajnlom mindenkinek.', verified: false },\n  ];\n\n  const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;\n\n  // FAQ items\n  const faqItems = [\n    { q: 'Mennyi id alatt rkezik meg?', a: 'A standard szlltsi id 2-5 munkanap, expressz szlltssal 1-2 nap.' },\n    { q: 'Milyen garancit kapok?', a: 'Minden termknkre 2 v gyrti garancia vonatkozik. Ezen fell 14 napos elllsi jog.' },\n    { q: 'Szemlyesen is tvehet?', a: 'Igen, budapesti zleteinkben szemlyesen is tvehet ingyenesen.' },\n    { q: 'Hogyan kell sszeszerelni?', a: 'A termkhez rszletes magyar nyelv sszeszerelsi tmutat tartozik. Igny esetn szakembernk is segt.' },\n  ];\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden\">\n      {/* Tab buttons - UNIFIED TYPOGRAPHY */}\n      <div className=\"flex overflow-x-auto border-b border-gray-200 scrollbar-hide\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            onClick={() => setActiveTab(tab.id)}\n            className={`\n              flex items-center gap-2.5 px-5 sm:px-6 py-4 font-medium text-base whitespace-nowrap border-b-2 transition-all\n              ${activeTab === tab.id \n                ? 'border-primary-500 text-primary-500 bg-primary-50/50' \n                : 'border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n              }\n            `}\n          >\n            <tab.icon className=\"w-5 h-5\" />\n            <span>{tab.label}</span>\n            {tab.badge && (\n              <span className={`px-2 py-0.5 text-sm rounded-full ${\n                activeTab === tab.id ? 'bg-primary-100 text-primary-600' : 'bg-gray-100 text-gray-600'\n              }`}>\n                {tab.badge}\n              </span>\n            )}\n          </button>\n        ))}\n      </div>\n\n      {/* Tab content - UNIFIED TYPOGRAPHY */}\n      <div className=\"p-5 sm:p-6 lg:p-8\">\n        {/* Description */}\n        {activeTab === 'description' && (\n          <div className=\"prose max-w-none text-gray-700\">\n            <p className=\"text-base sm:text-lg leading-relaxed\">\n              {product?.description || 'Nincs rszletes lers ehhez a termkhez.'}\n            </p>\n            \n            {/* Features list */}\n            <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4\">\n              {['Prmium minsg anyagok', 'Knny sszeszerels', 'Modern dizjn', 'Tarts kivitelezs'].map((feature, idx) => (\n                <div key={idx} className=\"flex items-center gap-2.5 text-green-700\">\n                  <Check className=\"w-5 h-5 text-green-500\" />\n                  <span className=\"text-base\">{feature}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Specifications */}\n        {activeTab === 'specs' && (\n          <div>\n            {specs.length > 0 ? (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                {specs.map((spec, idx) => (\n                  <div key={idx} className=\"flex justify-between p-4 bg-gray-50 rounded-lg\">\n                    <span className=\"text-gray-600 text-base\">{spec.name}</span>\n                    <span className=\"font-medium text-gray-900 text-base\">{spec.value}</span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-gray-500 text-center py-8 text-base\">Nincs elrhet mszaki adat.</p>\n            )}\n          </div>\n        )}\n\n        {/* Reviews - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'reviews' && (\n          <div>\n            {/* Summary */}\n            <div className=\"flex items-center gap-6 p-5 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl mb-6\">\n              <div className=\"text-center\">\n                <p className=\"text-4xl sm:text-5xl font-bold text-amber-600\">{avgRating.toFixed(1)}</p>\n                <div className=\"flex justify-center mt-2\">\n                  {[1,2,3,4,5].map(star => (\n                    <Star \n                      key={star} \n                      className={`w-5 h-5 ${star <= avgRating ? 'text-amber-400 fill-amber-400' : 'text-gray-300'}`} \n                    />\n                  ))}\n                </div>\n                <p className=\"text-sm text-gray-500 mt-1\">{reviews.length} vlemny</p>\n              </div>\n              <div className=\"flex-1\">\n                {[5,4,3,2,1].map(rating => {\n                  const count = reviews.filter(r => r.rating === rating).length;\n                  const percent = (count / reviews.length) * 100;\n                  return (\n                    <div key={rating} className=\"flex items-center gap-2 mb-1.5\">\n                      <span className=\"text-sm text-gray-500 w-4\">{rating}</span>\n                      <Star className=\"w-4 h-4 text-amber-400 fill-amber-400\" />\n                      <div className=\"flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden\">\n                        <div className=\"h-full bg-amber-400 rounded-full\" style={{ width: `${percent}%` }} />\n                      </div>\n                      <span className=\"text-sm text-gray-400 w-6\">{count}</span>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Review list */}\n            <div className=\"space-y-5\">\n              {reviews.map((review) => (\n                <div key={review.id} className=\"border-b border-gray-100 pb-5 last:border-0\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center text-primary-500 font-bold text-base\">\n                        {review.author.charAt(0)}\n                      </div>\n                      <div>\n                        <p className=\"font-medium text-gray-900 text-base flex items-center gap-2\">\n                          {review.author}\n                          {review.verified && (\n                            <span className=\"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded\"> Ellenrztt</span>\n                          )}\n                        </p>\n                        <p className=\"text-sm text-gray-400\">{new Date(review.date).toLocaleDateString('hu-HU')}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex\">\n                      {[1,2,3,4,5].map(star => (\n                        <Star \n                          key={star} \n                          className={`w-5 h-5 ${star <= review.rating ? 'text-amber-400 fill-amber-400' : 'text-gray-200'}`}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                  <p className=\"text-gray-700 text-base\">{review.text}</p>\n                </div>\n              ))}\n            </div>\n\n            {/* Write review button */}\n            <button className=\"w-full mt-5 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors\">\n              + Vlemny rsa\n            </button>\n          </div>\n        )}\n\n        {/* FAQ - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'faq' && (\n          <div className=\"space-y-3\">\n            {faqItems.map((item, idx) => (\n              <div \n                key={idx}\n                className=\"border border-gray-200 rounded-xl overflow-hidden\"\n              >\n                <button\n                  onClick={() => setExpandedFaq(expandedFaq === idx ? null : idx)}\n                  className=\"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 transition-colors\"\n                >\n                  <span className=\"font-medium text-gray-900 text-base\">{item.q}</span>\n                  {expandedFaq === idx ? (\n                    <ChevronUp className=\"w-5 h-5 text-gray-400\" />\n                  ) : (\n                    <ChevronDown className=\"w-5 h-5 text-gray-400\" />\n                  )}\n                </button>\n                {expandedFaq === idx && (\n                  <div className=\"px-4 pb-4 text-gray-600 text-base animate-fade-in\">\n                    {item.a}\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {/* Ask question */}\n            <button className=\"w-full mt-3 py-3.5 border-2 border-dashed border-gray-200 text-gray-500 font-medium text-base rounded-xl hover:border-primary-300 hover:text-primary-500 transition-colors flex items-center justify-center gap-2\">\n              <MessageCircle className=\"w-5 h-5\" />\n              Krds feltevse\n            </button>\n          </div>\n        )}\n\n        {/* Shipping - UNIFIED TYPOGRAPHY */}\n        {activeTab === 'shipping' && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-start gap-4 p-5 bg-green-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center shrink-0\">\n                <Truck className=\"w-6 h-6 text-green-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-green-800 text-lg\">Ingyenes szllts 50.000 Ft felett</p>\n                <p className=\"text-green-700 text-base\">Standard szllts: 2-5 munkanap</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start gap-4 p-5 bg-blue-50 rounded-xl\">\n              <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center shrink-0\">\n                <Shield className=\"w-6 h-6 text-blue-600\" />\n              </div>\n              <div>\n                <p className=\"font-bold text-blue-800 text-lg\">2 v garancia</p>\n                <p className=\"text-blue-700 text-base\">Teljes kr gyrti garancia minden termkre</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 mt-5\">\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">2-5</p>\n                <p className=\"text-sm text-gray-500\">munkanap</p>\n              </div>\n              <div className=\"p-4 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-3xl font-bold text-gray-900\">14</p>\n                <p className=\"text-sm text-gray-500\">nap ellls</p>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ProductTabs;\n","import React, { useState, useMemo } from 'react';\nimport { TrendingDown, TrendingUp, Minus, Clock, Bell, ChevronDown, ChevronUp, AlertCircle, Check } from 'lucide-react';\n\n/**\n * PriceHistory - Dynamic pricing indicator with history chart\n * Shows price trends and alerts for best buying time\n */\nconst PriceHistory = ({ \n  currentPrice = 0, \n  priceHistory = [], \n  productId,\n  onSetAlert \n}) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [alertSet, setAlertSet] = useState(false);\n\n  // Early return if no valid price\n  const validPrice = currentPrice && currentPrice > 0 ? currentPrice : 100000;\n\n  // Generate mock price history if not provided\n  const history = useMemo(() => {\n    if (priceHistory.length > 0) return priceHistory;\n    \n    // Generate 6 months of price data\n    const months = ['Aug', 'Szept', 'Okt', 'Nov', 'Dec', 'Jan'];\n    const basePrice = validPrice;\n    \n    return months.map((month, idx) => {\n      const variance = (Math.random() - 0.5) * 0.3; // 15% variance\n      const price = Math.round(basePrice * (1 + variance));\n      return {\n        month,\n        price: price || basePrice, // Ensure price is never 0\n        date: new Date(2025, 7 + idx, 1)\n      };\n    });\n  }, [validPrice, priceHistory]);\n\n  // Calculate stats\n  const stats = useMemo(() => {\n    if (!history || history.length === 0) {\n      return { min: validPrice, max: validPrice, avg: validPrice, priceChange: 0, changePercent: '0.0', isLowest: false, isHighest: false, previousPrice: validPrice };\n    }\n    \n    const prices = history.map(h => h.price || validPrice);\n    const min = Math.min(...prices) || validPrice;\n    const max = Math.max(...prices) || validPrice;\n    const avg = Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) || validPrice;\n    const previousPrice = history[history.length - 2]?.price || validPrice;\n    const priceChange = validPrice - previousPrice;\n    const changePercent = previousPrice > 0 ? ((priceChange / previousPrice) * 100).toFixed(1) : '0.0';\n    const isLowest = validPrice <= min * 1.05; // Within 5% of lowest\n    const isHighest = validPrice >= max * 0.95;\n    \n    return { min, max, avg, priceChange, changePercent, isLowest, isHighest, previousPrice };\n  }, [history, validPrice]);\n\n  // Chart dimensions\n  const chartHeight = 60;\n  const chartWidth = 200;\n\n  // Generate SVG path for price chart\n  const chartPath = useMemo(() => {\n    const prices = history.map(h => h.price);\n    const min = Math.min(...prices) * 0.95;\n    const max = Math.max(...prices) * 1.05;\n    const range = max - min;\n    \n    const points = prices.map((price, idx) => {\n      const x = (idx / (prices.length - 1)) * chartWidth;\n      const y = chartHeight - ((price - min) / range) * chartHeight;\n      return `${x},${y}`;\n    });\n    \n    return `M ${points.join(' L ')}`;\n  }, [history]);\n\n  // Area fill path\n  const areaPath = useMemo(() => {\n    return `${chartPath} L ${chartWidth},${chartHeight} L 0,${chartHeight} Z`;\n  }, [chartPath]);\n\n  const handleSetAlert = () => {\n    setAlertSet(true);\n    onSetAlert?.(productId, currentPrice);\n    setTimeout(() => setAlertSet(false), 3000);\n  };\n\n  const getTrendIcon = () => {\n    if (stats.priceChange < 0) return <TrendingDown className=\"w-4 h-4\" />;\n    if (stats.priceChange > 0) return <TrendingUp className=\"w-4 h-4\" />;\n    return <Minus className=\"w-4 h-4\" />;\n  };\n\n  const getTrendColor = () => {\n    if (stats.priceChange < 0) return 'text-green-600 bg-green-50';\n    if (stats.priceChange > 0) return 'text-red-600 bg-red-50';\n    return 'text-gray-600 bg-gray-50';\n  };\n\n  return (\n    <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n      {/* Compact Header - Always visible */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full flex items-center justify-between p-3 sm:p-4 hover:bg-gray-50 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-sm font-medium ${getTrendColor()}`}>\n            {getTrendIcon()}\n            <span>{stats.priceChange > 0 ? '+' : ''}{stats.changePercent}%</span>\n          </div>\n          \n          {stats.isLowest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full\">\n              <TrendingDown className=\"w-3 h-3\" />\n              Most a legolcsbb!\n            </span>\n          )}\n          \n          {stats.isHighest && (\n            <span className=\"flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs font-bold rounded-full\">\n              <AlertCircle className=\"w-3 h-3\" />\n              Magas r\n            </span>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-2 text-gray-500\">\n          <Clock className=\"w-4 h-4\" />\n          <span className=\"text-xs\">rvltozs</span>\n          {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      {isExpanded && (\n        <div className=\"px-3 sm:px-4 pb-4 space-y-4\">\n          {/* Mini Chart */}\n          <div className=\"bg-gray-50 rounded-xl p-4\">\n            <div className=\"flex items-end justify-between mb-3\">\n              <span className=\"text-xs text-gray-500\">Elmlt 6 hnap</span>\n              <div className=\"text-right\">\n                <span className=\"text-lg font-bold text-gray-900\">{currentPrice.toLocaleString()} Ft</span>\n                <span className=\"text-xs text-gray-500 ml-1\">most</span>\n              </div>\n            </div>\n            \n            {/* SVG Chart */}\n            <div className=\"relative h-16\">\n              <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className=\"w-full h-full\" preserveAspectRatio=\"none\">\n                {/* Gradient fill */}\n                <defs>\n                  <linearGradient id=\"priceGradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                    <stop offset=\"0%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0.3\" />\n                    <stop offset=\"100%\" stopColor={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} stopOpacity=\"0\" />\n                  </linearGradient>\n                </defs>\n                \n                {/* Area fill */}\n                <path d={areaPath} fill=\"url(#priceGradient)\" />\n                \n                {/* Line */}\n                <path \n                  d={chartPath} \n                  fill=\"none\" \n                  stroke={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'} \n                  strokeWidth=\"2\"\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                />\n                \n                {/* Current price dot */}\n                <circle \n                  cx={chartWidth} \n                  cy={chartHeight - ((currentPrice - stats.min * 0.95) / (stats.max * 1.05 - stats.min * 0.95)) * chartHeight}\n                  r=\"4\" \n                  fill={stats.priceChange <= 0 ? '#10b981' : '#f59e0b'}\n                />\n              </svg>\n              \n              {/* Month labels */}\n              <div className=\"absolute bottom-0 left-0 right-0 flex justify-between text-[10px] text-gray-400 -mb-4\">\n                {history.filter((_, i) => i % 2 === 0).map((h, i) => (\n                  <span key={i}>{h.month}</span>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          {/* Stats Grid */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"bg-green-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-green-600 mb-0.5\">Legalacsonyabb</div>\n              <div className=\"font-bold text-green-700 text-sm\">{stats.min.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-gray-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-gray-500 mb-0.5\">tlagr</div>\n              <div className=\"font-bold text-gray-700 text-sm\">{stats.avg.toLocaleString()} Ft</div>\n            </div>\n            <div className=\"bg-red-50 rounded-lg p-2.5 text-center\">\n              <div className=\"text-xs text-red-600 mb-0.5\">Legmagasabb</div>\n              <div className=\"font-bold text-red-700 text-sm\">{stats.max.toLocaleString()} Ft</div>\n            </div>\n          </div>\n\n          {/* Price Alert Button */}\n          <button\n            onClick={handleSetAlert}\n            disabled={alertSet}\n            className={`\n              w-full flex items-center justify-center gap-2 py-2.5 rounded-xl text-sm font-medium transition-all\n              ${alertSet \n                ? 'bg-green-100 text-green-700' \n                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }\n            `}\n          >\n            {alertSet ? (\n              <>\n                <Check className=\"w-4 h-4\" />\n                rtests belltva!\n              </>\n            ) : (\n              <>\n                <Bell className=\"w-4 h-4\" />\n                rtests, ha cskken az r\n              </>\n            )}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PriceHistory;\n","import React, { useState } from 'react';\nimport { Zap, CreditCard, Truck, Shield, Check, ChevronRight, Apple, Smartphone, Lock, MapPin, User, Mail } from 'lucide-react';\n\n/**\n * OneClickCheckout - Express checkout for returning customers\n * Sleek, trustworthy design with saved payment methods\n */\nconst OneClickCheckout = ({ \n  product,\n  savedAddress,\n  savedPayment,\n  userEmail,\n  userName,\n  onCheckout,\n  onClose \n}) => {\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [selectedPayment, setSelectedPayment] = useState('saved');\n  const [step, setStep] = useState('confirm'); // 'confirm' | 'processing' | 'success'\n\n  const paymentMethods = [\n    { id: 'saved', label: 'Mentett krtya', icon: CreditCard, detail: ' 4242', badge: 'Gyors' },\n    { id: 'apple', label: 'Apple Pay', icon: Apple, detail: 'Egy rintssel', badge: null },\n    { id: 'google', label: 'Google Pay', icon: Smartphone, detail: 'Egy rintssel', badge: null },\n  ];\n\n  const handleCheckout = async () => {\n    setStep('processing');\n    setIsProcessing(true);\n    \n    // Simulate processing\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    setStep('success');\n    setIsProcessing(false);\n    \n    // Call parent callback\n    setTimeout(() => {\n      onCheckout?.({ product, payment: selectedPayment });\n    }, 1500);\n  };\n\n  if (step === 'success') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce\">\n          <Check className=\"w-8 h-8 text-green-600\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Sikeres rendels!</h3>\n        <p className=\"text-gray-600 mb-4\">Visszaigazolst kldtnk emailben.</p>\n        <div className=\"bg-gray-50 rounded-xl p-4 text-sm text-gray-600\">\n          <p>Rendelsszm: <span className=\"font-mono font-bold\">#MKT-{Math.random().toString(36).substr(2, 8).toUpperCase()}</span></p>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'processing') {\n    return (\n      <div className=\"bg-white rounded-2xl p-6 sm:p-8 text-center\">\n        <div className=\"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n          <div className=\"w-8 h-8 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Feldolgozs...</h3>\n        <p className=\"text-gray-600\">Krjk vrj, a fizets folyamatban.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-2xl overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-primary-500 to-secondary-600 px-5 py-4 text-white\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n            <Zap className=\"w-5 h-5\" />\n          </div>\n          <div>\n            <h3 className=\"font-bold text-lg\">Gyors vsrls</h3>\n            <p className=\"text-white/80 text-sm\">Egy kattintssal ksz</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-5 space-y-4\">\n        {/* Product Summary */}\n        <div className=\"flex items-center gap-4 p-3 bg-gray-50 rounded-xl\">\n          <div className=\"w-16 h-16 bg-gray-200 rounded-lg overflow-hidden shrink-0\">\n            {product?.image && (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n            <p className=\"font-bold text-primary-600 mt-1\">{product?.price?.toLocaleString()} Ft</p>\n          </div>\n        </div>\n\n        {/* Saved Info */}\n        <div className=\"space-y-2\">\n          {/* Delivery Address */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <MapPin className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Szlltsi cm</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {savedAddress || '1234 Budapest, Plda utca 12.'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n\n          {/* Contact */}\n          <div className=\"flex items-center gap-3 p-3 bg-gray-50 rounded-xl\">\n            <div className=\"w-9 h-9 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n              <Mail className=\"w-4 h-4 text-gray-600\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-xs text-gray-500\">Email</p>\n              <p className=\"text-sm font-medium text-gray-900 truncate\">\n                {userEmail || 'pelda@email.com'}\n              </p>\n            </div>\n            <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n          </div>\n        </div>\n\n        {/* Payment Methods */}\n        <div>\n          <p className=\"text-xs font-medium text-gray-500 uppercase tracking-wide mb-2\">Fizetsi md</p>\n          <div className=\"space-y-2\">\n            {paymentMethods.map((method) => (\n              <button\n                key={method.id}\n                onClick={() => setSelectedPayment(method.id)}\n                className={`\n                  w-full flex items-center gap-3 p-3 rounded-xl border-2 transition-all text-left\n                  ${selectedPayment === method.id \n                    ? 'border-primary-400 bg-primary-50' \n                    : 'border-gray-200 hover:border-gray-300'\n                  }\n                `}\n              >\n                <div className={`\n                  w-9 h-9 rounded-lg flex items-center justify-center\n                  ${selectedPayment === method.id ? 'bg-primary-500 text-white' : 'bg-gray-100 text-gray-600'}\n                `}>\n                  <method.icon className=\"w-5 h-5\" />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-gray-900 text-sm\">{method.label}</span>\n                    {method.badge && (\n                      <span className=\"px-1.5 py-0.5 bg-green-100 text-green-700 text-[10px] font-bold rounded\">\n                        {method.badge}\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-xs text-gray-500\">{method.detail}</p>\n                </div>\n                <div className={`\n                  w-5 h-5 rounded-full border-2 flex items-center justify-center\n                  ${selectedPayment === method.id \n                    ? 'border-primary-500 bg-primary-500' \n                    : 'border-gray-300'\n                  }\n                `}>\n                  {selectedPayment === method.id && <Check className=\"w-3 h-3 text-white\" />}\n                </div>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Trust Badges */}\n        <div className=\"flex items-center justify-center gap-4 py-2 text-xs text-gray-500\">\n          <span className=\"flex items-center gap-1\">\n            <Shield className=\"w-3.5 h-3.5 text-green-600\" />\n            Biztonsgos\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Lock className=\"w-3.5 h-3.5 text-green-600\" />\n            SSL titkosts\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <Truck className=\"w-3.5 h-3.5 text-primary-500\" />\n            Gyors szllts\n          </span>\n        </div>\n\n        {/* CTA Button */}\n        <button\n          onClick={handleCheckout}\n          disabled={isProcessing}\n          className=\"w-full flex items-center justify-center gap-2 py-4 bg-gradient-to-r from-primary-500 to-secondary-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all disabled:opacity-50\"\n        >\n          <Zap className=\"w-5 h-5\" />\n          Megrendelem - {product?.price?.toLocaleString()} Ft\n        </button>\n\n        {/* Cancel */}\n        <button\n          onClick={onClose}\n          className=\"w-full py-2 text-sm text-gray-500 hover:text-gray-700 transition-colors\"\n        >\n          Mgse, vissza a termkhez\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default OneClickCheckout;\n","import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { \n  Search, X, Clock, TrendingUp, ArrowRight, Sparkles, Package, \n  Filter, ChevronRight, Lightbulb, Tag, Eye, Zap, Star, Wand2,\n  ShoppingBag, ArrowUpRight, Percent, History, Mic, Camera\n} from 'lucide-react';\nimport { \n  smartSearch, \n  getAutocompleteSuggestions, \n  getProactiveSuggestions,\n  parseSearchIntent,\n  buildSearchIndex,\n  isIndexReady,\n  getIndexStats\n} from '../../services/aiSearchService';\nimport { fetchUnasProducts, fetchUnasProductById } from '../../services/unasApi';\nimport { trackSearch, getSearchHistory, getViewedProducts } from '../../services/userPreferencesService';\n\n// Keresett sz kiemelse a szvegben (case-insensitive, split tartalmazza a tallatokat)\nconst highlightMatch = (text, query) => {\n  if (!text || !query || query.length < 2) return text;\n  const q = query.trim().replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  const re = new RegExp(`(${q})`, 'gi');\n  const parts = String(text).split(re);\n  if (parts.length <= 1) return text;\n  return parts.map((part, i) =>\n    i % 2 === 1 ? (\n      <mark key={i} className=\"bg-amber-200/80 text-gray-900 rounded px-0.5 font-semibold\">{part}</mark>\n    ) : (\n      part\n    )\n  );\n};\n\n/**\n * SmartSearchBar - Vilgsznvonal AI-alap btorkeres\n * \n * Funkcik:\n * - Vals idej intelligens autocomplete\n * - Termszetes nyelv keress\n * - Szinonimk s magyar nyelvi sajtossgok\n * - Fuzzy matching (elgpels tolerns)\n * - Kontextus-tudatos javaslatok\n * - Proaktv ajnlsok\n * - Keressi szndk felismers\n * - Termk elnzet a tallatokban\n * - UX: tallat kiemels, / fkusz, animcik\n */\nconst SmartSearchBar = ({ \n  products = [], \n  categories = [],\n  indexVersion = 0,\n  shouldBuildIndex = true,\n  maxLocalIndex = 50000,\n  serverSearchMode = false,\n  onSearch, \n  onProductClick,\n  placeholder = \"Mit keresel? pl. 'modern kanap 200 ezer alatt'\" \n}) => {\n  const [query, setQuery] = useState('');\n  const [isOpen, setIsOpen] = useState(false);\n  const [debouncedQuery, setDebouncedQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(-1); // Keyboard navigation\n  const [indexStatus, setIndexStatus] = useState({ ready: false, building: false, count: 0 });\n  const [serverPreview, setServerPreview] = useState({ results: [], total: 0, loading: false });\n  const inputRef = useRef(null);\n  const containerRef = useRef(null);\n  const debounceTimerRef = useRef(null);\n  const resultsRef = useRef(null);\n  const indexedCountRef = useRef(0);\n  const indexedVersionRef = useRef(0);\n  const serverRequestIdRef = useRef(0);\n\n  const canUseLocalIndex = !serverSearchMode && shouldBuildIndex && products.length > 0 && products.length <= maxLocalIndex;\n  const localIndexDisabled = serverSearchMode || (shouldBuildIndex && products.length > maxLocalIndex);\n\n  //  BUILD SEARCH INDEX when products are loaded (async, non-blocking)\n  useEffect(() => {\n    if (!canUseLocalIndex) {\n      if (localIndexDisabled) {\n        setIndexStatus({ ready: false, building: false, count: 0 });\n      }\n      return;\n    }\n    if (products.length > 0 && (products.length !== indexedCountRef.current || indexVersion !== indexedVersionRef.current)) {\n      console.log(` Products: ${products.length}, starting async index build...`);\n      setIndexStatus({ ready: false, building: true, count: 0 });\n      \n      // Build async\n      const doBuild = async () => {\n        try {\n          const success = await buildSearchIndex(products);\n          if (success) {\n            const stats = getIndexStats();\n            indexedCountRef.current = products.length;\n            indexedVersionRef.current = indexVersion;\n            setIndexStatus({ \n              ready: true, \n              building: false, \n              count: stats.productCount \n            });\n          }\n        } catch (err) {\n          console.error('Index build error:', err);\n          setIndexStatus({ ready: false, building: false, count: 0 });\n        }\n      };\n      \n      // Start when browser is idle to avoid jank\n      if (typeof window !== 'undefined' && 'requestIdleCallback' in window) {\n        window.requestIdleCallback(() => doBuild(), { timeout: 2000 });\n      } else {\n        setTimeout(doBuild, 300);\n      }\n    }\n  }, [products.length, indexVersion, canUseLocalIndex, localIndexDisabled]);\n\n  // Debounce query - csak 300ms utn kezdjen keresni\n  useEffect(() => {\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n    debounceTimerRef.current = setTimeout(() => {\n      setDebouncedQuery(query);\n    }, 200);\n    return () => {\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, [query]);\n\n  // Server-side search: trigger on debounced input\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    onSearch?.(q);\n  }, [debouncedQuery, onSearch, serverSearchMode]);\n\n  // Server-side preview results for typeahead\n  useEffect(() => {\n    if (!serverSearchMode) return;\n    const q = debouncedQuery.trim();\n    if (q.length < 2) {\n      setServerPreview({ results: [], total: 0, loading: false });\n      return;\n    }\n    const requestId = ++serverRequestIdRef.current;\n    setServerPreview((prev) => ({ ...prev, loading: true }));\n    fetchUnasProducts({ search: q, limit: 6, offset: 0, slim: true })\n      .then((data) => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({\n          results: Array.isArray(data.products) ? data.products : [],\n          total: typeof data.total === 'number' ? data.total : 0,\n          loading: false\n        });\n      })\n      .catch(() => {\n        if (serverRequestIdRef.current !== requestId) return;\n        setServerPreview({ results: [], total: 0, loading: false });\n      });\n  }, [debouncedQuery, serverSearchMode]);\n\n  // Autocomplete javaslatok - TELJES katalgusbl keres\n  const autocompleteSuggestions = useMemo(() => {\n    if (!canUseLocalIndex) return [];\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2 || !products.length) return [];\n    // TELJES katalgus hasznlata - a getAutocompleteSuggestions mr optimalizlt\n    return getAutocompleteSuggestions(products, debouncedQuery, 8);\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Keressi eredmnyek - CSAK ha debounced query vltozik\n  const searchResults = useMemo(() => {\n    if (!canUseLocalIndex) return { results: [], intent: null, totalMatches: 0 };\n    if (!debouncedQuery.trim() || debouncedQuery.length < 2) return { results: [], intent: null, totalMatches: 0 };\n    return smartSearch(products, debouncedQuery, { limit: 8, includeDebugInfo: false });\n  }, [debouncedQuery, products, canUseLocalIndex]);\n\n  // Felismert keressi szndk\n  const searchIntent = useMemo(() => {\n    if (!debouncedQuery.trim() || debouncedQuery.length < 3) return null;\n    return parseSearchIntent(debouncedQuery);\n  }, [debouncedQuery]);\n\n  // Proaktv javaslatok - egyszer szmtva, nem minden renderben\n  const proactiveSuggestions = useMemo(() => {\n    // Nem hasznljuk a products-ot itt, mert lass lenne\n    return getProactiveSuggestions([]);\n  }, []);\n\n  // Keressi elzmnyek - egyszer beolvasva\n  const recentSearches = useMemo(() => {\n    const history = getSearchHistory(4);\n    return history.map(h => h.query).filter(q => q && q.length > 0);\n  }, []);\n\n  // Nemrg nzett termkek - egyszer beolvasva\n  const recentlyViewed = useMemo(() => {\n    return getViewedProducts(3);\n  }, []);\n\n  // Trendi keressek - statikus + szemlyre szabott\n  const trendingSearches = useMemo(() => {\n    const viewed = getViewedProducts(3);\n    const viewedCategories = viewed.map(p => p.category?.split(' > ')[0]).filter(Boolean);\n    \n    const defaults = [\n      { text: 'modern kanap', icon: '' },\n      { text: 'skandinv stlus', icon: '' },\n      { text: 'akcis btorok', icon: '' },\n      { text: 'kompakt btor', icon: '' },\n    ];\n    \n    const personalized = viewedCategories.map(c => ({\n      text: `${c} ajnlatok`,\n      icon: '',\n    }));\n    \n    const combined = [...personalized, ...defaults];\n    return combined.filter((v, i, a) => a.findIndex(t => t.text === v.text) === i).slice(0, 4);\n  }, []);\n\n  // Close on outside click\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      if (containerRef.current && !containerRef.current.contains(e.target)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Keyboard shortcut: \"/\" focuses search (unless already in input/textarea)\n  useEffect(() => {\n    const handleGlobalKeyDown = (e) => {\n      if (e.key !== '/' || e.ctrlKey || e.metaKey || e.altKey) return;\n      const target = e.target;\n      if (target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable)) return;\n      e.preventDefault();\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    document.addEventListener('keydown', handleGlobalKeyDown);\n    return () => document.removeEventListener('keydown', handleGlobalKeyDown);\n  }, []);\n\n  // Fejlc Keress gomb: scroll utn fkusz + dropdown nyits\n  useEffect(() => {\n    const handleFocusSearch = () => {\n      inputRef.current?.focus();\n      setIsOpen(true);\n    };\n    window.addEventListener('mkt-focus-search', handleFocusSearch);\n    return () => window.removeEventListener('mkt-focus-search', handleFocusSearch);\n  }, []);\n\n  // === CALLBACK DEFINCIK (useEffect ELTT kell lennik!) ===\n  \n  const handleSubmit = useCallback((e) => {\n    e?.preventDefault();\n    if (query.trim()) {\n      trackSearch(query);\n      onSearch?.(query);\n      setIsOpen(false);\n    }\n  }, [query, onSearch]);\n\n  const handleInputChange = useCallback((e) => {\n    const value = e.target.value;\n    setQuery(value);\n  }, []);\n\n  const handleProductClickFn = useCallback(async (product) => {\n    try {\n      if (serverSearchMode && product?.id) {\n        const full = await fetchUnasProductById(product.id);\n        onProductClick?.(full || product);\n      } else {\n        onProductClick?.(product);\n      }\n    } catch (err) {\n      onProductClick?.(product);\n    } finally {\n      setQuery('');\n      setIsOpen(false);\n    }\n  }, [onProductClick, serverSearchMode]);\n\n  const handleSuggestionClick = useCallback((suggestion) => {\n    const text = typeof suggestion === 'string' ? suggestion : suggestion.text || suggestion.query;\n    setQuery(text);\n    trackSearch(text);\n    onSearch?.(text);\n    setIsOpen(false);\n  }, [onSearch]);\n\n  const handleAutocompleteClickFn = useCallback((item) => {\n    if (item.type === 'product' && item.product) {\n      handleProductClickFn(item.product);\n    } else {\n      handleSuggestionClick(item.text);\n    }\n  }, [handleProductClickFn, handleSuggestionClick]);\n\n  const clearQuery = useCallback(() => {\n    setQuery('');\n    inputRef.current?.focus();\n  }, []);\n\n  // Alias for backwards compatibility\n  const handleProductClick = handleProductClickFn;\n  const handleAutocompleteClick = handleAutocompleteClickFn;\n\n  // === NAVIGLHAT ELEMEK ===\n  \n  // sszes naviglhat elem (autocomplete + search results)\n  const allNavigableItems = useMemo(() => {\n    const items = [];\n    \n    // Autocomplete javaslatok\n    if (debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0) {\n      autocompleteSuggestions.forEach((sug, idx) => {\n        items.push({ type: 'autocomplete', item: sug, index: idx });\n      });\n    }\n    \n    // Keressi eredmnyek\n    if (debouncedQuery.length >= 2 && searchResults.results?.length > 0) {\n      searchResults.results.slice(0, 6).forEach((product, idx) => {\n        items.push({ type: 'result', item: product, index: idx });\n      });\n    }\n    \n    return items;\n  }, [debouncedQuery, autocompleteSuggestions, searchResults.results]);\n\n  // Reset selection when results change\n  useEffect(() => {\n    setSelectedIndex(-1);\n  }, [debouncedQuery]);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      if (!isOpen) return;\n      \n      const totalItems = allNavigableItems.length;\n      \n      switch (e.key) {\n        case 'ArrowDown':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev < totalItems - 1 ? prev + 1 : 0;\n            return next;\n          });\n          break;\n          \n        case 'ArrowUp':\n          e.preventDefault();\n          setSelectedIndex(prev => {\n            const next = prev > 0 ? prev - 1 : totalItems - 1;\n            return next;\n          });\n          break;\n          \n        case 'Enter':\n          if (selectedIndex >= 0 && selectedIndex < totalItems) {\n            e.preventDefault();\n            const selected = allNavigableItems[selectedIndex];\n            if (selected.type === 'autocomplete') {\n              handleAutocompleteClickFn(selected.item);\n            } else if (selected.type === 'result') {\n              handleProductClickFn(selected.item);\n            }\n          }\n          break;\n          \n        case 'Escape':\n          setIsOpen(false);\n          setSelectedIndex(-1);\n          inputRef.current?.blur();\n          break;\n          \n        case 'Tab':\n          if (totalItems > 0) {\n            e.preventDefault();\n            setSelectedIndex(prev => (prev + 1) % totalItems);\n          }\n          break;\n      }\n    };\n    \n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, allNavigableItems, selectedIndex, handleAutocompleteClickFn, handleProductClickFn]);\n\n  // Render intent tags\n  const renderIntentTags = () => {\n    if (!searchIntent) return null;\n    \n    const tags = [];\n    \n    if (searchIntent.productTypes.length > 0) {\n      tags.push({ label: searchIntent.productTypes[0], color: 'primary', icon: ShoppingBag });\n    }\n    if (searchIntent.styles.length > 0) {\n      tags.push({ label: searchIntent.styles[0], color: 'purple', icon: Sparkles });\n    }\n    if (searchIntent.colors.length > 0) {\n      tags.push({ label: searchIntent.colors[0], color: 'blue', icon: Tag });\n    }\n    if (searchIntent.priceRange) {\n      const priceLabel = searchIntent.priceRange.max === Infinity \n        ? `${(searchIntent.priceRange.min / 1000).toFixed(0)}k+ Ft`\n        : `${(searchIntent.priceRange.min / 1000).toFixed(0)}-${(searchIntent.priceRange.max / 1000).toFixed(0)}k Ft`;\n      tags.push({ label: priceLabel, color: 'green', icon: Tag });\n    }\n    if (searchIntent.isOnSale) {\n      tags.push({ label: 'Akcis', color: 'red', icon: Percent });\n    }\n    \n    if (tags.length === 0) return null;\n    \n    return (\n      <div className=\"flex flex-wrap gap-1.5 px-4 py-2.5 border-b border-gray-100 bg-gradient-to-r from-primary-50/40 to-transparent\">\n        <span className=\"text-xs text-gray-500 mr-1 flex items-center gap-1.5 font-medium\">\n          <Wand2 className=\"w-3.5 h-3.5 text-primary-500\" />\n          Felismert:\n        </span>\n        {tags.map((tag, i) => (\n          <span \n            key={i}\n            className={`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium\n              ${tag.color === 'primary' ? 'bg-primary-100 text-primary-700' : ''}\n              ${tag.color === 'purple' ? 'bg-purple-100 text-purple-700' : ''}\n              ${tag.color === 'blue' ? 'bg-blue-100 text-blue-700' : ''}\n              ${tag.color === 'green' ? 'bg-green-100 text-green-700' : ''}\n              ${tag.color === 'red' ? 'bg-red-100 text-red-700' : ''}\n            `}\n          >\n            <tag.icon className=\"w-3 h-3\" />\n            {tag.label}\n          </span>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div ref={containerRef} className=\"relative w-full max-w-3xl mx-auto\">\n      {/* Backdrop - subtle overlay when dropdown open (mobile-friendly) */}\n      {isOpen && (\n        <div \n          className=\"search-dropdown-backdrop fixed inset-0 bg-black/5 z-[9998] sm:bg-transparent sm:pointer-events-none\"\n          aria-hidden=\"true\"\n        />\n      )}\n      {/* Search Input */}\n      <form onSubmit={handleSubmit} className=\"relative\">\n        <div className={`search-input-wrapper\n          flex items-center gap-2 bg-white rounded-2xl border-2 transition-all duration-200\n          ${isOpen \n            ? 'border-primary-400 shadow-xl shadow-primary-100/50 ring-4 ring-primary-50' \n            : 'border-gray-200 hover:border-gray-300 hover:shadow-md'}\n        `}>\n          <div className=\"flex items-center pl-4\">\n            {indexStatus.building ? (\n              <div className=\"w-5 h-5 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" title=\"Index ptse...\" />\n            ) : query.length >= 2 && query !== debouncedQuery ? (\n              <div className=\"w-5 h-5 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n            ) : (\n              <Search className={`w-5 h-5 transition-colors ${isOpen ? 'text-primary-500' : 'text-gray-400'}`} />\n            )}\n          </div>\n          \n          <input\n            ref={inputRef}\n            type=\"text\"\n            value={query}\n            onChange={handleInputChange}\n            onFocus={() => setIsOpen(true)}\n            placeholder={placeholder}\n            className=\"flex-1 py-3.5 sm:py-4 bg-transparent text-gray-900 placeholder-gray-400 text-sm sm:text-base focus:outline-none\"\n            autoComplete=\"off\"\n            spellCheck=\"false\"\n          />\n\n          {query && (\n            <button\n              type=\"button\"\n              onClick={clearQuery}\n              className=\"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          )}\n\n          <button\n            type=\"submit\"\n            className=\"flex items-center gap-2 px-5 sm:px-6 py-2.5 sm:py-3 mr-1.5 bg-gradient-to-r from-primary-500 to-primary-600 text-white font-semibold text-sm rounded-xl hover:from-primary-600 hover:to-primary-700 hover:shadow-lg hover:shadow-primary-500/25 transition-all active:scale-95\"\n          >\n            <Search className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Keress</span>\n          </button>\n        </div>\n      </form>\n\n      {/* Dropdown Panel */}\n      {isOpen && (\n        <div className=\"search-dropdown-enter search-dropdown-scroll absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-md rounded-2xl border border-gray-100 overflow-hidden z-[9999] max-h-[75vh] overflow-y-auto\">\n          \n          {/* Intent Tags - ha van felismert szndk */}\n          {debouncedQuery.length >= 3 && renderIntentTags()}\n\n          {/* Autocomplete javaslatok - gpels kzben */}\n          {debouncedQuery.length >= 2 && autocompleteSuggestions.length > 0 && (\n            <div className=\"border-b border-gray-100\">\n              <div className=\"p-2\">\n                <p className=\"px-3 py-1.5 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <Zap className=\"w-3.5 h-3.5 text-amber-500\" />\n                  Javaslatok\n                </p>\n                {autocompleteSuggestions.map((item, idx) => {\n                  const isSelected = selectedIndex === idx;\n                  return (\n                  <button\n                    key={idx}\n                    onClick={() => handleAutocompleteClick(item)}\n                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-xl transition-all text-left group\n                      ${isSelected \n                        ? 'bg-primary-100 ring-2 ring-primary-400 ring-inset' \n                        : 'hover:bg-primary-50'\n                      }`}\n                  >\n                    <div className={`\n                      w-8 h-8 rounded-lg flex items-center justify-center shrink-0\n                      ${item.type === 'product' ? 'bg-primary-100' : ''}\n                      ${item.type === 'category' ? 'bg-secondary-100' : ''}\n                      ${item.type === 'keyword' ? 'bg-gray-100' : ''}\n                      ${item.type === 'synonym' ? 'bg-purple-100' : ''}\n                      ${item.type === 'popular' ? 'bg-amber-100' : ''}\n                    `}>\n                      {item.type === 'product' && item.product?.image ? (\n                        <img src={item.product.image} alt=\"\" className=\"w-full h-full object-cover rounded-lg\" />\n                      ) : (\n                        <>\n                          {item.type === 'product' && <Package className=\"w-4 h-4 text-primary-600\" />}\n                          {item.type === 'category' && <Filter className=\"w-4 h-4 text-secondary-600\" />}\n                          {item.type === 'keyword' && <Search className=\"w-4 h-4 text-gray-500\" />}\n                          {item.type === 'synonym' && <Sparkles className=\"w-4 h-4 text-purple-600\" />}\n                          {item.type === 'popular' && <TrendingUp className=\"w-4 h-4 text-amber-600\" />}\n                        </>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <span className=\"text-sm text-gray-800 font-medium\">\n                        {item.type === 'product' && debouncedQuery ? highlightMatch(item.text, debouncedQuery) : item.text}\n                      </span>\n                      {item.type === 'product' && item.product && (\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {item.product.price?.toLocaleString()} Ft\n                        </p>\n                      )}\n                    </div>\n                    <ArrowUpRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (server-side preview) */}\n          {serverSearchMode && debouncedQuery.length >= 2 && serverPreview.results && serverPreview.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{(serverPreview.total || serverPreview.results.length).toLocaleString()} tallat</span>\n                  </p>\n                </div>\n                {(serverPreview.total || 0) > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {serverPreview.results.slice(0, 6).map((product, idx) => {\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Keressi tallatok - termkek (local index) */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.results && searchResults.results.length > 0 && (\n            <div className=\"p-3\">\n              <div className=\"flex items-center justify-between px-2 py-2 mb-2 gap-2\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <p className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\">\n                    <ShoppingBag className=\"w-4 h-4 text-primary-500\" />\n                    <span>{searchResults.totalMatches.toLocaleString()} tallat</span>\n                  </p>\n                  {searchResults.searchTime != null && (\n                    <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-xs font-medium\">\n                      <Zap className=\"w-3 h-3\" />\n                      {searchResults.searchTime < 1 ? '<1' : Math.round(searchResults.searchTime)} ms\n                    </span>\n                  )}\n                </div>\n                {searchResults.totalMatches > 6 && (\n                  <button \n                    onClick={handleSubmit}\n                    className=\"text-xs text-primary-600 hover:text-primary-700 font-semibold flex items-center gap-1 px-3 py-1.5 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors shrink-0\"\n                  >\n                    Mind megtekintse\n                    <ArrowRight className=\"w-3.5 h-3.5\" />\n                  </button>\n                )}\n              </div>\n              <div className=\"space-y-1.5\" ref={resultsRef}>\n                {searchResults.results.slice(0, 6).map((product, idx) => {\n                  // Calculate actual index for keyboard navigation (after autocomplete items)\n                  const actualIndex = autocompleteSuggestions.length + idx;\n                  const isSelected = selectedIndex === actualIndex;\n                  return (\n                  <button\n                    key={product.id}\n                    onClick={() => handleProductClick(product)}\n                    style={{ animationDelay: `${idx * 35}ms` }}\n                    className={`search-item-enter w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 text-left group\n                      ${isSelected \n                        ? 'bg-gradient-to-r from-primary-100 to-primary-50 border-primary-300 ring-2 ring-primary-400 ring-inset shadow-md scale-[1.01]' \n                        : 'border-transparent hover:bg-gradient-to-r hover:from-primary-50/80 hover:to-white hover:border-primary-100 hover:shadow-md hover:scale-[1.01] active:scale-[0.99]'\n                      }`}\n                  >\n                    <div className=\"relative shrink-0\">\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all duration-200 shadow-sm group-hover:shadow-md group-hover:scale-105\">\n                        {product.image ? (\n                          <img src={product.image} alt={product.name} className=\"w-full h-full object-cover transition-transform duration-300\" />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <Package className=\"w-7 h-7 text-gray-300\" />\n                          </div>\n                        )}\n                      </div>\n                      {/* Pozci badge */}\n                      {idx < 3 && (\n                        <div className=\"absolute -top-1 -left-1 w-5 h-5 bg-primary-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow\">\n                          {idx + 1}\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"font-semibold text-gray-900 text-sm leading-tight line-clamp-2 group-hover:text-primary-700 transition-colors\">\n                        {highlightMatch(product.name, debouncedQuery)}\n                      </h4>\n                      <p className=\"text-xs text-gray-500 mt-0.5 truncate flex items-center gap-1\">\n                        <Tag className=\"w-3 h-3\" />\n                        {product.category?.split(' > ').slice(-1)[0] || product.category}\n                      </p>\n                      <div className=\"flex items-center gap-2 mt-1.5\">\n                        <span className=\"text-base font-bold text-primary-600\">\n                          {(product.salePrice || product.price)?.toLocaleString()} Ft\n                        </span>\n                        {product.originalPrice && product.originalPrice > (product.salePrice || product.price) && (\n                          <>\n                            <span className=\"text-xs text-gray-400 line-through\">\n                              {product.originalPrice.toLocaleString()} Ft\n                            </span>\n                            <span className=\"text-xs bg-gradient-to-r from-red-500 to-pink-500 text-white px-2 py-0.5 rounded-full font-bold shadow-sm\">\n                              -{Math.round((1 - (product.salePrice || product.price) / product.originalPrice) * 100)}%\n                            </span>\n                          </>\n                        )}\n                        {product.inStock === false && (\n                          <span className=\"text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full\">\n                            Elfogyott\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-col items-center gap-1\">\n                      <ChevronRight className={`w-5 h-5 transition-all shrink-0 ${isSelected ? 'text-primary-500 translate-x-1' : 'text-gray-300 group-hover:text-primary-500 group-hover:translate-x-1'}`} />\n                      <Eye className={`w-4 h-4 transition-colors ${isSelected ? 'text-primary-400' : 'text-gray-300 group-hover:text-primary-400'}`} />\n                    </div>\n                  </button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* \"Erre gondoltl?\" javaslat */}\n          {!serverSearchMode && debouncedQuery.length >= 2 && searchResults.didYouMean && (\n            <div className=\"px-4 py-3 bg-gradient-to-r from-amber-50 to-orange-50 border-b border-amber-100\">\n              <button\n                onClick={() => handleSuggestionClick(searchResults.didYouMean.query)}\n                className=\"flex items-center gap-2 text-sm group\"\n              >\n                <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                <span className=\"text-gray-600\">Erre gondoltl?</span>\n                <span className=\"font-semibold text-amber-700 group-hover:text-amber-800 underline underline-offset-2\">\n                  {searchResults.didYouMean.query}\n                </span>\n                <ArrowRight className=\"w-4 h-4 text-amber-500 group-hover:translate-x-1 transition-transform\" />\n              </button>\n            </div>\n          )}\n\n          {/* Nincs tallat - finomtott empty state */}\n          {serverSearchMode && debouncedQuery.length >= 2 && !serverPreview.loading && serverPreview.results.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n          {!serverSearchMode && debouncedQuery.length >= 2 && (!searchResults.results || searchResults.results.length === 0) && autocompleteSuggestions.length === 0 && (\n            <div className=\"p-8 text-center\">\n              <div className=\"w-20 h-20 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-5 shadow-sm border border-gray-100 ring-4 ring-gray-50/80\">\n                <Search className=\"w-10 h-10 text-gray-300\" strokeWidth={1.5} />\n              </div>\n              <p className=\"text-gray-800 font-semibold mb-1 text-base\">Nincs tallat: &quot;{debouncedQuery}&quot;</p>\n              <p className=\"text-sm text-gray-500 mb-5 max-w-xs mx-auto\">Prblj ms kulcsszavakat, szinonimkat vagy egyszerstsd a keresst.</p>\n              \n              {/* Javaslatok */}\n              {searchResults.suggestions?.length > 0 && (\n                <div className=\"space-y-3\">\n                  <p className=\"text-xs text-gray-500 uppercase tracking-wide font-semibold\">Prbld ezeket:</p>\n                  <div className=\"flex flex-wrap justify-center gap-2\">\n                    {searchResults.suggestions.map((sug, i) => (\n                      <button\n                        key={i}\n                        onClick={() => handleSuggestionClick({ text: sug.action })}\n                        className=\"inline-flex items-center gap-2 px-4 py-2.5 bg-white border border-gray-200 hover:border-primary-300 hover:bg-primary-50 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all shadow-sm hover:shadow\"\n                      >\n                        <Lightbulb className=\"w-4 h-4 text-amber-500\" />\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              \n              {/* Npszer keressek fallback */}\n              <div className=\"mt-6 pt-4 border-t border-gray-100\">\n                <p className=\"text-xs text-gray-400 mb-3\">Npszer keressek:</p>\n                <div className=\"flex flex-wrap justify-center gap-2\">\n                  {['kanap', 'fotel', 'asztal', 'szekrny', 'gy'].map(term => (\n                    <button\n                      key={term}\n                      onClick={() => handleSuggestionClick(term)}\n                      className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm transition-colors\"\n                    >\n                      {term}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Betlts jelz gpels kzben - shimmer UX */}\n          {query.length >= 2 && query !== debouncedQuery && (\n            <div className=\"p-6\">\n              <div className=\"flex items-center justify-center gap-3 mb-4\">\n                <div className=\"w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full animate-spin shrink-0\" />\n                <span className=\"text-sm font-medium text-gray-600\">Keress...</span>\n              </div>\n              <div className=\"space-y-2\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"search-loading-shimmer h-16 rounded-xl\" />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Kezdllapot - amikor nincs query */}\n          {debouncedQuery.length < 2 && query.length < 2 && (\n            <>\n              {/* Proaktv AI javaslatok */}\n              {proactiveSuggestions.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100 bg-gradient-to-r from-primary-50/50 to-secondary-50/50\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-600 uppercase tracking-wider flex items-center gap-1.5 mb-2\">\n                    <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                    Szemlyre szabott ajnlatok\n                  </p>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {proactiveSuggestions.map((sug, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(sug)}\n                        className=\"flex items-center gap-2 px-4 py-2 bg-white hover:bg-primary-50 border border-gray-200 hover:border-primary-300 text-gray-700 hover:text-primary-700 rounded-xl text-sm font-medium transition-all hover:shadow-sm\"\n                      >\n                        <span>{sug.icon}</span>\n                        {sug.text}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Korbbi keressek */}\n              {recentSearches.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <History className=\"w-3.5 h-3.5\" />\n                    Korbbi keressek\n                  </p>\n                  <div className=\"mt-2 space-y-1\">\n                    {recentSearches.map((search, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleSuggestionClick(search)}\n                        className=\"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-gray-50 transition-colors text-left group\"\n                      >\n                        <Clock className=\"w-4 h-4 text-gray-400\" />\n                        <span className=\"flex-1 text-sm text-gray-700\">{search}</span>\n                        <ArrowRight className=\"w-4 h-4 text-gray-300 group-hover:text-primary-500 transition-colors\" />\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Nemrg nzett termkek */}\n              {recentlyViewed.length > 0 && (\n                <div className=\"p-3 border-b border-gray-100\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Eye className=\"w-3.5 h-3.5\" />\n                    Nemrg nzett\n                  </p>\n                  <div className=\"mt-2 flex gap-3 overflow-x-auto pb-2 scrollbar-hide\">\n                    {recentlyViewed.map((product, idx) => (\n                      <button\n                        key={idx}\n                        onClick={() => handleProductClick(product)}\n                        className=\"flex-shrink-0 w-24 group\"\n                      >\n                        <div className=\"w-24 h-24 bg-gray-100 rounded-xl overflow-hidden ring-1 ring-gray-200 group-hover:ring-primary-300 transition-all\">\n                          {product.image ? (\n                            <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n                          ) : (\n                            <div className=\"w-full h-full flex items-center justify-center\">\n                              <Package className=\"w-8 h-8 text-gray-300\" />\n                            </div>\n                          )}\n                        </div>\n                        <p className=\"mt-1.5 text-xs text-gray-700 truncate group-hover:text-primary-600 transition-colors font-medium\">\n                          {product.name}\n                        </p>\n                        <p className=\"text-xs text-primary-600 font-semibold\">\n                          {product.price?.toLocaleString()} Ft\n                        </p>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Trendi keressek */}\n              <div className=\"p-3\">\n                <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                  <TrendingUp className=\"w-3.5 h-3.5 text-primary-500\" />\n                  Npszer keressek\n                </p>\n                <div className=\"mt-2 flex flex-wrap gap-2\">\n                  {trendingSearches.map((item, idx) => (\n                    <button\n                      key={idx}\n                      onClick={() => handleSuggestionClick(item.text)}\n                      className=\"flex items-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-xl text-sm font-medium transition-colors\"\n                    >\n                      <span>{item.icon}</span>\n                      {item.text}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Gyors kategrik */}\n              {categories.length > 0 && (\n                <div className=\"p-3 pt-0\">\n                  <p className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-1.5\">\n                    <Filter className=\"w-3.5 h-3.5\" />\n                    Kategrik\n                  </p>\n                  <div className=\"mt-2 flex flex-wrap gap-2\">\n                    {categories.slice(0, 6).map((cat, idx) => {\n                      const name = typeof cat === 'string' ? cat : cat.name;\n                      const count = typeof cat === 'string' ? null : cat.totalCount;\n                      return (\n                        <button\n                          key={idx}\n                          onClick={() => handleSuggestionClick(name)}\n                          className=\"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm transition-colors flex items-center gap-2\"\n                        >\n                          <span>{name}</span>\n                          {typeof count === 'number' && (\n                            <span className=\"text-xs text-gray-500\">({count.toLocaleString('hu-HU')})</span>\n                          )}\n                        </button>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {/* Footer - keressi tippek s keyboard hints */}\n          <div className=\"px-4 py-3 bg-gradient-to-r from-gray-50 to-white border-t border-gray-100\">\n            <div className=\"flex items-center justify-between flex-wrap gap-2\">\n              <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                {indexStatus.building ? (\n                  <span className=\"flex items-center gap-1.5 text-amber-600\">\n                    <div className=\"w-3 h-3 border-2 border-amber-500 border-t-transparent rounded-full animate-spin\" />\n                     Tanuls folyamatban...\n                  </span>\n                ) : indexStatus.ready ? (\n                  <span className=\"flex items-center gap-1.5 text-green-600\">\n                    <span className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                     {indexStatus.count?.toLocaleString()} termk betanulva\n                  </span>\n                ) : (\n                  <span> Keress termszetesen, pl. &quot;fehr kanap 150e alatt&quot;</span>\n                )}\n              </div>\n              <div className=\"flex items-center gap-3 text-xs text-gray-400 flex-wrap\">\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">/</kbd>\n                  <span>keress</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\"></kbd>\n                  <span>navigls</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Enter</kbd>\n                  <span>kivlaszts</span>\n                </span>\n                <span className=\"hidden sm:inline-flex items-center gap-1\">\n                  <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded border border-gray-200 font-mono text-[10px]\">Esc</kbd>\n                  <span>bezrs</span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SmartSearchBar;\n","import React, { useState } from 'react';\nimport { Ruler, Camera, Check, X, AlertTriangle, RefreshCw, Maximize2, ArrowRight, Home, HelpCircle, Sparkles } from 'lucide-react';\n\n/**\n * ARMeasure - AR Measurement tool for checking if furniture fits\n * Room dimension calculator and fit checker\n */\nconst ARMeasure = ({ \n  product,\n  onClose,\n  onConfirmFit \n}) => {\n  const [step, setStep] = useState('input'); // 'input' | 'measuring' | 'result'\n  const [roomDimensions, setRoomDimensions] = useState({\n    width: '',\n    length: '',\n    height: ''\n  });\n  const [fitResult, setFitResult] = useState(null);\n\n  // Product dimensions (mock if not provided)\n  const productDimensions = {\n    width: product?.dimensions?.width || 220,\n    depth: product?.dimensions?.depth || 95,\n    height: product?.dimensions?.height || 85,\n  };\n\n  const handleDimensionChange = (field, value) => {\n    const numValue = value.replace(/[^0-9]/g, '');\n    setRoomDimensions(prev => ({ ...prev, [field]: numValue }));\n  };\n\n  const handleCheckFit = () => {\n    setStep('measuring');\n    \n    // Simulate measurement processing\n    setTimeout(() => {\n      const roomW = parseInt(roomDimensions.width) || 0;\n      const roomL = parseInt(roomDimensions.length) || 0;\n      const roomH = parseInt(roomDimensions.height) || 300;\n      \n      const fitsWidth = productDimensions.width + 100 <= roomW; // 100cm clearance\n      const fitsDepth = productDimensions.depth + 80 <= roomL; // 80cm walkway\n      const fitsHeight = productDimensions.height + 50 <= roomH;\n      \n      const spaceFit = fitsWidth && fitsDepth && fitsHeight;\n      const tightFit = !spaceFit && (productDimensions.width <= roomW && productDimensions.depth <= roomL);\n      \n      setFitResult({\n        fits: spaceFit,\n        tightFit: tightFit,\n        details: {\n          width: { room: roomW, product: productDimensions.width, fits: fitsWidth },\n          depth: { room: roomL, product: productDimensions.depth, fits: fitsDepth },\n          height: { room: roomH, product: productDimensions.height, fits: fitsHeight },\n        },\n        suggestions: !spaceFit ? [\n          tightFit ? 'Szoros illeszkeds - kevs mozgstr marad' : 'Vlassz kisebb mretet',\n          'Mrj jra pontosan',\n          'Nzd meg a hasonl, kisebb termkeket'\n        ] : []\n      });\n      \n      setStep('result');\n    }, 1500);\n  };\n\n  const resetMeasurement = () => {\n    setStep('input');\n    setRoomDimensions({ width: '', length: '', height: '' });\n    setFitResult(null);\n  };\n\n  const isFormValid = roomDimensions.width && roomDimensions.length;\n\n  return (\n    <div className=\"bg-white rounded-2xl border border-gray-200 overflow-hidden max-w-md mx-auto\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-secondary-500 to-secondary-700 p-4 sm:p-5 text-white\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center\">\n              <Ruler className=\"w-5 h-5\" />\n            </div>\n            <div>\n              <h3 className=\"font-bold text-lg\">Befr-e?</h3>\n              <p className=\"text-white/80 text-sm\">Mret ellenrzs</p>\n            </div>\n          </div>\n          {onClose && (\n            <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-lg transition-colors\">\n              <X className=\"w-5 h-5\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Product Dimensions Card */}\n      <div className=\"p-4 bg-gray-50 border-b border-gray-200\">\n        <div className=\"flex items-center gap-3 mb-3\">\n          <div className=\"w-14 h-14 bg-white rounded-xl overflow-hidden shrink-0 shadow-sm\">\n            {product?.image ? (\n              <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\n            ) : (\n              <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\n                <Home className=\"w-6 h-6 text-gray-300\" />\n              </div>\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h4 className=\"font-medium text-gray-900 text-sm truncate\">{product?.name || 'Termk'}</h4>\n            <p className=\"text-xs text-gray-500\">{product?.category}</p>\n          </div>\n        </div>\n        \n        <div className=\"grid grid-cols-3 gap-2\">\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Szlessg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.width} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Mlysg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.depth} cm</p>\n          </div>\n          <div className=\"bg-white rounded-lg p-2 text-center\">\n            <p className=\"text-[10px] text-gray-500 uppercase tracking-wide\">Magassg</p>\n            <p className=\"font-bold text-gray-900\">{productDimensions.height} cm</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Step Content */}\n      <div className=\"p-4 sm:p-5\">\n        {/* Input Step */}\n        {step === 'input' && (\n          <div className=\"space-y-4\">\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <label className=\"text-sm font-medium text-gray-900\">Add meg a szoba mreteit</label>\n                <button className=\"text-gray-400 hover:text-gray-600\">\n                  <HelpCircle className=\"w-4 h-4\" />\n                </button>\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Szlessg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.width}\n                    onChange={(e) => handleDimensionChange('width', e.target.value)}\n                    placeholder=\"pl. 400\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-xs text-gray-500 mb-1 block\">Hosszsg (cm)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={roomDimensions.length}\n                    onChange={(e) => handleDimensionChange('length', e.target.value)}\n                    placeholder=\"pl. 500\"\n                    className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"mt-3\">\n                <label className=\"text-xs text-gray-500 mb-1 block\">Mennyezet magassg (opcionlis)</label>\n                <input\n                  type=\"text\"\n                  inputMode=\"numeric\"\n                  value={roomDimensions.height}\n                  onChange={(e) => handleDimensionChange('height', e.target.value)}\n                  placeholder=\"pl. 270\"\n                  className=\"w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:outline-none focus:border-secondary-400 focus:ring-2 focus:ring-secondary-100\"\n                />\n              </div>\n            </div>\n\n            {/* AR Measure Option */}\n            <div className=\"bg-gradient-to-r from-secondary-50 to-primary-50 rounded-xl p-3 border border-secondary-100\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm\">\n                  <Camera className=\"w-5 h-5 text-secondary-600\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-gray-900\">AR Mrs</p>\n                  <p className=\"text-xs text-gray-500\">Mrd le kamerval</p>\n                </div>\n                <span className=\"px-2 py-1 bg-secondary-100 text-secondary-700 text-[10px] font-bold rounded-full\">\n                  Hamarosan\n                </span>\n              </div>\n            </div>\n\n            <button\n              onClick={handleCheckFit}\n              disabled={!isFormValid}\n              className={`w-full flex items-center justify-center gap-2 py-3.5 rounded-xl font-bold transition-all ${\n                isFormValid \n                  ? 'bg-gradient-to-r from-secondary-500 to-secondary-700 text-white shadow-lg hover:shadow-xl hover:scale-[1.02]' \n                  : 'bg-gray-100 text-gray-400 cursor-not-allowed'\n              }`}\n            >\n              <Maximize2 className=\"w-5 h-5\" />\n              Ellenrzs\n            </button>\n          </div>\n        )}\n\n        {/* Measuring Step */}\n        {step === 'measuring' && (\n          <div className=\"text-center py-8\">\n            <div className=\"w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Ruler className=\"w-8 h-8 text-secondary-600 animate-pulse\" />\n            </div>\n            <h4 className=\"font-bold text-gray-900 mb-2\">Szmts folyamatban...</h4>\n            <p className=\"text-sm text-gray-500\">Ellenrizzk, hogy befr-e a btor</p>\n          </div>\n        )}\n\n        {/* Result Step */}\n        {step === 'result' && fitResult && (\n          <div className=\"space-y-4\">\n            {/* Result Header */}\n            <div className={`p-4 rounded-xl ${\n              fitResult.fits \n                ? 'bg-green-50 border border-green-200' \n                : fitResult.tightFit \n                  ? 'bg-amber-50 border border-amber-200'\n                  : 'bg-red-50 border border-red-200'\n            }`}>\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-12 h-12 rounded-full flex items-center justify-center ${\n                  fitResult.fits \n                    ? 'bg-green-500' \n                    : fitResult.tightFit \n                      ? 'bg-amber-500' \n                      : 'bg-red-500'\n                }`}>\n                  {fitResult.fits ? (\n                    <Check className=\"w-6 h-6 text-white\" />\n                  ) : fitResult.tightFit ? (\n                    <AlertTriangle className=\"w-6 h-6 text-white\" />\n                  ) : (\n                    <X className=\"w-6 h-6 text-white\" />\n                  )}\n                </div>\n                <div>\n                  <h4 className={`font-bold ${\n                    fitResult.fits \n                      ? 'text-green-700' \n                      : fitResult.tightFit \n                        ? 'text-amber-700' \n                        : 'text-red-700'\n                  }`}>\n                    {fitResult.fits \n                      ? 'Tkletesen befr!' \n                      : fitResult.tightFit \n                        ? 'Szoros illeszkeds' \n                        : 'Nem fr be'}\n                  </h4>\n                  <p className=\"text-sm text-gray-600\">\n                    {fitResult.fits \n                      ? 'A btor knyelmesen elfr a szobban' \n                      : fitResult.tightFit \n                        ? 'Fizikailag befr, de kevs hely marad' \n                        : 'Sajnos tl nagy a termk'}\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Dimension Details */}\n            <div className=\"space-y-2\">\n              {Object.entries(fitResult.details).map(([key, data]) => (\n                <div key={key} className=\"flex items-center justify-between py-2 px-3 bg-gray-50 rounded-lg\">\n                  <span className=\"text-sm text-gray-600 capitalize\">\n                    {key === 'width' ? 'Szlessg' : key === 'depth' ? 'Mlysg' : 'Magassg'}\n                  </span>\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm text-gray-900\">\n                      {data.product} / {data.room} cm\n                    </span>\n                    {data.fits ? (\n                      <Check className=\"w-4 h-4 text-green-500\" />\n                    ) : (\n                      <X className=\"w-4 h-4 text-red-500\" />\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* Suggestions */}\n            {fitResult.suggestions.length > 0 && (\n              <div className=\"bg-gray-50 rounded-xl p-3\">\n                <p className=\"text-xs font-medium text-gray-500 mb-2\">Javaslatok:</p>\n                <ul className=\"space-y-1\">\n                  {fitResult.suggestions.map((suggestion, idx) => (\n                    <li key={idx} className=\"flex items-center gap-2 text-sm text-gray-700\">\n                      <Sparkles className=\"w-3.5 h-3.5 text-primary-500\" />\n                      {suggestion}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={resetMeasurement}\n                className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors\"\n              >\n                <RefreshCw className=\"w-4 h-4\" />\n                jra\n              </button>\n              {fitResult.fits && (\n                <button\n                  onClick={() => onConfirmFit?.()}\n                  className=\"flex-1 flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:shadow-lg transition-all\"\n                >\n                  Kosrba\n                  <ArrowRight className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ARMeasure;\n","import React, { useState, useEffect } from 'react';\nimport { ShoppingCart, Heart, Minus, Plus, Check, Zap, ChevronUp, Star, Truck } from 'lucide-react';\n\n/**\n * StickyAddToCartMobile - Floating add to cart bar for mobile\n * Always visible, smooth UX with quantity selector\n */\nconst StickyAddToCartMobile = ({ \n  product,\n  isVisible = true,\n  onAddToCart,\n  onToggleWishlist,\n  isInWishlist = false,\n  isInCart = false,\n  freeShippingThreshold = 50000\n}) => {\n  const [quantity, setQuantity] = useState(1);\n  const [showQuantity, setShowQuantity] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [justAdded, setJustAdded] = useState(false);\n\n  const price = product?.price || 0;\n  const originalPrice = product?.originalPrice;\n  const discount = originalPrice ? Math.round((1 - price / originalPrice) * 100) : 0;\n  const totalPrice = price * quantity;\n  const freeShippingRemaining = Math.max(0, freeShippingThreshold - totalPrice);\n\n  const handleAddToCart = async () => {\n    setIsAdding(true);\n    try {\n      await onAddToCart?.(product, quantity);\n      setJustAdded(true);\n      setTimeout(() => {\n        setJustAdded(false);\n        setQuantity(1);\n        setShowQuantity(false);\n      }, 2000);\n    } catch {\n      /* handled by parent / toast */\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const incrementQuantity = () => setQuantity(q => Math.min(q + 1, 10));\n  const decrementQuantity = () => setQuantity(q => Math.max(q - 1, 1));\n\n  if (!isVisible || !product) return null;\n\n  return (\n    <>\n      {/* Backdrop when quantity selector is open */}\n      {showQuantity && (\n        <div \n          className=\"fixed inset-0 bg-black/20 z-40 sm:hidden\"\n          onClick={() => setShowQuantity(false)}\n        />\n      )}\n\n      {/* Sticky Bar - Mobile Only */}\n      <div className=\"fixed bottom-0 left-0 right-0 z-50 sm:hidden\">\n        {/* Free Shipping Progress - Compact */}\n        {freeShippingRemaining > 0 && freeShippingRemaining < freeShippingThreshold && (\n          <div className=\"bg-gradient-to-r from-emerald-500 to-green-500 px-4 py-1.5\">\n            <div className=\"flex items-center justify-center gap-2 text-white text-xs\">\n              <Truck className=\"w-3.5 h-3.5\" />\n              <span>Mg <strong>{freeShippingRemaining.toLocaleString()} Ft</strong> az ingyenes szlltsig!</span>\n            </div>\n          </div>\n        )}\n\n        {/* Quantity Selector Panel */}\n        {showQuantity && (\n          <div className=\"bg-white border-t border-gray-200 px-4 py-3 animate-slide-up\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium text-gray-700\">Mennyisg</span>\n              <div className=\"flex items-center gap-3 bg-gray-100 rounded-xl p-1\">\n                <button\n                  onClick={decrementQuantity}\n                  disabled={quantity <= 1}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Minus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n                <span className=\"w-8 text-center font-bold text-gray-900 text-lg\">{quantity}</span>\n                <button\n                  onClick={incrementQuantity}\n                  disabled={quantity >= 10}\n                  className=\"w-10 h-10 flex items-center justify-center rounded-lg bg-white shadow-sm disabled:opacity-50\"\n                >\n                  <Plus className=\"w-4 h-4 text-gray-700\" />\n                </button>\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-gray-100\">\n              <span className=\"text-sm text-gray-600\">sszesen:</span>\n              <span className=\"text-xl font-black text-gray-900\">{totalPrice.toLocaleString()} Ft</span>\n            </div>\n          </div>\n        )}\n\n        {/* Main Bar */}\n        <div className=\"bg-white border-t border-gray-200 px-3 py-2.5 shadow-[0_-4px_20px_rgba(0,0,0,0.1)]\">\n          <div className=\"flex items-center gap-2\">\n            {/* Wishlist Button */}\n            <button\n              onClick={() => onToggleWishlist?.(product)}\n              className={`w-12 h-12 flex items-center justify-center rounded-xl border-2 transition-all ${\n                isInWishlist \n                  ? 'bg-red-50 border-red-200 text-red-500' \n                  : 'bg-white border-gray-200 text-gray-500'\n              }`}\n            >\n              <Heart className={`w-5 h-5 ${isInWishlist ? 'fill-current' : ''}`} />\n            </button>\n\n            {/* Price & Quantity Toggle */}\n            <button\n              onClick={() => setShowQuantity(!showQuantity)}\n              className=\"flex-1 flex items-center justify-between px-3 py-2 bg-gray-50 rounded-xl\"\n            >\n              <div className=\"text-left\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-black text-gray-900 text-lg\">{price.toLocaleString()} Ft</span>\n                  {discount > 0 && (\n                    <span className=\"px-1.5 py-0.5 bg-red-100 text-red-600 text-[10px] font-bold rounded\">\n                      -{discount}%\n                    </span>\n                  )}\n                </div>\n                {quantity > 1 && (\n                  <span className=\"text-xs text-gray-500\">{quantity} db = {totalPrice.toLocaleString()} Ft</span>\n                )}\n              </div>\n              <ChevronUp className={`w-5 h-5 text-gray-400 transition-transform ${showQuantity ? 'rotate-180' : ''}`} />\n            </button>\n\n            {/* Add to Cart Button */}\n            <button\n              onClick={handleAddToCart}\n              disabled={isAdding || justAdded}\n              className={`h-12 px-5 flex items-center justify-center gap-2 rounded-xl font-bold text-sm transition-all ${\n                justAdded\n                  ? 'bg-green-500 text-white'\n                  : isAdding\n                    ? 'bg-gray-200 text-gray-500'\n                    : 'bg-gradient-to-r from-primary-500 to-secondary-600 text-white shadow-lg active:scale-95'\n              }`}\n            >\n              {justAdded ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  <span>Hozzadva!</span>\n                </>\n              ) : isAdding ? (\n                <div className=\"w-5 h-5 border-2 border-gray-400 border-t-transparent rounded-full animate-spin\" />\n              ) : (\n                <>\n                  <ShoppingCart className=\"w-5 h-5\" />\n                  <span>Kosrba</span>\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        @keyframes slide-up {\n          from { transform: translateY(100%); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        .animate-slide-up { animation: slide-up 0.2s ease-out; }\n      `}</style>\n    </>\n  );\n};\n\nexport default StickyAddToCartMobile;\n","import React from 'react';\nimport { Shield, Truck, RefreshCw, CreditCard, Award, Clock, Phone, Lock, CheckCircle, Star, Heart, Headphones } from 'lucide-react';\n\n/**\n * TrustBadges - Trust signals and guarantees\n * Multiple variants for different placements\n */\nconst TrustBadges = ({ \n  variant = 'footer', // 'footer' | 'product' | 'checkout' | 'mini' | 'horizontal'\n  className = ''\n}) => {\n  const badges = [\n    {\n      icon: Truck,\n      title: 'Ingyenes szllts',\n      description: '50.000 Ft felett',\n      color: 'text-emerald-600',\n      bgColor: 'bg-emerald-50',\n    },\n    {\n      icon: RefreshCw,\n      title: '30 napos visszaklds',\n      description: 'Krds nlkl',\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n    },\n    {\n      icon: Shield,\n      title: 'Biztonsgos fizets',\n      description: 'SSL titkosts',\n      color: 'text-purple-600',\n      bgColor: 'bg-purple-50',\n    },\n    {\n      icon: Award,\n      title: '2 v garancia',\n      description: 'Minden termkre',\n      color: 'text-amber-600',\n      bgColor: 'bg-amber-50',\n    },\n    {\n      icon: Headphones,\n      title: 'gyflszolglat',\n      description: 'H-P 8:00-18:00',\n      color: 'text-secondary-600',\n      bgColor: 'bg-secondary-50',\n    },\n    {\n      icon: Heart,\n      title: '50.000+ elgedett vsrl',\n      description: '4.9/5 rtkels',\n      color: 'text-red-500',\n      bgColor: 'bg-red-50',\n    },\n  ];\n\n  // Mini variant - icons only, horizontal\n  if (variant === 'mini') {\n    return (\n      <div className={`flex items-center justify-center gap-4 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-1.5 text-gray-600\"\n            title={badge.title}\n          >\n            <badge.icon className=\"w-4 h-4\" />\n            <span className=\"text-xs font-medium hidden sm:inline\">{badge.title.split(' ')[0]}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Horizontal variant - single row with all info\n  if (variant === 'horizontal') {\n    return (\n      <div className={`bg-gray-50 border-y border-gray-200 py-4 ${className}`}>\n        <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 overflow-x-auto scrollbar-hide\">\n            {badges.slice(0, 4).map((badge, idx) => (\n              <div key={idx} className=\"flex items-center gap-3 shrink-0\">\n                <div className={`w-10 h-10 ${badge.bgColor} rounded-xl flex items-center justify-center`}>\n                  <badge.icon className={`w-5 h-5 ${badge.color}`} />\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900 text-sm whitespace-nowrap\">{badge.title}</p>\n                  <p className=\"text-xs text-gray-500\">{badge.description}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Product variant - compact badges for product page\n  if (variant === 'product') {\n    return (\n      <div className={`grid grid-cols-2 gap-2 ${className}`}>\n        {badges.slice(0, 4).map((badge, idx) => (\n          <div \n            key={idx}\n            className=\"flex items-center gap-2 p-2.5 bg-gray-50 rounded-xl\"\n          >\n            <badge.icon className={`w-5 h-5 ${badge.color} shrink-0`} />\n            <div className=\"min-w-0\">\n              <p className=\"text-xs font-medium text-gray-900 truncate\">{badge.title}</p>\n              <p className=\"text-[10px] text-gray-500 truncate\">{badge.description}</p>\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Checkout variant - reassurance badges\n  if (variant === 'checkout') {\n    const checkoutBadges = [\n      { icon: Lock, text: 'Biztonsgos fizets', color: 'text-green-600' },\n      { icon: Shield, text: 'Adatvdelem', color: 'text-blue-600' },\n      { icon: RefreshCw, text: 'Pnzvisszafizets', color: 'text-purple-600' },\n    ];\n\n    return (\n      <div className={`flex items-center justify-center gap-6 py-3 ${className}`}>\n        {checkoutBadges.map((badge, idx) => (\n          <div key={idx} className=\"flex items-center gap-1.5\">\n            <badge.icon className={`w-4 h-4 ${badge.color}`} />\n            <span className=\"text-xs text-gray-600 font-medium\">{badge.text}</span>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // Footer variant - full display\n  return (\n    <div className={`bg-gradient-to-b from-gray-50 to-gray-100 py-10 sm:py-12 ${className}`}>\n      <div className=\"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h3 className=\"text-lg sm:text-xl font-bold text-gray-900 mb-2\">\n            Mirt vlassz minket?\n          </h3>\n          <p className=\"text-sm text-gray-600\">\n            Tbb mint 50.000 elgedett vsrl bzik bennnk\n          </p>\n        </div>\n\n        {/* Badges Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n          {badges.map((badge, idx) => (\n            <div \n              key={idx}\n              className=\"bg-white rounded-2xl p-4 sm:p-5 text-center border border-gray-100 shadow-sm hover:shadow-md transition-shadow\"\n            >\n              <div className={`w-12 h-12 ${badge.bgColor} rounded-xl flex items-center justify-center mx-auto mb-3`}>\n                <badge.icon className={`w-6 h-6 ${badge.color}`} />\n              </div>\n              <h4 className=\"font-bold text-gray-900 text-sm mb-1\">{badge.title}</h4>\n              <p className=\"text-xs text-gray-500\">{badge.description}</p>\n            </div>\n          ))}\n        </div>\n\n        {/* Payment Methods & Security */}\n        <div className=\"mt-8 pt-8 border-t border-gray-200\">\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            {/* Payment Methods */}\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-xs text-gray-500\">Fizetsi mdok:</span>\n              <div className=\"flex items-center gap-2\">\n                {['Visa', 'Mastercard', 'PayPal', 'Apple Pay'].map((method, idx) => (\n                  <div \n                    key={idx}\n                    className=\"h-8 px-3 bg-white rounded-lg border border-gray-200 flex items-center justify-center\"\n                  >\n                    <span className=\"text-xs font-medium text-gray-700\">{method}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Security Badge */}\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-green-50 rounded-full\">\n              <Lock className=\"w-4 h-4 text-green-600\" />\n              <span className=\"text-xs font-medium text-green-700\">256-bit SSL titkosts</span>\n              <CheckCircle className=\"w-4 h-4 text-green-600\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Trust Rating */}\n        <div className=\"mt-6 flex items-center justify-center gap-4\">\n          <div className=\"flex items-center gap-1\">\n            {[1, 2, 3, 4, 5].map(star => (\n              <Star key={star} className=\"w-5 h-5 text-yellow-400 fill-yellow-400\" />\n            ))}\n          </div>\n          <span className=\"text-sm text-gray-600\">\n            <strong className=\"text-gray-900\">4.9/5</strong> rtkels 12.000+ vlemny alapjn\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TrustBadges;\n","import { useEffect, useState, useRef } from 'react';\n\n/**\n * Custom hook for detecting mobile viewport\n */\nexport const useIsMobile = (breakpoint = 768) => {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < breakpoint);\n    };\n\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    \n    return () => window.removeEventListener('resize', checkMobile);\n  }, [breakpoint]);\n\n  return isMobile;\n};\n\n/**\n * Custom hook for managing localStorage\n */\nexport const useLocalStorage = (key, initialValue) => {\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      console.error(error);\n      return initialValue;\n    }\n  });\n\n  const setValue = (value) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return [storedValue, setValue];\n};\n\n/**\n * Custom hook for debouncing values\n */\nexport const useDebounce = (value, delay = 500) => {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n};\n\n/**\n * Custom hook for intersection observer (lazy loading).\n * options is read from ref to avoid re-creating observer on every render.\n */\nexport const useIntersectionObserver = (options = {}) => {\n  const [ref, setRef] = useState(null);\n  const [isIntersecting, setIsIntersecting] = useState(false);\n  const optionsRef = useRef(options);\n  optionsRef.current = options;\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!ref || !(ref instanceof Element)) return;\n\n    const observer = new IntersectionObserver(([entry]) => {\n      setIsIntersecting(entry.isIntersecting);\n    }, optionsRef.current);\n\n    try {\n      observer.observe(ref);\n    } catch (err) {\n      return;\n    }\n\n    return () => {\n      observer.disconnect();\n    };\n  }, [ref]);\n\n  return [setRef, isIntersecting];\n};\n\n// Re-export from other hook files\nexport { useToast } from './useToast';\nexport { useInfiniteScroll, InfiniteScrollSentinel } from './useInfiniteScroll.jsx';\nexport { \n  useScrollAnimation, \n  useStaggerAnimation, \n  useParallax, \n  useScrollProgress \n} from './useScrollAnimation';\nexport { useScrollLock } from './useScrollLock';\n","import React, { useState, useEffect, useRef } from 'react';\n\nconst DEFAULT_ROOT_MARGIN = '200px';\nconst DEFAULT_THRESHOLD = 0;\n\n/**\n * useDeferredSection - IntersectionObserver-based deferred mount.\n * Children mount only when the wrapper is near the viewport (rootMargin).\n * @param {Object} options - { rootMargin, threshold }\n * @returns {[React.RefObject, boolean]} - [ref to attach to wrapper, shouldMount]\n */\nexport function useDeferredSection(options = {}) {\n  const { rootMargin = DEFAULT_ROOT_MARGIN, threshold = DEFAULT_THRESHOLD } = options;\n  const [shouldMount, setShouldMount] = useState(false);\n  const ref = useRef(null);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el || !(el instanceof Element) || shouldMount) return;\n\n    const io = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) setShouldMount(true);\n      },\n      { rootMargin, threshold }\n    );\n    io.observe(el);\n    return () => io.disconnect();\n  }, [rootMargin, threshold, shouldMount]);\n\n  return [ref, shouldMount];\n}\n\n/**\n * DeferredSection - Wrapper that defers rendering children until near viewport.\n * Uses a minimal sentinel (min-height) when not mounted so IntersectionObserver can fire.\n */\nexport function DeferredSection({ children, rootMargin = '200px', threshold = 0, fallback = null, className = '', minHeight = '100px', ...rest }) {\n  const [ref, shouldMount] = useDeferredSection({ rootMargin, threshold });\n  const content = shouldMount ? children : (fallback ?? <div style={{ minHeight }} aria-hidden=\"true\" />);\n  return (\n    <div ref={ref} className={className} {...rest}>\n      {content}\n    </div>\n  );\n}\n","/**\n * Marketly AI Btorbolt  kzponti konfigurci\n * Egy helyen: domain, shop id, batch mret, tab hash mapping.\n */\n\nexport const WEBSHOP_DOMAIN = 'https://www.marketly.hu';\nexport const SHOP_ID = '81697';\n\n/** Kezdeti s \"load more\" batch mret a termk listnl */\nexport const DISPLAY_BATCH = 36;\n/** Els lap mrete (API)  gyors first paint, alacsony memria */\nexport const INITIAL_PAGE = 36;\n\n/** Tab rtkek s hash (#shop, #visual-search, #room-planner) */\nexport const TAB_HASH = {\n  shop: 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n\nexport const HASH_TO_TAB = {\n  '': 'shop',\n  'shop': 'shop',\n  'visual-search': 'visual-search',\n  'room-planner': 'room-planner'\n};\n","import React, { useState, useEffect, useLayoutEffect, useRef, useMemo, useCallback, Suspense, lazy } from 'react';\nimport { ShoppingCart, Camera, MessageCircle, X, Send, Plus, Trash2, Home, ZoomIn, Upload, RefreshCw, AlertCircle, Database, Lock, Search, ChevronLeft, ChevronRight, Filter, Heart, Info, Check, Star, Truck, ShieldCheck, Phone, ArrowRight, Mail, Eye, Sparkles, Lightbulb, Menu, Bot, Moon, Sun, Clock, Gift, Zap, TrendingUp, Instagram, Facebook, MapPin, Grid3X3, ExternalLink, Timer, ChevronDown } from 'lucide-react';\n// framer-motion removed due to Vite production build TDZ issues\nimport { fetchUnasProducts, refreshUnasProducts, fetchCategories, fetchCategoryHierarchy, fetchSearchIndex, fetchProductStats, fetchUnasProductById } from './services/unasApi';\nimport { addToUnasCart } from './services/unasCartService';\nimport { trackProductView as trackProductViewPref, getPersonalizedRecommendations, getSimilarProducts } from './services/userPreferencesService';\n\n// New UI Components\nimport { ProductCardSkeleton } from './components/ui/Skeleton';\nimport { ToastProvider, useToast } from './components/ui/Toast';\nimport { NoSearchResults, NoFilterResults, ErrorState } from './components/ui/EmptyState';\nimport { SmartBadges } from './components/ui/Badge';\n\n// AI Components\nimport { AIShowcase, AIOnboarding } from './components/ai/AIShowcase';\n// Lazy load heavier AI features for smaller initial bundle\nconst AIChatAssistant = lazy(() => import('./components/ai/AIChatAssistant'));\nconst AIRoomDesigner = lazy(() => import('./components/ai/AIRoomDesigner'));\nconst AIStyleQuiz = lazy(() => import('./components/ai/AIStyleQuiz'));\n\n// Category Components\nimport CategorySwipe from './components/category/CategorySwipe';\nimport CategoryPage from './components/category/CategoryPage';\nimport CollectionPage from './components/collection/CollectionPage';\nimport MainCategoriesSection from './components/category/MainCategoriesSection';\nimport { getCollectionById } from './config/collections';\nimport Navbar from './components/layout/Navbar';\n\n// UX Components\nimport ScrollProgress from './components/ux/ScrollProgress';\nimport BackToTop from './components/ux/BackToTop';\nimport LiveSocialProof from './components/ux/LiveSocialProof';\nimport LiveActivityStrip from './components/ux/LiveActivityStrip';\n\n// Landing Components  \nimport { ModernHero } from './components/landing/ModernHero';\nconst AIModuleUnified = lazy(() => import('./components/landing/AIModuleUnified'));\nimport { InteractiveCTA } from './components/landing/ShowcaseSections';\nconst InspirationSection = lazy(() => import('./components/landing/InspirationSection'));\nconst ProductWorldsSection = lazy(() => import('./components/landing/ProductWorldsSection'));\n// Footer eltvoltva - a f UNAS shopnak mr van sajt lblcce\n\n// Product Components\nimport { EnhancedProductCard } from './components/product/EnhancedProductCard';\nimport { SimilarProducts } from './components/product/SimilarProducts';\nimport { RecentlyViewed, trackProductView } from './components/product/RecentlyViewed';\nimport { ProductComparison, useComparison } from './components/product/ProductComparison';\nimport { AdvancedFilters, AdvancedFiltersPanel, applyFilters } from './components/product/AdvancedFilters';\nimport QuickAddToCart from './components/product/QuickAddToCart';\nimport ProductQuickPeek from './components/product/ProductQuickPeek';\nimport AIPricePredictor from './components/ai/AIPricePredictor';\n\n// Search Components - removed VoiceSearch (framer-motion bundling issue)\n\n// Marketing Components\nimport SmartNewsletterPopup from './components/marketing/SmartNewsletterPopup';\nimport ExitIntentPopup from './components/marketing/ExitIntentPopup';\nconst NewsletterStrip = lazy(() => import('./components/marketing/NewsletterStrip'));\n\n// AR Components\nimport ARProductPreview from './components/ar/ARProductPreview';\n\n// New UX Components\nimport CompleteTheLook from './components/product/CompleteTheLook';\nconst PersonalizedSection = lazy(() => import('./components/home/PersonalizedSection'));\nimport ImageGallery from './components/product/ImageGallery';\nimport StickyAddToCart from './components/product/StickyAddToCart';\nimport PriceAlert from './components/product/PriceAlert';\nimport { FadeInOnScroll, Confetti, CountUp } from './components/ui/Animations';\nimport BottomSheet from './components/mobile/BottomSheet';\n\n// New UX Components - Phase 2\nimport WishlistDrawer from './components/wishlist/WishlistDrawer';\nimport FlashSaleBanner from './components/marketing/FlashSaleBanner';\nimport DeliveryEstimator from './components/product/DeliveryEstimator';\nimport StockUrgency from './components/product/StockUrgency';\nimport ProductShare from './components/product/ProductShare';\nimport QuickActionsBar from './components/product/QuickActionsBar';\nimport ProductTabs from './components/product/ProductTabs';\nimport SmartBundle from './components/product/SmartBundle';\nimport PriceHistory from './components/product/PriceHistory';\nimport OneClickCheckout from './components/checkout/OneClickCheckout';\nimport SmartSearchBar from './components/search/SmartSearchBar';\nconst LoyaltyProgram = lazy(() => import('./components/loyalty/LoyaltyProgram'));\nimport ARMeasure from './components/ar/ARMeasure';\nimport StickyAddToCartMobile from './components/mobile/StickyAddToCartMobile';\nimport TrustBadges from './components/trust/TrustBadges';\n\n// Hooks\nimport { useLocalStorage, useDebounce, useScrollLock } from './hooks/index';\nimport { DeferredSection } from './hooks/useDeferredSection';\n// useInfiniteScroll removed - using manual \"Load More\" button instead\n\n// Utils\nimport { getOptimizedImageProps } from './utils/imageOptimizer';\nimport { PLACEHOLDER_IMAGE, formatPrice, normalizeProduct } from './utils/helpers';\nimport { WEBSHOP_DOMAIN, SHOP_ID, DISPLAY_BATCH, INITIAL_PAGE, TAB_HASH, HASH_TO_TAB } from './config';\n\n/* --- 1. KONFIGURCI & ADATOK (config.js) --- */\n\nconst MODAL_LOADING_FALLBACK = (\n  <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/30\">\n    <div className=\"w-10 h-10 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n  </div>\n);\n\n/* Scroll idztsek  egysges grgets a termk szekcihoz */\nconst SCROLL_DELAY_INITIAL = 80;   /* Els ksleltets (DOM render) */\nconst SCROLL_DELAY_RETRY = 200;    /* Msodik prblkozs (layout settle) */\nconst SCROLL_DELAY_FINAL = 400;    /* Harmadik (kpek/betltsek) */\nconst SCROLL_THROTTLE_MS = 180;    /* Minimum idklnbsg hvsok kztt */\nconst SCROLL_RETRY_MAX = 15;       /* Max retry, ha elem mg nincs DOM-ban */\n\n/* --- 2. SEGDFGGVNYEK --- */\n\nconst fixUrl = (url, type = 'main') => {\n    if (!url) return PLACEHOLDER_IMAGE;\n    let cleanUrl = url.trim().replace(/^\"|\"$/g, '');\n    \n    if (cleanUrl.length === 0) return PLACEHOLDER_IMAGE;\n    if (cleanUrl.startsWith('http')) return cleanUrl;\n\n    // UNAS specilis tvonalak kezelse\n    if (!cleanUrl.includes('/')) {\n        const folder = type === 'alt' ? 'shop_altpic' : 'shop_pic';\n        return `${WEBSHOP_DOMAIN}/shop_ordered/${SHOP_ID}/${folder}/${cleanUrl}`;\n    }\n\n    // Relatv tvonalak\n    if (cleanUrl.startsWith('/') || cleanUrl.startsWith('img/')) {\n        const path = cleanUrl.startsWith('/') ? cleanUrl : '/' + cleanUrl;\n        return WEBSHOP_DOMAIN.replace(/\\/$/, '') + path;\n    }\n\n    return cleanUrl;\n};\n\nconst generateAltImages = (mainImageUrl) => {\n    if (mainImageUrl.includes('/shop_pic/')) {\n        const baseUrl = mainImageUrl.replace('/shop_pic/', '/shop_altpic/');\n        const extIndex = baseUrl.lastIndexOf('.');\n        if (extIndex > -1) {\n            const basePath = baseUrl.substring(0, extIndex);\n            const ext = baseUrl.substring(extIndex);\n            return [\n                `${basePath}_altpic_1${ext}`,\n                `${basePath}_altpic_2${ext}`\n            ];\n        }\n    }\n    return [];\n};\n\nconst splitCSVLine = (line, delimiter) => {\n    const values = [];\n    let current = '';\n    let inQuotes = false;\n    for (let i = 0; i < line.length; i++) {\n        const char = line[i];\n        if (char === '\"') { inQuotes = !inQuotes; }\n        else if (char === delimiter && !inQuotes) { values.push(current); current = ''; }\n        else { current += char; }\n    }\n    values.push(current);\n    return values;\n};\n\nconst parseCSV = (csvText) => {\n  const lines = csvText.split(/\\r?\\n/);\n  const products = [];\n  if (lines.length < 2) return [];\n\n  const firstLine = lines[0];\n  const delimiter = (firstLine.match(/;/g) || []).length > (firstLine.match(/,/g) || []).length ? ';' : ',';\n  const headers = splitCSVLine(firstLine, delimiter).map(h => h.trim().replace(/^\"|\"$/g, ''));\n  \n  const findCol = (name) => headers.findIndex(h => h.toLowerCase().includes(name.toLowerCase()));\n\n  const nameCol = findCol(\"Termk Nv\");\n  const priceCol = findCol(\"Brutt r\"); \n  const catCol = findCol(\"Kategria\");\n  const imgCol = findCol(\"Kp link\"); \n  const urlCol = findCol(\"Termk link\");\n  const descCol = findCol(\"Tulajdonsgok\");\n  const stockCol = findCol(\"Raktrkszlet\");\n  const altImgCol = findCol(\"Kp kapcsolat\"); \n  \n  const paramCols = headers.reduce((acc, header, index) => {\n      if (header.startsWith(\"Paramter:\")) {\n          const cleanName = header.replace(\"Paramter:\", \"\").split(\"|\")[0].trim();\n          acc.push({ index, name: cleanName });\n      }\n      return acc;\n  }, []);\n\n  for (let i = 1; i < lines.length; i++) {\n      if (!lines[i].trim()) continue;\n      const row = splitCSVLine(lines[i], delimiter);\n      const getVal = (colIndex) => colIndex > -1 && row[colIndex] ? row[colIndex].replace(/^\"|\"$/g, '').trim() : \"\";\n\n      const stock = getVal(stockCol);\n      const priceStr = getVal(priceCol);\n      if (!priceStr || !getVal(nameCol)) continue;\n\n      let categoryPath = getVal(catCol) || \"Egyb\";\n      const category = categoryPath.includes('>') ? categoryPath.split('>').pop().trim() : categoryPath;\n\n      const mainImgUrl = fixUrl(getVal(imgCol), 'main');\n      let images = [mainImgUrl];\n      \n      const altImgsRaw = getVal(altImgCol);\n      if (altImgsRaw) {\n          const alts = altImgsRaw.split(/[|]/).map(url => fixUrl(url.trim(), 'alt'));\n          images = [...images, ...alts].slice(0, 4);\n      } else {\n          const generatedAlts = generateAltImages(mainImgUrl);\n          images = [...images, ...generatedAlts];\n      }\n\n      let aiContextParams = [];\n      paramCols.forEach(p => {\n          const val = getVal(p.index);\n          if (val) aiContextParams.push(`${p.name}: ${val}`);\n      });\n      const paramsString = aiContextParams.join(\", \");\n\n      products.push({\n          id: `mkt-prod-${i}`,\n          name: getVal(nameCol),\n          price: parseInt(priceStr.replace(/[^0-9]/g, '')) || 0,\n          category: category,\n          images: images, \n          description: getVal(descCol).replace(/<[^>]*>/g, ' ').substring(0, 500),\n          params: paramsString,\n          link: fixUrl(getVal(urlCol)),\n          inStock: !(stock === '0' || stock.toLowerCase() === 'nincs')\n      });\n  }\n  return products;\n};\n\n// --- 3. KOMPONENSEK ---\n\nconst FileLoaderBar = ({ onFileLoad, onUnasRefresh, isLoadingUnas, lastUpdated, unasError }) => {\n    const fileInputRef = useRef(null);\n    \n    const formatTimestamp = (timestamp) => {\n        if (!timestamp) return '';\n        const date = new Date(timestamp);\n        const now = new Date();\n        const diffMs = now - date;\n        const diffMins = Math.floor(diffMs / 60000);\n        \n        if (diffMins < 1) return 'most';\n        if (diffMins < 60) return `${diffMins} perce`;\n        const diffHours = Math.floor(diffMins / 60);\n        if (diffHours < 24) return `${diffHours} rja`;\n        return date.toLocaleDateString('hu-HU');\n    };\n    \n    return (\n        <div id=\"mkt-butorbolt-loader\" className=\"bg-primary-500 text-white py-3 px-4 shadow-md\">\n            <div className=\"max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-3\">\n                <div className=\"flex items-center\">\n                    <Database className=\"w-5 h-5 mr-2\" />\n                    <span className=\"text-sm font-medium\">\n                        {lastUpdated ? `Frisstve: ${formatTimestamp(lastUpdated)}` : 'Adatok betltse...'}\n                    </span>\n                    {unasError && (\n                        <span className=\"ml-2 text-xs bg-red-500 px-2 py-0.5 rounded-full flex items-center\">\n                            <AlertCircle className=\"w-3 h-3 mr-1\" /> Hiba\n                        </span>\n                    )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <input type=\"file\" ref={fileInputRef} accept=\".csv\" className=\"hidden\" onChange={(e) => {\n                        const file = e.target.files[0];\n                        if(file) {\n                            file.text().then(text => onFileLoad(parseCSV(text))).catch(err => console.warn('CSV betlts hiba:', err));\n                        }\n                    }} />\n                    <button \n                        onClick={() => fileInputRef.current?.click()} \n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm\"\n                    >\n                        <Upload className=\"w-4 h-4 mr-1.5\" /> CSV\n                    </button>\n                    <button \n                        onClick={onUnasRefresh}\n                        disabled={isLoadingUnas}\n                        className=\"bg-white text-primary-500 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-primary-50 transition-colors flex items-center shadow-sm disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                        <RefreshCw className={`w-4 h-4 mr-1.5 ${isLoadingUnas ? 'animate-spin' : ''}`} /> \n                        {isLoadingUnas ? 'Frissts...' : 'UNAS Frissts'}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst Features = () => (\n    <section className=\"py-12 sm:py-14 bg-white border-t border-gray-100\" aria-labelledby=\"features-heading\">\n        <div className=\"w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-16\">\n            <h2 id=\"features-heading\" className=\"sr-only\">Szolgltatsok</h2>\n            <div className=\"flex flex-col lg:flex-row gap-4\">\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-emerald-50/50 border border-emerald-100 shadow-[0_6px_20px_rgba(16,185,129,0.08)] hover:shadow-[0_12px_28px_rgba(16,185,129,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-emerald-300 via-emerald-400 to-emerald-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Truck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">Ingyenes szllts</h3>\n                            <p className=\"text-sm text-gray-600\">50.000 Ft felett minden rendelsnl</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-blue-50/50 border border-blue-100 shadow-[0_6px_20px_rgba(59,130,246,0.08)] hover:shadow-[0_12px_28px_rgba(59,130,246,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-blue-300 via-blue-400 to-blue-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <ShieldCheck className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">2 v garancia</h3>\n                            <p className=\"text-sm text-gray-600\">Minden termkre teljes kren</p>\n                        </div>\n                    </div>\n                </div>\n                <div className=\"group relative flex-1 overflow-hidden p-5 rounded-2xl bg-gradient-to-r from-white to-primary-50/45 border border-primary-100 shadow-[0_6px_20px_rgba(255,138,0,0.08)] hover:shadow-[0_12px_28px_rgba(255,138,0,0.14)] hover:-translate-y-0.5 transition-all duration-300\">\n                    <div className=\"absolute inset-y-4 left-0 w-px bg-gradient-to-b from-primary-300 via-primary-400 to-primary-300 opacity-70\" />\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-secondary-700 text-white flex items-center justify-center shrink-0 shadow-sm\">\n                            <Phone className=\"w-5 h-5\" aria-hidden />\n                        </div>\n                        <div className=\"min-w-0\">\n                            <h3 className=\"font-bold text-gray-900 text-base mb-0.5\">gyflszolglat</h3>\n                            <p className=\"text-sm text-gray-600\">Szakrt segtsg minden nap</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n);\n\nconst ProductModal = ({ product, isOpen, onClose, allProducts = [], onAddToCart }) => {\n    const [aiTip, setAiTip] = useState(null);\n    const [loadingTip, setLoadingTip] = useState(false);\n    useScrollLock(isOpen);\n    \n    useEffect(() => {\n        setAiTip(null);\n    }, [product]);\n\n    if (!isOpen || !product) return null;\n\n    const generateStyleTip = async () => {\n        setLoadingTip(true);\n        try {\n            const prompt = `Lakberendez vagy. Adj 2 rvid, konkrt tippet ehhez:\n            Termk: ${product.name} (${product.category})\n            Paramterek: ${product.params || \"Nincs adat\"}\n            Vlaszolj magyarul, emojikkal.`;\n\n            const { generateText } = await import('./services/geminiService');\n            const result = await generateText(prompt);\n            if (result.success) {\n                setAiTip(result.text);\n            } else {\n                setAiTip(\"Sajnos most nem tudok tippet adni.\");\n            }\n        } catch (error) {\n            setAiTip(\"Sajnos most nem tudok tippet adni.\");\n        } finally {\n            setLoadingTip(false);\n        }\n    };\n\n    return (\n        <div className=\"fixed inset-0 lg:top-[60px] z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in\" onClick={onClose}>\n            <div id=\"mkt-product-modal-root\" className=\"bg-white rounded-3xl w-full max-w-6xl max-h-[90vh] overflow-hidden shadow-2xl flex flex-col relative\" onClick={e => e.stopPropagation()}>\n                <button onClick={onClose} className=\"absolute top-4 right-4 z-10 bg-white/80 p-2 rounded-full hover:bg-gray-100 transition-colors\"><X className=\"w-6 h-6 text-gray-600\" /></button>\n                \n                <div className=\"flex flex-col md:flex-row overflow-y-auto\">\n                  {/* Left: Image Gallery */}\n                  <div className=\"md:w-1/2 bg-gray-50 p-6\">\n                      <ImageGallery \n                        images={product.images || []} \n                        productName={product.name}\n                      />\n                  </div>\n\n                  {/* Right: Product Info */}\n                  <div className=\"md:w-1/2 p-6 md:p-8 overflow-y-auto\">\n                      <div className=\"flex items-center gap-2 mb-3\">\n                          <span className=\"bg-primary-50 text-primary-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide\">{product.category}</span>\n                          {product.inStock ?? product.in_stock ? \n                              <span className=\"text-green-600 text-xs font-bold flex items-center bg-green-50 px-2 py-1 rounded-full\"><Check className=\"w-3 h-3 mr-1\" /> Raktron</span> : \n                              <span className=\"text-red-500 text-xs font-bold bg-red-50 px-2 py-1 rounded-full\">Kszlethiny</span>\n                          }\n                      </div>\n                      <h2 className=\"text-2xl md:text-3xl font-extrabold text-gray-900 mb-2 leading-tight\">{product.name}</h2>\n                      <p className=\"text-2xl md:text-3xl font-bold text-primary-500 mb-4\">{formatPrice(product.price)}</p>\n                      \n                      {/* Price Alert & Share */}\n                      <div className=\"flex items-center gap-3 mb-4\">\n                        <PriceAlert product={product} />\n                        <ProductShare product={product} />\n                      </div>\n                      \n                      {/* Stock Urgency */}\n                      <div className=\"mb-4\">\n                        <StockUrgency product={product} variant=\"compact\" />\n                      </div>\n                      \n                      {/* Delivery Estimator */}\n                      <div className=\"mb-6\">\n                        <DeliveryEstimator product={product} variant=\"compact\" />\n                      </div>\n                      \n                      <div className=\"mb-6\">\n                          {!aiTip && !loadingTip && (\n                              <button onClick={generateStyleTip} className=\"w-full bg-gradient-to-r from-secondary-50 to-primary-50 hover:from-secondary-100 hover:to-primary-100 text-primary-600 p-4 rounded-xl border border-primary-100 flex items-center justify-center transition-all group\">\n                                  <Sparkles className=\"w-5 h-5 mr-2 group-hover:scale-110 transition-transform\" />\n                                  Krj AI Lakberendez tippet!\n                              </button>\n                          )}\n                          {loadingTip && (\n                              <div className=\"bg-gray-50 p-4 rounded-xl border border-gray-100 flex items-center justify-center text-gray-500 animate-pulse\">\n                                  <RefreshCw className=\"w-5 h-5 mr-2 animate-spin\" /> A tervez gondolkodik...\n                              </div>\n                          )}\n                          {aiTip && (\n                              <div className=\"bg-gradient-to-br from-primary-50 to-white p-5 rounded-xl border border-primary-100 shadow-sm animate-fade-in\">\n                                  <div className=\"flex items-center mb-2 text-primary-600 font-bold\"><Lightbulb className=\"w-5 h-5 mr-2\" /> AI Tipp:</div>\n                                  <div className=\"text-sm text-gray-700 leading-relaxed whitespace-pre-line\">{aiTip}</div>\n                              </div>\n                          )}\n                      </div>\n\n                      <div className=\"prose prose-sm text-gray-600 mb-6 border-t border-gray-100 pt-4\">\n                          <h4 className=\"font-bold text-gray-900 mb-2\">Lers</h4>\n                          <p className=\"text-sm\">{product.description || \"Nincs lers.\"}</p>\n                          {product.params && (\n                              <div className=\"mt-4 grid grid-cols-2 gap-2 text-xs\">\n                                  {product.params.split(',').slice(0, 6).map((param, i) => (\n                                      <div key={i} className=\"bg-gray-50 p-2 rounded text-gray-700\">{param.trim()}</div>\n                                  ))}\n                              </div>\n                          )}\n                      </div>\n\n                      {/* Complete The Look - AI Bundle */}\n                      {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <CompleteTheLook\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddToCart={onAddToCart}\n                          />\n                        </div>\n                      )}\n\n                      {/* Smart Bundle - temporarily disabled for debugging */}\n                      {/* {allProducts.length > 0 && (\n                        <div className=\"mb-6\">\n                          <SmartBundle\n                            currentProduct={product}\n                            allProducts={allProducts}\n                            onAddBundle={(items, price) => {\n                              items.forEach(item => onAddToCart(item, 1));\n                            }}\n                          />\n                        </div>\n                      )} */}\n\n                      {/* Price History */}\n                      <div className=\"mb-6\">\n                        <PriceHistory\n                          currentPrice={product.price}\n                          productId={product.id}\n                          onSetAlert={(id, price) => console.log('Alert set for', id, price)}\n                        />\n                      </div>\n\n                      {/* Product Tabs - Details, Specs, Reviews */}\n                      <div className=\"mb-6\">\n                        <ProductTabs product={product} />\n                      </div>\n\n                      <div className=\"sticky bottom-0 bg-white pt-4 pb-4 border-t border-gray-200 mt-auto shadow-[0_-4px_12px_rgba(0,0,0,0.06)]\">\n                          <div className=\"flex flex-col xs:flex-row gap-3\">\n                              <button\n                                  type=\"button\"\n                                  onClick={() => onAddToCart(product, 1)}\n                                  disabled={!(product.inStock ?? product.in_stock)}\n                                  className=\"min-h-[44px] flex-1 bg-primary-500 hover:bg-primary-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 px-4 rounded-xl font-bold text-base text-center transition-all shadow-lg flex items-center justify-center gap-2\"\n                              >\n                                  <ShoppingCart className=\"w-5 h-5\" />\n                                  Kosrba\n                              </button>\n                              <a href={product.link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"min-h-[44px] flex-1 bg-gray-900 text-white py-3 px-4 rounded-xl font-bold text-base text-center hover:bg-gray-800 transition-all shadow-lg flex items-center justify-center gap-2 border-2 border-gray-900 hover:border-gray-700\">\n                                  Megveszem a webshopban <ArrowRight className=\"w-5 h-5\" />\n                              </a>\n                          </div>\n                      </div>\n                  </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst VisualSearch = ({ products }) => {\n  const [selectedImage, setSelectedImage] = useState(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [searchResults, setSearchResults] = useState([]);\n  const [analysisText, setAnalysisText] = useState(\"\");\n\n  const handleImageUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onloadend = () => { setSelectedImage(reader.result); analyzeImage(reader.result); };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const analyzeImage = async (base64Image) => {\n    setIsAnalyzing(true); setSearchResults([]); setAnalysisText(\"Elemzs...\");\n    try {\n      const base64Data = base64Image.split(',')[1];\n      const prompt = \"Elemezd a btort. JSON: { \\\"style\\\": \\\"...\\\", \\\"category\\\": \\\"...\\\", \\\"color\\\": \\\"...\\\" } Magyarul.\";\n      const { analyzeImage: analyzeImageAI } = await import('./services/geminiService');\n      const result = await analyzeImageAI(base64Data, \"image/jpeg\", prompt);\n      \n      if (result.success && result.text) {\n        const analysis = JSON.parse(result.text);\n        if (analysis) {\n          setAnalysisText(`Felismerve: ${analysis.style} stlus ${analysis.color} ${analysis.category}.`);\n          const relevant = products.filter(p => p.category.toLowerCase().includes(analysis.category.toLowerCase()) || p.name.toLowerCase().includes(analysis.category.toLowerCase())).slice(0, 4);\n          setSearchResults(relevant);\n        }\n      } else {\n        setAnalysisText(\"Hiba az elemzsben.\");\n      }\n    } catch (error) { setAnalysisText(\"Hiba az elemzsben.\"); } \n    finally { setIsAnalyzing(false); }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto py-8 px-4\">\n      <div className=\"text-center mb-8\"><h2 className=\"text-3xl font-bold text-gray-900\">AI Vizulis Keres</h2></div>\n      <div className=\"bg-white rounded-xl shadow-lg p-8 mb-8 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-center\">\n        {!selectedImage ? (\n          <>\n            <div className=\"bg-primary-50 p-4 rounded-full mb-4\"><Camera className=\"w-8 h-8 text-primary-500\" /></div>\n            <label className=\"cursor-pointer bg-primary-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-600 transition-colors\">Fnykp feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleImageUpload} /></label>\n          </>\n        ) : (\n          <div className=\"relative w-full max-w-md mx-auto\">\n            <img src={selectedImage} alt=\"Uploaded\" className=\"rounded-lg shadow-md max-h-64 mx-auto\" />\n            <button onClick={() => { setSelectedImage(null); setSearchResults([]); }} className=\"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full shadow-md hover:bg-red-600\"><X className=\"w-4 h-4\" /></button>\n            {isAnalyzing && <div className=\"absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center rounded-lg\"><span className=\"text-primary-700 font-bold animate-pulse\">Elemzs...</span></div>}\n          </div>\n        )}\n      </div>\n      {!isAnalyzing && selectedImage && searchResults.length === 0 && (\n        <p className=\"text-center text-gray-600 py-6\">Nincs tallat a feltlttt kp alapjn. Prblj msik fott vagy bngssz a kategrikban.</p>\n      )}\n      {searchResults.length > 0 && (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6\">{searchResults.map(product => (<div key={product.id} className=\"border border-gray-200 p-4 rounded-xl hover:shadow-lg transition-shadow\"><img src={product.images?.[0]} alt={product.name} className=\"h-32 mx-auto object-contain\" /><p className=\"font-bold mt-2 truncate\">{product.name}</p><p>{formatPrice(product.price)}</p></div>))}</div>\n      )}\n    </div>\n  );\n};\n\nconst RoomPlanner = ({ products }) => {\n  const [background, setBackground] = useState(null);\n  const [placedItems, setPlacedItems] = useState([]);\n  const [selectedItemId, setSelectedItemId] = useState(null);\n\n  const handleBackgroundUpload = (e) => {\n    const file = e.target.files[0];\n    if (file) { const reader = new FileReader(); reader.onloadend = () => setBackground(reader.result); reader.readAsDataURL(file); }\n  };\n\n  const addItem = (product) => {\n    if (!background) { alert(\"Tlts fel szobt!\"); return; }\n    setPlacedItems([...placedItems, { id: Date.now(), image: product.images[0], x: 50, y: 50, scale: 1 }]);\n  };\n\n  return (\n    <div className=\"max-w-7xl mx-auto py-8 px-4 flex flex-col lg:flex-row gap-6 h-[80vh]\">\n      <div className=\"lg:w-1/4 bg-white rounded-2xl shadow-lg border border-gray-200 flex flex-col overflow-hidden\">\n          <div className=\"p-4 border-b bg-gray-50\"><h3 className=\"font-bold\">Btorok</h3></div>\n          <div className=\"flex-1 overflow-y-auto p-2 space-y-2\">\n              {products.slice(0, 50).map(p => (\n                  <div key={p.id} onClick={() => addItem(p)} className=\"flex items-center gap-3 p-2 hover:bg-primary-50 rounded cursor-pointer\"><img src={p.images[0]} className=\"w-12 h-12 object-contain\" /><p className=\"text-xs font-bold truncate w-24\">{p.name}</p></div>\n              ))}\n          </div>\n      </div>\n      <div className=\"lg:w-3/4 bg-gray-100 rounded-2xl border-2 border-dashed relative overflow-hidden flex items-center justify-center\">\n          {!background ? (\n              <label className=\"bg-primary-500 text-white px-6 py-3 rounded-xl cursor-pointer\">Szobafot feltltse<input type=\"file\" className=\"hidden\" accept=\"image/*\" onChange={handleBackgroundUpload} /></label>\n          ) : (\n              <div className=\"relative w-full h-full\">\n                  <img src={background} className=\"w-full h-full object-cover\" />\n                  {placedItems.map((item) => (\n                      <div key={item.id} className=\"absolute w-32 cursor-move\" style={{ left: `${item.x}%`, top: `${item.y}%`, transform: `translate(-50%, -50%) scale(${item.scale})` }} onClick={() => setSelectedItemId(item.id)}>\n                          <img src={item.image} className=\"w-full\" />\n                      </div>\n                  ))}\n              </div>\n          )}\n      </div>\n    </div>\n  );\n};\n\nconst App = () => {\n  const [activeTab, setActiveTabState] = useState(() => {\n    const hash = (typeof window !== 'undefined' && window.location.hash.slice(1)) || '';\n    return HASH_TO_TAB[hash] || 'shop';\n  });\n  const setActiveTab = useCallback((tab) => {\n    setActiveTabState(tab);\n    const hash = TAB_HASH[tab] ?? tab;\n    if (typeof window !== 'undefined') {\n      const newHash = hash ? `#${hash}` : '';\n      if (window.location.hash !== newHash) {\n        window.history.replaceState(null, '', window.location.pathname + window.location.search + newHash);\n      }\n    }\n  }, []);\n  const [products, setProducts] = useState([]);\n  const [totalProductsCount, setTotalProductsCount] = useState(0);\n  const [hasMoreProducts, setHasMoreProducts] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const filteredLengthRef = useRef(0);\n  const hasMoreProductsRef = useRef(hasMoreProducts);\n  const isLoadingMoreRef = useRef(isLoadingMore);\n  hasMoreProductsRef.current = hasMoreProducts;\n  isLoadingMoreRef.current = isLoadingMore;\n  const [wishlist, setWishlist] = useLocalStorage('mkt_wishlist', []);\n  const [wishlistItems, setWishlistItems] = useState([]);\n  const [sectionRotateTick, setSectionRotateTick] = useState(0);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const searchQueryRef = useRef(searchQuery);\n  searchQueryRef.current = searchQuery;\n  const SERVER_SEARCH_ONLY = true;\n  const MAX_LOCAL_INDEX = SERVER_SEARCH_ONLY ? 0 : 50000;\n  const searchIndexRef = useRef([]);\n  const [searchIndexReady, setSearchIndexReady] = useState(false);\n  const [searchIndexVersion, setSearchIndexVersion] = useState(0);\n  const [searchResults, setSearchResults] = useState([]);\n  const [searchTotalMatches, setSearchTotalMatches] = useState(0);\n  const [categoryFilter, setCategoryFilter] = useState(\"sszes\");\n  const [sortOption, setSortOption] = useState(\"default\");\n  const [isDemoMode, setIsDemoMode] = useState(false);\n  const [selectedProduct, setSelectedProduct] = useState(null);\n  const [isChatOpen, setIsChatOpen] = useState(false);\n  const [showAIOnboarding, setShowAIOnboarding] = useState(false);\n  const [onboardingFeature, setOnboardingFeature] = useState('chat');\n  const [advancedFilters, setAdvancedFilters] = useState({});\n  const [categoryHierarchy, setCategoryHierarchy] = useState({ mainCategories: [] });\n  const [categoryStats, setCategoryStats] = useState(null);\n  const [selectedCollection, setSelectedCollection] = useState(null);\n  const mainCategorySet = useMemo(() => {\n    return new Set((categoryHierarchy?.mainCategories || []).map((c) => c.name));\n  }, [categoryHierarchy]);\n  const activeHierarchyCount = useMemo(() => {\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === categoryFilter);\n    return typeof main?.productCount === 'number' ? main.productCount : null;\n  }, [categoryHierarchy, categoryFilter]);\n  const getCategoryMainList = useCallback((category) => {\n    if (!category) return [];\n    const main = (categoryHierarchy?.mainCategories || []).find((m) => m.name === category);\n    if (!main) return [];\n    return Array.isArray(main.rawSegments) && main.rawSegments.length > 0 ? main.rawSegments : [category];\n  }, [categoryHierarchy]);\n  \n  // AI Feature states\n  const [showStyleQuiz, setShowStyleQuiz] = useState(false);\n  const [showRoomDesigner, setShowRoomDesigner] = useState(false);\n  const [aiRecommendedProducts, setAiRecommendedProducts] = useState([]);\n  const [aiRecommendationLabel, setAiRecommendationLabel] = useState('');\n  const [showDeferredAI, setShowDeferredAI] = useState(false);\n  \n  // Quick Peek & AR states\n  const [quickPeekProduct, setQuickPeekProduct] = useState(null);\n  const [showARPreview, setShowARPreview] = useState(false);\n  const [arProduct, setArProduct] = useState(null);\n  \n  // AR Measure & One-Click Checkout states\n  const [showARMeasure, setShowARMeasure] = useState(false);\n  const [arMeasureProduct, setArMeasureProduct] = useState(null);\n  const [showOneClickCheckout, setShowOneClickCheckout] = useState(false);\n  const [oneClickProduct, setOneClickProduct] = useState(null);\n  \n  // New UX states\n  const [showConfetti, setShowConfetti] = useState(false);\n  const [showFilterSheet, setShowFilterSheet] = useState(false);\n  const [showExitIntent, setShowExitIntent] = useState(true); // Exit intent enabled\n  \n  // Phase 2 UX states\n  const [showWishlistDrawer, setShowWishlistDrawer] = useState(false);\n  const [featuredPool, setFeaturedPool] = useState([]);\n  const featuredPoolKeyRef = useRef('');\n  \n  // Flash sale end time (set to 12 hours from now for demo)\n  const flashSaleEndTime = useMemo(() => {\n    const end = new Date();\n    end.setHours(end.getHours() + 12);\n    return end;\n  }, []);\n  \n  // UNAS API states\n  const [isLoadingUnas, setIsLoadingUnas] = useState(true);\n  const [unasError, setUnasError] = useState(null);\n  const [lastUpdated, setLastUpdated] = useState(null);\n  const [dataSource, setDataSource] = useState('demo');\n  \n  // New hooks\n  const toast = useToast();\n  const comparison = useComparison();\n  useScrollLock(showARMeasure || showOneClickCheckout);\n  \n  // Track product views - both for RecentlyViewed component and user preferences\n  const handleProductView = (product) => {\n    trackProductView(product); // RecentlyViewed component\n    trackProductViewPref(product); // User preferences service (for AI personalization)\n    setSelectedProduct(product);\n  };\n  \n  // Handle AI recommended products - scroll to products and show them\n  // Accepts either: (product, allRecommended) OR (recommendedProducts, label)\n  const handleShowAIProducts = useCallback((firstArg, secondArg) => {\n    let recommendedProducts = [];\n    let label = 'AI ajnlsok';\n    \n    // Check if first argument is a single product or an array\n    if (firstArg && !Array.isArray(firstArg) && firstArg.id) {\n      // Single product clicked - show it first, then add similar products\n      const clickedProduct = firstArg;\n      const allRecommended = secondArg || [];\n      \n      // Get similar products from the full products list\n      const similarProducts = products\n        .filter(p => {\n          if (p.id === clickedProduct.id) return false;\n          const clickedCat = (clickedProduct.category || '').toLowerCase();\n          const pCat = (p.category || '').toLowerCase();\n          // Same main category or similar price range\n          const sameCategory = clickedCat && pCat && pCat.includes(clickedCat.split(' > ')[0]);\n          const price = p.salePrice || p.price || 0;\n          const clickedPrice = clickedProduct.salePrice || clickedProduct.price || 0;\n          const similarPrice = clickedPrice > 0 && Math.abs(price - clickedPrice) / clickedPrice < 0.5;\n          return sameCategory || similarPrice;\n        })\n        .slice(0, 12);\n      \n      // Combine: clicked product + other recommendations + similar\n      recommendedProducts = [\n        clickedProduct,\n        ...allRecommended.filter(p => p.id !== clickedProduct.id),\n        ...similarProducts.filter(p => !allRecommended.some(r => r.id === p.id))\n      ].slice(0, 20);\n      \n      label = `\"${clickedProduct.name.slice(0, 30)}...\" s hasonl termkek`;\n    } else if (Array.isArray(firstArg)) {\n      // Array of products provided\n      recommendedProducts = firstArg;\n      label = typeof secondArg === 'string' ? secondArg : 'AI ajnlsok';\n    }\n    \n    if (recommendedProducts.length === 0) return;\n    \n    setAiRecommendedProducts(recommendedProducts);\n    setAiRecommendationLabel(label);\n    setCategoryFilter('sszes'); // Reset category\n    setSearchQuery(''); // Reset search\n    \n    setActiveTab('shop');\n    scheduleScrollToProductsRef.current?.();\n  }, [products]);\n  \n  // Clear AI recommendations\n  const clearAIRecommendations = useCallback(() => {\n    setAiRecommendedProducts([]);\n    setAiRecommendationLabel('');\n  }, []);\n\n  const toggleWishlist = (id) => {\n    const isAdding = !wishlist.includes(id);\n    setWishlist(prev => \n      isAdding \n        ? [...prev, id] \n        : prev.filter(item => item !== id)\n    );\n    \n    if (isAdding) {\n      toast.wishlist('Hozzadva a kvnsglisthoz!');\n    } else {\n      toast.info('Eltvoltva a kvnsglistrl');\n    }\n  };\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!showWishlistDrawer) return () => { cancelled = true; };\n    if (!wishlist || wishlist.length === 0) {\n      setWishlistItems([]);\n      return () => { cancelled = true; };\n    }\n    Promise.all(wishlist.map((id) => fetchUnasProductById(id)))\n      .then((items) => {\n        if (!cancelled) setWishlistItems(items.filter(Boolean));\n      });\n    return () => { cancelled = true; };\n  }, [wishlist, showWishlistDrawer]);\n  \n  const handleToggleComparison = (product) => {\n    const result = comparison.toggleComparison(product);\n    if (result.success) {\n      if (result.action === 'added') {\n        toast.success('Hozzadva az sszehasonltshoz!');\n      } else {\n        toast.info('Eltvoltva az sszehasonltsbl');\n      }\n    } else {\n      toast.error(result.message);\n    }\n  };\n  \n  // Handle add to cart with confetti celebration\n  const handleAddToCart = useCallback((product, quantity = 1) => {\n    try {\n      const qty = Math.max(1, Math.floor(Number(quantity) || 1));\n\n      // UNAS kosrhoz ads (ha elrhet  widget UNAS oldalon fut)\n      const addedToUnas = addToUnasCart(product, qty);\n\n      if (addedToUnas) {\n        setShowConfetti(true);\n        toast.success(`${product.name} hozzadva a kosrhoz!`);\n        return;\n      }\n\n      // Fallback: cart_add nem mkdik  termk oldalra navigls (ott egy kattints = kosrba)\n      const productUrl = (product.link || product.url || '').trim();\n      const fullUrl = !productUrl || productUrl === '#' ? '' : productUrl.startsWith('http') ? productUrl : `${WEBSHOP_DOMAIN}${productUrl.startsWith('/') ? '' : '/'}${productUrl}`;\n      if (fullUrl && fullUrl !== WEBSHOP_DOMAIN && fullUrl !== WEBSHOP_DOMAIN + '/') {\n        toast.info('A termk oldalra naviglunk  ott egy kattintssal hozzadhatod a kosrhoz.');\n        window.location.href = fullUrl;\n      } else {\n        toast.warning('A termk link nem elrhet. Prbld ksbb.');\n      }\n    } catch (err) {\n      console.warn('[handleAddToCart]', err);\n      toast.error(err?.message || 'A kosrhoz ads sikertelen. Prbld a termk oldaln.');\n    }\n  }, [toast]);\n  \n  // Server-side search state\n  const [serverSearchQuery, setServerSearchQuery] = useState('');\n  const [serverCategory, setServerCategory] = useState('');\n  const searchTimeoutRef = useRef(null);\n  const scheduleScrollToProductsRef = useRef(null);\n\n  // API-first: kis lap, gyors first paint; soha nem tltnk 200k-t\n  const loadUnasData = useCallback(async (options = {}) => {\n    const { silent = false, search = '', category = '', categoryMain, categories, styleKeywords, append = false, limit = INITIAL_PAGE, offset = 0 } = options;\n    \n    if (!silent && !append) {\n      setIsLoadingUnas(true);\n      setUnasError(null);\n    }\n    if (append) setIsLoadingMore(true);\n    \n    try {\n      const categoryMainList = Array.isArray(categoryMain)\n        ? categoryMain.filter(Boolean)\n        : (typeof categoryMain === 'string' && categoryMain.trim()\n          ? [categoryMain.trim()]\n          : getCategoryMainList(category));\n      const categoriesList = Array.isArray(categories) ? categories.filter(Boolean) : [];\n      const params = {\n        limit,\n        offset,\n        slim: false,\n        ...(search && search.trim() && { search: search.trim() }),\n        ...(categoriesList.length > 0 && { categories: categoriesList }),\n        ...(categoriesList.length === 0 && categoryMainList.length > 0 && { categoryMain: categoryMainList }),\n        ...(categoriesList.length === 0 && categoryMainList.length === 0 && category && category !== 'sszes' && { category }),\n        ...(Array.isArray(styleKeywords) && styleKeywords.length > 0 && { styleKeywords })\n      };\n      const data = await fetchUnasProducts(params);\n      const newProducts = (data.products || []).map(normalizeProduct);\n      const totalCount = data.total ?? 0;\n      \n      if (append) {\n        setProducts(prev => [...prev, ...newProducts]);\n        setHasMoreProducts(newProducts.length > 0 && (data.count + offset) < totalCount);\n      } else {\n        setProducts(newProducts);\n        setTotalProductsCount(totalCount);\n        setHasMoreProducts(newProducts.length > 0 && newProducts.length < totalCount);\n      }\n      if (!append && search && String(search).trim()) {\n        scheduleScrollToProductsRef.current?.();\n      }\n      if (!append) setTotalProductsCount(totalCount);\n      setLastUpdated(data.lastSync || data.lastUpdated);\n      setDataSource('unas');\n      setUnasError(null);\n    } catch (err) {\n      if (!append) setUnasError('Termkek betltse sikertelen');\n    } finally {\n      if (!silent && !append) setIsLoadingUnas(false);\n      if (append) setIsLoadingMore(false);\n    }\n  }, [getCategoryMainList]);\n\n  // Server-side search (marketplace-style). scrollFromEffect: true = grgets az effect-ben (pl. header keress), false = hv intzi (pl. hero)\n  const requestScrollToProductsRef = useRef(false);\n  const handleServerSearch = useCallback((query, opts = {}) => {\n    hasUserSearchedRef.current = true;\n    if (opts.scrollFromEffect !== false) requestScrollToProductsRef.current = true;\n    setSearchQuery(query);\n  }, []);\n  const hasUserSearchedRef = useRef(false);\n  // Mindig headernl landoljon: els betlts s reload esetn\n  useLayoutEffect(() => {\n    if (typeof window === 'undefined') return;\n    window.history.scrollRestoration = 'manual';\n    const scrollToHeader = () => {\n      window.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n      const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root');\n      if (appRoot) {\n        let p = appRoot.parentElement;\n        while (p && p !== document.body) {\n          const s = getComputedStyle(p);\n          if ((s.overflowY === 'auto' || s.overflowY === 'scroll' || s.overflowY === 'overlay') && p.scrollHeight > p.clientHeight) {\n            p.scrollTo({ top: 0, left: 0, behavior: 'auto' });\n            break;\n          }\n          p = p.parentElement;\n        }\n      }\n    };\n    scrollToHeader();\n    const t1 = setTimeout(scrollToHeader, 100);\n    const t2 = setTimeout(scrollToHeader, 300);\n    return () => { clearTimeout(t1); clearTimeout(t2); };\n  }, []);\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      setSectionRotateTick((t) => t + 1);\n    }, 180000);\n    return () => clearInterval(id);\n  }, []);\n\n\n  // Scroll container: ne hasznljunk olyan containert, ami a mi appunk belsejben van (#mkt-butorbolt-app).\n  // UNAS embed: gyakran a page_content article szlje a scroll container; standalone = window.\n  const getScrollParent = useCallback((element) => {\n    const appRoot = document.getElementById('mkt-butorbolt-app');\n    const isScrollable = (el) => {\n      if (!el || el === document.body) return false;\n      const style = getComputedStyle(el);\n      const oy = style.overflowY;\n      return (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && el.scrollHeight > el.clientHeight;\n    };\n    let parent = element.parentElement;\n    while (parent && parent !== document.body) {\n      if (isScrollable(parent)) {\n        const insideApp = appRoot && parent.closest('#mkt-butorbolt-app');\n        const wrapsApp = appRoot && parent.contains(appRoot);\n        if (wrapsApp || !insideApp) return parent;\n      }\n      parent = parent.parentElement;\n    }\n    return null;\n  }, []);\n\n  const lastScrollToProductsRef = useRef(0);\n  const scrollToProductsSection = useCallback((retryCount = 0) => {\n    const el = document.getElementById('products-section');\n    const main = document.getElementById('mkt-butorbolt-main');\n    const target = el || main;\n    if (!target) {\n      if (retryCount < SCROLL_RETRY_MAX) setTimeout(() => scrollToProductsSection(retryCount + 1), SCROLL_DELAY_INITIAL);\n      return;\n    }\n    const now = performance.now();\n    if (now - lastScrollToProductsRef.current < SCROLL_THROTTLE_MS) return;\n    const rect = target.getBoundingClientRect();\n    const inView = rect.top >= -50 && rect.top <= 180;\n    if (inView && retryCount === 0) return;\n    lastScrollToProductsRef.current = now;\n\n    const run = () => {\n      const scrollParent = getScrollParent(target);\n      const offset = 88;\n      if (scrollParent && scrollParent !== document.documentElement) {\n        const elRect = target.getBoundingClientRect();\n        const parentRect = scrollParent.getBoundingClientRect();\n        const targetScrollTop = scrollParent.scrollTop + (elRect.top - parentRect.top) - offset;\n        scrollParent.scrollTo({ top: Math.max(0, targetScrollTop), behavior: 'smooth' });\n      } else {\n        target.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });\n      }\n      if (typeof window !== 'undefined') delete window.__MKT_NAV_TO_PRODUCTS;\n    };\n    requestAnimationFrame(() => requestAnimationFrame(run));\n  }, [getScrollParent]);\n\n  const scrollToProductsSectionRef = useRef(scrollToProductsSection);\n  scrollToProductsSectionRef.current = scrollToProductsSection;\n\n  const scheduleScrollToProducts = useCallback(() => {\n    if (typeof window !== 'undefined') {\n      window.__MKT_NAV_TO_PRODUCTS = Date.now();\n    }\n    requestAnimationFrame(() => {\n      setTimeout(() => scrollToProductsSectionRef.current?.(), SCROLL_DELAY_INITIAL);\n      setTimeout(() => scrollToProductsSectionRef.current?.(1), SCROLL_DELAY_RETRY);\n      setTimeout(() => scrollToProductsSectionRef.current?.(2), SCROLL_DELAY_FINAL);\n    });\n  }, []);\n\n  scheduleScrollToProductsRef.current = scheduleScrollToProducts;\n\n  const handleCategoryChange = useCallback((category) => {\n    setSelectedCollection(null);\n    setCategoryFilter(category);\n    setCategoryStats(null);\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    setAdvancedFilters({});\n    setSortOption('default');\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    if (category && category !== 'sszes') setActiveTab('shop');\n    scheduleScrollToProducts();\n  }, [clearAIRecommendations, scheduleScrollToProducts]);\n\n  const handleCollectionSelect = useCallback((collection) => {\n    setSelectedCollection(collection);\n    setCategoryFilter('sszes');\n    setSearchQuery('');\n    hasUserSearchedRef.current = false;\n    clearAIRecommendations();\n    setProducts([]);\n    setTotalProductsCount(0);\n    setHasMoreProducts(true);\n    setIsLoadingUnas(true);\n    setUnasError(null);\n    setActiveTab('shop');\n    scheduleScrollToProducts();\n  }, [scheduleScrollToProducts]);\n\n  const handleCollectionBack = useCallback(() => {\n    setSelectedCollection(null);\n    handleCategoryChange('sszes');\n  }, [handleCategoryChange]);\n\n  const loadUnasDataRef = useRef(loadUnasData);\n  loadUnasDataRef.current = loadUnasData;\n\n  const canUseLocalSearch = useMemo(() => {\n    if (SERVER_SEARCH_ONLY) return false;\n    return searchIndexReady && searchIndexRef.current.length > 0 && searchIndexRef.current.length <= MAX_LOCAL_INDEX;\n  }, [SERVER_SEARCH_ONLY, searchIndexReady, searchIndexVersion]);\n\n  const debouncedSearch = useDebounce(searchQuery, 400);\n\n  // Kollekci termkbetlts  valdi termkek: categoryMain ( f kategria) vagy categories ( leaf kategrik )\n  useEffect(() => {\n    if (!selectedCollection) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n        categoryMainList = undefined;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n        categoriesList = undefined;\n      } else {\n        categoriesList = cats;\n      }\n    } else {\n      categoryMainList = undefined;\n      categoriesList = undefined;\n    }\n    const limit = selectedCollection.isSale || selectedCollection.isNew ? 300 : INITIAL_PAGE;\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined,\n      limit,\n      offset: 0\n    });\n    scheduleScrollToProductsRef.current?.();\n  }, [selectedCollection, categoryHierarchy]);\n\n  const deferProductsLoadRef = useRef(true);\n  useEffect(() => {\n    if (selectedCollection) return;\n    const useApiSearch = !canUseLocalSearch || !debouncedSearch.trim();\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    const isInitialState = categoryFilter === 'sszes' && !debouncedSearch.trim();\n    const shouldDefer = deferProductsLoadRef.current && isInitialState;\n\n    const run = () => {\n      loadUnasDataRef.current({\n        search: useApiSearch ? (debouncedSearch.trim() || undefined) : undefined,\n        category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n        categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined,\n        limit: INITIAL_PAGE,\n        offset: 0\n      });\n      if (requestScrollToProductsRef.current && debouncedSearch.trim()) {\n        requestScrollToProductsRef.current = false;\n        scheduleScrollToProductsRef.current?.();\n      }\n    };\n\n    if (shouldDefer) {\n      deferProductsLoadRef.current = false;\n      const t = setTimeout(run, 900);\n      return () => clearTimeout(t);\n    }\n    run();\n  }, [categoryFilter, debouncedSearch, canUseLocalSearch, getCategoryMainList, selectedCollection]);\n\n  useEffect(() => {\n    const onHashChange = () => {\n      const hash = window.location.hash.slice(1);\n      const tab = HASH_TO_TAB[hash] || 'shop';\n      setActiveTabState(tab);\n    };\n    window.addEventListener('hashchange', onHashChange);\n    return () => window.removeEventListener('hashchange', onHashChange);\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    fetchCategoryHierarchy().then((data) => {\n      if (!cancelled && data?.mainCategories) setCategoryHierarchy(data);\n    });\n    return () => { cancelled = true; };\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (!categoryFilter || categoryFilter === 'sszes') {\n      setCategoryStats(null);\n      return () => { cancelled = true; };\n    }\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    const category = categoryMainList.length === 0 ? categoryFilter : '';\n    fetchProductStats({ category, categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined }).then((stats) => {\n      if (!cancelled) setCategoryStats(stats);\n    });\n    return () => { cancelled = true; };\n  }, [categoryFilter, getCategoryMainList]);\n\n  // Defer heavy AI widgets to keep TTI under 3s\n  useEffect(() => {\n    const t = setTimeout(() => setShowDeferredAI(true), 1500);\n    return () => clearTimeout(t);\n  }, []);\n\n  // Keresindex httrben (800ms ksleltets, ne blokkolja az els paint-et); 5 percenknt frissts = kszlet napraksz\n  useEffect(() => {\n    if (SERVER_SEARCH_ONLY) return;\n    let cancelled = false;\n    const load = () => {\n      fetchSearchIndex().then(async (data) => {\n        if (!cancelled && data && Array.isArray(data.products)) {\n          searchIndexRef.current = data.products;\n          setSearchIndexReady(true);\n          setSearchIndexVersion((v) => v + 1);\n          if (data.lastSync) setLastUpdated(data.lastSync);\n          const q = searchQueryRef.current.trim();\n          if (q && data.products.length <= MAX_LOCAL_INDEX) {\n            const { smartSearch } = await import('./services/aiSearchService');\n            if (cancelled) return;\n            const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, q, { limit: 500 });\n            setSearchResults(results);\n            setSearchTotalMatches(totalMatches || results.length);\n          }\n        }\n      });\n    };\n    const t0 = setTimeout(load, 800);\n    const t1 = setInterval(load, 5 * 60 * 1000);\n    return () => { cancelled = true; clearTimeout(t0); clearInterval(t1); };\n  }, []);\n\n  // Keress a teljes indexen (ha mr betlttt); res keress = res tallat\n  useEffect(() => {\n    if (!searchQuery.trim()) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    if (!canUseLocalSearch) {\n      setSearchResults([]);\n      setSearchTotalMatches(0);\n      return;\n    }\n    let cancelled = false;\n    import('./services/aiSearchService').then(({ smartSearch }) => {\n      if (cancelled) return;\n      const { results = [], totalMatches = 0 } = smartSearch(searchIndexRef.current, searchQuery.trim(), { limit: 500 });\n      setSearchResults(results);\n      setSearchTotalMatches(totalMatches || results.length);\n    });\n    return () => { cancelled = true; };\n  }, [searchQuery, canUseLocalSearch]);\n\n  useEffect(() => {\n    const t = setInterval(() => loadUnasDataRef.current?.({ silent: true }), 300000);\n    return () => clearInterval(t);\n  }, []);\n\n  // Featured pool for homepage modules  1. batch azonnal, 23. batch 1s ksleltetve\n  useEffect(() => {\n    if (!totalProductsCount || totalProductsCount <= 0) return;\n    const key = `${totalProductsCount}-${lastUpdated || ''}`;\n    if (featuredPoolKeyRef.current === key) return;\n    featuredPoolKeyRef.current = key;\n    let cancelled = false;\n    let extraTimeoutId = null;\n    const limit = 150;\n    const mergeInto = (map, data) => {\n      (data?.products || []).forEach((p) => {\n        if (!p || !p.id) return;\n        map.set(p.id, normalizeProduct(p));\n      });\n    };\n    fetchUnasProducts({ limit, offset: 0, slim: false })\n      .then((first) => {\n        if (cancelled) return;\n        const merged = new Map();\n        mergeInto(merged, first);\n        setFeaturedPool(Array.from(merged.values()));\n        if (totalProductsCount <= limit * 2) return;\n        const extraOffsets = [\n          Math.max(0, Math.floor(totalProductsCount / 3) - Math.floor(limit / 2)),\n          Math.max(0, Math.floor((totalProductsCount * 2) / 3) - Math.floor(limit / 2))\n        ];\n        extraTimeoutId = setTimeout(() => {\n          if (cancelled) return;\n          Promise.all(extraOffsets.map((o) => fetchUnasProducts({ limit, offset: o, slim: false })))\n            .then((batches) => {\n              if (cancelled) return;\n              const map = new Map(Array.from(merged.entries()));\n              batches.forEach((b) => mergeInto(map, b));\n              setFeaturedPool(Array.from(map.values()));\n            })\n            .catch(() => {});\n        }, 1000);\n      })\n      .catch(() => {\n        if (!cancelled) setFeaturedPool([]);\n      });\n    return () => {\n      cancelled = true;\n      if (extraTimeoutId != null) clearTimeout(extraTimeoutId);\n    };\n  }, [totalProductsCount, lastUpdated]);\n\n  const normalizedAdvancedFilters = useMemo(() => ({\n    priceMin: advancedFilters.priceMin ?? 0,\n    priceMax: advancedFilters.priceMax ?? 1000000,\n    inStockOnly: advancedFilters.inStockOnly ?? false,\n    categories: Array.isArray(advancedFilters.categories) ? advancedFilters.categories : []\n  }), [advancedFilters]);\n\n  const mobileActiveFilterCount = useMemo(() => [\n    normalizedAdvancedFilters.inStockOnly,\n    normalizedAdvancedFilters.categories.length > 0,\n    normalizedAdvancedFilters.priceMin > 0,\n    normalizedAdvancedFilters.priceMax < 1000000\n  ].filter(Boolean).length, [normalizedAdvancedFilters]);\n  \n  // Szerver mr szr (kategria, keress); itt csak rendezs + advanced filter a kis listn\n  const filteredAndSortedProducts = useMemo(() => {\n    let result = [...products];\n    if (Object.keys(advancedFilters).length > 0) {\n      result = applyFilters(result, normalizedAdvancedFilters);\n    }\n    if (sortOption === 'price-asc') result = result.sort((a, b) => (a.price || 0) - (b.price || 0));\n    if (sortOption === 'price-desc') result = result.sort((a, b) => (b.price || 0) - (a.price || 0));\n    return result;\n  }, [products, sortOption, advancedFilters, normalizedAdvancedFilters]);\n\n  // Kollekci-specifikus szrs: isSale -> salePrice, styleKeywords -> name/description/params\n  const collectionFilteredProducts = useMemo(() => {\n    if (!selectedCollection) return filteredAndSortedProducts;\n    let list = [...filteredAndSortedProducts];\n    if (selectedCollection.isSale) {\n      list = list.filter((p) => p.salePrice != null && p.price > 0 && p.salePrice < p.price);\n    }\n    const keywords = selectedCollection.styleKeywords || [];\n    if (keywords.length > 0) {\n      const lower = keywords.map((k) => String(k).toLowerCase());\n      list = list.filter((p) => {\n        const text = `${p.name || ''} ${p.description || ''} ${p.params || ''}`.toLowerCase();\n        return lower.some((kw) => text.includes(kw));\n      });\n    }\n    return list;\n  }, [selectedCollection, filteredAndSortedProducts]);\n\n  filteredLengthRef.current = filteredAndSortedProducts.length;\n\n  const isSearchMode = searchQuery.trim().length >= 2 && canUseLocalSearch;\n  const isSearchActive = searchQuery.trim().length > 0;\n  const sectionProducts = isSearchActive ? [] : filteredAndSortedProducts;\n  const sectionContextLabel = categoryFilter && categoryFilter !== 'sszes'\n    ? categoryFilter\n    : (mobileActiveFilterCount > 0 ? 'Szrt ajnlsok' : '');\n  const useContextSections = isSearchActive || (categoryFilter && categoryFilter !== 'sszes') || mobileActiveFilterCount > 0;\n  const featuredBase = useContextSections ? sectionProducts : (featuredPool.length > 0 ? featuredPool : sectionProducts);\n  const displayedProducts = aiRecommendedProducts.length > 0\n    ? aiRecommendedProducts\n    : isSearchMode\n      ? searchResults\n      : filteredAndSortedProducts;\n  const hasMoreToShow = aiRecommendedProducts.length === 0 && !isSearchMode && products.length < totalProductsCount;\n  const headerCount = isSearchMode\n    ? (searchTotalMatches || searchResults.length)\n    : (totalProductsCount || filteredAndSortedProducts.length);\n\n  const handleLoadMore = useCallback(() => {\n    if (isLoadingMore || !hasMoreProducts) return;\n    const categoryMainList = getCategoryMainList(categoryFilter);\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: searchQuery.trim() || undefined,\n      category: categoryMainList.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n      categoryMain: categoryMainList.length > 0 ? categoryMainList : undefined\n    });\n  }, [isLoadingMore, hasMoreProducts, products.length, searchQuery, categoryFilter, getCategoryMainList]);\n\n  const handleCollectionLoadMore = useCallback(() => {\n    if (!selectedCollection || isLoadingMore || !hasMoreProducts) return;\n    const cats = selectedCollection.categories || [];\n    const mains = categoryHierarchy?.mainCategories || [];\n    const mainNames = new Set(mains.map((m) => m.name));\n    let categoryMainList;\n    let categoriesList;\n    if (cats.length > 0) {\n      const leafNames = [];\n      const mainSegments = [];\n      for (const c of cats) {\n        if (mainNames.has(c)) {\n          const main = mains.find((m) => m.name === c);\n          if (Array.isArray(main?.rawSegments) && main.rawSegments.length > 0) {\n            mainSegments.push(...main.rawSegments);\n          }\n        } else {\n          leafNames.push(c);\n        }\n      }\n      if (leafNames.length > 0) {\n        categoriesList = leafNames;\n      } else if (mainSegments.length > 0) {\n        categoryMainList = [...new Set(mainSegments)];\n      } else {\n        categoriesList = cats;\n      }\n    }\n    const styleKw = selectedCollection.styleKeywords || [];\n    loadUnasDataRef.current({\n      append: true,\n      limit: DISPLAY_BATCH,\n      offset: products.length,\n      search: undefined,\n      category: '',\n      categoryMain: categoryMainList,\n      categories: categoriesList,\n      styleKeywords: styleKw.length > 0 ? styleKw : undefined\n    });\n  }, [selectedCollection, isLoadingMore, hasMoreProducts, products.length, categoryHierarchy]);\n\n  // Categories with TOTAL counts (from hierarchy if available, fallback to loaded products)\n  const categories = useMemo(() => {\n    const total = totalProductsCount || products.length;\n    if (categoryHierarchy?.mainCategories?.length) {\n      const main = categoryHierarchy.mainCategories.map((m) => ({\n        id: m.name,\n        name: m.name,\n        totalCount: Number(m.productCount || 0)\n      }));\n      return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...main];\n    }\n    if (!products || products.length === 0) return [{ id: 'sszes', name: 'sszes', totalCount: total }];\n    const categoryCount = new Map();\n    for (const p of products) {\n      if (p.category) {\n        categoryCount.set(p.category, (categoryCount.get(p.category) || 0) + 1);\n      }\n    }\n    const sorted = Array.from(categoryCount.entries())\n      .sort((a, b) => b[1] - a[1])\n      .map(([name, count]) => ({ id: name, name, totalCount: count }));\n    return [{ id: 'sszes', name: 'sszes', totalCount: total }, ...sorted];\n  }, [categoryHierarchy?.mainCategories, products, totalProductsCount]);\n\n  const recentPurchasesForSocialProof = useMemo(() => products.slice(0, 10), [products]);\n\n  return (\n    <ToastProvider>\n    <div id=\"mkt-butorbolt-app\" className=\"min-h-screen bg-white font-sans text-gray-900 rounded-3xl sm:rounded-[2rem] lg:rounded-[2.5rem] overflow-hidden shadow-2xl shadow-gray-300/50 mx-auto w-full max-w-[2000px]\">\n      {/* Scroll Progress Bar */}\n      <ScrollProgress />\n      \n      <Navbar \n        activeTab={activeTab} \n        setActiveTab={setActiveTab} \n        wishlistCount={wishlist.length}\n        productCount={totalProductsCount || products.length}\n        categories={categories}\n        categoryHierarchy={categoryHierarchy.mainCategories}\n        activeCategory={categoryFilter}\n        onOpenWishlist={() => setShowWishlistDrawer(true)}\n        onCategorySelect={handleCategoryChange}\n        onScrollToShop={scheduleScrollToProducts}\n        fixUrl={fixUrl}\n        onRecentProductClick={handleProductView}\n      />\n      \n      {/* AI Onboarding */}\n      <AIOnboarding \n        isOpen={showAIOnboarding} \n        onClose={() => setShowAIOnboarding(false)}\n        targetFeature={onboardingFeature}\n      />\n      \n      {/* Live Social Proof */}\n      <LiveSocialProof \n        currentProduct={selectedProduct} \n        recentPurchases={recentPurchasesForSocialProof}\n      />\n      \n      {/* Back to Top Button */}\n      <BackToTop />\n      \n      {/* AI Chat Assistant (deferred for faster first paint) */}\n      {showDeferredAI && (\n        <Suspense fallback={null}>\n            <AIChatAssistant\n              products={products}\n              catalogProducts={searchIndexReady ? searchIndexRef.current : products}\n              onShowProducts={handleShowAIProducts}\n              serverSearchMode={SERVER_SEARCH_ONLY}\n              totalProductsCount={totalProductsCount}\n              categoryHierarchy={categoryHierarchy}\n            />\n        </Suspense>\n      )}\n\n      <main id=\"mkt-butorbolt-main\">\n        {activeTab === 'shop' && (\n          <>\n            {/* Flash Sale Banner  nem teljes szlessg, lekerektett, vltakoz ajnlatok */}\n            <div className=\"px-[2px] sm:px-2 lg:px-4\">\n              <FlashSaleBanner\n                endTime={flashSaleEndTime}\n                title=\" Flash Sale!\"\n                subtitle=\"Csak ma! Akr 50% kedvezmny kivlasztott btorokra\"\n                onViewSale={scheduleScrollToProducts}\n                variant=\"banner\"\n              />\n            </div>\n\n            <ModernHero \n              onExplore={scheduleScrollToProducts}\n              onTryAI={() => setActiveTab('visual-search')}\n              products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n              onHeroQuickView={(product) => handleProductView(product)}\n              onHeroSearch={(query, meta = {}) => {\n                if (!query?.trim()) return;\n                if (meta?.source !== 'instant') {\n                  setActiveTab('shop');\n                }\n                handleServerSearch(query, { scrollFromEffect: false });\n                if (meta?.source !== 'instant') {\n                  scheduleScrollToProductsRef.current?.();\n                }\n              }}\n              quickCategories={categoryHierarchy?.mainCategories || []}\n              onQuickCategory={(name) => {\n                setActiveTab('shop');\n                handleCategoryChange(name);\n              }}\n            />\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <Suspense fallback={null}>\n                <AIModuleUnified\n                  onFeatureClick={(feature) => {\n                  if (feature.id === 'visual-search') setActiveTab('visual-search');\n                  else if (feature.id === 'chat') {\n                    document.getElementById('mkt-butorbolt-chat')?.scrollIntoView({ behavior: 'smooth' });\n                  }\n                  else if (feature.id === 'room-planner') setActiveTab('room-planner');\n                  else if (feature.id === 'style-quiz') setShowStyleQuiz(true);\n                  else if (feature.id === 'room-designer') setShowRoomDesigner(true);\n                }}\n                />\n              </Suspense>\n            </FadeInOnScroll>\n\n            <DeferredSection rootMargin=\"200px\" className=\"section-perf section-gap-lg\">\n              <FadeInOnScroll direction=\"up\" className=\"section-perf section-gap-lg\">\n                <Suspense fallback={null}>\n                  <InspirationSection\n                    onExplore={scheduleScrollToProducts}\n                    onCategorySelect={(name) => {\n                      setActiveTab('shop');\n                      handleCategoryChange(name);\n                    }}\n                    onCollectionSelect={(col) => handleCollectionSelect(col)}\n                  />\n                </Suspense>\n              </FadeInOnScroll>\n            </DeferredSection>\n            \n            {featuredBase.length > 0 && (\n              <DeferredSection rootMargin=\"200px\" className=\"section-perf\">\n                <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n                  <Suspense fallback={null}>\n                    <div className=\"w-[100vw] relative left-1/2 -translate-x-1/2 sm:w-full sm:relative sm:left-auto sm:translate-x-0\">\n                      <ProductWorldsSection\n                      products={featuredBase}\n                      onProductClick={handleProductView}\n                      onToggleWishlist={toggleWishlist}\n                      wishlist={wishlist}\n                      onViewAll={scheduleScrollToProducts}\n                      onAddToCart={handleAddToCart}\n                      contextLabel={sectionContextLabel}\n                      rotationTick={sectionRotateTick}\n                      />\n                    </div>\n                  </Suspense>\n                </FadeInOnScroll>\n              </DeferredSection>\n            )}\n            \n            {/* Personalized Section - For You + Recently Viewed + Trending */}\n            {featuredBase.length > 0 && (\n              <DeferredSection rootMargin=\"200px\">\n                <Suspense fallback={null}>\n                  <PersonalizedSection\n                    products={featuredBase}\n                    onProductClick={handleProductView}\n                    onToggleWishlist={toggleWishlist}\n                    wishlist={wishlist}\n                    onAddToCart={handleAddToCart}\n                    contextLabel={sectionContextLabel}\n                  />\n                </Suspense>\n              </DeferredSection>\n            )}\n\n            <DeferredSection rootMargin=\"200px\">\n              <div className=\"w-full max-w-[500px] mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8\">\n                <Suspense fallback={null}>\n                  <LoyaltyProgram\n                    currentPoints={2450}\n                    totalSpent={485000}\n                    tier=\"silver\"\n                    onViewRewards={() => {}}\n                    onRedeemPoints={(reward) => console.log('Redeem:', reward)}\n                  />\n                </Suspense>\n              </div>\n            </DeferredSection>\n\n            <DeferredSection rootMargin=\"200px\">\n              <Suspense fallback={null}>\n                <NewsletterStrip />\n              </Suspense>\n            </DeferredSection>\n\n            <FadeInOnScroll direction=\"up\" className=\"section-perf\">\n              <Features />\n            </FadeInOnScroll>\n            \n            {/* Collection Page  kollekci landing */}\n            {selectedCollection ? (\n              <CollectionPage\n                collection={selectedCollection}\n                products={collectionFilteredProducts}\n                onBack={handleCollectionBack}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                onNavigateToCategory={handleCategoryChange}\n                allCategories={categories}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                onLoadMore={handleCollectionLoadMore}\n                isLoading={isLoadingUnas}\n                onScrollToSection={scrollToProductsSection}\n              />\n            ) : categoryFilter && categoryFilter !== \"sszes\" && !isLoadingUnas ? (\n              <CategoryPage\n                category={categoryFilter}\n                products={filteredAndSortedProducts}\n                allCategories={categories}\n                onBack={() => handleCategoryChange(\"sszes\")}\n                onProductClick={handleProductView}\n                onWishlistToggle={toggleWishlist}\n                onCategoryChange={handleCategoryChange}\n                wishlist={wishlist}\n                onAddToCart={handleAddToCart}\n                onAskAI={() => setShowStyleQuiz(true)}\n                totalCount={totalProductsCount}\n                loadedCount={products.length}\n                stats={categoryStats}\n                onLoadMore={handleLoadMore}\n                onScrollToSection={scrollToProductsSection}\n              />\n            ) : (\n            <section id=\"products-section\" className=\"container-app section-padding section-perf\">\n                {/* Sticky products header - solid, breadcrumb when category selected */}\n                <div className=\"sticky top-16 sm:top-20 z-40 mx-0 sm:-mx-4 lg:-mx-8 xl:-mx-10 px-3 sm:px-4 lg:px-8 xl:px-10 py-3 sm:py-4 lg:py-5 xl:py-6 mb-3 sm:mb-4 lg:mb-8 bg-white border-b border-gray-200 shadow-sm search-shell rounded-2xl\">\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 mb-2 sm:mb-3\">\n                    <nav className=\"flex items-center gap-2 text-sm text-gray-500\" aria-label=\"Breadcrumb\">\n                      <button type=\"button\" onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"Foldal teteje\">Foldal</button>\n                      <span aria-hidden=\"true\">/</span>\n                      <button type=\"button\" onClick={() => handleCategoryChange('sszes')} className=\"hover:text-primary-600 font-medium transition-colors\" aria-label=\"sszes kategria\">Termkek</button>\n                      {categoryFilter && categoryFilter !== 'sszes' && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"font-semibold text-gray-700\">{categoryFilter}</span>\n                        </>\n                      )}\n                      {searchQuery && (\n                        <>\n                          <span aria-hidden=\"true\">/</span>\n                          <span className=\"text-gray-600\">Keress: &quot;{searchQuery}&quot;</span>\n                        </>\n                      )}\n                      <span className=\"text-gray-400\">({headerCount.toLocaleString('hu-HU')} termk)</span>\n                    </nav>\n                    <LiveActivityStrip className=\"hidden sm:flex shrink-0\" />\n                  </div>\n                  <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 lg:gap-6\">\n                    {/* Title & Count */}\n                    <div className=\"flex items-baseline gap-2 sm:gap-3 lg:gap-4 flex-wrap\">\n                      <h2 className=\"text-xl sm:text-2xl lg:text-3xl xl:text-4xl 2xl:text-5xl font-bold text-gray-900\">\n                        {searchQuery ? 'Keress' : 'Termkek'}\n                      </h2>\n                      {!isLoadingUnas && (\n                        <span className=\"text-sm sm:text-base lg:text-lg xl:text-xl 2xl:text-2xl text-gray-500\">\n                          <span className=\"font-semibold text-primary-500\">\n                            {(headerCount || 0).toLocaleString('hu-HU')}\n                          </span> db\n                        </span>\n                      )}\n                      {searchQuery && (\n                        <div className=\"flex items-center gap-2 ml-2\">\n                          <span className=\"px-3 py-1 bg-primary-100 text-primary-700 rounded-full text-sm font-medium\">\n                            \"{searchQuery}\"\n                          </span>\n                          <button \n                            onClick={() => setSearchQuery('')}\n                            className=\"p-1 hover:bg-gray-100 rounded-full transition-colors\"\n                            title=\"Keress trlse\"\n                          >\n                            <X className=\"w-4 h-4 text-gray-500\" />\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Search & Filters */}\n                    <div className=\"w-full sm:w-auto\">\n                      <div className=\"w-full flex items-center gap-2 sm:gap-3 lg:gap-4 rounded-2xl border-2 border-primary-100 bg-gradient-to-r from-primary-50 via-white to-secondary-50 shadow-md p-2 sm:p-3\">\n                        <div className=\"flex-1 sm:flex-initial sm:w-64 lg:w-80 xl:w-[420px] 2xl:w-[520px]\">\n                          <SmartSearchBar \n                            products={SERVER_SEARCH_ONLY ? products : (searchIndexReady ? searchIndexRef.current : products)}\n                            indexVersion={searchIndexVersion}\n                            shouldBuildIndex={!SERVER_SEARCH_ONLY && searchIndexReady}\n                            maxLocalIndex={MAX_LOCAL_INDEX}\n                            serverSearchMode={SERVER_SEARCH_ONLY}\n                            categories={categories}\n                            onSearch={handleServerSearch}\n                            onProductClick={handleProductView}\n                            placeholder=\"Keress btorok kztt...\"\n                          />\n                        </div>\n                        {/* Desktop filters */}\n                        <div className=\"hidden sm:block\">\n                          <AdvancedFilters\n                            products={products}\n                            onFilterChange={setAdvancedFilters}\n                            initialFilters={advancedFilters}\n                          />\n                        </div>\n                        {/* Mobile filter button  same state as desktop AdvancedFilters */}\n                        <button\n                          onClick={() => setShowFilterSheet(true)}\n                          className=\"sm:hidden relative p-3 min-h-[48px] min-w-[48px] border-2 border-gray-200 rounded-xl bg-white hover:bg-gray-50 transition-colors flex items-center justify-center\"\n                          aria-label=\"Szrk\"\n                        >\n                          <Filter className=\"w-5 h-5 text-gray-700\" />\n                          {mobileActiveFilterCount > 0 && (\n                            <span className=\"absolute -top-1 -right-1 bg-primary-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 px-1.5 flex items-center justify-center\">\n                              {mobileActiveFilterCount}\n                            </span>\n                          )}\n                        </button>\n                        <select \n                          onChange={(e) => setSortOption(e.target.value)} \n                          className=\"hidden sm:block px-4 lg:px-5 xl:px-6 py-3 lg:py-3.5 xl:py-4 min-h-[48px] lg:min-h-[52px] xl:min-h-[56px] text-sm sm:text-base lg:text-lg xl:text-xl border-2 border-gray-200 rounded-xl lg:rounded-2xl bg-white focus:border-primary-500 focus:ring-2 focus:ring-primary-100 outline-none transition-all cursor-pointer font-medium\"\n                          aria-label=\"Rendezs\"\n                        >\n                          <option value=\"default\">Rendezs</option>\n                          <option value=\"price-asc\">r: alacsony  magas</option>\n                          <option value=\"price-desc\">r: magas  alacsony</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n                  {/* Active filter chips + sort chips  wrap mobil/tablet, 44px touch */}\n                  <div className=\"flex flex-wrap items-center gap-x-2 gap-y-3 mt-3 pt-3 border-t border-gray-100\">\n                    {mobileActiveFilterCount > 0 && (\n                      <div className=\"flex flex-wrap items-center gap-2 min-w-0\">\n                        {normalizedAdvancedFilters.inStockOnly && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Raktron\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, inStockOnly: false }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMin > 0 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Min. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMin)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMin: 0 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {normalizedAdvancedFilters.priceMax < 1000000 && (\n                          <span className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            Max. {new Intl.NumberFormat('hu-HU', { maximumFractionDigits: 0 }).format(normalizedAdvancedFilters.priceMax)} Ft\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, priceMax: 1000000 }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label=\"Eltvolts\">\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        )}\n                        {(normalizedAdvancedFilters.categories || []).map(cat => (\n                          <span key={cat} className=\"inline-flex items-center gap-1.5 px-3 py-2 bg-primary-50 text-primary-700 rounded-full text-sm font-medium min-h-[44px] sm:min-h-0 sm:py-1.5\">\n                            {cat}\n                            <button type=\"button\" onClick={() => setAdvancedFilters(prev => ({ ...prev, categories: (prev.categories || []).filter(c => c !== cat) }))} className=\"p-1.5 sm:p-0.5 hover:bg-primary-100 rounded-full min-w-[44px] min-h-[44px] sm:min-w-0 sm:min-h-0 flex items-center justify-center\" aria-label={`${cat} eltvoltsa`}>\n                              <X className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </span>\n                        ))}\n                        <button type=\"button\" onClick={() => setAdvancedFilters({})} className=\"text-sm font-medium text-gray-500 hover:text-primary-600 transition-colors min-h-[44px] px-2 flex items-center sm:min-h-0\">\n                          sszes trlse\n                        </button>\n                      </div>\n                    )}\n                    <div className=\"flex items-center gap-1.5 w-full sm:w-auto sm:ml-auto flex-shrink-0\">\n                      <span className=\"text-xs sm:text-sm text-gray-500 mr-1 hidden sm:inline\">Rendezs:</span>\n                      {['default', 'price-asc', 'price-desc'].map((value) => (\n                        <button\n                          key={value}\n                          type=\"button\"\n                          onClick={() => setSortOption(value)}\n                          className={`min-h-[44px] sm:min-h-0 px-3 py-2 sm:py-1.5 rounded-full text-sm font-medium transition-colors flex items-center justify-center ${\n                            sortOption === value\n                              ? 'bg-primary-500 text-white'\n                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                          }`}\n                        >\n                          {value === 'default' ? 'Alap' : value === 'price-asc' ? 'r ' : 'r '}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Main categories (from hierarchy) + quick filter swipe */}\n                {categoryHierarchy?.mainCategories?.length > 0 && (\n                  <MainCategoriesSection\n                    mainCategories={categoryHierarchy.mainCategories}\n                    activeCategory={categoryFilter}\n                    onCategorySelect={handleCategoryChange}\n                    totalProductCount={totalProductsCount || products.length}\n                  />\n                )}\n                <CategorySwipe\n                  categories={(() => {\n                    if (categoryHierarchy?.mainCategories?.length > 0) {\n                      return [\n                        { id: 'sszes', name: 'sszes', totalCount: totalProductsCount || products.length },\n                        ...categoryHierarchy.mainCategories.map((m) => ({\n                          id: m.name,\n                          name: m.name,\n                          totalCount: m.productCount ?? 0,\n                          icon: null,\n                        })),\n                      ];\n                    }\n                    return categories.map((cat) => ({\n                      id: cat.name,\n                      name: cat.name,\n                      totalCount: cat.count,\n                      icon: null,\n                    }));\n                  })()}\n                  activeCategory={categoryFilter}\n                  onCategoryChange={handleCategoryChange}\n                  displayedCount={products.length}\n                  activeTotalOverride={categoryFilter === 'sszes'\n                    ? (totalProductsCount || products.length)\n                    : (categoryStats?.total ?? activeHierarchyCount ?? 0)}\n                />\n\n                {/* Loading State */}\n                {isLoadingUnas && (\n                  <div className=\"space-y-6\">\n                    <div className=\"flex items-center justify-center gap-3\">\n                      <div className=\"w-6 h-6 border-3 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                      <p className=\"text-sm text-gray-500 font-medium\">Termkek betltse...</p>\n                    </div>\n                    <div className=\"product-grid\">\n                      {[...Array(6)].map((_, i) => (\n                        <ProductCardSkeleton key={`skeleton-${i}`} />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* API Error State */}\n                {!isLoadingUnas && unasError && (\n                  <div className=\"flex flex-col items-center justify-center py-16 px-4 text-center\">\n                    <AlertCircle className=\"w-16 h-16 text-red-500 mb-4\" />\n                    <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Nem sikerlt betlteni a termkeket</h3>\n                    <p className=\"text-gray-600 mb-6 max-w-md\">Prbld ksbb, vagy ellenrizd a kapcsolatot.</p>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        const catMain = getCategoryMainList(categoryFilter);\n                        loadUnasDataRef.current({\n                          search: searchIndexReady ? undefined : (searchQuery.trim() || undefined),\n                          category: catMain.length === 0 && categoryFilter !== 'sszes' ? categoryFilter : '',\n                          categoryMain: catMain.length > 0 ? catMain : undefined,\n                          limit: INITIAL_PAGE,\n                          offset: 0\n                        });\n                      }}\n                      className=\"px-6 py-3 min-h-[44px] bg-primary-500 text-white rounded-xl font-bold hover:bg-primary-600 transition-colors\"\n                    >\n                      jraprbls\n                    </button>\n                  </div>\n                )}\n\n                {/* Empty State (no error, just no products) */}\n                {!isLoadingUnas && !unasError && displayedProducts.length === 0 && (\n                  searchQuery ? (\n                    <NoSearchResults \n                      query={searchQuery}\n                      onClear={() => setSearchQuery('')}\n                    />\n                  ) : (\n                    <NoFilterResults \n                      onClearFilters={() => {\n                        handleCategoryChange(\"sszes\");\n                        setAdvancedFilters({});\n                      }}\n                    />\n                  )\n                )}\n\n                {/* AI Recommendations Banner */}\n                {aiRecommendedProducts.length > 0 && (\n                  <div className=\"mb-6 p-4 sm:p-5 bg-gradient-to-r from-primary-500 via-secondary-600 to-secondary-500 rounded-2xl shadow-lg\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-white/20 flex items-center justify-center\">\n                          <Sparkles className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\" />\n                        </div>\n                        <div>\n                          <h3 className=\"text-white font-bold text-base sm:text-lg\">{aiRecommendationLabel}</h3>\n                          <p className=\"text-white/80 text-sm\">{aiRecommendedProducts.length} szemlyre szabott ajnls</p>\n                        </div>\n                      </div>\n                      <button\n                        onClick={clearAIRecommendations}\n                        className=\"px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2\"\n                      >\n                        <X className=\"w-4 h-4\" />\n                        <span className=\"hidden sm:inline\">sszes termk</span>\n                      </button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Products Grid - Responsive with Scroll Animations */}\n                {!isLoadingUnas && displayedProducts.length > 0 && (\n                  <div className=\"product-grid\">\n                    {displayedProducts.map((product, index) => (\n                      <EnhancedProductCard \n                        key={product.id}\n                        product={product} \n                        onToggleWishlist={toggleWishlist} \n                        isWishlisted={wishlist.includes(product.id)} \n                        onQuickView={handleProductView}\n                        onAddToCart={handleAddToCart}\n                        index={index}\n                      />\n                    ))}\n                  </div>\n                )}\n                \n                {/* Load More Button */}\n                {!isLoadingUnas && !unasError && displayedProducts.length > 0 && (\n                  <div className=\"py-8 sm:py-10 lg:py-14 flex flex-col items-center gap-4\">\n                    {hasMoreToShow ? (\n                      <button\n                        onClick={handleLoadMore}\n                        disabled={isLoadingMore}\n                        className=\"px-6 sm:px-8 lg:px-10 py-3.5 sm:py-4 lg:py-5 min-h-[48px] lg:min-h-[56px] bg-gradient-to-r from-primary-500 to-secondary-700 text-white font-semibold rounded-xl lg:rounded-2xl\n                                   hover:from-primary-600 hover:to-secondary-700 transition-all duration-200\n                                   shadow-lg hover:shadow-xl active:scale-[0.98]\n                                   flex items-center gap-3 sm:gap-4 text-base sm:text-lg lg:text-xl disabled:opacity-70 disabled:cursor-not-allowed\"\n                      >\n                        {isLoadingMore && (\n                          <span className=\"w-4 h-4 sm:w-5 sm:h-5 border-2 border-white/70 border-t-transparent rounded-full animate-spin\" aria-hidden />\n                        )}\n                        <span>{isLoadingMore ? 'Betlts...' : 'Tbb termk'}</span>\n                        <span className=\"px-3 sm:px-3.5 py-1 sm:py-1.5 bg-white/20 rounded-lg text-sm sm:text-base\">\n                          {displayedProducts.length.toLocaleString('hu-HU')} / {totalProductsCount.toLocaleString('hu-HU')}\n                        </span>\n                      </button>\n                    ) : (\n                      <div className=\"flex items-center gap-2.5 text-sm sm:text-base lg:text-lg text-gray-400\">\n                        <svg className=\"w-5 h-5 sm:w-6 sm:h-6 text-green-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                        </svg>\n                        <span>Minden termk ({displayedProducts.length.toLocaleString('hu-HU')} db)</span>\n                      </div>\n                    )}\n                  </div>\n                )}\n            </section>\n            )}\n            \n            {/* Recently Viewed Products */}\n            <RecentlyViewed\n              onToggleWishlist={toggleWishlist}\n              wishlist={wishlist}\n              onQuickView={handleProductView}\n              onAddToCart={handleAddToCart}\n            />\n            \n            {/* Final CTA */}\n            <InteractiveCTA \n              onGetStarted={scheduleScrollToProducts}\n            />\n          </>\n        )}\n        \n        {activeTab === 'visual-search' && <VisualSearch products={products} onAddToCart={() => {}} />}\n        {activeTab === 'room-planner' && <RoomPlanner products={products} />}\n      </main>\n\n      <ProductModal \n        product={selectedProduct} \n        isOpen={!!selectedProduct} \n        onClose={() => setSelectedProduct(null)}\n        allProducts={products}\n        onAddToCart={handleAddToCart}\n      />\n      \n      {/* Similar Products AI Recommendation */}\n      {selectedProduct && (\n        <SimilarProducts\n          currentProduct={selectedProduct}\n          allProducts={products}\n          onToggleWishlist={toggleWishlist}\n          wishlist={wishlist}\n          onQuickView={handleProductView}\n          onAddToCart={handleAddToCart}\n        />\n      )}\n      \n      {/* Product Comparison */}\n      <ProductComparison\n        comparisonList={comparison.comparisonList}\n        onRemove={comparison.removeFromComparison}\n        onClear={comparison.clearComparison}\n      />\n      \n      {/* AI Style Quiz Modal */}\n      {showStyleQuiz && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIStyleQuiz\n            products={products}\n            onRecommendations={(recs) => {\n              toast.success(`${recs.length} termk a Style DNA-d alapjn!`);\n            }}\n            onClose={() => setShowStyleQuiz(false)}\n          />\n        </Suspense>\n      )}\n      \n      {/* AI Room Designer Modal */}\n      {showRoomDesigner && (\n        <Suspense fallback={MODAL_LOADING_FALLBACK}>\n          <AIRoomDesigner\n            products={products}\n            onProductRecommendations={(recs) => {\n              toast.success(`${recs.length} termk ajnlat!`);\n            }}\n            onClose={() => setShowRoomDesigner(false)}\n          />\n        </Suspense>\n      )}\n\n      {/* Product Quick Peek Modal */}\n      <ProductQuickPeek\n        product={quickPeekProduct}\n        isOpen={!!quickPeekProduct}\n        onClose={() => setQuickPeekProduct(null)}\n        onAddToCart={(product) => {\n          handleAddToCart(product);\n          setQuickPeekProduct(null);\n        }}\n      />\n\n      {/* AR Product Preview */}\n      {showARPreview && arProduct && (\n        <ARProductPreview\n          product={arProduct}\n          onClose={() => {\n            setShowARPreview(false);\n            setArProduct(null);\n          }}\n        />\n      )}\n\n      {/* AR Measure - Room fit checker */}\n      {showARMeasure && arMeasureProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowARMeasure(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <ARMeasure\n              product={arMeasureProduct}\n              onClose={() => {\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n              onConfirmFit={() => {\n                handleAddToCart(arMeasureProduct);\n                setShowARMeasure(false);\n                setArMeasureProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* One-Click Checkout */}\n      {showOneClickCheckout && oneClickProduct && (\n        <div className=\"fixed inset-0 lg:top-[60px] bg-black/50 z-[9999] flex items-center justify-center p-4\" onClick={() => setShowOneClickCheckout(false)}>\n          <div onClick={e => e.stopPropagation()}>\n            <OneClickCheckout\n              product={oneClickProduct}\n              savedAddress=\"1234 Budapest, Plda utca 12.\"\n              userEmail=\"user@example.com\"\n              userName=\"Felhasznl\"\n              onCheckout={({ product }) => {\n                toast.success('Sikeres rendels!');\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n              onClose={() => {\n                setShowOneClickCheckout(false);\n                setOneClickProduct(null);\n              }}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Smart Newsletter Popup */}\n      <SmartNewsletterPopup\n        onSubscribe={(email) => {\n          toast.success('Sikeres feliratkozs! Ellenrizd az email fikod.');\n          return Promise.resolve();\n        }}\n      />\n\n      {/* Confetti Celebration */}\n      <Confetti \n        isActive={showConfetti} \n        onComplete={() => setShowConfetti(false)} \n      />\n\n      {/* Sticky Add to Cart (shows for selected product) */}\n      {selectedProduct && (\n        <StickyAddToCart\n          product={selectedProduct}\n          onAddToCart={handleAddToCart}\n          onToggleWishlist={toggleWishlist}\n          isWishlisted={wishlist.includes(selectedProduct.id)}\n          observedElementId=\"mkt-product-modal-root\"\n        />\n      )}\n\n      {/* Exit Intent Popup */}\n      {showExitIntent && (\n        <ExitIntentPopup \n          discountPercent={10}\n          onClose={() => setShowExitIntent(false)}\n        />\n      )}\n\n      {/* Mobile Filter Bottom Sheet  same state as desktop AdvancedFilters */}\n      <BottomSheet\n        isOpen={showFilterSheet}\n        onClose={() => setShowFilterSheet(false)}\n        title=\"Szrk\"\n        snapPoints={[0.7, 0.9]}\n      >\n        <AdvancedFiltersPanel\n          products={products}\n          filters={advancedFilters}\n          onFilterChange={setAdvancedFilters}\n          onApply={() => setShowFilterSheet(false)}\n          showHeader={false}\n        />\n      </BottomSheet>\n\n      {/* Wishlist Drawer */}\n      <WishlistDrawer\n        isOpen={showWishlistDrawer}\n        onClose={() => setShowWishlistDrawer(false)}\n        wishlistItems={wishlistItems}\n        onRemove={(id) => toggleWishlist(id)}\n        onAddToCart={handleAddToCart}\n        onProductClick={(product) => {\n          setShowWishlistDrawer(false);\n          handleProductView(product);\n        }}\n        onClearAll={() => {\n          wishlist.forEach(id => toggleWishlist(id));\n        }}\n      />\n\n      {/* Trust Badges Footer Section */}\n      <TrustBadges variant=\"footer\" />\n\n      {/* Sticky Mobile Add to Cart - shows on product view */}\n      {selectedProduct && (\n        <StickyAddToCartMobile\n          product={selectedProduct}\n          onAddToCart={(product, qty) => handleAddToCart(product, qty)}\n          onToggleWishlist={() => toggleWishlist(selectedProduct.id)}\n          isInWishlist={wishlist.includes(selectedProduct?.id)}\n          isVisible={true}\n          freeShippingThreshold={50000}\n        />\n      )}\n    </div>\n    </ToastProvider>\n  );\n};\n\nexport default App;\n","import React from 'react';\n\n/**\n * Root Error Boundary  elkapja a gyerek komponensek hibit,\n * fallback UI-t jelent meg, hogy az app ne dljn el teljesen.\n */\nexport class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    if (typeof window !== 'undefined' && window.console) {\n      console.error('[ErrorBoundary]', error, errorInfo);\n    }\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const Fallback = this.props.fallback;\n      if (Fallback) return <Fallback error={this.state.error} />;\n      return (\n        <div\n          role=\"alert\"\n          className=\"min-h-[200px] flex flex-col items-center justify-center p-6 bg-gray-50 border border-gray-200 rounded-xl text-center\"\n        >\n          <p className=\"text-gray-700 font-medium mb-2\">Valami hiba trtnt.</p>\n          <p className=\"text-sm text-gray-500 mb-4\">Frisstsd az oldalt, vagy prbld ksbb.</p>\n          <button\n            type=\"button\"\n            onClick={() => window.location.reload()}\n            className=\"px-4 py-2 bg-primary-500 text-white rounded-lg font-medium hover:bg-primary-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400\"\n          >\n            Oldal frisstse\n          </button>\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App.jsx'\nimport { ErrorBoundary } from './components/ui/ErrorBoundary'\nimport './index.css'\n\nif (typeof window !== 'undefined' && !window.__MKT_SCROLL_INIT) {\n  window.__MKT_SCROLL_INIT = true\n  window.history.scrollRestoration = 'manual'\n  const NAV_TO_PRODUCTS_WINDOW_MS = 3000\n  const shouldSkipScrollToHeader = () =>\n    typeof window.__MKT_NAV_TO_PRODUCTS === 'number' &&\n    Date.now() - window.__MKT_NAV_TO_PRODUCTS < NAV_TO_PRODUCTS_WINDOW_MS\n  const scrollToHeader = () => {\n    if (shouldSkipScrollToHeader()) return\n    window.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n    const appRoot = document.getElementById('mkt-butorbolt-app') || document.getElementById('root')\n    if (appRoot) {\n      let parent = appRoot.parentElement\n      while (parent && parent !== document.body) {\n        const style = getComputedStyle(parent)\n        const oy = style.overflowY\n        const isScrollable = (oy === 'auto' || oy === 'scroll' || oy === 'overlay') && parent.scrollHeight > parent.clientHeight\n        if (isScrollable) {\n          parent.scrollTo({ top: 0, left: 0, behavior: 'auto' })\n          break\n        }\n        parent = parent.parentElement\n      }\n    }\n  }\n  const handleLoad = () => {\n    scrollToHeader()\n    requestAnimationFrame(() => { scrollToHeader(); setTimeout(scrollToHeader, 50); setTimeout(scrollToHeader, 150) })\n  }\n  const handlePageshow = (e) => {\n    scrollToHeader()\n    if (e.persisted) {\n      setTimeout(scrollToHeader, 50)\n      setTimeout(scrollToHeader, 150)\n    }\n  }\n  scrollToHeader()\n  window.addEventListener('DOMContentLoaded', scrollToHeader)\n  window.addEventListener('load', handleLoad)\n  window.addEventListener('pageshow', handlePageshow)\n  window.__MKT_SCROLL_CLEANUP = () => {\n    window.removeEventListener('DOMContentLoaded', scrollToHeader)\n    window.removeEventListener('load', handleLoad)\n    window.removeEventListener('pageshow', handlePageshow)\n    window.__MKT_SCROLL_INIT = false\n    delete window.__MKT_SCROLL_CLEANUP\n  }\n}\n\nconst rootEl = document.getElementById('root')\nif (rootEl) {\n  if (!window.__MKT_BUTORBOLT_APP_MOUNTED) {\n    window.__MKT_BUTORBOLT_APP_MOUNTED = true\n    ReactDOM.createRoot(rootEl).render(\n      <React.StrictMode>\n        <ErrorBoundary>\n          <App />\n        </ErrorBoundary>\n      </React.StrictMode>,\n    )\n  }\n}\n"],"file":"assets/index.js"}