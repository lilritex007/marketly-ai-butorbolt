import{o as fe,j as e,q as V,E as pe,r as se,b as re,v as be,w as ne,x as ve}from"./index.js";import{r as l,H as we,P as ye,a4 as ke,b0 as je,R as K,a6 as ee}from"./icons.js";import{P as Ne}from"./ProductCarousel.js";import"./vendor.js";const C=600,_=18,Se=40,Pe=30,te=a=>{if(!a)return 0;const m=Date.parse(a);return Number.isFinite(m)?m:0},O=(a,m,h)=>{if(a.length<=h)return a;const u=m+h;if(u<=a.length)return a.slice(m,u);const c=a.slice(m),k=a.slice(0,u-a.length);return[...c,...k]};function W(a,m){let h=m;const u=String(a);for(let c=0;c<u.length;c++)h=h*31+u.charCodeAt(c)>>>0;return h/4294967296}function Ee(a,m,h=[]){if(!a.length)return[];const u=new Set(h),c=se(),k=re(40);new Set(k.map(n=>n.id));const g=new Set,o=[],t=n=>n.filter(i=>(i.inStock??i.in_stock??!0)&&!u.has(i.id)&&!g.has(i.id)),x=n=>{n.forEach(i=>{i!=null&&i.id&&!g.has(i.id)&&!u.has(i.id)&&(g.add(i.id),o.push(i))})};x(t(a.filter(n=>c.includes(n.id)))),k.forEach(n=>{const i=a.find(f=>f.id===n.id);i&&!g.has(i.id)&&x([i])}),k.slice(0,6).forEach(n=>{const i=a.find(f=>f.id===n.id);if(i&&i.id){const f=ve(i,a,10);x(t(f))}});const w=ne(a,C);x(t(w));const P=a.filter(n=>!g.has(n.id)&&!u.has(n.id)&&(n.inStock??n.in_stock??!0)),y=P.filter(n=>n.salePrice&&n.price>n.salePrice),L=P.filter(n=>!(n.salePrice&&n.price>n.salePrice)),I=[...y,...L],j=new Map;I.forEach(n=>{const i=(n.category||"").split(">")[0]||"other";j.has(i)||j.set(i,[]),j.get(i).push(n)});const N=[],A=Array.from(j.values());let r=0;for(;N.length<I.length;){for(const n of A)r<n.length&&N.push(n[r]);r++}return N.sort((n,i)=>{const f=W(String(n.id),m),E=W(String(i.id),m);return f-E}),x(N),o.slice(0,C).sort((n,i)=>{const f=W(String(n.id),m+1),E=W(String(i.id),m+1);return f-E})}function Ce(a){if(!a.length)return[];const m=a.filter(o=>o.inStock??o.in_stock??!0),h=new Map;m.forEach(o=>{const t=(o.category||"").split(">")[0]||"other";h.has(t)||h.set(t,[]),h.get(t).push(o)});const u=(o,t)=>{const x=te(o.updated_at||o.updatedAt||o.created_at||o.createdAt||o.last_synced_at),w=te(t.updated_at||t.updatedAt||t.created_at||t.createdAt||t.last_synced_at);if(x!==w)return w-x;const P=typeof o.id=="number"?o.id:parseInt(String(o.id).replace(/\D/g,""),10)||0;return(typeof t.id=="number"?t.id:parseInt(String(t.id).replace(/\D/g,""),10)||0)-P};Array.from(h.values()).forEach(o=>o.sort(u));const c=[],k=Array.from(h.values());let g=0;for(;c.length<C;){let o=0;for(const t of k)g<t.length&&c.length<C&&(c.push(t[g]),o++);if(o===0)break;g++}return c}function Ie(a,m=[]){if(!a.length)return[];const h=new Set(m),u=a.filter(r=>(r.inStock??r.in_stock??!0)&&!h.has(r.id)),c=se(),g=re(50).map(r=>r.id),o=be(),t=ne(u,Math.floor(C*.5)),x=[...u].filter(r=>r.salePrice&&r.price>r.salePrice).sort((r,d)=>d.price-(d.salePrice||0)-(r.price-(r.salePrice||0))),w=new Set(x.map(r=>r.id)),P=u.filter(r=>!w.has(r.id)),y=new Map;P.forEach(r=>{const d=(r.category||"").split(">")[0]||"other";y.has(d)||y.set(d,[]),y.get(d).push(r)});const L=r=>(r.category||"").split(">").map(d=>d.trim().toLowerCase()).filter(Boolean),I=(r,d)=>{const n=V(r)??0,i=V(d)??0;let f=(c.includes(r.id)?10:0)+(g.includes(r.id)?5:0)+Math.min(n,20)*.1,E=(c.includes(d.id)?10:0)+(g.includes(d.id)?5:0)+Math.min(i,20)*.1;return L(r).forEach(b=>{var z;f+=(((z=o.categories)==null?void 0:z[b])||0)*.5}),L(d).forEach(b=>{var z;E+=(((z=o.categories)==null?void 0:z[b])||0)*.5}),t.some(b=>b.id===r.id)&&(f+=3),t.some(b=>b.id===d.id)&&(E+=3),E-f};Array.from(y.values()).forEach(r=>r.sort(I));const j=[],N=Array.from(y.values());let A=0;for(;j.length<P.length;){let r=0;for(const d of N)A<d.length&&(j.push(d[A]),r++);if(r===0)break;A++}return[...x,...j].slice(0,C)}const R=[{id:"favorites",title:"Vásárlóink kedvencei",subtitle:"A legjobbra értékelt és legtöbbet választott bútorok",Icon:we,accentClass:"from-pink-500 to-rose-600",eyebrow:"Közösségi kedvencek",badge:"Közönségkedvenc",className:"border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites",tone:"favorites",sectionId:"customer-favorites",metaLabel:"Összesen"},{id:"new",title:"Friss beérkezés",subtitle:"A legújabb termékeink, folyamatosan frissítve",Icon:ye,accentClass:"from-violet-500 to-purple-600",eyebrow:"Újdonság",badge:"Újdonságok",className:"border border-violet-100 shadow-sm section-header-hero section-header-hero--new",tone:"new",sectionId:"new-arrivals",metaLabel:"Összesen"},{id:"popular",title:"Legnépszerűbb",subtitle:"A vásárlók kedvencei és a legjobb ajánlatok",Icon:ke,accentClass:"from-amber-500 to-orange-600",eyebrow:"Felfedezés",badge:null,className:"border border-amber-100 shadow-sm section-header-hero section-header-hero--popular",tone:"popular",sectionId:"most-popular",metaLabel:"Raktáron"}];function Le({products:a=[],onProductClick:m,onToggleWishlist:h,wishlist:u=[],onViewAll:c,onAddToCart:k,contextLabel:g="",rotationTick:o}){const[t,x]=l.useState("favorites"),[w,P]=l.useState(()=>Math.floor(Date.now()/1e4)),[y,L]=l.useState(0),[I,j]=l.useState(0),[N,A]=l.useState(0),[r,d]=l.useState("weekly"),[n,i]=l.useState(!1),[f,E]=l.useState(!0),b=l.useRef(null),z=l.useRef(null),X=l.useRef(0),ae=s=>{var M,S;X.current=((S=(M=s.touches)==null?void 0:M[0])==null?void 0:S.clientX)??0},ie=s=>{var U,Y;const M=((Y=(U=s.changedTouches)==null?void 0:U[0])==null?void 0:Y.clientX)??0,S=X.current-M;if(Math.abs(S)>60){const B=R.findIndex(xe=>xe.id===t);S>0&&B<R.length-1?x(R[B+1].id):S<0&&B>0&&x(R[B-1].id)}},$=l.useMemo(()=>Ce(a),[a]),F=l.useMemo(()=>$.slice(0,Se).map(s=>s.id),[$]),v=l.useMemo(()=>Ie(a,F),[a,F]),q=l.useMemo(()=>v.slice(0,Pe).map(s=>s.id),[v]),Z=l.useMemo(()=>[...F,...q],[F,q]),D=l.useMemo(()=>Ee(a,w,Z),[a,w,Z]),oe=l.useMemo(()=>v.slice(0,Math.floor(C/2)),[v]),le=l.useMemo(()=>v.slice(Math.floor(C/2)).length>0?v.slice(Math.floor(C/2)):v,[v]),T=r==="weekly"?oe:le,ce=l.useMemo(()=>{const s=y*_%Math.max(1,D.length);return O(D,s,_)},[D,y]);l.useEffect(()=>{L(0)},[w]);const de=l.useMemo(()=>{const s=I*_%Math.max(1,$.length);return O($,s,_)},[$,I]),me=l.useMemo(()=>{const s=N*_%Math.max(1,T.length);return O(T,s,_)},[T,N]),G=l.useMemo(()=>v.filter(s=>s.salePrice&&s.price>s.salePrice).length,[v]);l.useEffect(()=>{fe("product-worlds","section_impression")},[]),l.useEffect(()=>{if(typeof window>"u"||!("IntersectionObserver"in window)||!b.current||!(b.current instanceof Element))return;const s=new IntersectionObserver(([M])=>E(M.isIntersecting),{threshold:.15});try{s.observe(b.current)}catch{return}return()=>s.disconnect()},[]);const p=R.find(s=>s.id===t),H=t==="favorites"?ce:t==="new"?de:me;t==="favorites"?D.length:t==="new"?$.length:T.length;const Q=t==="favorites"?D.length:t==="new"?$.length:v.length;if(a.length===0)return null;const he=()=>t==="favorites"?e.jsxs("button",{type:"button",onClick:()=>P(s=>s+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Frissítem"]}):t==="new"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>j(s=>s+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-violet-700 bg-violet-50 border border-violet-100 hover:bg-violet-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Következő"]}),c&&e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 text-violet-600 font-semibold hover:text-violet-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400 rounded-lg px-3 py-2 min-h-[44px]",children:["Összes megtekintése ",e.jsx(ee,{className:"w-4 h-4"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center rounded-full bg-white border border-gray-100 shadow-sm p-1",children:[{id:"weekly",label:"Heti kedvencek"},{id:"monthly",label:"Havi toplista"}].map(s=>e.jsx("button",{type:"button",onClick:()=>d(s.id),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors min-h-[36px] ${r===s.id?"bg-amber-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:s.label},s.id))}),e.jsxs("button",{type:"button",onClick:()=>A(s=>s+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-amber-700 bg-amber-50 border border-amber-100 hover:bg-amber-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Új válogatás"]}),c&&e.jsxs("button",{type:"button",onClick:c,className:"inline-flex items-center gap-2 text-primary-600 font-semibold hover:text-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 rounded-lg px-3 py-2 min-h-[44px]",children:["Összes megtekintése ",e.jsx(ee,{className:"w-4 h-4"})]})]}),ue=t==="popular"?`Raktáron: ${Q.toLocaleString("hu-HU")} • Összesen: ${v.length.toLocaleString("hu-HU")}`:`${p.metaLabel}: ${Q.toLocaleString("hu-HU")} termék`,J=t==="popular"?G>0?`${G} akciós termék`:"Prémium válogatás":p.badge,ge={favorites:"bg-gradient-to-br from-rose-100/60 via-white to-pink-100/50",new:"bg-gradient-to-br from-violet-100/50 via-white to-purple-100/40",popular:"bg-gradient-to-br from-amber-100/60 via-white to-orange-100/50"}[t];return e.jsx("section",{ref:b,className:`section-shell section-world section-world--${t} py-12 sm:py-16 lg:py-20 overflow-hidden w-full transition-colors duration-500 ${ge}`,"aria-labelledby":`${t}-heading`,"aria-label":"Termék világok",role:"region","data-section":"product-worlds",children:e.jsxs("div",{className:"w-full max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{ref:z,onTouchStart:ae,onTouchEnd:ie,className:"touch-pan-y",children:[e.jsx("div",{className:"flex justify-center mb-6 sm:mb-8 lg:mb-12 px-2 sm:px-4",role:"tablist","aria-label":"Válassz világot",children:e.jsxs("div",{className:"flex w-full max-w-2xl sm:w-auto sm:inline-flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx("div",{className:"flex flex-1 sm:flex-initial rounded-2xl bg-white/95 backdrop-blur-sm border-2 border-gray-200/80 shadow-xl shadow-gray-300/40 p-2 sm:p-2.5 gap-2",children:R.map(s=>e.jsxs("button",{type:"button",role:"tab","aria-selected":t===s.id,"aria-controls":`panel-${s.id}`,id:`tab-${s.id}`,onClick:()=>x(s.id),className:`flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-4 sm:px-6 lg:px-8 py-3 sm:py-3.5 rounded-xl text-sm sm:text-base font-bold transition-all duration-300 min-h-[48px] sm:min-h-[52px] whitespace-nowrap ${t===s.id?`bg-gradient-to-r ${s.accentClass} text-white shadow-lg`:"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(s.Icon,{className:"w-5 h-5 sm:w-6 sm:h-6 shrink-0","aria-hidden":!0}),e.jsx("span",{className:"truncate",children:s.id==="favorites"?"Kedvencek":s.id==="new"?"Friss":e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sm:hidden",children:"Népszerű"}),e.jsx("span",{className:"hidden sm:inline",children:"Legnépszerűbb"})]})})]},s.id))}),e.jsxs("div",{className:"sm:hidden flex items-center justify-center gap-1.5 py-2 text-gray-500 text-xs font-medium",children:[e.jsx(je,{className:"w-4 h-4","aria-hidden":!0}),e.jsx("span",{children:"Pörgethető"})]})]})}),e.jsxs("div",{className:`relative overflow-hidden px-4 sm:px-6 lg:px-10 py-8 sm:py-10 lg:py-14 rounded-2xl lg:rounded-3xl border-2 ${p.className} transition-all duration-500`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/85 via-white/60 to-transparent pointer-events-none"}),e.jsx("div",{className:`absolute -top-12 -right-12 w-48 h-48 sm:w-64 sm:h-64 rounded-full bg-gradient-to-br ${p.accentClass} opacity-[0.12] blur-3xl pointer-events-none`,"aria-hidden":!0}),e.jsx("div",{className:`absolute -bottom-8 -left-8 w-32 h-32 sm:w-40 sm:h-40 rounded-full bg-gradient-to-tr ${p.accentClass} opacity-[0.08] blur-2xl pointer-events-none`,"aria-hidden":!0}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 min-w-0",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white/95 backdrop-blur border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-black tracking-wide shadow-md uppercase",children:[e.jsx("span",{className:`w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-gradient-to-r ${p.accentClass} shrink-0`}),e.jsx("span",{className:"truncate",children:p.eyebrow})]}),e.jsx("h2",{id:`${t}-heading`,className:"text-2xl sm:text-3xl font-bold leading-[1.15] tracking-tight text-gray-900 break-words",children:p.title}),e.jsx("p",{className:"text-base text-gray-600 max-w-2xl font-semibold",children:p.subtitle}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 pt-1 sm:pt-2",children:[J&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm",children:[e.jsx(p.Icon,{className:"w-4 h-4 sm:w-5 sm:h-5 opacity-80 shrink-0"}),J]}),g&&e.jsx("span",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm max-w-[160px] sm:max-w-none truncate",children:g}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-500 truncate",children:ue})]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 shrink-0",children:he()})]})})]})]}),e.jsxs("div",{id:`panel-${t}`,role:"tabpanel","aria-labelledby":`tab-${t}`,className:"product-worlds-content mt-8 lg:mt-10 px-0 sm:px-2 transition-opacity duration-300 touch-pan-y",children:[H.length>0?e.jsx(Ne,{className:"mt-2 -mx-4 sm:mx-0 pl-4 sm:pl-0 pr-4 sm:pr-0",autoScroll:!1,onInteractionChange:i,cardSize:"default",desktopColumns:6,children:H.map((s,M)=>{const S=V(s),U=S!==null&&S<=3?`Utolsó ${S} db`:"";return e.jsx("div",{className:"relative overflow-hidden rounded-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ring-1 ring-gray-200/80 hover:ring-gray-300",children:e.jsx(pe,{product:s,onToggleWishlist:h,isWishlisted:u.includes(s.id),onQuickView:m,onAddToCart:k||(()=>{}),index:M,highlightBadge:U,sectionId:p.sectionId,showFeedback:!0,size:"default",tone:p.tone,accentClass:p.accentClass,skipScrollAnimation:!0})},s.id)})},`${t}-${t==="favorites"?w:t==="new"?I:N}`):e.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl shadow-inner",children:[e.jsx(p.Icon,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nincs elég adat"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Térj vissza később vagy frissítsd az oldalt."})]}),H.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 flex flex-wrap items-center justify-center gap-3 text-xs text-gray-500",children:[t==="favorites"&&e.jsx("span",{children:"Kedvenceid és megtekintéseid alapján személyre szabott válogatás."}),t==="new"&&e.jsx("span",{children:"Legfrissebb termékek a backend adataiból."}),t==="popular"&&e.jsx("span",{children:"Kedvelések, megtekintések és akciós ajánlatok alapján."})]})]},t)]})})}export{Le as default};
//# sourceMappingURL=ProductWorldsSection.js.map
