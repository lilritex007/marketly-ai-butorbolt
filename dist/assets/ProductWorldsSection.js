import{o as pe,j as e,q as V,E as ee,r as ne,b as re,v as be,w as ae,x as ve}from"./index.js";import{r as l,H as we,P as ye,a4 as ke,b0 as je,R as K,a6 as te}from"./icons.js";import{P as Ne}from"./ProductCarousel.js";import"./vendor.js";const C=600,F=18,Se=40,Pe=30,se=a=>{if(!a)return 0;const c=Date.parse(a);return Number.isFinite(c)?c:0},O=(a,c,h)=>{if(a.length<=h)return a;const u=c+h;if(u<=a.length)return a.slice(c,u);const d=a.slice(c),y=a.slice(0,u-a.length);return[...d,...y]};function H(a,c){let h=c;const u=String(a);for(let d=0;d<u.length;d++)h=h*31+u.charCodeAt(d)>>>0;return h/4294967296}function Ee(a,c,h=[]){if(!a.length)return[];const u=new Set(h),d=ne(),y=re(40);new Set(y.map(r=>r.id));const x=new Set,o=[],s=r=>r.filter(i=>(i.inStock??i.in_stock??!0)&&!u.has(i.id)&&!x.has(i.id)),f=r=>{r.forEach(i=>{i!=null&&i.id&&!x.has(i.id)&&!u.has(i.id)&&(x.add(i.id),o.push(i))})};f(s(a.filter(r=>d.includes(r.id)))),y.forEach(r=>{const i=a.find(p=>p.id===r.id);i&&!x.has(i.id)&&f([i])}),y.slice(0,6).forEach(r=>{const i=a.find(p=>p.id===r.id);if(i&&i.id){const p=ve(i,a,10);f(s(p))}});const k=ae(a,C);f(s(k));const E=a.filter(r=>!x.has(r.id)&&!u.has(r.id)&&(r.inStock??r.in_stock??!0)),j=E.filter(r=>r.salePrice&&r.price>r.salePrice),L=E.filter(r=>!(r.salePrice&&r.price>r.salePrice)),A=[...j,...L],N=new Map;A.forEach(r=>{const i=(r.category||"").split(">")[0]||"other";N.has(i)||N.set(i,[]),N.get(i).push(r)});const S=[],M=Array.from(N.values());let n=0;for(;S.length<A.length;){for(const r of M)n<r.length&&S.push(r[n]);n++}return S.sort((r,i)=>{const p=H(String(r.id),c),I=H(String(i.id),c);return p-I}),f(S),o.slice(0,C).sort((r,i)=>{const p=H(String(r.id),c+1),I=H(String(i.id),c+1);return p-I})}function Ie(a){if(!a.length)return[];const c=a.filter(o=>o.inStock??o.in_stock??!0),h=new Map;c.forEach(o=>{const s=(o.category||"").split(">")[0]||"other";h.has(s)||h.set(s,[]),h.get(s).push(o)});const u=(o,s)=>{const f=se(o.updated_at||o.updatedAt||o.created_at||o.createdAt||o.last_synced_at),k=se(s.updated_at||s.updatedAt||s.created_at||s.createdAt||s.last_synced_at);if(f!==k)return k-f;const E=typeof o.id=="number"?o.id:parseInt(String(o.id).replace(/\D/g,""),10)||0;return(typeof s.id=="number"?s.id:parseInt(String(s.id).replace(/\D/g,""),10)||0)-E};Array.from(h.values()).forEach(o=>o.sort(u));const d=[],y=Array.from(h.values());let x=0;for(;d.length<C;){let o=0;for(const s of y)x<s.length&&d.length<C&&(d.push(s[x]),o++);if(o===0)break;x++}return d}function Ce(a,c=[]){if(!a.length)return[];const h=new Set(c),u=a.filter(n=>(n.inStock??n.in_stock??!0)&&!h.has(n.id)),d=ne(),x=re(50).map(n=>n.id),o=be(),s=ae(u,Math.floor(C*.5)),f=[...u].filter(n=>n.salePrice&&n.price>n.salePrice).sort((n,m)=>m.price-(m.salePrice||0)-(n.price-(n.salePrice||0))),k=new Set(f.map(n=>n.id)),E=u.filter(n=>!k.has(n.id)),j=new Map;E.forEach(n=>{const m=(n.category||"").split(">")[0]||"other";j.has(m)||j.set(m,[]),j.get(m).push(n)});const L=n=>(n.category||"").split(">").map(m=>m.trim().toLowerCase()).filter(Boolean),A=(n,m)=>{const r=V(n)??0,i=V(m)??0;let p=(d.includes(n.id)?10:0)+(x.includes(n.id)?5:0)+Math.min(r,20)*.1,I=(d.includes(m.id)?10:0)+(x.includes(m.id)?5:0)+Math.min(i,20)*.1;return L(n).forEach(v=>{var z;p+=(((z=o.categories)==null?void 0:z[v])||0)*.5}),L(m).forEach(v=>{var z;I+=(((z=o.categories)==null?void 0:z[v])||0)*.5}),s.some(v=>v.id===n.id)&&(p+=3),s.some(v=>v.id===m.id)&&(I+=3),I-p};Array.from(j.values()).forEach(n=>n.sort(A));const N=[],S=Array.from(j.values());let M=0;for(;N.length<E.length;){let n=0;for(const m of S)M<m.length&&(N.push(m[M]),n++);if(n===0)break;M++}return[...f,...N].slice(0,C)}const R=[{id:"favorites",title:"Vásárlóink kedvencei",subtitle:"A legjobbra értékelt és legtöbbet választott bútorok",Icon:we,accentClass:"from-pink-500 to-rose-600",eyebrow:"Közösségi kedvencek",badge:"Közönségkedvenc",className:"border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites",tone:"favorites",sectionId:"customer-favorites",metaLabel:"Összesen"},{id:"new",title:"Friss beérkezés",subtitle:"A legújabb termékeink, folyamatosan frissítve",Icon:ye,accentClass:"from-violet-500 to-purple-600",eyebrow:"Újdonság",badge:"Újdonságok",className:"border border-violet-100 shadow-sm section-header-hero section-header-hero--new",tone:"new",sectionId:"new-arrivals",metaLabel:"Összesen"},{id:"popular",title:"Legnépszerűbb",subtitle:"A vásárlók kedvencei és a legjobb ajánlatok",Icon:ke,accentClass:"from-amber-500 to-orange-600",eyebrow:"Felfedezés",badge:null,className:"border border-amber-100 shadow-sm section-header-hero section-header-hero--popular",tone:"popular",sectionId:"most-popular",metaLabel:"Raktáron"}];function Le({products:a=[],onProductClick:c,onToggleWishlist:h,wishlist:u=[],onViewAll:d,onAddToCart:y,contextLabel:x="",rotationTick:o}){const[s,f]=l.useState("favorites"),[k,E]=l.useState(()=>Math.floor(Date.now()/1e4)),[j,L]=l.useState(0),[A,N]=l.useState(0),[S,M]=l.useState(0),[n,m]=l.useState("weekly"),[r,i]=l.useState(!1),[p,I]=l.useState(!0),v=l.useRef(null),z=l.useRef(null),X=l.useRef(0),ie=t=>{var P,b;X.current=((b=(P=t.touches)==null?void 0:P[0])==null?void 0:b.clientX)??0},oe=t=>{var _,Y;const P=((Y=(_=t.changedTouches)==null?void 0:_[0])==null?void 0:Y.clientX)??0,b=X.current-P;if(Math.abs(b)>60){const W=R.findIndex(fe=>fe.id===s);b>0&&W<R.length-1?f(R[W+1].id):b<0&&W>0&&f(R[W-1].id)}},$=l.useMemo(()=>Ie(a),[a]),T=l.useMemo(()=>$.slice(0,Se).map(t=>t.id),[$]),w=l.useMemo(()=>Ce(a,T),[a,T]),q=l.useMemo(()=>w.slice(0,Pe).map(t=>t.id),[w]),Q=l.useMemo(()=>[...T,...q],[T,q]),D=l.useMemo(()=>Ee(a,k,Q),[a,k,Q]),le=l.useMemo(()=>w.slice(0,Math.floor(C/2)),[w]),ce=l.useMemo(()=>w.slice(Math.floor(C/2)).length>0?w.slice(Math.floor(C/2)):w,[w]),U=n==="weekly"?le:ce,de=l.useMemo(()=>{const t=j*F%Math.max(1,D.length);return O(D,t,F)},[D,j]);l.useEffect(()=>{L(0)},[k]);const me=l.useMemo(()=>{const t=A*F%Math.max(1,$.length);return O($,t,F)},[$,A]),he=l.useMemo(()=>{const t=S*F%Math.max(1,U.length);return O(U,t,F)},[U,S]),Z=l.useMemo(()=>w.filter(t=>t.salePrice&&t.price>t.salePrice).length,[w]);l.useEffect(()=>{pe("product-worlds","section_impression")},[]),l.useEffect(()=>{if(typeof window>"u"||!("IntersectionObserver"in window)||!v.current||!(v.current instanceof Element))return;const t=new IntersectionObserver(([P])=>I(P.isIntersecting),{threshold:.15});try{t.observe(v.current)}catch{return}return()=>t.disconnect()},[]);const g=R.find(t=>t.id===s),B=s==="favorites"?de:s==="new"?me:he;s==="favorites"?D.length:s==="new"?$.length:U.length;const G=s==="favorites"?D.length:s==="new"?$.length:w.length;if(a.length===0)return null;const ue=()=>s==="favorites"?e.jsxs("button",{type:"button",onClick:()=>E(t=>t+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Frissítem"]}):s==="new"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>N(t=>t+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-violet-700 bg-violet-50 border border-violet-100 hover:bg-violet-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Következő"]}),d&&e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 text-violet-600 font-semibold hover:text-violet-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400 rounded-lg px-3 py-2 min-h-[44px]",children:["Összes megtekintése ",e.jsx(te,{className:"w-4 h-4"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center rounded-full bg-white border border-gray-100 shadow-sm p-1",children:[{id:"weekly",label:"Heti kedvencek"},{id:"monthly",label:"Havi toplista"}].map(t=>e.jsx("button",{type:"button",onClick:()=>m(t.id),className:`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors min-h-[36px] ${n===t.id?"bg-amber-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:t.label},t.id))}),e.jsxs("button",{type:"button",onClick:()=>M(t=>t+1),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-amber-700 bg-amber-50 border border-amber-100 hover:bg-amber-100 transition-colors text-sm font-semibold min-h-[44px]",children:[e.jsx(K,{className:"w-4 h-4"}),"Új válogatás"]}),d&&e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 text-primary-600 font-semibold hover:text-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 rounded-lg px-3 py-2 min-h-[44px]",children:["Összes megtekintése ",e.jsx(te,{className:"w-4 h-4"})]})]}),ge=s==="popular"?`Raktáron: ${G.toLocaleString("hu-HU")} • Összesen: ${w.length.toLocaleString("hu-HU")}`:`${g.metaLabel}: ${G.toLocaleString("hu-HU")} termék`,J=s==="popular"?Z>0?`${Z} akciós termék`:"Prémium válogatás":g.badge,xe={favorites:"bg-gradient-to-br from-rose-100/60 via-white to-pink-100/50",new:"bg-gradient-to-br from-violet-100/50 via-white to-purple-100/40",popular:"bg-gradient-to-br from-amber-100/60 via-white to-orange-100/50"}[s];return e.jsx("section",{ref:v,className:`section-shell section-world section-world--${s} py-12 sm:py-16 lg:py-20 overflow-hidden w-full transition-colors duration-500 ${xe}`,"aria-labelledby":`${s}-heading`,"aria-label":"Termék világok",role:"region","data-section":"product-worlds",children:e.jsxs("div",{className:"w-full max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{ref:z,onTouchStart:ie,onTouchEnd:oe,className:"touch-pan-y",children:[e.jsx("div",{className:"flex justify-center mb-6 sm:mb-8 lg:mb-12 px-2 sm:px-4",role:"tablist","aria-label":"Válassz világot",children:e.jsxs("div",{className:"flex w-full max-w-2xl sm:w-auto sm:inline-flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx("div",{className:"flex flex-1 sm:flex-initial rounded-2xl bg-white/95 backdrop-blur-sm border-2 border-gray-200/80 shadow-xl shadow-gray-300/40 p-2 sm:p-2.5 gap-2",children:R.map(t=>e.jsxs("button",{type:"button",role:"tab","aria-selected":s===t.id,"aria-controls":`panel-${t.id}`,id:`tab-${t.id}`,onClick:()=>f(t.id),className:`flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-4 sm:px-6 lg:px-8 py-3 sm:py-3.5 rounded-xl text-sm sm:text-base font-bold transition-all duration-300 min-h-[48px] sm:min-h-[52px] whitespace-nowrap ${s===t.id?`bg-gradient-to-r ${t.accentClass} text-white shadow-lg`:"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(t.Icon,{className:"w-5 h-5 sm:w-6 sm:h-6 shrink-0","aria-hidden":!0}),e.jsx("span",{className:"truncate",children:t.id==="favorites"?"Kedvencek":t.id==="new"?"Friss":e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sm:hidden",children:"Népszerű"}),e.jsx("span",{className:"hidden sm:inline",children:"Legnépszerűbb"})]})})]},t.id))}),e.jsxs("div",{className:"sm:hidden flex items-center justify-center gap-1.5 py-2 text-gray-500 text-xs font-medium",children:[e.jsx(je,{className:"w-4 h-4","aria-hidden":!0}),e.jsx("span",{children:"Pörgethető"})]})]})}),e.jsxs("div",{className:`relative overflow-hidden px-4 sm:px-6 lg:px-10 py-8 sm:py-10 lg:py-14 rounded-2xl lg:rounded-3xl border-2 ${g.className} transition-all duration-500`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/85 via-white/60 to-transparent pointer-events-none"}),e.jsx("div",{className:`absolute -top-12 -right-12 w-48 h-48 sm:w-64 sm:h-64 rounded-full bg-gradient-to-br ${g.accentClass} opacity-[0.12] blur-3xl pointer-events-none`,"aria-hidden":!0}),e.jsx("div",{className:`absolute -bottom-8 -left-8 w-32 h-32 sm:w-40 sm:h-40 rounded-full bg-gradient-to-tr ${g.accentClass} opacity-[0.08] blur-2xl pointer-events-none`,"aria-hidden":!0}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4 min-w-0",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white/95 backdrop-blur border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-black tracking-wide shadow-md uppercase",children:[e.jsx("span",{className:`w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-gradient-to-r ${g.accentClass} shrink-0`}),e.jsx("span",{className:"truncate",children:g.eyebrow})]}),e.jsx("h2",{id:`${s}-heading`,className:"text-2xl sm:text-3xl font-bold leading-[1.15] tracking-tight text-gray-900 break-words",children:g.title}),e.jsx("p",{className:"text-base text-gray-600 max-w-2xl font-semibold",children:g.subtitle}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 pt-1 sm:pt-2",children:[J&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm",children:[e.jsx(g.Icon,{className:"w-4 h-4 sm:w-5 sm:h-5 opacity-80 shrink-0"}),J]}),x&&e.jsx("span",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm max-w-[160px] sm:max-w-none truncate",children:x}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-500 truncate",children:ge})]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 shrink-0",children:ue()})]})})]})]}),e.jsxs("div",{id:`panel-${s}`,role:"tabpanel","aria-labelledby":`tab-${s}`,className:"product-worlds-content mt-8 lg:mt-10 px-0 sm:px-2 transition-opacity duration-300 touch-pan-y",children:[B.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"lg:hidden",children:e.jsx(Ne,{className:"mt-2 -mx-4 sm:mx-0 pl-4 sm:pl-0 pr-4 sm:pr-0",autoScroll:!1,onInteractionChange:i,cardSize:"default",desktopColumns:6,children:B.map((t,P)=>{const b=V(t),_=b!==null&&b<=3?`Utolsó ${b} db`:"";return e.jsx("div",{className:"relative overflow-hidden rounded-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ring-1 ring-gray-200/80 hover:ring-gray-300",children:e.jsx(ee,{product:t,onToggleWishlist:h,isWishlisted:u.includes(t.id),onQuickView:c,onAddToCart:y||(()=>{}),index:P,highlightBadge:_,sectionId:g.sectionId,showFeedback:!0,size:"default",tone:g.tone,accentClass:g.accentClass,skipScrollAnimation:!0})},t.id)})},`${s}-${s==="favorites"?k:s==="new"?A:S}`)}),e.jsx("div",{className:"hidden lg:grid product-grid mt-2",children:B.map((t,P)=>{const b=V(t),_=b!==null&&b<=3?`Utolsó ${b} db`:"";return e.jsx("div",{className:"relative overflow-hidden rounded-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ring-1 ring-gray-200/80 hover:ring-gray-300",children:e.jsx(ee,{product:t,onToggleWishlist:h,isWishlisted:u.includes(t.id),onQuickView:c,onAddToCart:y||(()=>{}),index:P,highlightBadge:_,sectionId:g.sectionId,showFeedback:!0,size:"default",tone:g.tone,accentClass:g.accentClass,skipScrollAnimation:!0})},t.id)})})]}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl shadow-inner",children:[e.jsx(g.Icon,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Nincs elég adat"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Térj vissza később vagy frissítsd az oldalt."})]}),B.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-100 flex flex-wrap items-center justify-center gap-3 text-xs text-gray-500",children:[s==="favorites"&&e.jsx("span",{children:"Kedvenceid és megtekintéseid alapján személyre szabott válogatás."}),s==="new"&&e.jsx("span",{children:"Legfrissebb termékek a backend adataiból."}),s==="popular"&&e.jsx("span",{children:"Kedvelések, megtekintések és akciós ajánlatok alapján."})]})]},s)]})})}export{Le as default};
//# sourceMappingURL=ProductWorldsSection.js.map
