{"version":3,"file":"ProductWorldsSection.js","sources":["../../src/components/landing/ProductWorldsSection.jsx"],"sourcesContent":["import React, { useMemo, useState, useEffect, useRef } from 'react';\nimport {\n  Heart,\n  Package,\n  TrendingUp,\n  ArrowRight,\n  RefreshCw,\n  ChevronsLeftRight,\n} from 'lucide-react';\nimport { EnhancedProductCard } from '../product/EnhancedProductCard';\nimport { getStockLevel } from '../../utils/helpers';\nimport {\n  getLikedProducts,\n  getViewedProducts,\n  getPersonalizedRecommendations,\n  getSimilarProducts,\n  getPreferenceSignals,\n  trackSectionEvent,\n} from '../../services/userPreferencesService';\nimport ProductCarousel from '../ui/ProductCarousel';\n\nconst POOL_SIZE = 600;\nconst PAGE_SIZE = 18;\nconst DEDUPE_EXCLUDE_NEW = 40;\nconst DEDUPE_EXCLUDE_POPULAR = 30;\n\nconst toTimestamp = (value) => {\n  if (!value) return 0;\n  const t = Date.parse(value);\n  return Number.isFinite(t) ? t : 0;\n};\n\nconst sliceWrap = (items, start, size) => {\n  if (items.length <= size) return items;\n  const end = start + size;\n  if (end <= items.length) return items.slice(start, end);\n  const first = items.slice(start);\n  const rest = items.slice(0, end - items.length);\n  return [...first, ...rest];\n};\n\n/** Egyszerű seeded hash - determinisztikus shuffle-hez */\nfunction seededHash(str, seed) {\n  let h = seed;\n  const s = String(str);\n  for (let i = 0; i < s.length; i++) {\n    h = (h * 31 + s.charCodeAt(i)) >>> 0;\n  }\n  return h / 4294967296;\n}\n\n/** Kedvencek: személyre szabott (getPersonalizedRecommendations), liked + hasonlók, excludeIds */\nfunction buildFavoritesPool(products, seed, excludeIds = []) {\n  if (!products.length) return [];\n  const exclude = new Set(excludeIds);\n  const likedIds = getLikedProducts();\n  const viewed = getViewedProducts(40);\n  const viewedIds = new Set(viewed.map((p) => p.id));\n  const ids = new Set();\n  const result = [];\n  const inStock = (arr) => arr.filter((p) => (p.inStock ?? p.in_stock ?? true) && !exclude.has(p.id) && !ids.has(p.id));\n  const addUnique = (arr) => {\n    arr.forEach((p) => {\n      if (p?.id && !ids.has(p.id) && !exclude.has(p.id)) {\n        ids.add(p.id);\n        result.push(p);\n      }\n    });\n  };\n  addUnique(inStock(products.filter((p) => likedIds.includes(p.id))));\n  viewed.forEach((p) => {\n    const full = products.find((x) => x.id === p.id);\n    if (full && !ids.has(full.id)) addUnique([full]);\n  });\n  viewed.slice(0, 6).forEach((p) => {\n    const full = products.find((x) => x.id === p.id);\n    if (full && full.id) {\n      const similar = getSimilarProducts(full, products, 10);\n      addUnique(inStock(similar));\n    }\n  });\n  const personalized = getPersonalizedRecommendations(products, POOL_SIZE);\n  addUnique(inStock(personalized));\n  const rest = products.filter((p) => !ids.has(p.id) && !exclude.has(p.id) && (p.inStock ?? p.in_stock ?? true));\n  const withSale = rest.filter((p) => p.salePrice && p.price > p.salePrice);\n  const withoutSale = rest.filter((p) => !(p.salePrice && p.price > p.salePrice));\n  const restCombined = [...withSale, ...withoutSale];\n  const byCategory = new Map();\n  restCombined.forEach((p) => {\n    const cat = (p.category || '').split('>')[0] || 'other';\n    if (!byCategory.has(cat)) byCategory.set(cat, []);\n    byCategory.get(cat).push(p);\n  });\n  const restSorted = [];\n  const catArrays = Array.from(byCategory.values());\n  let idx = 0;\n  while (restSorted.length < restCombined.length) {\n    for (const arr of catArrays) {\n      if (idx < arr.length) restSorted.push(arr[idx]);\n    }\n    idx++;\n  }\n  restSorted.sort((a, b) => {\n    const ha = seededHash(String(a.id), seed);\n    const hb = seededHash(String(b.id), seed);\n    return ha - hb;\n  });\n  addUnique(restSorted);\n  const final = result.slice(0, POOL_SIZE);\n  return final.sort((a, b) => {\n    const ha = seededHash(String(a.id), seed + 1);\n    const hb = seededHash(String(b.id), seed + 1);\n    return ha - hb;\n  });\n}\n\n/** Friss: updated_at DESC, kategória-szerinti változatosság, max POOL_SIZE */\nfunction buildNewArrivalsPool(products) {\n  if (!products.length) return [];\n  const inStock = products.filter((p) => p.inStock ?? p.in_stock ?? true);\n  const byCategory = new Map();\n  inStock.forEach((p) => {\n    const cat = (p.category || '').split('>')[0] || 'other';\n    if (!byCategory.has(cat)) byCategory.set(cat, []);\n    byCategory.get(cat).push(p);\n  });\n  const sortByDate = (a, b) => {\n    const timeA = toTimestamp(a.updated_at || a.updatedAt || a.created_at || a.createdAt || a.last_synced_at);\n    const timeB = toTimestamp(b.updated_at || b.updatedAt || b.created_at || b.createdAt || b.last_synced_at);\n    if (timeA !== timeB) return timeB - timeA;\n    const idA = typeof a.id === 'number' ? a.id : parseInt(String(a.id).replace(/\\D/g, ''), 10) || 0;\n    const idB = typeof b.id === 'number' ? b.id : parseInt(String(b.id).replace(/\\D/g, ''), 10) || 0;\n    return idB - idA;\n  };\n  Array.from(byCategory.values()).forEach((arr) => arr.sort(sortByDate));\n  const result = [];\n  const catArrays = Array.from(byCategory.values());\n  let idx = 0;\n  while (result.length < POOL_SIZE) {\n    let added = 0;\n    for (const arr of catArrays) {\n      if (idx < arr.length && result.length < POOL_SIZE) {\n        result.push(arr[idx]);\n        added++;\n      }\n    }\n    if (added === 0) break;\n    idx++;\n  }\n  return result;\n}\n\n/** Popular: getPersonalizedRecommendations blend + liked/viewed, akciós elöl, excludeIds */\nfunction buildPopularPool(products, excludeIds = []) {\n  if (!products.length) return [];\n  const exclude = new Set(excludeIds);\n  const inStock = products.filter((p) => (p.inStock ?? p.in_stock ?? true) && !exclude.has(p.id));\n  const likedIds = getLikedProducts();\n  const viewed = getViewedProducts(50);\n  const viewedIds = viewed.map((p) => p.id);\n  const signals = getPreferenceSignals();\n  const personalized = getPersonalizedRecommendations(inStock, Math.floor(POOL_SIZE * 0.5));\n  const withDiscount = [...inStock]\n    .filter((p) => p.salePrice && p.price > p.salePrice)\n    .sort((a, b) => (b.price - (b.salePrice || 0)) - (a.price - (a.salePrice || 0)));\n  const ids = new Set(withDiscount.map((p) => p.id));\n  const rest = inStock.filter((p) => !ids.has(p.id));\n  const restByCat = new Map();\n  rest.forEach((p) => {\n    const cat = (p.category || '').split('>')[0] || 'other';\n    if (!restByCat.has(cat)) restByCat.set(cat, []);\n    restByCat.get(cat).push(p);\n  });\n  const categoryParts = (p) =>\n    (p.category || '')\n      .split('>')\n      .map((c) => c.trim().toLowerCase())\n      .filter(Boolean);\n  const scoreSort = (a, b) => {\n    const stockA = getStockLevel(a) ?? 0;\n    const stockB = getStockLevel(b) ?? 0;\n    let scoreA = (likedIds.includes(a.id) ? 10 : 0) + (viewedIds.includes(a.id) ? 5 : 0) + Math.min(stockA, 20) * 0.1;\n    let scoreB = (likedIds.includes(b.id) ? 10 : 0) + (viewedIds.includes(b.id) ? 5 : 0) + Math.min(stockB, 20) * 0.1;\n    categoryParts(a).forEach((cat) => { scoreA += (signals.categories?.[cat] || 0) * 0.5; });\n    categoryParts(b).forEach((cat) => { scoreB += (signals.categories?.[cat] || 0) * 0.5; });\n    if (personalized.some((p) => p.id === a.id)) scoreA += 3;\n    if (personalized.some((p) => p.id === b.id)) scoreB += 3;\n    return scoreB - scoreA;\n  };\n  Array.from(restByCat.values()).forEach((arr) => arr.sort(scoreSort));\n  const restInterleaved = [];\n  const catArrs = Array.from(restByCat.values());\n  let i = 0;\n  while (restInterleaved.length < rest.length) {\n    let added = 0;\n    for (const arr of catArrs) {\n      if (i < arr.length) { restInterleaved.push(arr[i]); added++; }\n    }\n    if (added === 0) break;\n    i++;\n  }\n  return [...withDiscount, ...restInterleaved].slice(0, POOL_SIZE);\n}\n\nconst WORLDS = [\n  {\n    id: 'favorites',\n    title: 'Vásárlóink kedvencei',\n    subtitle: 'A legjobbra értékelt és legtöbbet választott bútorok',\n    Icon: Heart,\n    accentClass: 'from-pink-500 to-rose-600',\n    eyebrow: 'Közösségi kedvencek',\n    badge: 'Közönségkedvenc',\n    className: 'border border-rose-100 shadow-sm section-header-hero section-header-hero--favorites',\n    tone: 'favorites',\n    sectionId: 'customer-favorites',\n    metaLabel: 'Összesen',\n  },\n  {\n    id: 'new',\n    title: 'Friss beérkezés',\n    subtitle: 'A legújabb termékeink, folyamatosan frissítve',\n    Icon: Package,\n    accentClass: 'from-violet-500 to-purple-600',\n    eyebrow: 'Újdonság',\n    badge: 'Újdonságok',\n    className: 'border border-violet-100 shadow-sm section-header-hero section-header-hero--new',\n    tone: 'new',\n    sectionId: 'new-arrivals',\n    metaLabel: 'Összesen',\n  },\n  {\n    id: 'popular',\n    title: 'Legnépszerűbb',\n    subtitle: 'A vásárlók kedvencei és a legjobb ajánlatok',\n    Icon: TrendingUp,\n    accentClass: 'from-amber-500 to-orange-600',\n    eyebrow: 'Felfedezés',\n    badge: null,\n    className: 'border border-amber-100 shadow-sm section-header-hero section-header-hero--popular',\n    tone: 'popular',\n    sectionId: 'most-popular',\n    metaLabel: 'Raktáron',\n  },\n];\n\nexport default function ProductWorldsSection({\n  products = [],\n  onProductClick,\n  onToggleWishlist,\n  wishlist = [],\n  onViewAll,\n  onAddToCart,\n  contextLabel = '',\n  rotationTick,\n}) {\n  const [activeWorld, setActiveWorld] = useState('favorites');\n  const [favoritesSeed, setFavoritesSeed] = useState(() => Math.floor(Date.now() / 10000));\n  const [favoritesPage, setFavoritesPage] = useState(0);\n  const [newPage, setNewPage] = useState(0);\n  const [popularPage, setPopularPage] = useState(0);\n  const [popularPeriod, setPopularPeriod] = useState('weekly');\n  const [isInteracting, setIsInteracting] = useState(false);\n  const [isInView, setIsInView] = useState(true);\n  const sectionRef = useRef(null);\n  const tabSwipeRef = useRef(null);\n  const tabSwipeStartX = useRef(0);\n\n  const handleTabSwipeStart = (e) => {\n    tabSwipeStartX.current = e.touches?.[0]?.clientX ?? 0;\n  };\n\n  const handleTabSwipeEnd = (e) => {\n    const endX = e.changedTouches?.[0]?.clientX ?? 0;\n    const diff = tabSwipeStartX.current - endX;\n    if (Math.abs(diff) > 60) {\n      const idx = WORLDS.findIndex((w) => w.id === activeWorld);\n      if (diff > 0 && idx < WORLDS.length - 1) setActiveWorld(WORLDS[idx + 1].id);\n      else if (diff < 0 && idx > 0) setActiveWorld(WORLDS[idx - 1].id);\n    }\n  };\n\n  const newArrivalsPool = useMemo(() => buildNewArrivalsPool(products), [products]);\n  const newExcludeIds = useMemo(\n    () => newArrivalsPool.slice(0, DEDUPE_EXCLUDE_NEW).map((p) => p.id),\n    [newArrivalsPool]\n  );\n  const popularFull = useMemo(\n    () => buildPopularPool(products, newExcludeIds),\n    [products, newExcludeIds]\n  );\n  const popularExcludeIds = useMemo(\n    () => popularFull.slice(0, DEDUPE_EXCLUDE_POPULAR).map((p) => p.id),\n    [popularFull]\n  );\n  const favoritesExcludeIds = useMemo(\n    () => [...newExcludeIds, ...popularExcludeIds],\n    [newExcludeIds, popularExcludeIds]\n  );\n  const favoritesPool = useMemo(\n    () => buildFavoritesPool(products, favoritesSeed, favoritesExcludeIds),\n    [products, favoritesSeed, favoritesExcludeIds]\n  );\n  const popularWeekly = useMemo(() => popularFull.slice(0, Math.floor(POOL_SIZE / 2)), [popularFull]);\n  const popularMonthly = useMemo(\n    () =>\n      popularFull.slice(Math.floor(POOL_SIZE / 2)).length > 0\n        ? popularFull.slice(Math.floor(POOL_SIZE / 2))\n        : popularFull,\n    [popularFull]\n  );\n  const popularPool = popularPeriod === 'weekly' ? popularWeekly : popularMonthly;\n\n  const favoritesVisible = useMemo(() => {\n    const start = (favoritesPage * PAGE_SIZE) % Math.max(1, favoritesPool.length);\n    return sliceWrap(favoritesPool, start, PAGE_SIZE);\n  }, [favoritesPool, favoritesPage]);\n\n  useEffect(() => {\n    setFavoritesPage(0);\n  }, [favoritesSeed]);\n\n  const newVisible = useMemo(() => {\n    const start = (newPage * PAGE_SIZE) % Math.max(1, newArrivalsPool.length);\n    return sliceWrap(newArrivalsPool, start, PAGE_SIZE);\n  }, [newArrivalsPool, newPage]);\n\n  const popularVisible = useMemo(() => {\n    const start = (popularPage * PAGE_SIZE) % Math.max(1, popularPool.length);\n    return sliceWrap(popularPool, start, PAGE_SIZE);\n  }, [popularPool, popularPage]);\n\n  const saleCount = useMemo(\n    () => popularFull.filter((p) => p.salePrice && p.price > p.salePrice).length,\n    [popularFull]\n  );\n\n  useEffect(() => {\n    trackSectionEvent('product-worlds', 'section_impression');\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === 'undefined' || !('IntersectionObserver' in window)) return;\n    if (!sectionRef.current || !(sectionRef.current instanceof Element)) return;\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsInView(entry.isIntersecting),\n      { threshold: 0.15 }\n    );\n    try {\n      observer.observe(sectionRef.current);\n    } catch {\n      return;\n    }\n    return () => observer.disconnect();\n  }, []);\n\n  const currentWorld = WORLDS.find((w) => w.id === activeWorld);\n  const visibleProducts =\n    activeWorld === 'favorites'\n      ? favoritesVisible\n      : activeWorld === 'new'\n        ? newVisible\n        : popularVisible;\n  const poolLength =\n    activeWorld === 'favorites'\n      ? favoritesPool.length\n      : activeWorld === 'new'\n        ? newArrivalsPool.length\n        : popularPool.length;\n  const totalPool =\n    activeWorld === 'favorites'\n      ? favoritesPool.length\n      : activeWorld === 'new'\n        ? newArrivalsPool.length\n        : popularFull.length;\n\n  if (products.length === 0) return null;\n\n  const renderActions = () => {\n    if (activeWorld === 'favorites') {\n      return (\n        <button\n          type=\"button\"\n          onClick={() => setFavoritesSeed((s) => s + 1)}\n          className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-rose-700 bg-rose-50 border border-rose-100 hover:bg-rose-100 transition-colors text-sm font-semibold min-h-[44px]\"\n        >\n          <RefreshCw className=\"w-4 h-4\" />\n          Frissítem\n        </button>\n      );\n    }\n    if (activeWorld === 'new') {\n      return (\n        <>\n          <button\n            type=\"button\"\n            onClick={() => setNewPage((p) => p + 1)}\n            className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-violet-700 bg-violet-50 border border-violet-100 hover:bg-violet-100 transition-colors text-sm font-semibold min-h-[44px]\"\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            Következő\n          </button>\n          {onViewAll && (\n            <button\n              type=\"button\"\n              onClick={onViewAll}\n              className=\"inline-flex items-center gap-2 text-violet-600 font-semibold hover:text-violet-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400 rounded-lg px-3 py-2 min-h-[44px]\"\n            >\n              Összes megtekintése <ArrowRight className=\"w-4 h-4\" />\n            </button>\n          )}\n        </>\n      );\n    }\n    return (\n      <>\n        <div className=\"inline-flex items-center rounded-full bg-white border border-gray-100 shadow-sm p-1\">\n          {[\n            { id: 'weekly', label: 'Heti kedvencek' },\n            { id: 'monthly', label: 'Havi toplista' },\n          ].map((item) => (\n            <button\n              key={item.id}\n              type=\"button\"\n              onClick={() => setPopularPeriod(item.id)}\n              className={`px-3 py-1.5 rounded-full text-xs font-semibold transition-colors min-h-[36px] ${\n                popularPeriod === item.id\n                  ? 'bg-amber-500 text-white'\n                  : 'text-gray-600 hover:bg-gray-100'\n              }`}\n            >\n              {item.label}\n            </button>\n          ))}\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => setPopularPage((p) => p + 1)}\n          className=\"inline-flex items-center gap-2 px-3 py-2 rounded-lg text-amber-700 bg-amber-50 border border-amber-100 hover:bg-amber-100 transition-colors text-sm font-semibold min-h-[44px]\"\n        >\n          <RefreshCw className=\"w-4 h-4\" />\n          Új válogatás\n        </button>\n        {onViewAll && (\n          <button\n            type=\"button\"\n            onClick={onViewAll}\n            className=\"inline-flex items-center gap-2 text-primary-600 font-semibold hover:text-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 rounded-lg px-3 py-2 min-h-[44px]\"\n          >\n            Összes megtekintése <ArrowRight className=\"w-4 h-4\" />\n          </button>\n        )}\n      </>\n    );\n  };\n\n  const metaText =\n    activeWorld === 'popular'\n      ? `Raktáron: ${totalPool.toLocaleString('hu-HU')} • Összesen: ${popularFull.length.toLocaleString('hu-HU')}`\n      : `${currentWorld.metaLabel}: ${totalPool.toLocaleString('hu-HU')} termék`;\n\n  const badgeText =\n    activeWorld === 'popular'\n      ? saleCount > 0\n        ? `${saleCount} akciós termék`\n        : 'Prémium válogatás'\n      : currentWorld.badge;\n\n  const sectionBgClass = {\n    favorites: 'bg-gradient-to-br from-rose-100/60 via-white to-pink-100/50',\n    new: 'bg-gradient-to-br from-violet-100/50 via-white to-purple-100/40',\n    popular: 'bg-gradient-to-br from-amber-100/60 via-white to-orange-100/50',\n  }[activeWorld];\n\n  return (\n    <section\n      ref={sectionRef}\n      className={`section-shell section-world section-world--${activeWorld} py-12 sm:py-14 lg:py-20 overflow-hidden w-full transition-colors duration-500 ${sectionBgClass}`}\n      aria-labelledby={`${activeWorld}-heading`}\n      aria-label=\"Termék világok\"\n      role=\"region\"\n      data-section=\"product-worlds\"\n    >\n      <div className=\"w-full max-w-[2000px] mx-auto px-4 sm:px-6 lg:px-10 xl:px-16\">\n        {/* Swipe zone: tab bar + hero – carouselen kívül mindenhol működik */}\n        <div\n          ref={tabSwipeRef}\n          onTouchStart={handleTabSwipeStart}\n          onTouchEnd={handleTabSwipeEnd}\n          className=\"touch-pan-y\"\n        >\n        {/* Tab bar – rövid cím mobilon, swipe jelzés */}\n        <div\n          className=\"flex justify-center mb-6 sm:mb-8 lg:mb-12 px-2 sm:px-4\"\n          role=\"tablist\"\n          aria-label=\"Válassz világot\"\n        >\n          <div className=\"flex w-full max-w-2xl sm:w-auto sm:inline-flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\n            <div className=\"flex flex-1 sm:flex-initial rounded-2xl bg-white/95 backdrop-blur-sm border-2 border-gray-200/80 shadow-xl shadow-gray-300/40 p-2 sm:p-2.5 gap-2\">\n              {WORLDS.map((w) => (\n                <button\n                  key={w.id}\n                  type=\"button\"\n                  role=\"tab\"\n                  aria-selected={activeWorld === w.id}\n                  aria-controls={`panel-${w.id}`}\n                  id={`tab-${w.id}`}\n                  onClick={() => setActiveWorld(w.id)}\n                  className={`flex-1 sm:flex-initial inline-flex items-center justify-center gap-2 px-4 sm:px-6 lg:px-8 py-3 sm:py-3.5 rounded-xl text-sm sm:text-base font-bold transition-all duration-300 min-h-[48px] sm:min-h-[52px] whitespace-nowrap ${\n                    activeWorld === w.id\n                      ? `bg-gradient-to-r ${w.accentClass} text-white shadow-lg`\n                      : 'text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  <w.Icon className=\"w-5 h-5 sm:w-6 sm:h-6 shrink-0\" aria-hidden />\n                  <span className=\"truncate\">\n                    {w.id === 'favorites' ? 'Kedvencek' : w.id === 'new' ? 'Friss' : (\n                      <>\n                        <span className=\"sm:hidden\">Népszerű</span>\n                        <span className=\"hidden sm:inline\">Legnépszerűbb</span>\n                      </>\n                    )}\n                  </span>\n                </button>\n              ))}\n            </div>\n            {/* Swipe jelzés – csak mobilon */}\n            <div className=\"sm:hidden flex items-center justify-center gap-1.5 py-2 text-gray-500 text-xs font-medium\">\n              <ChevronsLeftRight className=\"w-4 h-4\" aria-hidden />\n              <span>Pörgethető</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Hero fejléc – full-bleed, dramatikus, erősebb színek (swipe zone része) */}\n        <div className={`relative overflow-hidden px-4 sm:px-6 lg:px-10 py-8 sm:py-10 lg:py-14 rounded-2xl lg:rounded-3xl border-2 ${currentWorld.className} transition-all duration-500`}>\n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/85 via-white/60 to-transparent pointer-events-none\" />\n          {/* WoW: erősebb dekoratív gradient a sarkokban */}\n          <div className={`absolute -top-12 -right-12 w-48 h-48 sm:w-64 sm:h-64 rounded-full bg-gradient-to-br ${currentWorld.accentClass} opacity-[0.12] blur-3xl pointer-events-none`} aria-hidden />\n          <div className={`absolute -bottom-8 -left-8 w-32 h-32 sm:w-40 sm:h-40 rounded-full bg-gradient-to-tr ${currentWorld.accentClass} opacity-[0.08] blur-2xl pointer-events-none`} aria-hidden />\n          <div className=\"relative z-10\">\n            <div className=\"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4 sm:gap-6\">\n              <div className=\"space-y-3 sm:space-y-4 min-w-0\">\n                <span className=\"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-white/95 backdrop-blur border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-black tracking-wide shadow-md uppercase\">\n                  <span className={`w-2 h-2 sm:w-2.5 sm:h-2.5 rounded-full bg-gradient-to-r ${currentWorld.accentClass} shrink-0`} />\n                  <span className=\"truncate\">{currentWorld.eyebrow}</span>\n                </span>\n                <h2\n                  id={`${activeWorld}-heading`}\n                  className=\"text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-black leading-[1.15] tracking-tight text-gray-900 break-words\"\n                >\n                  {currentWorld.title}\n                </h2>\n                <p className=\"text-base sm:text-lg lg:text-xl xl:text-2xl text-gray-600 max-w-2xl font-semibold\">\n                  {currentWorld.subtitle}\n                </p>\n                <div className=\"flex flex-wrap items-center gap-2 sm:gap-3 pt-1 sm:pt-2\">\n                  {badgeText && (\n                    <span className=\"inline-flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm\">\n                      <currentWorld.Icon className=\"w-4 h-4 sm:w-5 sm:h-5 opacity-80 shrink-0\" />\n                      {badgeText}\n                    </span>\n                  )}\n                  {contextLabel && (\n                    <span className=\"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl bg-white/95 border-2 border-gray-200/90 text-gray-800 text-xs sm:text-sm font-bold shadow-sm max-w-[160px] sm:max-w-none truncate\">\n                      {contextLabel}\n                    </span>\n                  )}\n                  <span className=\"text-xs sm:text-sm font-medium text-gray-500 truncate\">{metaText}</span>\n                </div>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2 shrink-0\">{renderActions()}</div>\n            </div>\n          </div>\n        </div>\n        </div>\n\n        <div\n          id={`panel-${activeWorld}`}\n          role=\"tabpanel\"\n          aria-labelledby={`tab-${activeWorld}`}\n          className=\"product-worlds-content mt-8 lg:mt-10 px-0 sm:px-2 transition-opacity duration-300 touch-pan-y\"\n          key={activeWorld}\n        >\n            {visibleProducts.length > 0 ? (\n              <ProductCarousel\n                key={`${activeWorld}-${activeWorld === 'favorites' ? favoritesSeed : activeWorld === 'new' ? newPage : popularPage}`}\n                className=\"mt-2 -mx-4 sm:mx-0 pl-4 sm:pl-0 pr-4 sm:pr-0\"\n                autoScroll={false}\n                onInteractionChange={setIsInteracting}\n                cardSize=\"large\"\n                desktopColumns={6}\n              >\n                {visibleProducts.map((product, index) => {\n                  const stockLevel = getStockLevel(product);\n                  const highlightBadge =\n                    stockLevel !== null && stockLevel <= 3 ? `Utolsó ${stockLevel} db` : '';\n                  return (\n                    <div\n                      key={product.id}\n                      className=\"relative overflow-hidden rounded-xl transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl ring-1 ring-gray-200/80 hover:ring-gray-300\"\n                    >\n                      <EnhancedProductCard\n                        product={product}\n                        onToggleWishlist={onToggleWishlist}\n                        isWishlisted={wishlist.includes(product.id)}\n                        onQuickView={onProductClick}\n                        onAddToCart={onAddToCart || (() => {})}\n                        index={index}\n                        highlightBadge={highlightBadge}\n                        sectionId={currentWorld.sectionId}\n                        showFeedback\n                        size=\"default\"\n                        tone={currentWorld.tone}\n                        accentClass={currentWorld.accentClass}\n                        skipScrollAnimation\n                      />\n                    </div>\n                  );\n                })}\n              </ProductCarousel>\n            ) : (\n              <div className=\"text-center py-12 bg-white rounded-2xl shadow-inner\">\n                <currentWorld.Icon className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n                <p className=\"text-gray-500\">Nincs elég adat</p>\n                <p className=\"text-gray-400 text-sm\">Térj vissza később vagy frissítsd az oldalt.</p>\n              </div>\n            )}\n\n            {visibleProducts.length > 0 && (\n              <div className=\"mt-6 pt-4 border-t border-gray-100 flex flex-wrap items-center justify-center gap-3 text-xs text-gray-500\">\n                {activeWorld === 'favorites' && (\n                  <span>Kedvenceid és megtekintéseid alapján személyre szabott válogatás.</span>\n                )}\n                {activeWorld === 'new' && (\n                  <span>Legfrissebb termékek a backend adataiból.</span>\n                )}\n                {activeWorld === 'popular' && (\n                  <span>Kedvelések, megtekintések és akciós ajánlatok alapján.</span>\n                )}\n              </div>\n            )}\n        </div>\n      </div>\n    </section>\n  );\n}\n"],"names":["POOL_SIZE","PAGE_SIZE","DEDUPE_EXCLUDE_NEW","DEDUPE_EXCLUDE_POPULAR","toTimestamp","value","t","sliceWrap","items","start","size","end","first","rest","seededHash","str","seed","s","i","buildFavoritesPool","products","excludeIds","exclude","likedIds","getLikedProducts","viewed","getViewedProducts","p","ids","result","inStock","arr","addUnique","full","x","similar","getSimilarProducts","personalized","getPersonalizedRecommendations","withSale","withoutSale","restCombined","byCategory","cat","restSorted","catArrays","idx","a","b","ha","hb","buildNewArrivalsPool","sortByDate","timeA","timeB","idA","added","buildPopularPool","viewedIds","signals","getPreferenceSignals","withDiscount","restByCat","categoryParts","c","scoreSort","stockA","getStockLevel","stockB","scoreA","scoreB","_a","restInterleaved","catArrs","WORLDS","Heart","Package","TrendingUp","ProductWorldsSection","onProductClick","onToggleWishlist","wishlist","onViewAll","onAddToCart","contextLabel","rotationTick","activeWorld","setActiveWorld","useState","favoritesSeed","setFavoritesSeed","favoritesPage","setFavoritesPage","newPage","setNewPage","popularPage","setPopularPage","popularPeriod","setPopularPeriod","isInteracting","setIsInteracting","isInView","setIsInView","sectionRef","useRef","tabSwipeRef","tabSwipeStartX","handleTabSwipeStart","e","_b","handleTabSwipeEnd","endX","diff","w","newArrivalsPool","useMemo","newExcludeIds","popularFull","popularExcludeIds","favoritesExcludeIds","favoritesPool","popularWeekly","popularMonthly","popularPool","favoritesVisible","useEffect","newVisible","popularVisible","saleCount","trackSectionEvent","observer","entry","currentWorld","visibleProducts","totalPool","renderActions","jsxs","jsx","RefreshCw","Fragment","ArrowRight","item","metaText","badgeText","sectionBgClass","ChevronsLeftRight","ProductCarousel","product","index","stockLevel","highlightBadge","EnhancedProductCard"],"mappings":"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"}