{"version":3,"file":"AIChatAssistant.js","sources":["../../src/components/ai/AIChatAssistant.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { MessageCircle, X, Send, Loader2, Sparkles, User, Bot, AlertCircle, ThumbsUp, ThumbsDown, Search, Package, Tag, TrendingUp, Filter, Zap, Star, ShoppingBag } from 'lucide-react';\nimport { generateText } from '../../services/geminiService';\nimport { smartSearch, parseSearchIntent, getProactiveSuggestions } from '../../services/aiSearchService';\nimport { fetchUnasProducts } from '../../services/unasApi';\nimport { \n  getPersonalizedContext, \n  trackAIFeedback, \n  getViewedProducts, \n  trackSearch,\n  saveChatContext,\n  getChatContext,\n  getSearchHistory,\n  getTopCategories,\n  getStyleDNA\n} from '../../services/userPreferencesService';\n\n/**\n * AIChatAssistant - Vil√°gsz√≠nvonal√∫ AI Chat asszisztens\n * - Szuperokos keres√©s a k√∂zponti aiSearchService-b≈ël\n * - Term√©szetes nyelv≈± meg√©rt√©s\n * - Teljes term√©kkatal√≥gus ismerete\n * - Szem√©lyre szabott v√°laszok\n * - Proakt√≠v aj√°nl√°sok\n */\nconst AIChatAssistant = ({ products, catalogProducts, onShowProducts, serverSearchMode = false, totalProductsCount = 0, categoryHierarchy }) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef(null);\n  const inputRef = useRef(null);\n  const messageIdRef = useRef(0);\n\n  // Teljes katal√≥gus elemz√©s - r√©szletes statisztik√°k\n  const catalogSource = catalogProducts && catalogProducts.length > 0 ? catalogProducts : products;\n  const catalogStats = useMemo(() => {\n    if (!catalogSource || catalogSource.length === 0) {\n      const fallbackCategories = (categoryHierarchy?.mainCategories || [])\n        .slice(0, 15)\n        .map((c) => ({\n          name: c.name,\n          count: Number(c.productCount || 0),\n          subcategories: Array.isArray(c.children) ? c.children.slice(0, 5).map(ch => ch.name) : [],\n          priceRange: { min: 0, max: 0 }\n        }));\n      return {\n        total: totalProductsCount || 0,\n        categories: fallbackCategories,\n        priceRange: { min: 0, max: 0 },\n        priceDistribution: { under50k: 0, under100k: 0, under200k: 0, over200k: 0 },\n        onSaleCount: 0,\n        availableStyles: [],\n        availableColors: []\n      };\n    }\n\n    const categories = {};\n    const mainCategories = {};\n    const priceRanges = { under50k: 0, under100k: 0, under200k: 0, over200k: 0 };\n    let minPrice = Infinity;\n    let maxPrice = 0;\n    let onSaleCount = 0;\n    const colors = new Set();\n    const styles = new Set();\n\n    catalogSource.forEach(p => {\n      // Kateg√≥ria feldolgoz√°s\n      const cat = p.category || 'Egy√©b';\n      categories[cat] = (categories[cat] || 0) + 1;\n      \n      const mainCat = cat.split(' > ')[0];\n      if (!mainCategories[mainCat]) {\n        mainCategories[mainCat] = { count: 0, subcategories: new Set(), priceRange: { min: Infinity, max: 0 } };\n      }\n      mainCategories[mainCat].count++;\n      if (cat.includes(' > ')) {\n        mainCategories[mainCat].subcategories.add(cat.split(' > ').slice(1).join(' > '));\n      }\n      \n      // √År feldolgoz√°s\n      const price = p.salePrice || p.price || 0;\n      if (price > 0) {\n        minPrice = Math.min(minPrice, price);\n        maxPrice = Math.max(maxPrice, price);\n        mainCategories[mainCat].priceRange.min = Math.min(mainCategories[mainCat].priceRange.min, price);\n        mainCategories[mainCat].priceRange.max = Math.max(mainCategories[mainCat].priceRange.max, price);\n        \n        if (price < 50000) priceRanges.under50k++;\n        else if (price < 100000) priceRanges.under100k++;\n        else if (price < 200000) priceRanges.under200k++;\n        else priceRanges.over200k++;\n      }\n      \n      // Akci√≥k sz√°mol√°sa\n      if (p.originalPrice && p.originalPrice > price) onSaleCount++;\n      \n      // St√≠lusok √©s sz√≠nek kinyer√©se a n√©vb≈ël\n      const name = (p.name || '').toLowerCase();\n      ['modern', 'skandin√°v', 'rusztikus', 'klasszikus', 'minimalista', 'vintage'].forEach(s => {\n        if (name.includes(s)) styles.add(s);\n      });\n      ['feh√©r', 'fekete', 'sz√ºrke', 'barna', 'b√©zs', 'k√©k', 'z√∂ld'].forEach(c => {\n        if (name.includes(c)) colors.add(c);\n      });\n    });\n\n    // Top kateg√≥ri√°k\n    const topCategories = Object.entries(mainCategories)\n      .sort((a, b) => b[1].count - a[1].count)\n      .slice(0, 15)\n      .map(([name, data]) => ({\n        name,\n        count: data.count,\n        subcategories: Array.from(data.subcategories).slice(0, 5),\n        priceRange: data.priceRange\n      }));\n\n    return {\n      total: catalogSource.length,\n      categories: topCategories,\n      priceRange: { min: minPrice, max: maxPrice },\n      priceDistribution: priceRanges,\n      onSaleCount,\n      availableStyles: Array.from(styles),\n      availableColors: Array.from(colors)\n    };\n  }, [catalogSource, totalProductsCount, categoryHierarchy]);\n\n  // Okos keres√©s a k√∂zponti aiSearchService-b≈ël\n  const performSmartSearch = useCallback(async (query, options = {}) => {\n    const { limit = 12 } = options;\n    const intent = parseSearchIntent(query);\n    if (serverSearchMode) {\n      try {\n        const data = await fetchUnasProducts({ search: query, limit, offset: 0, slim: false });\n        return { results: data.products || [], intent };\n      } catch {\n        return { results: [], intent };\n      }\n    }\n    if (!catalogSource || catalogSource.length === 0) return { results: [], intent };\n    return smartSearch(catalogSource, query, { limit, includeDebugInfo: false });\n  }, [catalogSource, serverSearchMode]);\n\n  // Kateg√≥ria alap√∫ aj√°nl√°sok\n  const getCategoryProducts = useCallback((categoryName, limit = 6) => {\n    if (!catalogSource) return [];\n    return catalogSource\n      .filter(p => (p.category || '').toLowerCase().includes(categoryName.toLowerCase()))\n      .sort((a, b) => (b.salePrice || b.price || 0) - (a.salePrice || a.price || 0))\n      .slice(0, limit);\n  }, [catalogSource]);\n\n  // Proakt√≠v javaslatok\n  const proactiveSuggestions = useMemo(() => {\n    return getProactiveSuggestions(catalogSource || []);\n  }, [catalogSource]);\n\n  const generateMessageId = () => {\n    messageIdRef.current += 1;\n    return `msg_${Date.now()}_${messageIdRef.current}`;\n  };\n\n  // Inicializ√°l√°s - Szuper szem√©lyre szabott √ºdv√∂zl√©s\n  useEffect(() => {\n    const savedContext = getChatContext();\n    const recentlyViewed = getViewedProducts(3);\n    const topCats = getTopCategories(2);\n    const styleDNA = getStyleDNA();\n    \n    let welcomeMessage = '';\n    let welcomeProducts = [];\n    \n    if (recentlyViewed.length > 0) {\n      // Visszat√©r≈ë l√°togat√≥ - szem√©lyes √ºdv√∂zl√©s\n      const lastProduct = recentlyViewed[0];\n      welcomeMessage = `Szia √∫jra! üëã\\n\\nL√°tom, a \"${lastProduct.name}\" √©rdekelt.\\n`;\n      \n      if (lastProduct.price) {\n        welcomeMessage += `üí° Hasonl√≥ √°rban (${Math.round(lastProduct.price/1000)}k Ft k√∂r√ºl) m√©g t√∂bb szuper darabot tudok mutatni!\\n\\n`;\n      }\n      \n      // Hasonl√≥ term√©kek el≈ëk√©sz√≠t√©se\n      const cat = lastProduct.category?.split(' > ')[0];\n      if (cat) {\n        welcomeProducts = getCategoryProducts(cat, 4).filter(p => p.id !== lastProduct.id);\n      }\n      \n      welcomeMessage += `üì¶ ${catalogStats?.total?.toLocaleString('hu-HU') || 0} term√©kb≈ël seg√≠tek kiv√°lasztani a T√ñK√âLETESET!`;\n      \n    } else if (styleDNA?.styleDNA) {\n      // Van st√≠lus profilja\n      welcomeMessage = `Szia! üëã A Marketly AI tan√°csad√≥ja vagyok.\\n\\n`;\n      welcomeMessage += `‚ú® L√°tom, a ${styleDNA.styleDNA} st√≠lust kedveled!\\n`;\n      welcomeMessage += `üì¶ ${catalogStats?.total?.toLocaleString('hu-HU') || 0} term√©k k√∂z√ºl pont a NEKED val√≥t keresem!\\n\\n`;\n      welcomeMessage += `üí¨ Mondd el, mit keresel, √©s m√°ris aj√°nlok!`;\n      \n    } else {\n      // √öj l√°togat√≥\n      welcomeMessage = `Szia! üëã A Marketly AI b√∫tortan√°csad√≥ja vagyok.\\n\\n`;\n      welcomeMessage += `üì¶ ${catalogStats?.total?.toLocaleString('hu-HU') || 0} term√©k k√∂z√ºl seg√≠tek v√°lasztani!\\n`;\n      welcomeMessage += `üí∞ √Årak: ${Math.round((catalogStats?.priceRange?.min || 0)/1000)}k - ${Math.round((catalogStats?.priceRange?.max || 0)/1000)}k Ft\\n`;\n      \n      if (catalogStats?.onSaleCount > 0) {\n        welcomeMessage += `üè∑Ô∏è ${catalogStats.onSaleCount} term√©k most AKCI√ìBAN!\\n\\n`;\n      }\n      \n      welcomeMessage += `üí¨ K√©rdezz b√°tran - pl. \"modern kanap√© 150 ezer alatt\"`;\n    }\n    \n    setMessages([{\n      id: generateMessageId(),\n      role: 'assistant',\n      content: welcomeMessage,\n      timestamp: new Date(),\n      products: welcomeProducts.length > 0 ? welcomeProducts : undefined\n    }]);\n  }, [catalogStats, getCategoryProducts]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n    }\n  }, [isOpen]);\n\n  const handleFeedback = (messageId, isPositive) => {\n    const message = messages.find(m => m.id === messageId);\n    if (!message) return;\n    \n    trackAIFeedback(messageId, isPositive, {\n      query: message.userQuery || '',\n      productCount: message.products?.length || 0,\n    });\n    \n    setMessages(prev => prev.map(m => \n      m.id === messageId ? { ...m, feedback: isPositive ? 'positive' : 'negative' } : m\n    ));\n  };\n\n  const handleProductClick = (product, allRecommended) => {\n    if (onShowProducts) {\n      onShowProducts(product, allRecommended);\n    }\n    setIsOpen(false);\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputValue.trim() || isLoading) return;\n\n    const userMessage = inputValue.trim();\n    setInputValue('');\n    trackSearch(userMessage);\n\n    const userMsgId = generateMessageId();\n    setMessages(prev => [...prev, {\n      id: userMsgId,\n      role: 'user',\n      content: userMessage,\n      timestamp: new Date()\n    }]);\n\n    setIsLoading(true);\n\n    let relevantProducts = [];\n    let searchIntent = null;\n    try {\n      // Szuperokos keres√©s az aiSearchService-b≈ël\n      const searchResult = await performSmartSearch(userMessage, { limit: 12 });\n      relevantProducts = searchResult.results || [];\n      searchIntent = searchResult.intent;\n      \n      // Szem√©lyre szabott kontextus\n      const personalContext = getPersonalizedContext();\n      const recentViewed = getViewedProducts(3);\n      const topCats = getTopCategories(3);\n      const styleDNA = getStyleDNA();\n      \n      // Besz√©lget√©s el≈ëzm√©nye\n      const conversationHistory = messages\n        .slice(-4)\n        .map(m => `${m.role === 'user' ? 'V√ÅS√ÅRL√ì' : 'TAN√ÅCSAD√ì'}: ${m.content.slice(0, 150)}`)\n        .join('\\n');\n\n      // Kateg√≥ria √∂sszefoglal√≥ az AI-nak\n      const categoryInfo = catalogStats?.categories\n        .slice(0, 10)\n        .map(c => `‚Ä¢ ${c.name}: ${c.count} db (${Math.round(c.priceRange.min/1000)}k - ${Math.round(c.priceRange.max/1000)}k Ft)`)\n        .join('\\n') || '';\n\n      // Tal√°lt term√©kek form√°z√°sa\n      const productList = relevantProducts.length > 0\n        ? relevantProducts.slice(0, 8).map(p => \n            `‚Ä¢ ${p.name} | ${(p.salePrice || p.price || 0).toLocaleString('hu-HU')} Ft | ${p.category?.split(' > ')[0] || 'Egy√©b'}${p.salePrice && p.salePrice < p.price ? ' [AKCI√ì!]' : ''}`\n          ).join('\\n')\n        : 'Nem tal√°ltam pontos egyez√©st, de tudok aj√°nlani hasonl√≥kat!';\n\n      // Kor√°bban n√©zett term√©kek\n      const viewedInfo = recentViewed.length > 0\n        ? `Kor√°bban n√©zett: ${recentViewed.map(p => p.name).join(', ')}`\n        : '';\n\n      // Keres√©si sz√°nd√©k elemz√©se az AI-nak\n      const intentInfo = searchIntent ? `\nFELISMERT SZ√ÅND√âK:\n- Term√©k t√≠pus: ${searchIntent.productTypes.join(', ') || 'nincs megadva'}\n- St√≠lus: ${searchIntent.styles.join(', ') || 'nincs megadva'}\n- Sz√≠n: ${searchIntent.colors.join(', ') || 'nincs megadva'}\n- Szoba: ${searchIntent.rooms.join(', ') || 'nincs megadva'}\n- √Årtartom√°ny: ${searchIntent.priceRange ? `${searchIntent.priceRange.min.toLocaleString()} - ${searchIntent.priceRange.max === Infinity ? '‚àû' : searchIntent.priceRange.max.toLocaleString()} Ft` : 'nincs megadva'}\n- Akci√≥t keres: ${searchIntent.isOnSale ? 'IGEN' : 'nem'}` : '';\n\n      // St√≠lus profil\n      const styleProfile = styleDNA?.styleDNA ? `St√≠lus preferencia: ${styleDNA.styleDNA}` : '';\n\n      const prompt = `Te a Marketly b√∫torwebshop LEGJOBB AI tan√°csad√≥ja vagy! A vil√°g legokosabb b√∫torszak√©rt≈ëje. Teljes k√≠n√°latot ismered.\n\n===== WEBSHOP KATAL√ìGUS =====\nüì¶ √ñsszes term√©k: ${catalogStats?.total?.toLocaleString('hu-HU') || 0} db\nüí∞ √Årkateg√≥ria: ${Math.round((catalogStats?.priceRange?.min || 0)/1000)}k - ${Math.round((catalogStats?.priceRange?.max || 0)/1000)}k Ft\nüè∑Ô∏è Akci√≥s term√©kek: ${catalogStats?.onSaleCount || 0} db\nüé® St√≠lusok: ${catalogStats?.availableStyles?.join(', ') || 'modern, skandin√°v, klasszikus'}\n\nTOP KATEG√ìRI√ÅK:\n${categoryInfo}\n\n===== V√ÅS√ÅRL√ì K√âRD√âSE =====\n\"${userMessage}\"\n${intentInfo}\n\n===== V√ÅS√ÅRL√ì PROFILJA =====\n${personalContext || '√öj l√°togat√≥'}\n${styleProfile}\n${viewedInfo}\nKedvelt kateg√≥ri√°k: ${topCats.join(', ') || 'm√©g nincs'}\n\n===== BESZ√âLGET√âS EL≈êZM√âNYE =====\n${conversationHistory || '√öj besz√©lget√©s'}\n\n===== TAL√ÅLT TERM√âKEK (${relevantProducts.length} db) =====\n${productList}\n\n===== V√ÅLASZOL√ÅSI SZAB√ÅLYOK =====\n1. ‚úÖ Magyarul, tegezve, BAR√ÅTS√ÅGOSAN √©s LELKESEN\n2. ‚úÖ Ha vannak term√©kek: KONKR√âTAN aj√°nlj 2-3 darabot N√âVVEL √©s √ÅRRAL\n3. ‚úÖ Ha dr√°g√°nak tal√°lja: mutass olcs√≥bb alternat√≠v√°t is\n4. ‚úÖ Adj PRO TIPPET (m√©ret, kombin√°ci√≥, karbantart√°s)\n5. ‚úÖ Ha akci√≥t keres: emeld ki a kedvezm√©nyeket!\n6. ‚úÖ MAX 4-5 mondat, L√âNYEGRE T√ñR≈êEN\n7. ‚úÖ Z√°rd: \"üëá Kattints a term√©kekre lent a r√©szletek√©rt!\"\n8. ‚ùå NE haszn√°lj markdown form√°z√°st (**bold** helyett CAPS)\n9. ‚ùå NE k√©rdezz vissza, AJ√ÅNLJ azonnal\n\nV√ÅLASZOLJ MOST a fenti szab√°lyok szerint:`;\n\n      let result = { success: false, text: '' };\n      try {\n        result = await generateText(prompt, { temperature: 0.7, maxTokens: 500 });\n      } catch (err) {\n        console.error('AI generateText error:', err);\n      }\n\n      const assistantMsgId = generateMessageId();\n\n      if (result.success && result.text) {\n        setMessages(prev => [...prev, {\n          id: assistantMsgId,\n          role: 'assistant',\n          content: result.text,\n          timestamp: new Date(),\n          products: relevantProducts.slice(0, 8),\n          userQuery: userMessage\n        }]);\n        \n        saveChatContext(`${userMessage.slice(0, 50)}... kerest√©l.`);\n      } else {\n        // Fallback v√°lasz jobb term√©kekkel\n        const fallbackProducts = relevantProducts.length > 0 \n          ? relevantProducts \n          : getCategoryProducts('kanap√©', 4);\n        const fallbackText = relevantProducts.length > 0\n          ? `Tal√°ltam ${relevantProducts.length} term√©ket! üëá N√©zd meg ≈ëket lent, √©s kattints a r√©szletek√©rt!`\n          : 'Jelenleg nem tudok konkr√©t term√©ket aj√°nlani, de b√∂ng√©szd a kateg√≥ri√°kat a men√ºben!';\n          \n        setMessages(prev => [...prev, {\n          id: assistantMsgId,\n          role: 'assistant',\n          content: fallbackText,\n          timestamp: new Date(),\n          products: fallbackProducts,\n          userQuery: userMessage,\n          isError: !relevantProducts.length\n        }]);\n      }\n\n    } catch (error) {\n      console.error('Chat hiba:', error);\n      const fallbackProducts = relevantProducts.length > 0 \n        ? relevantProducts \n        : getCategoryProducts('kanap√©', 4);\n      const fallbackText = relevantProducts.length > 0\n        ? `Tal√°ltam ${relevantProducts.length} term√©ket! üëá N√©zd meg ≈ëket lent, √©s kattints a r√©szletek√©rt!`\n        : 'Jelenleg nem tudok konkr√©t term√©ket aj√°nlani, de b√∂ng√©szd a kateg√≥ri√°kat a men√ºben!';\n      setMessages(prev => [...prev, {\n        id: generateMessageId(),\n        role: 'assistant',\n        content: fallbackText,\n        timestamp: new Date(),\n        products: fallbackProducts,\n        userQuery: userMessage,\n        isError: !relevantProducts.length\n      }]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Gyors k√©rd√©sek - szuperokos szem√©lyre szabott javaslatok\n  const quickSuggestions = useMemo(() => {\n    const suggestions = [];\n    \n    // Proakt√≠v javaslatok az aiSearchService-b≈ël\n    proactiveSuggestions.slice(0, 2).forEach(s => {\n      suggestions.push(s.text);\n    });\n    \n    // Szem√©lyre szabott a megtekintett term√©kekb≈ël\n    const viewed = getViewedProducts(2);\n    if (viewed.length > 0) {\n      const cat = viewed[0].category?.split(' > ')[0];\n      if (cat && !suggestions.some(s => s.includes(cat))) {\n        suggestions.push(`${cat} 100 ezer alatt`);\n      }\n    }\n    \n    // Keres√©si el≈ëzm√©nyek\n    const searches = getSearchHistory(2);\n    if (searches.length > 0 && searches[0].query && !suggestions.includes(searches[0].query)) {\n      suggestions.push(searches[0].query);\n    }\n\n    // Alap√©rtelmezett javaslatok (csak ha kell)\n    const defaults = [\n      'Modern kanap√© 150 ezer alatt',\n      'Skandin√°v st√≠lus√∫ b√∫torok',\n      'Akci√≥s term√©kek',\n      'H√°l√≥szoba berendez√©s',\n      '√âtkez≈ë b√∫torok'\n    ];\n    \n    defaults.forEach(d => {\n      if (suggestions.length < 5 && !suggestions.includes(d)) {\n        suggestions.push(d);\n      }\n    });\n    \n    return suggestions.slice(0, 5);\n  }, [proactiveSuggestions]);\n\n  const formatPrice = (price) => {\n    return (price || 0).toLocaleString('hu-HU') + ' Ft';\n  };\n\n  return (\n    <>\n      {/* Lebeg≈ë Chat Gomb */}\n      {!isOpen && (\n        <button\n          id=\"mkt-butorbolt-chat\"\n          onClick={() => setIsOpen(true)}\n          className=\"\n            fixed bottom-[calc(1.5rem+44px)] md:bottom-6 right-4 md:right-6 z-[100]\n            w-14 h-14 md:w-16 md:h-16 rounded-full\n            bg-gradient-to-br from-primary-500 to-secondary-700\n            text-white shadow-2xl\n            flex items-center justify-center\n            transition-all duration-300\n            hover:shadow-primary-500/50 hover:scale-110\n            group\n          \"\n          aria-label=\"AI Chat megnyit√°sa\"\n        >\n          <MessageCircle className=\"w-7 h-7\" />\n          <span className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-[10px] font-bold shadow-lg\">\n            AI\n          </span>\n          {/* Tooltip */}\n          <span className=\"absolute right-full mr-3 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none\">\n            AI Tan√°csad√≥\n          </span>\n        </button>\n      )}\n\n      {/* Chat Ablak */}\n      {isOpen && (\n        <div className=\"\n          fixed bottom-0 md:bottom-6 right-0 md:right-6 z-[9999]\n          w-full md:w-[440px] h-[100dvh] md:h-[650px] md:max-h-[85vh]\n          bg-white md:rounded-2xl shadow-2xl\n          flex flex-col overflow-hidden border-0 md:border border-gray-200\n        \">\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-primary-500 to-secondary-700 p-4 flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-11 h-11 rounded-full bg-white/20 flex items-center justify-center\">\n                <Sparkles className=\"w-6 h-6 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"text-white font-bold text-lg\">AI Tan√°csad√≥</h3>\n                <p className=\"text-white/80 text-xs flex items-center gap-1.5\">\n                  <span className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\" />\n                  {catalogStats?.total?.toLocaleString('hu-HU') || 0} term√©k ismerete\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={() => setIsOpen(false)}\n              className=\"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full\"\n              aria-label=\"Bez√°r√°s\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          {/* √úzenetek */}\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50 to-white\">\n            {messages.map((message) => (\n              <div key={message.id}>\n                <div className={`flex gap-3 ${message.role === 'user' ? 'flex-row-reverse' : ''}`}>\n                  <div className={`\n                    w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0 shadow-sm\n                    ${message.role === 'user' \n                      ? 'bg-primary-500' \n                      : message.isError \n                        ? 'bg-orange-500'\n                        : 'bg-gradient-to-br from-primary-500 to-secondary-700'\n                    }\n                  `}>\n                    {message.role === 'user' ? (\n                      <User className=\"w-5 h-5 text-white\" />\n                    ) : message.isError ? (\n                      <AlertCircle className=\"w-5 h-5 text-white\" />\n                    ) : (\n                      <Bot className=\"w-5 h-5 text-white\" />\n                    )}\n                  </div>\n\n                  <div className=\"max-w-[85%]\">\n                    <div className={`\n                      rounded-2xl p-3.5\n                      ${message.role === 'user'\n                        ? 'bg-primary-500 text-white rounded-tr-sm'\n                        : 'bg-white text-gray-800 rounded-tl-sm shadow-md border border-gray-100'\n                      }\n                    `}>\n                      <p className=\"text-sm whitespace-pre-wrap leading-relaxed\">{message.content}</p>\n                    </div>\n                    \n                    {/* Feedback */}\n                    {message.role === 'assistant' && !message.feedback && !message.isError && (\n                      <div className=\"flex items-center gap-1 mt-1.5 ml-1\">\n                        <button\n                          onClick={() => handleFeedback(message.id, true)}\n                          className=\"p-1.5 rounded-full hover:bg-green-100 text-gray-400 hover:text-green-600 transition-colors\"\n                          title=\"Hasznos volt\"\n                        >\n                          <ThumbsUp className=\"w-3.5 h-3.5\" />\n                        </button>\n                        <button\n                          onClick={() => handleFeedback(message.id, false)}\n                          className=\"p-1.5 rounded-full hover:bg-red-100 text-gray-400 hover:text-red-500 transition-colors\"\n                          title=\"Nem volt hasznos\"\n                        >\n                          <ThumbsDown className=\"w-3.5 h-3.5\" />\n                        </button>\n                      </div>\n                    )}\n                    \n                    {message.feedback && (\n                      <div className={`text-[10px] mt-1 ml-1 ${message.feedback === 'positive' ? 'text-green-600' : 'text-gray-400'}`}>\n                        {message.feedback === 'positive' ? 'üëç K√∂sz√∂nj√ºk!' : 'üëé Fejl≈ëd√ºnk'}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Term√©k k√°rty√°k - jav√≠tott megjelen√©s */}\n                {message.products && message.products.length > 0 && (\n                  <div className=\"ml-12 mt-3\">\n                    <p className=\"text-xs text-gray-500 mb-2 flex items-center gap-1.5 font-medium\">\n                      <Package className=\"w-3.5 h-3.5\" />\n                      {message.products.length} term√©k - kattints a megtekint√©shez:\n                    </p>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      {message.products.slice(0, 6).map((product) => (\n                        <button\n                          key={product.id}\n                          onClick={() => handleProductClick(product, message.products)}\n                          className=\"bg-white rounded-xl p-2.5 shadow-sm border border-gray-100 hover:shadow-lg hover:border-primary-300 hover:-translate-y-0.5 transition-all text-left group\"\n                        >\n                          <div className=\"aspect-square bg-gray-50 rounded-lg mb-2 overflow-hidden relative\">\n                            <img\n                              src={product.images?.[0] || product.image || 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'}\n                              alt={product.name}\n                              className=\"w-full h-full object-contain group-hover:scale-110 transition-transform duration-300\"\n                              loading=\"lazy\"\n                              onError={(e) => { e.target.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\"><rect fill=\"%23f3f4f6\" width=\"100\" height=\"100\"/></svg>'; }}\n                            />\n                            {product.salePrice && product.salePrice < product.price && (\n                              <span className=\"absolute top-1 left-1 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded\">\n                                -{Math.round((1 - product.salePrice/product.price) * 100)}%\n                              </span>\n                            )}\n                          </div>\n                          <p className=\"text-xs font-medium text-gray-800 line-clamp-2 leading-tight mb-1\">{product.name}</p>\n                          <p className=\"text-sm font-bold text-primary-600\">{formatPrice(product.salePrice || product.price)}</p>\n                        </button>\n                      ))}\n                    </div>\n                    {message.products.length > 6 && (\n                      <button\n                        onClick={() => handleProductClick(message.products[0], message.products)}\n                        className=\"w-full mt-2 py-2.5 text-sm text-primary-600 hover:text-primary-700 font-semibold bg-primary-50 rounded-xl hover:bg-primary-100 transition-colors\"\n                      >\n                        + {message.products.length - 6} tov√°bbi term√©k megtekint√©se ‚Üí\n                      </button>\n                    )}\n                  </div>\n                )}\n              </div>\n            ))}\n\n            {isLoading && (\n              <div className=\"flex gap-3\">\n                <div className=\"w-9 h-9 rounded-full bg-gradient-to-br from-primary-500 to-secondary-700 flex items-center justify-center shadow-sm\">\n                  <Bot className=\"w-5 h-5 text-white\" />\n                </div>\n                <div className=\"bg-white rounded-2xl rounded-tl-sm p-4 shadow-md border border-gray-100\">\n                  <div className=\"flex items-center gap-3\">\n                    <Loader2 className=\"w-5 h-5 text-primary-500 animate-spin\" />\n                    <span className=\"text-sm text-gray-600\">Keresem a legjobb aj√°nlatokat...</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div ref={messagesEndRef} />\n          </div>\n\n          {/* Gyors javaslatok */}\n          {messages.length <= 2 && (\n            <div className=\"p-3 bg-gray-50 border-t border-gray-100\">\n              <p className=\"text-xs text-gray-500 mb-2 flex items-center gap-1.5 font-medium\">\n                <TrendingUp className=\"w-3.5 h-3.5\" />\n                N√©pszer≈± keres√©sek:\n              </p>\n              <div className=\"flex flex-wrap gap-1.5\">\n                {quickSuggestions.map((suggestion, index) => (\n                  <button\n                    key={index}\n                    onClick={() => {\n                      setInputValue(suggestion);\n                      inputRef.current?.focus();\n                    }}\n                    className=\"px-3 py-1.5 text-xs bg-white text-gray-700 rounded-full hover:bg-primary-50 hover:text-primary-600 transition-colors border border-gray-200 hover:border-primary-300\"\n                  >\n                    {suggestion}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Input */}\n          <div className=\"p-4 bg-white border-t border-gray-200\">\n            <div className=\"flex gap-2\">\n              <input\n                ref={inputRef}\n                type=\"text\"\n                value={inputValue}\n                onChange={(e) => setInputValue(e.target.value)}\n                onKeyPress={handleKeyPress}\n                placeholder=\"Pl: Modern kanap√© 100 ezer alatt...\"\n                className=\"\n                  flex-1 px-4 py-3.5 rounded-full\n                  bg-gray-100 text-gray-800\n                  focus:outline-none focus:ring-2 focus:ring-primary-500 focus:bg-white\n                  text-sm placeholder:text-gray-400\n                  border border-transparent focus:border-primary-300\n                \"\n                disabled={isLoading}\n              />\n              <button\n                onClick={handleSendMessage}\n                disabled={!inputValue.trim() || isLoading}\n                className=\"\n                  w-12 h-12 rounded-full\n                  bg-gradient-to-br from-primary-500 to-secondary-700\n                  text-white\n                  flex items-center justify-center\n                  transition-all\n                  hover:scale-105 hover:shadow-lg\n                  disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100\n                \"\n                aria-label=\"K√ºld√©s\"\n              >\n                {isLoading ? (\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                ) : (\n                  <Send className=\"w-5 h-5\" />\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default AIChatAssistant;\n"],"names":["AIChatAssistant","products","catalogProducts","onShowProducts","serverSearchMode","totalProductsCount","categoryHierarchy","isOpen","setIsOpen","useState","messages","setMessages","inputValue","setInputValue","isLoading","setIsLoading","messagesEndRef","useRef","inputRef","messageIdRef","catalogSource","catalogStats","useMemo","fallbackCategories","ch","mainCategories","priceRanges","minPrice","maxPrice","onSaleCount","colors","styles","p","cat","mainCat","price","name","s","c","topCategories","a","b","data","performSmartSearch","useCallback","query","options","limit","intent","parseSearchIntent","fetchUnasProducts","smartSearch","getCategoryProducts","categoryName","proactiveSuggestions","getProactiveSuggestions","generateMessageId","useEffect","getChatContext","recentlyViewed","getViewedProducts","getTopCategories","styleDNA","getStyleDNA","welcomeMessage","welcomeProducts","lastProduct","_a","_b","_c","_d","_e","_f","scrollToBottom","handleFeedback","messageId","isPositive","message","trackAIFeedback","prev","m","handleProductClick","product","allRecommended","handleSendMessage","userMessage","trackSearch","userMsgId","relevantProducts","searchIntent","searchResult","personalContext","getPersonalizedContext","recentViewed","topCats","conversationHistory","categoryInfo","productList","viewedInfo","intentInfo","styleProfile","prompt","result","generateText","err","assistantMsgId","saveChatContext","fallbackProducts","fallbackText","error","handleKeyPress","quickSuggestions","suggestions","viewed","searches","getSearchHistory","d","formatPrice","jsxs","Fragment","jsx","MessageCircle","Sparkles","X","User","AlertCircle","Bot","ThumbsUp","ThumbsDown","Package","e","Loader2","TrendingUp","suggestion","index","Send"],"mappings":"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"}